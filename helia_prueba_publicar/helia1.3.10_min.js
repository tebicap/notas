(function (root, factory) {(typeof module === 'object' && module.exports) ? module.exports = factory() : root.Helia = factory()}(typeof self !== 'undefined' ? self : this, function () {
"use strict";var Helia=(()=>{var WL=Object.create;var fu=Object.defineProperty;var YL=Object.getOwnPropertyDescriptor;var QL=Object.getOwnPropertyNames;var XL=Object.getPrototypeOf,jL=Object.prototype.hasOwnProperty;var ZL=(r,e,t)=>e in r?fu(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t;var $7=(r=>typeof require<"u"?require:typeof Proxy<"u"?new Proxy(r,{get:(e,t)=>(typeof require<"u"?require:e)[t]}):r)(function(r){if(typeof require<"u")return require.apply(this,arguments);throw new Error('Dynamic require of "'+r+'" is not supported')});var Je=(r,e)=>()=>(r&&(e=r(r=0)),e);var N=(r,e)=>()=>(e||r((e={exports:{}}).exports,e),e.exports),Y=(r,e)=>{for(var t in e)fu(r,t,{get:e[t],enumerable:!0})},H7=(r,e,t,n)=>{if(e&&typeof e=="object"||typeof e=="function")for(let s of QL(e))!jL.call(r,s)&&s!==t&&fu(r,s,{get:()=>e[s],enumerable:!(n=YL(e,s))||n.enumerable});return r};var W=(r,e,t)=>(t=r!=null?WL(XL(r)):{},H7(e||!r||!r.__esModule?fu(t,"default",{value:r,enumerable:!0}):t,r)),Zh=r=>H7(fu({},"__esModule",{value:!0}),r);var gt=(r,e,t)=>(ZL(r,typeof e!="symbol"?e+"":e,t),t);var E2=N((_ie,G7)=>{var Ga=1e3,Wa=Ga*60,Ya=Wa*60,qo=Ya*24,JL=qo*7,eB=qo*365.25;G7.exports=function(r,e){e=e||{};var t=typeof r;if(t==="string"&&r.length>0)return tB(r);if(t==="number"&&isFinite(r))return e.long?nB(r):rB(r);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(r))};function tB(r){if(r=String(r),!(r.length>100)){var e=/^(-?(?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec(r);if(e){var t=parseFloat(e[1]),n=(e[2]||"ms").toLowerCase();switch(n){case"years":case"year":case"yrs":case"yr":case"y":return t*eB;case"weeks":case"week":case"w":return t*JL;case"days":case"day":case"d":return t*qo;case"hours":case"hour":case"hrs":case"hr":case"h":return t*Ya;case"minutes":case"minute":case"mins":case"min":case"m":return t*Wa;case"seconds":case"second":case"secs":case"sec":case"s":return t*Ga;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return t;default:return}}}}function rB(r){var e=Math.abs(r);return e>=qo?Math.round(r/qo)+"d":e>=Ya?Math.round(r/Ya)+"h":e>=Wa?Math.round(r/Wa)+"m":e>=Ga?Math.round(r/Ga)+"s":r+"ms"}function nB(r){var e=Math.abs(r);return e>=qo?Jh(r,e,qo,"day"):e>=Ya?Jh(r,e,Ya,"hour"):e>=Wa?Jh(r,e,Wa,"minute"):e>=Ga?Jh(r,e,Ga,"second"):r+" ms"}function Jh(r,e,t,n){var s=e>=t*1.5;return Math.round(r/t)+" "+n+(s?"s":"")}});var Y7=N((Sie,W7)=>{function sB(r){t.debug=t,t.default=t,t.coerce=c,t.disable=i,t.enable=s,t.enabled=o,t.humanize=E2(),t.destroy=l,Object.keys(r).forEach(u=>{t[u]=r[u]}),t.names=[],t.skips=[],t.formatters={};function e(u){let f=0;for(let h=0;h<u.length;h++)f=(f<<5)-f+u.charCodeAt(h),f|=0;return t.colors[Math.abs(f)%t.colors.length]}t.selectColor=e;function t(u){let f,h=null,p,d;function m(...g){if(!m.enabled)return;let y=m,b=Number(new Date),w=b-(f||b);y.diff=w,y.prev=f,y.curr=b,f=b,g[0]=t.coerce(g[0]),typeof g[0]!="string"&&g.unshift("%O");let v=0;g[0]=g[0].replace(/%([a-zA-Z%])/g,(_,S)=>{if(_==="%%")return"%";v++;let A=t.formatters[S];if(typeof A=="function"){let D=g[v];_=A.call(y,D),g.splice(v,1),v--}return _}),t.formatArgs.call(y,g),(y.log||t.log).apply(y,g)}return m.namespace=u,m.useColors=t.useColors(),m.color=t.selectColor(u),m.extend=n,m.destroy=t.destroy,Object.defineProperty(m,"enabled",{enumerable:!0,configurable:!1,get:()=>h!==null?h:(p!==t.namespaces&&(p=t.namespaces,d=t.enabled(u)),d),set:g=>{h=g}}),typeof t.init=="function"&&t.init(m),m}function n(u,f){let h=t(this.namespace+(typeof f>"u"?":":f)+u);return h.log=this.log,h}function s(u){t.save(u),t.namespaces=u,t.names=[],t.skips=[];let f,h=(typeof u=="string"?u:"").split(/[\s,]+/),p=h.length;for(f=0;f<p;f++)h[f]&&(u=h[f].replace(/\*/g,".*?"),u[0]==="-"?t.skips.push(new RegExp("^"+u.slice(1)+"$")):t.names.push(new RegExp("^"+u+"$")))}function i(){let u=[...t.names.map(a),...t.skips.map(a).map(f=>"-"+f)].join(",");return t.enable(""),u}function o(u){if(u[u.length-1]==="*")return!0;let f,h;for(f=0,h=t.skips.length;f<h;f++)if(t.skips[f].test(u))return!1;for(f=0,h=t.names.length;f<h;f++)if(t.names[f].test(u))return!0;return!1}function a(u){return u.toString().substring(2,u.toString().length-2).replace(/\.\*\?$/,"*")}function c(u){return u instanceof Error?u.stack||u.message:u}function l(){console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`.")}return t.enable(t.load()),t}W7.exports=sB});var hu=N((rn,e0)=>{rn.formatArgs=oB;rn.save=aB;rn.load=cB;rn.useColors=iB;rn.storage=lB();rn.destroy=(()=>{let r=!1;return()=>{r||(r=!0,console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`."))}})();rn.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"];function iB(){return typeof window<"u"&&window.process&&(window.process.type==="renderer"||window.process.__nwjs)?!0:typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/)?!1:typeof document<"u"&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||typeof window<"u"&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31||typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/)}function oB(r){if(r[0]=(this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+r[0]+(this.useColors?"%c ":" ")+"+"+e0.exports.humanize(this.diff),!this.useColors)return;let e="color: "+this.color;r.splice(1,0,e,"color: inherit");let t=0,n=0;r[0].replace(/%[a-zA-Z%]/g,s=>{s!=="%%"&&(t++,s==="%c"&&(n=t))}),r.splice(n,0,e)}rn.log=console.debug||console.log||(()=>{});function aB(r){try{r?rn.storage.setItem("debug",r):rn.storage.removeItem("debug")}catch{}}function cB(){let r;try{r=rn.storage.getItem("debug")}catch{}return!r&&typeof process<"u"&&"env"in process&&(r=process.env.DEBUG),r}function lB(){try{return localStorage}catch{}}e0.exports=Y7()(rn);var{formatters:uB}=e0.exports;uB.j=function(r){try{return JSON.stringify(r)}catch(e){return"[UnexpectedJSONParseError]: "+e.message}}});var Ko=N((Jie,nb)=>{"use strict";function rb(r,e){for(let t in e)Object.defineProperty(r,t,{value:e[t],enumerable:!0,configurable:!0});return r}function yB(r,e,t){if(!r||typeof r=="string")throw new TypeError("Please pass an Error to err-code");t||(t={}),typeof e=="object"&&(t=e,e=""),e&&(t.code=e);try{return rb(r,t)}catch{t.message=r.message,t.stack=r.stack;let s=function(){};return s.prototype=Object.create(Object.getPrototypeOf(r)),rb(new s,t)}}nb.exports=yB});var n9=N((Ile,r9)=>{r9.exports=t9;var e9=128,DU=127,CU=~DU,PU=Math.pow(2,31);function t9(r,e,t){e=e||[],t=t||0;for(var n=t;r>=PU;)e[t++]=r&255|e9,r/=128;for(;r&CU;)e[t++]=r&255|e9,r>>>=7;return e[t]=r|0,t9.bytes=t-n+1,e}});var o9=N((Tle,i9)=>{i9.exports=om;var kU=128,s9=127;function om(r,n){var t=0,n=n||0,s=0,i=n,o,a=r.length;do{if(i>=a)throw om.bytes=0,new RangeError("Could not decode varint");o=r[i++],t+=s<28?(o&s9)<<s:(o&s9)*Math.pow(2,s),s+=7}while(o>=kU);return om.bytes=i-n,t}});var c9=N((Dle,a9)=>{var NU=Math.pow(2,7),OU=Math.pow(2,14),LU=Math.pow(2,21),BU=Math.pow(2,28),MU=Math.pow(2,35),UU=Math.pow(2,42),FU=Math.pow(2,49),VU=Math.pow(2,56),zU=Math.pow(2,63);a9.exports=function(r){return r<NU?1:r<OU?2:r<LU?3:r<BU?4:r<MU?5:r<UU?6:r<FU?7:r<VU?8:r<zU?9:10}});var u9=N((Cle,l9)=>{l9.exports={encode:n9(),decode:o9(),encodingLength:c9()}});var d9=N((Ple,h9)=>{"use strict";var f9=u9();h9.exports=r=>{if(!(r instanceof Uint8Array))throw new Error("arg needs to be a Uint8Array");let e=[];for(;r.length>0;){let t=f9.decode(r);e.push(t),r=r.slice(f9.decode.bytes)}return e}});var g9=N((qle,m9)=>{m9.exports=am;var p9=128,qU=127,KU=~qU,$U=Math.pow(2,31);function am(r,e,t){if(Number.MAX_SAFE_INTEGER&&r>Number.MAX_SAFE_INTEGER)throw am.bytes=0,new RangeError("Could not encode varint");e=e||[],t=t||0;for(var n=t;r>=$U;)e[t++]=r&255|p9,r/=128;for(;r&KU;)e[t++]=r&255|p9,r>>>=7;return e[t]=r|0,am.bytes=t-n+1,e}});var w9=N((Kle,b9)=>{b9.exports=cm;var HU=128,y9=127;function cm(r,n){var t=0,n=n||0,s=0,i=n,o,a=r.length;do{if(i>=a||s>49)throw cm.bytes=0,new RangeError("Could not decode varint");o=r[i++],t+=s<28?(o&y9)<<s:(o&y9)*Math.pow(2,s),s+=7}while(o>=HU);return cm.bytes=i-n,t}});var E9=N(($le,x9)=>{var GU=Math.pow(2,7),WU=Math.pow(2,14),YU=Math.pow(2,21),QU=Math.pow(2,28),XU=Math.pow(2,35),jU=Math.pow(2,42),ZU=Math.pow(2,49),JU=Math.pow(2,56),eF=Math.pow(2,63);x9.exports=function(r){return r<GU?1:r<WU?2:r<YU?3:r<QU?4:r<XU?5:r<jU?6:r<ZU?7:r<JU?8:r<eF?9:10}});var ac=N((Hle,v9)=>{v9.exports={encode:g9(),decode:w9(),encodingLength:E9()}});var lm=N((Wle,S9)=>{"use strict";S9.exports=rF;function rF(r,e){for(var t=new Array(arguments.length-1),n=0,s=2,i=!0;s<arguments.length;)t[n++]=arguments[s++];return new Promise(function(a,c){t[n]=function(u){if(i)if(i=!1,u)c(u);else{for(var f=new Array(arguments.length-1),h=0;h<f.length;)f[h++]=arguments[h];a.apply(null,f)}};try{r.apply(e||null,t)}catch(l){i&&(i=!1,c(l))}})}});var um=N(I9=>{"use strict";var u0=I9;u0.length=function(e){var t=e.length;if(!t)return 0;for(var n=0;--t%4>1&&e.charAt(t)==="=";)++n;return Math.ceil(e.length*3)/4-n};var cc=new Array(64),R9=new Array(123);for(Xn=0;Xn<64;)R9[cc[Xn]=Xn<26?Xn+65:Xn<52?Xn+71:Xn<62?Xn-4:Xn-59|43]=Xn++;var Xn;u0.encode=function(e,t,n){for(var s=null,i=[],o=0,a=0,c;t<n;){var l=e[t++];switch(a){case 0:i[o++]=cc[l>>2],c=(l&3)<<4,a=1;break;case 1:i[o++]=cc[c|l>>4],c=(l&15)<<2,a=2;break;case 2:i[o++]=cc[c|l>>6],i[o++]=cc[l&63],a=0;break}o>8191&&((s||(s=[])).push(String.fromCharCode.apply(String,i)),o=0)}return a&&(i[o++]=cc[c],i[o++]=61,a===1&&(i[o++]=61)),s?(o&&s.push(String.fromCharCode.apply(String,i.slice(0,o))),s.join("")):String.fromCharCode.apply(String,i.slice(0,o))};var A9="invalid encoding";u0.decode=function(e,t,n){for(var s=n,i=0,o,a=0;a<e.length;){var c=e.charCodeAt(a++);if(c===61&&i>1)break;if((c=R9[c])===void 0)throw Error(A9);switch(i){case 0:o=c,i=1;break;case 1:t[n++]=o<<2|(c&48)>>4,o=c,i=2;break;case 2:t[n++]=(o&15)<<4|(c&60)>>2,o=c,i=3;break;case 3:t[n++]=(o&3)<<6|c,i=0;break}}if(i===1)throw Error(A9);return n-s};u0.test=function(e){return/^(?:[A-Za-z0-9+/]{4})*(?:[A-Za-z0-9+/]{2}==|[A-Za-z0-9+/]{3}=)?$/.test(e)}});var fm=N((Qle,T9)=>{"use strict";T9.exports=f0;function f0(){this._listeners={}}f0.prototype.on=function(e,t,n){return(this._listeners[e]||(this._listeners[e]=[])).push({fn:t,ctx:n||this}),this};f0.prototype.off=function(e,t){if(e===void 0)this._listeners={};else if(t===void 0)this._listeners[e]=[];else for(var n=this._listeners[e],s=0;s<n.length;)n[s].fn===t?n.splice(s,1):++s;return this};f0.prototype.emit=function(e){var t=this._listeners[e];if(t){for(var n=[],s=1;s<arguments.length;)n.push(arguments[s++]);for(s=0;s<t.length;)t[s].fn.apply(t[s++].ctx,n)}return this}});var hm=N((Xle,O9)=>{"use strict";O9.exports=D9(D9);function D9(r){return typeof Float32Array<"u"?function(){var e=new Float32Array([-0]),t=new Uint8Array(e.buffer),n=t[3]===128;function s(c,l,u){e[0]=c,l[u]=t[0],l[u+1]=t[1],l[u+2]=t[2],l[u+3]=t[3]}function i(c,l,u){e[0]=c,l[u]=t[3],l[u+1]=t[2],l[u+2]=t[1],l[u+3]=t[0]}r.writeFloatLE=n?s:i,r.writeFloatBE=n?i:s;function o(c,l){return t[0]=c[l],t[1]=c[l+1],t[2]=c[l+2],t[3]=c[l+3],e[0]}function a(c,l){return t[3]=c[l],t[2]=c[l+1],t[1]=c[l+2],t[0]=c[l+3],e[0]}r.readFloatLE=n?o:a,r.readFloatBE=n?a:o}():function(){function e(n,s,i,o){var a=s<0?1:0;if(a&&(s=-s),s===0)n(1/s>0?0:2147483648,i,o);else if(isNaN(s))n(2143289344,i,o);else if(s>34028234663852886e22)n((a<<31|2139095040)>>>0,i,o);else if(s<11754943508222875e-54)n((a<<31|Math.round(s/1401298464324817e-60))>>>0,i,o);else{var c=Math.floor(Math.log(s)/Math.LN2),l=Math.round(s*Math.pow(2,-c)*8388608)&8388607;n((a<<31|c+127<<23|l)>>>0,i,o)}}r.writeFloatLE=e.bind(null,C9),r.writeFloatBE=e.bind(null,P9);function t(n,s,i){var o=n(s,i),a=(o>>31)*2+1,c=o>>>23&255,l=o&8388607;return c===255?l?NaN:a*(1/0):c===0?a*1401298464324817e-60*l:a*Math.pow(2,c-150)*(l+8388608)}r.readFloatLE=t.bind(null,k9),r.readFloatBE=t.bind(null,N9)}(),typeof Float64Array<"u"?function(){var e=new Float64Array([-0]),t=new Uint8Array(e.buffer),n=t[7]===128;function s(c,l,u){e[0]=c,l[u]=t[0],l[u+1]=t[1],l[u+2]=t[2],l[u+3]=t[3],l[u+4]=t[4],l[u+5]=t[5],l[u+6]=t[6],l[u+7]=t[7]}function i(c,l,u){e[0]=c,l[u]=t[7],l[u+1]=t[6],l[u+2]=t[5],l[u+3]=t[4],l[u+4]=t[3],l[u+5]=t[2],l[u+6]=t[1],l[u+7]=t[0]}r.writeDoubleLE=n?s:i,r.writeDoubleBE=n?i:s;function o(c,l){return t[0]=c[l],t[1]=c[l+1],t[2]=c[l+2],t[3]=c[l+3],t[4]=c[l+4],t[5]=c[l+5],t[6]=c[l+6],t[7]=c[l+7],e[0]}function a(c,l){return t[7]=c[l],t[6]=c[l+1],t[5]=c[l+2],t[4]=c[l+3],t[3]=c[l+4],t[2]=c[l+5],t[1]=c[l+6],t[0]=c[l+7],e[0]}r.readDoubleLE=n?o:a,r.readDoubleBE=n?a:o}():function(){function e(n,s,i,o,a,c){var l=o<0?1:0;if(l&&(o=-o),o===0)n(0,a,c+s),n(1/o>0?0:2147483648,a,c+i);else if(isNaN(o))n(0,a,c+s),n(2146959360,a,c+i);else if(o>17976931348623157e292)n(0,a,c+s),n((l<<31|2146435072)>>>0,a,c+i);else{var u;if(o<22250738585072014e-324)u=o/5e-324,n(u>>>0,a,c+s),n((l<<31|u/4294967296)>>>0,a,c+i);else{var f=Math.floor(Math.log(o)/Math.LN2);f===1024&&(f=1023),u=o*Math.pow(2,-f),n(u*4503599627370496>>>0,a,c+s),n((l<<31|f+1023<<20|u*1048576&1048575)>>>0,a,c+i)}}}r.writeDoubleLE=e.bind(null,C9,0,4),r.writeDoubleBE=e.bind(null,P9,4,0);function t(n,s,i,o,a){var c=n(o,a+s),l=n(o,a+i),u=(l>>31)*2+1,f=l>>>20&2047,h=4294967296*(l&1048575)+c;return f===2047?h?NaN:u*(1/0):f===0?u*5e-324*h:u*Math.pow(2,f-1075)*(h+4503599627370496)}r.readDoubleLE=t.bind(null,k9,0,4),r.readDoubleBE=t.bind(null,N9,4,0)}(),r}function C9(r,e,t){e[t]=r&255,e[t+1]=r>>>8&255,e[t+2]=r>>>16&255,e[t+3]=r>>>24}function P9(r,e,t){e[t]=r>>>24,e[t+1]=r>>>16&255,e[t+2]=r>>>8&255,e[t+3]=r&255}function k9(r,e){return(r[e]|r[e+1]<<8|r[e+2]<<16|r[e+3]<<24)>>>0}function N9(r,e){return(r[e]<<24|r[e+1]<<16|r[e+2]<<8|r[e+3])>>>0}});var dm=N((exports,module)=>{"use strict";module.exports=inquire;function inquire(moduleName){try{var mod=eval("quire".replace(/^/,"re"))(moduleName);if(mod&&(mod.length||Object.keys(mod).length))return mod}catch(r){}return null}});var mm=N(L9=>{"use strict";var pm=L9;pm.length=function(e){for(var t=0,n=0,s=0;s<e.length;++s)n=e.charCodeAt(s),n<128?t+=1:n<2048?t+=2:(n&64512)===55296&&(e.charCodeAt(s+1)&64512)===56320?(++s,t+=4):t+=3;return t};pm.read=function(e,t,n){var s=n-t;if(s<1)return"";for(var i=null,o=[],a=0,c;t<n;)c=e[t++],c<128?o[a++]=c:c>191&&c<224?o[a++]=(c&31)<<6|e[t++]&63:c>239&&c<365?(c=((c&7)<<18|(e[t++]&63)<<12|(e[t++]&63)<<6|e[t++]&63)-65536,o[a++]=55296+(c>>10),o[a++]=56320+(c&1023)):o[a++]=(c&15)<<12|(e[t++]&63)<<6|e[t++]&63,a>8191&&((i||(i=[])).push(String.fromCharCode.apply(String,o)),a=0);return i?(a&&i.push(String.fromCharCode.apply(String,o.slice(0,a))),i.join("")):String.fromCharCode.apply(String,o.slice(0,a))};pm.write=function(e,t,n){for(var s=n,i,o,a=0;a<e.length;++a)i=e.charCodeAt(a),i<128?t[n++]=i:i<2048?(t[n++]=i>>6|192,t[n++]=i&63|128):(i&64512)===55296&&((o=e.charCodeAt(a+1))&64512)===56320?(i=65536+((i&1023)<<10)+(o&1023),++a,t[n++]=i>>18|240,t[n++]=i>>12&63|128,t[n++]=i>>6&63|128,t[n++]=i&63|128):(t[n++]=i>>12|224,t[n++]=i>>6&63|128,t[n++]=i&63|128);return n-s}});var gm=N((Zle,B9)=>{"use strict";B9.exports=nF;function nF(r,e,t){var n=t||8192,s=n>>>1,i=null,o=n;return function(c){if(c<1||c>s)return r(c);o+c>n&&(i=r(n),o=0);var l=e.call(i,o,o+=c);return o&7&&(o=(o|7)+1),l}}});var U9=N((Jle,M9)=>{"use strict";M9.exports=ar;var Cu=Xo();function ar(r,e){this.lo=r>>>0,this.hi=e>>>0}var Qo=ar.zero=new ar(0,0);Qo.toNumber=function(){return 0};Qo.zzEncode=Qo.zzDecode=function(){return this};Qo.length=function(){return 1};var sF=ar.zeroHash="\0\0\0\0\0\0\0\0";ar.fromNumber=function(e){if(e===0)return Qo;var t=e<0;t&&(e=-e);var n=e>>>0,s=(e-n)/4294967296>>>0;return t&&(s=~s>>>0,n=~n>>>0,++n>4294967295&&(n=0,++s>4294967295&&(s=0))),new ar(n,s)};ar.from=function(e){if(typeof e=="number")return ar.fromNumber(e);if(Cu.isString(e))if(Cu.Long)e=Cu.Long.fromString(e);else return ar.fromNumber(parseInt(e,10));return e.low||e.high?new ar(e.low>>>0,e.high>>>0):Qo};ar.prototype.toNumber=function(e){if(!e&&this.hi>>>31){var t=~this.lo+1>>>0,n=~this.hi>>>0;return t||(n=n+1>>>0),-(t+n*4294967296)}return this.lo+this.hi*4294967296};ar.prototype.toLong=function(e){return Cu.Long?new Cu.Long(this.lo|0,this.hi|0,!!e):{low:this.lo|0,high:this.hi|0,unsigned:!!e}};var Mi=String.prototype.charCodeAt;ar.fromHash=function(e){return e===sF?Qo:new ar((Mi.call(e,0)|Mi.call(e,1)<<8|Mi.call(e,2)<<16|Mi.call(e,3)<<24)>>>0,(Mi.call(e,4)|Mi.call(e,5)<<8|Mi.call(e,6)<<16|Mi.call(e,7)<<24)>>>0)};ar.prototype.toHash=function(){return String.fromCharCode(this.lo&255,this.lo>>>8&255,this.lo>>>16&255,this.lo>>>24,this.hi&255,this.hi>>>8&255,this.hi>>>16&255,this.hi>>>24)};ar.prototype.zzEncode=function(){var e=this.hi>>31;return this.hi=((this.hi<<1|this.lo>>>31)^e)>>>0,this.lo=(this.lo<<1^e)>>>0,this};ar.prototype.zzDecode=function(){var e=-(this.lo&1);return this.lo=((this.lo>>>1|this.hi<<31)^e)>>>0,this.hi=(this.hi>>>1^e)>>>0,this};ar.prototype.length=function(){var e=this.lo,t=(this.lo>>>28|this.hi<<4)>>>0,n=this.hi>>>24;return n===0?t===0?e<16384?e<128?1:2:e<2097152?3:4:t<16384?t<128?5:6:t<2097152?7:8:n<128?9:10}});var Xo=N(ym=>{"use strict";var ae=ym;ae.asPromise=lm();ae.base64=um();ae.EventEmitter=fm();ae.float=hm();ae.inquire=dm();ae.utf8=mm();ae.pool=gm();ae.LongBits=U9();ae.isNode=!!(typeof globalThis<"u"&&globalThis&&globalThis.process&&globalThis.process.versions&&globalThis.process.versions.node);ae.global=ae.isNode&&globalThis||typeof window<"u"&&window||typeof self<"u"&&self||ym;ae.emptyArray=Object.freeze?Object.freeze([]):[];ae.emptyObject=Object.freeze?Object.freeze({}):{};ae.isInteger=Number.isInteger||function(e){return typeof e=="number"&&isFinite(e)&&Math.floor(e)===e};ae.isString=function(e){return typeof e=="string"||e instanceof String};ae.isObject=function(e){return e&&typeof e=="object"};ae.isset=ae.isSet=function(e,t){var n=e[t];return n!=null&&e.hasOwnProperty(t)?typeof n!="object"||(Array.isArray(n)?n.length:Object.keys(n).length)>0:!1};ae.Buffer=function(){try{var r=ae.inquire("buffer").Buffer;return r.prototype.utf8Write?r:null}catch{return null}}();ae._Buffer_from=null;ae._Buffer_allocUnsafe=null;ae.newBuffer=function(e){return typeof e=="number"?ae.Buffer?ae._Buffer_allocUnsafe(e):new ae.Array(e):ae.Buffer?ae._Buffer_from(e):typeof Uint8Array>"u"?e:new Uint8Array(e)};ae.Array=typeof Uint8Array<"u"?Uint8Array:Array;ae.Long=ae.global.dcodeIO&&ae.global.dcodeIO.Long||ae.global.Long||ae.inquire("long");ae.key2Re=/^true|false|0|1$/;ae.key32Re=/^-?(?:0|[1-9][0-9]*)$/;ae.key64Re=/^(?:[\\x00-\\xff]{8}|-?(?:0|[1-9][0-9]*))$/;ae.longToHash=function(e){return e?ae.LongBits.from(e).toHash():ae.LongBits.zeroHash};ae.longFromHash=function(e,t){var n=ae.LongBits.fromHash(e);return ae.Long?ae.Long.fromBits(n.lo,n.hi,t):n.toNumber(!!t)};function F9(r,e,t){for(var n=Object.keys(e),s=0;s<n.length;++s)(r[n[s]]===void 0||!t)&&(r[n[s]]=e[n[s]]);return r}ae.merge=F9;ae.lcFirst=function(e){return e.charAt(0).toLowerCase()+e.substring(1)};function V9(r){function e(t,n){if(!(this instanceof e))return new e(t,n);Object.defineProperty(this,"message",{get:function(){return t}}),Error.captureStackTrace?Error.captureStackTrace(this,e):Object.defineProperty(this,"stack",{value:new Error().stack||""}),n&&F9(this,n)}return e.prototype=Object.create(Error.prototype,{constructor:{value:e,writable:!0,enumerable:!1,configurable:!0},name:{get:function(){return r},set:void 0,enumerable:!1,configurable:!0},toString:{value:function(){return this.name+": "+this.message},writable:!0,enumerable:!1,configurable:!0}}),e}ae.newError=V9;ae.ProtocolError=V9("ProtocolError");ae.oneOfGetter=function(e){for(var t={},n=0;n<e.length;++n)t[e[n]]=1;return function(){for(var s=Object.keys(this),i=s.length-1;i>-1;--i)if(t[s[i]]===1&&this[s[i]]!==void 0&&this[s[i]]!==null)return s[i]}};ae.oneOfSetter=function(e){return function(t){for(var n=0;n<e.length;++n)e[n]!==t&&delete this[e[n]]}};ae.toJSONOptions={longs:String,enums:String,bytes:String,json:!0};ae._configure=function(){var r=ae.Buffer;if(!r){ae._Buffer_from=ae._Buffer_allocUnsafe=null;return}ae._Buffer_from=r.from!==Uint8Array.from&&r.from||function(t,n){return new r(t,n)},ae._Buffer_allocUnsafe=r.allocUnsafe||function(t){return new r(t)}}});var xm=N((tue,H9)=>{"use strict";H9.exports=qt;var As=Xo(),wm,K9=As.LongBits,iF=As.utf8;function jn(r,e){return RangeError("index out of range: "+r.pos+" + "+(e||1)+" > "+r.len)}function qt(r){this.buf=r,this.pos=0,this.len=r.length}var z9=typeof Uint8Array<"u"?function(e){if(e instanceof Uint8Array||Array.isArray(e))return new qt(e);throw Error("illegal buffer")}:function(e){if(Array.isArray(e))return new qt(e);throw Error("illegal buffer")},$9=function(){return As.Buffer?function(t){return(qt.create=function(s){return As.Buffer.isBuffer(s)?new wm(s):z9(s)})(t)}:z9};qt.create=$9();qt.prototype._slice=As.Array.prototype.subarray||As.Array.prototype.slice;qt.prototype.uint32=function(){var e=4294967295;return function(){if(e=(this.buf[this.pos]&127)>>>0,this.buf[this.pos++]<128||(e=(e|(this.buf[this.pos]&127)<<7)>>>0,this.buf[this.pos++]<128)||(e=(e|(this.buf[this.pos]&127)<<14)>>>0,this.buf[this.pos++]<128)||(e=(e|(this.buf[this.pos]&127)<<21)>>>0,this.buf[this.pos++]<128)||(e=(e|(this.buf[this.pos]&15)<<28)>>>0,this.buf[this.pos++]<128))return e;if((this.pos+=5)>this.len)throw this.pos=this.len,jn(this,10);return e}}();qt.prototype.int32=function(){return this.uint32()|0};qt.prototype.sint32=function(){var e=this.uint32();return e>>>1^-(e&1)|0};function bm(){var r=new K9(0,0),e=0;if(this.len-this.pos>4){for(;e<4;++e)if(r.lo=(r.lo|(this.buf[this.pos]&127)<<e*7)>>>0,this.buf[this.pos++]<128)return r;if(r.lo=(r.lo|(this.buf[this.pos]&127)<<28)>>>0,r.hi=(r.hi|(this.buf[this.pos]&127)>>4)>>>0,this.buf[this.pos++]<128)return r;e=0}else{for(;e<3;++e){if(this.pos>=this.len)throw jn(this);if(r.lo=(r.lo|(this.buf[this.pos]&127)<<e*7)>>>0,this.buf[this.pos++]<128)return r}return r.lo=(r.lo|(this.buf[this.pos++]&127)<<e*7)>>>0,r}if(this.len-this.pos>4){for(;e<5;++e)if(r.hi=(r.hi|(this.buf[this.pos]&127)<<e*7+3)>>>0,this.buf[this.pos++]<128)return r}else for(;e<5;++e){if(this.pos>=this.len)throw jn(this);if(r.hi=(r.hi|(this.buf[this.pos]&127)<<e*7+3)>>>0,this.buf[this.pos++]<128)return r}throw Error("invalid varint encoding")}qt.prototype.bool=function(){return this.uint32()!==0};function h0(r,e){return(r[e-4]|r[e-3]<<8|r[e-2]<<16|r[e-1]<<24)>>>0}qt.prototype.fixed32=function(){if(this.pos+4>this.len)throw jn(this,4);return h0(this.buf,this.pos+=4)};qt.prototype.sfixed32=function(){if(this.pos+4>this.len)throw jn(this,4);return h0(this.buf,this.pos+=4)|0};function q9(){if(this.pos+8>this.len)throw jn(this,8);return new K9(h0(this.buf,this.pos+=4),h0(this.buf,this.pos+=4))}qt.prototype.float=function(){if(this.pos+4>this.len)throw jn(this,4);var e=As.float.readFloatLE(this.buf,this.pos);return this.pos+=4,e};qt.prototype.double=function(){if(this.pos+8>this.len)throw jn(this,4);var e=As.float.readDoubleLE(this.buf,this.pos);return this.pos+=8,e};qt.prototype.bytes=function(){var e=this.uint32(),t=this.pos,n=this.pos+e;if(n>this.len)throw jn(this,e);return this.pos+=e,Array.isArray(this.buf)?this.buf.slice(t,n):t===n?new this.buf.constructor(0):this._slice.call(this.buf,t,n)};qt.prototype.string=function(){var e=this.bytes();return iF.read(e,0,e.length)};qt.prototype.skip=function(e){if(typeof e=="number"){if(this.pos+e>this.len)throw jn(this,e);this.pos+=e}else do if(this.pos>=this.len)throw jn(this);while(this.buf[this.pos++]&128);return this};qt.prototype.skipType=function(r){switch(r){case 0:this.skip();break;case 1:this.skip(8);break;case 2:this.skip(this.uint32());break;case 3:for(;(r=this.uint32()&7)!==4;)this.skipType(r);break;case 5:this.skip(4);break;default:throw Error("invalid wire type "+r+" at offset "+this.pos)}return this};qt._configure=function(r){wm=r,qt.create=$9(),wm._configure();var e=As.Long?"toLong":"toNumber";As.merge(qt.prototype,{int64:function(){return bm.call(this)[e](!1)},uint64:function(){return bm.call(this)[e](!0)},sint64:function(){return bm.call(this).zzDecode()[e](!1)},fixed64:function(){return q9.call(this)[e](!0)},sfixed64:function(){return q9.call(this)[e](!1)}})}});var Q9=N((rue,Y9)=>{"use strict";Y9.exports=jo;var W9=xm();(jo.prototype=Object.create(W9.prototype)).constructor=jo;var G9=Xo();function jo(r){W9.call(this,r)}jo._configure=function(){G9.Buffer&&(jo.prototype._slice=G9.Buffer.prototype.slice)};jo.prototype.string=function(){var e=this.uint32();return this.buf.utf8Slice?this.buf.utf8Slice(this.pos,this.pos=Math.min(this.pos+e,this.len)):this.buf.toString("utf-8",this.pos,this.pos=Math.min(this.pos+e,this.len))};jo._configure()});var Im=N((nue,J9)=>{"use strict";J9.exports=ze;var kn=Xo(),Em,d0=kn.LongBits,X9=kn.base64,j9=kn.utf8;function Pu(r,e,t){this.fn=r,this.len=e,this.next=void 0,this.val=t}function _m(){}function oF(r){this.head=r.head,this.tail=r.tail,this.len=r.len,this.next=r.states}function ze(){this.len=0,this.head=new Pu(_m,0,0),this.tail=this.head,this.states=null}var Z9=function(){return kn.Buffer?function(){return(ze.create=function(){return new Em})()}:function(){return new ze}};ze.create=Z9();ze.alloc=function(e){return new kn.Array(e)};kn.Array!==Array&&(ze.alloc=kn.pool(ze.alloc,kn.Array.prototype.subarray));ze.prototype._push=function(e,t,n){return this.tail=this.tail.next=new Pu(e,t,n),this.len+=t,this};function Sm(r,e,t){e[t]=r&255}function aF(r,e,t){for(;r>127;)e[t++]=r&127|128,r>>>=7;e[t]=r}function Am(r,e){this.len=r,this.next=void 0,this.val=e}Am.prototype=Object.create(Pu.prototype);Am.prototype.fn=aF;ze.prototype.uint32=function(e){return this.len+=(this.tail=this.tail.next=new Am((e=e>>>0)<128?1:e<16384?2:e<2097152?3:e<268435456?4:5,e)).len,this};ze.prototype.int32=function(e){return e<0?this._push(Rm,10,d0.fromNumber(e)):this.uint32(e)};ze.prototype.sint32=function(e){return this.uint32((e<<1^e>>31)>>>0)};function Rm(r,e,t){for(;r.hi;)e[t++]=r.lo&127|128,r.lo=(r.lo>>>7|r.hi<<25)>>>0,r.hi>>>=7;for(;r.lo>127;)e[t++]=r.lo&127|128,r.lo=r.lo>>>7;e[t++]=r.lo}ze.prototype.uint64=function(e){var t=d0.from(e);return this._push(Rm,t.length(),t)};ze.prototype.int64=ze.prototype.uint64;ze.prototype.sint64=function(e){var t=d0.from(e).zzEncode();return this._push(Rm,t.length(),t)};ze.prototype.bool=function(e){return this._push(Sm,1,e?1:0)};function vm(r,e,t){e[t]=r&255,e[t+1]=r>>>8&255,e[t+2]=r>>>16&255,e[t+3]=r>>>24}ze.prototype.fixed32=function(e){return this._push(vm,4,e>>>0)};ze.prototype.sfixed32=ze.prototype.fixed32;ze.prototype.fixed64=function(e){var t=d0.from(e);return this._push(vm,4,t.lo)._push(vm,4,t.hi)};ze.prototype.sfixed64=ze.prototype.fixed64;ze.prototype.float=function(e){return this._push(kn.float.writeFloatLE,4,e)};ze.prototype.double=function(e){return this._push(kn.float.writeDoubleLE,8,e)};var cF=kn.Array.prototype.set?function(e,t,n){t.set(e,n)}:function(e,t,n){for(var s=0;s<e.length;++s)t[n+s]=e[s]};ze.prototype.bytes=function(e){var t=e.length>>>0;if(!t)return this._push(Sm,1,0);if(kn.isString(e)){var n=ze.alloc(t=X9.length(e));X9.decode(e,n,0),e=n}return this.uint32(t)._push(cF,t,e)};ze.prototype.string=function(e){var t=j9.length(e);return t?this.uint32(t)._push(j9.write,t,e):this._push(Sm,1,0)};ze.prototype.fork=function(){return this.states=new oF(this),this.head=this.tail=new Pu(_m,0,0),this.len=0,this};ze.prototype.reset=function(){return this.states?(this.head=this.states.head,this.tail=this.states.tail,this.len=this.states.len,this.states=this.states.next):(this.head=this.tail=new Pu(_m,0,0),this.len=0),this};ze.prototype.ldelim=function(){var e=this.head,t=this.tail,n=this.len;return this.reset().uint32(n),n&&(this.tail.next=e.next,this.tail=t,this.len+=n),this};ze.prototype.finish=function(){for(var e=this.head.next,t=this.constructor.alloc(this.len),n=0;e;)e.fn(e.val,t,n),n+=e.len,e=e.next;return t};ze._configure=function(r){Em=r,ze.create=Z9(),Em._configure()}});var rw=N((sue,tw)=>{"use strict";tw.exports=Rs;var ew=Im();(Rs.prototype=Object.create(ew.prototype)).constructor=Rs;var Ui=Xo();function Rs(){ew.call(this)}Rs._configure=function(){Rs.alloc=Ui._Buffer_allocUnsafe,Rs.writeBytesBuffer=Ui.Buffer&&Ui.Buffer.prototype instanceof Uint8Array&&Ui.Buffer.prototype.set.name==="set"?function(e,t,n){t.set(e,n)}:function(e,t,n){if(e.copy)e.copy(t,n,0,e.length);else for(var s=0;s<e.length;)t[n++]=e[s++]}};Rs.prototype.bytes=function(e){Ui.isString(e)&&(e=Ui._Buffer_from(e,"base64"));var t=e.length>>>0;return this.uint32(t),t&&this._push(Rs.writeBytesBuffer,t,e),this};function lF(r,e,t){r.length<40?Ui.utf8.write(r,e,t):e.utf8Write?e.utf8Write(r,t):e.write(r,t)}Rs.prototype.string=function(e){var t=Ui.Buffer.byteLength(e);return this.uint32(t),t&&this._push(lF,t,e),this};Rs._configure()});var bw=N((Lfe,yw)=>{"use strict";yw.exports=function(){return Date.now()}});var xw=N((Bfe,ww)=>{"use strict";var S0=bw(),Lm=class{constructor(e,t,n){let s=this;this._started=S0(),this._rescheduled=0,this._scheduled=t,this._args=n,this._triggered=!1,this._timerWrapper=()=>{s._rescheduled>0?(s._scheduled=s._rescheduled-(S0()-s._started),s._schedule(s._scheduled)):(s._triggered=!0,e.apply(null,s._args))},this._timer=setTimeout(this._timerWrapper,t)}reschedule(e){e||(e=this._scheduled);let t=S0();t+e-(this._started+this._scheduled)<0?(clearTimeout(this._timer),this._schedule(e)):this._triggered?this._schedule(e):(this._started=t,this._rescheduled=e)}_schedule(e){this._triggered=!1,this._started=S0(),this._rescheduled=0,this._scheduled=e,this._timer=setTimeout(this._timerWrapper,e)}clear(){clearTimeout(this._timer)}};function DF(){if(typeof arguments[0]!="function")throw new Error("callback needed");if(typeof arguments[1]!="number")throw new Error("timeout needed");let r;if(arguments.length>0){r=new Array(arguments.length-2);for(var e=0;e<r.length;e++)r[e]=arguments[e+2]}return new Lm(arguments[0],arguments[1],r)}ww.exports=DF});var _w=N((Mfe,vw)=>{"use strict";var{AbortController:CF}=globalThis,Ew=xw(),Ou=class extends CF{constructor(e){super(),this._ms=e,this._timer=Ew(()=>this.abort(),e),Object.setPrototypeOf(this,Ou.prototype)}abort(){return this._timer.clear(),super.abort()}clear(){this._timer.clear()}reset(){this._timer.clear(),this._timer=Ew(()=>this.abort(),this._ms)}};vw.exports={TimeoutController:Ou}});var fn=N((Yfe,Vm)=>{"use strict";var fc=typeof Reflect=="object"?Reflect:null,Tw=fc&&typeof fc.apply=="function"?fc.apply:function(e,t,n){return Function.prototype.apply.call(e,t,n)},R0;fc&&typeof fc.ownKeys=="function"?R0=fc.ownKeys:Object.getOwnPropertySymbols?R0=function(e){return Object.getOwnPropertyNames(e).concat(Object.getOwnPropertySymbols(e))}:R0=function(e){return Object.getOwnPropertyNames(e)};function LF(r){console&&console.warn&&console.warn(r)}var Cw=Number.isNaN||function(e){return e!==e};function nt(){nt.init.call(this)}Vm.exports=nt;Vm.exports.once=FF;nt.EventEmitter=nt;nt.prototype._events=void 0;nt.prototype._eventsCount=0;nt.prototype._maxListeners=void 0;var Dw=10;function I0(r){if(typeof r!="function")throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof r)}Object.defineProperty(nt,"defaultMaxListeners",{enumerable:!0,get:function(){return Dw},set:function(r){if(typeof r!="number"||r<0||Cw(r))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+r+".");Dw=r}});nt.init=function(){(this._events===void 0||this._events===Object.getPrototypeOf(this)._events)&&(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0};nt.prototype.setMaxListeners=function(e){if(typeof e!="number"||e<0||Cw(e))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+e+".");return this._maxListeners=e,this};function Pw(r){return r._maxListeners===void 0?nt.defaultMaxListeners:r._maxListeners}nt.prototype.getMaxListeners=function(){return Pw(this)};nt.prototype.emit=function(e){for(var t=[],n=1;n<arguments.length;n++)t.push(arguments[n]);var s=e==="error",i=this._events;if(i!==void 0)s=s&&i.error===void 0;else if(!s)return!1;if(s){var o;if(t.length>0&&(o=t[0]),o instanceof Error)throw o;var a=new Error("Unhandled error."+(o?" ("+o.message+")":""));throw a.context=o,a}var c=i[e];if(c===void 0)return!1;if(typeof c=="function")Tw(c,this,t);else for(var l=c.length,u=Bw(c,l),n=0;n<l;++n)Tw(u[n],this,t);return!0};function kw(r,e,t,n){var s,i,o;if(I0(t),i=r._events,i===void 0?(i=r._events=Object.create(null),r._eventsCount=0):(i.newListener!==void 0&&(r.emit("newListener",e,t.listener?t.listener:t),i=r._events),o=i[e]),o===void 0)o=i[e]=t,++r._eventsCount;else if(typeof o=="function"?o=i[e]=n?[t,o]:[o,t]:n?o.unshift(t):o.push(t),s=Pw(r),s>0&&o.length>s&&!o.warned){o.warned=!0;var a=new Error("Possible EventEmitter memory leak detected. "+o.length+" "+String(e)+" listeners added. Use emitter.setMaxListeners() to increase limit");a.name="MaxListenersExceededWarning",a.emitter=r,a.type=e,a.count=o.length,LF(a)}return r}nt.prototype.addListener=function(e,t){return kw(this,e,t,!1)};nt.prototype.on=nt.prototype.addListener;nt.prototype.prependListener=function(e,t){return kw(this,e,t,!0)};function BF(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length===0?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function Nw(r,e,t){var n={fired:!1,wrapFn:void 0,target:r,type:e,listener:t},s=BF.bind(n);return s.listener=t,n.wrapFn=s,s}nt.prototype.once=function(e,t){return I0(t),this.on(e,Nw(this,e,t)),this};nt.prototype.prependOnceListener=function(e,t){return I0(t),this.prependListener(e,Nw(this,e,t)),this};nt.prototype.removeListener=function(e,t){var n,s,i,o,a;if(I0(t),s=this._events,s===void 0)return this;if(n=s[e],n===void 0)return this;if(n===t||n.listener===t)--this._eventsCount===0?this._events=Object.create(null):(delete s[e],s.removeListener&&this.emit("removeListener",e,n.listener||t));else if(typeof n!="function"){for(i=-1,o=n.length-1;o>=0;o--)if(n[o]===t||n[o].listener===t){a=n[o].listener,i=o;break}if(i<0)return this;i===0?n.shift():MF(n,i),n.length===1&&(s[e]=n[0]),s.removeListener!==void 0&&this.emit("removeListener",e,a||t)}return this};nt.prototype.off=nt.prototype.removeListener;nt.prototype.removeAllListeners=function(e){var t,n,s;if(n=this._events,n===void 0)return this;if(n.removeListener===void 0)return arguments.length===0?(this._events=Object.create(null),this._eventsCount=0):n[e]!==void 0&&(--this._eventsCount===0?this._events=Object.create(null):delete n[e]),this;if(arguments.length===0){var i=Object.keys(n),o;for(s=0;s<i.length;++s)o=i[s],o!=="removeListener"&&this.removeAllListeners(o);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if(t=n[e],typeof t=="function")this.removeListener(e,t);else if(t!==void 0)for(s=t.length-1;s>=0;s--)this.removeListener(e,t[s]);return this};function Ow(r,e,t){var n=r._events;if(n===void 0)return[];var s=n[e];return s===void 0?[]:typeof s=="function"?t?[s.listener||s]:[s]:t?UF(s):Bw(s,s.length)}nt.prototype.listeners=function(e){return Ow(this,e,!0)};nt.prototype.rawListeners=function(e){return Ow(this,e,!1)};nt.listenerCount=function(r,e){return typeof r.listenerCount=="function"?r.listenerCount(e):Lw.call(r,e)};nt.prototype.listenerCount=Lw;function Lw(r){var e=this._events;if(e!==void 0){var t=e[r];if(typeof t=="function")return 1;if(t!==void 0)return t.length}return 0}nt.prototype.eventNames=function(){return this._eventsCount>0?R0(this._events):[]};function Bw(r,e){for(var t=new Array(e),n=0;n<e;++n)t[n]=r[n];return t}function MF(r,e){for(;e+1<r.length;e++)r[e]=r[e+1];r.pop()}function UF(r){for(var e=new Array(r.length),t=0;t<e.length;++t)e[t]=r[t].listener||r[t];return e}function FF(r,e){return new Promise(function(t,n){function s(o){r.removeListener(e,i),n(o)}function i(){typeof r.removeListener=="function"&&r.removeListener("error",s),t([].slice.call(arguments))}Mw(r,e,i,{once:!0}),e!=="error"&&VF(r,s,{once:!0})})}function VF(r,e,t){typeof r.on=="function"&&Mw(r,"error",e,t)}function Mw(r,e,t,n){if(typeof r.on=="function")n.once?r.once(e,t):r.on(e,t);else if(typeof r.addEventListener=="function")r.addEventListener(e,function s(i){n.once&&r.removeEventListener(e,s),t(i)});else throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof r)}});var Kw=N((zw,qw)=>{"use strict";var zF=Math.exp;zw=qw.exports=function(e){if(typeof e!="number")throw new Error("must provide a timespan to the moving average constructor");if(e<=0)throw new Error("must provide a timespan > 0 to the moving average constructor");let t,n=0,s=0,i=0,o,a={};function c(l,u){return 1-zF(-(l-u)/e)}return a.push=function(u,f){if(o){let h=c(u,o),p=f-t,d=h*p;t=h*f+(1-h)*t,n=(1-h)*(n+p*d),s=Math.sqrt(n),i=t+h*p}else t=f;o=u},a.movingAverage=function(){return t},a.variance=function(){return n},a.deviation=function(){return s},a.forecast=function(){return i},a}});var bE=N((sde,i3)=>{"use strict";var jV=Object.prototype.hasOwnProperty,kr="~";function Yu(){}Object.create&&(Yu.prototype=Object.create(null),new Yu().__proto__||(kr=!1));function ZV(r,e,t){this.fn=r,this.context=e,this.once=t||!1}function yE(r,e,t,n,s){if(typeof t!="function")throw new TypeError("The listener must be a function");var i=new ZV(t,n||r,s),o=kr?kr+e:e;return r._events[o]?r._events[o].fn?r._events[o]=[r._events[o],i]:r._events[o].push(i):(r._events[o]=i,r._eventsCount++),r}function G0(r,e){--r._eventsCount===0?r._events=new Yu:delete r._events[e]}function vr(){this._events=new Yu,this._eventsCount=0}vr.prototype.eventNames=function(){var e=[],t,n;if(this._eventsCount===0)return e;for(n in t=this._events)jV.call(t,n)&&e.push(kr?n.slice(1):n);return Object.getOwnPropertySymbols?e.concat(Object.getOwnPropertySymbols(t)):e};vr.prototype.listeners=function(e){var t=kr?kr+e:e,n=this._events[t];if(!n)return[];if(n.fn)return[n.fn];for(var s=0,i=n.length,o=new Array(i);s<i;s++)o[s]=n[s].fn;return o};vr.prototype.listenerCount=function(e){var t=kr?kr+e:e,n=this._events[t];return n?n.fn?1:n.length:0};vr.prototype.emit=function(e,t,n,s,i,o){var a=kr?kr+e:e;if(!this._events[a])return!1;var c=this._events[a],l=arguments.length,u,f;if(c.fn){switch(c.once&&this.removeListener(e,c.fn,void 0,!0),l){case 1:return c.fn.call(c.context),!0;case 2:return c.fn.call(c.context,t),!0;case 3:return c.fn.call(c.context,t,n),!0;case 4:return c.fn.call(c.context,t,n,s),!0;case 5:return c.fn.call(c.context,t,n,s,i),!0;case 6:return c.fn.call(c.context,t,n,s,i,o),!0}for(f=1,u=new Array(l-1);f<l;f++)u[f-1]=arguments[f];c.fn.apply(c.context,u)}else{var h=c.length,p;for(f=0;f<h;f++)switch(c[f].once&&this.removeListener(e,c[f].fn,void 0,!0),l){case 1:c[f].fn.call(c[f].context);break;case 2:c[f].fn.call(c[f].context,t);break;case 3:c[f].fn.call(c[f].context,t,n);break;case 4:c[f].fn.call(c[f].context,t,n,s);break;default:if(!u)for(p=1,u=new Array(l-1);p<l;p++)u[p-1]=arguments[p];c[f].fn.apply(c[f].context,u)}}return!0};vr.prototype.on=function(e,t,n){return yE(this,e,t,n,!1)};vr.prototype.once=function(e,t,n){return yE(this,e,t,n,!0)};vr.prototype.removeListener=function(e,t,n,s){var i=kr?kr+e:e;if(!this._events[i])return this;if(!t)return G0(this,i),this;var o=this._events[i];if(o.fn)o.fn===t&&(!s||o.once)&&(!n||o.context===n)&&G0(this,i);else{for(var a=0,c=[],l=o.length;a<l;a++)(o[a].fn!==t||s&&!o[a].once||n&&o[a].context!==n)&&c.push(o[a]);c.length?this._events[i]=c.length===1?c[0]:c:G0(this,i)}return this};vr.prototype.removeAllListeners=function(e){var t;return e?(t=kr?kr+e:e,this._events[t]&&G0(this,t)):(this._events=new Yu,this._eventsCount=0),this};vr.prototype.off=vr.prototype.removeListener;vr.prototype.addListener=vr.prototype.on;vr.prefixed=kr;vr.EventEmitter=vr;typeof i3<"u"&&(i3.exports=vr)});var rt=N((Kpe,ZE)=>{ZE.exports={options:{usePureJavaScript:!1}}});var tv=N(($pe,ev)=>{var T3={};ev.exports=T3;var JE={};T3.encode=function(r,e,t){if(typeof e!="string")throw new TypeError('"alphabet" must be a string.');if(t!==void 0&&typeof t!="number")throw new TypeError('"maxline" must be a number.');var n="";if(!(r instanceof Uint8Array))n=cz(r,e);else{var s=0,i=e.length,o=e.charAt(0),a=[0];for(s=0;s<r.length;++s){for(var c=0,l=r[s];c<a.length;++c)l+=a[c]<<8,a[c]=l%i,l=l/i|0;for(;l>0;)a.push(l%i),l=l/i|0}for(s=0;r[s]===0&&s<r.length-1;++s)n+=o;for(s=a.length-1;s>=0;--s)n+=e[a[s]]}if(t){var u=new RegExp(".{1,"+t+"}","g");n=n.match(u).join(`\r
`)}return n};T3.decode=function(r,e){if(typeof r!="string")throw new TypeError('"input" must be a string.');if(typeof e!="string")throw new TypeError('"alphabet" must be a string.');var t=JE[e];if(!t){t=JE[e]=[];for(var n=0;n<e.length;++n)t[e.charCodeAt(n)]=n}r=r.replace(/\s/g,"");for(var s=e.length,i=e.charAt(0),o=[0],n=0;n<r.length;n++){var a=t[r.charCodeAt(n)];if(a===void 0)return;for(var c=0,l=a;c<o.length;++c)l+=o[c]*s,o[c]=l&255,l>>=8;for(;l>0;)o.push(l&255),l>>=8}for(var u=0;r[u]===i&&u<r.length-1;++u)o.push(0);return typeof Buffer<"u"?Buffer.from(o.reverse()):new Uint8Array(o.reverse())};function cz(r,e){var t=0,n=e.length,s=e.charAt(0),i=[0];for(t=0;t<r.length();++t){for(var o=0,a=r.at(t);o<i.length;++o)a+=i[o]<<8,i[o]=a%n,a=a/n|0;for(;a>0;)i.push(a%n),a=a/n|0}var c="";for(t=0;r.at(t)===0&&t<r.length()-1;++t)c+=s;for(t=i.length-1;t>=0;--t)c+=e[i[t]];return c}});var Ht=N((Hpe,iv)=>{var rv=rt(),nv=tv(),R=iv.exports=rv.util=rv.util||{};(function(){if(typeof process<"u"&&process.nextTick&&!process.browser){R.nextTick=process.nextTick,typeof setImmediate=="function"?R.setImmediate=setImmediate:R.setImmediate=R.nextTick;return}if(typeof setImmediate=="function"){R.setImmediate=function(){return setImmediate.apply(void 0,arguments)},R.nextTick=function(a){return setImmediate(a)};return}if(R.setImmediate=function(a){setTimeout(a,0)},typeof window<"u"&&typeof window.postMessage=="function"){let a=function(c){if(c.source===window&&c.data===r){c.stopPropagation();var l=e.slice();e.length=0,l.forEach(function(u){u()})}};var o=a,r="forge.setImmediate",e=[];R.setImmediate=function(c){e.push(c),e.length===1&&window.postMessage(r,"*")},window.addEventListener("message",a,!0)}if(typeof MutationObserver<"u"){var t=Date.now(),n=!0,s=document.createElement("div"),e=[];new MutationObserver(function(){var c=e.slice();e.length=0,c.forEach(function(l){l()})}).observe(s,{attributes:!0});var i=R.setImmediate;R.setImmediate=function(c){Date.now()-t>15?(t=Date.now(),i(c)):(e.push(c),e.length===1&&s.setAttribute("a",n=!n))}}R.nextTick=R.setImmediate})();R.isNodejs=typeof process<"u"&&process.versions&&process.versions.node;R.globalScope=function(){return R.isNodejs?globalThis:typeof self>"u"?window:self}();R.isArray=Array.isArray||function(r){return Object.prototype.toString.call(r)==="[object Array]"};R.isArrayBuffer=function(r){return typeof ArrayBuffer<"u"&&r instanceof ArrayBuffer};R.isArrayBufferView=function(r){return r&&R.isArrayBuffer(r.buffer)&&r.byteLength!==void 0};function nf(r){if(!(r===8||r===16||r===24||r===32))throw new Error("Only 8, 16, 24, or 32 bits supported: "+r)}R.ByteBuffer=D3;function D3(r){if(this.data="",this.read=0,typeof r=="string")this.data=r;else if(R.isArrayBuffer(r)||R.isArrayBufferView(r))if(typeof Buffer<"u"&&r instanceof Buffer)this.data=r.toString("binary");else{var e=new Uint8Array(r);try{this.data=String.fromCharCode.apply(null,e)}catch{for(var t=0;t<e.length;++t)this.putByte(e[t])}}else(r instanceof D3||typeof r=="object"&&typeof r.data=="string"&&typeof r.read=="number")&&(this.data=r.data,this.read=r.read);this._constructedStringLength=0}R.ByteStringBuffer=D3;var lz=4096;R.ByteStringBuffer.prototype._optimizeConstructedString=function(r){this._constructedStringLength+=r,this._constructedStringLength>lz&&(this.data.substr(0,1),this._constructedStringLength=0)};R.ByteStringBuffer.prototype.length=function(){return this.data.length-this.read};R.ByteStringBuffer.prototype.isEmpty=function(){return this.length()<=0};R.ByteStringBuffer.prototype.putByte=function(r){return this.putBytes(String.fromCharCode(r))};R.ByteStringBuffer.prototype.fillWithByte=function(r,e){r=String.fromCharCode(r);for(var t=this.data;e>0;)e&1&&(t+=r),e>>>=1,e>0&&(r+=r);return this.data=t,this._optimizeConstructedString(e),this};R.ByteStringBuffer.prototype.putBytes=function(r){return this.data+=r,this._optimizeConstructedString(r.length),this};R.ByteStringBuffer.prototype.putString=function(r){return this.putBytes(R.encodeUtf8(r))};R.ByteStringBuffer.prototype.putInt16=function(r){return this.putBytes(String.fromCharCode(r>>8&255)+String.fromCharCode(r&255))};R.ByteStringBuffer.prototype.putInt24=function(r){return this.putBytes(String.fromCharCode(r>>16&255)+String.fromCharCode(r>>8&255)+String.fromCharCode(r&255))};R.ByteStringBuffer.prototype.putInt32=function(r){return this.putBytes(String.fromCharCode(r>>24&255)+String.fromCharCode(r>>16&255)+String.fromCharCode(r>>8&255)+String.fromCharCode(r&255))};R.ByteStringBuffer.prototype.putInt16Le=function(r){return this.putBytes(String.fromCharCode(r&255)+String.fromCharCode(r>>8&255))};R.ByteStringBuffer.prototype.putInt24Le=function(r){return this.putBytes(String.fromCharCode(r&255)+String.fromCharCode(r>>8&255)+String.fromCharCode(r>>16&255))};R.ByteStringBuffer.prototype.putInt32Le=function(r){return this.putBytes(String.fromCharCode(r&255)+String.fromCharCode(r>>8&255)+String.fromCharCode(r>>16&255)+String.fromCharCode(r>>24&255))};R.ByteStringBuffer.prototype.putInt=function(r,e){nf(e);var t="";do e-=8,t+=String.fromCharCode(r>>e&255);while(e>0);return this.putBytes(t)};R.ByteStringBuffer.prototype.putSignedInt=function(r,e){return r<0&&(r+=2<<e-1),this.putInt(r,e)};R.ByteStringBuffer.prototype.putBuffer=function(r){return this.putBytes(r.getBytes())};R.ByteStringBuffer.prototype.getByte=function(){return this.data.charCodeAt(this.read++)};R.ByteStringBuffer.prototype.getInt16=function(){var r=this.data.charCodeAt(this.read)<<8^this.data.charCodeAt(this.read+1);return this.read+=2,r};R.ByteStringBuffer.prototype.getInt24=function(){var r=this.data.charCodeAt(this.read)<<16^this.data.charCodeAt(this.read+1)<<8^this.data.charCodeAt(this.read+2);return this.read+=3,r};R.ByteStringBuffer.prototype.getInt32=function(){var r=this.data.charCodeAt(this.read)<<24^this.data.charCodeAt(this.read+1)<<16^this.data.charCodeAt(this.read+2)<<8^this.data.charCodeAt(this.read+3);return this.read+=4,r};R.ByteStringBuffer.prototype.getInt16Le=function(){var r=this.data.charCodeAt(this.read)^this.data.charCodeAt(this.read+1)<<8;return this.read+=2,r};R.ByteStringBuffer.prototype.getInt24Le=function(){var r=this.data.charCodeAt(this.read)^this.data.charCodeAt(this.read+1)<<8^this.data.charCodeAt(this.read+2)<<16;return this.read+=3,r};R.ByteStringBuffer.prototype.getInt32Le=function(){var r=this.data.charCodeAt(this.read)^this.data.charCodeAt(this.read+1)<<8^this.data.charCodeAt(this.read+2)<<16^this.data.charCodeAt(this.read+3)<<24;return this.read+=4,r};R.ByteStringBuffer.prototype.getInt=function(r){nf(r);var e=0;do e=(e<<8)+this.data.charCodeAt(this.read++),r-=8;while(r>0);return e};R.ByteStringBuffer.prototype.getSignedInt=function(r){var e=this.getInt(r),t=2<<r-2;return e>=t&&(e-=t<<1),e};R.ByteStringBuffer.prototype.getBytes=function(r){var e;return r?(r=Math.min(this.length(),r),e=this.data.slice(this.read,this.read+r),this.read+=r):r===0?e="":(e=this.read===0?this.data:this.data.slice(this.read),this.clear()),e};R.ByteStringBuffer.prototype.bytes=function(r){return typeof r>"u"?this.data.slice(this.read):this.data.slice(this.read,this.read+r)};R.ByteStringBuffer.prototype.at=function(r){return this.data.charCodeAt(this.read+r)};R.ByteStringBuffer.prototype.setAt=function(r,e){return this.data=this.data.substr(0,this.read+r)+String.fromCharCode(e)+this.data.substr(this.read+r+1),this};R.ByteStringBuffer.prototype.last=function(){return this.data.charCodeAt(this.data.length-1)};R.ByteStringBuffer.prototype.copy=function(){var r=R.createBuffer(this.data);return r.read=this.read,r};R.ByteStringBuffer.prototype.compact=function(){return this.read>0&&(this.data=this.data.slice(this.read),this.read=0),this};R.ByteStringBuffer.prototype.clear=function(){return this.data="",this.read=0,this};R.ByteStringBuffer.prototype.truncate=function(r){var e=Math.max(0,this.length()-r);return this.data=this.data.substr(this.read,e),this.read=0,this};R.ByteStringBuffer.prototype.toHex=function(){for(var r="",e=this.read;e<this.data.length;++e){var t=this.data.charCodeAt(e);t<16&&(r+="0"),r+=t.toString(16)}return r};R.ByteStringBuffer.prototype.toString=function(){return R.decodeUtf8(this.bytes())};function uz(r,e){e=e||{},this.read=e.readOffset||0,this.growSize=e.growSize||1024;var t=R.isArrayBuffer(r),n=R.isArrayBufferView(r);if(t||n){t?this.data=new DataView(r):this.data=new DataView(r.buffer,r.byteOffset,r.byteLength),this.write="writeOffset"in e?e.writeOffset:this.data.byteLength;return}this.data=new DataView(new ArrayBuffer(0)),this.write=0,r!=null&&this.putBytes(r),"writeOffset"in e&&(this.write=e.writeOffset)}R.DataBuffer=uz;R.DataBuffer.prototype.length=function(){return this.write-this.read};R.DataBuffer.prototype.isEmpty=function(){return this.length()<=0};R.DataBuffer.prototype.accommodate=function(r,e){if(this.length()>=r)return this;e=Math.max(e||this.growSize,r);var t=new Uint8Array(this.data.buffer,this.data.byteOffset,this.data.byteLength),n=new Uint8Array(this.length()+e);return n.set(t),this.data=new DataView(n.buffer),this};R.DataBuffer.prototype.putByte=function(r){return this.accommodate(1),this.data.setUint8(this.write++,r),this};R.DataBuffer.prototype.fillWithByte=function(r,e){this.accommodate(e);for(var t=0;t<e;++t)this.data.setUint8(r);return this};R.DataBuffer.prototype.putBytes=function(r,e){if(R.isArrayBufferView(r)){var t=new Uint8Array(r.buffer,r.byteOffset,r.byteLength),n=t.byteLength-t.byteOffset;this.accommodate(n);var s=new Uint8Array(this.data.buffer,this.write);return s.set(t),this.write+=n,this}if(R.isArrayBuffer(r)){var t=new Uint8Array(r);this.accommodate(t.byteLength);var s=new Uint8Array(this.data.buffer);return s.set(t,this.write),this.write+=t.byteLength,this}if(r instanceof R.DataBuffer||typeof r=="object"&&typeof r.read=="number"&&typeof r.write=="number"&&R.isArrayBufferView(r.data)){var t=new Uint8Array(r.data.byteLength,r.read,r.length());this.accommodate(t.byteLength);var s=new Uint8Array(r.data.byteLength,this.write);return s.set(t),this.write+=t.byteLength,this}if(r instanceof R.ByteStringBuffer&&(r=r.data,e="binary"),e=e||"binary",typeof r=="string"){var i;if(e==="hex")return this.accommodate(Math.ceil(r.length/2)),i=new Uint8Array(this.data.buffer,this.write),this.write+=R.binary.hex.decode(r,i,this.write),this;if(e==="base64")return this.accommodate(Math.ceil(r.length/4)*3),i=new Uint8Array(this.data.buffer,this.write),this.write+=R.binary.base64.decode(r,i,this.write),this;if(e==="utf8"&&(r=R.encodeUtf8(r),e="binary"),e==="binary"||e==="raw")return this.accommodate(r.length),i=new Uint8Array(this.data.buffer,this.write),this.write+=R.binary.raw.decode(i),this;if(e==="utf16")return this.accommodate(r.length*2),i=new Uint16Array(this.data.buffer,this.write),this.write+=R.text.utf16.encode(i),this;throw new Error("Invalid encoding: "+e)}throw Error("Invalid parameter: "+r)};R.DataBuffer.prototype.putBuffer=function(r){return this.putBytes(r),r.clear(),this};R.DataBuffer.prototype.putString=function(r){return this.putBytes(r,"utf16")};R.DataBuffer.prototype.putInt16=function(r){return this.accommodate(2),this.data.setInt16(this.write,r),this.write+=2,this};R.DataBuffer.prototype.putInt24=function(r){return this.accommodate(3),this.data.setInt16(this.write,r>>8&65535),this.data.setInt8(this.write,r>>16&255),this.write+=3,this};R.DataBuffer.prototype.putInt32=function(r){return this.accommodate(4),this.data.setInt32(this.write,r),this.write+=4,this};R.DataBuffer.prototype.putInt16Le=function(r){return this.accommodate(2),this.data.setInt16(this.write,r,!0),this.write+=2,this};R.DataBuffer.prototype.putInt24Le=function(r){return this.accommodate(3),this.data.setInt8(this.write,r>>16&255),this.data.setInt16(this.write,r>>8&65535,!0),this.write+=3,this};R.DataBuffer.prototype.putInt32Le=function(r){return this.accommodate(4),this.data.setInt32(this.write,r,!0),this.write+=4,this};R.DataBuffer.prototype.putInt=function(r,e){nf(e),this.accommodate(e/8);do e-=8,this.data.setInt8(this.write++,r>>e&255);while(e>0);return this};R.DataBuffer.prototype.putSignedInt=function(r,e){return nf(e),this.accommodate(e/8),r<0&&(r+=2<<e-1),this.putInt(r,e)};R.DataBuffer.prototype.getByte=function(){return this.data.getInt8(this.read++)};R.DataBuffer.prototype.getInt16=function(){var r=this.data.getInt16(this.read);return this.read+=2,r};R.DataBuffer.prototype.getInt24=function(){var r=this.data.getInt16(this.read)<<8^this.data.getInt8(this.read+2);return this.read+=3,r};R.DataBuffer.prototype.getInt32=function(){var r=this.data.getInt32(this.read);return this.read+=4,r};R.DataBuffer.prototype.getInt16Le=function(){var r=this.data.getInt16(this.read,!0);return this.read+=2,r};R.DataBuffer.prototype.getInt24Le=function(){var r=this.data.getInt8(this.read)^this.data.getInt16(this.read+1,!0)<<8;return this.read+=3,r};R.DataBuffer.prototype.getInt32Le=function(){var r=this.data.getInt32(this.read,!0);return this.read+=4,r};R.DataBuffer.prototype.getInt=function(r){nf(r);var e=0;do e=(e<<8)+this.data.getInt8(this.read++),r-=8;while(r>0);return e};R.DataBuffer.prototype.getSignedInt=function(r){var e=this.getInt(r),t=2<<r-2;return e>=t&&(e-=t<<1),e};R.DataBuffer.prototype.getBytes=function(r){var e;return r?(r=Math.min(this.length(),r),e=this.data.slice(this.read,this.read+r),this.read+=r):r===0?e="":(e=this.read===0?this.data:this.data.slice(this.read),this.clear()),e};R.DataBuffer.prototype.bytes=function(r){return typeof r>"u"?this.data.slice(this.read):this.data.slice(this.read,this.read+r)};R.DataBuffer.prototype.at=function(r){return this.data.getUint8(this.read+r)};R.DataBuffer.prototype.setAt=function(r,e){return this.data.setUint8(r,e),this};R.DataBuffer.prototype.last=function(){return this.data.getUint8(this.write-1)};R.DataBuffer.prototype.copy=function(){return new R.DataBuffer(this)};R.DataBuffer.prototype.compact=function(){if(this.read>0){var r=new Uint8Array(this.data.buffer,this.read),e=new Uint8Array(r.byteLength);e.set(r),this.data=new DataView(e),this.write-=this.read,this.read=0}return this};R.DataBuffer.prototype.clear=function(){return this.data=new DataView(new ArrayBuffer(0)),this.read=this.write=0,this};R.DataBuffer.prototype.truncate=function(r){return this.write=Math.max(0,this.length()-r),this.read=Math.min(this.read,this.write),this};R.DataBuffer.prototype.toHex=function(){for(var r="",e=this.read;e<this.data.byteLength;++e){var t=this.data.getUint8(e);t<16&&(r+="0"),r+=t.toString(16)}return r};R.DataBuffer.prototype.toString=function(r){var e=new Uint8Array(this.data,this.read,this.length());if(r=r||"utf8",r==="binary"||r==="raw")return R.binary.raw.encode(e);if(r==="hex")return R.binary.hex.encode(e);if(r==="base64")return R.binary.base64.encode(e);if(r==="utf8")return R.text.utf8.decode(e);if(r==="utf16")return R.text.utf16.decode(e);throw new Error("Invalid encoding: "+r)};R.createBuffer=function(r,e){return e=e||"raw",r!==void 0&&e==="utf8"&&(r=R.encodeUtf8(r)),new R.ByteBuffer(r)};R.fillString=function(r,e){for(var t="";e>0;)e&1&&(t+=r),e>>>=1,e>0&&(r+=r);return t};R.xorBytes=function(r,e,t){for(var n="",s="",i="",o=0,a=0;t>0;--t,++o)s=r.charCodeAt(o)^e.charCodeAt(o),a>=10&&(n+=i,i="",a=0),i+=String.fromCharCode(s),++a;return n+=i,n};R.hexToBytes=function(r){var e="",t=0;for(r.length&!0&&(t=1,e+=String.fromCharCode(parseInt(r[0],16)));t<r.length;t+=2)e+=String.fromCharCode(parseInt(r.substr(t,2),16));return e};R.bytesToHex=function(r){return R.createBuffer(r).toHex()};R.int32ToBytes=function(r){return String.fromCharCode(r>>24&255)+String.fromCharCode(r>>16&255)+String.fromCharCode(r>>8&255)+String.fromCharCode(r&255)};var Wi="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",Yi=[62,-1,-1,-1,63,52,53,54,55,56,57,58,59,60,61,-1,-1,-1,64,-1,-1,-1,0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,-1,-1,-1,-1,-1,-1,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51],sv="123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz";R.encode64=function(r,e){for(var t="",n="",s,i,o,a=0;a<r.length;)s=r.charCodeAt(a++),i=r.charCodeAt(a++),o=r.charCodeAt(a++),t+=Wi.charAt(s>>2),t+=Wi.charAt((s&3)<<4|i>>4),isNaN(i)?t+="==":(t+=Wi.charAt((i&15)<<2|o>>6),t+=isNaN(o)?"=":Wi.charAt(o&63)),e&&t.length>e&&(n+=t.substr(0,e)+`\r
`,t=t.substr(e));return n+=t,n};R.decode64=function(r){r=r.replace(/[^A-Za-z0-9\+\/\=]/g,"");for(var e="",t,n,s,i,o=0;o<r.length;)t=Yi[r.charCodeAt(o++)-43],n=Yi[r.charCodeAt(o++)-43],s=Yi[r.charCodeAt(o++)-43],i=Yi[r.charCodeAt(o++)-43],e+=String.fromCharCode(t<<2|n>>4),s!==64&&(e+=String.fromCharCode((n&15)<<4|s>>2),i!==64&&(e+=String.fromCharCode((s&3)<<6|i)));return e};R.encodeUtf8=function(r){return unescape(encodeURIComponent(r))};R.decodeUtf8=function(r){return decodeURIComponent(escape(r))};R.binary={raw:{},hex:{},base64:{},base58:{},baseN:{encode:nv.encode,decode:nv.decode}};R.binary.raw.encode=function(r){return String.fromCharCode.apply(null,r)};R.binary.raw.decode=function(r,e,t){var n=e;n||(n=new Uint8Array(r.length)),t=t||0;for(var s=t,i=0;i<r.length;++i)n[s++]=r.charCodeAt(i);return e?s-t:n};R.binary.hex.encode=R.bytesToHex;R.binary.hex.decode=function(r,e,t){var n=e;n||(n=new Uint8Array(Math.ceil(r.length/2))),t=t||0;var s=0,i=t;for(r.length&1&&(s=1,n[i++]=parseInt(r[0],16));s<r.length;s+=2)n[i++]=parseInt(r.substr(s,2),16);return e?i-t:n};R.binary.base64.encode=function(r,e){for(var t="",n="",s,i,o,a=0;a<r.byteLength;)s=r[a++],i=r[a++],o=r[a++],t+=Wi.charAt(s>>2),t+=Wi.charAt((s&3)<<4|i>>4),isNaN(i)?t+="==":(t+=Wi.charAt((i&15)<<2|o>>6),t+=isNaN(o)?"=":Wi.charAt(o&63)),e&&t.length>e&&(n+=t.substr(0,e)+`\r
`,t=t.substr(e));return n+=t,n};R.binary.base64.decode=function(r,e,t){var n=e;n||(n=new Uint8Array(Math.ceil(r.length/4)*3)),r=r.replace(/[^A-Za-z0-9\+\/\=]/g,""),t=t||0;for(var s,i,o,a,c=0,l=t;c<r.length;)s=Yi[r.charCodeAt(c++)-43],i=Yi[r.charCodeAt(c++)-43],o=Yi[r.charCodeAt(c++)-43],a=Yi[r.charCodeAt(c++)-43],n[l++]=s<<2|i>>4,o!==64&&(n[l++]=(i&15)<<4|o>>2,a!==64&&(n[l++]=(o&3)<<6|a));return e?l-t:n.subarray(0,l)};R.binary.base58.encode=function(r,e){return R.binary.baseN.encode(r,sv,e)};R.binary.base58.decode=function(r,e){return R.binary.baseN.decode(r,sv,e)};R.text={utf8:{},utf16:{}};R.text.utf8.encode=function(r,e,t){r=R.encodeUtf8(r);var n=e;n||(n=new Uint8Array(r.length)),t=t||0;for(var s=t,i=0;i<r.length;++i)n[s++]=r.charCodeAt(i);return e?s-t:n};R.text.utf8.decode=function(r){return R.decodeUtf8(String.fromCharCode.apply(null,r))};R.text.utf16.encode=function(r,e,t){var n=e;n||(n=new Uint8Array(r.length*2));var s=new Uint16Array(n.buffer);t=t||0;for(var i=t,o=t,a=0;a<r.length;++a)s[o++]=r.charCodeAt(a),i+=2;return e?i-t:n};R.text.utf16.decode=function(r){return String.fromCharCode.apply(null,new Uint16Array(r.buffer))};R.deflate=function(r,e,t){if(e=R.decode64(r.deflate(R.encode64(e)).rval),t){var n=2,s=e.charCodeAt(1);s&32&&(n=6),e=e.substring(n,e.length-4)}return e};R.inflate=function(r,e,t){var n=r.inflate(R.encode64(e)).rval;return n===null?null:R.decode64(n)};var C3=function(r,e,t){if(!r)throw new Error("WebStorage not available.");var n;if(t===null?n=r.removeItem(e):(t=R.encode64(JSON.stringify(t)),n=r.setItem(e,t)),typeof n<"u"&&n.rval!==!0){var s=new Error(n.error.message);throw s.id=n.error.id,s.name=n.error.name,s}},P3=function(r,e){if(!r)throw new Error("WebStorage not available.");var t=r.getItem(e);if(r.init)if(t.rval===null){if(t.error){var n=new Error(t.error.message);throw n.id=t.error.id,n.name=t.error.name,n}t=null}else t=t.rval;return t!==null&&(t=JSON.parse(R.decode64(t))),t},fz=function(r,e,t,n){var s=P3(r,e);s===null&&(s={}),s[t]=n,C3(r,e,s)},hz=function(r,e,t){var n=P3(r,e);return n!==null&&(n=t in n?n[t]:null),n},dz=function(r,e,t){var n=P3(r,e);if(n!==null&&t in n){delete n[t];var s=!0;for(var i in n){s=!1;break}s&&(n=null),C3(r,e,n)}},pz=function(r,e){C3(r,e,null)},od=function(r,e,t){var n=null;typeof t>"u"&&(t=["web","flash"]);var s,i=!1,o=null;for(var a in t){s=t[a];try{if(s==="flash"||s==="both"){if(e[0]===null)throw new Error("Flash local storage not available.");n=r.apply(this,e),i=s==="flash"}(s==="web"||s==="both")&&(e[0]=localStorage,n=r.apply(this,e),i=!0)}catch(c){o=c}if(i)break}if(!i)throw o;return n};R.setItem=function(r,e,t,n,s){od(fz,arguments,s)};R.getItem=function(r,e,t,n){return od(hz,arguments,n)};R.removeItem=function(r,e,t,n){od(dz,arguments,n)};R.clearItems=function(r,e,t){od(pz,arguments,t)};R.isEmpty=function(r){for(var e in r)if(r.hasOwnProperty(e))return!1;return!0};R.format=function(r){for(var e=/%./g,t,n,s=0,i=[],o=0;t=e.exec(r);){n=r.substring(o,e.lastIndex-2),n.length>0&&i.push(n),o=e.lastIndex;var a=t[0][1];switch(a){case"s":case"o":s<arguments.length?i.push(arguments[s+++1]):i.push("<?>");break;case"%":i.push("%");break;default:i.push("<%"+a+"?>")}}return i.push(r.substring(o)),i.join("")};R.formatNumber=function(r,e,t,n){var s=r,i=isNaN(e=Math.abs(e))?2:e,o=t===void 0?",":t,a=n===void 0?".":n,c=s<0?"-":"",l=parseInt(s=Math.abs(+s||0).toFixed(i),10)+"",u=l.length>3?l.length%3:0;return c+(u?l.substr(0,u)+a:"")+l.substr(u).replace(/(\d{3})(?=\d)/g,"$1"+a)+(i?o+Math.abs(s-l).toFixed(i).slice(2):"")};R.formatSize=function(r){return r>=1073741824?r=R.formatNumber(r/1073741824,2,".","")+" GiB":r>=1048576?r=R.formatNumber(r/1048576,2,".","")+" MiB":r>=1024?r=R.formatNumber(r/1024,0)+" KiB":r=R.formatNumber(r,0)+" bytes",r};R.bytesFromIP=function(r){return r.indexOf(".")!==-1?R.bytesFromIPv4(r):r.indexOf(":")!==-1?R.bytesFromIPv6(r):null};R.bytesFromIPv4=function(r){if(r=r.split("."),r.length!==4)return null;for(var e=R.createBuffer(),t=0;t<r.length;++t){var n=parseInt(r[t],10);if(isNaN(n))return null;e.putByte(n)}return e.getBytes()};R.bytesFromIPv6=function(r){var e=0;r=r.split(":").filter(function(o){return o.length===0&&++e,!0});for(var t=(8-r.length+e)*2,n=R.createBuffer(),s=0;s<8;++s){if(!r[s]||r[s].length===0){n.fillWithByte(0,t),t=0;continue}var i=R.hexToBytes(r[s]);i.length<2&&n.putByte(0),n.putBytes(i)}return n.getBytes()};R.bytesToIP=function(r){return r.length===4?R.bytesToIPv4(r):r.length===16?R.bytesToIPv6(r):null};R.bytesToIPv4=function(r){if(r.length!==4)return null;for(var e=[],t=0;t<r.length;++t)e.push(r.charCodeAt(t));return e.join(".")};R.bytesToIPv6=function(r){if(r.length!==16)return null;for(var e=[],t=[],n=0,s=0;s<r.length;s+=2){for(var i=R.bytesToHex(r[s]+r[s+1]);i[0]==="0"&&i!=="0";)i=i.substr(1);if(i==="0"){var o=t[t.length-1],a=e.length;!o||a!==o.end+1?t.push({start:a,end:a}):(o.end=a,o.end-o.start>t[n].end-t[n].start&&(n=t.length-1))}e.push(i)}if(t.length>0){var c=t[n];c.end-c.start>0&&(e.splice(c.start,c.end-c.start+1,""),c.start===0&&e.unshift(""),c.end===7&&e.push(""))}return e.join(":")};R.estimateCores=function(r,e){if(typeof r=="function"&&(e=r,r={}),r=r||{},"cores"in R&&!r.update)return e(null,R.cores);if(typeof navigator<"u"&&"hardwareConcurrency"in navigator&&navigator.hardwareConcurrency>0)return R.cores=navigator.hardwareConcurrency,e(null,R.cores);if(typeof Worker>"u")return R.cores=1,e(null,R.cores);if(typeof Blob>"u")return R.cores=2,e(null,R.cores);var t=URL.createObjectURL(new Blob(["(",function(){self.addEventListener("message",function(o){for(var a=Date.now(),c=a+4;Date.now()<c;);self.postMessage({st:a,et:c})})}.toString(),")()"],{type:"application/javascript"}));n([],5,16);function n(o,a,c){if(a===0){var l=Math.floor(o.reduce(function(u,f){return u+f},0)/o.length);return R.cores=Math.max(1,l),URL.revokeObjectURL(t),e(null,R.cores)}s(c,function(u,f){o.push(i(c,f)),n(o,a-1,c)})}function s(o,a){for(var c=[],l=[],u=0;u<o;++u){var f=new Worker(t);f.addEventListener("message",function(h){if(l.push(h.data),l.length===o){for(var p=0;p<o;++p)c[p].terminate();a(null,l)}}),c.push(f)}for(var u=0;u<o;++u)c[u].postMessage(u)}function i(o,a){for(var c=[],l=0;l<o;++l)for(var u=a[l],f=c[l]=[],h=0;h<o;++h)if(l!==h){var p=a[h];(u.st>p.st&&u.st<p.et||p.st>u.st&&p.st<u.et)&&f.push(h)}return c.reduce(function(d,m){return Math.max(d,m.length)},0)}}});var ad=N((Gpe,ov)=>{var sf=rt();sf.pki=sf.pki||{};var k3=ov.exports=sf.pki.oids=sf.oids=sf.oids||{};function B(r,e){k3[r]=e,k3[e]=r}function et(r,e){k3[r]=e}B("1.2.840.113549.1.1.1","rsaEncryption");B("1.2.840.113549.1.1.4","md5WithRSAEncryption");B("1.2.840.113549.1.1.5","sha1WithRSAEncryption");B("1.2.840.113549.1.1.7","RSAES-OAEP");B("1.2.840.113549.1.1.8","mgf1");B("1.2.840.113549.1.1.9","pSpecified");B("1.2.840.113549.1.1.10","RSASSA-PSS");B("1.2.840.113549.1.1.11","sha256WithRSAEncryption");B("1.2.840.113549.1.1.12","sha384WithRSAEncryption");B("1.2.840.113549.1.1.13","sha512WithRSAEncryption");B("1.3.101.112","EdDSA25519");B("1.2.840.10040.4.3","dsa-with-sha1");B("1.3.14.3.2.7","desCBC");B("1.3.14.3.2.26","sha1");B("1.3.14.3.2.29","sha1WithRSASignature");B("2.16.840.1.101.3.4.2.1","sha256");B("2.16.840.1.101.3.4.2.2","sha384");B("2.16.840.1.101.3.4.2.3","sha512");B("2.16.840.1.101.3.4.2.4","sha224");B("2.16.840.1.101.3.4.2.5","sha512-224");B("2.16.840.1.101.3.4.2.6","sha512-256");B("1.2.840.113549.2.2","md2");B("1.2.840.113549.2.5","md5");B("1.2.840.113549.1.7.1","data");B("1.2.840.113549.1.7.2","signedData");B("1.2.840.113549.1.7.3","envelopedData");B("1.2.840.113549.1.7.4","signedAndEnvelopedData");B("1.2.840.113549.1.7.5","digestedData");B("1.2.840.113549.1.7.6","encryptedData");B("1.2.840.113549.1.9.1","emailAddress");B("1.2.840.113549.1.9.2","unstructuredName");B("1.2.840.113549.1.9.3","contentType");B("1.2.840.113549.1.9.4","messageDigest");B("1.2.840.113549.1.9.5","signingTime");B("1.2.840.113549.1.9.6","counterSignature");B("1.2.840.113549.1.9.7","challengePassword");B("1.2.840.113549.1.9.8","unstructuredAddress");B("1.2.840.113549.1.9.14","extensionRequest");B("1.2.840.113549.1.9.20","friendlyName");B("1.2.840.113549.1.9.21","localKeyId");B("1.2.840.113549.1.9.22.1","x509Certificate");B("1.2.840.113549.1.12.10.1.1","keyBag");B("1.2.840.113549.1.12.10.1.2","pkcs8ShroudedKeyBag");B("1.2.840.113549.1.12.10.1.3","certBag");B("1.2.840.113549.1.12.10.1.4","crlBag");B("1.2.840.113549.1.12.10.1.5","secretBag");B("1.2.840.113549.1.12.10.1.6","safeContentsBag");B("1.2.840.113549.1.5.13","pkcs5PBES2");B("1.2.840.113549.1.5.12","pkcs5PBKDF2");B("1.2.840.113549.1.12.1.1","pbeWithSHAAnd128BitRC4");B("1.2.840.113549.1.12.1.2","pbeWithSHAAnd40BitRC4");B("1.2.840.113549.1.12.1.3","pbeWithSHAAnd3-KeyTripleDES-CBC");B("1.2.840.113549.1.12.1.4","pbeWithSHAAnd2-KeyTripleDES-CBC");B("1.2.840.113549.1.12.1.5","pbeWithSHAAnd128BitRC2-CBC");B("1.2.840.113549.1.12.1.6","pbewithSHAAnd40BitRC2-CBC");B("1.2.840.113549.2.7","hmacWithSHA1");B("1.2.840.113549.2.8","hmacWithSHA224");B("1.2.840.113549.2.9","hmacWithSHA256");B("1.2.840.113549.2.10","hmacWithSHA384");B("1.2.840.113549.2.11","hmacWithSHA512");B("1.2.840.113549.3.7","des-EDE3-CBC");B("2.16.840.1.101.3.4.1.2","aes128-CBC");B("2.16.840.1.101.3.4.1.22","aes192-CBC");B("2.16.840.1.101.3.4.1.42","aes256-CBC");B("2.5.4.3","commonName");B("2.5.4.4","surname");B("2.5.4.5","serialNumber");B("2.5.4.6","countryName");B("2.5.4.7","localityName");B("2.5.4.8","stateOrProvinceName");B("2.5.4.9","streetAddress");B("2.5.4.10","organizationName");B("2.5.4.11","organizationalUnitName");B("2.5.4.12","title");B("2.5.4.13","description");B("2.5.4.15","businessCategory");B("2.5.4.17","postalCode");B("2.5.4.42","givenName");B("1.3.6.1.4.1.311.60.2.1.2","jurisdictionOfIncorporationStateOrProvinceName");B("1.3.6.1.4.1.311.60.2.1.3","jurisdictionOfIncorporationCountryName");B("2.16.840.1.113730.1.1","nsCertType");B("2.16.840.1.113730.1.13","nsComment");et("2.5.29.1","authorityKeyIdentifier");et("2.5.29.2","keyAttributes");et("2.5.29.3","certificatePolicies");et("2.5.29.4","keyUsageRestriction");et("2.5.29.5","policyMapping");et("2.5.29.6","subtreesConstraint");et("2.5.29.7","subjectAltName");et("2.5.29.8","issuerAltName");et("2.5.29.9","subjectDirectoryAttributes");et("2.5.29.10","basicConstraints");et("2.5.29.11","nameConstraints");et("2.5.29.12","policyConstraints");et("2.5.29.13","basicConstraints");B("2.5.29.14","subjectKeyIdentifier");B("2.5.29.15","keyUsage");et("2.5.29.16","privateKeyUsagePeriod");B("2.5.29.17","subjectAltName");B("2.5.29.18","issuerAltName");B("2.5.29.19","basicConstraints");et("2.5.29.20","cRLNumber");et("2.5.29.21","cRLReason");et("2.5.29.22","expirationDate");et("2.5.29.23","instructionCode");et("2.5.29.24","invalidityDate");et("2.5.29.25","cRLDistributionPoints");et("2.5.29.26","issuingDistributionPoint");et("2.5.29.27","deltaCRLIndicator");et("2.5.29.28","issuingDistributionPoint");et("2.5.29.29","certificateIssuer");et("2.5.29.30","nameConstraints");B("2.5.29.31","cRLDistributionPoints");B("2.5.29.32","certificatePolicies");et("2.5.29.33","policyMappings");et("2.5.29.34","policyConstraints");B("2.5.29.35","authorityKeyIdentifier");et("2.5.29.36","policyConstraints");B("2.5.29.37","extKeyUsage");et("2.5.29.46","freshestCRL");et("2.5.29.54","inhibitAnyPolicy");B("1.3.6.1.4.1.11129.2.4.2","timestampList");B("1.3.6.1.5.5.7.1.1","authorityInfoAccess");B("1.3.6.1.5.5.7.3.1","serverAuth");B("1.3.6.1.5.5.7.3.2","clientAuth");B("1.3.6.1.5.5.7.3.3","codeSigning");B("1.3.6.1.5.5.7.3.4","emailProtection");B("1.3.6.1.5.5.7.3.8","timeStamping")});var af=N((Wpe,cv)=>{var lt=rt();Ht();ad();var G=cv.exports=lt.asn1=lt.asn1||{};G.Class={UNIVERSAL:0,APPLICATION:64,CONTEXT_SPECIFIC:128,PRIVATE:192};G.Type={NONE:0,BOOLEAN:1,INTEGER:2,BITSTRING:3,OCTETSTRING:4,NULL:5,OID:6,ODESC:7,EXTERNAL:8,REAL:9,ENUMERATED:10,EMBEDDED:11,UTF8:12,ROID:13,SEQUENCE:16,SET:17,PRINTABLESTRING:19,IA5STRING:22,UTCTIME:23,GENERALIZEDTIME:24,BMPSTRING:30};G.create=function(r,e,t,n,s){if(lt.util.isArray(n)){for(var i=[],o=0;o<n.length;++o)n[o]!==void 0&&i.push(n[o]);n=i}var a={tagClass:r,type:e,constructed:t,composed:t||lt.util.isArray(n),value:n};return s&&"bitStringContents"in s&&(a.bitStringContents=s.bitStringContents,a.original=G.copy(a)),a};G.copy=function(r,e){var t;if(lt.util.isArray(r)){t=[];for(var n=0;n<r.length;++n)t.push(G.copy(r[n],e));return t}return typeof r=="string"?r:(t={tagClass:r.tagClass,type:r.type,constructed:r.constructed,composed:r.composed,value:G.copy(r.value,e)},e&&!e.excludeBitStringContents&&(t.bitStringContents=r.bitStringContents),t)};G.equals=function(r,e,t){if(lt.util.isArray(r)){if(!lt.util.isArray(e)||r.length!==e.length)return!1;for(var n=0;n<r.length;++n)if(!G.equals(r[n],e[n]))return!1;return!0}if(typeof r!=typeof e)return!1;if(typeof r=="string")return r===e;var s=r.tagClass===e.tagClass&&r.type===e.type&&r.constructed===e.constructed&&r.composed===e.composed&&G.equals(r.value,e.value);return t&&t.includeBitStringContents&&(s=s&&r.bitStringContents===e.bitStringContents),s};G.getBerValueLength=function(r){var e=r.getByte();if(e!==128){var t,n=e&128;return n?t=r.getInt((e&127)<<3):t=e,t}};function of(r,e,t){if(t>e){var n=new Error("Too few bytes to parse DER.");throw n.available=r.length(),n.remaining=e,n.requested=t,n}}var mz=function(r,e){var t=r.getByte();if(e--,t!==128){var n,s=t&128;if(!s)n=t;else{var i=t&127;of(r,e,i),n=r.getInt(i<<3)}if(n<0)throw new Error("Negative length: "+n);return n}};G.fromDer=function(r,e){e===void 0&&(e={strict:!0,parseAllBytes:!0,decodeBitStrings:!0}),typeof e=="boolean"&&(e={strict:e,parseAllBytes:!0,decodeBitStrings:!0}),"strict"in e||(e.strict=!0),"parseAllBytes"in e||(e.parseAllBytes=!0),"decodeBitStrings"in e||(e.decodeBitStrings=!0),typeof r=="string"&&(r=lt.util.createBuffer(r));var t=r.length(),n=cd(r,r.length(),0,e);if(e.parseAllBytes&&r.length()!==0){var s=new Error("Unparsed DER bytes remain after ASN.1 parsing.");throw s.byteCount=t,s.remaining=r.length(),s}return n};function cd(r,e,t,n){var s;of(r,e,2);var i=r.getByte();e--;var o=i&192,a=i&31;s=r.length();var c=mz(r,e);if(e-=s-r.length(),c!==void 0&&c>e){if(n.strict){var l=new Error("Too few bytes to read ASN.1 value.");throw l.available=r.length(),l.remaining=e,l.requested=c,l}c=e}var u,f,h=(i&32)===32;if(h)if(u=[],c===void 0)for(;;){if(of(r,e,2),r.bytes(2)===String.fromCharCode(0,0)){r.getBytes(2),e-=2;break}s=r.length(),u.push(cd(r,e,t+1,n)),e-=s-r.length()}else for(;c>0;)s=r.length(),u.push(cd(r,c,t+1,n)),e-=s-r.length(),c-=s-r.length();if(u===void 0&&o===G.Class.UNIVERSAL&&a===G.Type.BITSTRING&&(f=r.bytes(c)),u===void 0&&n.decodeBitStrings&&o===G.Class.UNIVERSAL&&a===G.Type.BITSTRING&&c>1){var p=r.read,d=e,m=0;if(a===G.Type.BITSTRING&&(of(r,e,1),m=r.getByte(),e--),m===0)try{s=r.length();var g={strict:!0,decodeBitStrings:!0},y=cd(r,e,t+1,g),b=s-r.length();e-=b,a==G.Type.BITSTRING&&b++;var w=y.tagClass;b===c&&(w===G.Class.UNIVERSAL||w===G.Class.CONTEXT_SPECIFIC)&&(u=[y])}catch{}u===void 0&&(r.read=p,e=d)}if(u===void 0){if(c===void 0){if(n.strict)throw new Error("Non-constructed ASN.1 object of indefinite length.");c=e}if(a===G.Type.BMPSTRING)for(u="";c>0;c-=2)of(r,e,2),u+=String.fromCharCode(r.getInt16()),e-=2;else u=r.getBytes(c),e-=c}var v=f===void 0?null:{bitStringContents:f};return G.create(o,a,h,u,v)}G.toDer=function(r){var e=lt.util.createBuffer(),t=r.tagClass|r.type,n=lt.util.createBuffer(),s=!1;if("bitStringContents"in r&&(s=!0,r.original&&(s=G.equals(r,r.original))),s)n.putBytes(r.bitStringContents);else if(r.composed){r.constructed?t|=32:n.putByte(0);for(var i=0;i<r.value.length;++i)r.value[i]!==void 0&&n.putBuffer(G.toDer(r.value[i]))}else if(r.type===G.Type.BMPSTRING)for(var i=0;i<r.value.length;++i)n.putInt16(r.value.charCodeAt(i));else r.type===G.Type.INTEGER&&r.value.length>1&&(r.value.charCodeAt(0)===0&&!(r.value.charCodeAt(1)&128)||r.value.charCodeAt(0)===255&&(r.value.charCodeAt(1)&128)===128)?n.putBytes(r.value.substr(1)):n.putBytes(r.value);if(e.putByte(t),n.length()<=127)e.putByte(n.length()&127);else{var o=n.length(),a="";do a+=String.fromCharCode(o&255),o=o>>>8;while(o>0);e.putByte(a.length|128);for(var i=a.length-1;i>=0;--i)e.putByte(a.charCodeAt(i))}return e.putBuffer(n),e};G.oidToDer=function(r){var e=r.split("."),t=lt.util.createBuffer();t.putByte(40*parseInt(e[0],10)+parseInt(e[1],10));for(var n,s,i,o,a=2;a<e.length;++a){n=!0,s=[],i=parseInt(e[a],10);do o=i&127,i=i>>>7,n||(o|=128),s.push(o),n=!1;while(i>0);for(var c=s.length-1;c>=0;--c)t.putByte(s[c])}return t};G.derToOid=function(r){var e;typeof r=="string"&&(r=lt.util.createBuffer(r));var t=r.getByte();e=Math.floor(t/40)+"."+t%40;for(var n=0;r.length()>0;)t=r.getByte(),n=n<<7,t&128?n+=t&127:(e+="."+(n+t),n=0);return e};G.utcTimeToDate=function(r){var e=new Date,t=parseInt(r.substr(0,2),10);t=t>=50?1900+t:2e3+t;var n=parseInt(r.substr(2,2),10)-1,s=parseInt(r.substr(4,2),10),i=parseInt(r.substr(6,2),10),o=parseInt(r.substr(8,2),10),a=0;if(r.length>11){var c=r.charAt(10),l=10;c!=="+"&&c!=="-"&&(a=parseInt(r.substr(10,2),10),l+=2)}if(e.setUTCFullYear(t,n,s),e.setUTCHours(i,o,a,0),l&&(c=r.charAt(l),c==="+"||c==="-")){var u=parseInt(r.substr(l+1,2),10),f=parseInt(r.substr(l+4,2),10),h=u*60+f;h*=6e4,c==="+"?e.setTime(+e-h):e.setTime(+e+h)}return e};G.generalizedTimeToDate=function(r){var e=new Date,t=parseInt(r.substr(0,4),10),n=parseInt(r.substr(4,2),10)-1,s=parseInt(r.substr(6,2),10),i=parseInt(r.substr(8,2),10),o=parseInt(r.substr(10,2),10),a=parseInt(r.substr(12,2),10),c=0,l=0,u=!1;r.charAt(r.length-1)==="Z"&&(u=!0);var f=r.length-5,h=r.charAt(f);if(h==="+"||h==="-"){var p=parseInt(r.substr(f+1,2),10),d=parseInt(r.substr(f+4,2),10);l=p*60+d,l*=6e4,h==="+"&&(l*=-1),u=!0}return r.charAt(14)==="."&&(c=parseFloat(r.substr(14),10)*1e3),u?(e.setUTCFullYear(t,n,s),e.setUTCHours(i,o,a,c),e.setTime(+e+l)):(e.setFullYear(t,n,s),e.setHours(i,o,a,c)),e};G.dateToUtcTime=function(r){if(typeof r=="string")return r;var e="",t=[];t.push((""+r.getUTCFullYear()).substr(2)),t.push(""+(r.getUTCMonth()+1)),t.push(""+r.getUTCDate()),t.push(""+r.getUTCHours()),t.push(""+r.getUTCMinutes()),t.push(""+r.getUTCSeconds());for(var n=0;n<t.length;++n)t[n].length<2&&(e+="0"),e+=t[n];return e+="Z",e};G.dateToGeneralizedTime=function(r){if(typeof r=="string")return r;var e="",t=[];t.push(""+r.getUTCFullYear()),t.push(""+(r.getUTCMonth()+1)),t.push(""+r.getUTCDate()),t.push(""+r.getUTCHours()),t.push(""+r.getUTCMinutes()),t.push(""+r.getUTCSeconds());for(var n=0;n<t.length;++n)t[n].length<2&&(e+="0"),e+=t[n];return e+="Z",e};G.integerToDer=function(r){var e=lt.util.createBuffer();if(r>=-128&&r<128)return e.putSignedInt(r,8);if(r>=-32768&&r<32768)return e.putSignedInt(r,16);if(r>=-8388608&&r<8388608)return e.putSignedInt(r,24);if(r>=-2147483648&&r<2147483648)return e.putSignedInt(r,32);var t=new Error("Integer too large; max is 32-bits.");throw t.integer=r,t};G.derToInteger=function(r){typeof r=="string"&&(r=lt.util.createBuffer(r));var e=r.length()*8;if(e>32)throw new Error("Integer too large; max is 32-bits.");return r.getSignedInt(e)};G.validate=function(r,e,t,n){var s=!1;if((r.tagClass===e.tagClass||typeof e.tagClass>"u")&&(r.type===e.type||typeof e.type>"u"))if(r.constructed===e.constructed||typeof e.constructed>"u"){if(s=!0,e.value&&lt.util.isArray(e.value))for(var i=0,o=0;s&&o<e.value.length;++o)s=e.value[o].optional||!1,r.value[i]&&(s=G.validate(r.value[i],e.value[o],t,n),s?++i:e.value[o].optional&&(s=!0)),!s&&n&&n.push("["+e.name+'] Tag class "'+e.tagClass+'", type "'+e.type+'" expected value length "'+e.value.length+'", got "'+r.value.length+'"');if(s&&t&&(e.capture&&(t[e.capture]=r.value),e.captureAsn1&&(t[e.captureAsn1]=r),e.captureBitStringContents&&"bitStringContents"in r&&(t[e.captureBitStringContents]=r.bitStringContents),e.captureBitStringValue&&"bitStringContents"in r)){var a;if(r.bitStringContents.length<2)t[e.captureBitStringValue]="";else{var c=r.bitStringContents.charCodeAt(0);if(c!==0)throw new Error("captureBitStringValue only supported for zero unused bits");t[e.captureBitStringValue]=r.bitStringContents.slice(1)}}}else n&&n.push("["+e.name+'] Expected constructed "'+e.constructed+'", got "'+r.constructed+'"');else n&&(r.tagClass!==e.tagClass&&n.push("["+e.name+'] Expected tag class "'+e.tagClass+'", got "'+r.tagClass+'"'),r.type!==e.type&&n.push("["+e.name+'] Expected type "'+e.type+'", got "'+r.type+'"'));return s};var av=/[^\\u0000-\\u00ff]/;G.prettyPrint=function(r,e,t){var n="";e=e||0,t=t||2,e>0&&(n+=`
`);for(var s="",i=0;i<e*t;++i)s+=" ";switch(n+=s+"Tag: ",r.tagClass){case G.Class.UNIVERSAL:n+="Universal:";break;case G.Class.APPLICATION:n+="Application:";break;case G.Class.CONTEXT_SPECIFIC:n+="Context-Specific:";break;case G.Class.PRIVATE:n+="Private:";break}if(r.tagClass===G.Class.UNIVERSAL)switch(n+=r.type,r.type){case G.Type.NONE:n+=" (None)";break;case G.Type.BOOLEAN:n+=" (Boolean)";break;case G.Type.INTEGER:n+=" (Integer)";break;case G.Type.BITSTRING:n+=" (Bit string)";break;case G.Type.OCTETSTRING:n+=" (Octet string)";break;case G.Type.NULL:n+=" (Null)";break;case G.Type.OID:n+=" (Object Identifier)";break;case G.Type.ODESC:n+=" (Object Descriptor)";break;case G.Type.EXTERNAL:n+=" (External or Instance of)";break;case G.Type.REAL:n+=" (Real)";break;case G.Type.ENUMERATED:n+=" (Enumerated)";break;case G.Type.EMBEDDED:n+=" (Embedded PDV)";break;case G.Type.UTF8:n+=" (UTF8)";break;case G.Type.ROID:n+=" (Relative Object Identifier)";break;case G.Type.SEQUENCE:n+=" (Sequence)";break;case G.Type.SET:n+=" (Set)";break;case G.Type.PRINTABLESTRING:n+=" (Printable String)";break;case G.Type.IA5String:n+=" (IA5String (ASCII))";break;case G.Type.UTCTIME:n+=" (UTC time)";break;case G.Type.GENERALIZEDTIME:n+=" (Generalized time)";break;case G.Type.BMPSTRING:n+=" (BMP String)";break}else n+=r.type;if(n+=`
`,n+=s+"Constructed: "+r.constructed+`
`,r.composed){for(var o=0,a="",i=0;i<r.value.length;++i)r.value[i]!==void 0&&(o+=1,a+=G.prettyPrint(r.value[i],e+1,t),i+1<r.value.length&&(a+=","));n+=s+"Sub values: "+o+a}else{if(n+=s+"Value: ",r.type===G.Type.OID){var c=G.derToOid(r.value);n+=c,lt.pki&&lt.pki.oids&&c in lt.pki.oids&&(n+=" ("+lt.pki.oids[c]+") ")}if(r.type===G.Type.INTEGER)try{n+=G.derToInteger(r.value)}catch{n+="0x"+lt.util.bytesToHex(r.value)}else if(r.type===G.Type.BITSTRING){if(r.value.length>1?n+="0x"+lt.util.bytesToHex(r.value.slice(1)):n+="(none)",r.value.length>0){var l=r.value.charCodeAt(0);l==1?n+=" (1 unused bit shown)":l>1&&(n+=" ("+l+" unused bits shown)")}}else if(r.type===G.Type.OCTETSTRING)av.test(r.value)||(n+="("+r.value+") "),n+="0x"+lt.util.bytesToHex(r.value);else if(r.type===G.Type.UTF8)try{n+=lt.util.decodeUtf8(r.value)}catch(u){if(u.message==="URI malformed")n+="0x"+lt.util.bytesToHex(r.value)+" (malformed UTF8)";else throw u}else r.type===G.Type.PRINTABLESTRING||r.type===G.Type.IA5String?n+=r.value:av.test(r.value)?n+="0x"+lt.util.bytesToHex(r.value):r.value.length===0?n+="[null]":n+=r.value}return n}});var O3=N((Ype,lv)=>{var lr=rt();Ht();lv.exports=lr.cipher=lr.cipher||{};lr.cipher.algorithms=lr.cipher.algorithms||{};lr.cipher.createCipher=function(r,e){var t=r;if(typeof t=="string"&&(t=lr.cipher.getAlgorithm(t),t&&(t=t())),!t)throw new Error("Unsupported algorithm: "+r);return new lr.cipher.BlockCipher({algorithm:t,key:e,decrypt:!1})};lr.cipher.createDecipher=function(r,e){var t=r;if(typeof t=="string"&&(t=lr.cipher.getAlgorithm(t),t&&(t=t())),!t)throw new Error("Unsupported algorithm: "+r);return new lr.cipher.BlockCipher({algorithm:t,key:e,decrypt:!0})};lr.cipher.registerAlgorithm=function(r,e){r=r.toUpperCase(),lr.cipher.algorithms[r]=e};lr.cipher.getAlgorithm=function(r){return r=r.toUpperCase(),r in lr.cipher.algorithms?lr.cipher.algorithms[r]:null};var N3=lr.cipher.BlockCipher=function(r){this.algorithm=r.algorithm,this.mode=this.algorithm.mode,this.blockSize=this.mode.blockSize,this._finish=!1,this._input=null,this.output=null,this._op=r.decrypt?this.mode.decrypt:this.mode.encrypt,this._decrypt=r.decrypt,this.algorithm.initialize(r)};N3.prototype.start=function(r){r=r||{};var e={};for(var t in r)e[t]=r[t];e.decrypt=this._decrypt,this._finish=!1,this._input=lr.util.createBuffer(),this.output=r.output||lr.util.createBuffer(),this.mode.start(e)};N3.prototype.update=function(r){for(r&&this._input.putBuffer(r);!this._op.call(this.mode,this._input,this.output,this._finish)&&!this._finish;);this._input.compact()};N3.prototype.finish=function(r){r&&(this.mode.name==="ECB"||this.mode.name==="CBC")&&(this.mode.pad=function(t){return r(this.blockSize,t,!1)},this.mode.unpad=function(t){return r(this.blockSize,t,!0)});var e={};return e.decrypt=this._decrypt,e.overflow=this._input.length()%this.blockSize,!(!this._decrypt&&this.mode.pad&&!this.mode.pad(this._input,e)||(this._finish=!0,this.update(),this._decrypt&&this.mode.unpad&&!this.mode.unpad(this.output,e))||this.mode.afterFinish&&!this.mode.afterFinish(this.output,e))}});var B3=N((Qpe,uv)=>{var ur=rt();Ht();ur.cipher=ur.cipher||{};var Pe=uv.exports=ur.cipher.modes=ur.cipher.modes||{};Pe.ecb=function(r){r=r||{},this.name="ECB",this.cipher=r.cipher,this.blockSize=r.blockSize||16,this._ints=this.blockSize/4,this._inBlock=new Array(this._ints),this._outBlock=new Array(this._ints)};Pe.ecb.prototype.start=function(r){};Pe.ecb.prototype.encrypt=function(r,e,t){if(r.length()<this.blockSize&&!(t&&r.length()>0))return!0;for(var n=0;n<this._ints;++n)this._inBlock[n]=r.getInt32();this.cipher.encrypt(this._inBlock,this._outBlock);for(var n=0;n<this._ints;++n)e.putInt32(this._outBlock[n])};Pe.ecb.prototype.decrypt=function(r,e,t){if(r.length()<this.blockSize&&!(t&&r.length()>0))return!0;for(var n=0;n<this._ints;++n)this._inBlock[n]=r.getInt32();this.cipher.decrypt(this._inBlock,this._outBlock);for(var n=0;n<this._ints;++n)e.putInt32(this._outBlock[n])};Pe.ecb.prototype.pad=function(r,e){var t=r.length()===this.blockSize?this.blockSize:this.blockSize-r.length();return r.fillWithByte(t,t),!0};Pe.ecb.prototype.unpad=function(r,e){if(e.overflow>0)return!1;var t=r.length(),n=r.at(t-1);return n>this.blockSize<<2?!1:(r.truncate(n),!0)};Pe.cbc=function(r){r=r||{},this.name="CBC",this.cipher=r.cipher,this.blockSize=r.blockSize||16,this._ints=this.blockSize/4,this._inBlock=new Array(this._ints),this._outBlock=new Array(this._ints)};Pe.cbc.prototype.start=function(r){if(r.iv===null){if(!this._prev)throw new Error("Invalid IV parameter.");this._iv=this._prev.slice(0)}else if("iv"in r)this._iv=ld(r.iv,this.blockSize),this._prev=this._iv.slice(0);else throw new Error("Invalid IV parameter.")};Pe.cbc.prototype.encrypt=function(r,e,t){if(r.length()<this.blockSize&&!(t&&r.length()>0))return!0;for(var n=0;n<this._ints;++n)this._inBlock[n]=this._prev[n]^r.getInt32();this.cipher.encrypt(this._inBlock,this._outBlock);for(var n=0;n<this._ints;++n)e.putInt32(this._outBlock[n]);this._prev=this._outBlock};Pe.cbc.prototype.decrypt=function(r,e,t){if(r.length()<this.blockSize&&!(t&&r.length()>0))return!0;for(var n=0;n<this._ints;++n)this._inBlock[n]=r.getInt32();this.cipher.decrypt(this._inBlock,this._outBlock);for(var n=0;n<this._ints;++n)e.putInt32(this._prev[n]^this._outBlock[n]);this._prev=this._inBlock.slice(0)};Pe.cbc.prototype.pad=function(r,e){var t=r.length()===this.blockSize?this.blockSize:this.blockSize-r.length();return r.fillWithByte(t,t),!0};Pe.cbc.prototype.unpad=function(r,e){if(e.overflow>0)return!1;var t=r.length(),n=r.at(t-1);return n>this.blockSize<<2?!1:(r.truncate(n),!0)};Pe.cfb=function(r){r=r||{},this.name="CFB",this.cipher=r.cipher,this.blockSize=r.blockSize||16,this._ints=this.blockSize/4,this._inBlock=null,this._outBlock=new Array(this._ints),this._partialBlock=new Array(this._ints),this._partialOutput=ur.util.createBuffer(),this._partialBytes=0};Pe.cfb.prototype.start=function(r){if(!("iv"in r))throw new Error("Invalid IV parameter.");this._iv=ld(r.iv,this.blockSize),this._inBlock=this._iv.slice(0),this._partialBytes=0};Pe.cfb.prototype.encrypt=function(r,e,t){var n=r.length();if(n===0)return!0;if(this.cipher.encrypt(this._inBlock,this._outBlock),this._partialBytes===0&&n>=this.blockSize){for(var s=0;s<this._ints;++s)this._inBlock[s]=r.getInt32()^this._outBlock[s],e.putInt32(this._inBlock[s]);return}var i=(this.blockSize-n)%this.blockSize;i>0&&(i=this.blockSize-i),this._partialOutput.clear();for(var s=0;s<this._ints;++s)this._partialBlock[s]=r.getInt32()^this._outBlock[s],this._partialOutput.putInt32(this._partialBlock[s]);if(i>0)r.read-=this.blockSize;else for(var s=0;s<this._ints;++s)this._inBlock[s]=this._partialBlock[s];if(this._partialBytes>0&&this._partialOutput.getBytes(this._partialBytes),i>0&&!t)return e.putBytes(this._partialOutput.getBytes(i-this._partialBytes)),this._partialBytes=i,!0;e.putBytes(this._partialOutput.getBytes(n-this._partialBytes)),this._partialBytes=0};Pe.cfb.prototype.decrypt=function(r,e,t){var n=r.length();if(n===0)return!0;if(this.cipher.encrypt(this._inBlock,this._outBlock),this._partialBytes===0&&n>=this.blockSize){for(var s=0;s<this._ints;++s)this._inBlock[s]=r.getInt32(),e.putInt32(this._inBlock[s]^this._outBlock[s]);return}var i=(this.blockSize-n)%this.blockSize;i>0&&(i=this.blockSize-i),this._partialOutput.clear();for(var s=0;s<this._ints;++s)this._partialBlock[s]=r.getInt32(),this._partialOutput.putInt32(this._partialBlock[s]^this._outBlock[s]);if(i>0)r.read-=this.blockSize;else for(var s=0;s<this._ints;++s)this._inBlock[s]=this._partialBlock[s];if(this._partialBytes>0&&this._partialOutput.getBytes(this._partialBytes),i>0&&!t)return e.putBytes(this._partialOutput.getBytes(i-this._partialBytes)),this._partialBytes=i,!0;e.putBytes(this._partialOutput.getBytes(n-this._partialBytes)),this._partialBytes=0};Pe.ofb=function(r){r=r||{},this.name="OFB",this.cipher=r.cipher,this.blockSize=r.blockSize||16,this._ints=this.blockSize/4,this._inBlock=null,this._outBlock=new Array(this._ints),this._partialOutput=ur.util.createBuffer(),this._partialBytes=0};Pe.ofb.prototype.start=function(r){if(!("iv"in r))throw new Error("Invalid IV parameter.");this._iv=ld(r.iv,this.blockSize),this._inBlock=this._iv.slice(0),this._partialBytes=0};Pe.ofb.prototype.encrypt=function(r,e,t){var n=r.length();if(r.length()===0)return!0;if(this.cipher.encrypt(this._inBlock,this._outBlock),this._partialBytes===0&&n>=this.blockSize){for(var s=0;s<this._ints;++s)e.putInt32(r.getInt32()^this._outBlock[s]),this._inBlock[s]=this._outBlock[s];return}var i=(this.blockSize-n)%this.blockSize;i>0&&(i=this.blockSize-i),this._partialOutput.clear();for(var s=0;s<this._ints;++s)this._partialOutput.putInt32(r.getInt32()^this._outBlock[s]);if(i>0)r.read-=this.blockSize;else for(var s=0;s<this._ints;++s)this._inBlock[s]=this._outBlock[s];if(this._partialBytes>0&&this._partialOutput.getBytes(this._partialBytes),i>0&&!t)return e.putBytes(this._partialOutput.getBytes(i-this._partialBytes)),this._partialBytes=i,!0;e.putBytes(this._partialOutput.getBytes(n-this._partialBytes)),this._partialBytes=0};Pe.ofb.prototype.decrypt=Pe.ofb.prototype.encrypt;Pe.ctr=function(r){r=r||{},this.name="CTR",this.cipher=r.cipher,this.blockSize=r.blockSize||16,this._ints=this.blockSize/4,this._inBlock=null,this._outBlock=new Array(this._ints),this._partialOutput=ur.util.createBuffer(),this._partialBytes=0};Pe.ctr.prototype.start=function(r){if(!("iv"in r))throw new Error("Invalid IV parameter.");this._iv=ld(r.iv,this.blockSize),this._inBlock=this._iv.slice(0),this._partialBytes=0};Pe.ctr.prototype.encrypt=function(r,e,t){var n=r.length();if(n===0)return!0;if(this.cipher.encrypt(this._inBlock,this._outBlock),this._partialBytes===0&&n>=this.blockSize)for(var s=0;s<this._ints;++s)e.putInt32(r.getInt32()^this._outBlock[s]);else{var i=(this.blockSize-n)%this.blockSize;i>0&&(i=this.blockSize-i),this._partialOutput.clear();for(var s=0;s<this._ints;++s)this._partialOutput.putInt32(r.getInt32()^this._outBlock[s]);if(i>0&&(r.read-=this.blockSize),this._partialBytes>0&&this._partialOutput.getBytes(this._partialBytes),i>0&&!t)return e.putBytes(this._partialOutput.getBytes(i-this._partialBytes)),this._partialBytes=i,!0;e.putBytes(this._partialOutput.getBytes(n-this._partialBytes)),this._partialBytes=0}ud(this._inBlock)};Pe.ctr.prototype.decrypt=Pe.ctr.prototype.encrypt;Pe.gcm=function(r){r=r||{},this.name="GCM",this.cipher=r.cipher,this.blockSize=r.blockSize||16,this._ints=this.blockSize/4,this._inBlock=new Array(this._ints),this._outBlock=new Array(this._ints),this._partialOutput=ur.util.createBuffer(),this._partialBytes=0,this._R=3774873600};Pe.gcm.prototype.start=function(r){if(!("iv"in r))throw new Error("Invalid IV parameter.");var e=ur.util.createBuffer(r.iv);this._cipherLength=0;var t;if("additionalData"in r?t=ur.util.createBuffer(r.additionalData):t=ur.util.createBuffer(),"tagLength"in r?this._tagLength=r.tagLength:this._tagLength=128,this._tag=null,r.decrypt&&(this._tag=ur.util.createBuffer(r.tag).getBytes(),this._tag.length!==this._tagLength/8))throw new Error("Authentication tag does not match tag length.");this._hashBlock=new Array(this._ints),this.tag=null,this._hashSubkey=new Array(this._ints),this.cipher.encrypt([0,0,0,0],this._hashSubkey),this.componentBits=4,this._m=this.generateHashTable(this._hashSubkey,this.componentBits);var n=e.length();if(n===12)this._j0=[e.getInt32(),e.getInt32(),e.getInt32(),1];else{for(this._j0=[0,0,0,0];e.length()>0;)this._j0=this.ghash(this._hashSubkey,this._j0,[e.getInt32(),e.getInt32(),e.getInt32(),e.getInt32()]);this._j0=this.ghash(this._hashSubkey,this._j0,[0,0].concat(L3(n*8)))}this._inBlock=this._j0.slice(0),ud(this._inBlock),this._partialBytes=0,t=ur.util.createBuffer(t),this._aDataLength=L3(t.length()*8);var s=t.length()%this.blockSize;for(s&&t.fillWithByte(0,this.blockSize-s),this._s=[0,0,0,0];t.length()>0;)this._s=this.ghash(this._hashSubkey,this._s,[t.getInt32(),t.getInt32(),t.getInt32(),t.getInt32()])};Pe.gcm.prototype.encrypt=function(r,e,t){var n=r.length();if(n===0)return!0;if(this.cipher.encrypt(this._inBlock,this._outBlock),this._partialBytes===0&&n>=this.blockSize){for(var s=0;s<this._ints;++s)e.putInt32(this._outBlock[s]^=r.getInt32());this._cipherLength+=this.blockSize}else{var i=(this.blockSize-n)%this.blockSize;i>0&&(i=this.blockSize-i),this._partialOutput.clear();for(var s=0;s<this._ints;++s)this._partialOutput.putInt32(r.getInt32()^this._outBlock[s]);if(i<=0||t){if(t){var o=n%this.blockSize;this._cipherLength+=o,this._partialOutput.truncate(this.blockSize-o)}else this._cipherLength+=this.blockSize;for(var s=0;s<this._ints;++s)this._outBlock[s]=this._partialOutput.getInt32();this._partialOutput.read-=this.blockSize}if(this._partialBytes>0&&this._partialOutput.getBytes(this._partialBytes),i>0&&!t)return r.read-=this.blockSize,e.putBytes(this._partialOutput.getBytes(i-this._partialBytes)),this._partialBytes=i,!0;e.putBytes(this._partialOutput.getBytes(n-this._partialBytes)),this._partialBytes=0}this._s=this.ghash(this._hashSubkey,this._s,this._outBlock),ud(this._inBlock)};Pe.gcm.prototype.decrypt=function(r,e,t){var n=r.length();if(n<this.blockSize&&!(t&&n>0))return!0;this.cipher.encrypt(this._inBlock,this._outBlock),ud(this._inBlock),this._hashBlock[0]=r.getInt32(),this._hashBlock[1]=r.getInt32(),this._hashBlock[2]=r.getInt32(),this._hashBlock[3]=r.getInt32(),this._s=this.ghash(this._hashSubkey,this._s,this._hashBlock);for(var s=0;s<this._ints;++s)e.putInt32(this._outBlock[s]^this._hashBlock[s]);n<this.blockSize?this._cipherLength+=n%this.blockSize:this._cipherLength+=this.blockSize};Pe.gcm.prototype.afterFinish=function(r,e){var t=!0;e.decrypt&&e.overflow&&r.truncate(this.blockSize-e.overflow),this.tag=ur.util.createBuffer();var n=this._aDataLength.concat(L3(this._cipherLength*8));this._s=this.ghash(this._hashSubkey,this._s,n);var s=[];this.cipher.encrypt(this._j0,s);for(var i=0;i<this._ints;++i)this.tag.putInt32(this._s[i]^s[i]);return this.tag.truncate(this.tag.length()%(this._tagLength/8)),e.decrypt&&this.tag.bytes()!==this._tag&&(t=!1),t};Pe.gcm.prototype.multiply=function(r,e){for(var t=[0,0,0,0],n=e.slice(0),s=0;s<128;++s){var i=r[s/32|0]&1<<31-s%32;i&&(t[0]^=n[0],t[1]^=n[1],t[2]^=n[2],t[3]^=n[3]),this.pow(n,n)}return t};Pe.gcm.prototype.pow=function(r,e){for(var t=r[3]&1,n=3;n>0;--n)e[n]=r[n]>>>1|(r[n-1]&1)<<31;e[0]=r[0]>>>1,t&&(e[0]^=this._R)};Pe.gcm.prototype.tableMultiply=function(r){for(var e=[0,0,0,0],t=0;t<32;++t){var n=t/8|0,s=r[n]>>>(7-t%8)*4&15,i=this._m[t][s];e[0]^=i[0],e[1]^=i[1],e[2]^=i[2],e[3]^=i[3]}return e};Pe.gcm.prototype.ghash=function(r,e,t){return e[0]^=t[0],e[1]^=t[1],e[2]^=t[2],e[3]^=t[3],this.tableMultiply(e)};Pe.gcm.prototype.generateHashTable=function(r,e){for(var t=8/e,n=4*t,s=16*t,i=new Array(s),o=0;o<s;++o){var a=[0,0,0,0],c=o/n|0,l=(n-1-o%n)*e;a[c]=1<<e-1<<l,i[o]=this.generateSubHashTable(this.multiply(a,r),e)}return i};Pe.gcm.prototype.generateSubHashTable=function(r,e){var t=1<<e,n=t>>>1,s=new Array(t);s[n]=r.slice(0);for(var i=n>>>1;i>0;)this.pow(s[2*i],s[i]=[]),i>>=1;for(i=2;i<n;){for(var o=1;o<i;++o){var a=s[i],c=s[o];s[i+o]=[a[0]^c[0],a[1]^c[1],a[2]^c[2],a[3]^c[3]]}i*=2}for(s[0]=[0,0,0,0],i=n+1;i<t;++i){var l=s[i^n];s[i]=[r[0]^l[0],r[1]^l[1],r[2]^l[2],r[3]^l[3]]}return s};function ld(r,e){if(typeof r=="string"&&(r=ur.util.createBuffer(r)),ur.util.isArray(r)&&r.length>4){var t=r;r=ur.util.createBuffer();for(var n=0;n<t.length;++n)r.putByte(t[n])}if(r.length()<e)throw new Error("Invalid IV length; got "+r.length()+" bytes and expected "+e+" bytes.");if(!ur.util.isArray(r)){for(var s=[],i=e/4,n=0;n<i;++n)s.push(r.getInt32());r=s}return r}function ud(r){r[r.length-1]=r[r.length-1]+1&4294967295}function L3(r){return[r/4294967296|0,r&4294967295]}});var hd=N((Xpe,pv)=>{var at=rt();O3();B3();Ht();pv.exports=at.aes=at.aes||{};at.aes.startEncrypting=function(r,e,t,n){var s=fd({key:r,output:t,decrypt:!1,mode:n});return s.start(e),s};at.aes.createEncryptionCipher=function(r,e){return fd({key:r,output:null,decrypt:!1,mode:e})};at.aes.startDecrypting=function(r,e,t,n){var s=fd({key:r,output:t,decrypt:!0,mode:n});return s.start(e),s};at.aes.createDecryptionCipher=function(r,e){return fd({key:r,output:null,decrypt:!0,mode:e})};at.aes.Algorithm=function(r,e){F3||hv();var t=this;t.name=r,t.mode=new e({blockSize:16,cipher:{encrypt:function(n,s){return U3(t._w,n,s,!1)},decrypt:function(n,s){return U3(t._w,n,s,!0)}}}),t._init=!1};at.aes.Algorithm.prototype.initialize=function(r){if(!this._init){var e=r.key,t;if(typeof e=="string"&&(e.length===16||e.length===24||e.length===32))e=at.util.createBuffer(e);else if(at.util.isArray(e)&&(e.length===16||e.length===24||e.length===32)){t=e,e=at.util.createBuffer();for(var n=0;n<t.length;++n)e.putByte(t[n])}if(!at.util.isArray(e)){t=e,e=[];var s=t.length();if(s===16||s===24||s===32){s=s>>>2;for(var n=0;n<s;++n)e.push(t.getInt32())}}if(!at.util.isArray(e)||!(e.length===4||e.length===6||e.length===8))throw new Error("Invalid key parameter.");var i=this.mode.name,o=["CFB","OFB","CTR","GCM"].indexOf(i)!==-1;this._w=dv(e,r.decrypt&&!o),this._init=!0}};at.aes._expandKey=function(r,e){return F3||hv(),dv(r,e)};at.aes._updateBlock=U3;Rc("AES-ECB",at.cipher.modes.ecb);Rc("AES-CBC",at.cipher.modes.cbc);Rc("AES-CFB",at.cipher.modes.cfb);Rc("AES-OFB",at.cipher.modes.ofb);Rc("AES-CTR",at.cipher.modes.ctr);Rc("AES-GCM",at.cipher.modes.gcm);function Rc(r,e){var t=function(){return new at.aes.Algorithm(r,e)};at.cipher.registerAlgorithm(r,t)}var F3=!1,Ac=4,Nr,M3,fv,na,rs;function hv(){F3=!0,fv=[0,1,2,4,8,16,32,64,128,27,54];for(var r=new Array(256),e=0;e<128;++e)r[e]=e<<1,r[e+128]=e+128<<1^283;Nr=new Array(256),M3=new Array(256),na=new Array(4),rs=new Array(4);for(var e=0;e<4;++e)na[e]=new Array(256),rs[e]=new Array(256);for(var t=0,n=0,s,i,o,a,c,l,u,e=0;e<256;++e){a=n^n<<1^n<<2^n<<3^n<<4,a=a>>8^a&255^99,Nr[t]=a,M3[a]=t,c=r[a],s=r[t],i=r[s],o=r[i],l=c<<24^a<<16^a<<8^(a^c),u=(s^i^o)<<24^(t^o)<<16^(t^i^o)<<8^(t^s^o);for(var f=0;f<4;++f)na[f][t]=l,rs[f][a]=u,l=l<<24|l>>>8,u=u<<24|u>>>8;t===0?t=n=1:(t=s^r[r[r[s^o]]],n^=r[r[n]])}}function dv(r,e){for(var t=r.slice(0),n,s=1,i=t.length,o=i+6+1,a=Ac*o,c=i;c<a;++c)n=t[c-1],c%i===0?(n=Nr[n>>>16&255]<<24^Nr[n>>>8&255]<<16^Nr[n&255]<<8^Nr[n>>>24]^fv[s]<<24,s++):i>6&&c%i===4&&(n=Nr[n>>>24]<<24^Nr[n>>>16&255]<<16^Nr[n>>>8&255]<<8^Nr[n&255]),t[c]=t[c-i]^n;if(e){var l,u=rs[0],f=rs[1],h=rs[2],p=rs[3],d=t.slice(0);a=t.length;for(var c=0,m=a-Ac;c<a;c+=Ac,m-=Ac)if(c===0||c===a-Ac)d[c]=t[m],d[c+1]=t[m+3],d[c+2]=t[m+2],d[c+3]=t[m+1];else for(var g=0;g<Ac;++g)l=t[m+g],d[c+(3&-g)]=u[Nr[l>>>24]]^f[Nr[l>>>16&255]]^h[Nr[l>>>8&255]]^p[Nr[l&255]];t=d}return t}function U3(r,e,t,n){var s=r.length/4-1,i,o,a,c,l;n?(i=rs[0],o=rs[1],a=rs[2],c=rs[3],l=M3):(i=na[0],o=na[1],a=na[2],c=na[3],l=Nr);var u,f,h,p,d,m,g;u=e[0]^r[0],f=e[n?3:1]^r[1],h=e[2]^r[2],p=e[n?1:3]^r[3];for(var y=3,b=1;b<s;++b)d=i[u>>>24]^o[f>>>16&255]^a[h>>>8&255]^c[p&255]^r[++y],m=i[f>>>24]^o[h>>>16&255]^a[p>>>8&255]^c[u&255]^r[++y],g=i[h>>>24]^o[p>>>16&255]^a[u>>>8&255]^c[f&255]^r[++y],p=i[p>>>24]^o[u>>>16&255]^a[f>>>8&255]^c[h&255]^r[++y],u=d,f=m,h=g;t[0]=l[u>>>24]<<24^l[f>>>16&255]<<16^l[h>>>8&255]<<8^l[p&255]^r[++y],t[n?3:1]=l[f>>>24]<<24^l[h>>>16&255]<<16^l[p>>>8&255]<<8^l[u&255]^r[++y],t[2]=l[h>>>24]<<24^l[p>>>16&255]<<16^l[u>>>8&255]<<8^l[f&255]^r[++y],t[n?1:3]=l[p>>>24]<<24^l[u>>>16&255]<<16^l[f>>>8&255]<<8^l[h&255]^r[++y]}function fd(r){r=r||{};var e=(r.mode||"CBC").toUpperCase(),t="AES-"+e,n;r.decrypt?n=at.cipher.createDecipher(t,r.key):n=at.cipher.createCipher(t,r.key);var s=n.start;return n.start=function(i,o){var a=null;o instanceof at.util.ByteBuffer&&(a=o,o={}),o=o||{},o.output=a,o.iv=i,s.call(n,o)},n}});var yv=N((jpe,gv)=>{var Et=rt();O3();B3();Ht();gv.exports=Et.des=Et.des||{};Et.des.startEncrypting=function(r,e,t,n){var s=dd({key:r,output:t,decrypt:!1,mode:n||(e===null?"ECB":"CBC")});return s.start(e),s};Et.des.createEncryptionCipher=function(r,e){return dd({key:r,output:null,decrypt:!1,mode:e})};Et.des.startDecrypting=function(r,e,t,n){var s=dd({key:r,output:t,decrypt:!0,mode:n||(e===null?"ECB":"CBC")});return s.start(e),s};Et.des.createDecryptionCipher=function(r,e){return dd({key:r,output:null,decrypt:!0,mode:e})};Et.des.Algorithm=function(r,e){var t=this;t.name=r,t.mode=new e({blockSize:8,cipher:{encrypt:function(n,s){return mv(t._keys,n,s,!1)},decrypt:function(n,s){return mv(t._keys,n,s,!0)}}}),t._init=!1};Et.des.Algorithm.prototype.initialize=function(r){if(!this._init){var e=Et.util.createBuffer(r.key);if(this.name.indexOf("3DES")===0&&e.length()!==24)throw new Error("Invalid Triple-DES key size: "+e.length()*8);this._keys=Sz(e),this._init=!0}};Ds("DES-ECB",Et.cipher.modes.ecb);Ds("DES-CBC",Et.cipher.modes.cbc);Ds("DES-CFB",Et.cipher.modes.cfb);Ds("DES-OFB",Et.cipher.modes.ofb);Ds("DES-CTR",Et.cipher.modes.ctr);Ds("3DES-ECB",Et.cipher.modes.ecb);Ds("3DES-CBC",Et.cipher.modes.cbc);Ds("3DES-CFB",Et.cipher.modes.cfb);Ds("3DES-OFB",Et.cipher.modes.ofb);Ds("3DES-CTR",Et.cipher.modes.ctr);function Ds(r,e){var t=function(){return new Et.des.Algorithm(r,e)};Et.cipher.registerAlgorithm(r,t)}var gz=[16843776,0,65536,16843780,16842756,66564,4,65536,1024,16843776,16843780,1024,16778244,16842756,16777216,4,1028,16778240,16778240,66560,66560,16842752,16842752,16778244,65540,16777220,16777220,65540,0,1028,66564,16777216,65536,16843780,4,16842752,16843776,16777216,16777216,1024,16842756,65536,66560,16777220,1024,4,16778244,66564,16843780,65540,16842752,16778244,16777220,1028,66564,16843776,1028,16778240,16778240,0,65540,66560,0,16842756],yz=[-2146402272,-2147450880,32768,1081376,1048576,32,-2146435040,-2147450848,-2147483616,-2146402272,-2146402304,-2147483648,-2147450880,1048576,32,-2146435040,1081344,1048608,-2147450848,0,-2147483648,32768,1081376,-2146435072,1048608,-2147483616,0,1081344,32800,-2146402304,-2146435072,32800,0,1081376,-2146435040,1048576,-2147450848,-2146435072,-2146402304,32768,-2146435072,-2147450880,32,-2146402272,1081376,32,32768,-2147483648,32800,-2146402304,1048576,-2147483616,1048608,-2147450848,-2147483616,1048608,1081344,0,-2147450880,32800,-2147483648,-2146435040,-2146402272,1081344],bz=[520,134349312,0,134348808,134218240,0,131592,134218240,131080,134217736,134217736,131072,134349320,131080,134348800,520,134217728,8,134349312,512,131584,134348800,134348808,131592,134218248,131584,131072,134218248,8,134349320,512,134217728,134349312,134217728,131080,520,131072,134349312,134218240,0,512,131080,134349320,134218240,134217736,512,0,134348808,134218248,131072,134217728,134349320,8,131592,131584,134217736,134348800,134218248,520,134348800,131592,8,134348808,131584],wz=[8396801,8321,8321,128,8396928,8388737,8388609,8193,0,8396800,8396800,8396929,129,0,8388736,8388609,1,8192,8388608,8396801,128,8388608,8193,8320,8388737,1,8320,8388736,8192,8396928,8396929,129,8388736,8388609,8396800,8396929,129,0,0,8396800,8320,8388736,8388737,1,8396801,8321,8321,128,8396929,129,1,8192,8388609,8193,8396928,8388737,8193,8320,8388608,8396801,128,8388608,8192,8396928],xz=[256,34078976,34078720,1107296512,524288,256,1073741824,34078720,1074266368,524288,33554688,1074266368,1107296512,1107820544,524544,1073741824,33554432,1074266112,1074266112,0,1073742080,1107820800,1107820800,33554688,1107820544,1073742080,0,1107296256,34078976,33554432,1107296256,524544,524288,1107296512,256,33554432,1073741824,34078720,1107296512,1074266368,33554688,1073741824,1107820544,34078976,1074266368,256,33554432,1107820544,1107820800,524544,1107296256,1107820800,34078720,0,1074266112,1107296256,524544,33554688,1073742080,524288,0,1074266112,34078976,1073742080],Ez=[536870928,541065216,16384,541081616,541065216,16,541081616,4194304,536887296,4210704,4194304,536870928,4194320,536887296,536870912,16400,0,4194320,536887312,16384,4210688,536887312,16,541065232,541065232,0,4210704,541081600,16400,4210688,541081600,536870912,536887296,16,541065232,4210688,541081616,4194304,16400,536870928,4194304,536887296,536870912,16400,536870928,541081616,4210688,541065216,4210704,541081600,0,541065232,16,16384,541065216,4210704,16384,4194320,536887312,0,541081600,536870912,4194320,536887312],vz=[2097152,69206018,67110914,0,2048,67110914,2099202,69208064,69208066,2097152,0,67108866,2,67108864,69206018,2050,67110912,2099202,2097154,67110912,67108866,69206016,69208064,2097154,69206016,2048,2050,69208066,2099200,2,67108864,2099200,67108864,2099200,2097152,67110914,67110914,69206018,69206018,2,2097154,67108864,67110912,2097152,69208064,2050,2099202,69208064,2050,67108866,69208066,69206016,2099200,0,2,69208066,0,2099202,69206016,2048,67108866,67110912,2048,2097154],_z=[268439616,4096,262144,268701760,268435456,268439616,64,268435456,262208,268697600,268701760,266240,268701696,266304,4096,64,268697600,268435520,268439552,4160,266240,262208,268697664,268701696,4160,0,0,268697664,268435520,268439552,266304,262144,266304,262144,268701696,4096,64,268697664,4096,266304,268439552,64,268435520,268697600,268697664,268435456,262144,268439616,0,268701760,262208,268435520,268697600,268439552,268439616,0,268701760,266240,266240,4160,4160,262208,268435456,268701696];function Sz(r){for(var e=[0,4,536870912,536870916,65536,65540,536936448,536936452,512,516,536871424,536871428,66048,66052,536936960,536936964],t=[0,1,1048576,1048577,67108864,67108865,68157440,68157441,256,257,1048832,1048833,67109120,67109121,68157696,68157697],n=[0,8,2048,2056,16777216,16777224,16779264,16779272,0,8,2048,2056,16777216,16777224,16779264,16779272],s=[0,2097152,134217728,136314880,8192,2105344,134225920,136323072,131072,2228224,134348800,136445952,139264,2236416,134356992,136454144],i=[0,262144,16,262160,0,262144,16,262160,4096,266240,4112,266256,4096,266240,4112,266256],o=[0,1024,32,1056,0,1024,32,1056,33554432,33555456,33554464,33555488,33554432,33555456,33554464,33555488],a=[0,268435456,524288,268959744,2,268435458,524290,268959746,0,268435456,524288,268959744,2,268435458,524290,268959746],c=[0,65536,2048,67584,536870912,536936448,536872960,536938496,131072,196608,133120,198656,537001984,537067520,537004032,537069568],l=[0,262144,0,262144,2,262146,2,262146,33554432,33816576,33554432,33816576,33554434,33816578,33554434,33816578],u=[0,268435456,8,268435464,0,268435456,8,268435464,1024,268436480,1032,268436488,1024,268436480,1032,268436488],f=[0,32,0,32,1048576,1048608,1048576,1048608,8192,8224,8192,8224,1056768,1056800,1056768,1056800],h=[0,16777216,512,16777728,2097152,18874368,2097664,18874880,67108864,83886080,67109376,83886592,69206016,85983232,69206528,85983744],p=[0,4096,134217728,134221824,524288,528384,134742016,134746112,16,4112,134217744,134221840,524304,528400,134742032,134746128],d=[0,4,256,260,0,4,256,260,1,5,257,261,1,5,257,261],m=r.length()>8?3:1,g=[],y=[0,0,1,1,1,1,1,1,0,1,1,1,1,1,1,0],b=0,w,v=0;v<m;v++){var x=r.getInt32(),_=r.getInt32();w=(x>>>4^_)&252645135,_^=w,x^=w<<4,w=(_>>>-16^x)&65535,x^=w,_^=w<<-16,w=(x>>>2^_)&858993459,_^=w,x^=w<<2,w=(_>>>-16^x)&65535,x^=w,_^=w<<-16,w=(x>>>1^_)&1431655765,_^=w,x^=w<<1,w=(_>>>8^x)&16711935,x^=w,_^=w<<8,w=(x>>>1^_)&1431655765,_^=w,x^=w<<1,w=x<<8|_>>>20&240,x=_<<24|_<<8&16711680|_>>>8&65280|_>>>24&240,_=w;for(var S=0;S<y.length;++S){y[S]?(x=x<<2|x>>>26,_=_<<2|_>>>26):(x=x<<1|x>>>27,_=_<<1|_>>>27),x&=-15,_&=-15;var A=e[x>>>28]|t[x>>>24&15]|n[x>>>20&15]|s[x>>>16&15]|i[x>>>12&15]|o[x>>>8&15]|a[x>>>4&15],D=c[_>>>28]|l[_>>>24&15]|u[_>>>20&15]|f[_>>>16&15]|h[_>>>12&15]|p[_>>>8&15]|d[_>>>4&15];w=(D>>>16^A)&65535,g[b++]=A^w,g[b++]=D^w<<16}}return g}function mv(r,e,t,n){var s=r.length===32?3:9,i;s===3?i=n?[30,-2,-2]:[0,32,2]:i=n?[94,62,-2,32,64,2,30,-2,-2]:[0,32,2,62,30,-2,64,96,2];var o,a=e[0],c=e[1];o=(a>>>4^c)&252645135,c^=o,a^=o<<4,o=(a>>>16^c)&65535,c^=o,a^=o<<16,o=(c>>>2^a)&858993459,a^=o,c^=o<<2,o=(c>>>8^a)&16711935,a^=o,c^=o<<8,o=(a>>>1^c)&1431655765,c^=o,a^=o<<1,a=a<<1|a>>>31,c=c<<1|c>>>31;for(var l=0;l<s;l+=3){for(var u=i[l+1],f=i[l+2],h=i[l];h!=u;h+=f){var p=c^r[h],d=(c>>>4|c<<28)^r[h+1];o=a,a=c,c=o^(yz[p>>>24&63]|wz[p>>>16&63]|Ez[p>>>8&63]|_z[p&63]|gz[d>>>24&63]|bz[d>>>16&63]|xz[d>>>8&63]|vz[d&63])}o=a,a=c,c=o}a=a>>>1|a<<31,c=c>>>1|c<<31,o=(a>>>1^c)&1431655765,c^=o,a^=o<<1,o=(c>>>8^a)&16711935,a^=o,c^=o<<8,o=(c>>>2^a)&858993459,a^=o,c^=o<<2,o=(a>>>16^c)&65535,c^=o,a^=o<<16,o=(a>>>4^c)&252645135,c^=o,a^=o<<4,t[0]=a,t[1]=c}function dd(r){r=r||{};var e=(r.mode||"CBC").toUpperCase(),t="DES-"+e,n;r.decrypt?n=Et.cipher.createDecipher(t,r.key):n=Et.cipher.createCipher(t,r.key);var s=n.start;return n.start=function(i,o){var a=null;o instanceof Et.util.ByteBuffer&&(a=o,o={}),o=o||{},o.output=a,o.iv=i,s.call(n,o)},n}});var sa=N((Zpe,bv)=>{var pd=rt();bv.exports=pd.md=pd.md||{};pd.md.algorithms=pd.md.algorithms||{}});var xv=N((Jpe,wv)=>{var fi=rt();sa();Ht();var Az=wv.exports=fi.hmac=fi.hmac||{};Az.create=function(){var r=null,e=null,t=null,n=null,s={};return s.start=function(i,o){if(i!==null)if(typeof i=="string")if(i=i.toLowerCase(),i in fi.md.algorithms)e=fi.md.algorithms[i].create();else throw new Error('Unknown hash algorithm "'+i+'"');else e=i;if(o===null)o=r;else{if(typeof o=="string")o=fi.util.createBuffer(o);else if(fi.util.isArray(o)){var a=o;o=fi.util.createBuffer();for(var c=0;c<a.length;++c)o.putByte(a[c])}var l=o.length();l>e.blockLength&&(e.start(),e.update(o.bytes()),o=e.digest()),t=fi.util.createBuffer(),n=fi.util.createBuffer(),l=o.length();for(var c=0;c<l;++c){var a=o.at(c);t.putByte(54^a),n.putByte(92^a)}if(l<e.blockLength)for(var a=e.blockLength-l,c=0;c<a;++c)t.putByte(54),n.putByte(92);r=o,t=t.bytes(),n=n.bytes()}e.start(),e.update(t)},s.update=function(i){e.update(i)},s.getMac=function(){var i=e.digest().bytes();return e.start(),e.update(n),e.update(i),e.digest()},s.digest=s.getMac,s}});var ia=N(()=>{});var V3=N((r1e,Ev)=>{var Or=rt();xv();sa();Ht();var Rz=Or.pkcs5=Or.pkcs5||{},hi;Or.util.isNodejs&&!Or.options.usePureJavaScript&&(hi=ia());Ev.exports=Or.pbkdf2=Rz.pbkdf2=function(r,e,t,n,s,i){if(typeof s=="function"&&(i=s,s=null),Or.util.isNodejs&&!Or.options.usePureJavaScript&&hi.pbkdf2&&(s===null||typeof s!="object")&&(hi.pbkdf2Sync.length>4||!s||s==="sha1"))return typeof s!="string"&&(s="sha1"),r=Buffer.from(r,"binary"),e=Buffer.from(e,"binary"),i?hi.pbkdf2Sync.length===4?hi.pbkdf2(r,e,t,n,function(w,v){if(w)return i(w);i(null,v.toString("binary"))}):hi.pbkdf2(r,e,t,n,s,function(w,v){if(w)return i(w);i(null,v.toString("binary"))}):hi.pbkdf2Sync.length===4?hi.pbkdf2Sync(r,e,t,n).toString("binary"):hi.pbkdf2Sync(r,e,t,n,s).toString("binary");if((typeof s>"u"||s===null)&&(s="sha1"),typeof s=="string"){if(!(s in Or.md.algorithms))throw new Error("Unknown hash algorithm: "+s);s=Or.md[s].create()}var o=s.digestLength;if(n>4294967295*o){var a=new Error("Derived key is too long.");if(i)return i(a);throw a}var c=Math.ceil(n/o),l=n-(c-1)*o,u=Or.hmac.create();u.start(s,r);var f="",h,p,d;if(!i){for(var m=1;m<=c;++m){u.start(null,null),u.update(e),u.update(Or.util.int32ToBytes(m)),h=d=u.digest().getBytes();for(var g=2;g<=t;++g)u.start(null,null),u.update(d),p=u.digest().getBytes(),h=Or.util.xorBytes(h,p,o),d=p;f+=m<c?h:h.substr(0,l)}return f}var m=1,g;function y(){if(m>c)return i(null,f);u.start(null,null),u.update(e),u.update(Or.util.int32ToBytes(m)),h=d=u.digest().getBytes(),g=2,b()}function b(){if(g<=t)return u.start(null,null),u.update(d),p=u.digest().getBytes(),h=Or.util.xorBytes(h,p,o),d=p,++g,Or.util.setImmediate(b);f+=m<c?h:h.substr(0,l),++m,y()}y()}});var Sv=N((n1e,_v)=>{var gd=rt();Ht();var vv=_v.exports=gd.pem=gd.pem||{};vv.encode=function(r,e){e=e||{};var t="-----BEGIN "+r.type+`-----\r
`,n;if(r.procType&&(n={name:"Proc-Type",values:[String(r.procType.version),r.procType.type]},t+=md(n)),r.contentDomain&&(n={name:"Content-Domain",values:[r.contentDomain]},t+=md(n)),r.dekInfo&&(n={name:"DEK-Info",values:[r.dekInfo.algorithm]},r.dekInfo.parameters&&n.values.push(r.dekInfo.parameters),t+=md(n)),r.headers)for(var s=0;s<r.headers.length;++s)t+=md(r.headers[s]);return r.procType&&(t+=`\r
`),t+=gd.util.encode64(r.body,e.maxline||64)+`\r
`,t+="-----END "+r.type+`-----\r
`,t};vv.decode=function(r){for(var e=[],t=/\s*-----BEGIN ([A-Z0-9- ]+)-----\r?\n?([\x21-\x7e\s]+?(?:\r?\n\r?\n))?([:A-Za-z0-9+\/=\s]+?)-----END \1-----/g,n=/([\x21-\x7e]+):\s*([\x21-\x7e\s^:]+)/,s=/\r?\n/,i;i=t.exec(r),!!i;){var o=i[1];o==="NEW CERTIFICATE REQUEST"&&(o="CERTIFICATE REQUEST");var a={type:o,procType:null,contentDomain:null,dekInfo:null,headers:[],body:gd.util.decode64(i[3])};if(e.push(a),!!i[2]){for(var c=i[2].split(s),l=0;i&&l<c.length;){for(var u=c[l].replace(/\s+$/,""),f=l+1;f<c.length;++f){var h=c[f];if(!/\s/.test(h[0]))break;u+=h,l=f}if(i=u.match(n),i){for(var p={name:i[1],values:[]},d=i[2].split(","),m=0;m<d.length;++m)p.values.push(Iz(d[m]));if(a.procType)if(!a.contentDomain&&p.name==="Content-Domain")a.contentDomain=d[0]||"";else if(!a.dekInfo&&p.name==="DEK-Info"){if(p.values.length===0)throw new Error('Invalid PEM formatted message. The "DEK-Info" header must have at least one subfield.');a.dekInfo={algorithm:d[0],parameters:d[1]||null}}else a.headers.push(p);else{if(p.name!=="Proc-Type")throw new Error('Invalid PEM formatted message. The first encapsulated header must be "Proc-Type".');if(p.values.length!==2)throw new Error('Invalid PEM formatted message. The "Proc-Type" header must have two subfields.');a.procType={version:d[0],type:d[1]}}}++l}if(a.procType==="ENCRYPTED"&&!a.dekInfo)throw new Error('Invalid PEM formatted message. The "DEK-Info" header must be present if "Proc-Type" is "ENCRYPTED".')}}if(e.length===0)throw new Error("Invalid PEM formatted message.");return e};function md(r){for(var e=r.name+": ",t=[],n=function(c,l){return" "+l},s=0;s<r.values.length;++s)t.push(r.values[s].replace(/^(\S+\r\n)/,n));e+=t.join(",")+`\r
`;for(var i=0,o=-1,s=0;s<e.length;++s,++i)if(i>65&&o!==-1){var a=e[o];a===","?(++o,e=e.substr(0,o)+`\r
 `+e.substr(o)):e=e.substr(0,o)+`\r
`+a+e.substr(o+1),i=s-o-1,o=-1,++s}else(e[s]===" "||e[s]==="	"||e[s]===",")&&(o=s);return e}function Iz(r){return r.replace(/^\s+/,"")}});var Cv=N((s1e,Dv)=>{var Cs=rt();sa();Ht();var Rv=Dv.exports=Cs.sha256=Cs.sha256||{};Cs.md.sha256=Cs.md.algorithms.sha256=Rv;Rv.create=function(){Iv||Tz();var r=null,e=Cs.util.createBuffer(),t=new Array(64),n={algorithm:"sha256",blockLength:64,digestLength:32,messageLength:0,fullMessageLength:null,messageLengthSize:8};return n.start=function(){n.messageLength=0,n.fullMessageLength=n.messageLength64=[];for(var s=n.messageLengthSize/4,i=0;i<s;++i)n.fullMessageLength.push(0);return e=Cs.util.createBuffer(),r={h0:1779033703,h1:3144134277,h2:1013904242,h3:2773480762,h4:1359893119,h5:2600822924,h6:528734635,h7:1541459225},n},n.start(),n.update=function(s,i){i==="utf8"&&(s=Cs.util.encodeUtf8(s));var o=s.length;n.messageLength+=o,o=[o/4294967296>>>0,o>>>0];for(var a=n.fullMessageLength.length-1;a>=0;--a)n.fullMessageLength[a]+=o[1],o[1]=o[0]+(n.fullMessageLength[a]/4294967296>>>0),n.fullMessageLength[a]=n.fullMessageLength[a]>>>0,o[0]=o[1]/4294967296>>>0;return e.putBytes(s),Av(r,t,e),(e.read>2048||e.length()===0)&&e.compact(),n},n.digest=function(){var s=Cs.util.createBuffer();s.putBytes(e.bytes());var i=n.fullMessageLength[n.fullMessageLength.length-1]+n.messageLengthSize,o=i&n.blockLength-1;s.putBytes(z3.substr(0,n.blockLength-o));for(var a,c,l=n.fullMessageLength[0]*8,u=0;u<n.fullMessageLength.length-1;++u)a=n.fullMessageLength[u+1]*8,c=a/4294967296>>>0,l+=c,s.putInt32(l>>>0),l=a>>>0;s.putInt32(l);var f={h0:r.h0,h1:r.h1,h2:r.h2,h3:r.h3,h4:r.h4,h5:r.h5,h6:r.h6,h7:r.h7};Av(f,t,s);var h=Cs.util.createBuffer();return h.putInt32(f.h0),h.putInt32(f.h1),h.putInt32(f.h2),h.putInt32(f.h3),h.putInt32(f.h4),h.putInt32(f.h5),h.putInt32(f.h6),h.putInt32(f.h7),h},n};var z3=null,Iv=!1,Tv=null;function Tz(){z3=String.fromCharCode(128),z3+=Cs.util.fillString(String.fromCharCode(0),64),Tv=[1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298],Iv=!0}function Av(r,e,t){for(var n,s,i,o,a,c,l,u,f,h,p,d,m,g,y,b=t.length();b>=64;){for(l=0;l<16;++l)e[l]=t.getInt32();for(;l<64;++l)n=e[l-2],n=(n>>>17|n<<15)^(n>>>19|n<<13)^n>>>10,s=e[l-15],s=(s>>>7|s<<25)^(s>>>18|s<<14)^s>>>3,e[l]=n+e[l-7]+s+e[l-16]|0;for(u=r.h0,f=r.h1,h=r.h2,p=r.h3,d=r.h4,m=r.h5,g=r.h6,y=r.h7,l=0;l<64;++l)o=(d>>>6|d<<26)^(d>>>11|d<<21)^(d>>>25|d<<7),a=g^d&(m^g),i=(u>>>2|u<<30)^(u>>>13|u<<19)^(u>>>22|u<<10),c=u&f|h&(u^f),n=y+o+a+Tv[l]+e[l],s=i+c,y=g,g=m,m=d,d=p+n>>>0,p=h,h=f,f=u,u=n+s>>>0;r.h0=r.h0+u|0,r.h1=r.h1+f|0,r.h2=r.h2+h|0,r.h3=r.h3+p|0,r.h4=r.h4+d|0,r.h5=r.h5+m|0,r.h6=r.h6+g|0,r.h7=r.h7+y|0,b-=64}}});var kv=N((i1e,Pv)=>{var Ps=rt();Ht();var yd=null;Ps.util.isNodejs&&!Ps.options.usePureJavaScript&&!process.versions["node-webkit"]&&(yd=ia());var Dz=Pv.exports=Ps.prng=Ps.prng||{};Dz.create=function(r){for(var e={plugin:r,key:null,seed:null,time:null,reseeds:0,generated:0,keyBytes:""},t=r.md,n=new Array(32),s=0;s<32;++s)n[s]=t.create();e.pools=n,e.pool=0,e.generate=function(l,u){if(!u)return e.generateSync(l);var f=e.plugin.cipher,h=e.plugin.increment,p=e.plugin.formatKey,d=e.plugin.formatSeed,m=Ps.util.createBuffer();e.key=null,g();function g(y){if(y)return u(y);if(m.length()>=l)return u(null,m.getBytes(l));if(e.generated>1048575&&(e.key=null),e.key===null)return Ps.util.nextTick(function(){i(g)});var b=f(e.key,e.seed);e.generated+=b.length,m.putBytes(b),e.key=p(f(e.key,h(e.seed))),e.seed=d(f(e.key,e.seed)),Ps.util.setImmediate(g)}},e.generateSync=function(l){var u=e.plugin.cipher,f=e.plugin.increment,h=e.plugin.formatKey,p=e.plugin.formatSeed;e.key=null;for(var d=Ps.util.createBuffer();d.length()<l;){e.generated>1048575&&(e.key=null),e.key===null&&o();var m=u(e.key,e.seed);e.generated+=m.length,d.putBytes(m),e.key=h(u(e.key,f(e.seed))),e.seed=p(u(e.key,e.seed))}return d.getBytes(l)};function i(l){if(e.pools[0].messageLength>=32)return a(),l();var u=32-e.pools[0].messageLength<<5;e.seedFile(u,function(f,h){if(f)return l(f);e.collect(h),a(),l()})}function o(){if(e.pools[0].messageLength>=32)return a();var l=32-e.pools[0].messageLength<<5;e.collect(e.seedFileSync(l)),a()}function a(){e.reseeds=e.reseeds===4294967295?0:e.reseeds+1;var l=e.plugin.md.create();l.update(e.keyBytes);for(var u=1,f=0;f<32;++f)e.reseeds%u===0&&(l.update(e.pools[f].digest().getBytes()),e.pools[f].start()),u=u<<1;e.keyBytes=l.digest().getBytes(),l.start(),l.update(e.keyBytes);var h=l.digest().getBytes();e.key=e.plugin.formatKey(e.keyBytes),e.seed=e.plugin.formatSeed(h),e.generated=0}function c(l){var u=null,f=Ps.util.globalScope,h=f.crypto||f.msCrypto;h&&h.getRandomValues&&(u=function(x){return h.getRandomValues(x)});var p=Ps.util.createBuffer();if(u)for(;p.length()<l;){var d=Math.max(1,Math.min(l-p.length(),65536)/4),m=new Uint32Array(Math.floor(d));try{u(m);for(var g=0;g<m.length;++g)p.putInt32(m[g])}catch(x){if(!(typeof QuotaExceededError<"u"&&x instanceof QuotaExceededError))throw x}}if(p.length()<l)for(var y,b,w,v=Math.floor(Math.random()*65536);p.length()<l;){b=16807*(v&65535),y=16807*(v>>16),b+=(y&32767)<<16,b+=y>>15,b=(b&2147483647)+(b>>31),v=b&4294967295;for(var g=0;g<3;++g)w=v>>>(g<<3),w^=Math.floor(Math.random()*256),p.putByte(w&255)}return p.getBytes(l)}return yd?(e.seedFile=function(l,u){yd.randomBytes(l,function(f,h){if(f)return u(f);u(null,h.toString())})},e.seedFileSync=function(l){return yd.randomBytes(l).toString()}):(e.seedFile=function(l,u){try{u(null,c(l))}catch(f){u(f)}},e.seedFileSync=c),e.collect=function(l){for(var u=l.length,f=0;f<u;++f)e.pools[e.pool].update(l.substr(f,1)),e.pool=e.pool===31?0:e.pool+1},e.collectInt=function(l,u){for(var f="",h=0;h<u;h+=8)f+=String.fromCharCode(l>>h&255);e.collect(f)},e.registerWorker=function(l){if(l===self)e.seedFile=function(f,h){function p(d){var m=d.data;m.forge&&m.forge.prng&&(self.removeEventListener("message",p),h(m.forge.prng.err,m.forge.prng.bytes))}self.addEventListener("message",p),self.postMessage({forge:{prng:{needed:f}}})};else{var u=function(f){var h=f.data;h.forge&&h.forge.prng&&e.seedFile(h.forge.prng.needed,function(p,d){l.postMessage({forge:{prng:{err:p,bytes:d}}})})};l.addEventListener("message",u)}},e}});var cf=N((o1e,q3)=>{var fr=rt();hd();Cv();kv();Ht();(function(){if(fr.random&&fr.random.getBytes){q3.exports=fr.random;return}(function(r){var e={},t=new Array(4),n=fr.util.createBuffer();e.formatKey=function(f){var h=fr.util.createBuffer(f);return f=new Array(4),f[0]=h.getInt32(),f[1]=h.getInt32(),f[2]=h.getInt32(),f[3]=h.getInt32(),fr.aes._expandKey(f,!1)},e.formatSeed=function(f){var h=fr.util.createBuffer(f);return f=new Array(4),f[0]=h.getInt32(),f[1]=h.getInt32(),f[2]=h.getInt32(),f[3]=h.getInt32(),f},e.cipher=function(f,h){return fr.aes._updateBlock(f,h,t,!1),n.putInt32(t[0]),n.putInt32(t[1]),n.putInt32(t[2]),n.putInt32(t[3]),n.getBytes()},e.increment=function(f){return++f[3],f},e.md=fr.md.sha256;function s(){var f=fr.prng.create(e);return f.getBytes=function(h,p){return f.generate(h,p)},f.getBytesSync=function(h){return f.generate(h)},f}var i=s(),o=null,a=fr.util.globalScope,c=a.crypto||a.msCrypto;if(c&&c.getRandomValues&&(o=function(f){return c.getRandomValues(f)}),fr.options.usePureJavaScript||!fr.util.isNodejs&&!o){if(typeof window>"u"||window.document,i.collectInt(+new Date,32),typeof navigator<"u"){var l="";for(var u in navigator)try{typeof navigator[u]=="string"&&(l+=navigator[u])}catch{}i.collect(l),l=null}r&&(r().mousemove(function(f){i.collectInt(f.clientX,16),i.collectInt(f.clientY,16)}),r().keypress(function(f){i.collectInt(f.charCode,8)}))}if(!fr.random)fr.random=i;else for(var u in i)fr.random[u]=i[u];fr.random.createInstance=s,q3.exports=fr.random})(typeof jQuery<"u"?jQuery:null)})()});var Bv=N((a1e,Lv)=>{var Gr=rt();Ht();var K3=[217,120,249,196,25,221,181,237,40,233,253,121,74,160,216,157,198,126,55,131,43,118,83,142,98,76,100,136,68,139,251,162,23,154,89,245,135,179,79,19,97,69,109,141,9,129,125,50,189,143,64,235,134,183,123,11,240,149,33,34,92,107,78,130,84,214,101,147,206,96,178,28,115,86,192,20,167,140,241,220,18,117,202,31,59,190,228,209,66,61,212,48,163,60,182,38,111,191,14,218,70,105,7,87,39,242,29,155,188,148,67,3,248,17,199,246,144,239,62,231,6,195,213,47,200,102,30,215,8,232,234,222,128,82,238,247,132,170,114,172,53,77,106,42,150,26,210,113,90,21,73,116,75,159,208,94,4,24,164,236,194,224,65,110,15,81,203,204,36,145,175,80,161,244,112,57,153,124,58,133,35,184,180,122,252,2,54,91,37,85,151,49,45,93,250,152,227,138,146,174,5,223,41,16,103,108,186,201,211,0,230,207,225,158,168,44,99,22,1,63,88,226,137,169,13,56,52,27,171,51,255,176,187,72,12,95,185,177,205,46,197,243,219,71,229,165,156,119,10,166,32,104,254,127,193,173],Nv=[1,2,3,5],Cz=function(r,e){return r<<e&65535|(r&65535)>>16-e},Pz=function(r,e){return(r&65535)>>e|r<<16-e&65535};Lv.exports=Gr.rc2=Gr.rc2||{};Gr.rc2.expandKey=function(r,e){typeof r=="string"&&(r=Gr.util.createBuffer(r)),e=e||128;var t=r,n=r.length(),s=e,i=Math.ceil(s/8),o=255>>(s&7),a;for(a=n;a<128;a++)t.putByte(K3[t.at(a-1)+t.at(a-n)&255]);for(t.setAt(128-i,K3[t.at(128-i)&o]),a=127-i;a>=0;a--)t.setAt(a,K3[t.at(a+1)^t.at(a+i)]);return t};var Ov=function(r,e,t){var n=!1,s=null,i=null,o=null,a,c,l,u,f=[];for(r=Gr.rc2.expandKey(r,e),l=0;l<64;l++)f.push(r.getInt16Le());t?(a=function(d){for(l=0;l<4;l++)d[l]+=f[u]+(d[(l+3)%4]&d[(l+2)%4])+(~d[(l+3)%4]&d[(l+1)%4]),d[l]=Cz(d[l],Nv[l]),u++},c=function(d){for(l=0;l<4;l++)d[l]+=f[d[(l+3)%4]&63]}):(a=function(d){for(l=3;l>=0;l--)d[l]=Pz(d[l],Nv[l]),d[l]-=f[u]+(d[(l+3)%4]&d[(l+2)%4])+(~d[(l+3)%4]&d[(l+1)%4]),u--},c=function(d){for(l=3;l>=0;l--)d[l]-=f[d[(l+3)%4]&63]});var h=function(d){var m=[];for(l=0;l<4;l++){var g=s.getInt16Le();o!==null&&(t?g^=o.getInt16Le():o.putInt16Le(g)),m.push(g&65535)}u=t?0:63;for(var y=0;y<d.length;y++)for(var b=0;b<d[y][0];b++)d[y][1](m);for(l=0;l<4;l++)o!==null&&(t?o.putInt16Le(m[l]):m[l]^=o.getInt16Le()),i.putInt16Le(m[l])},p=null;return p={start:function(d,m){d&&typeof d=="string"&&(d=Gr.util.createBuffer(d)),n=!1,s=Gr.util.createBuffer(),i=m||new Gr.util.createBuffer,o=d,p.output=i},update:function(d){for(n||s.putBuffer(d);s.length()>=8;)h([[5,a],[1,c],[6,a],[1,c],[5,a]])},finish:function(d){var m=!0;if(t)if(d)m=d(8,s,!t);else{var g=s.length()===8?8:8-s.length();s.fillWithByte(g,g)}if(m&&(n=!0,p.update()),!t&&(m=s.length()===0,m))if(d)m=d(8,i,!t);else{var y=i.length(),b=i.at(y-1);b>y?m=!1:i.truncate(b)}return m}},p};Gr.rc2.startEncrypting=function(r,e,t){var n=Gr.rc2.createEncryptionCipher(r,128);return n.start(e,t),n};Gr.rc2.createEncryptionCipher=function(r,e){return Ov(r,e,!0)};Gr.rc2.startDecrypting=function(r,e,t){var n=Gr.rc2.createDecryptionCipher(r,128);return n.start(e,t),n};Gr.rc2.createDecryptionCipher=function(r,e){return Ov(r,e,!1)}});var xd=N((c1e,$v)=>{var $3=rt();$v.exports=$3.jsbn=$3.jsbn||{};var di,kz=0xdeadbeefcafe,Mv=(kz&16777215)==15715070;function O(r,e,t){this.data=[],r!=null&&(typeof r=="number"?this.fromNumber(r,e,t):e==null&&typeof r!="string"?this.fromString(r,256):this.fromString(r,e))}$3.jsbn.BigInteger=O;function qe(){return new O(null)}function Nz(r,e,t,n,s,i){for(;--i>=0;){var o=e*this.data[r++]+t.data[n]+s;s=Math.floor(o/67108864),t.data[n++]=o&67108863}return s}function Oz(r,e,t,n,s,i){for(var o=e&32767,a=e>>15;--i>=0;){var c=this.data[r]&32767,l=this.data[r++]>>15,u=a*c+l*o;c=o*c+((u&32767)<<15)+t.data[n]+(s&1073741823),s=(c>>>30)+(u>>>15)+a*l+(s>>>30),t.data[n++]=c&1073741823}return s}function Uv(r,e,t,n,s,i){for(var o=e&16383,a=e>>14;--i>=0;){var c=this.data[r]&16383,l=this.data[r++]>>14,u=a*c+l*o;c=o*c+((u&16383)<<14)+t.data[n]+s,s=(c>>28)+(u>>14)+a*l,t.data[n++]=c&268435455}return s}typeof navigator>"u"?(O.prototype.am=Uv,di=28):Mv&&navigator.appName=="Microsoft Internet Explorer"?(O.prototype.am=Oz,di=30):Mv&&navigator.appName!="Netscape"?(O.prototype.am=Nz,di=26):(O.prototype.am=Uv,di=28);O.prototype.DB=di;O.prototype.DM=(1<<di)-1;O.prototype.DV=1<<di;var H3=52;O.prototype.FV=Math.pow(2,H3);O.prototype.F1=H3-di;O.prototype.F2=2*di-H3;var Lz="0123456789abcdefghijklmnopqrstuvwxyz",bd=new Array,Ic,Ln;Ic="0".charCodeAt(0);for(Ln=0;Ln<=9;++Ln)bd[Ic++]=Ln;Ic="a".charCodeAt(0);for(Ln=10;Ln<36;++Ln)bd[Ic++]=Ln;Ic="A".charCodeAt(0);for(Ln=10;Ln<36;++Ln)bd[Ic++]=Ln;function Fv(r){return Lz.charAt(r)}function Vv(r,e){var t=bd[r.charCodeAt(e)];return t??-1}function Bz(r){for(var e=this.t-1;e>=0;--e)r.data[e]=this.data[e];r.t=this.t,r.s=this.s}function Mz(r){this.t=1,this.s=r<0?-1:0,r>0?this.data[0]=r:r<-1?this.data[0]=r+this.DV:this.t=0}function Qi(r){var e=qe();return e.fromInt(r),e}function Uz(r,e){var t;if(e==16)t=4;else if(e==8)t=3;else if(e==256)t=8;else if(e==2)t=1;else if(e==32)t=5;else if(e==4)t=2;else{this.fromRadix(r,e);return}this.t=0,this.s=0;for(var n=r.length,s=!1,i=0;--n>=0;){var o=t==8?r[n]&255:Vv(r,n);if(o<0){r.charAt(n)=="-"&&(s=!0);continue}s=!1,i==0?this.data[this.t++]=o:i+t>this.DB?(this.data[this.t-1]|=(o&(1<<this.DB-i)-1)<<i,this.data[this.t++]=o>>this.DB-i):this.data[this.t-1]|=o<<i,i+=t,i>=this.DB&&(i-=this.DB)}t==8&&r[0]&128&&(this.s=-1,i>0&&(this.data[this.t-1]|=(1<<this.DB-i)-1<<i)),this.clamp(),s&&O.ZERO.subTo(this,this)}function Fz(){for(var r=this.s&this.DM;this.t>0&&this.data[this.t-1]==r;)--this.t}function Vz(r){if(this.s<0)return"-"+this.negate().toString(r);var e;if(r==16)e=4;else if(r==8)e=3;else if(r==2)e=1;else if(r==32)e=5;else if(r==4)e=2;else return this.toRadix(r);var t=(1<<e)-1,n,s=!1,i="",o=this.t,a=this.DB-o*this.DB%e;if(o-- >0)for(a<this.DB&&(n=this.data[o]>>a)>0&&(s=!0,i=Fv(n));o>=0;)a<e?(n=(this.data[o]&(1<<a)-1)<<e-a,n|=this.data[--o]>>(a+=this.DB-e)):(n=this.data[o]>>(a-=e)&t,a<=0&&(a+=this.DB,--o)),n>0&&(s=!0),s&&(i+=Fv(n));return s?i:"0"}function zz(){var r=qe();return O.ZERO.subTo(this,r),r}function qz(){return this.s<0?this.negate():this}function Kz(r){var e=this.s-r.s;if(e!=0)return e;var t=this.t;if(e=t-r.t,e!=0)return this.s<0?-e:e;for(;--t>=0;)if((e=this.data[t]-r.data[t])!=0)return e;return 0}function wd(r){var e=1,t;return(t=r>>>16)!=0&&(r=t,e+=16),(t=r>>8)!=0&&(r=t,e+=8),(t=r>>4)!=0&&(r=t,e+=4),(t=r>>2)!=0&&(r=t,e+=2),(t=r>>1)!=0&&(r=t,e+=1),e}function $z(){return this.t<=0?0:this.DB*(this.t-1)+wd(this.data[this.t-1]^this.s&this.DM)}function Hz(r,e){var t;for(t=this.t-1;t>=0;--t)e.data[t+r]=this.data[t];for(t=r-1;t>=0;--t)e.data[t]=0;e.t=this.t+r,e.s=this.s}function Gz(r,e){for(var t=r;t<this.t;++t)e.data[t-r]=this.data[t];e.t=Math.max(this.t-r,0),e.s=this.s}function Wz(r,e){var t=r%this.DB,n=this.DB-t,s=(1<<n)-1,i=Math.floor(r/this.DB),o=this.s<<t&this.DM,a;for(a=this.t-1;a>=0;--a)e.data[a+i+1]=this.data[a]>>n|o,o=(this.data[a]&s)<<t;for(a=i-1;a>=0;--a)e.data[a]=0;e.data[i]=o,e.t=this.t+i+1,e.s=this.s,e.clamp()}function Yz(r,e){e.s=this.s;var t=Math.floor(r/this.DB);if(t>=this.t){e.t=0;return}var n=r%this.DB,s=this.DB-n,i=(1<<n)-1;e.data[0]=this.data[t]>>n;for(var o=t+1;o<this.t;++o)e.data[o-t-1]|=(this.data[o]&i)<<s,e.data[o-t]=this.data[o]>>n;n>0&&(e.data[this.t-t-1]|=(this.s&i)<<s),e.t=this.t-t,e.clamp()}function Qz(r,e){for(var t=0,n=0,s=Math.min(r.t,this.t);t<s;)n+=this.data[t]-r.data[t],e.data[t++]=n&this.DM,n>>=this.DB;if(r.t<this.t){for(n-=r.s;t<this.t;)n+=this.data[t],e.data[t++]=n&this.DM,n>>=this.DB;n+=this.s}else{for(n+=this.s;t<r.t;)n-=r.data[t],e.data[t++]=n&this.DM,n>>=this.DB;n-=r.s}e.s=n<0?-1:0,n<-1?e.data[t++]=this.DV+n:n>0&&(e.data[t++]=n),e.t=t,e.clamp()}function Xz(r,e){var t=this.abs(),n=r.abs(),s=t.t;for(e.t=s+n.t;--s>=0;)e.data[s]=0;for(s=0;s<n.t;++s)e.data[s+t.t]=t.am(0,n.data[s],e,s,0,t.t);e.s=0,e.clamp(),this.s!=r.s&&O.ZERO.subTo(e,e)}function jz(r){for(var e=this.abs(),t=r.t=2*e.t;--t>=0;)r.data[t]=0;for(t=0;t<e.t-1;++t){var n=e.am(t,e.data[t],r,2*t,0,1);(r.data[t+e.t]+=e.am(t+1,2*e.data[t],r,2*t+1,n,e.t-t-1))>=e.DV&&(r.data[t+e.t]-=e.DV,r.data[t+e.t+1]=1)}r.t>0&&(r.data[r.t-1]+=e.am(t,e.data[t],r,2*t,0,1)),r.s=0,r.clamp()}function Zz(r,e,t){var n=r.abs();if(!(n.t<=0)){var s=this.abs();if(s.t<n.t){e?.fromInt(0),t!=null&&this.copyTo(t);return}t==null&&(t=qe());var i=qe(),o=this.s,a=r.s,c=this.DB-wd(n.data[n.t-1]);c>0?(n.lShiftTo(c,i),s.lShiftTo(c,t)):(n.copyTo(i),s.copyTo(t));var l=i.t,u=i.data[l-1];if(u!=0){var f=u*(1<<this.F1)+(l>1?i.data[l-2]>>this.F2:0),h=this.FV/f,p=(1<<this.F1)/f,d=1<<this.F2,m=t.t,g=m-l,y=e??qe();for(i.dlShiftTo(g,y),t.compareTo(y)>=0&&(t.data[t.t++]=1,t.subTo(y,t)),O.ONE.dlShiftTo(l,y),y.subTo(i,i);i.t<l;)i.data[i.t++]=0;for(;--g>=0;){var b=t.data[--m]==u?this.DM:Math.floor(t.data[m]*h+(t.data[m-1]+d)*p);if((t.data[m]+=i.am(0,b,t,g,0,l))<b)for(i.dlShiftTo(g,y),t.subTo(y,t);t.data[m]<--b;)t.subTo(y,t)}e!=null&&(t.drShiftTo(l,e),o!=a&&O.ZERO.subTo(e,e)),t.t=l,t.clamp(),c>0&&t.rShiftTo(c,t),o<0&&O.ZERO.subTo(t,t)}}}function Jz(r){var e=qe();return this.abs().divRemTo(r,null,e),this.s<0&&e.compareTo(O.ZERO)>0&&r.subTo(e,e),e}function oa(r){this.m=r}function eq(r){return r.s<0||r.compareTo(this.m)>=0?r.mod(this.m):r}function tq(r){return r}function rq(r){r.divRemTo(this.m,null,r)}function nq(r,e,t){r.multiplyTo(e,t),this.reduce(t)}function sq(r,e){r.squareTo(e),this.reduce(e)}oa.prototype.convert=eq;oa.prototype.revert=tq;oa.prototype.reduce=rq;oa.prototype.mulTo=nq;oa.prototype.sqrTo=sq;function iq(){if(this.t<1)return 0;var r=this.data[0];if(!(r&1))return 0;var e=r&3;return e=e*(2-(r&15)*e)&15,e=e*(2-(r&255)*e)&255,e=e*(2-((r&65535)*e&65535))&65535,e=e*(2-r*e%this.DV)%this.DV,e>0?this.DV-e:-e}function aa(r){this.m=r,this.mp=r.invDigit(),this.mpl=this.mp&32767,this.mph=this.mp>>15,this.um=(1<<r.DB-15)-1,this.mt2=2*r.t}function oq(r){var e=qe();return r.abs().dlShiftTo(this.m.t,e),e.divRemTo(this.m,null,e),r.s<0&&e.compareTo(O.ZERO)>0&&this.m.subTo(e,e),e}function aq(r){var e=qe();return r.copyTo(e),this.reduce(e),e}function cq(r){for(;r.t<=this.mt2;)r.data[r.t++]=0;for(var e=0;e<this.m.t;++e){var t=r.data[e]&32767,n=t*this.mpl+((t*this.mph+(r.data[e]>>15)*this.mpl&this.um)<<15)&r.DM;for(t=e+this.m.t,r.data[t]+=this.m.am(0,n,r,e,0,this.m.t);r.data[t]>=r.DV;)r.data[t]-=r.DV,r.data[++t]++}r.clamp(),r.drShiftTo(this.m.t,r),r.compareTo(this.m)>=0&&r.subTo(this.m,r)}function lq(r,e){r.squareTo(e),this.reduce(e)}function uq(r,e,t){r.multiplyTo(e,t),this.reduce(t)}aa.prototype.convert=oq;aa.prototype.revert=aq;aa.prototype.reduce=cq;aa.prototype.mulTo=uq;aa.prototype.sqrTo=lq;function fq(){return(this.t>0?this.data[0]&1:this.s)==0}function hq(r,e){if(r>4294967295||r<1)return O.ONE;var t=qe(),n=qe(),s=e.convert(this),i=wd(r)-1;for(s.copyTo(t);--i>=0;)if(e.sqrTo(t,n),(r&1<<i)>0)e.mulTo(n,s,t);else{var o=t;t=n,n=o}return e.revert(t)}function dq(r,e){var t;return r<256||e.isEven()?t=new oa(e):t=new aa(e),this.exp(r,t)}O.prototype.copyTo=Bz;O.prototype.fromInt=Mz;O.prototype.fromString=Uz;O.prototype.clamp=Fz;O.prototype.dlShiftTo=Hz;O.prototype.drShiftTo=Gz;O.prototype.lShiftTo=Wz;O.prototype.rShiftTo=Yz;O.prototype.subTo=Qz;O.prototype.multiplyTo=Xz;O.prototype.squareTo=jz;O.prototype.divRemTo=Zz;O.prototype.invDigit=iq;O.prototype.isEven=fq;O.prototype.exp=hq;O.prototype.toString=Vz;O.prototype.negate=zz;O.prototype.abs=qz;O.prototype.compareTo=Kz;O.prototype.bitLength=$z;O.prototype.mod=Jz;O.prototype.modPowInt=dq;O.ZERO=Qi(0);O.ONE=Qi(1);function pq(){var r=qe();return this.copyTo(r),r}function mq(){if(this.s<0){if(this.t==1)return this.data[0]-this.DV;if(this.t==0)return-1}else{if(this.t==1)return this.data[0];if(this.t==0)return 0}return(this.data[1]&(1<<32-this.DB)-1)<<this.DB|this.data[0]}function gq(){return this.t==0?this.s:this.data[0]<<24>>24}function yq(){return this.t==0?this.s:this.data[0]<<16>>16}function bq(r){return Math.floor(Math.LN2*this.DB/Math.log(r))}function wq(){return this.s<0?-1:this.t<=0||this.t==1&&this.data[0]<=0?0:1}function xq(r){if(r==null&&(r=10),this.signum()==0||r<2||r>36)return"0";var e=this.chunkSize(r),t=Math.pow(r,e),n=Qi(t),s=qe(),i=qe(),o="";for(this.divRemTo(n,s,i);s.signum()>0;)o=(t+i.intValue()).toString(r).substr(1)+o,s.divRemTo(n,s,i);return i.intValue().toString(r)+o}function Eq(r,e){this.fromInt(0),e==null&&(e=10);for(var t=this.chunkSize(e),n=Math.pow(e,t),s=!1,i=0,o=0,a=0;a<r.length;++a){var c=Vv(r,a);if(c<0){r.charAt(a)=="-"&&this.signum()==0&&(s=!0);continue}o=e*o+c,++i>=t&&(this.dMultiply(n),this.dAddOffset(o,0),i=0,o=0)}i>0&&(this.dMultiply(Math.pow(e,i)),this.dAddOffset(o,0)),s&&O.ZERO.subTo(this,this)}function vq(r,e,t){if(typeof e=="number")if(r<2)this.fromInt(1);else for(this.fromNumber(r,t),this.testBit(r-1)||this.bitwiseTo(O.ONE.shiftLeft(r-1),G3,this),this.isEven()&&this.dAddOffset(1,0);!this.isProbablePrime(e);)this.dAddOffset(2,0),this.bitLength()>r&&this.subTo(O.ONE.shiftLeft(r-1),this);else{var n=new Array,s=r&7;n.length=(r>>3)+1,e.nextBytes(n),s>0?n[0]&=(1<<s)-1:n[0]=0,this.fromString(n,256)}}function _q(){var r=this.t,e=new Array;e[0]=this.s;var t=this.DB-r*this.DB%8,n,s=0;if(r-- >0)for(t<this.DB&&(n=this.data[r]>>t)!=(this.s&this.DM)>>t&&(e[s++]=n|this.s<<this.DB-t);r>=0;)t<8?(n=(this.data[r]&(1<<t)-1)<<8-t,n|=this.data[--r]>>(t+=this.DB-8)):(n=this.data[r]>>(t-=8)&255,t<=0&&(t+=this.DB,--r)),n&128&&(n|=-256),s==0&&(this.s&128)!=(n&128)&&++s,(s>0||n!=this.s)&&(e[s++]=n);return e}function Sq(r){return this.compareTo(r)==0}function Aq(r){return this.compareTo(r)<0?this:r}function Rq(r){return this.compareTo(r)>0?this:r}function Iq(r,e,t){var n,s,i=Math.min(r.t,this.t);for(n=0;n<i;++n)t.data[n]=e(this.data[n],r.data[n]);if(r.t<this.t){for(s=r.s&this.DM,n=i;n<this.t;++n)t.data[n]=e(this.data[n],s);t.t=this.t}else{for(s=this.s&this.DM,n=i;n<r.t;++n)t.data[n]=e(s,r.data[n]);t.t=r.t}t.s=e(this.s,r.s),t.clamp()}function Tq(r,e){return r&e}function Dq(r){var e=qe();return this.bitwiseTo(r,Tq,e),e}function G3(r,e){return r|e}function Cq(r){var e=qe();return this.bitwiseTo(r,G3,e),e}function zv(r,e){return r^e}function Pq(r){var e=qe();return this.bitwiseTo(r,zv,e),e}function qv(r,e){return r&~e}function kq(r){var e=qe();return this.bitwiseTo(r,qv,e),e}function Nq(){for(var r=qe(),e=0;e<this.t;++e)r.data[e]=this.DM&~this.data[e];return r.t=this.t,r.s=~this.s,r}function Oq(r){var e=qe();return r<0?this.rShiftTo(-r,e):this.lShiftTo(r,e),e}function Lq(r){var e=qe();return r<0?this.lShiftTo(-r,e):this.rShiftTo(r,e),e}function Bq(r){if(r==0)return-1;var e=0;return r&65535||(r>>=16,e+=16),r&255||(r>>=8,e+=8),r&15||(r>>=4,e+=4),r&3||(r>>=2,e+=2),r&1||++e,e}function Mq(){for(var r=0;r<this.t;++r)if(this.data[r]!=0)return r*this.DB+Bq(this.data[r]);return this.s<0?this.t*this.DB:-1}function Uq(r){for(var e=0;r!=0;)r&=r-1,++e;return e}function Fq(){for(var r=0,e=this.s&this.DM,t=0;t<this.t;++t)r+=Uq(this.data[t]^e);return r}function Vq(r){var e=Math.floor(r/this.DB);return e>=this.t?this.s!=0:(this.data[e]&1<<r%this.DB)!=0}function zq(r,e){var t=O.ONE.shiftLeft(r);return this.bitwiseTo(t,e,t),t}function qq(r){return this.changeBit(r,G3)}function Kq(r){return this.changeBit(r,qv)}function $q(r){return this.changeBit(r,zv)}function Hq(r,e){for(var t=0,n=0,s=Math.min(r.t,this.t);t<s;)n+=this.data[t]+r.data[t],e.data[t++]=n&this.DM,n>>=this.DB;if(r.t<this.t){for(n+=r.s;t<this.t;)n+=this.data[t],e.data[t++]=n&this.DM,n>>=this.DB;n+=this.s}else{for(n+=this.s;t<r.t;)n+=r.data[t],e.data[t++]=n&this.DM,n>>=this.DB;n+=r.s}e.s=n<0?-1:0,n>0?e.data[t++]=n:n<-1&&(e.data[t++]=this.DV+n),e.t=t,e.clamp()}function Gq(r){var e=qe();return this.addTo(r,e),e}function Wq(r){var e=qe();return this.subTo(r,e),e}function Yq(r){var e=qe();return this.multiplyTo(r,e),e}function Qq(r){var e=qe();return this.divRemTo(r,e,null),e}function Xq(r){var e=qe();return this.divRemTo(r,null,e),e}function jq(r){var e=qe(),t=qe();return this.divRemTo(r,e,t),new Array(e,t)}function Zq(r){this.data[this.t]=this.am(0,r-1,this,0,0,this.t),++this.t,this.clamp()}function Jq(r,e){if(r!=0){for(;this.t<=e;)this.data[this.t++]=0;for(this.data[e]+=r;this.data[e]>=this.DV;)this.data[e]-=this.DV,++e>=this.t&&(this.data[this.t++]=0),++this.data[e]}}function lf(){}function Kv(r){return r}function eK(r,e,t){r.multiplyTo(e,t)}function tK(r,e){r.squareTo(e)}lf.prototype.convert=Kv;lf.prototype.revert=Kv;lf.prototype.mulTo=eK;lf.prototype.sqrTo=tK;function rK(r){return this.exp(r,new lf)}function nK(r,e,t){var n=Math.min(this.t+r.t,e);for(t.s=0,t.t=n;n>0;)t.data[--n]=0;var s;for(s=t.t-this.t;n<s;++n)t.data[n+this.t]=this.am(0,r.data[n],t,n,0,this.t);for(s=Math.min(r.t,e);n<s;++n)this.am(0,r.data[n],t,n,0,e-n);t.clamp()}function sK(r,e,t){--e;var n=t.t=this.t+r.t-e;for(t.s=0;--n>=0;)t.data[n]=0;for(n=Math.max(e-this.t,0);n<r.t;++n)t.data[this.t+n-e]=this.am(e-n,r.data[n],t,0,0,this.t+n-e);t.clamp(),t.drShiftTo(1,t)}function Tc(r){this.r2=qe(),this.q3=qe(),O.ONE.dlShiftTo(2*r.t,this.r2),this.mu=this.r2.divide(r),this.m=r}function iK(r){if(r.s<0||r.t>2*this.m.t)return r.mod(this.m);if(r.compareTo(this.m)<0)return r;var e=qe();return r.copyTo(e),this.reduce(e),e}function oK(r){return r}function aK(r){for(r.drShiftTo(this.m.t-1,this.r2),r.t>this.m.t+1&&(r.t=this.m.t+1,r.clamp()),this.mu.multiplyUpperTo(this.r2,this.m.t+1,this.q3),this.m.multiplyLowerTo(this.q3,this.m.t+1,this.r2);r.compareTo(this.r2)<0;)r.dAddOffset(1,this.m.t+1);for(r.subTo(this.r2,r);r.compareTo(this.m)>=0;)r.subTo(this.m,r)}function cK(r,e){r.squareTo(e),this.reduce(e)}function lK(r,e,t){r.multiplyTo(e,t),this.reduce(t)}Tc.prototype.convert=iK;Tc.prototype.revert=oK;Tc.prototype.reduce=aK;Tc.prototype.mulTo=lK;Tc.prototype.sqrTo=cK;function uK(r,e){var t=r.bitLength(),n,s=Qi(1),i;if(t<=0)return s;t<18?n=1:t<48?n=3:t<144?n=4:t<768?n=5:n=6,t<8?i=new oa(e):e.isEven()?i=new Tc(e):i=new aa(e);var o=new Array,a=3,c=n-1,l=(1<<n)-1;if(o[1]=i.convert(this),n>1){var u=qe();for(i.sqrTo(o[1],u);a<=l;)o[a]=qe(),i.mulTo(u,o[a-2],o[a]),a+=2}var f=r.t-1,h,p=!0,d=qe(),m;for(t=wd(r.data[f])-1;f>=0;){for(t>=c?h=r.data[f]>>t-c&l:(h=(r.data[f]&(1<<t+1)-1)<<c-t,f>0&&(h|=r.data[f-1]>>this.DB+t-c)),a=n;!(h&1);)h>>=1,--a;if((t-=a)<0&&(t+=this.DB,--f),p)o[h].copyTo(s),p=!1;else{for(;a>1;)i.sqrTo(s,d),i.sqrTo(d,s),a-=2;a>0?i.sqrTo(s,d):(m=s,s=d,d=m),i.mulTo(d,o[h],s)}for(;f>=0&&!(r.data[f]&1<<t);)i.sqrTo(s,d),m=s,s=d,d=m,--t<0&&(t=this.DB-1,--f)}return i.revert(s)}function fK(r){var e=this.s<0?this.negate():this.clone(),t=r.s<0?r.negate():r.clone();if(e.compareTo(t)<0){var n=e;e=t,t=n}var s=e.getLowestSetBit(),i=t.getLowestSetBit();if(i<0)return e;for(s<i&&(i=s),i>0&&(e.rShiftTo(i,e),t.rShiftTo(i,t));e.signum()>0;)(s=e.getLowestSetBit())>0&&e.rShiftTo(s,e),(s=t.getLowestSetBit())>0&&t.rShiftTo(s,t),e.compareTo(t)>=0?(e.subTo(t,e),e.rShiftTo(1,e)):(t.subTo(e,t),t.rShiftTo(1,t));return i>0&&t.lShiftTo(i,t),t}function hK(r){if(r<=0)return 0;var e=this.DV%r,t=this.s<0?r-1:0;if(this.t>0)if(e==0)t=this.data[0]%r;else for(var n=this.t-1;n>=0;--n)t=(e*t+this.data[n])%r;return t}function dK(r){var e=r.isEven();if(this.isEven()&&e||r.signum()==0)return O.ZERO;for(var t=r.clone(),n=this.clone(),s=Qi(1),i=Qi(0),o=Qi(0),a=Qi(1);t.signum()!=0;){for(;t.isEven();)t.rShiftTo(1,t),e?((!s.isEven()||!i.isEven())&&(s.addTo(this,s),i.subTo(r,i)),s.rShiftTo(1,s)):i.isEven()||i.subTo(r,i),i.rShiftTo(1,i);for(;n.isEven();)n.rShiftTo(1,n),e?((!o.isEven()||!a.isEven())&&(o.addTo(this,o),a.subTo(r,a)),o.rShiftTo(1,o)):a.isEven()||a.subTo(r,a),a.rShiftTo(1,a);t.compareTo(n)>=0?(t.subTo(n,t),e&&s.subTo(o,s),i.subTo(a,i)):(n.subTo(t,n),e&&o.subTo(s,o),a.subTo(i,a))}if(n.compareTo(O.ONE)!=0)return O.ZERO;if(a.compareTo(r)>=0)return a.subtract(r);if(a.signum()<0)a.addTo(r,a);else return a;return a.signum()<0?a.add(r):a}var ns=[2,3,5,7,11,13,17,19,23,29,31,37,41,43,47,53,59,61,67,71,73,79,83,89,97,101,103,107,109,113,127,131,137,139,149,151,157,163,167,173,179,181,191,193,197,199,211,223,227,229,233,239,241,251,257,263,269,271,277,281,283,293,307,311,313,317,331,337,347,349,353,359,367,373,379,383,389,397,401,409,419,421,431,433,439,443,449,457,461,463,467,479,487,491,499,503,509],pK=(1<<26)/ns[ns.length-1];function mK(r){var e,t=this.abs();if(t.t==1&&t.data[0]<=ns[ns.length-1]){for(e=0;e<ns.length;++e)if(t.data[0]==ns[e])return!0;return!1}if(t.isEven())return!1;for(e=1;e<ns.length;){for(var n=ns[e],s=e+1;s<ns.length&&n<pK;)n*=ns[s++];for(n=t.modInt(n);e<s;)if(n%ns[e++]==0)return!1}return t.millerRabin(r)}function gK(r){var e=this.subtract(O.ONE),t=e.getLowestSetBit();if(t<=0)return!1;for(var n=e.shiftRight(t),s=yK(),i,o=0;o<r;++o){do i=new O(this.bitLength(),s);while(i.compareTo(O.ONE)<=0||i.compareTo(e)>=0);var a=i.modPow(n,this);if(a.compareTo(O.ONE)!=0&&a.compareTo(e)!=0){for(var c=1;c++<t&&a.compareTo(e)!=0;)if(a=a.modPowInt(2,this),a.compareTo(O.ONE)==0)return!1;if(a.compareTo(e)!=0)return!1}}return!0}function yK(){return{nextBytes:function(r){for(var e=0;e<r.length;++e)r[e]=Math.floor(Math.random()*256)}}}O.prototype.chunkSize=bq;O.prototype.toRadix=xq;O.prototype.fromRadix=Eq;O.prototype.fromNumber=vq;O.prototype.bitwiseTo=Iq;O.prototype.changeBit=zq;O.prototype.addTo=Hq;O.prototype.dMultiply=Zq;O.prototype.dAddOffset=Jq;O.prototype.multiplyLowerTo=nK;O.prototype.multiplyUpperTo=sK;O.prototype.modInt=hK;O.prototype.millerRabin=gK;O.prototype.clone=pq;O.prototype.intValue=mq;O.prototype.byteValue=gq;O.prototype.shortValue=yq;O.prototype.signum=wq;O.prototype.toByteArray=_q;O.prototype.equals=Sq;O.prototype.min=Aq;O.prototype.max=Rq;O.prototype.and=Dq;O.prototype.or=Cq;O.prototype.xor=Pq;O.prototype.andNot=kq;O.prototype.not=Nq;O.prototype.shiftLeft=Oq;O.prototype.shiftRight=Lq;O.prototype.getLowestSetBit=Mq;O.prototype.bitCount=Fq;O.prototype.testBit=Vq;O.prototype.setBit=qq;O.prototype.clearBit=Kq;O.prototype.flipBit=$q;O.prototype.add=Gq;O.prototype.subtract=Wq;O.prototype.multiply=Yq;O.prototype.divide=Qq;O.prototype.remainder=Xq;O.prototype.divideAndRemainder=jq;O.prototype.modPow=uK;O.prototype.modInverse=dK;O.prototype.pow=rK;O.prototype.gcd=fK;O.prototype.isProbablePrime=mK});var Qv=N((l1e,Yv)=>{var ks=rt();sa();Ht();var Gv=Yv.exports=ks.sha1=ks.sha1||{};ks.md.sha1=ks.md.algorithms.sha1=Gv;Gv.create=function(){Wv||bK();var r=null,e=ks.util.createBuffer(),t=new Array(80),n={algorithm:"sha1",blockLength:64,digestLength:20,messageLength:0,fullMessageLength:null,messageLengthSize:8};return n.start=function(){n.messageLength=0,n.fullMessageLength=n.messageLength64=[];for(var s=n.messageLengthSize/4,i=0;i<s;++i)n.fullMessageLength.push(0);return e=ks.util.createBuffer(),r={h0:1732584193,h1:4023233417,h2:2562383102,h3:271733878,h4:3285377520},n},n.start(),n.update=function(s,i){i==="utf8"&&(s=ks.util.encodeUtf8(s));var o=s.length;n.messageLength+=o,o=[o/4294967296>>>0,o>>>0];for(var a=n.fullMessageLength.length-1;a>=0;--a)n.fullMessageLength[a]+=o[1],o[1]=o[0]+(n.fullMessageLength[a]/4294967296>>>0),n.fullMessageLength[a]=n.fullMessageLength[a]>>>0,o[0]=o[1]/4294967296>>>0;return e.putBytes(s),Hv(r,t,e),(e.read>2048||e.length()===0)&&e.compact(),n},n.digest=function(){var s=ks.util.createBuffer();s.putBytes(e.bytes());var i=n.fullMessageLength[n.fullMessageLength.length-1]+n.messageLengthSize,o=i&n.blockLength-1;s.putBytes(W3.substr(0,n.blockLength-o));for(var a,c,l=n.fullMessageLength[0]*8,u=0;u<n.fullMessageLength.length-1;++u)a=n.fullMessageLength[u+1]*8,c=a/4294967296>>>0,l+=c,s.putInt32(l>>>0),l=a>>>0;s.putInt32(l);var f={h0:r.h0,h1:r.h1,h2:r.h2,h3:r.h3,h4:r.h4};Hv(f,t,s);var h=ks.util.createBuffer();return h.putInt32(f.h0),h.putInt32(f.h1),h.putInt32(f.h2),h.putInt32(f.h3),h.putInt32(f.h4),h},n};var W3=null,Wv=!1;function bK(){W3=String.fromCharCode(128),W3+=ks.util.fillString(String.fromCharCode(0),64),Wv=!0}function Hv(r,e,t){for(var n,s,i,o,a,c,l,u,f=t.length();f>=64;){for(s=r.h0,i=r.h1,o=r.h2,a=r.h3,c=r.h4,u=0;u<16;++u)n=t.getInt32(),e[u]=n,l=a^i&(o^a),n=(s<<5|s>>>27)+l+c+1518500249+n,c=a,a=o,o=(i<<30|i>>>2)>>>0,i=s,s=n;for(;u<20;++u)n=e[u-3]^e[u-8]^e[u-14]^e[u-16],n=n<<1|n>>>31,e[u]=n,l=a^i&(o^a),n=(s<<5|s>>>27)+l+c+1518500249+n,c=a,a=o,o=(i<<30|i>>>2)>>>0,i=s,s=n;for(;u<32;++u)n=e[u-3]^e[u-8]^e[u-14]^e[u-16],n=n<<1|n>>>31,e[u]=n,l=i^o^a,n=(s<<5|s>>>27)+l+c+1859775393+n,c=a,a=o,o=(i<<30|i>>>2)>>>0,i=s,s=n;for(;u<40;++u)n=e[u-6]^e[u-16]^e[u-28]^e[u-32],n=n<<2|n>>>30,e[u]=n,l=i^o^a,n=(s<<5|s>>>27)+l+c+1859775393+n,c=a,a=o,o=(i<<30|i>>>2)>>>0,i=s,s=n;for(;u<60;++u)n=e[u-6]^e[u-16]^e[u-28]^e[u-32],n=n<<2|n>>>30,e[u]=n,l=i&o|a&(i^o),n=(s<<5|s>>>27)+l+c+2400959708+n,c=a,a=o,o=(i<<30|i>>>2)>>>0,i=s,s=n;for(;u<80;++u)n=e[u-6]^e[u-16]^e[u-28]^e[u-32],n=n<<2|n>>>30,e[u]=n,l=i^o^a,n=(s<<5|s>>>27)+l+c+3395469782+n,c=a,a=o,o=(i<<30|i>>>2)>>>0,i=s,s=n;r.h0=r.h0+s|0,r.h1=r.h1+i|0,r.h2=r.h2+o|0,r.h3=r.h3+a|0,r.h4=r.h4+c|0,f-=64}}});var Zv=N((u1e,jv)=>{var Ns=rt();Ht();cf();Qv();var Xv=jv.exports=Ns.pkcs1=Ns.pkcs1||{};Xv.encode_rsa_oaep=function(r,e,t){var n,s,i,o;typeof t=="string"?(n=t,s=arguments[3]||void 0,i=arguments[4]||void 0):t&&(n=t.label||void 0,s=t.seed||void 0,i=t.md||void 0,t.mgf1&&t.mgf1.md&&(o=t.mgf1.md)),i?i.start():i=Ns.md.sha1.create(),o||(o=i);var a=Math.ceil(r.n.bitLength()/8),c=a-2*i.digestLength-2;if(e.length>c){var l=new Error("RSAES-OAEP input message length is too long.");throw l.length=e.length,l.maxLength=c,l}n||(n=""),i.update(n,"raw");for(var u=i.digest(),f="",h=c-e.length,p=0;p<h;p++)f+="\0";var d=u.getBytes()+f+""+e;if(!s)s=Ns.random.getBytes(i.digestLength);else if(s.length!==i.digestLength){var l=new Error("Invalid RSAES-OAEP seed. The seed length must match the digest length.");throw l.seedLength=s.length,l.digestLength=i.digestLength,l}var m=Ed(s,a-i.digestLength-1,o),g=Ns.util.xorBytes(d,m,d.length),y=Ed(g,i.digestLength,o),b=Ns.util.xorBytes(s,y,s.length);return"\0"+b+g};Xv.decode_rsa_oaep=function(r,e,t){var n,s,i;typeof t=="string"?(n=t,s=arguments[3]||void 0):t&&(n=t.label||void 0,s=t.md||void 0,t.mgf1&&t.mgf1.md&&(i=t.mgf1.md));var o=Math.ceil(r.n.bitLength()/8);if(e.length!==o){var g=new Error("RSAES-OAEP encoded message length is invalid.");throw g.length=e.length,g.expectedLength=o,g}if(s===void 0?s=Ns.md.sha1.create():s.start(),i||(i=s),o<2*s.digestLength+2)throw new Error("RSAES-OAEP key is too short for the hash function.");n||(n=""),s.update(n,"raw");for(var a=s.digest().getBytes(),c=e.charAt(0),l=e.substring(1,s.digestLength+1),u=e.substring(1+s.digestLength),f=Ed(u,s.digestLength,i),h=Ns.util.xorBytes(l,f,l.length),p=Ed(h,o-s.digestLength-1,i),d=Ns.util.xorBytes(u,p,u.length),m=d.substring(0,s.digestLength),g=c!=="\0",y=0;y<s.digestLength;++y)g|=a.charAt(y)!==m.charAt(y);for(var b=1,w=s.digestLength,v=s.digestLength;v<d.length;v++){var x=d.charCodeAt(v),_=x&1^1,S=b?65534:0;g|=x&S,b=b&_,w+=b}if(g||d.charCodeAt(w)!==1)throw new Error("Invalid RSAES-OAEP padding.");return d.substring(w+1)};function Ed(r,e,t){t||(t=Ns.md.sha1.create());for(var n="",s=Math.ceil(e/t.digestLength),i=0;i<s;++i){var o=String.fromCharCode(i>>24&255,i>>16&255,i>>8&255,i&255);t.start(),t.update(r+o),n+=t.digest().getBytes()}return n.substring(0,e)}});var Jv=N((f1e,Y3)=>{var Xi=rt();Ht();xd();cf();(function(){if(Xi.prime){Y3.exports=Xi.prime;return}var r=Y3.exports=Xi.prime=Xi.prime||{},e=Xi.jsbn.BigInteger,t=[6,4,2,4,2,4,6,2],n=new e(null);n.fromInt(30);var s=function(f,h){return f|h};r.generateProbablePrime=function(f,h,p){typeof h=="function"&&(p=h,h={}),h=h||{};var d=h.algorithm||"PRIMEINC";typeof d=="string"&&(d={name:d}),d.options=d.options||{};var m=h.prng||Xi.random,g={nextBytes:function(y){for(var b=m.getBytesSync(y.length),w=0;w<y.length;++w)y[w]=b.charCodeAt(w)}};if(d.name==="PRIMEINC")return i(f,g,d.options,p);throw new Error("Invalid prime generation algorithm: "+d.name)};function i(f,h,p,d){return"workers"in p?c(f,h,p,d):o(f,h,p,d)}function o(f,h,p,d){var m=l(f,h),g=0,y=u(m.bitLength());"millerRabinTests"in p&&(y=p.millerRabinTests);var b=10;"maxBlockTime"in p&&(b=p.maxBlockTime),a(m,f,h,g,y,b,d)}function a(f,h,p,d,m,g,y){var b=+new Date;do{if(f.bitLength()>h&&(f=l(h,p)),f.isProbablePrime(m))return y(null,f);f.dAddOffset(t[d++%8],0)}while(g<0||+new Date-b<g);Xi.util.setImmediate(function(){a(f,h,p,d,m,g,y)})}function c(f,h,p,d){if(typeof Worker>"u")return o(f,h,p,d);var m=l(f,h),g=p.workers,y=p.workLoad||100,b=y*30/8,w=p.workerScript||"forge/prime.worker.js";if(g===-1)return Xi.util.estimateCores(function(x,_){x&&(_=2),g=_-1,v()});v();function v(){g=Math.max(1,g);for(var x=[],_=0;_<g;++_)x[_]=new Worker(w);for(var S=g,_=0;_<g;++_)x[_].addEventListener("message",D);var A=!1;function D(H){if(!A){--S;var ee=H.data;if(ee.found){for(var j=0;j<x.length;++j)x[j].terminate();return A=!0,d(null,new e(ee.prime,16))}m.bitLength()>f&&(m=l(f,h));var ie=m.toString(16);H.target.postMessage({hex:ie,workLoad:y}),m.dAddOffset(b,0)}}}}function l(f,h){var p=new e(f,h),d=f-1;return p.testBit(d)||p.bitwiseTo(e.ONE.shiftLeft(d),s,p),p.dAddOffset(31-p.mod(n).byteValue(),0),p}function u(f){return f<=100?27:f<=150?18:f<=200?15:f<=250?12:f<=300?9:f<=350?8:f<=400?7:f<=500?6:f<=600?5:f<=800?4:f<=1250?3:2}})()});var _d=N((h1e,o_)=>{var ue=rt();af();xd();ad();Zv();Jv();cf();Ht();typeof Le>"u"&&(Le=ue.jsbn.BigInteger);var Le,Q3=ue.util.isNodejs?ia():null,T=ue.asn1,Bn=ue.util;ue.pki=ue.pki||{};o_.exports=ue.pki.rsa=ue.rsa=ue.rsa||{};var xe=ue.pki,wK=[6,4,2,4,2,4,6,2],xK={name:"PrivateKeyInfo",tagClass:T.Class.UNIVERSAL,type:T.Type.SEQUENCE,constructed:!0,value:[{name:"PrivateKeyInfo.version",tagClass:T.Class.UNIVERSAL,type:T.Type.INTEGER,constructed:!1,capture:"privateKeyVersion"},{name:"PrivateKeyInfo.privateKeyAlgorithm",tagClass:T.Class.UNIVERSAL,type:T.Type.SEQUENCE,constructed:!0,value:[{name:"AlgorithmIdentifier.algorithm",tagClass:T.Class.UNIVERSAL,type:T.Type.OID,constructed:!1,capture:"privateKeyOid"}]},{name:"PrivateKeyInfo",tagClass:T.Class.UNIVERSAL,type:T.Type.OCTETSTRING,constructed:!1,capture:"privateKey"}]},EK={name:"RSAPrivateKey",tagClass:T.Class.UNIVERSAL,type:T.Type.SEQUENCE,constructed:!0,value:[{name:"RSAPrivateKey.version",tagClass:T.Class.UNIVERSAL,type:T.Type.INTEGER,constructed:!1,capture:"privateKeyVersion"},{name:"RSAPrivateKey.modulus",tagClass:T.Class.UNIVERSAL,type:T.Type.INTEGER,constructed:!1,capture:"privateKeyModulus"},{name:"RSAPrivateKey.publicExponent",tagClass:T.Class.UNIVERSAL,type:T.Type.INTEGER,constructed:!1,capture:"privateKeyPublicExponent"},{name:"RSAPrivateKey.privateExponent",tagClass:T.Class.UNIVERSAL,type:T.Type.INTEGER,constructed:!1,capture:"privateKeyPrivateExponent"},{name:"RSAPrivateKey.prime1",tagClass:T.Class.UNIVERSAL,type:T.Type.INTEGER,constructed:!1,capture:"privateKeyPrime1"},{name:"RSAPrivateKey.prime2",tagClass:T.Class.UNIVERSAL,type:T.Type.INTEGER,constructed:!1,capture:"privateKeyPrime2"},{name:"RSAPrivateKey.exponent1",tagClass:T.Class.UNIVERSAL,type:T.Type.INTEGER,constructed:!1,capture:"privateKeyExponent1"},{name:"RSAPrivateKey.exponent2",tagClass:T.Class.UNIVERSAL,type:T.Type.INTEGER,constructed:!1,capture:"privateKeyExponent2"},{name:"RSAPrivateKey.coefficient",tagClass:T.Class.UNIVERSAL,type:T.Type.INTEGER,constructed:!1,capture:"privateKeyCoefficient"}]},vK={name:"RSAPublicKey",tagClass:T.Class.UNIVERSAL,type:T.Type.SEQUENCE,constructed:!0,value:[{name:"RSAPublicKey.modulus",tagClass:T.Class.UNIVERSAL,type:T.Type.INTEGER,constructed:!1,capture:"publicKeyModulus"},{name:"RSAPublicKey.exponent",tagClass:T.Class.UNIVERSAL,type:T.Type.INTEGER,constructed:!1,capture:"publicKeyExponent"}]},_K=ue.pki.rsa.publicKeyValidator={name:"SubjectPublicKeyInfo",tagClass:T.Class.UNIVERSAL,type:T.Type.SEQUENCE,constructed:!0,captureAsn1:"subjectPublicKeyInfo",value:[{name:"SubjectPublicKeyInfo.AlgorithmIdentifier",tagClass:T.Class.UNIVERSAL,type:T.Type.SEQUENCE,constructed:!0,value:[{name:"AlgorithmIdentifier.algorithm",tagClass:T.Class.UNIVERSAL,type:T.Type.OID,constructed:!1,capture:"publicKeyOid"}]},{name:"SubjectPublicKeyInfo.subjectPublicKey",tagClass:T.Class.UNIVERSAL,type:T.Type.BITSTRING,constructed:!1,value:[{name:"SubjectPublicKeyInfo.subjectPublicKey.RSAPublicKey",tagClass:T.Class.UNIVERSAL,type:T.Type.SEQUENCE,constructed:!0,optional:!0,captureAsn1:"rsaPublicKey"}]}]},SK={name:"DigestInfo",tagClass:T.Class.UNIVERSAL,type:T.Type.SEQUENCE,constructed:!0,value:[{name:"DigestInfo.DigestAlgorithm",tagClass:T.Class.UNIVERSAL,type:T.Type.SEQUENCE,constructed:!0,value:[{name:"DigestInfo.DigestAlgorithm.algorithmIdentifier",tagClass:T.Class.UNIVERSAL,type:T.Type.OID,constructed:!1,capture:"algorithmIdentifier"},{name:"DigestInfo.DigestAlgorithm.parameters",tagClass:T.Class.UNIVERSAL,type:T.Type.NULL,capture:"parameters",optional:!0,constructed:!1}]},{name:"DigestInfo.digest",tagClass:T.Class.UNIVERSAL,type:T.Type.OCTETSTRING,constructed:!1,capture:"digest"}]},AK=function(r){var e;if(r.algorithm in xe.oids)e=xe.oids[r.algorithm];else{var t=new Error("Unknown message digest algorithm.");throw t.algorithm=r.algorithm,t}var n=T.oidToDer(e).getBytes(),s=T.create(T.Class.UNIVERSAL,T.Type.SEQUENCE,!0,[]),i=T.create(T.Class.UNIVERSAL,T.Type.SEQUENCE,!0,[]);i.value.push(T.create(T.Class.UNIVERSAL,T.Type.OID,!1,n)),i.value.push(T.create(T.Class.UNIVERSAL,T.Type.NULL,!1,""));var o=T.create(T.Class.UNIVERSAL,T.Type.OCTETSTRING,!1,r.digest().getBytes());return s.value.push(i),s.value.push(o),T.toDer(s).getBytes()},s_=function(r,e,t){if(t)return r.modPow(e.e,e.n);if(!e.p||!e.q)return r.modPow(e.d,e.n);e.dP||(e.dP=e.d.mod(e.p.subtract(Le.ONE))),e.dQ||(e.dQ=e.d.mod(e.q.subtract(Le.ONE))),e.qInv||(e.qInv=e.q.modInverse(e.p));var n;do n=new Le(ue.util.bytesToHex(ue.random.getBytes(e.n.bitLength()/8)),16);while(n.compareTo(e.n)>=0||!n.gcd(e.n).equals(Le.ONE));r=r.multiply(n.modPow(e.e,e.n)).mod(e.n);for(var s=r.mod(e.p).modPow(e.dP,e.p),i=r.mod(e.q).modPow(e.dQ,e.q);s.compareTo(i)<0;)s=s.add(e.p);var o=s.subtract(i).multiply(e.qInv).mod(e.p).multiply(e.q).add(i);return o=o.multiply(n.modInverse(e.n)).mod(e.n),o};xe.rsa.encrypt=function(r,e,t){var n=t,s,i=Math.ceil(e.n.bitLength()/8);t!==!1&&t!==!0?(n=t===2,s=i_(r,e,t)):(s=ue.util.createBuffer(),s.putBytes(r));for(var o=new Le(s.toHex(),16),a=s_(o,e,n),c=a.toString(16),l=ue.util.createBuffer(),u=i-Math.ceil(c.length/2);u>0;)l.putByte(0),--u;return l.putBytes(ue.util.hexToBytes(c)),l.getBytes()};xe.rsa.decrypt=function(r,e,t,n){var s=Math.ceil(e.n.bitLength()/8);if(r.length!==s){var i=new Error("Encrypted message length is invalid.");throw i.length=r.length,i.expected=s,i}var o=new Le(ue.util.createBuffer(r).toHex(),16);if(o.compareTo(e.n)>=0)throw new Error("Encrypted message is invalid.");for(var a=s_(o,e,t),c=a.toString(16),l=ue.util.createBuffer(),u=s-Math.ceil(c.length/2);u>0;)l.putByte(0),--u;return l.putBytes(ue.util.hexToBytes(c)),n!==!1?vd(l.getBytes(),e,t):l.getBytes()};xe.rsa.createKeyPairGenerationState=function(r,e,t){typeof r=="string"&&(r=parseInt(r,10)),r=r||2048,t=t||{};var n=t.prng||ue.random,s={nextBytes:function(a){for(var c=n.getBytesSync(a.length),l=0;l<a.length;++l)a[l]=c.charCodeAt(l)}},i=t.algorithm||"PRIMEINC",o;if(i==="PRIMEINC")o={algorithm:i,state:0,bits:r,rng:s,eInt:e||65537,e:new Le(null),p:null,q:null,qBits:r>>1,pBits:r-(r>>1),pqState:0,num:null,keys:null},o.e.fromInt(o.eInt);else throw new Error("Invalid key generation algorithm: "+i);return o};xe.rsa.stepKeyPairGenerationState=function(r,e){"algorithm"in r||(r.algorithm="PRIMEINC");var t=new Le(null);t.fromInt(30);for(var n=0,s=function(f,h){return f|h},i=+new Date,o,a=0;r.keys===null&&(e<=0||a<e);){if(r.state===0){var c=r.p===null?r.pBits:r.qBits,l=c-1;r.pqState===0?(r.num=new Le(c,r.rng),r.num.testBit(l)||r.num.bitwiseTo(Le.ONE.shiftLeft(l),s,r.num),r.num.dAddOffset(31-r.num.mod(t).byteValue(),0),n=0,++r.pqState):r.pqState===1?r.num.bitLength()>c?r.pqState=0:r.num.isProbablePrime(IK(r.num.bitLength()))?++r.pqState:r.num.dAddOffset(wK[n++%8],0):r.pqState===2?r.pqState=r.num.subtract(Le.ONE).gcd(r.e).compareTo(Le.ONE)===0?3:0:r.pqState===3&&(r.pqState=0,r.p===null?r.p=r.num:r.q=r.num,r.p!==null&&r.q!==null&&++r.state,r.num=null)}else if(r.state===1)r.p.compareTo(r.q)<0&&(r.num=r.p,r.p=r.q,r.q=r.num),++r.state;else if(r.state===2)r.p1=r.p.subtract(Le.ONE),r.q1=r.q.subtract(Le.ONE),r.phi=r.p1.multiply(r.q1),++r.state;else if(r.state===3)r.phi.gcd(r.e).compareTo(Le.ONE)===0?++r.state:(r.p=null,r.q=null,r.state=0);else if(r.state===4)r.n=r.p.multiply(r.q),r.n.bitLength()===r.bits?++r.state:(r.q=null,r.state=0);else if(r.state===5){var u=r.e.modInverse(r.phi);r.keys={privateKey:xe.rsa.setPrivateKey(r.n,r.e,u,r.p,r.q,u.mod(r.p1),u.mod(r.q1),r.q.modInverse(r.p)),publicKey:xe.rsa.setPublicKey(r.n,r.e)}}o=+new Date,a+=o-i,i=o}return r.keys!==null};xe.rsa.generateKeyPair=function(r,e,t,n){if(arguments.length===1?typeof r=="object"?(t=r,r=void 0):typeof r=="function"&&(n=r,r=void 0):arguments.length===2?typeof r=="number"?typeof e=="function"?(n=e,e=void 0):typeof e!="number"&&(t=e,e=void 0):(t=r,n=e,r=void 0,e=void 0):arguments.length===3&&(typeof e=="number"?typeof t=="function"&&(n=t,t=void 0):(n=t,t=e,e=void 0)),t=t||{},r===void 0&&(r=t.bits||2048),e===void 0&&(e=t.e||65537),!ue.options.usePureJavaScript&&!t.prng&&r>=256&&r<=16384&&(e===65537||e===3)){if(n){if(e_("generateKeyPair"))return Q3.generateKeyPair("rsa",{modulusLength:r,publicExponent:e,publicKeyEncoding:{type:"spki",format:"pem"},privateKeyEncoding:{type:"pkcs8",format:"pem"}},function(a,c,l){if(a)return n(a);n(null,{privateKey:xe.privateKeyFromPem(l),publicKey:xe.publicKeyFromPem(c)})});if(t_("generateKey")&&t_("exportKey"))return Bn.globalScope.crypto.subtle.generateKey({name:"RSASSA-PKCS1-v1_5",modulusLength:r,publicExponent:n_(e),hash:{name:"SHA-256"}},!0,["sign","verify"]).then(function(a){return Bn.globalScope.crypto.subtle.exportKey("pkcs8",a.privateKey)}).then(void 0,function(a){n(a)}).then(function(a){if(a){var c=xe.privateKeyFromAsn1(T.fromDer(ue.util.createBuffer(a)));n(null,{privateKey:c,publicKey:xe.setRsaPublicKey(c.n,c.e)})}});if(r_("generateKey")&&r_("exportKey")){var s=Bn.globalScope.msCrypto.subtle.generateKey({name:"RSASSA-PKCS1-v1_5",modulusLength:r,publicExponent:n_(e),hash:{name:"SHA-256"}},!0,["sign","verify"]);s.oncomplete=function(a){var c=a.target.result,l=Bn.globalScope.msCrypto.subtle.exportKey("pkcs8",c.privateKey);l.oncomplete=function(u){var f=u.target.result,h=xe.privateKeyFromAsn1(T.fromDer(ue.util.createBuffer(f)));n(null,{privateKey:h,publicKey:xe.setRsaPublicKey(h.n,h.e)})},l.onerror=function(u){n(u)}},s.onerror=function(a){n(a)};return}}else if(e_("generateKeyPairSync")){var i=Q3.generateKeyPairSync("rsa",{modulusLength:r,publicExponent:e,publicKeyEncoding:{type:"spki",format:"pem"},privateKeyEncoding:{type:"pkcs8",format:"pem"}});return{privateKey:xe.privateKeyFromPem(i.privateKey),publicKey:xe.publicKeyFromPem(i.publicKey)}}}var o=xe.rsa.createKeyPairGenerationState(r,e,t);if(!n)return xe.rsa.stepKeyPairGenerationState(o,0),o.keys;RK(o,t,n)};xe.setRsaPublicKey=xe.rsa.setPublicKey=function(r,e){var t={n:r,e};return t.encrypt=function(n,s,i){if(typeof s=="string"?s=s.toUpperCase():s===void 0&&(s="RSAES-PKCS1-V1_5"),s==="RSAES-PKCS1-V1_5")s={encode:function(a,c,l){return i_(a,c,2).getBytes()}};else if(s==="RSA-OAEP"||s==="RSAES-OAEP")s={encode:function(a,c){return ue.pkcs1.encode_rsa_oaep(c,a,i)}};else if(["RAW","NONE","NULL",null].indexOf(s)!==-1)s={encode:function(a){return a}};else if(typeof s=="string")throw new Error('Unsupported encryption scheme: "'+s+'".');var o=s.encode(n,t,!0);return xe.rsa.encrypt(o,t,!0)},t.verify=function(n,s,i,o){typeof i=="string"?i=i.toUpperCase():i===void 0&&(i="RSASSA-PKCS1-V1_5"),o===void 0&&(o={_parseAllDigestBytes:!0}),"_parseAllDigestBytes"in o||(o._parseAllDigestBytes=!0),i==="RSASSA-PKCS1-V1_5"?i={verify:function(c,l){l=vd(l,t,!0);var u=T.fromDer(l,{parseAllBytes:o._parseAllDigestBytes}),f={},h=[];if(!T.validate(u,SK,f,h)){var p=new Error("ASN.1 object does not contain a valid RSASSA-PKCS1-v1_5 DigestInfo value.");throw p.errors=h,p}var d=T.derToOid(f.algorithmIdentifier);if(!(d===ue.oids.md2||d===ue.oids.md5||d===ue.oids.sha1||d===ue.oids.sha224||d===ue.oids.sha256||d===ue.oids.sha384||d===ue.oids.sha512||d===ue.oids["sha512-224"]||d===ue.oids["sha512-256"])){var p=new Error("Unknown RSASSA-PKCS1-v1_5 DigestAlgorithm identifier.");throw p.oid=d,p}if((d===ue.oids.md2||d===ue.oids.md5)&&!("parameters"in f))throw new Error("ASN.1 object does not contain a valid RSASSA-PKCS1-v1_5 DigestInfo value. Missing algorithm identifer NULL parameters.");return c===f.digest}}:(i==="NONE"||i==="NULL"||i===null)&&(i={verify:function(c,l){return l=vd(l,t,!0),c===l}});var a=xe.rsa.decrypt(s,t,!0,!1);return i.verify(n,a,t.n.bitLength())},t};xe.setRsaPrivateKey=xe.rsa.setPrivateKey=function(r,e,t,n,s,i,o,a){var c={n:r,e,d:t,p:n,q:s,dP:i,dQ:o,qInv:a};return c.decrypt=function(l,u,f){typeof u=="string"?u=u.toUpperCase():u===void 0&&(u="RSAES-PKCS1-V1_5");var h=xe.rsa.decrypt(l,c,!1,!1);if(u==="RSAES-PKCS1-V1_5")u={decode:vd};else if(u==="RSA-OAEP"||u==="RSAES-OAEP")u={decode:function(p,d){return ue.pkcs1.decode_rsa_oaep(d,p,f)}};else if(["RAW","NONE","NULL",null].indexOf(u)!==-1)u={decode:function(p){return p}};else throw new Error('Unsupported encryption scheme: "'+u+'".');return u.decode(h,c,!1)},c.sign=function(l,u){var f=!1;typeof u=="string"&&(u=u.toUpperCase()),u===void 0||u==="RSASSA-PKCS1-V1_5"?(u={encode:AK},f=1):(u==="NONE"||u==="NULL"||u===null)&&(u={encode:function(){return l}},f=1);var h=u.encode(l,c.n.bitLength());return xe.rsa.encrypt(h,c,f)},c};xe.wrapRsaPrivateKey=function(r){return T.create(T.Class.UNIVERSAL,T.Type.SEQUENCE,!0,[T.create(T.Class.UNIVERSAL,T.Type.INTEGER,!1,T.integerToDer(0).getBytes()),T.create(T.Class.UNIVERSAL,T.Type.SEQUENCE,!0,[T.create(T.Class.UNIVERSAL,T.Type.OID,!1,T.oidToDer(xe.oids.rsaEncryption).getBytes()),T.create(T.Class.UNIVERSAL,T.Type.NULL,!1,"")]),T.create(T.Class.UNIVERSAL,T.Type.OCTETSTRING,!1,T.toDer(r).getBytes())])};xe.privateKeyFromAsn1=function(r){var e={},t=[];if(T.validate(r,xK,e,t)&&(r=T.fromDer(ue.util.createBuffer(e.privateKey))),e={},t=[],!T.validate(r,EK,e,t)){var n=new Error("Cannot read private key. ASN.1 object does not contain an RSAPrivateKey.");throw n.errors=t,n}var s,i,o,a,c,l,u,f;return s=ue.util.createBuffer(e.privateKeyModulus).toHex(),i=ue.util.createBuffer(e.privateKeyPublicExponent).toHex(),o=ue.util.createBuffer(e.privateKeyPrivateExponent).toHex(),a=ue.util.createBuffer(e.privateKeyPrime1).toHex(),c=ue.util.createBuffer(e.privateKeyPrime2).toHex(),l=ue.util.createBuffer(e.privateKeyExponent1).toHex(),u=ue.util.createBuffer(e.privateKeyExponent2).toHex(),f=ue.util.createBuffer(e.privateKeyCoefficient).toHex(),xe.setRsaPrivateKey(new Le(s,16),new Le(i,16),new Le(o,16),new Le(a,16),new Le(c,16),new Le(l,16),new Le(u,16),new Le(f,16))};xe.privateKeyToAsn1=xe.privateKeyToRSAPrivateKey=function(r){return T.create(T.Class.UNIVERSAL,T.Type.SEQUENCE,!0,[T.create(T.Class.UNIVERSAL,T.Type.INTEGER,!1,T.integerToDer(0).getBytes()),T.create(T.Class.UNIVERSAL,T.Type.INTEGER,!1,Os(r.n)),T.create(T.Class.UNIVERSAL,T.Type.INTEGER,!1,Os(r.e)),T.create(T.Class.UNIVERSAL,T.Type.INTEGER,!1,Os(r.d)),T.create(T.Class.UNIVERSAL,T.Type.INTEGER,!1,Os(r.p)),T.create(T.Class.UNIVERSAL,T.Type.INTEGER,!1,Os(r.q)),T.create(T.Class.UNIVERSAL,T.Type.INTEGER,!1,Os(r.dP)),T.create(T.Class.UNIVERSAL,T.Type.INTEGER,!1,Os(r.dQ)),T.create(T.Class.UNIVERSAL,T.Type.INTEGER,!1,Os(r.qInv))])};xe.publicKeyFromAsn1=function(r){var e={},t=[];if(T.validate(r,_K,e,t)){var n=T.derToOid(e.publicKeyOid);if(n!==xe.oids.rsaEncryption){var s=new Error("Cannot read public key. Unknown OID.");throw s.oid=n,s}r=e.rsaPublicKey}if(t=[],!T.validate(r,vK,e,t)){var s=new Error("Cannot read public key. ASN.1 object does not contain an RSAPublicKey.");throw s.errors=t,s}var i=ue.util.createBuffer(e.publicKeyModulus).toHex(),o=ue.util.createBuffer(e.publicKeyExponent).toHex();return xe.setRsaPublicKey(new Le(i,16),new Le(o,16))};xe.publicKeyToAsn1=xe.publicKeyToSubjectPublicKeyInfo=function(r){return T.create(T.Class.UNIVERSAL,T.Type.SEQUENCE,!0,[T.create(T.Class.UNIVERSAL,T.Type.SEQUENCE,!0,[T.create(T.Class.UNIVERSAL,T.Type.OID,!1,T.oidToDer(xe.oids.rsaEncryption).getBytes()),T.create(T.Class.UNIVERSAL,T.Type.NULL,!1,"")]),T.create(T.Class.UNIVERSAL,T.Type.BITSTRING,!1,[xe.publicKeyToRSAPublicKey(r)])])};xe.publicKeyToRSAPublicKey=function(r){return T.create(T.Class.UNIVERSAL,T.Type.SEQUENCE,!0,[T.create(T.Class.UNIVERSAL,T.Type.INTEGER,!1,Os(r.n)),T.create(T.Class.UNIVERSAL,T.Type.INTEGER,!1,Os(r.e))])};function i_(r,e,t){var n=ue.util.createBuffer(),s=Math.ceil(e.n.bitLength()/8);if(r.length>s-11){var i=new Error("Message is too long for PKCS#1 v1.5 padding.");throw i.length=r.length,i.max=s-11,i}n.putByte(0),n.putByte(t);var o=s-3-r.length,a;if(t===0||t===1){a=t===0?0:255;for(var c=0;c<o;++c)n.putByte(a)}else for(;o>0;){for(var l=0,u=ue.random.getBytes(o),c=0;c<o;++c)a=u.charCodeAt(c),a===0?++l:n.putByte(a);o=l}return n.putByte(0),n.putBytes(r),n}function vd(r,e,t,n){var s=Math.ceil(e.n.bitLength()/8),i=ue.util.createBuffer(r),o=i.getByte(),a=i.getByte();if(o!==0||t&&a!==0&&a!==1||!t&&a!=2||t&&a===0&&typeof n>"u")throw new Error("Encryption block is invalid.");var c=0;if(a===0){c=s-3-n;for(var l=0;l<c;++l)if(i.getByte()!==0)throw new Error("Encryption block is invalid.")}else if(a===1)for(c=0;i.length()>1;){if(i.getByte()!==255){--i.read;break}++c}else if(a===2)for(c=0;i.length()>1;){if(i.getByte()===0){--i.read;break}++c}var u=i.getByte();if(u!==0||c!==s-3-i.length())throw new Error("Encryption block is invalid.");return i.getBytes()}function RK(r,e,t){typeof e=="function"&&(t=e,e={}),e=e||{};var n={algorithm:{name:e.algorithm||"PRIMEINC",options:{workers:e.workers||2,workLoad:e.workLoad||100,workerScript:e.workerScript}}};"prng"in e&&(n.prng=e.prng),s();function s(){i(r.pBits,function(a,c){if(a)return t(a);if(r.p=c,r.q!==null)return o(a,r.q);i(r.qBits,o)})}function i(a,c){ue.prime.generateProbablePrime(a,n,c)}function o(a,c){if(a)return t(a);if(r.q=c,r.p.compareTo(r.q)<0){var l=r.p;r.p=r.q,r.q=l}if(r.p.subtract(Le.ONE).gcd(r.e).compareTo(Le.ONE)!==0){r.p=null,s();return}if(r.q.subtract(Le.ONE).gcd(r.e).compareTo(Le.ONE)!==0){r.q=null,i(r.qBits,o);return}if(r.p1=r.p.subtract(Le.ONE),r.q1=r.q.subtract(Le.ONE),r.phi=r.p1.multiply(r.q1),r.phi.gcd(r.e).compareTo(Le.ONE)!==0){r.p=r.q=null,s();return}if(r.n=r.p.multiply(r.q),r.n.bitLength()!==r.bits){r.q=null,i(r.qBits,o);return}var u=r.e.modInverse(r.phi);r.keys={privateKey:xe.rsa.setPrivateKey(r.n,r.e,u,r.p,r.q,u.mod(r.p1),u.mod(r.q1),r.q.modInverse(r.p)),publicKey:xe.rsa.setPublicKey(r.n,r.e)},t(null,r.keys)}}function Os(r){var e=r.toString(16);e[0]>="8"&&(e="00"+e);var t=ue.util.hexToBytes(e);return t.length>1&&(t.charCodeAt(0)===0&&!(t.charCodeAt(1)&128)||t.charCodeAt(0)===255&&(t.charCodeAt(1)&128)===128)?t.substr(1):t}function IK(r){return r<=100?27:r<=150?18:r<=200?15:r<=250?12:r<=300?9:r<=350?8:r<=400?7:r<=500?6:r<=600?5:r<=800?4:r<=1250?3:2}function e_(r){return ue.util.isNodejs&&typeof Q3[r]=="function"}function t_(r){return typeof Bn.globalScope<"u"&&typeof Bn.globalScope.crypto=="object"&&typeof Bn.globalScope.crypto.subtle=="object"&&typeof Bn.globalScope.crypto.subtle[r]=="function"}function r_(r){return typeof Bn.globalScope<"u"&&typeof Bn.globalScope.msCrypto=="object"&&typeof Bn.globalScope.msCrypto.subtle=="object"&&typeof Bn.globalScope.msCrypto.subtle[r]=="function"}function n_(r){for(var e=ue.util.hexToBytes(r.toString(16)),t=new Uint8Array(e.length),n=0;n<e.length;++n)t[n]=e.charCodeAt(n);return t}});var h_=N((d1e,f_)=>{var X=rt();hd();af();yv();sa();ad();V3();Sv();cf();Bv();_d();Ht();typeof a_>"u"&&(a_=X.jsbn.BigInteger);var a_,k=X.asn1,_e=X.pki=X.pki||{};f_.exports=_e.pbe=X.pbe=X.pbe||{};var ca=_e.oids,TK={name:"EncryptedPrivateKeyInfo",tagClass:k.Class.UNIVERSAL,type:k.Type.SEQUENCE,constructed:!0,value:[{name:"EncryptedPrivateKeyInfo.encryptionAlgorithm",tagClass:k.Class.UNIVERSAL,type:k.Type.SEQUENCE,constructed:!0,value:[{name:"AlgorithmIdentifier.algorithm",tagClass:k.Class.UNIVERSAL,type:k.Type.OID,constructed:!1,capture:"encryptionOid"},{name:"AlgorithmIdentifier.parameters",tagClass:k.Class.UNIVERSAL,type:k.Type.SEQUENCE,constructed:!0,captureAsn1:"encryptionParams"}]},{name:"EncryptedPrivateKeyInfo.encryptedData",tagClass:k.Class.UNIVERSAL,type:k.Type.OCTETSTRING,constructed:!1,capture:"encryptedData"}]},DK={name:"PBES2Algorithms",tagClass:k.Class.UNIVERSAL,type:k.Type.SEQUENCE,constructed:!0,value:[{name:"PBES2Algorithms.keyDerivationFunc",tagClass:k.Class.UNIVERSAL,type:k.Type.SEQUENCE,constructed:!0,value:[{name:"PBES2Algorithms.keyDerivationFunc.oid",tagClass:k.Class.UNIVERSAL,type:k.Type.OID,constructed:!1,capture:"kdfOid"},{name:"PBES2Algorithms.params",tagClass:k.Class.UNIVERSAL,type:k.Type.SEQUENCE,constructed:!0,value:[{name:"PBES2Algorithms.params.salt",tagClass:k.Class.UNIVERSAL,type:k.Type.OCTETSTRING,constructed:!1,capture:"kdfSalt"},{name:"PBES2Algorithms.params.iterationCount",tagClass:k.Class.UNIVERSAL,type:k.Type.INTEGER,constructed:!1,capture:"kdfIterationCount"},{name:"PBES2Algorithms.params.keyLength",tagClass:k.Class.UNIVERSAL,type:k.Type.INTEGER,constructed:!1,optional:!0,capture:"keyLength"},{name:"PBES2Algorithms.params.prf",tagClass:k.Class.UNIVERSAL,type:k.Type.SEQUENCE,constructed:!0,optional:!0,value:[{name:"PBES2Algorithms.params.prf.algorithm",tagClass:k.Class.UNIVERSAL,type:k.Type.OID,constructed:!1,capture:"prfOid"}]}]}]},{name:"PBES2Algorithms.encryptionScheme",tagClass:k.Class.UNIVERSAL,type:k.Type.SEQUENCE,constructed:!0,value:[{name:"PBES2Algorithms.encryptionScheme.oid",tagClass:k.Class.UNIVERSAL,type:k.Type.OID,constructed:!1,capture:"encOid"},{name:"PBES2Algorithms.encryptionScheme.iv",tagClass:k.Class.UNIVERSAL,type:k.Type.OCTETSTRING,constructed:!1,capture:"encIv"}]}]},CK={name:"pkcs-12PbeParams",tagClass:k.Class.UNIVERSAL,type:k.Type.SEQUENCE,constructed:!0,value:[{name:"pkcs-12PbeParams.salt",tagClass:k.Class.UNIVERSAL,type:k.Type.OCTETSTRING,constructed:!1,capture:"salt"},{name:"pkcs-12PbeParams.iterations",tagClass:k.Class.UNIVERSAL,type:k.Type.INTEGER,constructed:!1,capture:"iterations"}]};_e.encryptPrivateKeyInfo=function(r,e,t){t=t||{},t.saltSize=t.saltSize||8,t.count=t.count||2048,t.algorithm=t.algorithm||"aes128",t.prfAlgorithm=t.prfAlgorithm||"sha1";var n=X.random.getBytesSync(t.saltSize),s=t.count,i=k.integerToDer(s),o,a,c;if(t.algorithm.indexOf("aes")===0||t.algorithm==="des"){var l,u,f;switch(t.algorithm){case"aes128":o=16,l=16,u=ca["aes128-CBC"],f=X.aes.createEncryptionCipher;break;case"aes192":o=24,l=16,u=ca["aes192-CBC"],f=X.aes.createEncryptionCipher;break;case"aes256":o=32,l=16,u=ca["aes256-CBC"],f=X.aes.createEncryptionCipher;break;case"des":o=8,l=8,u=ca.desCBC,f=X.des.createEncryptionCipher;break;default:var h=new Error("Cannot encrypt private key. Unknown encryption algorithm.");throw h.algorithm=t.algorithm,h}var p="hmacWith"+t.prfAlgorithm.toUpperCase(),d=u_(p),m=X.pkcs5.pbkdf2(e,n,s,o,d),g=X.random.getBytesSync(l),y=f(m);y.start(g),y.update(k.toDer(r)),y.finish(),c=y.output.getBytes();var b=PK(n,i,o,p);a=k.create(k.Class.UNIVERSAL,k.Type.SEQUENCE,!0,[k.create(k.Class.UNIVERSAL,k.Type.OID,!1,k.oidToDer(ca.pkcs5PBES2).getBytes()),k.create(k.Class.UNIVERSAL,k.Type.SEQUENCE,!0,[k.create(k.Class.UNIVERSAL,k.Type.SEQUENCE,!0,[k.create(k.Class.UNIVERSAL,k.Type.OID,!1,k.oidToDer(ca.pkcs5PBKDF2).getBytes()),b]),k.create(k.Class.UNIVERSAL,k.Type.SEQUENCE,!0,[k.create(k.Class.UNIVERSAL,k.Type.OID,!1,k.oidToDer(u).getBytes()),k.create(k.Class.UNIVERSAL,k.Type.OCTETSTRING,!1,g)])])])}else if(t.algorithm==="3des"){o=24;var w=new X.util.ByteBuffer(n),m=_e.pbe.generatePkcs12Key(e,w,1,s,o),g=_e.pbe.generatePkcs12Key(e,w,2,s,o),y=X.des.createEncryptionCipher(m);y.start(g),y.update(k.toDer(r)),y.finish(),c=y.output.getBytes(),a=k.create(k.Class.UNIVERSAL,k.Type.SEQUENCE,!0,[k.create(k.Class.UNIVERSAL,k.Type.OID,!1,k.oidToDer(ca["pbeWithSHAAnd3-KeyTripleDES-CBC"]).getBytes()),k.create(k.Class.UNIVERSAL,k.Type.SEQUENCE,!0,[k.create(k.Class.UNIVERSAL,k.Type.OCTETSTRING,!1,n),k.create(k.Class.UNIVERSAL,k.Type.INTEGER,!1,i.getBytes())])])}else{var h=new Error("Cannot encrypt private key. Unknown encryption algorithm.");throw h.algorithm=t.algorithm,h}var v=k.create(k.Class.UNIVERSAL,k.Type.SEQUENCE,!0,[a,k.create(k.Class.UNIVERSAL,k.Type.OCTETSTRING,!1,c)]);return v};_e.decryptPrivateKeyInfo=function(r,e){var t=null,n={},s=[];if(!k.validate(r,TK,n,s)){var i=new Error("Cannot read encrypted private key. ASN.1 object is not a supported EncryptedPrivateKeyInfo.");throw i.errors=s,i}var o=k.derToOid(n.encryptionOid),a=_e.pbe.getCipher(o,n.encryptionParams,e),c=X.util.createBuffer(n.encryptedData);return a.update(c),a.finish()&&(t=k.fromDer(a.output)),t};_e.encryptedPrivateKeyToPem=function(r,e){var t={type:"ENCRYPTED PRIVATE KEY",body:k.toDer(r).getBytes()};return X.pem.encode(t,{maxline:e})};_e.encryptedPrivateKeyFromPem=function(r){var e=X.pem.decode(r)[0];if(e.type!=="ENCRYPTED PRIVATE KEY"){var t=new Error('Could not convert encrypted private key from PEM; PEM header type is "ENCRYPTED PRIVATE KEY".');throw t.headerType=e.type,t}if(e.procType&&e.procType.type==="ENCRYPTED")throw new Error("Could not convert encrypted private key from PEM; PEM is encrypted.");return k.fromDer(e.body)};_e.encryptRsaPrivateKey=function(r,e,t){if(t=t||{},!t.legacy){var n=_e.wrapRsaPrivateKey(_e.privateKeyToAsn1(r));return n=_e.encryptPrivateKeyInfo(n,e,t),_e.encryptedPrivateKeyToPem(n)}var s,i,o,a;switch(t.algorithm){case"aes128":s="AES-128-CBC",o=16,i=X.random.getBytesSync(16),a=X.aes.createEncryptionCipher;break;case"aes192":s="AES-192-CBC",o=24,i=X.random.getBytesSync(16),a=X.aes.createEncryptionCipher;break;case"aes256":s="AES-256-CBC",o=32,i=X.random.getBytesSync(16),a=X.aes.createEncryptionCipher;break;case"3des":s="DES-EDE3-CBC",o=24,i=X.random.getBytesSync(8),a=X.des.createEncryptionCipher;break;case"des":s="DES-CBC",o=8,i=X.random.getBytesSync(8),a=X.des.createEncryptionCipher;break;default:var c=new Error('Could not encrypt RSA private key; unsupported encryption algorithm "'+t.algorithm+'".');throw c.algorithm=t.algorithm,c}var l=X.pbe.opensslDeriveBytes(e,i.substr(0,8),o),u=a(l);u.start(i),u.update(k.toDer(_e.privateKeyToAsn1(r))),u.finish();var f={type:"RSA PRIVATE KEY",procType:{version:"4",type:"ENCRYPTED"},dekInfo:{algorithm:s,parameters:X.util.bytesToHex(i).toUpperCase()},body:u.output.getBytes()};return X.pem.encode(f)};_e.decryptRsaPrivateKey=function(r,e){var t=null,n=X.pem.decode(r)[0];if(n.type!=="ENCRYPTED PRIVATE KEY"&&n.type!=="PRIVATE KEY"&&n.type!=="RSA PRIVATE KEY"){var s=new Error('Could not convert private key from PEM; PEM header type is not "ENCRYPTED PRIVATE KEY", "PRIVATE KEY", or "RSA PRIVATE KEY".');throw s.headerType=s,s}if(n.procType&&n.procType.type==="ENCRYPTED"){var i,o;switch(n.dekInfo.algorithm){case"DES-CBC":i=8,o=X.des.createDecryptionCipher;break;case"DES-EDE3-CBC":i=24,o=X.des.createDecryptionCipher;break;case"AES-128-CBC":i=16,o=X.aes.createDecryptionCipher;break;case"AES-192-CBC":i=24,o=X.aes.createDecryptionCipher;break;case"AES-256-CBC":i=32,o=X.aes.createDecryptionCipher;break;case"RC2-40-CBC":i=5,o=function(f){return X.rc2.createDecryptionCipher(f,40)};break;case"RC2-64-CBC":i=8,o=function(f){return X.rc2.createDecryptionCipher(f,64)};break;case"RC2-128-CBC":i=16,o=function(f){return X.rc2.createDecryptionCipher(f,128)};break;default:var s=new Error('Could not decrypt private key; unsupported encryption algorithm "'+n.dekInfo.algorithm+'".');throw s.algorithm=n.dekInfo.algorithm,s}var a=X.util.hexToBytes(n.dekInfo.parameters),c=X.pbe.opensslDeriveBytes(e,a.substr(0,8),i),l=o(c);if(l.start(a),l.update(X.util.createBuffer(n.body)),l.finish())t=l.output.getBytes();else return t}else t=n.body;return n.type==="ENCRYPTED PRIVATE KEY"?t=_e.decryptPrivateKeyInfo(k.fromDer(t),e):t=k.fromDer(t),t!==null&&(t=_e.privateKeyFromAsn1(t)),t};_e.pbe.generatePkcs12Key=function(r,e,t,n,s,i){var o,a;if(typeof i>"u"||i===null){if(!("sha1"in X.md))throw new Error('"sha1" hash algorithm unavailable.');i=X.md.sha1.create()}var c=i.digestLength,l=i.blockLength,u=new X.util.ByteBuffer,f=new X.util.ByteBuffer;if(r!=null){for(a=0;a<r.length;a++)f.putInt16(r.charCodeAt(a));f.putInt16(0)}var h=f.length(),p=e.length(),d=new X.util.ByteBuffer;d.fillWithByte(t,l);var m=l*Math.ceil(p/l),g=new X.util.ByteBuffer;for(a=0;a<m;a++)g.putByte(e.at(a%p));var y=l*Math.ceil(h/l),b=new X.util.ByteBuffer;for(a=0;a<y;a++)b.putByte(f.at(a%h));var w=g;w.putBuffer(b);for(var v=Math.ceil(s/c),x=1;x<=v;x++){var _=new X.util.ByteBuffer;_.putBytes(d.bytes()),_.putBytes(w.bytes());for(var S=0;S<n;S++)i.start(),i.update(_.getBytes()),_=i.digest();var A=new X.util.ByteBuffer;for(a=0;a<l;a++)A.putByte(_.at(a%c));var D=Math.ceil(p/l)+Math.ceil(h/l),H=new X.util.ByteBuffer;for(o=0;o<D;o++){var ee=new X.util.ByteBuffer(w.getBytes(l)),j=511;for(a=A.length()-1;a>=0;a--)j=j>>8,j+=A.at(a)+ee.at(a),ee.setAt(a,j&255);H.putBuffer(ee)}w=H,u.putBuffer(_)}return u.truncate(u.length()-s),u};_e.pbe.getCipher=function(r,e,t){switch(r){case _e.oids.pkcs5PBES2:return _e.pbe.getCipherForPBES2(r,e,t);case _e.oids["pbeWithSHAAnd3-KeyTripleDES-CBC"]:case _e.oids["pbewithSHAAnd40BitRC2-CBC"]:return _e.pbe.getCipherForPKCS12PBE(r,e,t);default:var n=new Error("Cannot read encrypted PBE data block. Unsupported OID.");throw n.oid=r,n.supportedOids=["pkcs5PBES2","pbeWithSHAAnd3-KeyTripleDES-CBC","pbewithSHAAnd40BitRC2-CBC"],n}};_e.pbe.getCipherForPBES2=function(r,e,t){var n={},s=[];if(!k.validate(e,DK,n,s)){var i=new Error("Cannot read password-based-encryption algorithm parameters. ASN.1 object is not a supported EncryptedPrivateKeyInfo.");throw i.errors=s,i}if(r=k.derToOid(n.kdfOid),r!==_e.oids.pkcs5PBKDF2){var i=new Error("Cannot read encrypted private key. Unsupported key derivation function OID.");throw i.oid=r,i.supportedOids=["pkcs5PBKDF2"],i}if(r=k.derToOid(n.encOid),r!==_e.oids["aes128-CBC"]&&r!==_e.oids["aes192-CBC"]&&r!==_e.oids["aes256-CBC"]&&r!==_e.oids["des-EDE3-CBC"]&&r!==_e.oids.desCBC){var i=new Error("Cannot read encrypted private key. Unsupported encryption scheme OID.");throw i.oid=r,i.supportedOids=["aes128-CBC","aes192-CBC","aes256-CBC","des-EDE3-CBC","desCBC"],i}var o=n.kdfSalt,a=X.util.createBuffer(n.kdfIterationCount);a=a.getInt(a.length()<<3);var c,l;switch(_e.oids[r]){case"aes128-CBC":c=16,l=X.aes.createDecryptionCipher;break;case"aes192-CBC":c=24,l=X.aes.createDecryptionCipher;break;case"aes256-CBC":c=32,l=X.aes.createDecryptionCipher;break;case"des-EDE3-CBC":c=24,l=X.des.createDecryptionCipher;break;case"desCBC":c=8,l=X.des.createDecryptionCipher;break}var u=l_(n.prfOid),f=X.pkcs5.pbkdf2(t,o,a,c,u),h=n.encIv,p=l(f);return p.start(h),p};_e.pbe.getCipherForPKCS12PBE=function(r,e,t){var n={},s=[];if(!k.validate(e,CK,n,s)){var i=new Error("Cannot read password-based-encryption algorithm parameters. ASN.1 object is not a supported EncryptedPrivateKeyInfo.");throw i.errors=s,i}var o=X.util.createBuffer(n.salt),a=X.util.createBuffer(n.iterations);a=a.getInt(a.length()<<3);var c,l,u;switch(r){case _e.oids["pbeWithSHAAnd3-KeyTripleDES-CBC"]:c=24,l=8,u=X.des.startDecrypting;break;case _e.oids["pbewithSHAAnd40BitRC2-CBC"]:c=5,l=8,u=function(m,g){var y=X.rc2.createDecryptionCipher(m,40);return y.start(g,null),y};break;default:var i=new Error("Cannot read PKCS #12 PBE data block. Unsupported OID.");throw i.oid=r,i}var f=l_(n.prfOid),h=_e.pbe.generatePkcs12Key(t,o,1,a,c,f);f.start();var p=_e.pbe.generatePkcs12Key(t,o,2,a,l,f);return u(h,p)};_e.pbe.opensslDeriveBytes=function(r,e,t,n){if(typeof n>"u"||n===null){if(!("md5"in X.md))throw new Error('"md5" hash algorithm unavailable.');n=X.md.md5.create()}e===null&&(e="");for(var s=[c_(n,r+e)],i=16,o=1;i<t;++o,i+=16)s.push(c_(n,s[o-1]+r+e));return s.join("").substr(0,t)};function c_(r,e){return r.start().update(e).digest().getBytes()}function l_(r){var e;if(!r)e="hmacWithSHA1";else if(e=_e.oids[k.derToOid(r)],!e){var t=new Error("Unsupported PRF OID.");throw t.oid=r,t.supported=["hmacWithSHA1","hmacWithSHA224","hmacWithSHA256","hmacWithSHA384","hmacWithSHA512"],t}return u_(e)}function u_(r){var e=X.md;switch(r){case"hmacWithSHA224":e=X.md.sha512;case"hmacWithSHA1":case"hmacWithSHA256":case"hmacWithSHA384":case"hmacWithSHA512":r=r.substr(8).toLowerCase();break;default:var t=new Error("Unsupported PRF algorithm.");throw t.algorithm=r,t.supported=["hmacWithSHA1","hmacWithSHA224","hmacWithSHA256","hmacWithSHA384","hmacWithSHA512"],t}if(!e||!(r in e))throw new Error("Unknown hash algorithm: "+r);return e[r].create()}function PK(r,e,t,n){var s=k.create(k.Class.UNIVERSAL,k.Type.SEQUENCE,!0,[k.create(k.Class.UNIVERSAL,k.Type.OCTETSTRING,!1,r),k.create(k.Class.UNIVERSAL,k.Type.INTEGER,!1,e.getBytes())]);return n!=="hmacWithSHA1"&&s.value.push(k.create(k.Class.UNIVERSAL,k.Type.INTEGER,!1,X.util.hexToBytes(t.toString(16))),k.create(k.Class.UNIVERSAL,k.Type.SEQUENCE,!0,[k.create(k.Class.UNIVERSAL,k.Type.OID,!1,k.oidToDer(_e.oids[n]).getBytes()),k.create(k.Class.UNIVERSAL,k.Type.NULL,!1,"")])),s}});var rS=N((_2e,tS)=>{var ht=rt();sa();Ht();var bf=tS.exports=ht.sha512=ht.sha512||{};ht.md.sha512=ht.md.algorithms.sha512=bf;var J_=ht.sha384=ht.sha512.sha384=ht.sha512.sha384||{};J_.create=function(){return bf.create("SHA-384")};ht.md.sha384=ht.md.algorithms.sha384=J_;ht.sha512.sha256=ht.sha512.sha256||{create:function(){return bf.create("SHA-512/256")}};ht.md["sha512/256"]=ht.md.algorithms["sha512/256"]=ht.sha512.sha256;ht.sha512.sha224=ht.sha512.sha224||{create:function(){return bf.create("SHA-512/224")}};ht.md["sha512/224"]=ht.md.algorithms["sha512/224"]=ht.sha512.sha224;bf.create=function(r){if(eS||C$(),typeof r>"u"&&(r="SHA-512"),!(r in fa))throw new Error("Invalid SHA-512 algorithm: "+r);for(var e=fa[r],t=null,n=ht.util.createBuffer(),s=new Array(80),i=0;i<80;++i)s[i]=new Array(2);var o=64;switch(r){case"SHA-384":o=48;break;case"SHA-512/256":o=32;break;case"SHA-512/224":o=28;break}var a={algorithm:r.replace("-","").toLowerCase(),blockLength:128,digestLength:o,messageLength:0,fullMessageLength:null,messageLengthSize:16};return a.start=function(){a.messageLength=0,a.fullMessageLength=a.messageLength128=[];for(var c=a.messageLengthSize/4,l=0;l<c;++l)a.fullMessageLength.push(0);n=ht.util.createBuffer(),t=new Array(e.length);for(var l=0;l<e.length;++l)t[l]=e[l].slice(0);return a},a.start(),a.update=function(c,l){l==="utf8"&&(c=ht.util.encodeUtf8(c));var u=c.length;a.messageLength+=u,u=[u/4294967296>>>0,u>>>0];for(var f=a.fullMessageLength.length-1;f>=0;--f)a.fullMessageLength[f]+=u[1],u[1]=u[0]+(a.fullMessageLength[f]/4294967296>>>0),a.fullMessageLength[f]=a.fullMessageLength[f]>>>0,u[0]=u[1]/4294967296>>>0;return n.putBytes(c),Z_(t,s,n),(n.read>2048||n.length()===0)&&n.compact(),a},a.digest=function(){var c=ht.util.createBuffer();c.putBytes(n.bytes());var l=a.fullMessageLength[a.fullMessageLength.length-1]+a.messageLengthSize,u=l&a.blockLength-1;c.putBytes(E4.substr(0,a.blockLength-u));for(var f,h,p=a.fullMessageLength[0]*8,d=0;d<a.fullMessageLength.length-1;++d)f=a.fullMessageLength[d+1]*8,h=f/4294967296>>>0,p+=h,c.putInt32(p>>>0),p=f>>>0;c.putInt32(p);for(var m=new Array(t.length),d=0;d<t.length;++d)m[d]=t[d].slice(0);Z_(m,s,c);var g=ht.util.createBuffer(),y;r==="SHA-512"?y=m.length:r==="SHA-384"?y=m.length-2:y=m.length-4;for(var d=0;d<y;++d)g.putInt32(m[d][0]),(d!==y-1||r!=="SHA-512/224")&&g.putInt32(m[d][1]);return g},a};var E4=null,eS=!1,v4=null,fa=null;function C$(){E4=String.fromCharCode(128),E4+=ht.util.fillString(String.fromCharCode(0),128),v4=[[1116352408,3609767458],[1899447441,602891725],[3049323471,3964484399],[3921009573,2173295548],[961987163,4081628472],[1508970993,3053834265],[2453635748,2937671579],[2870763221,3664609560],[3624381080,2734883394],[310598401,1164996542],[607225278,1323610764],[1426881987,3590304994],[1925078388,4068182383],[2162078206,991336113],[2614888103,633803317],[3248222580,3479774868],[3835390401,2666613458],[4022224774,944711139],[264347078,2341262773],[604807628,2007800933],[770255983,1495990901],[1249150122,1856431235],[1555081692,3175218132],[1996064986,2198950837],[2554220882,3999719339],[2821834349,766784016],[2952996808,2566594879],[3210313671,3203337956],[3336571891,1034457026],[3584528711,2466948901],[113926993,3758326383],[338241895,168717936],[666307205,1188179964],[773529912,1546045734],[1294757372,1522805485],[1396182291,2643833823],[1695183700,2343527390],[1986661051,1014477480],[2177026350,1206759142],[2456956037,344077627],[2730485921,1290863460],[2820302411,3158454273],[3259730800,3505952657],[3345764771,106217008],[3516065817,3606008344],[3600352804,1432725776],[4094571909,1467031594],[275423344,851169720],[430227734,3100823752],[506948616,1363258195],[659060556,3750685593],[883997877,3785050280],[958139571,3318307427],[1322822218,3812723403],[1537002063,2003034995],[1747873779,3602036899],[1955562222,1575990012],[2024104815,1125592928],[2227730452,2716904306],[2361852424,442776044],[2428436474,593698344],[2756734187,3733110249],[3204031479,2999351573],[3329325298,3815920427],[3391569614,3928383900],[3515267271,566280711],[3940187606,3454069534],[4118630271,4000239992],[116418474,1914138554],[174292421,2731055270],[289380356,3203993006],[460393269,320620315],[685471733,587496836],[852142971,1086792851],[1017036298,365543100],[1126000580,2618297676],[1288033470,3409855158],[1501505948,4234509866],[1607167915,987167468],[1816402316,1246189591]],fa={},fa["SHA-512"]=[[1779033703,4089235720],[3144134277,2227873595],[1013904242,4271175723],[2773480762,1595750129],[1359893119,2917565137],[2600822924,725511199],[528734635,4215389547],[1541459225,327033209]],fa["SHA-384"]=[[3418070365,3238371032],[1654270250,914150663],[2438529370,812702999],[355462360,4144912697],[1731405415,4290775857],[2394180231,1750603025],[3675008525,1694076839],[1203062813,3204075428]],fa["SHA-512/256"]=[[573645204,4230739756],[2673172387,3360449730],[596883563,1867755857],[2520282905,1497426621],[2519219938,2827943907],[3193839141,1401305490],[721525244,746961066],[246885852,2177182882]],fa["SHA-512/224"]=[[2352822216,424955298],[1944164710,2312950998],[502970286,855612546],[1738396948,1479516111],[258812777,2077511080],[2011393907,79989058],[1067287976,1780299464],[286451373,2446758561]],eS=!0}function Z_(r,e,t){for(var n,s,i,o,a,c,l,u,f,h,p,d,m,g,y,b,w,v,x,_,S,A,D,H,ee,j,ie,Ie,le,we,V,F,P,K,J,oe=t.length();oe>=128;){for(le=0;le<16;++le)e[le][0]=t.getInt32()>>>0,e[le][1]=t.getInt32()>>>0;for(;le<80;++le)F=e[le-2],we=F[0],V=F[1],n=((we>>>19|V<<13)^(V>>>29|we<<3)^we>>>6)>>>0,s=((we<<13|V>>>19)^(V<<3|we>>>29)^(we<<26|V>>>6))>>>0,K=e[le-15],we=K[0],V=K[1],i=((we>>>1|V<<31)^(we>>>8|V<<24)^we>>>7)>>>0,o=((we<<31|V>>>1)^(we<<24|V>>>8)^(we<<25|V>>>7))>>>0,P=e[le-7],J=e[le-16],V=s+P[1]+o+J[1],e[le][0]=n+P[0]+i+J[0]+(V/4294967296>>>0)>>>0,e[le][1]=V>>>0;for(m=r[0][0],g=r[0][1],y=r[1][0],b=r[1][1],w=r[2][0],v=r[2][1],x=r[3][0],_=r[3][1],S=r[4][0],A=r[4][1],D=r[5][0],H=r[5][1],ee=r[6][0],j=r[6][1],ie=r[7][0],Ie=r[7][1],le=0;le<80;++le)l=((S>>>14|A<<18)^(S>>>18|A<<14)^(A>>>9|S<<23))>>>0,u=((S<<18|A>>>14)^(S<<14|A>>>18)^(A<<23|S>>>9))>>>0,f=(ee^S&(D^ee))>>>0,h=(j^A&(H^j))>>>0,a=((m>>>28|g<<4)^(g>>>2|m<<30)^(g>>>7|m<<25))>>>0,c=((m<<4|g>>>28)^(g<<30|m>>>2)^(g<<25|m>>>7))>>>0,p=(m&y|w&(m^y))>>>0,d=(g&b|v&(g^b))>>>0,V=Ie+u+h+v4[le][1]+e[le][1],n=ie+l+f+v4[le][0]+e[le][0]+(V/4294967296>>>0)>>>0,s=V>>>0,V=c+d,i=a+p+(V/4294967296>>>0)>>>0,o=V>>>0,ie=ee,Ie=j,ee=D,j=H,D=S,H=A,V=_+s,S=x+n+(V/4294967296>>>0)>>>0,A=V>>>0,x=w,_=v,w=y,v=b,y=m,b=g,V=s+o,m=n+i+(V/4294967296>>>0)>>>0,g=V>>>0;V=r[0][1]+g,r[0][0]=r[0][0]+m+(V/4294967296>>>0)>>>0,r[0][1]=V>>>0,V=r[1][1]+b,r[1][0]=r[1][0]+y+(V/4294967296>>>0)>>>0,r[1][1]=V>>>0,V=r[2][1]+v,r[2][0]=r[2][0]+w+(V/4294967296>>>0)>>>0,r[2][1]=V>>>0,V=r[3][1]+_,r[3][0]=r[3][0]+x+(V/4294967296>>>0)>>>0,r[3][1]=V>>>0,V=r[4][1]+A,r[4][0]=r[4][0]+S+(V/4294967296>>>0)>>>0,r[4][1]=V>>>0,V=r[5][1]+H,r[5][0]=r[5][0]+D+(V/4294967296>>>0)>>>0,r[5][1]=V>>>0,V=r[6][1]+j,r[6][0]=r[6][0]+ee+(V/4294967296>>>0)>>>0,r[6][1]=V>>>0,V=r[7][1]+Ie,r[7][0]=r[7][0]+ie+(V/4294967296>>>0)>>>0,r[7][1]=V>>>0,oe-=128}}});var sA=N((g3e,nA)=>{"use strict";nA.exports=r=>{if(Object.prototype.toString.call(r)!=="[object Object]")return!1;let e=Object.getPrototypeOf(r);return e===null||e===Object.prototype}});var uA=N((cA,lA)=>{"use strict";var Kd=sA(),{hasOwnProperty:oA}=Object.prototype,{propertyIsEnumerable:bG}=Object,Yc=(r,e,t)=>Object.defineProperty(r,e,{value:t,writable:!0,enumerable:!0,configurable:!0}),wG=cA,iA={concatArrays:!1,ignoreUndefined:!1},$d=r=>{let e=[];for(let t in r)oA.call(r,t)&&e.push(t);if(Object.getOwnPropertySymbols){let t=Object.getOwnPropertySymbols(r);for(let n of t)bG.call(r,n)&&e.push(n)}return e};function Qc(r){return Array.isArray(r)?xG(r):Kd(r)?EG(r):r}function xG(r){let e=r.slice(0,0);return $d(r).forEach(t=>{Yc(e,t,Qc(r[t]))}),e}function EG(r){let e=Object.getPrototypeOf(r)===null?Object.create(null):{};return $d(r).forEach(t=>{Yc(e,t,Qc(r[t]))}),e}var aA=(r,e,t,n)=>(t.forEach(s=>{typeof e[s]>"u"&&n.ignoreUndefined||(s in r&&r[s]!==Object.getPrototypeOf(r)?Yc(r,s,cg(r[s],e[s],n)):Yc(r,s,Qc(e[s])))}),r),vG=(r,e,t)=>{let n=r.slice(0,0),s=0;return[r,e].forEach(i=>{let o=[];for(let a=0;a<i.length;a++)oA.call(i,a)&&(o.push(String(a)),i===r?Yc(n,s++,i[a]):Yc(n,s++,Qc(i[a])));n=aA(n,i,$d(i).filter(a=>!o.includes(a)),t)}),n};function cg(r,e,t){return t.concatArrays&&Array.isArray(r)&&Array.isArray(e)?vG(r,e,t):!Kd(e)||!Kd(r)?Qc(e):aA(r,e,$d(e),t)}lA.exports=function(...r){let e=cg(Qc(iA),this!==wG&&this||{},iA),t={_:{}};for(let n of r)if(n!==void 0){if(!Kd(n))throw new TypeError("`"+n+"` is not an Option Object");t=cg(t,{_:n},e)}return t._}});var dA=N((b3e,hA)=>{"use strict";function _G(r){return r>=55296&&r<=56319}function SG(r){return r>=56320&&r<=57343}hA.exports=function(e,t,n){if(typeof t!="string")throw new Error("Input must be string");for(var s=t.length,i=0,o,a,c=0;c<s;c+=1){if(o=t.charCodeAt(c),a=t[c],_G(o)&&SG(t.charCodeAt(c+1))&&(c+=1,a+=t[c]),i+=e(a),i===n)return t.slice(0,c+1);if(i>n)return t.slice(0,c-a.length+1)}return t}});var mA=N((w3e,pA)=>{"use strict";function AG(r){return r>=55296&&r<=56319}function RG(r){return r>=56320&&r<=57343}pA.exports=function(e){if(typeof e!="string")throw new Error("Input must be string");for(var t=e.length,n=0,s=null,i=null,o=0;o<t;o++)s=e.charCodeAt(o),RG(s)?i!=null&&AG(i)?n+=1:n+=3:s<=127?n+=1:s>=128&&s<=2047?n+=2:s>=2048&&s<=65535&&(n+=3),i=s;return n}});var yA=N((x3e,gA)=>{"use strict";var IG=dA(),TG=mA();gA.exports=IG.bind(null,TG)});var xA=N((E3e,wA)=>{"use strict";var DG=yA(),CG=/[\/\?<>\\:\*\|"]/g,PG=/[\x00-\x1f\x80-\x9f]/g,kG=/^\.+$/,NG=/^(con|prn|aux|nul|com[0-9]|lpt[0-9])(\..*)?$/i,OG=/[\. ]+$/;function bA(r,e){if(typeof r!="string")throw new Error("Input must be string");var t=r.replace(CG,e).replace(PG,e).replace(kG,e).replace(NG,e).replace(OG,e);return DG(t,255)}wA.exports=function(r,e){var t=e&&e.replacement||"",n=bA(r,t);return t===""?n:bA(n,"")}});var JA=N(qf=>{(function(){var r,e,t,n,s,i,o,a;a=function(c){var l,u,f,h;return l=(c&255<<24)>>>24,u=(c&255<<16)>>>16,f=(c&65280)>>>8,h=c&255,[l,u,f,h].join(".")},o=function(c){var l,u,f,h,p,d;for(l=[],f=h=0;h<=3&&c.length!==0;f=++h){if(f>0){if(c[0]!==".")throw new Error("Invalid IP");c=c.substring(1)}d=e(c),p=d[0],u=d[1],c=c.substring(u),l.push(p)}if(c.length!==0)throw new Error("Invalid IP");switch(l.length){case 1:if(l[0]>4294967295)throw new Error("Invalid IP");return l[0]>>>0;case 2:if(l[0]>255||l[1]>16777215)throw new Error("Invalid IP");return(l[0]<<24|l[1])>>>0;case 3:if(l[0]>255||l[1]>255||l[2]>65535)throw new Error("Invalid IP");return(l[0]<<24|l[1]<<16|l[2])>>>0;case 4:if(l[0]>255||l[1]>255||l[2]>255||l[3]>255)throw new Error("Invalid IP");return(l[0]<<24|l[1]<<16|l[2]<<8|l[3])>>>0;default:throw new Error("Invalid IP")}},t=function(c){return c.charCodeAt(0)},n=t("0"),i=t("a"),s=t("A"),e=function(c){var l,u,f,h,p;for(h=0,l=10,u="9",f=0,c.length>1&&c[f]==="0"&&(c[f+1]==="x"||c[f+1]==="X"?(f+=2,l=16):"0"<=c[f+1]&&c[f+1]<="9"&&(f++,l=8,u="7")),p=f;f<c.length;){if("0"<=c[f]&&c[f]<=u)h=h*l+(t(c[f])-n)>>>0;else if(l===16)if("a"<=c[f]&&c[f]<="f")h=h*l+(10+t(c[f])-i)>>>0;else if("A"<=c[f]&&c[f]<="F")h=h*l+(10+t(c[f])-s)>>>0;else break;else break;if(h>4294967295)throw new Error("too large");f++}if(f===p)throw new Error("empty octet");return[h,f]},r=function(){function c(l,u){var f,h,p,d;if(typeof l!="string")throw new Error("Missing `net' parameter");if(u||(d=l.split("/",2),l=d[0],u=d[1]),u||(u=32),typeof u=="string"&&u.indexOf(".")>-1){try{this.maskLong=o(u)}catch(m){throw f=m,new Error("Invalid mask: "+u)}for(h=p=32;p>=0;h=--p)if(this.maskLong===4294967295<<32-h>>>0){this.bitmask=h;break}}else if(u||u===0)this.bitmask=parseInt(u,10),this.maskLong=0,this.bitmask>0&&(this.maskLong=4294967295<<32-this.bitmask>>>0);else throw new Error("Invalid mask: empty");try{this.netLong=(o(l)&this.maskLong)>>>0}catch(m){throw f=m,new Error("Invalid net address: "+l)}if(!(this.bitmask<=32))throw new Error("Invalid mask for ip4: "+u);this.size=Math.pow(2,32-this.bitmask),this.base=a(this.netLong),this.mask=a(this.maskLong),this.hostmask=a(~this.maskLong),this.first=this.bitmask<=30?a(this.netLong+1):this.base,this.last=this.bitmask<=30?a(this.netLong+this.size-2):a(this.netLong+this.size-1),this.broadcast=this.bitmask<=30?a(this.netLong+this.size-1):void 0}return c.prototype.contains=function(l){return typeof l=="string"&&(l.indexOf("/")>0||l.split(".").length!==4)&&(l=new c(l)),l instanceof c?this.contains(l.base)&&this.contains(l.broadcast||l.last):(o(l)&this.maskLong)>>>0===(this.netLong&this.maskLong)>>>0},c.prototype.next=function(l){return l==null&&(l=1),new c(a(this.netLong+this.size*l),this.mask)},c.prototype.forEach=function(l){var u,f,h;for(h=o(this.first),f=o(this.last),u=0;h<=f;)l(a(h),h,u),u++,h++},c.prototype.toString=function(){return this.base+"/"+this.bitmask},c}(),qf.ip2long=o,qf.long2ip=a,qf.Netmask=r}).call(qf)});var nR=N((rR,sp)=>{(function(r){"use strict";let e="(0?\\d+|0x[a-f0-9]+)",t={fourOctet:new RegExp(`^${e}\\.${e}\\.${e}\\.${e}$`,"i"),threeOctet:new RegExp(`^${e}\\.${e}\\.${e}$`,"i"),twoOctet:new RegExp(`^${e}\\.${e}$`,"i"),longValue:new RegExp(`^${e}$`,"i")},n=new RegExp("^0[0-7]+$","i"),s=new RegExp("^0x[a-f0-9]+$","i"),i="%[0-9a-z]{1,}",o="(?:[0-9a-f]+::?)+",a={zoneIndex:new RegExp(i,"i"),native:new RegExp(`^(::)?(${o})?([0-9a-f]+)?(::)?(${i})?$`,"i"),deprecatedTransitional:new RegExp(`^(?:::)(${e}\\.${e}\\.${e}\\.${e}(${i})?)$`,"i"),transitional:new RegExp(`^((?:${o})|(?:::)(?:${o})?)${e}\\.${e}\\.${e}\\.${e}(${i})?$`,"i")};function c(p,d){if(p.indexOf("::")!==p.lastIndexOf("::"))return null;let m=0,g=-1,y=(p.match(a.zoneIndex)||[])[0],b,w;for(y&&(y=y.substring(1),p=p.replace(/%.+$/,""));(g=p.indexOf(":",g+1))>=0;)m++;if(p.substr(0,2)==="::"&&m--,p.substr(-2,2)==="::"&&m--,m>d)return null;for(w=d-m,b=":";w--;)b+="0:";return p=p.replace("::",b),p[0]===":"&&(p=p.slice(1)),p[p.length-1]===":"&&(p=p.slice(0,-1)),d=function(){let v=p.split(":"),x=[];for(let _=0;_<v.length;_++)x.push(parseInt(v[_],16));return x}(),{parts:d,zoneId:y}}function l(p,d,m,g){if(p.length!==d.length)throw new Error("ipaddr: cannot match CIDR for objects with different lengths");let y=0,b;for(;g>0;){if(b=m-g,b<0&&(b=0),p[y]>>b!==d[y]>>b)return!1;g-=m,y+=1}return!0}function u(p){if(s.test(p))return parseInt(p,16);if(p[0]==="0"&&!isNaN(parseInt(p[1],10))){if(n.test(p))return parseInt(p,8);throw new Error(`ipaddr: cannot parse ${p} as octal`)}return parseInt(p,10)}function f(p,d){for(;p.length<d;)p=`0${p}`;return p}let h={};h.IPv4=function(){function p(d){if(d.length!==4)throw new Error("ipaddr: ipv4 octet count should be 4");let m,g;for(m=0;m<d.length;m++)if(g=d[m],!(0<=g&&g<=255))throw new Error("ipaddr: ipv4 octet should fit in 8 bits");this.octets=d}return p.prototype.SpecialRanges={unspecified:[[new p([0,0,0,0]),8]],broadcast:[[new p([255,255,255,255]),32]],multicast:[[new p([224,0,0,0]),4]],linkLocal:[[new p([169,254,0,0]),16]],loopback:[[new p([127,0,0,0]),8]],carrierGradeNat:[[new p([100,64,0,0]),10]],private:[[new p([10,0,0,0]),8],[new p([172,16,0,0]),12],[new p([192,168,0,0]),16]],reserved:[[new p([192,0,0,0]),24],[new p([192,0,2,0]),24],[new p([192,88,99,0]),24],[new p([198,18,0,0]),15],[new p([198,51,100,0]),24],[new p([203,0,113,0]),24],[new p([240,0,0,0]),4]]},p.prototype.kind=function(){return"ipv4"},p.prototype.match=function(d,m){let g;if(m===void 0&&(g=d,d=g[0],m=g[1]),d.kind()!=="ipv4")throw new Error("ipaddr: cannot match ipv4 address with non-ipv4 one");return l(this.octets,d.octets,8,m)},p.prototype.prefixLengthFromSubnetMask=function(){let d=0,m=!1,g={0:8,128:7,192:6,224:5,240:4,248:3,252:2,254:1,255:0},y,b,w;for(y=3;y>=0;y-=1)if(b=this.octets[y],b in g){if(w=g[b],m&&w!==0)return null;w!==8&&(m=!0),d+=w}else return null;return 32-d},p.prototype.range=function(){return h.subnetMatch(this,this.SpecialRanges)},p.prototype.toByteArray=function(){return this.octets.slice(0)},p.prototype.toIPv4MappedAddress=function(){return h.IPv6.parse(`::ffff:${this.toString()}`)},p.prototype.toNormalizedString=function(){return this.toString()},p.prototype.toString=function(){return this.octets.join(".")},p}(),h.IPv4.broadcastAddressFromCIDR=function(p){try{let d=this.parseCIDR(p),m=d[0].toByteArray(),g=this.subnetMaskFromPrefixLength(d[1]).toByteArray(),y=[],b=0;for(;b<4;)y.push(parseInt(m[b],10)|parseInt(g[b],10)^255),b++;return new this(y)}catch{throw new Error("ipaddr: the address does not have IPv4 CIDR format")}},h.IPv4.isIPv4=function(p){return this.parser(p)!==null},h.IPv4.isValid=function(p){try{return new this(this.parser(p)),!0}catch{return!1}},h.IPv4.isValidFourPartDecimal=function(p){return!!(h.IPv4.isValid(p)&&p.match(/^(0|[1-9]\d*)(\.(0|[1-9]\d*)){3}$/))},h.IPv4.networkAddressFromCIDR=function(p){let d,m,g,y,b;try{for(d=this.parseCIDR(p),g=d[0].toByteArray(),b=this.subnetMaskFromPrefixLength(d[1]).toByteArray(),y=[],m=0;m<4;)y.push(parseInt(g[m],10)&parseInt(b[m],10)),m++;return new this(y)}catch{throw new Error("ipaddr: the address does not have IPv4 CIDR format")}},h.IPv4.parse=function(p){let d=this.parser(p);if(d===null)throw new Error("ipaddr: string is not formatted like an IPv4 Address");return new this(d)},h.IPv4.parseCIDR=function(p){let d;if(d=p.match(/^(.+)\/(\d+)$/)){let m=parseInt(d[2]);if(m>=0&&m<=32){let g=[this.parse(d[1]),m];return Object.defineProperty(g,"toString",{value:function(){return this.join("/")}}),g}}throw new Error("ipaddr: string is not formatted like an IPv4 CIDR range")},h.IPv4.parser=function(p){let d,m,g;if(d=p.match(t.fourOctet))return function(){let y=d.slice(1,6),b=[];for(let w=0;w<y.length;w++)m=y[w],b.push(u(m));return b}();if(d=p.match(t.longValue)){if(g=u(d[1]),g>4294967295||g<0)throw new Error("ipaddr: address outside defined range");return function(){let y=[],b;for(b=0;b<=24;b+=8)y.push(g>>b&255);return y}().reverse()}else return(d=p.match(t.twoOctet))?function(){let y=d.slice(1,4),b=[];if(g=u(y[1]),g>16777215||g<0)throw new Error("ipaddr: address outside defined range");return b.push(u(y[0])),b.push(g>>16&255),b.push(g>>8&255),b.push(g&255),b}():(d=p.match(t.threeOctet))?function(){let y=d.slice(1,5),b=[];if(g=u(y[2]),g>65535||g<0)throw new Error("ipaddr: address outside defined range");return b.push(u(y[0])),b.push(u(y[1])),b.push(g>>8&255),b.push(g&255),b}():null},h.IPv4.subnetMaskFromPrefixLength=function(p){if(p=parseInt(p),p<0||p>32)throw new Error("ipaddr: invalid IPv4 prefix length");let d=[0,0,0,0],m=0,g=Math.floor(p/8);for(;m<g;)d[m]=255,m++;return g<4&&(d[g]=Math.pow(2,p%8)-1<<8-p%8),new this(d)},h.IPv6=function(){function p(d,m){let g,y;if(d.length===16)for(this.parts=[],g=0;g<=14;g+=2)this.parts.push(d[g]<<8|d[g+1]);else if(d.length===8)this.parts=d;else throw new Error("ipaddr: ipv6 part count should be 8 or 16");for(g=0;g<this.parts.length;g++)if(y=this.parts[g],!(0<=y&&y<=65535))throw new Error("ipaddr: ipv6 part should fit in 16 bits");m&&(this.zoneId=m)}return p.prototype.SpecialRanges={unspecified:[new p([0,0,0,0,0,0,0,0]),128],linkLocal:[new p([65152,0,0,0,0,0,0,0]),10],multicast:[new p([65280,0,0,0,0,0,0,0]),8],loopback:[new p([0,0,0,0,0,0,0,1]),128],uniqueLocal:[new p([64512,0,0,0,0,0,0,0]),7],ipv4Mapped:[new p([0,0,0,0,0,65535,0,0]),96],rfc6145:[new p([0,0,0,0,65535,0,0,0]),96],rfc6052:[new p([100,65435,0,0,0,0,0,0]),96],"6to4":[new p([8194,0,0,0,0,0,0,0]),16],teredo:[new p([8193,0,0,0,0,0,0,0]),32],reserved:[[new p([8193,3512,0,0,0,0,0,0]),32]],benchmarking:[new p([8193,2,0,0,0,0,0,0]),48],amt:[new p([8193,3,0,0,0,0,0,0]),32],as112v6:[new p([8193,4,274,0,0,0,0,0]),48],deprecated:[new p([8193,16,0,0,0,0,0,0]),28],orchid2:[new p([8193,32,0,0,0,0,0,0]),28]},p.prototype.isIPv4MappedAddress=function(){return this.range()==="ipv4Mapped"},p.prototype.kind=function(){return"ipv6"},p.prototype.match=function(d,m){let g;if(m===void 0&&(g=d,d=g[0],m=g[1]),d.kind()!=="ipv6")throw new Error("ipaddr: cannot match ipv6 address with non-ipv6 one");return l(this.parts,d.parts,16,m)},p.prototype.prefixLengthFromSubnetMask=function(){let d=0,m=!1,g={0:16,32768:15,49152:14,57344:13,61440:12,63488:11,64512:10,65024:9,65280:8,65408:7,65472:6,65504:5,65520:4,65528:3,65532:2,65534:1,65535:0},y,b;for(let w=7;w>=0;w-=1)if(y=this.parts[w],y in g){if(b=g[y],m&&b!==0)return null;b!==16&&(m=!0),d+=b}else return null;return 128-d},p.prototype.range=function(){return h.subnetMatch(this,this.SpecialRanges)},p.prototype.toByteArray=function(){let d,m=[],g=this.parts;for(let y=0;y<g.length;y++)d=g[y],m.push(d>>8),m.push(d&255);return m},p.prototype.toFixedLengthString=function(){let d=function(){let g=[];for(let y=0;y<this.parts.length;y++)g.push(f(this.parts[y].toString(16),4));return g}.call(this).join(":"),m="";return this.zoneId&&(m=`%${this.zoneId}`),d+m},p.prototype.toIPv4Address=function(){if(!this.isIPv4MappedAddress())throw new Error("ipaddr: trying to convert a generic ipv6 address to ipv4");let d=this.parts.slice(-2),m=d[0],g=d[1];return new h.IPv4([m>>8,m&255,g>>8,g&255])},p.prototype.toNormalizedString=function(){let d=function(){let g=[];for(let y=0;y<this.parts.length;y++)g.push(this.parts[y].toString(16));return g}.call(this).join(":"),m="";return this.zoneId&&(m=`%${this.zoneId}`),d+m},p.prototype.toRFC5952String=function(){let d=/((^|:)(0(:|$)){2,})/g,m=this.toNormalizedString(),g=0,y=-1,b;for(;b=d.exec(m);)b[0].length>y&&(g=b.index,y=b[0].length);return y<0?m:`${m.substring(0,g)}::${m.substring(g+y)}`},p.prototype.toString=function(){return this.toRFC5952String()},p}(),h.IPv6.broadcastAddressFromCIDR=function(p){try{let d=this.parseCIDR(p),m=d[0].toByteArray(),g=this.subnetMaskFromPrefixLength(d[1]).toByteArray(),y=[],b=0;for(;b<16;)y.push(parseInt(m[b],10)|parseInt(g[b],10)^255),b++;return new this(y)}catch(d){throw new Error(`ipaddr: the address does not have IPv6 CIDR format (${d})`)}},h.IPv6.isIPv6=function(p){return this.parser(p)!==null},h.IPv6.isValid=function(p){if(typeof p=="string"&&p.indexOf(":")===-1)return!1;try{let d=this.parser(p);return new this(d.parts,d.zoneId),!0}catch{return!1}},h.IPv6.networkAddressFromCIDR=function(p){let d,m,g,y,b;try{for(d=this.parseCIDR(p),g=d[0].toByteArray(),b=this.subnetMaskFromPrefixLength(d[1]).toByteArray(),y=[],m=0;m<16;)y.push(parseInt(g[m],10)&parseInt(b[m],10)),m++;return new this(y)}catch(w){throw new Error(`ipaddr: the address does not have IPv6 CIDR format (${w})`)}},h.IPv6.parse=function(p){let d=this.parser(p);if(d.parts===null)throw new Error("ipaddr: string is not formatted like an IPv6 Address");return new this(d.parts,d.zoneId)},h.IPv6.parseCIDR=function(p){let d,m,g;if((m=p.match(/^(.+)\/(\d+)$/))&&(d=parseInt(m[2]),d>=0&&d<=128))return g=[this.parse(m[1]),d],Object.defineProperty(g,"toString",{value:function(){return this.join("/")}}),g;throw new Error("ipaddr: string is not formatted like an IPv6 CIDR range")},h.IPv6.parser=function(p){let d,m,g,y,b,w;if(g=p.match(a.deprecatedTransitional))return this.parser(`::ffff:${g[1]}`);if(a.native.test(p))return c(p,8);if((g=p.match(a.transitional))&&(w=g[6]||"",d=c(g[1].slice(0,-1)+w,6),d.parts)){for(b=[parseInt(g[2]),parseInt(g[3]),parseInt(g[4]),parseInt(g[5])],m=0;m<b.length;m++)if(y=b[m],!(0<=y&&y<=255))return null;return d.parts.push(b[0]<<8|b[1]),d.parts.push(b[2]<<8|b[3]),{parts:d.parts,zoneId:d.zoneId}}return null},h.IPv6.subnetMaskFromPrefixLength=function(p){if(p=parseInt(p),p<0||p>128)throw new Error("ipaddr: invalid IPv6 prefix length");let d=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],m=0,g=Math.floor(p/8);for(;m<g;)d[m]=255,m++;return g<16&&(d[g]=Math.pow(2,p%8)-1<<8-p%8),new this(d)},h.fromByteArray=function(p){let d=p.length;if(d===4)return new h.IPv4(p);if(d===16)return new h.IPv6(p);throw new Error("ipaddr: the binary input is neither an IPv6 nor IPv4 address")},h.isValid=function(p){return h.IPv6.isValid(p)||h.IPv4.isValid(p)},h.parse=function(p){if(h.IPv6.isValid(p))return h.IPv6.parse(p);if(h.IPv4.isValid(p))return h.IPv4.parse(p);throw new Error("ipaddr: the address has neither IPv6 nor IPv4 format")},h.parseCIDR=function(p){try{return h.IPv6.parseCIDR(p)}catch{try{return h.IPv4.parseCIDR(p)}catch{throw new Error("ipaddr: the address has neither IPv6 nor IPv4 CIDR format")}}},h.process=function(p){let d=this.parse(p);return d.kind()==="ipv6"&&d.isIPv4MappedAddress()?d.toIPv4Address():d},h.subnetMatch=function(p,d,m){let g,y,b,w;m==null&&(m="unicast");for(y in d)if(Object.prototype.hasOwnProperty.call(d,y)){for(b=d[y],b[0]&&!(b[0]instanceof Array)&&(b=[b]),g=0;g<b.length;g++)if(w=b[g],p.kind()===w[0].kind()&&p.match.apply(p,w))return y}return m},typeof sp<"u"&&sp.exports?sp.exports=h:r.ipaddr=h})(rR)});var fR=N((y5e,uR)=>{"use strict";uR.exports=lR;var wW=E2(),uo=lR.prototype,xW=new Date%1e9;function EW(){return(Math.random()*1e9>>>0)+xW++}function lR(r){r=r||{},this.id=r.id||EW(),this.max=r.max||1/0,this.items=r.items||[],this._lookup={},this.size=this.items.length,this.lastModified=new Date(r.lastModified||new Date);for(var e,t,n=this.items.length;n--;)e=this.items[n],t=new Date(e.expires)-new Date,this._lookup[e.key]=e,t>0?this.expire(e.key,t):t<=0&&this.delete(e.key)}uo.has=function(r){return r in this._lookup};uo.get=function(r){if(!this.has(r))return null;var e=this._lookup[r];return e.refresh&&this.expire(r,e.refresh),this.items.splice(this.items.indexOf(e),1),this.items.push(e),e.value};uo.meta=function(r){if(!this.has(r))return null;var e=this._lookup[r];return"meta"in e?e.meta:null};uo.set=function(r,e,t){var n=this._lookup[r],s=this._lookup[r]={key:r,value:e};return this.lastModified=new Date,n?(clearTimeout(n.timeout),this.items.splice(this.items.indexOf(n),1,s)):(this.size>=this.max&&this.delete(this.items[0].key),this.items.push(s),this.size++),t&&("ttl"in t&&this.expire(r,t.ttl),"meta"in t&&(s.meta=t.meta),t.refresh&&(s.refresh=t.ttl)),this};uo.delete=function(r){var e=this._lookup[r];return e?(this.lastModified=new Date,this.items.splice(this.items.indexOf(e),1),clearTimeout(e.timeout),delete this._lookup[r],this.size--,this):!1};uo.expire=function(r,e){var t=e||0,n=this._lookup[r];if(!n)return this;if(typeof t=="string"&&(t=wW(e)),typeof t!="number")throw new TypeError("Expiration time must be a string or number.");return clearTimeout(n.timeout),n.timeout=setTimeout(this.delete.bind(this,n.key),t),n.expires=Number(new Date)+t,this};uo.clear=function(){for(var r=this.items.length;r--;)this.delete(this.items[r].key);return this};uo.toJSON=function(){for(var r=new Array(this.items.length),e,t=r.length;t--;)e=this.items[t],r[t]={key:e.key,meta:e.meta,value:e.value,expires:e.expires,refresh:e.refresh};return{id:this.id,max:isFinite(this.max)?this.max:void 0,lastModified:this.lastModified,items:r}}});var Kf=N((U5e,wR)=>{wR.exports=class{constructor(e={}){this.points=e.points,this.duration=e.duration,this.blockDuration=e.blockDuration,this.execEvenly=e.execEvenly,this.execEvenlyMinDelayMs=e.execEvenlyMinDelayMs,this.keyPrefix=e.keyPrefix}get points(){return this._points}set points(e){this._points=e>=0?e:4}get duration(){return this._duration}set duration(e){this._duration=typeof e>"u"?1:e}get msDuration(){return this.duration*1e3}get blockDuration(){return this._blockDuration}set blockDuration(e){this._blockDuration=typeof e>"u"?0:e}get msBlockDuration(){return this.blockDuration*1e3}get execEvenly(){return this._execEvenly}set execEvenly(e){this._execEvenly=typeof e>"u"?!1:!!e}get execEvenlyMinDelayMs(){return this._execEvenlyMinDelayMs}set execEvenlyMinDelayMs(e){this._execEvenlyMinDelayMs=typeof e>"u"?Math.ceil(this.msDuration/this.points):e}get keyPrefix(){return this._keyPrefix}set keyPrefix(e){if(typeof e>"u"&&(e="rlflx"),typeof e!="string")throw new Error("keyPrefix must be string");this._keyPrefix=e}_getKeySecDuration(e={}){return e&&e.customDuration>=0?e.customDuration:this.duration}getKey(e){return this.keyPrefix.length>0?`${this.keyPrefix}:${e}`:e}parseKey(e){return e.substring(this.keyPrefix.length)}consume(){throw new Error("You have to implement the method 'consume'!")}penalty(){throw new Error("You have to implement the method 'penalty'!")}reward(){throw new Error("You have to implement the method 'reward'!")}get(){throw new Error("You have to implement the method 'get'!")}set(){throw new Error("You have to implement the method 'set'!")}block(){throw new Error("You have to implement the method 'block'!")}delete(){throw new Error("You have to implement the method 'delete'!")}}});var ER=N((V5e,xR)=>{xR.exports=class{constructor(){this._keys={},this._addedKeysAmount=0}collectExpired(){let e=Date.now();Object.keys(this._keys).forEach(t=>{this._keys[t]<=e&&delete this._keys[t]}),this._addedKeysAmount=Object.keys(this._keys).length}add(e,t){this.addMs(e,t*1e3)}addMs(e,t){this._keys[e]=Date.now()+t,this._addedKeysAmount++,this._addedKeysAmount>999&&this.collectExpired()}msBeforeExpire(e){let t=this._keys[e];if(t&&t>=Date.now()){this.collectExpired();let n=Date.now();return t>=n?t-n:0}return 0}delete(e){e?delete this._keys[e]:Object.keys(this._keys).forEach(t=>{delete this._keys[t]})}}});var _R=N((z5e,vR)=>{var AW=ER();vR.exports=AW});var En=N((K5e,SR)=>{SR.exports=class{constructor(e,t,n,s){this.remainingPoints=typeof e>"u"?0:e,this.msBeforeNext=typeof t>"u"?0:t,this.consumedPoints=typeof n>"u"?0:n,this.isFirstInDuration=typeof s>"u"?!1:s}get msBeforeNext(){return this._msBeforeNext}set msBeforeNext(e){return this._msBeforeNext=e,this}get remainingPoints(){return this._remainingPoints}set remainingPoints(e){return this._remainingPoints=e,this}get consumedPoints(){return this._consumedPoints}set consumedPoints(e){return this._consumedPoints=e,this}get isFirstInDuration(){return this._isFirstInDuration}set isFirstInDuration(e){this._isFirstInDuration=!!e}_getDecoratedProperties(){return{remainingPoints:this.remainingPoints,msBeforeNext:this.msBeforeNext,consumedPoints:this.consumedPoints,isFirstInDuration:this.isFirstInDuration}}[Symbol.for("nodejs.util.inspect.custom")](){return this._getDecoratedProperties()}toString(){return JSON.stringify(this._getDecoratedProperties())}toJSON(){return this._getDecoratedProperties()}}});var al=N((H5e,RR)=>{var Lg=Kf(),RW=_R(),AR=En();RR.exports=class extends Lg{constructor(e={}){super(e),this.inMemoryBlockOnConsumed=e.inMemoryBlockOnConsumed||e.inmemoryBlockOnConsumed,this.inMemoryBlockDuration=e.inMemoryBlockDuration||e.inmemoryBlockDuration,this.insuranceLimiter=e.insuranceLimiter,this._inMemoryBlockedKeys=new RW}get client(){return this._client}set client(e){if(typeof e>"u")throw new Error("storeClient is not set");this._client=e}_afterConsume(e,t,n,s,i,o={}){let a=this._getRateLimiterRes(n,s,i);if(this.inMemoryBlockOnConsumed>0&&!(this.inMemoryBlockDuration>0)&&a.consumedPoints>=this.inMemoryBlockOnConsumed)return this._inMemoryBlockedKeys.addMs(n,a.msBeforeNext),a.consumedPoints>this.points?t(a):e(a);if(a.consumedPoints>this.points){let c=Promise.resolve();this.blockDuration>0&&a.consumedPoints<=this.points+s&&(a.msBeforeNext=this.msBlockDuration,c=this._block(n,a.consumedPoints,this.msBlockDuration,o)),this.inMemoryBlockOnConsumed>0&&a.consumedPoints>=this.inMemoryBlockOnConsumed&&(this._inMemoryBlockedKeys.add(n,this.inMemoryBlockDuration),a.msBeforeNext=this.msInMemoryBlockDuration),c.then(()=>{t(a)}).catch(l=>{t(l)})}else if(this.execEvenly&&a.msBeforeNext>0&&!a.isFirstInDuration){let c=Math.ceil(a.msBeforeNext/(a.remainingPoints+2));c<this.execEvenlyMinDelayMs&&(c=a.consumedPoints*this.execEvenlyMinDelayMs),setTimeout(e,c,a)}else e(a)}_handleError(e,t,n,s,i,o=!1,a={}){this.insuranceLimiter instanceof Lg?this.insuranceLimiter[t](i,o,a).then(c=>{n(c)}).catch(c=>{s(c)}):s(e)}get _inmemoryBlockedKeys(){return this._inMemoryBlockedKeys}getInmemoryBlockMsBeforeExpire(e){return this.getInMemoryBlockMsBeforeExpire(e)}get inmemoryBlockOnConsumed(){return this.inMemoryBlockOnConsumed}set inmemoryBlockOnConsumed(e){this.inMemoryBlockOnConsumed=e}get inmemoryBlockDuration(){return this.inMemoryBlockDuration}set inmemoryBlockDuration(e){this.inMemoryBlockDuration=e}get msInmemoryBlockDuration(){return this.inMemoryBlockDuration*1e3}getInMemoryBlockMsBeforeExpire(e){return this.inMemoryBlockOnConsumed>0?this._inMemoryBlockedKeys.msBeforeExpire(e):0}get inMemoryBlockOnConsumed(){return this._inMemoryBlockOnConsumed}set inMemoryBlockOnConsumed(e){if(this._inMemoryBlockOnConsumed=e?parseInt(e):0,this.inMemoryBlockOnConsumed>0&&this.points>this.inMemoryBlockOnConsumed)throw new Error('inMemoryBlockOnConsumed option must be greater or equal "points" option')}get inMemoryBlockDuration(){return this._inMemoryBlockDuration}set inMemoryBlockDuration(e){if(this._inMemoryBlockDuration=e?parseInt(e):0,this.inMemoryBlockDuration>0&&this.inMemoryBlockOnConsumed===0)throw new Error("inMemoryBlockOnConsumed option must be set up")}get msInMemoryBlockDuration(){return this._inMemoryBlockDuration*1e3}get insuranceLimiter(){return this._insuranceLimiter}set insuranceLimiter(e){if(typeof e<"u"&&!(e instanceof Lg))throw new Error("insuranceLimiter must be instance of RateLimiterAbstract");this._insuranceLimiter=e,this._insuranceLimiter&&(this._insuranceLimiter.blockDuration=this.blockDuration,this._insuranceLimiter.execEvenly=this.execEvenly)}block(e,t,n={}){let s=t*1e3;return this._block(this.getKey(e),this.points+1,s,n)}set(e,t,n,s={}){let i=(n>=0?n:this.duration)*1e3;return this._block(this.getKey(e),t,i,s)}consume(e,t=1,n={}){return new Promise((s,i)=>{let o=this.getKey(e),a=this.getInMemoryBlockMsBeforeExpire(o);if(a>0)return i(new AR(0,a));this._upsert(o,t,this._getKeySecDuration(n)*1e3,!1,n).then(c=>{this._afterConsume(s,i,o,t,c)}).catch(c=>{this._handleError(c,"consume",s,i,e,t,n)})})}penalty(e,t=1,n={}){let s=this.getKey(e);return new Promise((i,o)=>{this._upsert(s,t,this._getKeySecDuration(n)*1e3,!1,n).then(a=>{i(this._getRateLimiterRes(s,t,a))}).catch(a=>{this._handleError(a,"penalty",i,o,e,t,n)})})}reward(e,t=1,n={}){let s=this.getKey(e);return new Promise((i,o)=>{this._upsert(s,-t,this._getKeySecDuration(n)*1e3,!1,n).then(a=>{i(this._getRateLimiterRes(s,-t,a))}).catch(a=>{this._handleError(a,"reward",i,o,e,t,n)})})}get(e,t={}){let n=this.getKey(e);return new Promise((s,i)=>{this._get(n,t).then(o=>{s(o===null||typeof o>"u"?null:this._getRateLimiterRes(n,0,o))}).catch(o=>{this._handleError(o,"get",s,i,e,t)})})}delete(e,t={}){let n=this.getKey(e);return new Promise((s,i)=>{this._delete(n,t).then(o=>{this._inMemoryBlockedKeys.delete(n),s(o)}).catch(o=>{this._handleError(o,"delete",s,i,e,t)})})}deleteInMemoryBlockedAll(){this._inMemoryBlockedKeys.delete()}_getRateLimiterRes(e,t,n){throw new Error("You have to implement the method '_getRateLimiterRes'!")}_block(e,t,n,s={}){return new Promise((i,o)=>{this._upsert(e,t,n,!0,s).then(()=>{i(new AR(0,n>0?n:-1,t))}).catch(a=>{this._handleError(a,"block",i,o,this.parseKey(e),n/1e3,s)})})}_get(e,t={}){throw new Error("You have to implement the method '_get'!")}_delete(e,t={}){throw new Error("You have to implement the method '_delete'!")}_upsert(e,t,n,s=!1,i={}){throw new Error("You have to implement the method '_upsert'!")}}});var DR=N((G5e,TR)=>{var IW=al(),TW=En(),IR="redis.call('set', KEYS[1], 0, 'EX', ARGV[2], 'NX') local consumed = redis.call('incrby', KEYS[1], ARGV[1]) local ttl = redis.call('pttl', KEYS[1]) if ttl == -1 then   redis.call('expire', KEYS[1], ARGV[2])   ttl = 1000 * ARGV[2] end return {consumed, ttl} ",Bg=class extends IW{constructor(e){super(e),e.redis?this.client=e.redis:this.client=e.storeClient,this._rejectIfRedisNotReady=!!e.rejectIfRedisNotReady,typeof this.client.defineCommand=="function"&&this.client.defineCommand("rlflxIncr",{numberOfKeys:1,lua:IR})}_isRedisReady(){return this._rejectIfRedisNotReady?!(this.client.status&&this.client.status!=="ready"||typeof this.client.isReady=="function"&&!this.client.isReady()):!0}_getRateLimiterRes(e,t,n){let[s,i]=n;Array.isArray(s)&&([,s]=s,[,i]=i);let o=new TW;return o.consumedPoints=parseInt(s),o.isFirstInDuration=o.consumedPoints===t,o.remainingPoints=Math.max(this.points-o.consumedPoints,0),o.msBeforeNext=i,o}_upsert(e,t,n,s=!1){return new Promise((i,o)=>{if(!this._isRedisReady())return o(new Error("Redis connection is not ready"));let a=Math.floor(n/1e3),c=this.client.multi();if(s)a>0?c.set(e,t,"EX",a):c.set(e,t),c.pttl(e).exec((l,u)=>l?o(l):i(u));else if(a>0){let l=function(u,f){return u?o(u):i(f)};typeof this.client.rlflxIncr=="function"?this.client.rlflxIncr(e,t,a,l):this.client.eval(IR,1,e,t,a,l)}else c.incrby(e,t).pttl(e).exec((l,u)=>l?o(l):i(u))})}_get(e){return new Promise((t,n)=>{if(!this._isRedisReady())return n(new Error("Redis connection is not ready"));this.client.multi().get(e).pttl(e).exec((s,i)=>{if(s)n(s);else{let[o]=i;if(o===null)return t(null);t(i)}})})}_delete(e){return new Promise((t,n)=>{this.client.del(e,(s,i)=>{s?n(s):t(i>0)})})}};TR.exports=Bg});var kR=N((W5e,PR)=>{var DW=al(),CW=En();function CR(r){try{let e=r.client?r.client:r,{version:t}=e.topology.s.options.metadata.driver,n=t.split(".").map(s=>parseInt(s));return{major:n[0],feature:n[1],patch:n[2]}}catch{return{major:0,feature:0,patch:0}}}var $f=class extends DW{constructor(e){super(e),this.dbName=e.dbName,this.tableName=e.tableName,this.indexKeyPrefix=e.indexKeyPrefix,e.mongo?this.client=e.mongo:this.client=e.storeClient,typeof this.client.then=="function"?this.client.then(t=>{this.client=t,this._initCollection(),this._driverVersion=CR(this.client)}):(this._initCollection(),this._driverVersion=CR(this.client))}get dbName(){return this._dbName}set dbName(e){this._dbName=typeof e>"u"?$f.getDbName():e}static getDbName(){return"node-rate-limiter-flexible"}get tableName(){return this._tableName}set tableName(e){this._tableName=typeof e>"u"?this.keyPrefix:e}get client(){return this._client}set client(e){if(typeof e>"u")throw new Error("mongo is not set");this._client=e}get indexKeyPrefix(){return this._indexKeyPrefix}set indexKeyPrefix(e){this._indexKeyPrefix=e||{}}_initCollection(){let t=(typeof this.client.db=="function"?this.client.db(this.dbName):this.client).collection(this.tableName);t.createIndex({expire:-1},{expireAfterSeconds:0}),t.createIndex(Object.assign({},this.indexKeyPrefix,{key:1}),{unique:!0}),this._collection=t}_getRateLimiterRes(e,t,n){let s=new CW,i;return typeof n.value>"u"?i=n:i=n.value,s.isFirstInDuration=i.points===t,s.consumedPoints=i.points,s.remainingPoints=Math.max(this.points-s.consumedPoints,0),s.msBeforeNext=i.expire!==null?Math.max(new Date(i.expire).getTime()-Date.now(),0):-1,s}_upsert(e,t,n,s=!1,i={}){if(!this._collection)return Promise.reject(Error("Mongo connection is not established"));let o=i.attrs||{},a,c;s?(a={key:e},a=Object.assign(a,o),c={$set:{key:e,points:t,expire:n>0?new Date(Date.now()+n):null}},c.$set=Object.assign(c.$set,o)):(a={$or:[{expire:{$gt:new Date}},{expire:{$eq:null}}],key:e},a=Object.assign(a,o),c={$setOnInsert:{key:e,expire:n>0?new Date(Date.now()+n):null},$inc:{points:t}},c.$setOnInsert=Object.assign(c.$setOnInsert,o));let l={upsert:!0};return this._driverVersion.major>=4||this._driverVersion.major===3&&this._driverVersion.feature>=7||this._driverVersion.feature>=6&&this._driverVersion.patch>=7?l.returnDocument="after":l.returnOriginal=!1,new Promise((u,f)=>{this._collection.findOneAndUpdate(a,c,l).then(h=>{u(h)}).catch(h=>{if(h&&h.code===11e3){let p=Object.assign({$or:[{expire:{$lte:new Date}},{expire:{$eq:null}}],key:e},o),d={$set:Object.assign({key:e,points:t,expire:n>0?new Date(Date.now()+n):null},o)};this._collection.findOneAndUpdate(p,d,l).then(m=>{u(m)}).catch(m=>{m&&m.code===11e3?this._upsert(e,t,n,s).then(g=>u(g)).catch(g=>f(g)):f(m)})}else f(h)})})}_get(e,t={}){if(!this._collection)return Promise.reject(Error("Mongo connection is not established"));let n=t.attrs||{},s=Object.assign({key:e,$or:[{expire:{$gt:new Date}},{expire:{$eq:null}}]},n);return this._collection.findOne(s)}_delete(e,t={}){if(!this._collection)return Promise.reject(Error("Mongo connection is not established"));let n=t.attrs||{},s=Object.assign({key:e},n);return this._collection.deleteOne(s).then(i=>i.deletedCount>0)}};PR.exports=$f});var OR=N((Y5e,NR)=>{var PW=al(),kW=En(),Mg=class extends PW{constructor(e,t=null){super(e),this.client=e.storeClient,this.clientType=e.storeType,this.dbName=e.dbName,this.tableName=e.tableName,this.clearExpiredByTimeout=e.clearExpiredByTimeout,this.tableCreated=e.tableCreated,this.tableCreated?(this.clearExpiredByTimeout&&this._clearExpiredHourAgo(),typeof t=="function"&&t()):this._createDbAndTable().then(()=>{this.tableCreated=!0,this.clearExpiredByTimeout&&this._clearExpiredHourAgo(),typeof t=="function"&&t()}).catch(n=>{if(typeof t=="function")t(n);else throw n})}clearExpired(e){return new Promise(t=>{this._getConnection().then(n=>{n.query("DELETE FROM ??.?? WHERE expire < ?",[this.dbName,this.tableName,e],()=>{this._releaseConnection(n),t()})}).catch(()=>{t()})})}_clearExpiredHourAgo(){this._clearExpiredTimeoutId&&clearTimeout(this._clearExpiredTimeoutId),this._clearExpiredTimeoutId=setTimeout(()=>{this.clearExpired(Date.now()-36e5).then(()=>{this._clearExpiredHourAgo()})},3e5),this._clearExpiredTimeoutId.unref()}_getConnection(){switch(this.clientType){case"pool":return new Promise((e,t)=>{this.client.getConnection((n,s)=>{if(n)return t(n);e(s)})});case"sequelize":return this.client.connectionManager.getConnection();case"knex":return this.client.client.acquireConnection();default:return Promise.resolve(this.client)}}_releaseConnection(e){switch(this.clientType){case"pool":return e.release();case"sequelize":return this.client.connectionManager.releaseConnection(e);case"knex":return this.client.client.releaseConnection(e);default:return!0}}_createDbAndTable(){return new Promise((e,t)=>{this._getConnection().then(n=>{n.query(`CREATE DATABASE IF NOT EXISTS \`${this.dbName}\`;`,s=>{if(s)return this._releaseConnection(n),t(s);n.query(this._getCreateTableStmt(),i=>{if(i)return this._releaseConnection(n),t(i);this._releaseConnection(n),e()})})}).catch(n=>{t(n)})})}_getCreateTableStmt(){return`CREATE TABLE IF NOT EXISTS \`${this.dbName}\`.\`${this.tableName}\` (\`key\` VARCHAR(255) CHARACTER SET utf8 NOT NULL,\`points\` INT(9) NOT NULL default 0,\`expire\` BIGINT UNSIGNED,PRIMARY KEY (\`key\`)) ENGINE = INNODB;`}get clientType(){return this._clientType}set clientType(e){if(typeof e>"u")if(this.client.constructor.name==="Connection")e="connection";else if(this.client.constructor.name==="Pool")e="pool";else if(this.client.constructor.name==="Sequelize")e="sequelize";else throw new Error("storeType is not defined");this._clientType=e.toLowerCase()}get dbName(){return this._dbName}set dbName(e){this._dbName=typeof e>"u"?"rtlmtrflx":e}get tableName(){return this._tableName}set tableName(e){this._tableName=typeof e>"u"?this.keyPrefix:e}get tableCreated(){return this._tableCreated}set tableCreated(e){this._tableCreated=typeof e>"u"?!1:!!e}get clearExpiredByTimeout(){return this._clearExpiredByTimeout}set clearExpiredByTimeout(e){this._clearExpiredByTimeout=typeof e>"u"?!0:!!e}_getRateLimiterRes(e,t,n){let s=new kW,[i]=n;return s.isFirstInDuration=t===i.points,s.consumedPoints=s.isFirstInDuration?t:i.points,s.remainingPoints=Math.max(this.points-s.consumedPoints,0),s.msBeforeNext=i.expire?Math.max(i.expire-Date.now(),0):-1,s}_upsertTransaction(e,t,n,s,i){return new Promise((o,a)=>{e.query("BEGIN",c=>{if(c)return e.rollback(),a(c);let l=Date.now(),u=s>0?l+s:null,f,h;i?(f=`INSERT INTO ??.?? VALUES (?, ?, ?)
          ON DUPLICATE KEY UPDATE 
            points = ?, 
            expire = ?;`,h=[this.dbName,this.tableName,t,n,u,n,u]):(f=`INSERT INTO ??.?? VALUES (?, ?, ?)
          ON DUPLICATE KEY UPDATE 
            points = IF(expire <= ?, ?, points + (?)), 
            expire = IF(expire <= ?, ?, expire);`,h=[this.dbName,this.tableName,t,n,u,l,n,n,l,u]),e.query(f,h,p=>{if(p)return e.rollback(),a(p);e.query("SELECT points, expire FROM ??.?? WHERE `key` = ?;",[this.dbName,this.tableName,t],(d,m)=>{if(d)return e.rollback(),a(d);e.query("COMMIT",g=>{if(g)return e.rollback(),a(g);o(m)})})})})})}_upsert(e,t,n,s=!1){return this.tableCreated?new Promise((i,o)=>{this._getConnection().then(a=>{this._upsertTransaction(a,e,t,n,s).then(c=>{i(c),this._releaseConnection(a)}).catch(c=>{o(c),this._releaseConnection(a)})}).catch(a=>{o(a)})}):Promise.reject(Error("Table is not created yet"))}_get(e){return this.tableCreated?new Promise((t,n)=>{this._getConnection().then(s=>{s.query("SELECT points, expire FROM ??.?? WHERE `key` = ? AND (`expire` > ? OR `expire` IS NULL)",[this.dbName,this.tableName,e,Date.now()],(i,o)=>{i?n(i):o.length===0?t(null):t(o),this._releaseConnection(s)})}).catch(s=>{n(s)})}):Promise.reject(Error("Table is not created yet"))}_delete(e){return this.tableCreated?new Promise((t,n)=>{this._getConnection().then(s=>{s.query("DELETE FROM ??.?? WHERE `key` = ?",[this.dbName,this.tableName,e],(i,o)=>{i?n(i):t(o.affectedRows>0),this._releaseConnection(s)})}).catch(s=>{n(s)})}):Promise.reject(Error("Table is not created yet"))}};NR.exports=Mg});var BR=N((Q5e,LR)=>{var NW=al(),OW=En(),Ug=class extends NW{constructor(e,t=null){super(e),this.client=e.storeClient,this.clientType=e.storeType,this.tableName=e.tableName,this.clearExpiredByTimeout=e.clearExpiredByTimeout,this.tableCreated=e.tableCreated,this.tableCreated?typeof t=="function"&&t():this._createTable().then(()=>{this.tableCreated=!0,this.clearExpiredByTimeout&&this._clearExpiredHourAgo(),typeof t=="function"&&t()}).catch(n=>{if(typeof t=="function")t(n);else throw n})}clearExpired(e){return new Promise(t=>{let n={name:"rlflx-clear-expired",text:`DELETE FROM ${this.tableName} WHERE expire < $1`,values:[e]};this._query(n).then(()=>{t()}).catch(()=>{t()})})}_clearExpiredHourAgo(){this._clearExpiredTimeoutId&&clearTimeout(this._clearExpiredTimeoutId),this._clearExpiredTimeoutId=setTimeout(()=>{this.clearExpired(Date.now()-36e5).then(()=>{this._clearExpiredHourAgo()})},3e5),this._clearExpiredTimeoutId.unref()}_getConnection(){switch(this.clientType){case"pool":return Promise.resolve(this.client);case"sequelize":return this.client.connectionManager.getConnection();case"knex":return this.client.client.acquireConnection();case"typeorm":return Promise.resolve(this.client.driver.master);default:return Promise.resolve(this.client)}}_releaseConnection(e){switch(this.clientType){case"pool":return!0;case"sequelize":return this.client.connectionManager.releaseConnection(e);case"knex":return this.client.client.releaseConnection(e);case"typeorm":return!0;default:return!0}}_createTable(){return new Promise((e,t)=>{this._query({text:this._getCreateTableStmt()}).then(()=>{e()}).catch(n=>{n.code==="23505"?e():t(n)})})}_getCreateTableStmt(){return`CREATE TABLE IF NOT EXISTS ${this.tableName} ( 
      key varchar(255) PRIMARY KEY,
      points integer NOT NULL DEFAULT 0,
      expire bigint
    );`}get clientType(){return this._clientType}set clientType(e){let t=this.client.constructor.name;if(typeof e>"u")if(t==="Client")e="client";else if(t==="Pool"||t==="BoundPool")e="pool";else if(t==="Sequelize")e="sequelize";else throw new Error("storeType is not defined");this._clientType=e.toLowerCase()}get tableName(){return this._tableName}set tableName(e){this._tableName=typeof e>"u"?this.keyPrefix:e}get tableCreated(){return this._tableCreated}set tableCreated(e){this._tableCreated=typeof e>"u"?!1:!!e}get clearExpiredByTimeout(){return this._clearExpiredByTimeout}set clearExpiredByTimeout(e){this._clearExpiredByTimeout=typeof e>"u"?!0:!!e}_getRateLimiterRes(e,t,n){let s=new OW,i=n.rows[0];return s.isFirstInDuration=t===i.points,s.consumedPoints=s.isFirstInDuration?t:i.points,s.remainingPoints=Math.max(this.points-s.consumedPoints,0),s.msBeforeNext=i.expire?Math.max(i.expire-Date.now(),0):-1,s}_query(e){let n={name:`${this.tableName.toLowerCase()}:${e.name}`,text:e.text,values:e.values};return new Promise((s,i)=>{this._getConnection().then(o=>{o.query(n).then(a=>{s(a),this._releaseConnection(o)}).catch(a=>{i(a),this._releaseConnection(o)})}).catch(o=>{i(o)})})}_upsert(e,t,n,s=!1){if(!this.tableCreated)return Promise.reject(Error("Table is not created yet"));let i=n>0?Date.now()+n:null,o=s?" $3 ":` CASE
             WHEN ${this.tableName}.expire <= $4 THEN $3
             ELSE ${this.tableName}.expire
            END `;return this._query({name:s?"rlflx-upsert-force":"rlflx-upsert",text:`
            INSERT INTO ${this.tableName} VALUES ($1, $2, $3)
              ON CONFLICT(key) DO UPDATE SET
                points = CASE
                          WHEN (${this.tableName}.expire <= $4 OR 1=${s?1:0}) THEN $2
                          ELSE ${this.tableName}.points + ($2)
                         END,
                expire = ${o}
            RETURNING points, expire;`,values:[e,t,i,Date.now()]})}_get(e){return this.tableCreated?new Promise((t,n)=>{this._query({name:"rlflx-get",text:`
            SELECT points, expire FROM ${this.tableName} WHERE key = $1 AND (expire > $2 OR expire IS NULL);`,values:[e,Date.now()]}).then(s=>{s.rowCount===0&&(s=null),t(s)}).catch(s=>{n(s)})}):Promise.reject(Error("Table is not created yet"))}_delete(e){return this.tableCreated?this._query({name:"rlflx-delete",text:`DELETE FROM ${this.tableName} WHERE key = $1`,values:[e]}).then(t=>t.rowCount>0):Promise.reject(Error("Table is not created yet"))}};LR.exports=Ug});var MR=N(()=>{});var FR=N((J5e,UR)=>{UR.exports=class{constructor(e,t,n=null){this.value=e,this.expiresAt=t,this.timeoutId=n}get value(){return this._value}set value(e){this._value=parseInt(e)}get expiresAt(){return this._expiresAt}set expiresAt(e){!(e instanceof Date)&&Number.isInteger(e)&&(e=new Date(e)),this._expiresAt=e}get timeoutId(){return this._timeoutId}set timeoutId(e){this._timeoutId=e}}});var zR=N((tye,VR)=>{var LW=FR(),Fg=En();VR.exports=class{constructor(){this._storage={}}incrby(e,t,n){if(this._storage[e]){let s=this._storage[e].expiresAt?this._storage[e].expiresAt.getTime()-new Date().getTime():-1;return s!==0?(this._storage[e].value=this._storage[e].value+t,new Fg(0,s,this._storage[e].value,!1)):this.set(e,t,n)}return this.set(e,t,n)}set(e,t,n){let s=n*1e3;return this._storage[e]&&this._storage[e].timeoutId&&clearTimeout(this._storage[e].timeoutId),this._storage[e]=new LW(t,s>0?new Date(Date.now()+s):null),s>0&&(this._storage[e].timeoutId=setTimeout(()=>{delete this._storage[e]},s),this._storage[e].timeoutId.unref&&this._storage[e].timeoutId.unref()),new Fg(0,s===0?-1:s,this._storage[e].value,!0)}get(e){if(this._storage[e]){let t=this._storage[e].expiresAt?this._storage[e].expiresAt.getTime()-new Date().getTime():-1;return new Fg(0,t,this._storage[e].value,!1)}return null}delete(e){return this._storage[e]?(this._storage[e].timeoutId&&clearTimeout(this._storage[e].timeoutId),delete this._storage[e],!0):!1}}});var zg=N((rye,KR)=>{var BW=Kf(),MW=zR(),qR=En(),Vg=class extends BW{constructor(e={}){super(e),this._memoryStorage=new MW}consume(e,t=1,n={}){return new Promise((s,i)=>{let o=this.getKey(e),a=this._getKeySecDuration(n),c=this._memoryStorage.incrby(o,t,a);if(c.remainingPoints=Math.max(this.points-c.consumedPoints,0),c.consumedPoints>this.points)this.blockDuration>0&&c.consumedPoints<=this.points+t&&(c=this._memoryStorage.set(o,c.consumedPoints,this.blockDuration)),i(c);else if(this.execEvenly&&c.msBeforeNext>0&&!c.isFirstInDuration){let l=Math.ceil(c.msBeforeNext/(c.remainingPoints+2));l<this.execEvenlyMinDelayMs&&(l=c.consumedPoints*this.execEvenlyMinDelayMs),setTimeout(s,l,c)}else s(c)})}penalty(e,t=1,n={}){let s=this.getKey(e);return new Promise(i=>{let o=this._getKeySecDuration(n),a=this._memoryStorage.incrby(s,t,o);a.remainingPoints=Math.max(this.points-a.consumedPoints,0),i(a)})}reward(e,t=1,n={}){let s=this.getKey(e);return new Promise(i=>{let o=this._getKeySecDuration(n),a=this._memoryStorage.incrby(s,-t,o);a.remainingPoints=Math.max(this.points-a.consumedPoints,0),i(a)})}block(e,t){let n=t*1e3,s=this.points+1;return this._memoryStorage.set(this.getKey(e),s,t),Promise.resolve(new qR(0,n===0?-1:n,s))}set(e,t,n){let s=(n>=0?n:this.duration)*1e3;return this._memoryStorage.set(this.getKey(e),t,n),Promise.resolve(new qR(0,s===0?-1:s,t))}get(e){let t=this._memoryStorage.get(this.getKey(e));return t!==null&&(t.remainingPoints=Math.max(this.points-t.consumedPoints,0)),Promise.resolve(t)}delete(e){return Promise.resolve(this._memoryStorage.delete(this.getKey(e)))}};KR.exports=Vg});var XR=N((nye,QR)=>{var $R=MR(),UW=ia(),FW=Kf(),GR=zg(),VW=En(),zn="rate_limiter_flexible",ul=null,HR=function(r,e,t,n){let s;n===null||n===!0||n===!1?s=n:s={remainingPoints:n.remainingPoints,msBeforeNext:n.msBeforeNext,consumedPoints:n.consumedPoints,isFirstInDuration:n.isFirstInDuration},r.send({channel:zn,keyPrefix:e.keyPrefix,promiseId:e.promiseId,type:t,data:s})},WR=function(r){setTimeout(()=>{this._initiated?process.send(r):typeof this._promises[r.promiseId]<"u"&&WR.call(this,r)},30)},cl=function(r,e,t,n,s){let i={channel:zn,keyPrefix:this.keyPrefix,func:r,promiseId:e,data:{key:t,arg:n,opts:s}};this._initiated?process.send(i):WR.call(this,i)},YR=function(r,e){if(!e||e.channel!==zn||typeof this._rateLimiters[e.keyPrefix]>"u")return!1;let t;switch(e.func){case"consume":t=this._rateLimiters[e.keyPrefix].consume(e.data.key,e.data.arg,e.data.opts);break;case"penalty":t=this._rateLimiters[e.keyPrefix].penalty(e.data.key,e.data.arg,e.data.opts);break;case"reward":t=this._rateLimiters[e.keyPrefix].reward(e.data.key,e.data.arg,e.data.opts);break;case"block":t=this._rateLimiters[e.keyPrefix].block(e.data.key,e.data.arg,e.data.opts);break;case"get":t=this._rateLimiters[e.keyPrefix].get(e.data.key,e.data.opts);break;case"delete":t=this._rateLimiters[e.keyPrefix].delete(e.data.key,e.data.opts);break;default:return!1}t&&t.then(n=>{HR(r,e,"resolve",n)}).catch(n=>{HR(r,e,"reject",n)})},zW=function(r){if(!r||r.channel!==zn||r.keyPrefix!==this.keyPrefix)return!1;if(this._promises[r.promiseId]){clearTimeout(this._promises[r.promiseId].timeoutId);let e;switch(r.data===null||r.data===!0||r.data===!1?e=r.data:e=new VW(r.data.remainingPoints,r.data.msBeforeNext,r.data.consumedPoints,r.data.isFirstInDuration),r.type){case"resolve":this._promises[r.promiseId].resolve(e);break;case"reject":this._promises[r.promiseId].reject(e);break;default:throw new Error(`RateLimiterCluster: no such message type '${r.type}'`)}delete this._promises[r.promiseId]}},qW=function(){return{points:this.points,duration:this.duration,blockDuration:this.blockDuration,execEvenly:this.execEvenly,execEvenlyMinDelayMs:this.execEvenlyMinDelayMs,keyPrefix:this.keyPrefix}},ll=function(r,e){let t=process.hrtime(),n=t[0].toString()+t[1].toString();return typeof this._promises[n]<"u"&&(n+=UW.randomBytes(12).toString("base64")),this._promises[n]={resolve:r,reject:e,timeoutId:setTimeout(()=>{delete this._promises[n],e(new Error("RateLimiterCluster timeout: no answer from master in time"))},this.timeoutMs)},n},qg=class{constructor(){if(ul)return ul;this._rateLimiters={},$R.setMaxListeners(0),$R.on("message",(e,t)=>{t&&t.channel===zn&&t.type==="init"?(typeof this._rateLimiters[t.opts.keyPrefix]>"u"&&(this._rateLimiters[t.opts.keyPrefix]=new GR(t.opts)),e.send({channel:zn,type:"init",keyPrefix:t.opts.keyPrefix})):YR.call(this,e,t)}),ul=this}},Kg=class{constructor(e){if(ul)return ul;this._rateLimiters={},e.launchBus((t,n)=>{n.on("process:msg",s=>{let i=s.raw;if(i&&i.channel===zn&&i.type==="init")typeof this._rateLimiters[i.opts.keyPrefix]>"u"&&(this._rateLimiters[i.opts.keyPrefix]=new GR(i.opts)),e.sendDataToProcessId(s.process.pm_id,{data:{},topic:zn,channel:zn,type:"init",keyPrefix:i.opts.keyPrefix},(o,a)=>{o&&console.log(o,a)});else{let o={send:a=>{let c=a;c.topic=zn,typeof c.data>"u"&&(c.data={}),e.sendDataToProcessId(s.process.pm_id,c,(l,u)=>{l&&console.log(l,u)})}};YR.call(this,o,i)}})}),ul=this}},$g=class extends FW{get timeoutMs(){return this._timeoutMs}set timeoutMs(e){this._timeoutMs=typeof e>"u"?5e3:Math.abs(parseInt(e))}constructor(e={}){super(e),process.setMaxListeners(0),this.timeoutMs=e.timeoutMs,this._initiated=!1,process.on("message",t=>{t&&t.channel===zn&&t.type==="init"&&t.keyPrefix===this.keyPrefix?this._initiated=!0:zW.call(this,t)}),process.send({channel:zn,type:"init",opts:qW.call(this)}),this._promises={}}consume(e,t=1,n={}){return new Promise((s,i)=>{let o=ll.call(this,s,i);cl.call(this,"consume",o,e,t,n)})}penalty(e,t=1,n={}){return new Promise((s,i)=>{let o=ll.call(this,s,i);cl.call(this,"penalty",o,e,t,n)})}reward(e,t=1,n={}){return new Promise((s,i)=>{let o=ll.call(this,s,i);cl.call(this,"reward",o,e,t,n)})}block(e,t,n={}){return new Promise((s,i)=>{let o=ll.call(this,s,i);cl.call(this,"block",o,e,t,n)})}get(e,t={}){return new Promise((n,s)=>{let i=ll.call(this,n,s);cl.call(this,"get",i,e,t)})}delete(e,t={}){return new Promise((n,s)=>{let i=ll.call(this,n,s);cl.call(this,"delete",i,e,t)})}};QR.exports={RateLimiterClusterMaster:qg,RateLimiterClusterMasterPM2:Kg,RateLimiterCluster:$g}});var ZR=N((sye,jR)=>{var KW=al(),$W=En(),Hg=class extends KW{constructor(e){super(e),this.client=e.storeClient}_getRateLimiterRes(e,t,n){let s=new $W;return s.consumedPoints=parseInt(n.consumedPoints),s.isFirstInDuration=n.consumedPoints===t,s.remainingPoints=Math.max(this.points-s.consumedPoints,0),s.msBeforeNext=n.msBeforeNext,s}_upsert(e,t,n,s=!1,i={}){return new Promise((o,a)=>{let c=Date.now(),l=Math.floor(n/1e3);s?this.client.set(e,t,l,u=>{u?a(u):this.client.set(`${e}_expire`,l>0?c+l*1e3:-1,l,()=>{let f={consumedPoints:t,msBeforeNext:l>0?l*1e3:-1};o(f)})}):this.client.incr(e,t,(u,f)=>{u||f===!1?this.client.add(e,t,l,(h,p)=>{if(h||!p)if(typeof i.attemptNumber>"u"||i.attemptNumber<3){let d=Object.assign({},i);d.attemptNumber=d.attemptNumber?d.attemptNumber+1:1,this._upsert(e,t,n,s,d).then(m=>o(m)).catch(m=>a(m))}else a(new Error("Can not add key"));else this.client.add(`${e}_expire`,l>0?c+l*1e3:-1,l,()=>{let d={consumedPoints:t,msBeforeNext:l>0?l*1e3:-1};o(d)})}):this.client.get(`${e}_expire`,(h,p)=>{if(h)a(h);else{let d=p===!1?0:p,m={consumedPoints:f,msBeforeNext:d>=0?Math.max(d-c,0):-1};o(m)}})})})}_get(e){return new Promise((t,n)=>{let s=Date.now();this.client.get(e,(i,o)=>{o?this.client.get(`${e}_expire`,(a,c)=>{if(a)n(a);else{let l=c===!1?0:c,u={consumedPoints:o,msBeforeNext:l>=0?Math.max(l-s,0):-1};t(u)}}):t(null)})})}_delete(e){return new Promise((t,n)=>{this.client.del(e,(s,i)=>{s?n(s):i===!1?t(i):this.client.del(`${e}_expire`,o=>{o?n(o):t(i)})})})}};jR.exports=Hg});var tI=N((oye,eI)=>{var JR=En();eI.exports=class{constructor(e={}){this.limiter=e.limiter,this.blackList=e.blackList,this.whiteList=e.whiteList,this.isBlackListed=e.isBlackListed,this.isWhiteListed=e.isWhiteListed,this.runActionAnyway=e.runActionAnyway}get limiter(){return this._limiter}set limiter(e){if(typeof e>"u")throw new Error("limiter is not set");this._limiter=e}get runActionAnyway(){return this._runActionAnyway}set runActionAnyway(e){this._runActionAnyway=typeof e>"u"?!1:e}get blackList(){return this._blackList}set blackList(e){this._blackList=Array.isArray(e)?e:[]}get isBlackListed(){return this._isBlackListed}set isBlackListed(e){if(typeof e>"u"&&(e=()=>!1),typeof e!="function")throw new Error("isBlackListed must be function");this._isBlackListed=e}get whiteList(){return this._whiteList}set whiteList(e){this._whiteList=Array.isArray(e)?e:[]}get isWhiteListed(){return this._isWhiteListed}set isWhiteListed(e){if(typeof e>"u"&&(e=()=>!1),typeof e!="function")throw new Error("isWhiteListed must be function");this._isWhiteListed=e}isBlackListedSomewhere(e){return this.blackList.indexOf(e)>=0||this.isBlackListed(e)}isWhiteListedSomewhere(e){return this.whiteList.indexOf(e)>=0||this.isWhiteListed(e)}getBlackRes(){return new JR(0,Number.MAX_SAFE_INTEGER,0,!1)}getWhiteRes(){return new JR(Number.MAX_SAFE_INTEGER,0,0,!1)}rejectBlack(){return Promise.reject(this.getBlackRes())}resolveBlack(){return Promise.resolve(this.getBlackRes())}resolveWhite(){return Promise.resolve(this.getWhiteRes())}consume(e,t=1){let n;return this.isWhiteListedSomewhere(e)?n=this.resolveWhite():this.isBlackListedSomewhere(e)&&(n=this.rejectBlack()),typeof n>"u"?this.limiter.consume(e,t):(this.runActionAnyway&&this.limiter.consume(e,t).catch(()=>{}),n)}block(e,t){let n;return this.isWhiteListedSomewhere(e)?n=this.resolveWhite():this.isBlackListedSomewhere(e)&&(n=this.resolveBlack()),typeof n>"u"?this.limiter.block(e,t):(this.runActionAnyway&&this.limiter.block(e,t).catch(()=>{}),n)}penalty(e,t){let n;return this.isWhiteListedSomewhere(e)?n=this.resolveWhite():this.isBlackListedSomewhere(e)&&(n=this.resolveBlack()),typeof n>"u"?this.limiter.penalty(e,t):(this.runActionAnyway&&this.limiter.penalty(e,t).catch(()=>{}),n)}reward(e,t){let n;return this.isWhiteListedSomewhere(e)?n=this.resolveWhite():this.isBlackListedSomewhere(e)&&(n=this.resolveBlack()),typeof n>"u"?this.limiter.reward(e,t):(this.runActionAnyway&&this.limiter.reward(e,t).catch(()=>{}),n)}get(e){let t;return this.isWhiteListedSomewhere(e)?t=this.resolveWhite():this.isBlackListedSomewhere(e)&&(t=this.resolveBlack()),typeof t>"u"||this.runActionAnyway?this.limiter.get(e):t}delete(e){return this.limiter.delete(e)}}});var nI=N((cye,rI)=>{var HW=Kf();rI.exports=class{constructor(...e){if(e.length<1)throw new Error("RateLimiterUnion: at least one limiter have to be passed");e.forEach(t=>{if(!(t instanceof HW))throw new Error("RateLimiterUnion: all limiters have to be instance of RateLimiterAbstract")}),this._limiters=e}consume(e,t=1){return new Promise((n,s)=>{let i=[];this._limiters.forEach(o=>{i.push(o.consume(e,t).catch(a=>({rejected:!0,rej:a})))}),Promise.all(i).then(o=>{let a={},c=!1;o.forEach(l=>{l.rejected===!0&&(c=!0)});for(let l=0;l<o.length;l++)c&&o[l].rejected===!0?a[this._limiters[l].keyPrefix]=o[l].rej:c||(a[this._limiters[l].keyPrefix]=o[l]);c?s(a):n(a)})})}}});var iI=N((uye,sI)=>{sI.exports=class extends Error{constructor(e,t){super(),Error.captureStackTrace&&Error.captureStackTrace(this,this.constructor),this.name="CustomError",this.message=e,t&&(this.extra=t)}}});var lI=N((hye,cI)=>{var oI=iI(),aI=4294967295,Gg="limiter";cI.exports=class{constructor(e,t={maxQueueSize:aI}){this._queueLimiters={KEY_DEFAULT:new op(e,t)},this._limiterFlexible=e,this._maxQueueSize=t.maxQueueSize}getTokensRemaining(e=Gg){return this._queueLimiters[e]?this._queueLimiters[e].getTokensRemaining():Promise.resolve(this._limiterFlexible.points)}removeTokens(e,t=Gg){return this._queueLimiters[t]||(this._queueLimiters[t]=new op(this._limiterFlexible,{key:t,maxQueueSize:this._maxQueueSize})),this._queueLimiters[t].removeTokens(e)}};var op=class{constructor(e,t={maxQueueSize:aI,key:Gg}){this._key=t.key,this._waitTimeout=null,this._queue=[],this._limiterFlexible=e,this._maxQueueSize=t.maxQueueSize}getTokensRemaining(){return this._limiterFlexible.get(this._key).then(e=>e!==null?e.remainingPoints:this._limiterFlexible.points)}removeTokens(e){let t=this;return new Promise((n,s)=>{if(e>t._limiterFlexible.points){s(new oI(`Requested tokens ${e} exceeds maximum ${t._limiterFlexible.points} tokens per interval`));return}t._queue.length>0?t._queueRequest.call(t,n,s,e):t._limiterFlexible.consume(t._key,e).then(i=>{n(i.remainingPoints)}).catch(i=>{i instanceof Error?s(i):(t._queueRequest.call(t,n,s,e),t._waitTimeout===null&&(t._waitTimeout=setTimeout(t._processFIFO.bind(t),i.msBeforeNext)))})})}_queueRequest(e,t,n){let s=this;s._queue.length<s._maxQueueSize?s._queue.push({resolve:e,reject:t,tokens:n}):t(new oI(`Number of requests reached it's maximum ${s._maxQueueSize}`))}_processFIFO(){let e=this;if(e._waitTimeout!==null&&(clearTimeout(e._waitTimeout),e._waitTimeout=null),e._queue.length===0)return;let t=e._queue.shift();e._limiterFlexible.consume(e._key,t.tokens).then(n=>{t.resolve(n.remainingPoints),e._processFIFO.call(e)}).catch(n=>{n instanceof Error?(t.reject(n),e._processFIFO.call(e)):(e._queue.unshift(t),e._waitTimeout===null&&(e._waitTimeout=setTimeout(e._processFIFO.bind(e),n.msBeforeNext)))})}}});var fI=N((pye,uI)=>{var Wg=En();uI.exports=class{constructor(e,t){this._rateLimiter=e,this._burstLimiter=t}_combineRes(e,t){return e?new Wg(e.remainingPoints,Math.min(e.msBeforeNext,t?t.msBeforeNext:0),e.consumedPoints,e.isFirstInDuration):null}consume(e,t=1,n={}){return this._rateLimiter.consume(e,t,n).catch(s=>s instanceof Wg?this._burstLimiter.consume(e,t,n).then(i=>Promise.resolve(this._combineRes(s,i))).catch(i=>i instanceof Wg?Promise.reject(this._combineRes(s,i)):Promise.reject(i)):Promise.reject(s))}get(e){return Promise.all([this._rateLimiter.get(e),this._burstLimiter.get(e)]).then(([t,n])=>this._combineRes(t,n))}get points(){return this._rateLimiter.points}}});var Yg=N((mye,hI)=>{var GW=DR(),WW=kR(),YW=OR(),QW=BR(),{RateLimiterClusterMaster:XW,RateLimiterClusterMasterPM2:jW,RateLimiterCluster:ZW}=XR(),JW=zg(),eY=ZR(),tY=tI(),rY=nI(),nY=lI(),sY=fI(),iY=En();hI.exports={RateLimiterRedis:GW,RateLimiterMongo:WW,RateLimiterMySQL:YW,RateLimiterPostgres:QW,RateLimiterMemory:JW,RateLimiterMemcache:eY,RateLimiterClusterMaster:XW,RateLimiterClusterMasterPM2:jW,RateLimiterCluster:ZW,RLWrapperBlackAndWhite:tY,RateLimiterUnion:rY,RateLimiterQueue:nY,BurstyRateLimiter:sY,RateLimiterRes:iY}});var TI=N((_be,II)=>{"use strict";II.exports=dr;var Jf=ho();function dr(r,e){this.lo=r>>>0,this.hi=e>>>0}var Ia=dr.zero=new dr(0,0);Ia.toNumber=function(){return 0};Ia.zzEncode=Ia.zzDecode=function(){return this};Ia.length=function(){return 1};var RY=dr.zeroHash="\0\0\0\0\0\0\0\0";dr.fromNumber=function(e){if(e===0)return Ia;var t=e<0;t&&(e=-e);var n=e>>>0,s=(e-n)/4294967296>>>0;return t&&(s=~s>>>0,n=~n>>>0,++n>4294967295&&(n=0,++s>4294967295&&(s=0))),new dr(n,s)};dr.from=function(e){if(typeof e=="number")return dr.fromNumber(e);if(Jf.isString(e))if(Jf.Long)e=Jf.Long.fromString(e);else return dr.fromNumber(parseInt(e,10));return e.low||e.high?new dr(e.low>>>0,e.high>>>0):Ia};dr.prototype.toNumber=function(e){if(!e&&this.hi>>>31){var t=~this.lo+1>>>0,n=~this.hi>>>0;return t||(n=n+1>>>0),-(t+n*4294967296)}return this.lo+this.hi*4294967296};dr.prototype.toLong=function(e){return Jf.Long?new Jf.Long(this.lo|0,this.hi|0,!!e):{low:this.lo|0,high:this.hi|0,unsigned:!!e}};var fo=String.prototype.charCodeAt;dr.fromHash=function(e){return e===RY?Ia:new dr((fo.call(e,0)|fo.call(e,1)<<8|fo.call(e,2)<<16|fo.call(e,3)<<24)>>>0,(fo.call(e,4)|fo.call(e,5)<<8|fo.call(e,6)<<16|fo.call(e,7)<<24)>>>0)};dr.prototype.toHash=function(){return String.fromCharCode(this.lo&255,this.lo>>>8&255,this.lo>>>16&255,this.lo>>>24,this.hi&255,this.hi>>>8&255,this.hi>>>16&255,this.hi>>>24)};dr.prototype.zzEncode=function(){var e=this.hi>>31;return this.hi=((this.hi<<1|this.lo>>>31)^e)>>>0,this.lo=(this.lo<<1^e)>>>0,this};dr.prototype.zzDecode=function(){var e=-(this.lo&1);return this.lo=((this.lo>>>1|this.hi<<31)^e)>>>0,this.hi=(this.hi>>>1^e)>>>0,this};dr.prototype.length=function(){var e=this.lo,t=(this.lo>>>28|this.hi<<4)>>>0,n=this.hi>>>24;return n===0?t===0?e<16384?e<128?1:2:e<2097152?3:4:t<16384?t<128?5:6:t<2097152?7:8:n<128?9:10}});var ho=N(d8=>{"use strict";var ce=d8;ce.asPromise=lm();ce.base64=um();ce.EventEmitter=fm();ce.float=hm();ce.inquire=dm();ce.utf8=mm();ce.pool=gm();ce.LongBits=TI();ce.isNode=!!(typeof globalThis<"u"&&globalThis&&globalThis.process&&globalThis.process.versions&&globalThis.process.versions.node);ce.global=ce.isNode&&globalThis||typeof window<"u"&&window||typeof self<"u"&&self||d8;ce.emptyArray=Object.freeze?Object.freeze([]):[];ce.emptyObject=Object.freeze?Object.freeze({}):{};ce.isInteger=Number.isInteger||function(e){return typeof e=="number"&&isFinite(e)&&Math.floor(e)===e};ce.isString=function(e){return typeof e=="string"||e instanceof String};ce.isObject=function(e){return e&&typeof e=="object"};ce.isset=ce.isSet=function(e,t){var n=e[t];return n!=null&&e.hasOwnProperty(t)?typeof n!="object"||(Array.isArray(n)?n.length:Object.keys(n).length)>0:!1};ce.Buffer=function(){try{var r=ce.inquire("buffer").Buffer;return r.prototype.utf8Write?r:null}catch{return null}}();ce._Buffer_from=null;ce._Buffer_allocUnsafe=null;ce.newBuffer=function(e){return typeof e=="number"?ce.Buffer?ce._Buffer_allocUnsafe(e):new ce.Array(e):ce.Buffer?ce._Buffer_from(e):typeof Uint8Array>"u"?e:new Uint8Array(e)};ce.Array=typeof Uint8Array<"u"?Uint8Array:Array;ce.Long=ce.global.dcodeIO&&ce.global.dcodeIO.Long||ce.global.Long||ce.inquire("long");ce.key2Re=/^true|false|0|1$/;ce.key32Re=/^-?(?:0|[1-9][0-9]*)$/;ce.key64Re=/^(?:[\\x00-\\xff]{8}|-?(?:0|[1-9][0-9]*))$/;ce.longToHash=function(e){return e?ce.LongBits.from(e).toHash():ce.LongBits.zeroHash};ce.longFromHash=function(e,t){var n=ce.LongBits.fromHash(e);return ce.Long?ce.Long.fromBits(n.lo,n.hi,t):n.toNumber(!!t)};function DI(r,e,t){for(var n=Object.keys(e),s=0;s<n.length;++s)(r[n[s]]===void 0||!t)&&(r[n[s]]=e[n[s]]);return r}ce.merge=DI;ce.lcFirst=function(e){return e.charAt(0).toLowerCase()+e.substring(1)};function CI(r){function e(t,n){if(!(this instanceof e))return new e(t,n);Object.defineProperty(this,"message",{get:function(){return t}}),Error.captureStackTrace?Error.captureStackTrace(this,e):Object.defineProperty(this,"stack",{value:new Error().stack||""}),n&&DI(this,n)}return(e.prototype=Object.create(Error.prototype)).constructor=e,Object.defineProperty(e.prototype,"name",{get:function(){return r}}),e.prototype.toString=function(){return this.name+": "+this.message},e}ce.newError=CI;ce.ProtocolError=CI("ProtocolError");ce.oneOfGetter=function(e){for(var t={},n=0;n<e.length;++n)t[e[n]]=1;return function(){for(var s=Object.keys(this),i=s.length-1;i>-1;--i)if(t[s[i]]===1&&this[s[i]]!==void 0&&this[s[i]]!==null)return s[i]}};ce.oneOfSetter=function(e){return function(t){for(var n=0;n<e.length;++n)e[n]!==t&&delete this[e[n]]}};ce.toJSONOptions={longs:String,enums:String,bytes:String,json:!0};ce._configure=function(){var r=ce.Buffer;if(!r){ce._Buffer_from=ce._Buffer_allocUnsafe=null;return}ce._Buffer_from=r.from!==Uint8Array.from&&r.from||function(t,n){return new r(t,n)},ce._Buffer_allocUnsafe=r.allocUnsafe||function(t){return new r(t)}}});var x8=N((Abe,OI)=>{"use strict";OI.exports=He;var qn=ho(),p8,_p=qn.LongBits,PI=qn.base64,kI=qn.utf8;function eh(r,e,t){this.fn=r,this.len=e,this.next=void 0,this.val=t}function g8(){}function IY(r){this.head=r.head,this.tail=r.tail,this.len=r.len,this.next=r.states}function He(){this.len=0,this.head=new eh(g8,0,0),this.tail=this.head,this.states=null}var NI=function(){return qn.Buffer?function(){return(He.create=function(){return new p8})()}:function(){return new He}};He.create=NI();He.alloc=function(e){return new qn.Array(e)};qn.Array!==Array&&(He.alloc=qn.pool(He.alloc,qn.Array.prototype.subarray));He.prototype._push=function(e,t,n){return this.tail=this.tail.next=new eh(e,t,n),this.len+=t,this};function y8(r,e,t){e[t]=r&255}function TY(r,e,t){for(;r>127;)e[t++]=r&127|128,r>>>=7;e[t]=r}function b8(r,e){this.len=r,this.next=void 0,this.val=e}b8.prototype=Object.create(eh.prototype);b8.prototype.fn=TY;He.prototype.uint32=function(e){return this.len+=(this.tail=this.tail.next=new b8((e=e>>>0)<128?1:e<16384?2:e<2097152?3:e<268435456?4:5,e)).len,this};He.prototype.int32=function(e){return e<0?this._push(w8,10,_p.fromNumber(e)):this.uint32(e)};He.prototype.sint32=function(e){return this.uint32((e<<1^e>>31)>>>0)};function w8(r,e,t){for(;r.hi;)e[t++]=r.lo&127|128,r.lo=(r.lo>>>7|r.hi<<25)>>>0,r.hi>>>=7;for(;r.lo>127;)e[t++]=r.lo&127|128,r.lo=r.lo>>>7;e[t++]=r.lo}He.prototype.uint64=function(e){var t=_p.from(e);return this._push(w8,t.length(),t)};He.prototype.int64=He.prototype.uint64;He.prototype.sint64=function(e){var t=_p.from(e).zzEncode();return this._push(w8,t.length(),t)};He.prototype.bool=function(e){return this._push(y8,1,e?1:0)};function m8(r,e,t){e[t]=r&255,e[t+1]=r>>>8&255,e[t+2]=r>>>16&255,e[t+3]=r>>>24}He.prototype.fixed32=function(e){return this._push(m8,4,e>>>0)};He.prototype.sfixed32=He.prototype.fixed32;He.prototype.fixed64=function(e){var t=_p.from(e);return this._push(m8,4,t.lo)._push(m8,4,t.hi)};He.prototype.sfixed64=He.prototype.fixed64;He.prototype.float=function(e){return this._push(qn.float.writeFloatLE,4,e)};He.prototype.double=function(e){return this._push(qn.float.writeDoubleLE,8,e)};var DY=qn.Array.prototype.set?function(e,t,n){t.set(e,n)}:function(e,t,n){for(var s=0;s<e.length;++s)t[n+s]=e[s]};He.prototype.bytes=function(e){var t=e.length>>>0;if(!t)return this._push(y8,1,0);if(qn.isString(e)){var n=He.alloc(t=PI.length(e));PI.decode(e,n,0),e=n}return this.uint32(t)._push(DY,t,e)};He.prototype.string=function(e){var t=kI.length(e);return t?this.uint32(t)._push(kI.write,t,e):this._push(y8,1,0)};He.prototype.fork=function(){return this.states=new IY(this),this.head=this.tail=new eh(g8,0,0),this.len=0,this};He.prototype.reset=function(){return this.states?(this.head=this.states.head,this.tail=this.states.tail,this.len=this.states.len,this.states=this.states.next):(this.head=this.tail=new eh(g8,0,0),this.len=0),this};He.prototype.ldelim=function(){var e=this.head,t=this.tail,n=this.len;return this.reset().uint32(n),n&&(this.tail.next=e.next,this.tail=t,this.len+=n),this};He.prototype.finish=function(){for(var e=this.head.next,t=this.constructor.alloc(this.len),n=0;e;)e.fn(e.val,t,n),n+=e.len,e=e.next;return t};He._configure=function(r){p8=r,He.create=NI(),p8._configure()}});var MI=N((Rbe,BI)=>{"use strict";BI.exports=$s;var LI=x8();($s.prototype=Object.create(LI.prototype)).constructor=$s;var po=ho();function $s(){LI.call(this)}$s._configure=function(){$s.alloc=po._Buffer_allocUnsafe,$s.writeBytesBuffer=po.Buffer&&po.Buffer.prototype instanceof Uint8Array&&po.Buffer.prototype.set.name==="set"?function(e,t,n){t.set(e,n)}:function(e,t,n){if(e.copy)e.copy(t,n,0,e.length);else for(var s=0;s<e.length;)t[n++]=e[s++]}};$s.prototype.bytes=function(e){po.isString(e)&&(e=po._Buffer_from(e,"base64"));var t=e.length>>>0;return this.uint32(t),t&&this._push($s.writeBytesBuffer,t,e),this};function CY(r,e,t){r.length<40?po.utf8.write(r,e,t):e.utf8Write?e.utf8Write(r,t):e.write(r,t)}$s.prototype.string=function(e){var t=po.Buffer.byteLength(e);return this.uint32(t),t&&this._push(CY,t,e),this};$s._configure()});var _8=N((Ibe,qI)=>{"use strict";qI.exports=Wt;var Hs=ho(),v8,VI=Hs.LongBits,PY=Hs.utf8;function hs(r,e){return RangeError("index out of range: "+r.pos+" + "+(e||1)+" > "+r.len)}function Wt(r){this.buf=r,this.pos=0,this.len=r.length}var UI=typeof Uint8Array<"u"?function(e){if(e instanceof Uint8Array||Array.isArray(e))return new Wt(e);throw Error("illegal buffer")}:function(e){if(Array.isArray(e))return new Wt(e);throw Error("illegal buffer")},zI=function(){return Hs.Buffer?function(t){return(Wt.create=function(s){return Hs.Buffer.isBuffer(s)?new v8(s):UI(s)})(t)}:UI};Wt.create=zI();Wt.prototype._slice=Hs.Array.prototype.subarray||Hs.Array.prototype.slice;Wt.prototype.uint32=function(){var e=4294967295;return function(){if(e=(this.buf[this.pos]&127)>>>0,this.buf[this.pos++]<128||(e=(e|(this.buf[this.pos]&127)<<7)>>>0,this.buf[this.pos++]<128)||(e=(e|(this.buf[this.pos]&127)<<14)>>>0,this.buf[this.pos++]<128)||(e=(e|(this.buf[this.pos]&127)<<21)>>>0,this.buf[this.pos++]<128)||(e=(e|(this.buf[this.pos]&15)<<28)>>>0,this.buf[this.pos++]<128))return e;if((this.pos+=5)>this.len)throw this.pos=this.len,hs(this,10);return e}}();Wt.prototype.int32=function(){return this.uint32()|0};Wt.prototype.sint32=function(){var e=this.uint32();return e>>>1^-(e&1)|0};function E8(){var r=new VI(0,0),e=0;if(this.len-this.pos>4){for(;e<4;++e)if(r.lo=(r.lo|(this.buf[this.pos]&127)<<e*7)>>>0,this.buf[this.pos++]<128)return r;if(r.lo=(r.lo|(this.buf[this.pos]&127)<<28)>>>0,r.hi=(r.hi|(this.buf[this.pos]&127)>>4)>>>0,this.buf[this.pos++]<128)return r;e=0}else{for(;e<3;++e){if(this.pos>=this.len)throw hs(this);if(r.lo=(r.lo|(this.buf[this.pos]&127)<<e*7)>>>0,this.buf[this.pos++]<128)return r}return r.lo=(r.lo|(this.buf[this.pos++]&127)<<e*7)>>>0,r}if(this.len-this.pos>4){for(;e<5;++e)if(r.hi=(r.hi|(this.buf[this.pos]&127)<<e*7+3)>>>0,this.buf[this.pos++]<128)return r}else for(;e<5;++e){if(this.pos>=this.len)throw hs(this);if(r.hi=(r.hi|(this.buf[this.pos]&127)<<e*7+3)>>>0,this.buf[this.pos++]<128)return r}throw Error("invalid varint encoding")}Wt.prototype.bool=function(){return this.uint32()!==0};function Sp(r,e){return(r[e-4]|r[e-3]<<8|r[e-2]<<16|r[e-1]<<24)>>>0}Wt.prototype.fixed32=function(){if(this.pos+4>this.len)throw hs(this,4);return Sp(this.buf,this.pos+=4)};Wt.prototype.sfixed32=function(){if(this.pos+4>this.len)throw hs(this,4);return Sp(this.buf,this.pos+=4)|0};function FI(){if(this.pos+8>this.len)throw hs(this,8);return new VI(Sp(this.buf,this.pos+=4),Sp(this.buf,this.pos+=4))}Wt.prototype.float=function(){if(this.pos+4>this.len)throw hs(this,4);var e=Hs.float.readFloatLE(this.buf,this.pos);return this.pos+=4,e};Wt.prototype.double=function(){if(this.pos+8>this.len)throw hs(this,4);var e=Hs.float.readDoubleLE(this.buf,this.pos);return this.pos+=8,e};Wt.prototype.bytes=function(){var e=this.uint32(),t=this.pos,n=this.pos+e;if(n>this.len)throw hs(this,e);return this.pos+=e,Array.isArray(this.buf)?this.buf.slice(t,n):t===n?new this.buf.constructor(0):this._slice.call(this.buf,t,n)};Wt.prototype.string=function(){var e=this.bytes();return PY.read(e,0,e.length)};Wt.prototype.skip=function(e){if(typeof e=="number"){if(this.pos+e>this.len)throw hs(this,e);this.pos+=e}else do if(this.pos>=this.len)throw hs(this);while(this.buf[this.pos++]&128);return this};Wt.prototype.skipType=function(r){switch(r){case 0:this.skip();break;case 1:this.skip(8);break;case 2:this.skip(this.uint32());break;case 3:for(;(r=this.uint32()&7)!==4;)this.skipType(r);break;case 5:this.skip(4);break;default:throw Error("invalid wire type "+r+" at offset "+this.pos)}return this};Wt._configure=function(r){v8=r,Wt.create=zI(),v8._configure();var e=Hs.Long?"toLong":"toNumber";Hs.merge(Wt.prototype,{int64:function(){return E8.call(this)[e](!1)},uint64:function(){return E8.call(this)[e](!0)},sint64:function(){return E8.call(this).zzDecode()[e](!1)},fixed64:function(){return FI.call(this)[e](!0)},sfixed64:function(){return FI.call(this)[e](!1)}})}});var GI=N((Tbe,HI)=>{"use strict";HI.exports=Ta;var $I=_8();(Ta.prototype=Object.create($I.prototype)).constructor=Ta;var KI=ho();function Ta(r){$I.call(this,r)}Ta._configure=function(){KI.Buffer&&(Ta.prototype._slice=KI.Buffer.prototype.slice)};Ta.prototype.string=function(){var e=this.uint32();return this.buf.utf8Slice?this.buf.utf8Slice(this.pos,this.pos=Math.min(this.pos+e,this.len)):this.buf.toString("utf-8",this.pos,this.pos=Math.min(this.pos+e,this.len))};Ta._configure()});var YI=N((Dbe,WI)=>{"use strict";WI.exports=th;var S8=ho();(th.prototype=Object.create(S8.EventEmitter.prototype)).constructor=th;function th(r,e,t){if(typeof r!="function")throw TypeError("rpcImpl must be a function");S8.EventEmitter.call(this),this.rpcImpl=r,this.requestDelimited=!!e,this.responseDelimited=!!t}th.prototype.rpcCall=function r(e,t,n,s,i){if(!s)throw TypeError("request must be specified");var o=this;if(!i)return S8.asPromise(r,o,e,t,n,s);if(!o.rpcImpl){setTimeout(function(){i(Error("already ended"))},0);return}try{return o.rpcImpl(e,t[o.requestDelimited?"encodeDelimited":"encode"](s).finish(),function(c,l){if(c)return o.emit("error",c,e),i(c);if(l===null){o.end(!0);return}if(!(l instanceof n))try{l=n[o.responseDelimited?"decodeDelimited":"decode"](l)}catch(u){return o.emit("error",u,e),i(u)}return o.emit("data",l,e),i(null,l)})}catch(a){o.emit("error",a,e),setTimeout(function(){i(a)},0);return}};th.prototype.end=function(e){return this.rpcImpl&&(e||this.rpcImpl(null,null,null),this.rpcImpl=null,this.emit("end").off()),this}});var XI=N(QI=>{"use strict";var kY=QI;kY.Service=YI()});var ZI=N((Pbe,jI)=>{"use strict";jI.exports={}});var tT=N(eT=>{"use strict";var Xr=eT;Xr.build="minimal";Xr.Writer=x8();Xr.BufferWriter=MI();Xr.Reader=_8();Xr.BufferReader=GI();Xr.util=ho();Xr.rpc=XI();Xr.roots=ZI();Xr.configure=JI;function JI(){Xr.util._configure(),Xr.Writer._configure(Xr.BufferWriter),Xr.Reader._configure(Xr.BufferReader)}JI()});var A8=N((Nbe,rT)=>{"use strict";rT.exports=tT()});var sT=N((nT,rh)=>{(function(r,e){typeof define=="function"&&define.amd?define(["protobufjs/minimal"],e):typeof $7=="function"&&typeof rh=="object"&&rh&&rh.exports&&(rh.exports=e(A8()))})(nT,function(r){"use strict";var e=r.Reader,t=r.Writer,n=r.util,s=r.roots.default||(r.roots.default={});return s.RPC=function(){function i(a){if(this.subscriptions=[],this.messages=[],a)for(var c=Object.keys(a),l=0;l<c.length;++l)a[c[l]]!=null&&(this[c[l]]=a[c[l]])}i.prototype.subscriptions=n.emptyArray,i.prototype.messages=n.emptyArray,i.prototype.control=null;var o;return Object.defineProperty(i.prototype,"_control",{get:n.oneOfGetter(o=["control"]),set:n.oneOfSetter(o)}),i.encode=function(c,l){if(l||(l=t.create()),c.subscriptions!=null&&c.subscriptions.length)for(var u=0;u<c.subscriptions.length;++u)s.RPC.SubOpts.encode(c.subscriptions[u],l.uint32(10).fork()).ldelim();if(c.messages!=null&&c.messages.length)for(var u=0;u<c.messages.length;++u)s.RPC.Message.encode(c.messages[u],l.uint32(18).fork()).ldelim();return c.control!=null&&Object.hasOwnProperty.call(c,"control")&&s.RPC.ControlMessage.encode(c.control,l.uint32(26).fork()).ldelim(),l},i.decode=function(c,l){c instanceof e||(c=e.create(c));for(var u=l===void 0?c.len:c.pos+l,f=new s.RPC;c.pos<u;){var h=c.uint32();switch(h>>>3){case 1:f.subscriptions&&f.subscriptions.length||(f.subscriptions=[]),f.subscriptions.push(s.RPC.SubOpts.decode(c,c.uint32()));break;case 2:f.messages&&f.messages.length||(f.messages=[]),f.messages.push(s.RPC.Message.decode(c,c.uint32()));break;case 3:f.control=s.RPC.ControlMessage.decode(c,c.uint32());break;default:c.skipType(h&7);break}}return f},i.fromObject=function(c){if(c instanceof s.RPC)return c;var l=new s.RPC;if(c.subscriptions){if(!Array.isArray(c.subscriptions))throw TypeError(".RPC.subscriptions: array expected");l.subscriptions=[];for(var u=0;u<c.subscriptions.length;++u){if(typeof c.subscriptions[u]!="object")throw TypeError(".RPC.subscriptions: object expected");l.subscriptions[u]=s.RPC.SubOpts.fromObject(c.subscriptions[u])}}if(c.messages){if(!Array.isArray(c.messages))throw TypeError(".RPC.messages: array expected");l.messages=[];for(var u=0;u<c.messages.length;++u){if(typeof c.messages[u]!="object")throw TypeError(".RPC.messages: object expected");l.messages[u]=s.RPC.Message.fromObject(c.messages[u])}}if(c.control!=null){if(typeof c.control!="object")throw TypeError(".RPC.control: object expected");l.control=s.RPC.ControlMessage.fromObject(c.control)}return l},i.toObject=function(c,l){l||(l={});var u={};if((l.arrays||l.defaults)&&(u.subscriptions=[],u.messages=[]),c.subscriptions&&c.subscriptions.length){u.subscriptions=[];for(var f=0;f<c.subscriptions.length;++f)u.subscriptions[f]=s.RPC.SubOpts.toObject(c.subscriptions[f],l)}if(c.messages&&c.messages.length){u.messages=[];for(var f=0;f<c.messages.length;++f)u.messages[f]=s.RPC.Message.toObject(c.messages[f],l)}return c.control!=null&&c.hasOwnProperty("control")&&(u.control=s.RPC.ControlMessage.toObject(c.control,l),l.oneofs&&(u._control="control")),u},i.prototype.toJSON=function(){return this.constructor.toObject(this,r.util.toJSONOptions)},i.SubOpts=function(){function a(l){if(l)for(var u=Object.keys(l),f=0;f<u.length;++f)l[u[f]]!=null&&(this[u[f]]=l[u[f]])}a.prototype.subscribe=null,a.prototype.topic=null;var c;return Object.defineProperty(a.prototype,"_subscribe",{get:n.oneOfGetter(c=["subscribe"]),set:n.oneOfSetter(c)}),Object.defineProperty(a.prototype,"_topic",{get:n.oneOfGetter(c=["topic"]),set:n.oneOfSetter(c)}),a.encode=function(u,f){return f||(f=t.create()),u.subscribe!=null&&Object.hasOwnProperty.call(u,"subscribe")&&f.uint32(8).bool(u.subscribe),u.topic!=null&&Object.hasOwnProperty.call(u,"topic")&&f.uint32(18).string(u.topic),f},a.decode=function(u,f){u instanceof e||(u=e.create(u));for(var h=f===void 0?u.len:u.pos+f,p=new s.RPC.SubOpts;u.pos<h;){var d=u.uint32();switch(d>>>3){case 1:p.subscribe=u.bool();break;case 2:p.topic=u.string();break;default:u.skipType(d&7);break}}return p},a.fromObject=function(u){if(u instanceof s.RPC.SubOpts)return u;var f=new s.RPC.SubOpts;return u.subscribe!=null&&(f.subscribe=!!u.subscribe),u.topic!=null&&(f.topic=String(u.topic)),f},a.toObject=function(u,f){f||(f={});var h={};return u.subscribe!=null&&u.hasOwnProperty("subscribe")&&(h.subscribe=u.subscribe,f.oneofs&&(h._subscribe="subscribe")),u.topic!=null&&u.hasOwnProperty("topic")&&(h.topic=u.topic,f.oneofs&&(h._topic="topic")),h},a.prototype.toJSON=function(){return this.constructor.toObject(this,r.util.toJSONOptions)},a}(),i.Message=function(){function a(l){if(l)for(var u=Object.keys(l),f=0;f<u.length;++f)l[u[f]]!=null&&(this[u[f]]=l[u[f]])}a.prototype.from=null,a.prototype.data=null,a.prototype.seqno=null,a.prototype.topic="",a.prototype.signature=null,a.prototype.key=null;var c;return Object.defineProperty(a.prototype,"_from",{get:n.oneOfGetter(c=["from"]),set:n.oneOfSetter(c)}),Object.defineProperty(a.prototype,"_data",{get:n.oneOfGetter(c=["data"]),set:n.oneOfSetter(c)}),Object.defineProperty(a.prototype,"_seqno",{get:n.oneOfGetter(c=["seqno"]),set:n.oneOfSetter(c)}),Object.defineProperty(a.prototype,"_signature",{get:n.oneOfGetter(c=["signature"]),set:n.oneOfSetter(c)}),Object.defineProperty(a.prototype,"_key",{get:n.oneOfGetter(c=["key"]),set:n.oneOfSetter(c)}),a.encode=function(u,f){return f||(f=t.create()),u.from!=null&&Object.hasOwnProperty.call(u,"from")&&f.uint32(10).bytes(u.from),u.data!=null&&Object.hasOwnProperty.call(u,"data")&&f.uint32(18).bytes(u.data),u.seqno!=null&&Object.hasOwnProperty.call(u,"seqno")&&f.uint32(26).bytes(u.seqno),f.uint32(34).string(u.topic),u.signature!=null&&Object.hasOwnProperty.call(u,"signature")&&f.uint32(42).bytes(u.signature),u.key!=null&&Object.hasOwnProperty.call(u,"key")&&f.uint32(50).bytes(u.key),f},a.decode=function(u,f){u instanceof e||(u=e.create(u));for(var h=f===void 0?u.len:u.pos+f,p=new s.RPC.Message;u.pos<h;){var d=u.uint32();switch(d>>>3){case 1:p.from=u.bytes();break;case 2:p.data=u.bytes();break;case 3:p.seqno=u.bytes();break;case 4:p.topic=u.string();break;case 5:p.signature=u.bytes();break;case 6:p.key=u.bytes();break;default:u.skipType(d&7);break}}if(!p.hasOwnProperty("topic"))throw n.ProtocolError("missing required 'topic'",{instance:p});return p},a.fromObject=function(u){if(u instanceof s.RPC.Message)return u;var f=new s.RPC.Message;return u.from!=null&&(typeof u.from=="string"?n.base64.decode(u.from,f.from=n.newBuffer(n.base64.length(u.from)),0):u.from.length&&(f.from=u.from)),u.data!=null&&(typeof u.data=="string"?n.base64.decode(u.data,f.data=n.newBuffer(n.base64.length(u.data)),0):u.data.length&&(f.data=u.data)),u.seqno!=null&&(typeof u.seqno=="string"?n.base64.decode(u.seqno,f.seqno=n.newBuffer(n.base64.length(u.seqno)),0):u.seqno.length&&(f.seqno=u.seqno)),u.topic!=null&&(f.topic=String(u.topic)),u.signature!=null&&(typeof u.signature=="string"?n.base64.decode(u.signature,f.signature=n.newBuffer(n.base64.length(u.signature)),0):u.signature.length&&(f.signature=u.signature)),u.key!=null&&(typeof u.key=="string"?n.base64.decode(u.key,f.key=n.newBuffer(n.base64.length(u.key)),0):u.key.length&&(f.key=u.key)),f},a.toObject=function(u,f){f||(f={});var h={};return f.defaults&&(h.topic=""),u.from!=null&&u.hasOwnProperty("from")&&(h.from=f.bytes===String?n.base64.encode(u.from,0,u.from.length):f.bytes===Array?Array.prototype.slice.call(u.from):u.from,f.oneofs&&(h._from="from")),u.data!=null&&u.hasOwnProperty("data")&&(h.data=f.bytes===String?n.base64.encode(u.data,0,u.data.length):f.bytes===Array?Array.prototype.slice.call(u.data):u.data,f.oneofs&&(h._data="data")),u.seqno!=null&&u.hasOwnProperty("seqno")&&(h.seqno=f.bytes===String?n.base64.encode(u.seqno,0,u.seqno.length):f.bytes===Array?Array.prototype.slice.call(u.seqno):u.seqno,f.oneofs&&(h._seqno="seqno")),u.topic!=null&&u.hasOwnProperty("topic")&&(h.topic=u.topic),u.signature!=null&&u.hasOwnProperty("signature")&&(h.signature=f.bytes===String?n.base64.encode(u.signature,0,u.signature.length):f.bytes===Array?Array.prototype.slice.call(u.signature):u.signature,f.oneofs&&(h._signature="signature")),u.key!=null&&u.hasOwnProperty("key")&&(h.key=f.bytes===String?n.base64.encode(u.key,0,u.key.length):f.bytes===Array?Array.prototype.slice.call(u.key):u.key,f.oneofs&&(h._key="key")),h},a.prototype.toJSON=function(){return this.constructor.toObject(this,r.util.toJSONOptions)},a}(),i.ControlMessage=function(){function a(c){if(this.ihave=[],this.iwant=[],this.graft=[],this.prune=[],c)for(var l=Object.keys(c),u=0;u<l.length;++u)c[l[u]]!=null&&(this[l[u]]=c[l[u]])}return a.prototype.ihave=n.emptyArray,a.prototype.iwant=n.emptyArray,a.prototype.graft=n.emptyArray,a.prototype.prune=n.emptyArray,a.encode=function(l,u){if(u||(u=t.create()),l.ihave!=null&&l.ihave.length)for(var f=0;f<l.ihave.length;++f)s.RPC.ControlIHave.encode(l.ihave[f],u.uint32(10).fork()).ldelim();if(l.iwant!=null&&l.iwant.length)for(var f=0;f<l.iwant.length;++f)s.RPC.ControlIWant.encode(l.iwant[f],u.uint32(18).fork()).ldelim();if(l.graft!=null&&l.graft.length)for(var f=0;f<l.graft.length;++f)s.RPC.ControlGraft.encode(l.graft[f],u.uint32(26).fork()).ldelim();if(l.prune!=null&&l.prune.length)for(var f=0;f<l.prune.length;++f)s.RPC.ControlPrune.encode(l.prune[f],u.uint32(34).fork()).ldelim();return u},a.decode=function(l,u){l instanceof e||(l=e.create(l));for(var f=u===void 0?l.len:l.pos+u,h=new s.RPC.ControlMessage;l.pos<f;){var p=l.uint32();switch(p>>>3){case 1:h.ihave&&h.ihave.length||(h.ihave=[]),h.ihave.push(s.RPC.ControlIHave.decode(l,l.uint32()));break;case 2:h.iwant&&h.iwant.length||(h.iwant=[]),h.iwant.push(s.RPC.ControlIWant.decode(l,l.uint32()));break;case 3:h.graft&&h.graft.length||(h.graft=[]),h.graft.push(s.RPC.ControlGraft.decode(l,l.uint32()));break;case 4:h.prune&&h.prune.length||(h.prune=[]),h.prune.push(s.RPC.ControlPrune.decode(l,l.uint32()));break;default:l.skipType(p&7);break}}return h},a.fromObject=function(l){if(l instanceof s.RPC.ControlMessage)return l;var u=new s.RPC.ControlMessage;if(l.ihave){if(!Array.isArray(l.ihave))throw TypeError(".RPC.ControlMessage.ihave: array expected");u.ihave=[];for(var f=0;f<l.ihave.length;++f){if(typeof l.ihave[f]!="object")throw TypeError(".RPC.ControlMessage.ihave: object expected");u.ihave[f]=s.RPC.ControlIHave.fromObject(l.ihave[f])}}if(l.iwant){if(!Array.isArray(l.iwant))throw TypeError(".RPC.ControlMessage.iwant: array expected");u.iwant=[];for(var f=0;f<l.iwant.length;++f){if(typeof l.iwant[f]!="object")throw TypeError(".RPC.ControlMessage.iwant: object expected");u.iwant[f]=s.RPC.ControlIWant.fromObject(l.iwant[f])}}if(l.graft){if(!Array.isArray(l.graft))throw TypeError(".RPC.ControlMessage.graft: array expected");u.graft=[];for(var f=0;f<l.graft.length;++f){if(typeof l.graft[f]!="object")throw TypeError(".RPC.ControlMessage.graft: object expected");u.graft[f]=s.RPC.ControlGraft.fromObject(l.graft[f])}}if(l.prune){if(!Array.isArray(l.prune))throw TypeError(".RPC.ControlMessage.prune: array expected");u.prune=[];for(var f=0;f<l.prune.length;++f){if(typeof l.prune[f]!="object")throw TypeError(".RPC.ControlMessage.prune: object expected");u.prune[f]=s.RPC.ControlPrune.fromObject(l.prune[f])}}return u},a.toObject=function(l,u){u||(u={});var f={};if((u.arrays||u.defaults)&&(f.ihave=[],f.iwant=[],f.graft=[],f.prune=[]),l.ihave&&l.ihave.length){f.ihave=[];for(var h=0;h<l.ihave.length;++h)f.ihave[h]=s.RPC.ControlIHave.toObject(l.ihave[h],u)}if(l.iwant&&l.iwant.length){f.iwant=[];for(var h=0;h<l.iwant.length;++h)f.iwant[h]=s.RPC.ControlIWant.toObject(l.iwant[h],u)}if(l.graft&&l.graft.length){f.graft=[];for(var h=0;h<l.graft.length;++h)f.graft[h]=s.RPC.ControlGraft.toObject(l.graft[h],u)}if(l.prune&&l.prune.length){f.prune=[];for(var h=0;h<l.prune.length;++h)f.prune[h]=s.RPC.ControlPrune.toObject(l.prune[h],u)}return f},a.prototype.toJSON=function(){return this.constructor.toObject(this,r.util.toJSONOptions)},a}(),i.ControlIHave=function(){function a(l){if(this.messageIDs=[],l)for(var u=Object.keys(l),f=0;f<u.length;++f)l[u[f]]!=null&&(this[u[f]]=l[u[f]])}a.prototype.topicID=null,a.prototype.messageIDs=n.emptyArray;var c;return Object.defineProperty(a.prototype,"_topicID",{get:n.oneOfGetter(c=["topicID"]),set:n.oneOfSetter(c)}),a.encode=function(u,f){if(f||(f=t.create()),u.topicID!=null&&Object.hasOwnProperty.call(u,"topicID")&&f.uint32(10).string(u.topicID),u.messageIDs!=null&&u.messageIDs.length)for(var h=0;h<u.messageIDs.length;++h)f.uint32(18).bytes(u.messageIDs[h]);return f},a.decode=function(u,f){u instanceof e||(u=e.create(u));for(var h=f===void 0?u.len:u.pos+f,p=new s.RPC.ControlIHave;u.pos<h;){var d=u.uint32();switch(d>>>3){case 1:p.topicID=u.string();break;case 2:p.messageIDs&&p.messageIDs.length||(p.messageIDs=[]),p.messageIDs.push(u.bytes());break;default:u.skipType(d&7);break}}return p},a.fromObject=function(u){if(u instanceof s.RPC.ControlIHave)return u;var f=new s.RPC.ControlIHave;if(u.topicID!=null&&(f.topicID=String(u.topicID)),u.messageIDs){if(!Array.isArray(u.messageIDs))throw TypeError(".RPC.ControlIHave.messageIDs: array expected");f.messageIDs=[];for(var h=0;h<u.messageIDs.length;++h)typeof u.messageIDs[h]=="string"?n.base64.decode(u.messageIDs[h],f.messageIDs[h]=n.newBuffer(n.base64.length(u.messageIDs[h])),0):u.messageIDs[h].length&&(f.messageIDs[h]=u.messageIDs[h])}return f},a.toObject=function(u,f){f||(f={});var h={};if((f.arrays||f.defaults)&&(h.messageIDs=[]),u.topicID!=null&&u.hasOwnProperty("topicID")&&(h.topicID=u.topicID,f.oneofs&&(h._topicID="topicID")),u.messageIDs&&u.messageIDs.length){h.messageIDs=[];for(var p=0;p<u.messageIDs.length;++p)h.messageIDs[p]=f.bytes===String?n.base64.encode(u.messageIDs[p],0,u.messageIDs[p].length):f.bytes===Array?Array.prototype.slice.call(u.messageIDs[p]):u.messageIDs[p]}return h},a.prototype.toJSON=function(){return this.constructor.toObject(this,r.util.toJSONOptions)},a}(),i.ControlIWant=function(){function a(c){if(this.messageIDs=[],c)for(var l=Object.keys(c),u=0;u<l.length;++u)c[l[u]]!=null&&(this[l[u]]=c[l[u]])}return a.prototype.messageIDs=n.emptyArray,a.encode=function(l,u){if(u||(u=t.create()),l.messageIDs!=null&&l.messageIDs.length)for(var f=0;f<l.messageIDs.length;++f)u.uint32(10).bytes(l.messageIDs[f]);return u},a.decode=function(l,u){l instanceof e||(l=e.create(l));for(var f=u===void 0?l.len:l.pos+u,h=new s.RPC.ControlIWant;l.pos<f;){var p=l.uint32();switch(p>>>3){case 1:h.messageIDs&&h.messageIDs.length||(h.messageIDs=[]),h.messageIDs.push(l.bytes());break;default:l.skipType(p&7);break}}return h},a.fromObject=function(l){if(l instanceof s.RPC.ControlIWant)return l;var u=new s.RPC.ControlIWant;if(l.messageIDs){if(!Array.isArray(l.messageIDs))throw TypeError(".RPC.ControlIWant.messageIDs: array expected");u.messageIDs=[];for(var f=0;f<l.messageIDs.length;++f)typeof l.messageIDs[f]=="string"?n.base64.decode(l.messageIDs[f],u.messageIDs[f]=n.newBuffer(n.base64.length(l.messageIDs[f])),0):l.messageIDs[f].length&&(u.messageIDs[f]=l.messageIDs[f])}return u},a.toObject=function(l,u){u||(u={});var f={};if((u.arrays||u.defaults)&&(f.messageIDs=[]),l.messageIDs&&l.messageIDs.length){f.messageIDs=[];for(var h=0;h<l.messageIDs.length;++h)f.messageIDs[h]=u.bytes===String?n.base64.encode(l.messageIDs[h],0,l.messageIDs[h].length):u.bytes===Array?Array.prototype.slice.call(l.messageIDs[h]):l.messageIDs[h]}return f},a.prototype.toJSON=function(){return this.constructor.toObject(this,r.util.toJSONOptions)},a}(),i.ControlGraft=function(){function a(l){if(l)for(var u=Object.keys(l),f=0;f<u.length;++f)l[u[f]]!=null&&(this[u[f]]=l[u[f]])}a.prototype.topicID=null;var c;return Object.defineProperty(a.prototype,"_topicID",{get:n.oneOfGetter(c=["topicID"]),set:n.oneOfSetter(c)}),a.encode=function(u,f){return f||(f=t.create()),u.topicID!=null&&Object.hasOwnProperty.call(u,"topicID")&&f.uint32(10).string(u.topicID),f},a.decode=function(u,f){u instanceof e||(u=e.create(u));for(var h=f===void 0?u.len:u.pos+f,p=new s.RPC.ControlGraft;u.pos<h;){var d=u.uint32();switch(d>>>3){case 1:p.topicID=u.string();break;default:u.skipType(d&7);break}}return p},a.fromObject=function(u){if(u instanceof s.RPC.ControlGraft)return u;var f=new s.RPC.ControlGraft;return u.topicID!=null&&(f.topicID=String(u.topicID)),f},a.toObject=function(u,f){f||(f={});var h={};return u.topicID!=null&&u.hasOwnProperty("topicID")&&(h.topicID=u.topicID,f.oneofs&&(h._topicID="topicID")),h},a.prototype.toJSON=function(){return this.constructor.toObject(this,r.util.toJSONOptions)},a}(),i.ControlPrune=function(){function a(l){if(this.peers=[],l)for(var u=Object.keys(l),f=0;f<u.length;++f)l[u[f]]!=null&&(this[u[f]]=l[u[f]])}a.prototype.topicID=null,a.prototype.peers=n.emptyArray,a.prototype.backoff=null;var c;return Object.defineProperty(a.prototype,"_topicID",{get:n.oneOfGetter(c=["topicID"]),set:n.oneOfSetter(c)}),Object.defineProperty(a.prototype,"_backoff",{get:n.oneOfGetter(c=["backoff"]),set:n.oneOfSetter(c)}),a.encode=function(u,f){if(f||(f=t.create()),u.topicID!=null&&Object.hasOwnProperty.call(u,"topicID")&&f.uint32(10).string(u.topicID),u.peers!=null&&u.peers.length)for(var h=0;h<u.peers.length;++h)s.RPC.PeerInfo.encode(u.peers[h],f.uint32(18).fork()).ldelim();return u.backoff!=null&&Object.hasOwnProperty.call(u,"backoff")&&f.uint32(24).uint64(u.backoff),f},a.decode=function(u,f){u instanceof e||(u=e.create(u));for(var h=f===void 0?u.len:u.pos+f,p=new s.RPC.ControlPrune;u.pos<h;){var d=u.uint32();switch(d>>>3){case 1:p.topicID=u.string();break;case 2:p.peers&&p.peers.length||(p.peers=[]),p.peers.push(s.RPC.PeerInfo.decode(u,u.uint32()));break;case 3:p.backoff=u.uint64();break;default:u.skipType(d&7);break}}return p},a.fromObject=function(u){if(u instanceof s.RPC.ControlPrune)return u;var f=new s.RPC.ControlPrune;if(u.topicID!=null&&(f.topicID=String(u.topicID)),u.peers){if(!Array.isArray(u.peers))throw TypeError(".RPC.ControlPrune.peers: array expected");f.peers=[];for(var h=0;h<u.peers.length;++h){if(typeof u.peers[h]!="object")throw TypeError(".RPC.ControlPrune.peers: object expected");f.peers[h]=s.RPC.PeerInfo.fromObject(u.peers[h])}}return u.backoff!=null&&(n.Long?(f.backoff=n.Long.fromValue(u.backoff)).unsigned=!0:typeof u.backoff=="string"?f.backoff=parseInt(u.backoff,10):typeof u.backoff=="number"?f.backoff=u.backoff:typeof u.backoff=="object"&&(f.backoff=new n.LongBits(u.backoff.low>>>0,u.backoff.high>>>0).toNumber(!0))),f},a.toObject=function(u,f){f||(f={});var h={};if((f.arrays||f.defaults)&&(h.peers=[]),u.topicID!=null&&u.hasOwnProperty("topicID")&&(h.topicID=u.topicID,f.oneofs&&(h._topicID="topicID")),u.peers&&u.peers.length){h.peers=[];for(var p=0;p<u.peers.length;++p)h.peers[p]=s.RPC.PeerInfo.toObject(u.peers[p],f)}return u.backoff!=null&&u.hasOwnProperty("backoff")&&(typeof u.backoff=="number"?h.backoff=f.longs===String?String(u.backoff):u.backoff:h.backoff=f.longs===String?n.Long.prototype.toString.call(u.backoff):f.longs===Number?new n.LongBits(u.backoff.low>>>0,u.backoff.high>>>0).toNumber(!0):u.backoff,f.oneofs&&(h._backoff="backoff")),h},a.prototype.toJSON=function(){return this.constructor.toObject(this,r.util.toJSONOptions)},a}(),i.PeerInfo=function(){function a(l){if(l)for(var u=Object.keys(l),f=0;f<u.length;++f)l[u[f]]!=null&&(this[u[f]]=l[u[f]])}a.prototype.peerID=null,a.prototype.signedPeerRecord=null;var c;return Object.defineProperty(a.prototype,"_peerID",{get:n.oneOfGetter(c=["peerID"]),set:n.oneOfSetter(c)}),Object.defineProperty(a.prototype,"_signedPeerRecord",{get:n.oneOfGetter(c=["signedPeerRecord"]),set:n.oneOfSetter(c)}),a.encode=function(u,f){return f||(f=t.create()),u.peerID!=null&&Object.hasOwnProperty.call(u,"peerID")&&f.uint32(10).bytes(u.peerID),u.signedPeerRecord!=null&&Object.hasOwnProperty.call(u,"signedPeerRecord")&&f.uint32(18).bytes(u.signedPeerRecord),f},a.decode=function(u,f){u instanceof e||(u=e.create(u));for(var h=f===void 0?u.len:u.pos+f,p=new s.RPC.PeerInfo;u.pos<h;){var d=u.uint32();switch(d>>>3){case 1:p.peerID=u.bytes();break;case 2:p.signedPeerRecord=u.bytes();break;default:u.skipType(d&7);break}}return p},a.fromObject=function(u){if(u instanceof s.RPC.PeerInfo)return u;var f=new s.RPC.PeerInfo;return u.peerID!=null&&(typeof u.peerID=="string"?n.base64.decode(u.peerID,f.peerID=n.newBuffer(n.base64.length(u.peerID)),0):u.peerID.length&&(f.peerID=u.peerID)),u.signedPeerRecord!=null&&(typeof u.signedPeerRecord=="string"?n.base64.decode(u.signedPeerRecord,f.signedPeerRecord=n.newBuffer(n.base64.length(u.signedPeerRecord)),0):u.signedPeerRecord.length&&(f.signedPeerRecord=u.signedPeerRecord)),f},a.toObject=function(u,f){f||(f={});var h={};return u.peerID!=null&&u.hasOwnProperty("peerID")&&(h.peerID=f.bytes===String?n.base64.encode(u.peerID,0,u.peerID.length):f.bytes===Array?Array.prototype.slice.call(u.peerID):u.peerID,f.oneofs&&(h._peerID="peerID")),u.signedPeerRecord!=null&&u.hasOwnProperty("signedPeerRecord")&&(h.signedPeerRecord=f.bytes===String?n.base64.encode(u.signedPeerRecord,0,u.signedPeerRecord.length):f.bytes===Array?Array.prototype.slice.call(u.signedPeerRecord):u.signedPeerRecord,f.oneofs&&(h._signedPeerRecord="signedPeerRecord")),h},a.prototype.toJSON=function(){return this.constructor.toObject(this,r.util.toJSONOptions)},a}(),i}(),s})});var mT=N((i9e,pT)=>{"use strict";function Bt(r,t){var t=t||{};this._head=0,this._tail=0,this._capacity=t.capacity,this._capacityMask=3,this._list=new Array(4),Array.isArray(r)&&this._fromArray(r)}Bt.prototype.peekAt=function(e){var t=e;if(t===(t|0)){var n=this.size();if(!(t>=n||t<-n))return t<0&&(t+=n),t=this._head+t&this._capacityMask,this._list[t]}};Bt.prototype.get=function(e){return this.peekAt(e)};Bt.prototype.peek=function(){if(this._head!==this._tail)return this._list[this._head]};Bt.prototype.peekFront=function(){return this.peek()};Bt.prototype.peekBack=function(){return this.peekAt(-1)};Object.defineProperty(Bt.prototype,"length",{get:function(){return this.size()}});Bt.prototype.size=function(){return this._head===this._tail?0:this._head<this._tail?this._tail-this._head:this._capacityMask+1-(this._head-this._tail)};Bt.prototype.unshift=function(e){if(e===void 0)return this.size();var t=this._list.length;return this._head=this._head-1+t&this._capacityMask,this._list[this._head]=e,this._tail===this._head&&this._growArray(),this._capacity&&this.size()>this._capacity&&this.pop(),this._head<this._tail?this._tail-this._head:this._capacityMask+1-(this._head-this._tail)};Bt.prototype.shift=function(){var e=this._head;if(e!==this._tail){var t=this._list[e];return this._list[e]=void 0,this._head=e+1&this._capacityMask,e<2&&this._tail>1e4&&this._tail<=this._list.length>>>2&&this._shrinkArray(),t}};Bt.prototype.push=function(e){if(e===void 0)return this.size();var t=this._tail;return this._list[t]=e,this._tail=t+1&this._capacityMask,this._tail===this._head&&this._growArray(),this._capacity&&this.size()>this._capacity&&this.shift(),this._head<this._tail?this._tail-this._head:this._capacityMask+1-(this._head-this._tail)};Bt.prototype.pop=function(){var e=this._tail;if(e!==this._head){var t=this._list.length;this._tail=e-1+t&this._capacityMask;var n=this._list[this._tail];return this._list[this._tail]=void 0,this._head<2&&e>1e4&&e<=t>>>2&&this._shrinkArray(),n}};Bt.prototype.removeOne=function(e){var t=e;if(t===(t|0)&&this._head!==this._tail){var n=this.size(),s=this._list.length;if(!(t>=n||t<-n)){t<0&&(t+=n),t=this._head+t&this._capacityMask;var i=this._list[t],o;if(e<n/2){for(o=e;o>0;o--)this._list[t]=this._list[t=t-1+s&this._capacityMask];this._list[t]=void 0,this._head=this._head+1+s&this._capacityMask}else{for(o=n-1-e;o>0;o--)this._list[t]=this._list[t=t+1+s&this._capacityMask];this._list[t]=void 0,this._tail=this._tail-1+s&this._capacityMask}return i}}};Bt.prototype.remove=function(e,t){var n=e,s,i=t;if(n===(n|0)&&this._head!==this._tail){var o=this.size(),a=this._list.length;if(!(n>=o||n<-o||t<1)){if(n<0&&(n+=o),t===1||!t)return s=new Array(1),s[0]=this.removeOne(n),s;if(n===0&&n+t>=o)return s=this.toArray(),this.clear(),s;n+t>o&&(t=o-n);var c;for(s=new Array(t),c=0;c<t;c++)s[c]=this._list[this._head+n+c&this._capacityMask];if(n=this._head+n&this._capacityMask,e+t===o){for(this._tail=this._tail-t+a&this._capacityMask,c=t;c>0;c--)this._list[n=n+1+a&this._capacityMask]=void 0;return s}if(e===0){for(this._head=this._head+t+a&this._capacityMask,c=t-1;c>0;c--)this._list[n=n+1+a&this._capacityMask]=void 0;return s}if(n<o/2){for(this._head=this._head+e+t+a&this._capacityMask,c=e;c>0;c--)this.unshift(this._list[n=n-1+a&this._capacityMask]);for(n=this._head-1+a&this._capacityMask;i>0;)this._list[n=n-1+a&this._capacityMask]=void 0,i--;e<0&&(this._tail=n)}else{for(this._tail=n,n=n+t+a&this._capacityMask,c=o-(t+e);c>0;c--)this.push(this._list[n++]);for(n=this._tail;i>0;)this._list[n=n+1+a&this._capacityMask]=void 0,i--}return this._head<2&&this._tail>1e4&&this._tail<=a>>>2&&this._shrinkArray(),s}}};Bt.prototype.splice=function(e,t){var n=e;if(n===(n|0)){var s=this.size();if(n<0&&(n+=s),!(n>s))if(arguments.length>2){var i,o,a,c=arguments.length,l=this._list.length,u=2;if(!s||n<s/2){for(o=new Array(n),i=0;i<n;i++)o[i]=this._list[this._head+i&this._capacityMask];for(t===0?(a=[],n>0&&(this._head=this._head+n+l&this._capacityMask)):(a=this.remove(n,t),this._head=this._head+n+l&this._capacityMask);c>u;)this.unshift(arguments[--c]);for(i=n;i>0;i--)this.unshift(o[i-1])}else{o=new Array(s-(n+t));var f=o.length;for(i=0;i<f;i++)o[i]=this._list[this._head+n+t+i&this._capacityMask];for(t===0?(a=[],n!=s&&(this._tail=this._head+n+l&this._capacityMask)):(a=this.remove(n,t),this._tail=this._tail-f+l&this._capacityMask);u<c;)this.push(arguments[u++]);for(i=0;i<f;i++)this.push(o[i])}return a}else return this.remove(n,t)}};Bt.prototype.clear=function(){this._head=0,this._tail=0};Bt.prototype.isEmpty=function(){return this._head===this._tail};Bt.prototype.toArray=function(){return this._copyArray(!1)};Bt.prototype._fromArray=function(e){for(var t=0;t<e.length;t++)this.push(e[t])};Bt.prototype._copyArray=function(e){var t=[],n=this._list,s=n.length,i;if(e||this._head>this._tail){for(i=this._head;i<s;i++)t.push(n[i]);for(i=0;i<this._tail;i++)t.push(n[i])}else for(i=this._head;i<this._tail;i++)t.push(n[i]);return t};Bt.prototype._growArray=function(){this._head&&(this._list=this._copyArray(!0),this._head=0),this._tail=this._list.length,this._list.length<<=1,this._capacityMask=this._capacityMask<<1|1};Bt.prototype._shrinkArray=function(){this._list.length>>>=1,this._capacityMask>>>=1};pT.exports=Bt});var V5=N((H_e,fC)=>{fC.exports=r=>async function*(){let e=/\r?\n/,t=new TextDecoder("utf8"),n="";for await(let s of r){typeof s=="string"&&(s=new TextEncoder().encode(s)),n+=t.decode(s,{stream:!0});let i=n.split(e);n=i.pop();for(let o=0;o<i.length;o++)yield JSON.parse(i[o])}n+=t.decode(),n&&(yield JSON.parse(n))}()});var dC=N((G_e,hC)=>{hC.exports=r=>async function*(){for await(let e of r)yield JSON.stringify(e)+`
`}()});var pC=N((W_e,l1)=>{l1.exports=V5();l1.exports.parse=V5();l1.exports.stringify=dC()});var zC=N((zAe,VC)=>{VC.exports=function(r){if(!r)throw Error("hashlru must have a max value, of type number, greater than 0");var e=0,t=Object.create(null),n=Object.create(null);function s(i,o){t[i]=o,e++,e>=r&&(e=0,n=t,t=Object.create(null))}return{has:function(i){return t[i]!==void 0||n[i]!==void 0},remove:function(i){t[i]!==void 0&&(t[i]=void 0),n[i]!==void 0&&(n[i]=void 0)},get:function(i){var o=t[i];if(o!==void 0)return o;if((o=n[i])!==void 0)return s(i,o),o},set:function(i,o){t[i]!==void 0?t[i]=o:s(i,o)},clear:function(){t=Object.create(null),n=Object.create(null)}}}});var NP=N((JDe,kP)=>{"use strict";function DJ(r){if(r.length>=255)throw new TypeError("Alphabet too long");for(var e=new Uint8Array(256),t=0;t<e.length;t++)e[t]=255;for(var n=0;n<r.length;n++){var s=r.charAt(n),i=s.charCodeAt(0);if(e[i]!==255)throw new TypeError(s+" is ambiguous");e[i]=n}var o=r.length,a=r.charAt(0),c=Math.log(o)/Math.log(256),l=Math.log(256)/Math.log(o);function u(p){if(p instanceof Uint8Array||(ArrayBuffer.isView(p)?p=new Uint8Array(p.buffer,p.byteOffset,p.byteLength):Array.isArray(p)&&(p=Uint8Array.from(p))),!(p instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(p.length===0)return"";for(var d=0,m=0,g=0,y=p.length;g!==y&&p[g]===0;)g++,d++;for(var b=(y-g)*l+1>>>0,w=new Uint8Array(b);g!==y;){for(var v=p[g],x=0,_=b-1;(v!==0||x<m)&&_!==-1;_--,x++)v+=256*w[_]>>>0,w[_]=v%o>>>0,v=v/o>>>0;if(v!==0)throw new Error("Non-zero carry");m=x,g++}for(var S=b-m;S!==b&&w[S]===0;)S++;for(var A=a.repeat(d);S<b;++S)A+=r.charAt(w[S]);return A}function f(p){if(typeof p!="string")throw new TypeError("Expected String");if(p.length===0)return new Uint8Array;var d=0;if(p[d]!==" "){for(var m=0,g=0;p[d]===a;)m++,d++;for(var y=(p.length-d)*c+1>>>0,b=new Uint8Array(y);p[d];){var w=e[p.charCodeAt(d)];if(w===255)return;for(var v=0,x=y-1;(w!==0||v<g)&&x!==-1;x--,v++)w+=o*b[x]>>>0,b[x]=w%256>>>0,w=w/256>>>0;if(w!==0)throw new Error("Non-zero carry");g=v,d++}if(p[d]!==" "){for(var _=y-g;_!==y&&b[_]===0;)_++;for(var S=new Uint8Array(m+(y-_)),A=m;_!==y;)S[A++]=b[_++];return S}}}function h(p){var d=f(p);if(d)return d;throw new Error("Non-base"+o+" character")}return{encode:u,decodeUnsafe:f,decode:h}}kP.exports=DJ});var G1=N((eCe,OP)=>{"use strict";var CJ=new TextDecoder,PJ=r=>CJ.decode(r),kJ=new TextEncoder,NJ=r=>kJ.encode(r);function OJ(r,e){let t=new Uint8Array(e),n=0;for(let s of r)t.set(s,n),n+=s.length;return t}OP.exports={decodeText:PJ,encodeText:NJ,concat:OJ}});var BP=N((tCe,LP)=>{"use strict";var{encodeText:LJ}=G1(),ky=class{constructor(e,t,n,s){this.name=e,this.code=t,this.codeBuf=LJ(this.code),this.alphabet=s,this.codec=n(s)}encode(e){return this.codec.encode(e)}decode(e){for(let t of e)if(this.alphabet&&this.alphabet.indexOf(t)<0)throw new Error(`invalid character '${t}' in '${e}'`);return this.codec.decode(e)}};LP.exports=ky});var UP=N((rCe,MP)=>{"use strict";var BJ=(r,e,t)=>{let n={};for(let l=0;l<e.length;++l)n[e[l]]=l;let s=r.length;for(;r[s-1]==="=";)--s;let i=new Uint8Array(s*t/8|0),o=0,a=0,c=0;for(let l=0;l<s;++l){let u=n[r[l]];if(u===void 0)throw new SyntaxError("Invalid character "+r[l]);a=a<<t|u,o+=t,o>=8&&(o-=8,i[c++]=255&a>>o)}if(o>=t||255&a<<8-o)throw new SyntaxError("Unexpected end of data");return i},MJ=(r,e,t)=>{let n=e[e.length-1]==="=",s=(1<<t)-1,i="",o=0,a=0;for(let c=0;c<r.length;++c)for(a=a<<8|r[c],o+=8;o>t;)o-=t,i+=e[s&a>>o];if(o&&(i+=e[s&a<<t-o]),n)for(;i.length*t&7;)i+="=";return i},UJ=r=>e=>({encode(t){return MJ(t,e,r)},decode(t){return BJ(t,e,r)}});MP.exports={rfc4648:UJ}});var qP=N((nCe,zP)=>{"use strict";var Rh=NP(),FJ=BP(),{rfc4648:xr}=UP(),{decodeText:VJ,encodeText:zJ}=G1(),qJ=()=>({encode:VJ,decode:zJ}),FP=[["identity","\0",qJ,""],["base2","0",xr(1),"01"],["base8","7",xr(3),"01234567"],["base10","9",Rh,"0123456789"],["base16","f",xr(4),"0123456789abcdef"],["base16upper","F",xr(4),"0123456789ABCDEF"],["base32hex","v",xr(5),"0123456789abcdefghijklmnopqrstuv"],["base32hexupper","V",xr(5),"0123456789ABCDEFGHIJKLMNOPQRSTUV"],["base32hexpad","t",xr(5),"0123456789abcdefghijklmnopqrstuv="],["base32hexpadupper","T",xr(5),"0123456789ABCDEFGHIJKLMNOPQRSTUV="],["base32","b",xr(5),"abcdefghijklmnopqrstuvwxyz234567"],["base32upper","B",xr(5),"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567"],["base32pad","c",xr(5),"abcdefghijklmnopqrstuvwxyz234567="],["base32padupper","C",xr(5),"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567="],["base32z","h",xr(5),"ybndrfg8ejkmcpqxot1uwisza345h769"],["base36","k",Rh,"0123456789abcdefghijklmnopqrstuvwxyz"],["base36upper","K",Rh,"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"],["base58btc","z",Rh,"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"],["base58flickr","Z",Rh,"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"],["base64","m",xr(6),"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"],["base64pad","M",xr(6),"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/="],["base64url","u",xr(6),"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_"],["base64urlpad","U",xr(6),"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_="]],VP=FP.reduce((r,e)=>(r[e[0]]=new FJ(e[0],e[1],e[2],e[3]),r),{}),KJ=FP.reduce((r,e)=>(r[e[1]]=VP[e[0]],r),{});zP.exports={names:VP,codes:KJ}});var HP=N((Ii,$P)=>{"use strict";var zl=qP(),{encodeText:$J,decodeText:W1,concat:KP}=G1();function HJ(r,e){if(!e)throw new Error("requires an encoded Uint8Array");let{name:t,codeBuf:n}=za(r);return QJ(t,e),KP([n,e],n.length+e.length)}function GJ(r,e){let t=za(r),n=$J(t.encode(e));return KP([t.codeBuf,n],t.codeBuf.length+n.length)}function WJ(r){r instanceof Uint8Array&&(r=W1(r));let e=r[0];return["f","F","v","V","t","T","b","B","c","C","h","k","K"].includes(e)&&(r=r.toLowerCase()),za(r[0]).decode(r.substring(1))}function YJ(r){if(r instanceof Uint8Array&&(r=W1(r)),Object.prototype.toString.call(r)!=="[object String]")return!1;try{return za(r[0]).name}catch{return!1}}function QJ(r,e){za(r).decode(W1(e))}function za(r){if(Object.prototype.hasOwnProperty.call(zl.names,r))return zl.names[r];if(Object.prototype.hasOwnProperty.call(zl.codes,r))return zl.codes[r];throw new Error(`Unsupported encoding: ${r}`)}function XJ(r){return r instanceof Uint8Array&&(r=W1(r)),za(r[0])}Ii=$P.exports=HJ;Ii.encode=GJ;Ii.decode=WJ;Ii.isEncoded=YJ;Ii.encoding=za;Ii.encodingFromData=XJ;var jJ=Object.freeze(zl.names),ZJ=Object.freeze(zl.codes);Ii.names=jJ;Ii.codes=ZJ});var QP=N((sCe,YP)=>{YP.exports=WP;var GP=128,JJ=127,eee=~JJ,tee=Math.pow(2,31);function WP(r,e,t){e=e||[],t=t||0;for(var n=t;r>=tee;)e[t++]=r&255|GP,r/=128;for(;r&eee;)e[t++]=r&255|GP,r>>>=7;return e[t]=r|0,WP.bytes=t-n+1,e}});var ZP=N((iCe,jP)=>{jP.exports=Ny;var ree=128,XP=127;function Ny(r,n){var t=0,n=n||0,s=0,i=n,o,a=r.length;do{if(i>=a)throw Ny.bytes=0,new RangeError("Could not decode varint");o=r[i++],t+=s<28?(o&XP)<<s:(o&XP)*Math.pow(2,s),s+=7}while(o>=ree);return Ny.bytes=i-n,t}});var ek=N((oCe,JP)=>{var nee=Math.pow(2,7),see=Math.pow(2,14),iee=Math.pow(2,21),oee=Math.pow(2,28),aee=Math.pow(2,35),cee=Math.pow(2,42),lee=Math.pow(2,49),uee=Math.pow(2,56),fee=Math.pow(2,63);JP.exports=function(r){return r<nee?1:r<see?2:r<iee?3:r<oee?4:r<aee?5:r<cee?6:r<lee?7:r<uee?8:r<fee?9:10}});var rk=N((aCe,tk)=>{tk.exports={encode:QP(),decode:ZP(),encodingLength:ek()}});var sk=N((cCe,nk)=>{"use strict";var hee=Object.freeze({identity:0,sha1:17,"sha2-256":18,"sha2-512":19,"sha3-512":20,"sha3-384":21,"sha3-256":22,"sha3-224":23,"shake-128":24,"shake-256":25,"keccak-224":26,"keccak-256":27,"keccak-384":28,"keccak-512":29,blake3:30,"murmur3-128":34,"murmur3-32":35,"dbl-sha2-256":86,md4:212,md5:213,bmt:214,"sha2-256-trunc254-padded":4114,"ripemd-128":4178,"ripemd-160":4179,"ripemd-256":4180,"ripemd-320":4181,x11:4352,kangarootwelve:7425,"sm3-256":21325,"blake2b-8":45569,"blake2b-16":45570,"blake2b-24":45571,"blake2b-32":45572,"blake2b-40":45573,"blake2b-48":45574,"blake2b-56":45575,"blake2b-64":45576,"blake2b-72":45577,"blake2b-80":45578,"blake2b-88":45579,"blake2b-96":45580,"blake2b-104":45581,"blake2b-112":45582,"blake2b-120":45583,"blake2b-128":45584,"blake2b-136":45585,"blake2b-144":45586,"blake2b-152":45587,"blake2b-160":45588,"blake2b-168":45589,"blake2b-176":45590,"blake2b-184":45591,"blake2b-192":45592,"blake2b-200":45593,"blake2b-208":45594,"blake2b-216":45595,"blake2b-224":45596,"blake2b-232":45597,"blake2b-240":45598,"blake2b-248":45599,"blake2b-256":45600,"blake2b-264":45601,"blake2b-272":45602,"blake2b-280":45603,"blake2b-288":45604,"blake2b-296":45605,"blake2b-304":45606,"blake2b-312":45607,"blake2b-320":45608,"blake2b-328":45609,"blake2b-336":45610,"blake2b-344":45611,"blake2b-352":45612,"blake2b-360":45613,"blake2b-368":45614,"blake2b-376":45615,"blake2b-384":45616,"blake2b-392":45617,"blake2b-400":45618,"blake2b-408":45619,"blake2b-416":45620,"blake2b-424":45621,"blake2b-432":45622,"blake2b-440":45623,"blake2b-448":45624,"blake2b-456":45625,"blake2b-464":45626,"blake2b-472":45627,"blake2b-480":45628,"blake2b-488":45629,"blake2b-496":45630,"blake2b-504":45631,"blake2b-512":45632,"blake2s-8":45633,"blake2s-16":45634,"blake2s-24":45635,"blake2s-32":45636,"blake2s-40":45637,"blake2s-48":45638,"blake2s-56":45639,"blake2s-64":45640,"blake2s-72":45641,"blake2s-80":45642,"blake2s-88":45643,"blake2s-96":45644,"blake2s-104":45645,"blake2s-112":45646,"blake2s-120":45647,"blake2s-128":45648,"blake2s-136":45649,"blake2s-144":45650,"blake2s-152":45651,"blake2s-160":45652,"blake2s-168":45653,"blake2s-176":45654,"blake2s-184":45655,"blake2s-192":45656,"blake2s-200":45657,"blake2s-208":45658,"blake2s-216":45659,"blake2s-224":45660,"blake2s-232":45661,"blake2s-240":45662,"blake2s-248":45663,"blake2s-256":45664,"skein256-8":45825,"skein256-16":45826,"skein256-24":45827,"skein256-32":45828,"skein256-40":45829,"skein256-48":45830,"skein256-56":45831,"skein256-64":45832,"skein256-72":45833,"skein256-80":45834,"skein256-88":45835,"skein256-96":45836,"skein256-104":45837,"skein256-112":45838,"skein256-120":45839,"skein256-128":45840,"skein256-136":45841,"skein256-144":45842,"skein256-152":45843,"skein256-160":45844,"skein256-168":45845,"skein256-176":45846,"skein256-184":45847,"skein256-192":45848,"skein256-200":45849,"skein256-208":45850,"skein256-216":45851,"skein256-224":45852,"skein256-232":45853,"skein256-240":45854,"skein256-248":45855,"skein256-256":45856,"skein512-8":45857,"skein512-16":45858,"skein512-24":45859,"skein512-32":45860,"skein512-40":45861,"skein512-48":45862,"skein512-56":45863,"skein512-64":45864,"skein512-72":45865,"skein512-80":45866,"skein512-88":45867,"skein512-96":45868,"skein512-104":45869,"skein512-112":45870,"skein512-120":45871,"skein512-128":45872,"skein512-136":45873,"skein512-144":45874,"skein512-152":45875,"skein512-160":45876,"skein512-168":45877,"skein512-176":45878,"skein512-184":45879,"skein512-192":45880,"skein512-200":45881,"skein512-208":45882,"skein512-216":45883,"skein512-224":45884,"skein512-232":45885,"skein512-240":45886,"skein512-248":45887,"skein512-256":45888,"skein512-264":45889,"skein512-272":45890,"skein512-280":45891,"skein512-288":45892,"skein512-296":45893,"skein512-304":45894,"skein512-312":45895,"skein512-320":45896,"skein512-328":45897,"skein512-336":45898,"skein512-344":45899,"skein512-352":45900,"skein512-360":45901,"skein512-368":45902,"skein512-376":45903,"skein512-384":45904,"skein512-392":45905,"skein512-400":45906,"skein512-408":45907,"skein512-416":45908,"skein512-424":45909,"skein512-432":45910,"skein512-440":45911,"skein512-448":45912,"skein512-456":45913,"skein512-464":45914,"skein512-472":45915,"skein512-480":45916,"skein512-488":45917,"skein512-496":45918,"skein512-504":45919,"skein512-512":45920,"skein1024-8":45921,"skein1024-16":45922,"skein1024-24":45923,"skein1024-32":45924,"skein1024-40":45925,"skein1024-48":45926,"skein1024-56":45927,"skein1024-64":45928,"skein1024-72":45929,"skein1024-80":45930,"skein1024-88":45931,"skein1024-96":45932,"skein1024-104":45933,"skein1024-112":45934,"skein1024-120":45935,"skein1024-128":45936,"skein1024-136":45937,"skein1024-144":45938,"skein1024-152":45939,"skein1024-160":45940,"skein1024-168":45941,"skein1024-176":45942,"skein1024-184":45943,"skein1024-192":45944,"skein1024-200":45945,"skein1024-208":45946,"skein1024-216":45947,"skein1024-224":45948,"skein1024-232":45949,"skein1024-240":45950,"skein1024-248":45951,"skein1024-256":45952,"skein1024-264":45953,"skein1024-272":45954,"skein1024-280":45955,"skein1024-288":45956,"skein1024-296":45957,"skein1024-304":45958,"skein1024-312":45959,"skein1024-320":45960,"skein1024-328":45961,"skein1024-336":45962,"skein1024-344":45963,"skein1024-352":45964,"skein1024-360":45965,"skein1024-368":45966,"skein1024-376":45967,"skein1024-384":45968,"skein1024-392":45969,"skein1024-400":45970,"skein1024-408":45971,"skein1024-416":45972,"skein1024-424":45973,"skein1024-432":45974,"skein1024-440":45975,"skein1024-448":45976,"skein1024-456":45977,"skein1024-464":45978,"skein1024-472":45979,"skein1024-480":45980,"skein1024-488":45981,"skein1024-496":45982,"skein1024-504":45983,"skein1024-512":45984,"skein1024-520":45985,"skein1024-528":45986,"skein1024-536":45987,"skein1024-544":45988,"skein1024-552":45989,"skein1024-560":45990,"skein1024-568":45991,"skein1024-576":45992,"skein1024-584":45993,"skein1024-592":45994,"skein1024-600":45995,"skein1024-608":45996,"skein1024-616":45997,"skein1024-624":45998,"skein1024-632":45999,"skein1024-640":46e3,"skein1024-648":46001,"skein1024-656":46002,"skein1024-664":46003,"skein1024-672":46004,"skein1024-680":46005,"skein1024-688":46006,"skein1024-696":46007,"skein1024-704":46008,"skein1024-712":46009,"skein1024-720":46010,"skein1024-728":46011,"skein1024-736":46012,"skein1024-744":46013,"skein1024-752":46014,"skein1024-760":46015,"skein1024-768":46016,"skein1024-776":46017,"skein1024-784":46018,"skein1024-792":46019,"skein1024-800":46020,"skein1024-808":46021,"skein1024-816":46022,"skein1024-824":46023,"skein1024-832":46024,"skein1024-840":46025,"skein1024-848":46026,"skein1024-856":46027,"skein1024-864":46028,"skein1024-872":46029,"skein1024-880":46030,"skein1024-888":46031,"skein1024-896":46032,"skein1024-904":46033,"skein1024-912":46034,"skein1024-920":46035,"skein1024-928":46036,"skein1024-936":46037,"skein1024-944":46038,"skein1024-952":46039,"skein1024-960":46040,"skein1024-968":46041,"skein1024-976":46042,"skein1024-984":46043,"skein1024-992":46044,"skein1024-1000":46045,"skein1024-1008":46046,"skein1024-1016":46047,"skein1024-1024":46048,"poseidon-bls12_381-a2-fc1":46081,"poseidon-bls12_381-a2-fc1-sc":46082});nk.exports={names:hee}});function dee(r,e){if(r.length>=255)throw new TypeError("Alphabet too long");for(var t=new Uint8Array(256),n=0;n<t.length;n++)t[n]=255;for(var s=0;s<r.length;s++){var i=r.charAt(s),o=i.charCodeAt(0);if(t[o]!==255)throw new TypeError(i+" is ambiguous");t[o]=s}var a=r.length,c=r.charAt(0),l=Math.log(a)/Math.log(256),u=Math.log(256)/Math.log(a);function f(d){if(d instanceof Uint8Array||(ArrayBuffer.isView(d)?d=new Uint8Array(d.buffer,d.byteOffset,d.byteLength):Array.isArray(d)&&(d=Uint8Array.from(d))),!(d instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(d.length===0)return"";for(var m=0,g=0,y=0,b=d.length;y!==b&&d[y]===0;)y++,m++;for(var w=(b-y)*u+1>>>0,v=new Uint8Array(w);y!==b;){for(var x=d[y],_=0,S=w-1;(x!==0||_<g)&&S!==-1;S--,_++)x+=256*v[S]>>>0,v[S]=x%a>>>0,x=x/a>>>0;if(x!==0)throw new Error("Non-zero carry");g=_,y++}for(var A=w-g;A!==w&&v[A]===0;)A++;for(var D=c.repeat(m);A<w;++A)D+=r.charAt(v[A]);return D}function h(d){if(typeof d!="string")throw new TypeError("Expected String");if(d.length===0)return new Uint8Array;var m=0;if(d[m]!==" "){for(var g=0,y=0;d[m]===c;)g++,m++;for(var b=(d.length-m)*l+1>>>0,w=new Uint8Array(b);d[m];){var v=t[d.charCodeAt(m)];if(v===255)return;for(var x=0,_=b-1;(v!==0||x<y)&&_!==-1;_--,x++)v+=a*w[_]>>>0,w[_]=v%256>>>0,v=v/256>>>0;if(v!==0)throw new Error("Non-zero carry");y=x,m++}if(d[m]!==" "){for(var S=b-y;S!==b&&w[S]===0;)S++;for(var A=new Uint8Array(g+(b-S)),D=g;S!==b;)A[D++]=w[S++];return A}}}function p(d){var m=h(d);if(m)return m;throw new Error(`Non-${e} character`)}return{encode:f,decodeUnsafe:h,decode:p}}var pee,mee,ik,ok=Je(()=>{pee=dee,mee=pee,ik=mee});var uCe,ak,Ti,ck,lk,Po=Je(()=>{uCe=new Uint8Array(0),ak=(r,e)=>{if(r===e)return!0;if(r.byteLength!==e.byteLength)return!1;for(let t=0;t<r.byteLength;t++)if(r[t]!==e[t])return!1;return!0},Ti=r=>{if(r instanceof Uint8Array&&r.constructor.name==="Uint8Array")return r;if(r instanceof ArrayBuffer)return new Uint8Array(r);if(ArrayBuffer.isView(r))return new Uint8Array(r.buffer,r.byteOffset,r.byteLength);throw new Error("Unknown type, must be binary type")},ck=r=>new TextEncoder().encode(r),lk=r=>new TextDecoder().decode(r)});var Oy,Ly,By,fk,My,ql,ko,gee,yee,Ut,ws=Je(()=>{ok();Po();Oy=class{constructor(e,t,n){this.name=e,this.prefix=t,this.baseEncode=n}encode(e){if(e instanceof Uint8Array)return`${this.prefix}${this.baseEncode(e)}`;throw Error("Unknown type, must be binary type")}},Ly=class{constructor(e,t,n){if(this.name=e,this.prefix=t,t.codePointAt(0)===void 0)throw new Error("Invalid prefix character");this.prefixCodePoint=t.codePointAt(0),this.baseDecode=n}decode(e){if(typeof e=="string"){if(e.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(e)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(e.slice(this.prefix.length))}else throw Error("Can only multibase decode strings")}or(e){return fk(this,e)}},By=class{constructor(e){this.decoders=e}or(e){return fk(this,e)}decode(e){let t=e[0],n=this.decoders[t];if(n)return n.decode(e);throw RangeError(`Unable to decode multibase string ${JSON.stringify(e)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}},fk=(r,e)=>new By({...r.decoders||{[r.prefix]:r},...e.decoders||{[e.prefix]:e}}),My=class{constructor(e,t,n,s){this.name=e,this.prefix=t,this.baseEncode=n,this.baseDecode=s,this.encoder=new Oy(e,t,n),this.decoder=new Ly(e,t,s)}encode(e){return this.encoder.encode(e)}decode(e){return this.decoder.decode(e)}},ql=({name:r,prefix:e,encode:t,decode:n})=>new My(r,e,t,n),ko=({prefix:r,name:e,alphabet:t})=>{let{encode:n,decode:s}=ik(t,e);return ql({prefix:r,name:e,encode:n,decode:i=>Ti(s(i))})},gee=(r,e,t,n)=>{let s={};for(let u=0;u<e.length;++u)s[e[u]]=u;let i=r.length;for(;r[i-1]==="=";)--i;let o=new Uint8Array(i*t/8|0),a=0,c=0,l=0;for(let u=0;u<i;++u){let f=s[r[u]];if(f===void 0)throw new SyntaxError(`Non-${n} character`);c=c<<t|f,a+=t,a>=8&&(a-=8,o[l++]=255&c>>a)}if(a>=t||255&c<<8-a)throw new SyntaxError("Unexpected end of data");return o},yee=(r,e,t)=>{let n=e[e.length-1]==="=",s=(1<<t)-1,i="",o=0,a=0;for(let c=0;c<r.length;++c)for(a=a<<8|r[c],o+=8;o>t;)o-=t,i+=e[s&a>>o];if(o&&(i+=e[s&a<<t-o]),n)for(;i.length*t&7;)i+="=";return i},Ut=({name:r,prefix:e,bitsPerChar:t,alphabet:n})=>ql({prefix:e,name:r,encode(s){return yee(s,n,t)},decode(s){return gee(s,n,t,r)}})});var Uy={};Y(Uy,{identity:()=>bee});var bee,hk=Je(()=>{ws();Po();bee=ql({prefix:"\0",name:"identity",encode:r=>lk(r),decode:r=>ck(r)})});var Fy={};Y(Fy,{base2:()=>wee});var wee,dk=Je(()=>{ws();wee=Ut({prefix:"0",name:"base2",alphabet:"01",bitsPerChar:1})});var Vy={};Y(Vy,{base8:()=>xee});var xee,pk=Je(()=>{ws();xee=Ut({prefix:"7",name:"base8",alphabet:"01234567",bitsPerChar:3})});var zy={};Y(zy,{base10:()=>Eee});var Eee,mk=Je(()=>{ws();Eee=ko({prefix:"9",name:"base10",alphabet:"0123456789"})});var qy={};Y(qy,{base16:()=>vee,base16upper:()=>_ee});var vee,_ee,gk=Je(()=>{ws();vee=Ut({prefix:"f",name:"base16",alphabet:"0123456789abcdef",bitsPerChar:4}),_ee=Ut({prefix:"F",name:"base16upper",alphabet:"0123456789ABCDEF",bitsPerChar:4})});var Ky={};Y(Ky,{base32:()=>Kl,base32hex:()=>Iee,base32hexpad:()=>Dee,base32hexpadupper:()=>Cee,base32hexupper:()=>Tee,base32pad:()=>Aee,base32padupper:()=>Ree,base32upper:()=>See,base32z:()=>Pee});var Kl,See,Aee,Ree,Iee,Tee,Dee,Cee,Pee,$y=Je(()=>{ws();Kl=Ut({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5}),See=Ut({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5}),Aee=Ut({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5}),Ree=Ut({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5}),Iee=Ut({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5}),Tee=Ut({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5}),Dee=Ut({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5}),Cee=Ut({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5}),Pee=Ut({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5})});var Hy={};Y(Hy,{base36:()=>kee,base36upper:()=>Nee});var kee,Nee,yk=Je(()=>{ws();kee=ko({prefix:"k",name:"base36",alphabet:"0123456789abcdefghijklmnopqrstuvwxyz"}),Nee=ko({prefix:"K",name:"base36upper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"})});var Gy={};Y(Gy,{base58btc:()=>Ys,base58flickr:()=>Oee});var Ys,Oee,Wy=Je(()=>{ws();Ys=ko({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"}),Oee=ko({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"})});var Yy={};Y(Yy,{base64:()=>Lee,base64pad:()=>Bee,base64url:()=>Mee,base64urlpad:()=>Uee});var Lee,Bee,Mee,Uee,bk=Je(()=>{ws();Lee=Ut({prefix:"m",name:"base64",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bitsPerChar:6}),Bee=Ut({prefix:"M",name:"base64pad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",bitsPerChar:6}),Mee=Ut({prefix:"u",name:"base64url",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",bitsPerChar:6}),Uee=Ut({prefix:"U",name:"base64urlpad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=",bitsPerChar:6})});var Qy={};Y(Qy,{base256emoji:()=>Kee});function zee(r){return r.reduce((e,t)=>(e+=Fee[t],e),"")}function qee(r){let e=[];for(let t of r){let n=Vee[t.codePointAt(0)];if(n===void 0)throw new Error(`Non-base256emoji character: ${t}`);e.push(n)}return new Uint8Array(e)}var wk,Fee,Vee,Kee,xk=Je(()=>{ws();wk=Array.from("\u{1F680}\u{1FA90}\u2604\u{1F6F0}\u{1F30C}\u{1F311}\u{1F312}\u{1F313}\u{1F314}\u{1F315}\u{1F316}\u{1F317}\u{1F318}\u{1F30D}\u{1F30F}\u{1F30E}\u{1F409}\u2600\u{1F4BB}\u{1F5A5}\u{1F4BE}\u{1F4BF}\u{1F602}\u2764\u{1F60D}\u{1F923}\u{1F60A}\u{1F64F}\u{1F495}\u{1F62D}\u{1F618}\u{1F44D}\u{1F605}\u{1F44F}\u{1F601}\u{1F525}\u{1F970}\u{1F494}\u{1F496}\u{1F499}\u{1F622}\u{1F914}\u{1F606}\u{1F644}\u{1F4AA}\u{1F609}\u263A\u{1F44C}\u{1F917}\u{1F49C}\u{1F614}\u{1F60E}\u{1F607}\u{1F339}\u{1F926}\u{1F389}\u{1F49E}\u270C\u2728\u{1F937}\u{1F631}\u{1F60C}\u{1F338}\u{1F64C}\u{1F60B}\u{1F497}\u{1F49A}\u{1F60F}\u{1F49B}\u{1F642}\u{1F493}\u{1F929}\u{1F604}\u{1F600}\u{1F5A4}\u{1F603}\u{1F4AF}\u{1F648}\u{1F447}\u{1F3B6}\u{1F612}\u{1F92D}\u2763\u{1F61C}\u{1F48B}\u{1F440}\u{1F62A}\u{1F611}\u{1F4A5}\u{1F64B}\u{1F61E}\u{1F629}\u{1F621}\u{1F92A}\u{1F44A}\u{1F973}\u{1F625}\u{1F924}\u{1F449}\u{1F483}\u{1F633}\u270B\u{1F61A}\u{1F61D}\u{1F634}\u{1F31F}\u{1F62C}\u{1F643}\u{1F340}\u{1F337}\u{1F63B}\u{1F613}\u2B50\u2705\u{1F97A}\u{1F308}\u{1F608}\u{1F918}\u{1F4A6}\u2714\u{1F623}\u{1F3C3}\u{1F490}\u2639\u{1F38A}\u{1F498}\u{1F620}\u261D\u{1F615}\u{1F33A}\u{1F382}\u{1F33B}\u{1F610}\u{1F595}\u{1F49D}\u{1F64A}\u{1F639}\u{1F5E3}\u{1F4AB}\u{1F480}\u{1F451}\u{1F3B5}\u{1F91E}\u{1F61B}\u{1F534}\u{1F624}\u{1F33C}\u{1F62B}\u26BD\u{1F919}\u2615\u{1F3C6}\u{1F92B}\u{1F448}\u{1F62E}\u{1F646}\u{1F37B}\u{1F343}\u{1F436}\u{1F481}\u{1F632}\u{1F33F}\u{1F9E1}\u{1F381}\u26A1\u{1F31E}\u{1F388}\u274C\u270A\u{1F44B}\u{1F630}\u{1F928}\u{1F636}\u{1F91D}\u{1F6B6}\u{1F4B0}\u{1F353}\u{1F4A2}\u{1F91F}\u{1F641}\u{1F6A8}\u{1F4A8}\u{1F92C}\u2708\u{1F380}\u{1F37A}\u{1F913}\u{1F619}\u{1F49F}\u{1F331}\u{1F616}\u{1F476}\u{1F974}\u25B6\u27A1\u2753\u{1F48E}\u{1F4B8}\u2B07\u{1F628}\u{1F31A}\u{1F98B}\u{1F637}\u{1F57A}\u26A0\u{1F645}\u{1F61F}\u{1F635}\u{1F44E}\u{1F932}\u{1F920}\u{1F927}\u{1F4CC}\u{1F535}\u{1F485}\u{1F9D0}\u{1F43E}\u{1F352}\u{1F617}\u{1F911}\u{1F30A}\u{1F92F}\u{1F437}\u260E\u{1F4A7}\u{1F62F}\u{1F486}\u{1F446}\u{1F3A4}\u{1F647}\u{1F351}\u2744\u{1F334}\u{1F4A3}\u{1F438}\u{1F48C}\u{1F4CD}\u{1F940}\u{1F922}\u{1F445}\u{1F4A1}\u{1F4A9}\u{1F450}\u{1F4F8}\u{1F47B}\u{1F910}\u{1F92E}\u{1F3BC}\u{1F975}\u{1F6A9}\u{1F34E}\u{1F34A}\u{1F47C}\u{1F48D}\u{1F4E3}\u{1F942}"),Fee=wk.reduce((r,e,t)=>(r[t]=e,r),[]),Vee=wk.reduce((r,e,t)=>(r[e.codePointAt(0)]=t,r),[]);Kee=ql({prefix:"\u{1F680}",name:"base256emoji",encode:zee,decode:qee})});function _k(r,e,t){e=e||[],t=t||0;for(var n=t;r>=Wee;)e[t++]=r&255|Ek,r/=128;for(;r&Gee;)e[t++]=r&255|Ek,r>>>=7;return e[t]=r|0,_k.bytes=t-n+1,e}function Xy(r,n){var t=0,n=n||0,s=0,i=n,o,a=r.length;do{if(i>=a)throw Xy.bytes=0,new RangeError("Could not decode varint");o=r[i++],t+=s<28?(o&vk)<<s:(o&vk)*Math.pow(2,s),s+=7}while(o>=Qee);return Xy.bytes=i-n,t}var $ee,Ek,Hee,Gee,Wee,Yee,Qee,vk,Xee,jee,Zee,Jee,ete,tte,rte,nte,ste,ite,ote,ate,Ih,Sk=Je(()=>{$ee=_k,Ek=128,Hee=127,Gee=~Hee,Wee=Math.pow(2,31);Yee=Xy,Qee=128,vk=127;Xee=Math.pow(2,7),jee=Math.pow(2,14),Zee=Math.pow(2,21),Jee=Math.pow(2,28),ete=Math.pow(2,35),tte=Math.pow(2,42),rte=Math.pow(2,49),nte=Math.pow(2,56),ste=Math.pow(2,63),ite=function(r){return r<Xee?1:r<jee?2:r<Zee?3:r<Jee?4:r<ete?5:r<tte?6:r<rte?7:r<nte?8:r<ste?9:10},ote={encode:$ee,decode:Yee,encodingLength:ite},ate=ote,Ih=ate});var Th,$l,Hl,Q1=Je(()=>{Sk();Th=(r,e=0)=>[Ih.decode(r,e),Ih.decode.bytes],$l=(r,e,t=0)=>(Ih.encode(r,e,t),e),Hl=r=>Ih.encodingLength(r)});var qa,Ak,Rk,Gl,Ch=Je(()=>{Po();Q1();qa=(r,e)=>{let t=e.byteLength,n=Hl(r),s=n+Hl(t),i=new Uint8Array(s+t);return $l(r,i,0),$l(t,i,n),i.set(e,s),new Gl(r,t,e,i)},Ak=r=>{let e=Ti(r),[t,n]=Th(e),[s,i]=Th(e.subarray(n)),o=e.subarray(n+i);if(o.byteLength!==s)throw new Error("Incorrect length");return new Gl(t,s,o,e)},Rk=(r,e)=>r===e?!0:r.code===e.code&&r.size===e.size&&ak(r.bytes,e.bytes),Gl=class{constructor(e,t,n,s){this.code=e,this.size=t,this.digest=n,this.bytes=s}}});var Zy,jy,Jy=Je(()=>{Ch();Zy=({name:r,code:e,encode:t})=>new jy(r,e,t),jy=class{constructor(e,t,n){this.name=e,this.code=t,this.encode=n}digest(e){if(e instanceof Uint8Array){let t=this.encode(e);return t instanceof Uint8Array?qa(this.code,t):t.then(n=>qa(this.code,n))}else throw Error("Unknown type, must be binary type")}}});var e6={};Y(e6,{sha256:()=>cte,sha512:()=>lte});var Tk,cte,lte,Dk=Je(()=>{Jy();Tk=r=>async e=>new Uint8Array(await crypto.subtle.digest(r,e)),cte=Zy({name:"sha2-256",code:18,encode:Tk("SHA-256")}),lte=Zy({name:"sha2-512",code:19,encode:Tk("SHA-512")})});var t6={};Y(t6,{identity:()=>hte});var Ck,ute,Pk,fte,hte,kk=Je(()=>{Po();Ch();Ck=0,ute="identity",Pk=Ti,fte=r=>qa(Ck,Pk(r)),hte={code:Ck,name:ute,encode:Pk,digest:fte}});var Nk=Je(()=>{Po()});var PCe,kCe,Ok=Je(()=>{PCe=new TextEncoder,kCe=new TextDecoder});var ir,mte,gte,yte,Ph,bte,Lk,Bk,X1,j1,wte,xte,Ete,Mk=Je(()=>{Q1();Ch();Wy();$y();Po();ir=class{constructor(e,t,n,s){this.code=t,this.version=e,this.multihash=n,this.bytes=s,this.byteOffset=s.byteOffset,this.byteLength=s.byteLength,this.asCID=this,this._baseCache=new Map,Object.defineProperties(this,{byteOffset:j1,byteLength:j1,code:X1,version:X1,multihash:X1,bytes:X1,_baseCache:j1,asCID:j1})}toV0(){switch(this.version){case 0:return this;default:{let{code:e,multihash:t}=this;if(e!==Ph)throw new Error("Cannot convert a non dag-pb CID to CIDv0");if(t.code!==bte)throw new Error("Cannot convert non sha2-256 multihash CID to CIDv0");return ir.createV0(t)}}}toV1(){switch(this.version){case 0:{let{code:e,digest:t}=this.multihash,n=qa(e,t);return ir.createV1(this.code,n)}case 1:return this;default:throw Error(`Can not convert CID version ${this.version} to version 0. This is a bug please report`)}}equals(e){return e&&this.code===e.code&&this.version===e.version&&Rk(this.multihash,e.multihash)}toString(e){let{bytes:t,version:n,_baseCache:s}=this;switch(n){case 0:return gte(t,s,e||Ys.encoder);default:return yte(t,s,e||Kl.encoder)}}toJSON(){return{code:this.code,version:this.version,hash:this.multihash.bytes}}get[Symbol.toStringTag](){return"CID"}[Symbol.for("nodejs.util.inspect.custom")](){return"CID("+this.toString()+")"}static isCID(e){return xte(/^0\.0/,Ete),!!(e&&(e[Bk]||e.asCID===e))}get toBaseEncodedString(){throw new Error("Deprecated, use .toString()")}get codec(){throw new Error('"codec" property is deprecated, use integer "code" property instead')}get buffer(){throw new Error("Deprecated .buffer property, use .bytes to get Uint8Array instead")}get multibaseName(){throw new Error('"multibaseName" property is deprecated')}get prefix(){throw new Error('"prefix" property is deprecated')}static asCID(e){if(e instanceof ir)return e;if(e!=null&&e.asCID===e){let{version:t,code:n,multihash:s,bytes:i}=e;return new ir(t,n,s,i||Lk(t,n,s.bytes))}else if(e!=null&&e[Bk]===!0){let{version:t,multihash:n,code:s}=e,i=Ak(n);return ir.create(t,s,i)}else return null}static create(e,t,n){if(typeof t!="number")throw new Error("String codecs are no longer supported");switch(e){case 0:{if(t!==Ph)throw new Error(`Version 0 CID must use dag-pb (code: ${Ph}) block encoding`);return new ir(e,t,n,n.bytes)}case 1:{let s=Lk(e,t,n.bytes);return new ir(e,t,n,s)}default:throw new Error("Invalid version")}}static createV0(e){return ir.create(0,Ph,e)}static createV1(e,t){return ir.create(1,e,t)}static decode(e){let[t,n]=ir.decodeFirst(e);if(n.length)throw new Error("Incorrect length");return t}static decodeFirst(e){let t=ir.inspectBytes(e),n=t.size-t.multihashSize,s=Ti(e.subarray(n,n+t.multihashSize));if(s.byteLength!==t.multihashSize)throw new Error("Incorrect length");let i=s.subarray(t.multihashSize-t.digestSize),o=new Gl(t.multihashCode,t.digestSize,i,s);return[t.version===0?ir.createV0(o):ir.createV1(t.codec,o),e.subarray(t.size)]}static inspectBytes(e){let t=0,n=()=>{let[f,h]=Th(e.subarray(t));return t+=h,f},s=n(),i=Ph;if(s===18?(s=0,t=0):s===1&&(i=n()),s!==0&&s!==1)throw new RangeError(`Invalid CID version ${s}`);let o=t,a=n(),c=n(),l=t+c,u=l-o;return{version:s,codec:i,multihashCode:a,digestSize:c,multihashSize:u,size:l}}static parse(e,t){let[n,s]=mte(e,t),i=ir.decode(s);return i._baseCache.set(n,e),i}},mte=(r,e)=>{switch(r[0]){case"Q":{let t=e||Ys;return[Ys.prefix,t.decode(`${Ys.prefix}${r}`)]}case Ys.prefix:{let t=e||Ys;return[Ys.prefix,t.decode(r)]}case Kl.prefix:{let t=e||Kl;return[Kl.prefix,t.decode(r)]}default:{if(e==null)throw Error("To parse non base32 or base58btc encoded CID multibase decoder must be provided");return[r[0],e.decode(r)]}}},gte=(r,e,t)=>{let{prefix:n}=t;if(n!==Ys.prefix)throw Error(`Cannot string encode V0 in ${t.name} encoding`);let s=e.get(n);if(s==null){let i=t.encode(r).slice(1);return e.set(n,i),i}else return s},yte=(r,e,t)=>{let{prefix:n}=t,s=e.get(n);if(s==null){let i=t.encode(r);return e.set(n,i),i}else return s},Ph=112,bte=18,Lk=(r,e,t)=>{let n=Hl(r),s=n+Hl(e),i=new Uint8Array(s+t.byteLength);return $l(r,i,0),$l(e,i,n),i.set(t,s),i},Bk=Symbol.for("@ipld/js-cid/CID"),X1={writable:!1,configurable:!1,enumerable:!0},j1={writable:!1,enumerable:!1,configurable:!1},wte="0.0.0-dev",xte=(r,e)=>{if(r.test(wte))console.warn(e);else throw new Error(e)},Ete=`CID.isCID(v) is deprecated and will be removed in the next major release.
Following code pattern:

if (CID.isCID(value)) {
  doSomethingWithCID(value)
}

Is replaced with:

const cid = CID.asCID(value)
if (cid) {
  // Make sure to use cid instead of value
  doSomethingWithCID(cid)
}
`});var Uk=Je(()=>{Mk();Q1();Po();Jy();Ch()});var r6,VCe,Fk=Je(()=>{hk();dk();pk();mk();gk();$y();yk();Wy();bk();xk();Dk();kk();Nk();Ok();Uk();r6={...Uy,...Fy,...Vy,...zy,...qy,...Ky,...Hy,...Gy,...Yy,...Qy},VCe={...e6,...t6}});function Wl(r){return globalThis.Buffer!=null?new Uint8Array(r.buffer,r.byteOffset,r.byteLength):r}var Z1=Je(()=>{});function J1(r=0){return globalThis.Buffer!=null&&globalThis.Buffer.allocUnsafe!=null?Wl(globalThis.Buffer.allocUnsafe(r)):new Uint8Array(r)}var n6=Je(()=>{Z1()});function zk(r,e,t,n){return{name:r,prefix:e,encoder:{name:r,prefix:e,encode:t},decoder:{decode:n}}}var Vk,s6,vte,e2,i6=Je(()=>{Fk();n6();Vk=zk("utf8","u",r=>"u"+new TextDecoder("utf8").decode(r),r=>new TextEncoder().encode(r.substring(1))),s6=zk("ascii","a",r=>{let e="a";for(let t=0;t<r.length;t++)e+=String.fromCharCode(r[t]);return e},r=>{r=r.substring(1);let e=J1(r.length);for(let t=0;t<r.length;t++)e[t]=r.charCodeAt(t);return e}),vte={utf8:Vk,"utf-8":Vk,hex:r6.base16,latin1:s6,ascii:s6,binary:s6,...r6},e2=vte});var qk={};Y(qk,{toString:()=>_te});function _te(r,e="utf8"){let t=e2[e];if(!t)throw new Error(`Unsupported encoding "${e}"`);return(e==="utf8"||e==="utf-8")&&globalThis.Buffer!=null&&globalThis.Buffer.from!=null?globalThis.Buffer.from(r.buffer,r.byteOffset,r.byteLength).toString("utf8"):t.encoder.encode(r).substring(1)}var Kk=Je(()=>{i6()});var $k={};Y($k,{fromString:()=>Ste});function Ste(r,e="utf8"){let t=e2[e];if(!t)throw new Error(`Unsupported encoding "${e}"`);return(e==="utf8"||e==="utf-8")&&globalThis.Buffer!=null&&globalThis.Buffer.from!=null?Wl(globalThis.Buffer.from(r,"utf-8")):t.decoder.decode(`${t.prefix}${r}`)}var Hk=Je(()=>{i6();Z1()});var Gk={};Y(Gk,{concat:()=>Ate});function Ate(r,e){e||(e=r.reduce((s,i)=>s+i.length,0));let t=J1(e),n=0;for(let s of r)t.set(s,n),n+=s.length;return Wl(t)}var Wk=Je(()=>{n6();Z1()});var a6=N((JCe,Jk)=>{"use strict";var Yk=HP(),Yl=rk(),{names:kh}=sk(),{toString:t2}=(Kk(),Zh(qk)),{fromString:Rte}=(Hk(),Zh($k)),{concat:Ite}=(Wk(),Zh(Gk)),Ql={};for(let r in kh){let e=r;Ql[kh[e]]=e}Object.freeze(Ql);function Tte(r){if(!(r instanceof Uint8Array))throw new Error("must be passed a Uint8Array");return t2(r,"base16")}function Dte(r){return Rte(r,"base16")}function Cte(r){if(!(r instanceof Uint8Array))throw new Error("must be passed a Uint8Array");return t2(Yk.encode("base58btc",r)).slice(1)}function Pte(r){let e=r instanceof Uint8Array?t2(r):r;return Yk.decode("z"+e)}function Qk(r){if(!(r instanceof Uint8Array))throw new Error("multihash must be a Uint8Array");if(r.length<2)throw new Error("multihash too short. must be > 2 bytes.");let e=Yl.decode(r);if(!jk(e))throw new Error(`multihash unknown function code: 0x${e.toString(16)}`);r=r.slice(Yl.decode.bytes);let t=Yl.decode(r);if(t<0)throw new Error(`multihash invalid length: ${t}`);if(r=r.slice(Yl.decode.bytes),r.length!==t)throw new Error(`multihash length inconsistent: 0x${t2(r,"base16")}`);return{code:e,name:Ql[e],length:t,digest:r}}function kte(r,e,t){if(!r||e===void 0)throw new Error("multihash encode requires at least two args: digest, code");let n=Xk(e);if(!(r instanceof Uint8Array))throw new Error("digest should be a Uint8Array");if(t==null&&(t=r.length),t&&r.length!==t)throw new Error("digest length should be equal to specified length.");let s=Yl.encode(n),i=Yl.encode(t);return Ite([s,i,r],s.length+i.length+r.length)}function Xk(r){let e=r;if(typeof r=="string"){if(kh[r]===void 0)throw new Error(`Unrecognized hash function named: ${r}`);e=kh[r]}if(typeof e!="number")throw new Error(`Hash function code should be a number. Got: ${e}`);if(Ql[e]===void 0&&!o6(e))throw new Error(`Unrecognized function code: ${e}`);return e}function o6(r){return r>0&&r<16}function jk(r){return!!(o6(r)||Ql[r])}function Zk(r){Qk(r)}function Nte(r){return Zk(r),r.subarray(0,2)}Jk.exports={names:kh,codes:Ql,toHexString:Tte,fromHexString:Dte,toB58String:Cte,fromB58String:Pte,decode:Qk,encode:kte,coerceCode:Xk,isAppCode:o6,validate:Zk,prefix:Nte,isValidCode:jk}});var ON=N(a2=>{"use strict";Object.defineProperty(a2,"__esModule",{value:!0});var N6=class{constructor(){this.pullQueue=[],this.pushQueue=[],this.eventHandlers={},this.isPaused=!1,this.isStopped=!1}push(e){if(this.isStopped)return;let t={value:e,done:!1};if(this.pullQueue.length){let n=this.pullQueue.shift();n&&n.resolve(t)}else this.pushQueue.push(Promise.resolve(t)),this.highWaterMark!==void 0&&this.pushQueue.length>=this.highWaterMark&&!this.isPaused&&(this.isPaused=!0,this.eventHandlers.highWater?this.eventHandlers.highWater():console&&console.warn(`EventIterator queue reached ${this.pushQueue.length} items`))}stop(){if(!this.isStopped){this.isStopped=!0,this.remove();for(let e of this.pullQueue)e.resolve({value:void 0,done:!0});this.pullQueue.length=0}}fail(e){if(!this.isStopped)if(this.isStopped=!0,this.remove(),this.pullQueue.length){for(let t of this.pullQueue)t.reject(e);this.pullQueue.length=0}else{let t=Promise.reject(e);t.catch(()=>{}),this.pushQueue.push(t)}}remove(){Promise.resolve().then(()=>{this.removeCallback&&this.removeCallback()})}[Symbol.asyncIterator](){return{next:e=>{let t=this.pushQueue.shift();return t?(this.lowWaterMark!==void 0&&this.pushQueue.length<=this.lowWaterMark&&this.isPaused&&(this.isPaused=!1,this.eventHandlers.lowWater&&this.eventHandlers.lowWater()),t):this.isStopped?Promise.resolve({value:void 0,done:!0}):new Promise((n,s)=>{this.pullQueue.push({resolve:n,reject:s})})},return:()=>(this.isStopped=!0,this.pushQueue.length=0,this.remove(),Promise.resolve({value:void 0,done:!0}))}}},o2=class{constructor(e,{highWaterMark:t=100,lowWaterMark:n=1}={}){let s=new N6;s.highWaterMark=t,s.lowWaterMark=n,s.removeCallback=e({push:i=>s.push(i),stop:()=>s.stop(),fail:i=>s.fail(i),on:(i,o)=>{s.eventHandlers[i]=o}})||(()=>{}),this[Symbol.asyncIterator]=()=>s[Symbol.asyncIterator](),Object.freeze(this)}};a2.EventIterator=o2;a2.default=o2});var LN=N(Mh=>{"use strict";Object.defineProperty(Mh,"__esModule",{value:!0});var O6=ON();Mh.EventIterator=O6.EventIterator;function Xre(r,e,t){return new O6.EventIterator(({push:n})=>(this.addEventListener(r,n,e),()=>this.removeEventListener(r,n,e)),t)}Mh.subscribe=Xre;Mh.default=O6.EventIterator});var B6=N((mke,KN)=>{"use strict";var jre=typeof navigator<"u"&&navigator.product==="ReactNative";function Zre(){return jre?"http://localhost":self.location?self.location.protocol+"//"+self.location.host:""}var Uh=self.URL,qN=Zre(),L6=class{constructor(e="",t=qN){this.super=new Uh(e,t),this.path=this.pathname+this.search,this.auth=this.username&&this.password?this.username+":"+this.password:null,this.query=this.search&&this.search.startsWith("?")?this.search.slice(1):null}get hash(){return this.super.hash}get host(){return this.super.host}get hostname(){return this.super.hostname}get href(){return this.super.href}get origin(){return this.super.origin}get password(){return this.super.password}get pathname(){return this.super.pathname}get port(){return this.super.port}get protocol(){return this.super.protocol}get search(){return this.super.search}get searchParams(){return this.super.searchParams}get username(){return this.super.username}set hash(e){this.super.hash=e}set host(e){this.super.host=e}set hostname(e){this.super.hostname=e}set href(e){this.super.href=e}set password(e){this.super.password=e}set pathname(e){this.super.pathname=e}set port(e){this.super.port=e}set protocol(e){this.super.protocol=e}set search(e){this.super.search=e}set username(e){this.super.username=e}static createObjectURL(e){return Uh.createObjectURL(e)}static revokeObjectURL(e){Uh.revokeObjectURL(e)}toJSON(){return this.super.toJSON()}toString(){return this.super.toString()}format(){return this.toString()}};function Jre(r){if(typeof r=="string")return new Uh(r).toString();if(!(r instanceof Uh)){let e=r.username&&r.password?`${r.username}:${r.password}@`:"",t=r.auth?r.auth+"@":"",n=r.port?":"+r.port:"",s=r.protocol?r.protocol+"//":"",i=r.host||"",o=r.hostname||"",a=r.search||(r.query?"?"+r.query:""),c=r.hash||"",l=r.pathname||"",u=r.path||l+a;return`${s}${e||t}${i||o+n}${u}${c}`}}KN.exports={URLWithLegacySupport:L6,URLSearchParams:self.URLSearchParams,defaultBase:qN,format:Jre}});var GN=N((gke,HN)=>{"use strict";var{URLWithLegacySupport:$N,format:ene}=B6();HN.exports=(r,e={},t={},n)=>{let s=e.protocol?e.protocol.replace(":",""):"http";s=(t[s]||n||s)+":";let i;try{i=new $N(r)}catch{i={}}let o=Object.assign({},e,{protocol:s||i.protocol,host:e.host||i.host});return new $N(r,ene(o)).toString()}});var YN=N((yke,WN)=>{"use strict";var{URLWithLegacySupport:tne,format:rne,URLSearchParams:nne,defaultBase:sne}=B6(),ine=GN();WN.exports={URL:tne,URLSearchParams:nne,format:rne,relative:ine,defaultBase:sne}});var JN=N((_ke,ZN)=>{function cne(){return!!(typeof window<"u"&&typeof window.process=="object"&&window.process.type==="renderer"||typeof process<"u"&&typeof process.versions=="object"&&process.versions.electron||typeof navigator=="object"&&typeof navigator.userAgent=="string"&&navigator.userAgent.indexOf("Electron")>=0)}ZN.exports=cne});var wL=N((aLe,bL)=>{function Yn(r,e){typeof e=="boolean"&&(e={forever:e}),this._originalTimeouts=JSON.parse(JSON.stringify(r)),this._timeouts=r,this._options=e||{},this._maxRetryTime=e&&e.maxRetryTime||1/0,this._fn=null,this._errors=[],this._attempts=1,this._operationTimeout=null,this._operationTimeoutCb=null,this._timeout=null,this._operationStart=null,this._timer=null,this._options.forever&&(this._cachedTimeouts=this._timeouts.slice(0))}bL.exports=Yn;Yn.prototype.reset=function(){this._attempts=1,this._timeouts=this._originalTimeouts.slice(0)};Yn.prototype.stop=function(){this._timeout&&clearTimeout(this._timeout),this._timer&&clearTimeout(this._timer),this._timeouts=[],this._cachedTimeouts=null};Yn.prototype.retry=function(r){if(this._timeout&&clearTimeout(this._timeout),!r)return!1;var e=new Date().getTime();if(r&&e-this._operationStart>=this._maxRetryTime)return this._errors.push(r),this._errors.unshift(new Error("RetryOperation timeout occurred")),!1;this._errors.push(r);var t=this._timeouts.shift();if(t===void 0)if(this._cachedTimeouts)this._errors.splice(0,this._errors.length-1),t=this._cachedTimeouts.slice(-1);else return!1;var n=this;return this._timer=setTimeout(function(){n._attempts++,n._operationTimeoutCb&&(n._timeout=setTimeout(function(){n._operationTimeoutCb(n._attempts)},n._operationTimeout),n._options.unref&&n._timeout.unref()),n._fn(n._attempts)},t),this._options.unref&&this._timer.unref(),!0};Yn.prototype.attempt=function(r,e){this._fn=r,e&&(e.timeout&&(this._operationTimeout=e.timeout),e.cb&&(this._operationTimeoutCb=e.cb));var t=this;this._operationTimeoutCb&&(this._timeout=setTimeout(function(){t._operationTimeoutCb()},t._operationTimeout)),this._operationStart=new Date().getTime(),this._fn(this._attempts)};Yn.prototype.try=function(r){console.log("Using RetryOperation.try() is deprecated"),this.attempt(r)};Yn.prototype.start=function(r){console.log("Using RetryOperation.start() is deprecated"),this.attempt(r)};Yn.prototype.start=Yn.prototype.try;Yn.prototype.errors=function(){return this._errors};Yn.prototype.attempts=function(){return this._attempts};Yn.prototype.mainError=function(){if(this._errors.length===0)return null;for(var r={},e=null,t=0,n=0;n<this._errors.length;n++){var s=this._errors[n],i=s.message,o=(r[i]||0)+1;r[i]=o,o>=t&&(e=s,t=o)}return e}});var xL=N(Ha=>{var cie=wL();Ha.operation=function(r){var e=Ha.timeouts(r);return new cie(e,{forever:r&&(r.forever||r.retries===1/0),unref:r&&r.unref,maxRetryTime:r&&r.maxRetryTime})};Ha.timeouts=function(r){if(r instanceof Array)return[].concat(r);var e={retries:10,factor:2,minTimeout:1*1e3,maxTimeout:1/0,randomize:!1};for(var t in r)e[t]=r[t];if(e.minTimeout>e.maxTimeout)throw new Error("minTimeout is greater than maxTimeout");for(var n=[],s=0;s<e.retries;s++)n.push(this.createTimeout(s,e));return r&&r.forever&&!n.length&&n.push(this.createTimeout(s,e)),n.sort(function(i,o){return i-o}),n};Ha.createTimeout=function(r,e){var t=e.randomize?Math.random()+1:1,n=Math.round(t*Math.max(e.minTimeout,1)*Math.pow(e.factor,r));return n=Math.min(n,e.maxTimeout),n};Ha.wrap=function(r,e,t){if(e instanceof Array&&(t=e,e=null),!t){t=[];for(var n in r)typeof r[n]=="function"&&t.push(n)}for(var s=0;s<t.length;s++){var i=t[s],o=r[i];r[i]=function(c){var l=Ha.operation(e),u=Array.prototype.slice.call(arguments,1),f=u.pop();u.push(function(h){l.retry(h)||(h&&(arguments[0]=l.mainError()),f.apply(this,arguments))}),l.attempt(function(){c.apply(r,u)})}.bind(r,o),r[i].options=e}}});var vL=N((lLe,EL)=>{EL.exports=xL()});var Eie={};Y(Eie,{createHelia:()=>wie});var nn=W(hu(),1);function fB(r,e){if(r.length>=255)throw new TypeError("Alphabet too long");for(var t=new Uint8Array(256),n=0;n<t.length;n++)t[n]=255;for(var s=0;s<r.length;s++){var i=r.charAt(s),o=i.charCodeAt(0);if(t[o]!==255)throw new TypeError(i+" is ambiguous");t[o]=s}var a=r.length,c=r.charAt(0),l=Math.log(a)/Math.log(256),u=Math.log(256)/Math.log(a);function f(d){if(d instanceof Uint8Array||(ArrayBuffer.isView(d)?d=new Uint8Array(d.buffer,d.byteOffset,d.byteLength):Array.isArray(d)&&(d=Uint8Array.from(d))),!(d instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(d.length===0)return"";for(var m=0,g=0,y=0,b=d.length;y!==b&&d[y]===0;)y++,m++;for(var w=(b-y)*u+1>>>0,v=new Uint8Array(w);y!==b;){for(var x=d[y],_=0,S=w-1;(x!==0||_<g)&&S!==-1;S--,_++)x+=256*v[S]>>>0,v[S]=x%a>>>0,x=x/a>>>0;if(x!==0)throw new Error("Non-zero carry");g=_,y++}for(var A=w-g;A!==w&&v[A]===0;)A++;for(var D=c.repeat(m);A<w;++A)D+=r.charAt(v[A]);return D}function h(d){if(typeof d!="string")throw new TypeError("Expected String");if(d.length===0)return new Uint8Array;var m=0;if(d[m]!==" "){for(var g=0,y=0;d[m]===c;)g++,m++;for(var b=(d.length-m)*l+1>>>0,w=new Uint8Array(b);d[m];){var v=t[d.charCodeAt(m)];if(v===255)return;for(var x=0,_=b-1;(v!==0||x<y)&&_!==-1;_--,x++)v+=a*w[_]>>>0,w[_]=v%256>>>0,v=v/256>>>0;if(v!==0)throw new Error("Non-zero carry");y=x,m++}if(d[m]!==" "){for(var S=b-y;S!==b&&w[S]===0;)S++;for(var A=new Uint8Array(g+(b-S)),D=g;S!==b;)A[D++]=w[S++];return A}}}function p(d){var m=h(d);if(m)return m;throw new Error(`Non-${e} character`)}return{encode:f,decodeUnsafe:h,decode:p}}var hB=fB,dB=hB,Q7=dB;var Rie=new Uint8Array(0);var X7=r=>{if(r instanceof Uint8Array&&r.constructor.name==="Uint8Array")return r;if(r instanceof ArrayBuffer)return new Uint8Array(r);if(ArrayBuffer.isView(r))return new Uint8Array(r.buffer,r.byteOffset,r.byteLength);throw new Error("Unknown type, must be binary type")};var v2=class{constructor(e,t,n){this.name=e,this.prefix=t,this.baseEncode=n}encode(e){if(e instanceof Uint8Array)return`${this.prefix}${this.baseEncode(e)}`;throw Error("Unknown type, must be binary type")}},_2=class{constructor(e,t,n){if(this.name=e,this.prefix=t,t.codePointAt(0)===void 0)throw new Error("Invalid prefix character");this.prefixCodePoint=t.codePointAt(0),this.baseDecode=n}decode(e){if(typeof e=="string"){if(e.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(e)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(e.slice(this.prefix.length))}else throw Error("Can only multibase decode strings")}or(e){return j7(this,e)}},S2=class{constructor(e){this.decoders=e}or(e){return j7(this,e)}decode(e){let t=e[0],n=this.decoders[t];if(n)return n.decode(e);throw RangeError(`Unable to decode multibase string ${JSON.stringify(e)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}},j7=(r,e)=>new S2({...r.decoders||{[r.prefix]:r},...e.decoders||{[e.prefix]:e}}),A2=class{constructor(e,t,n,s){this.name=e,this.prefix=t,this.baseEncode=n,this.baseDecode=s,this.encoder=new v2(e,t,n),this.decoder=new _2(e,t,s)}encode(e){return this.encoder.encode(e)}decode(e){return this.decoder.decode(e)}},Z7=({name:r,prefix:e,encode:t,decode:n})=>new A2(r,e,t,n),R2=({prefix:r,name:e,alphabet:t})=>{let{encode:n,decode:s}=Q7(t,e);return Z7({prefix:r,name:e,encode:n,decode:i=>X7(s(i))})},pB=(r,e,t,n)=>{let s={};for(let u=0;u<e.length;++u)s[e[u]]=u;let i=r.length;for(;r[i-1]==="=";)--i;let o=new Uint8Array(i*t/8|0),a=0,c=0,l=0;for(let u=0;u<i;++u){let f=s[r[u]];if(f===void 0)throw new SyntaxError(`Non-${n} character`);c=c<<t|f,a+=t,a>=8&&(a-=8,o[l++]=255&c>>a)}if(a>=t||255&c<<8-a)throw new SyntaxError("Unexpected end of data");return o},mB=(r,e,t)=>{let n=e[e.length-1]==="=",s=(1<<t)-1,i="",o=0,a=0;for(let c=0;c<r.length;++c)for(a=a<<8|r[c],o+=8;o>t;)o-=t,i+=e[s&a>>o];if(o&&(i+=e[s&a<<t-o]),n)for(;i.length*t&7;)i+="=";return i},Dr=({name:r,prefix:e,bitsPerChar:t,alphabet:n})=>Z7({prefix:e,name:r,encode(s){return mB(s,n,t)},decode(s){return pB(s,n,t,r)}});var J7=R2({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"}),kie=R2({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"});var eb=Dr({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5}),Lie=Dr({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5}),Bie=Dr({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5}),Mie=Dr({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5}),Uie=Dr({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5}),Fie=Dr({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5}),Vie=Dr({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5}),zie=Dr({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5}),qie=Dr({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5});var tb=Dr({prefix:"m",name:"base64",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bitsPerChar:6}),Hie=Dr({prefix:"M",name:"base64pad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",bitsPerChar:6}),Gie=Dr({prefix:"u",name:"base64url",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",bitsPerChar:6}),Wie=Dr({prefix:"U",name:"base64urlpad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=",bitsPerChar:6});nn.default.formatters.b=r=>r==null?"undefined":J7.baseEncode(r);nn.default.formatters.t=r=>r==null?"undefined":eb.baseEncode(r);nn.default.formatters.m=r=>r==null?"undefined":tb.baseEncode(r);nn.default.formatters.p=r=>r==null?"undefined":r.toString();nn.default.formatters.c=r=>r==null?"undefined":r.toString();nn.default.formatters.k=r=>r==null?"undefined":r.toString();nn.default.formatters.a=r=>r==null?"undefined":r.toString();function gB(r){let e=()=>{};return e.enabled=!1,e.color="",e.diff=0,e.log=()=>{},e.namespace=r,e.destroy=()=>!0,e.extend=()=>e,e}function C(r){let e=gB(`${r}:trace`);return nn.default.enabled(`${r}:trace`)&&nn.default.names.map(t=>t.toString()).find(t=>t.includes(":trace"))!=null&&(e=(0,nn.default)(`${r}:trace`)),Object.assign((0,nn.default)(r),{error:(0,nn.default)(`${r}:error`),trace:e})}var Qa={};Y(Qa,{abortedError:()=>vB,closeFailedError:()=>wB,deleteFailedError:()=>ib,getFailedError:()=>xB,hasFailedError:()=>EB,notFoundError:()=>du,openFailedError:()=>bB,putFailedError:()=>sb});var ei=W(Ko(),1);function bB(r){return r=r??new Error("Open failed"),(0,ei.default)(r,"ERR_OPEN_FAILED")}function wB(r){return r=r??new Error("Close failed"),(0,ei.default)(r,"ERR_CLOSE_FAILED")}function sb(r){return r=r??new Error("Put failed"),(0,ei.default)(r,"ERR_PUT_FAILED")}function xB(r){return r=r??new Error("Get failed"),(0,ei.default)(r,"ERR_GET_FAILED")}function ib(r){return r=r??new Error("Delete failed"),(0,ei.default)(r,"ERR_DELETE_FAILED")}function EB(r){return r=r??new Error("Has failed"),(0,ei.default)(r,"ERR_HAS_FAILED")}function du(r){return r=r??new Error("Not Found"),(0,ei.default)(r,"ERR_NOT_FOUND")}function vB(r){return r=r??new Error("Aborted"),(0,ei.default)(r,"ERR_ABORTED")}var $o=class{has(e,t){return Promise.reject(new Error(".has is not implemented"))}put(e,t,n){return Promise.reject(new Error(".put is not implemented"))}async*putMany(e,t){for await(let{cid:n,block:s}of e)await this.put(n,s,t),yield n}get(e,t){return Promise.reject(new Error(".get is not implemented"))}async*getMany(e,t){for await(let n of e)yield{cid:n,block:await this.get(n,t)}}async delete(e,t){await Promise.reject(new Error(".delete is not implemented"))}async*deleteMany(e,t){for await(let n of e)await this.delete(n,t),yield n}async*getAll(e){throw new Error(".getAll is not implemented")}};var P2={};Y(P2,{base32:()=>rr,base32hex:()=>PB,base32hexpad:()=>NB,base32hexpadupper:()=>OB,base32hexupper:()=>kB,base32pad:()=>DB,base32padupper:()=>CB,base32upper:()=>TB,base32z:()=>LB});function _B(r,e){if(r.length>=255)throw new TypeError("Alphabet too long");for(var t=new Uint8Array(256),n=0;n<t.length;n++)t[n]=255;for(var s=0;s<r.length;s++){var i=r.charAt(s),o=i.charCodeAt(0);if(t[o]!==255)throw new TypeError(i+" is ambiguous");t[o]=s}var a=r.length,c=r.charAt(0),l=Math.log(a)/Math.log(256),u=Math.log(256)/Math.log(a);function f(d){if(d instanceof Uint8Array||(ArrayBuffer.isView(d)?d=new Uint8Array(d.buffer,d.byteOffset,d.byteLength):Array.isArray(d)&&(d=Uint8Array.from(d))),!(d instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(d.length===0)return"";for(var m=0,g=0,y=0,b=d.length;y!==b&&d[y]===0;)y++,m++;for(var w=(b-y)*u+1>>>0,v=new Uint8Array(w);y!==b;){for(var x=d[y],_=0,S=w-1;(x!==0||_<g)&&S!==-1;S--,_++)x+=256*v[S]>>>0,v[S]=x%a>>>0,x=x/a>>>0;if(x!==0)throw new Error("Non-zero carry");g=_,y++}for(var A=w-g;A!==w&&v[A]===0;)A++;for(var D=c.repeat(m);A<w;++A)D+=r.charAt(v[A]);return D}function h(d){if(typeof d!="string")throw new TypeError("Expected String");if(d.length===0)return new Uint8Array;var m=0;if(d[m]!==" "){for(var g=0,y=0;d[m]===c;)g++,m++;for(var b=(d.length-m)*l+1>>>0,w=new Uint8Array(b);d[m];){var v=t[d.charCodeAt(m)];if(v===255)return;for(var x=0,_=b-1;(v!==0||x<y)&&_!==-1;_--,x++)v+=a*w[_]>>>0,w[_]=v%256>>>0,v=v/256>>>0;if(v!==0)throw new Error("Non-zero carry");y=x,m++}if(d[m]!==" "){for(var S=b-y;S!==b&&w[S]===0;)S++;for(var A=new Uint8Array(g+(b-S)),D=g;S!==b;)A[D++]=w[S++];return A}}}function p(d){var m=h(d);if(m)return m;throw new Error(`Non-${e} character`)}return{encode:f,decodeUnsafe:h,decode:p}}var SB=_B,AB=SB,ob=AB;var roe=new Uint8Array(0);var ab=(r,e)=>{if(r===e)return!0;if(r.byteLength!==e.byteLength)return!1;for(let t=0;t<r.byteLength;t++)if(r[t]!==e[t])return!1;return!0},ti=r=>{if(r instanceof Uint8Array&&r.constructor.name==="Uint8Array")return r;if(r instanceof ArrayBuffer)return new Uint8Array(r);if(ArrayBuffer.isView(r))return new Uint8Array(r.buffer,r.byteOffset,r.byteLength);throw new Error("Unknown type, must be binary type")};var cb=r=>new TextEncoder().encode(r),lb=r=>new TextDecoder().decode(r);var I2=class{constructor(e,t,n){this.name=e,this.prefix=t,this.baseEncode=n}encode(e){if(e instanceof Uint8Array)return`${this.prefix}${this.baseEncode(e)}`;throw Error("Unknown type, must be binary type")}},T2=class{constructor(e,t,n){if(this.name=e,this.prefix=t,t.codePointAt(0)===void 0)throw new Error("Invalid prefix character");this.prefixCodePoint=t.codePointAt(0),this.baseDecode=n}decode(e){if(typeof e=="string"){if(e.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(e)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(e.slice(this.prefix.length))}else throw Error("Can only multibase decode strings")}or(e){return fb(this,e)}},D2=class{constructor(e){this.decoders=e}or(e){return fb(this,e)}decode(e){let t=e[0],n=this.decoders[t];if(n)return n.decode(e);throw RangeError(`Unable to decode multibase string ${JSON.stringify(e)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}},fb=(r,e)=>new D2({...r.decoders||{[r.prefix]:r},...e.decoders||{[e.prefix]:e}}),C2=class{constructor(e,t,n,s){this.name=e,this.prefix=t,this.baseEncode=n,this.baseDecode=s,this.encoder=new I2(e,t,n),this.decoder=new T2(e,t,s)}encode(e){return this.encoder.encode(e)}decode(e){return this.decoder.decode(e)}},Xa=({name:r,prefix:e,encode:t,decode:n})=>new C2(r,e,t,n),Oi=({prefix:r,name:e,alphabet:t})=>{let{encode:n,decode:s}=ob(t,e);return Xa({prefix:r,name:e,encode:n,decode:i=>ti(s(i))})},RB=(r,e,t,n)=>{let s={};for(let u=0;u<e.length;++u)s[e[u]]=u;let i=r.length;for(;r[i-1]==="=";)--i;let o=new Uint8Array(i*t/8|0),a=0,c=0,l=0;for(let u=0;u<i;++u){let f=s[r[u]];if(f===void 0)throw new SyntaxError(`Non-${n} character`);c=c<<t|f,a+=t,a>=8&&(a-=8,o[l++]=255&c>>a)}if(a>=t||255&c<<8-a)throw new SyntaxError("Unexpected end of data");return o},IB=(r,e,t)=>{let n=e[e.length-1]==="=",s=(1<<t)-1,i="",o=0,a=0;for(let c=0;c<r.length;++c)for(a=a<<8|r[c],o+=8;o>t;)o-=t,i+=e[s&a>>o];if(o&&(i+=e[s&a<<t-o]),n)for(;i.length*t&7;)i+="=";return i},Ct=({name:r,prefix:e,bitsPerChar:t,alphabet:n})=>Xa({prefix:e,name:r,encode(s){return IB(s,n,t)},decode(s){return RB(s,n,t,r)}});var rr=Ct({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5}),TB=Ct({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5}),DB=Ct({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5}),CB=Ct({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5}),PB=Ct({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5}),kB=Ct({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5}),NB=Ct({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5}),OB=Ct({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5}),LB=Ct({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5});var BB=pb,hb=128,MB=127,UB=~MB,FB=Math.pow(2,31);function pb(r,e,t){e=e||[],t=t||0;for(var n=t;r>=FB;)e[t++]=r&255|hb,r/=128;for(;r&UB;)e[t++]=r&255|hb,r>>>=7;return e[t]=r|0,pb.bytes=t-n+1,e}var VB=k2,zB=128,db=127;function k2(r,n){var t=0,n=n||0,s=0,i=n,o,a=r.length;do{if(i>=a)throw k2.bytes=0,new RangeError("Could not decode varint");o=r[i++],t+=s<28?(o&db)<<s:(o&db)*Math.pow(2,s),s+=7}while(o>=zB);return k2.bytes=i-n,t}var qB=Math.pow(2,7),KB=Math.pow(2,14),$B=Math.pow(2,21),HB=Math.pow(2,28),GB=Math.pow(2,35),WB=Math.pow(2,42),YB=Math.pow(2,49),QB=Math.pow(2,56),XB=Math.pow(2,63),jB=function(r){return r<qB?1:r<KB?2:r<$B?3:r<HB?4:r<GB?5:r<WB?6:r<YB?7:r<QB?8:r<XB?9:10},ZB={encode:BB,decode:VB,encodingLength:jB},JB=ZB,pu=JB;var mu=(r,e=0)=>[pu.decode(r,e),pu.decode.bytes],ja=(r,e,t=0)=>(pu.encode(r,e,t),e),Za=r=>pu.encodingLength(r);var Ho=(r,e)=>{let t=e.byteLength,n=Za(r),s=n+Za(t),i=new Uint8Array(s+t);return ja(r,i,0),ja(t,i,n),i.set(e,s),new Ja(r,t,e,i)},ec=r=>{let e=ti(r),[t,n]=mu(e),[s,i]=mu(e.subarray(n)),o=e.subarray(n+i);if(o.byteLength!==s)throw new Error("Incorrect length");return new Ja(t,s,o,e)},mb=(r,e)=>{if(r===e)return!0;{let t=e;return r.code===t.code&&r.size===t.size&&t.bytes instanceof Uint8Array&&ab(r.bytes,t.bytes)}},Ja=class{constructor(e,t,n,s){this.code=e,this.size=t,this.digest=n,this.bytes=s}};var N2={};Y(N2,{base58btc:()=>or,base58flickr:()=>eM});var or=Oi({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"}),eM=Oi({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"});var gb=(r,e)=>{let{bytes:t,version:n}=r;switch(n){case 0:return rM(t,O2(r),e||or.encoder);default:return nM(t,O2(r),e||rr.encoder)}};var yb=new WeakMap,O2=r=>{let e=yb.get(r);if(e==null){let t=new Map;return yb.set(r,t),t}return e},Ve=class{constructor(e,t,n,s){this.code=t,this.version=e,this.multihash=n,this.bytes=s,this["/"]=s}get asCID(){return this}get byteOffset(){return this.bytes.byteOffset}get byteLength(){return this.bytes.byteLength}toV0(){switch(this.version){case 0:return this;case 1:{let{code:e,multihash:t}=this;if(e!==gu)throw new Error("Cannot convert a non dag-pb CID to CIDv0");if(t.code!==sM)throw new Error("Cannot convert non sha2-256 multihash CID to CIDv0");return Ve.createV0(t)}default:throw Error(`Can not convert CID version ${this.version} to version 0. This is a bug please report`)}}toV1(){switch(this.version){case 0:{let{code:e,digest:t}=this.multihash,n=Ho(e,t);return Ve.createV1(this.code,n)}case 1:return this;default:throw Error(`Can not convert CID version ${this.version} to version 1. This is a bug please report`)}}equals(e){return Ve.equals(this,e)}static equals(e,t){let n=t;return n&&e.code===n.code&&e.version===n.version&&mb(e.multihash,n.multihash)}toString(e){return gb(this,e)}toJSON(){return{"/":gb(this)}}link(){return this}get[Symbol.toStringTag](){return"CID"}[Symbol.for("nodejs.util.inspect.custom")](){return`CID(${this.toString()})`}static asCID(e){if(e==null)return null;let t=e;if(t instanceof Ve)return t;if(t["/"]!=null&&t["/"]===t.bytes||t.asCID===t){let{version:n,code:s,multihash:i,bytes:o}=t;return new Ve(n,s,i,o||bb(n,s,i.bytes))}else if(t[iM]===!0){let{version:n,multihash:s,code:i}=t,o=ec(s);return Ve.create(n,i,o)}else return null}static create(e,t,n){if(typeof t!="number")throw new Error("String codecs are no longer supported");if(!(n.bytes instanceof Uint8Array))throw new Error("Invalid digest");switch(e){case 0:{if(t!==gu)throw new Error(`Version 0 CID must use dag-pb (code: ${gu}) block encoding`);return new Ve(e,t,n,n.bytes)}case 1:{let s=bb(e,t,n.bytes);return new Ve(e,t,n,s)}default:throw new Error("Invalid version")}}static createV0(e){return Ve.create(0,gu,e)}static createV1(e,t){return Ve.create(1,e,t)}static decode(e){let[t,n]=Ve.decodeFirst(e);if(n.length)throw new Error("Incorrect length");return t}static decodeFirst(e){let t=Ve.inspectBytes(e),n=t.size-t.multihashSize,s=ti(e.subarray(n,n+t.multihashSize));if(s.byteLength!==t.multihashSize)throw new Error("Incorrect length");let i=s.subarray(t.multihashSize-t.digestSize),o=new Ja(t.multihashCode,t.digestSize,i,s);return[t.version===0?Ve.createV0(o):Ve.createV1(t.codec,o),e.subarray(t.size)]}static inspectBytes(e){let t=0,n=()=>{let[f,h]=mu(e.subarray(t));return t+=h,f},s=n(),i=gu;if(s===18?(s=0,t=0):i=n(),s!==0&&s!==1)throw new RangeError(`Invalid CID version ${s}`);let o=t,a=n(),c=n(),l=t+c,u=l-o;return{version:s,codec:i,multihashCode:a,digestSize:c,multihashSize:u,size:l}}static parse(e,t){let[n,s]=tM(e,t),i=Ve.decode(s);if(i.version===0&&e[0]!=="Q")throw Error("Version 0 CID string must not include multibase prefix");return O2(i).set(n,e),i}},tM=(r,e)=>{switch(r[0]){case"Q":{let t=e||or;return[or.prefix,t.decode(`${or.prefix}${r}`)]}case or.prefix:{let t=e||or;return[or.prefix,t.decode(r)]}case rr.prefix:{let t=e||rr;return[rr.prefix,t.decode(r)]}default:{if(e==null)throw Error("To parse non base32 or base58btc encoded CID multibase decoder must be provided");return[r[0],e.decode(r)]}}},rM=(r,e,t)=>{let{prefix:n}=t;if(n!==or.prefix)throw Error(`Cannot string encode V0 in ${t.name} encoding`);let s=e.get(n);if(s==null){let i=t.encode(r).slice(1);return e.set(n,i),i}else return s},nM=(r,e,t)=>{let{prefix:n}=t,s=e.get(n);if(s==null){let i=t.encode(r);return e.set(n,i),i}else return s},gu=112,sM=18,bb=(r,e,t)=>{let n=Za(r),s=n+Za(e),i=new Uint8Array(s+t.byteLength);return ja(r,i,0),ja(e,i,n),i.set(t,s),i},iM=Symbol.for("@ipld/js-cid/CID");var wb=85;var yu=class extends $o{data;constructor(){super(),this.data=new Map}put(e,t){return this.data.set(rr.encode(e.multihash.bytes),t),e}get(e){let t=this.data.get(rr.encode(e.multihash.bytes));if(t==null)throw du();return t}has(e){return this.data.has(rr.encode(e.multihash.bytes))}async delete(e){this.data.delete(rr.encode(e.multihash.bytes))}async*getAll(){for(let[e,t]of this.data.entries())yield{cid:Ve.createV1(wb,ec(rr.decode(e))),block:t}}};var sn=W(hu(),1);var L2={};Y(L2,{base64:()=>bu,base64pad:()=>oM,base64url:()=>aM,base64urlpad:()=>cM});var bu=Ct({prefix:"m",name:"base64",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bitsPerChar:6}),oM=Ct({prefix:"M",name:"base64pad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",bitsPerChar:6}),aM=Ct({prefix:"u",name:"base64url",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",bitsPerChar:6}),cM=Ct({prefix:"U",name:"base64urlpad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=",bitsPerChar:6});sn.default.formatters.b=r=>r==null?"undefined":or.baseEncode(r);sn.default.formatters.t=r=>r==null?"undefined":rr.baseEncode(r);sn.default.formatters.m=r=>r==null?"undefined":bu.baseEncode(r);sn.default.formatters.p=r=>r==null?"undefined":r.toString();sn.default.formatters.c=r=>r==null?"undefined":r.toString();sn.default.formatters.k=r=>r==null?"undefined":r.toString();sn.default.formatters.a=r=>r==null?"undefined":r.toString();function lM(r){let e=()=>{};return e.enabled=!1,e.color="",e.diff=0,e.log=()=>{},e.namespace=r,e.destroy=()=>!0,e.extend=()=>e,e}function Eb(r){let e=lM(`${r}:trace`);return sn.default.enabled(`${r}:trace`)&&sn.default.names.map(t=>t.toString()).find(t=>t.includes(":trace"))!=null&&(e=(0,sn.default)(`${r}:trace`)),Object.assign((0,sn.default)(r),{error:(0,sn.default)(`${r}:error`),trace:e})}function uM(r){return r[Symbol.asyncIterator]!=null}function fM(r){if(uM(r))return(async()=>{for await(let e of r);})();for(let e of r);}var $r=fM;function hM(r){let[e,t]=r[Symbol.asyncIterator]!=null?[r[Symbol.asyncIterator](),Symbol.asyncIterator]:[r[Symbol.iterator](),Symbol.iterator],n=[];return{peek:()=>e.next(),push:s=>{n.push(s)},next:()=>n.length>0?{done:!1,value:n.shift()}:e.next(),[t](){return this}}}var tc=hM;function dM(r){return r[Symbol.asyncIterator]!=null}function pM(r,e){if(dM(r))return async function*(){for await(let a of r)await e(a)&&(yield a)}();let t=tc(r),{value:n,done:s}=t.next();if(s===!0)return function*(){}();let i=e(n);if(typeof i.then=="function")return async function*(){await i&&(yield n);for await(let a of t)await e(a)&&(yield a)}();let o=e;return function*(){i===!0&&(yield n);for(let a of t)o(a)&&(yield a)}()}var Cr=pM;function De(){let r={};return r.promise=new Promise((e,t)=>{r.resolve=e,r.reject=t}),r}var r0=class{buffer;mask;top;btm;next;constructor(e){if(!(e>0)||e-1&e)throw new Error("Max size for a FixedFIFO should be a power of two");this.buffer=new Array(e),this.mask=e-1,this.top=0,this.btm=0,this.next=null}push(e){return this.buffer[this.top]!==void 0?!1:(this.buffer[this.top]=e,this.top=this.top+1&this.mask,!0)}shift(){let e=this.buffer[this.btm];if(e!==void 0)return this.buffer[this.btm]=void 0,this.btm=this.btm+1&this.mask,e}isEmpty(){return this.buffer[this.btm]===void 0}},rc=class{size;hwm;head;tail;constructor(e={}){this.hwm=e.splitLimit??16,this.head=new r0(this.hwm),this.tail=this.head,this.size=0}calculateSize(e){return e?.byteLength!=null?e.byteLength:1}push(e){if(e?.value!=null&&(this.size+=this.calculateSize(e.value)),!this.head.push(e)){let t=this.head;this.head=t.next=new r0(2*this.head.buffer.length),this.head.push(e)}}shift(){let e=this.tail.shift();if(e===void 0&&this.tail.next!=null){let t=this.tail.next;this.tail.next=null,this.tail=t,e=this.tail.shift()}return e?.value!=null&&(this.size-=this.calculateSize(e.value)),e}isEmpty(){return this.head.isEmpty()}};var B2=class extends Error{type;code;constructor(e,t){super(e??"The operation was aborted"),this.type="aborted",this.code=t??"ABORT_ERR"}};function yt(r={}){return _b(t=>{let n=t.shift();if(n==null)return{done:!0};if(n.error!=null)throw n.error;return{done:n.done===!0,value:n.value}},r)}function vb(r={}){return _b(t=>{let n,s=[];for(;!t.isEmpty()&&(n=t.shift(),n!=null);){if(n.error!=null)throw n.error;n.done===!1&&s.push(n.value)}return n==null?{done:!0}:{done:n.done===!0,value:s}},r)}function _b(r,e){e=e??{};let t=e.onEnd,n=new rc,s,i,o,a=De(),c=async()=>{try{return n.isEmpty()?o?{done:!0}:await new Promise((g,y)=>{i=b=>{i=null,n.push(b);try{g(r(n))}catch(w){y(w)}return s}}):r(n)}finally{n.isEmpty()&&queueMicrotask(()=>{a.resolve(),a=De()})}},l=g=>i!=null?i(g):(n.push(g),s),u=g=>(n=new rc,i!=null?i({error:g}):(n.push({error:g}),s)),f=g=>{if(o)return s;if(e?.objectMode!==!0&&g?.byteLength==null)throw new Error("objectMode was not true but tried to push non-Uint8Array value");return l({done:!1,value:g})},h=g=>o?s:(o=!0,g!=null?u(g):l({done:!0})),p=()=>(n=new rc,h(),{done:!0}),d=g=>(h(g),{done:!0});if(s={[Symbol.asyncIterator](){return this},next:c,return:p,throw:d,push:f,end:h,get readableLength(){return n.size},onEmpty:async g=>{let y=g?.signal;if(y?.throwIfAborted(),n.isEmpty())return;let b,w;y!=null&&(b=new Promise((v,x)=>{w=()=>{x(new B2)},y.addEventListener("abort",w)}));try{await Promise.race([a.promise,b])}finally{w!=null&&y!=null&&y?.removeEventListener("abort",w)}}},t==null)return s;let m=s;return s={[Symbol.asyncIterator](){return this},next(){return m.next()},throw(g){return m.throw(g),t!=null&&(t(g),t=void 0),{done:!0}},return(){return m.return(),t!=null&&(t(),t=void 0),{done:!0}},push:f,end(g){return m.end(g),t!=null&&(t(g),t=void 0),s},get readableLength(){return m.readableLength}},s}function mM(r){return r[Symbol.asyncIterator]!=null}function gM(...r){let e=[];for(let t of r)mM(t)||e.push(t);return e.length===r.length?function*(){for(let t of e)yield*t}():async function*(){let t=yt({objectMode:!0});Promise.resolve().then(async()=>{try{await Promise.all(r.map(async n=>{for await(let s of n)t.push(s)})),t.end()}catch(n){t.end(n)}}),yield*t}()}var nr=gM;var Hoe=Eb("blockstore:core:tiered");var Qoe={...Qa};var Sb=W(Ko(),1);function n0(r){return r=r??new Error("Not Found"),(0,Sb.default)(r,"ERR_NOT_FOUND")}var Ab=(r=21)=>crypto.getRandomValues(new Uint8Array(r)).reduce((e,t)=>(t&=63,t<36?e+=t.toString(36):t<62?e+=(t-26).toString(36).toUpperCase():t>62?e+="-":e+="_",e),"");function ri(r){return globalThis.Buffer!=null?new Uint8Array(r.buffer,r.byteOffset,r.byteLength):r}var M2={};Y(M2,{identity:()=>yM});var yM=Xa({prefix:"\0",name:"identity",encode:r=>lb(r),decode:r=>cb(r)});var U2={};Y(U2,{base2:()=>bM});var bM=Ct({prefix:"0",name:"base2",alphabet:"01",bitsPerChar:1});var F2={};Y(F2,{base8:()=>wM});var wM=Ct({prefix:"7",name:"base8",alphabet:"01234567",bitsPerChar:3});var V2={};Y(V2,{base10:()=>xM});var xM=Oi({prefix:"9",name:"base10",alphabet:"0123456789"});var z2={};Y(z2,{base16:()=>EM,base16upper:()=>vM});var EM=Ct({prefix:"f",name:"base16",alphabet:"0123456789abcdef",bitsPerChar:4}),vM=Ct({prefix:"F",name:"base16upper",alphabet:"0123456789ABCDEF",bitsPerChar:4});var q2={};Y(q2,{base36:()=>_M,base36upper:()=>SM});var _M=Oi({prefix:"k",name:"base36",alphabet:"0123456789abcdefghijklmnopqrstuvwxyz"}),SM=Oi({prefix:"K",name:"base36upper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"});var K2={};Y(K2,{base256emoji:()=>DM});var Rb=Array.from("\u{1F680}\u{1FA90}\u2604\u{1F6F0}\u{1F30C}\u{1F311}\u{1F312}\u{1F313}\u{1F314}\u{1F315}\u{1F316}\u{1F317}\u{1F318}\u{1F30D}\u{1F30F}\u{1F30E}\u{1F409}\u2600\u{1F4BB}\u{1F5A5}\u{1F4BE}\u{1F4BF}\u{1F602}\u2764\u{1F60D}\u{1F923}\u{1F60A}\u{1F64F}\u{1F495}\u{1F62D}\u{1F618}\u{1F44D}\u{1F605}\u{1F44F}\u{1F601}\u{1F525}\u{1F970}\u{1F494}\u{1F496}\u{1F499}\u{1F622}\u{1F914}\u{1F606}\u{1F644}\u{1F4AA}\u{1F609}\u263A\u{1F44C}\u{1F917}\u{1F49C}\u{1F614}\u{1F60E}\u{1F607}\u{1F339}\u{1F926}\u{1F389}\u{1F49E}\u270C\u2728\u{1F937}\u{1F631}\u{1F60C}\u{1F338}\u{1F64C}\u{1F60B}\u{1F497}\u{1F49A}\u{1F60F}\u{1F49B}\u{1F642}\u{1F493}\u{1F929}\u{1F604}\u{1F600}\u{1F5A4}\u{1F603}\u{1F4AF}\u{1F648}\u{1F447}\u{1F3B6}\u{1F612}\u{1F92D}\u2763\u{1F61C}\u{1F48B}\u{1F440}\u{1F62A}\u{1F611}\u{1F4A5}\u{1F64B}\u{1F61E}\u{1F629}\u{1F621}\u{1F92A}\u{1F44A}\u{1F973}\u{1F625}\u{1F924}\u{1F449}\u{1F483}\u{1F633}\u270B\u{1F61A}\u{1F61D}\u{1F634}\u{1F31F}\u{1F62C}\u{1F643}\u{1F340}\u{1F337}\u{1F63B}\u{1F613}\u2B50\u2705\u{1F97A}\u{1F308}\u{1F608}\u{1F918}\u{1F4A6}\u2714\u{1F623}\u{1F3C3}\u{1F490}\u2639\u{1F38A}\u{1F498}\u{1F620}\u261D\u{1F615}\u{1F33A}\u{1F382}\u{1F33B}\u{1F610}\u{1F595}\u{1F49D}\u{1F64A}\u{1F639}\u{1F5E3}\u{1F4AB}\u{1F480}\u{1F451}\u{1F3B5}\u{1F91E}\u{1F61B}\u{1F534}\u{1F624}\u{1F33C}\u{1F62B}\u26BD\u{1F919}\u2615\u{1F3C6}\u{1F92B}\u{1F448}\u{1F62E}\u{1F646}\u{1F37B}\u{1F343}\u{1F436}\u{1F481}\u{1F632}\u{1F33F}\u{1F9E1}\u{1F381}\u26A1\u{1F31E}\u{1F388}\u274C\u270A\u{1F44B}\u{1F630}\u{1F928}\u{1F636}\u{1F91D}\u{1F6B6}\u{1F4B0}\u{1F353}\u{1F4A2}\u{1F91F}\u{1F641}\u{1F6A8}\u{1F4A8}\u{1F92C}\u2708\u{1F380}\u{1F37A}\u{1F913}\u{1F619}\u{1F49F}\u{1F331}\u{1F616}\u{1F476}\u{1F974}\u25B6\u27A1\u2753\u{1F48E}\u{1F4B8}\u2B07\u{1F628}\u{1F31A}\u{1F98B}\u{1F637}\u{1F57A}\u26A0\u{1F645}\u{1F61F}\u{1F635}\u{1F44E}\u{1F932}\u{1F920}\u{1F927}\u{1F4CC}\u{1F535}\u{1F485}\u{1F9D0}\u{1F43E}\u{1F352}\u{1F617}\u{1F911}\u{1F30A}\u{1F92F}\u{1F437}\u260E\u{1F4A7}\u{1F62F}\u{1F486}\u{1F446}\u{1F3A4}\u{1F647}\u{1F351}\u2744\u{1F334}\u{1F4A3}\u{1F438}\u{1F48C}\u{1F4CD}\u{1F940}\u{1F922}\u{1F445}\u{1F4A1}\u{1F4A9}\u{1F450}\u{1F4F8}\u{1F47B}\u{1F910}\u{1F92E}\u{1F3BC}\u{1F975}\u{1F6A9}\u{1F34E}\u{1F34A}\u{1F47C}\u{1F48D}\u{1F4E3}\u{1F942}"),AM=Rb.reduce((r,e,t)=>(r[t]=e,r),[]),RM=Rb.reduce((r,e,t)=>(r[e.codePointAt(0)]=t,r),[]);function IM(r){return r.reduce((e,t)=>(e+=AM[t],e),"")}function TM(r){let e=[];for(let t of r){let n=RM[t.codePointAt(0)];if(n===void 0)throw new Error(`Non-base256emoji character: ${t}`);e.push(n)}return new Uint8Array(e)}var DM=Xa({prefix:"\u{1F680}",name:"base256emoji",encode:IM,decode:TM});var G2={};Y(G2,{sha256:()=>xu,sha512:()=>CM});var H2=({name:r,code:e,encode:t})=>new $2(r,e,t),$2=class{constructor(e,t,n){this.name=e,this.code=t,this.encode=n}digest(e){if(e instanceof Uint8Array){let t=this.encode(e);return t instanceof Uint8Array?Ho(this.code,t):t.then(n=>Ho(this.code,n))}else throw Error("Unknown type, must be binary type")}};var Tb=r=>async e=>new Uint8Array(await crypto.subtle.digest(r,e)),xu=H2({name:"sha2-256",code:18,encode:Tb("SHA-256")}),CM=H2({name:"sha2-512",code:19,encode:Tb("SHA-512")});var W2={};Y(W2,{identity:()=>NM});var Db=0,PM="identity",Cb=ti,kM=r=>Ho(Db,Cb(r)),NM={code:Db,name:PM,encode:Cb,digest:kM};var dae=new TextEncoder,pae=new TextDecoder;var Eu={...M2,...U2,...F2,...V2,...z2,...P2,...q2,...N2,...L2,...K2},wae={...G2,...W2};function ni(r=0){return globalThis.Buffer?.alloc!=null?ri(globalThis.Buffer.alloc(r)):new Uint8Array(r)}function on(r=0){return globalThis.Buffer?.allocUnsafe!=null?ri(globalThis.Buffer.allocUnsafe(r)):new Uint8Array(r)}function kb(r,e,t,n){return{name:r,prefix:e,encoder:{name:r,prefix:e,encode:t},decoder:{decode:n}}}var Pb=kb("utf8","u",r=>"u"+new TextDecoder("utf8").decode(r),r=>new TextEncoder().encode(r.substring(1))),Y2=kb("ascii","a",r=>{let e="a";for(let t=0;t<r.length;t++)e+=String.fromCharCode(r[t]);return e},r=>{r=r.substring(1);let e=on(r.length);for(let t=0;t<r.length;t++)e[t]=r.charCodeAt(t);return e}),LM={utf8:Pb,"utf-8":Pb,hex:Eu.base16,latin1:Y2,ascii:Y2,binary:Y2,...Eu},s0=LM;function $(r,e="utf8"){let t=s0[e];if(t==null)throw new Error(`Unsupported encoding "${e}"`);return(e==="utf8"||e==="utf-8")&&globalThis.Buffer!=null&&globalThis.Buffer.from!=null?ri(globalThis.Buffer.from(r,"utf-8")):t.decoder.decode(`${t.prefix}${r}`)}function M(r,e="utf8"){let t=s0[e];if(t==null)throw new Error(`Unsupported encoding "${e}"`);return(e==="utf8"||e==="utf-8")&&globalThis.Buffer!=null&&globalThis.Buffer.from!=null?globalThis.Buffer.from(r.buffer,r.byteOffset,r.byteLength).toString("utf8"):t.encoder.encode(r).substring(1)}var si="/",Nb=new TextEncoder().encode(si),i0=Nb[0],Ce=class{_buf;constructor(e,t){if(typeof e=="string")this._buf=$(e);else if(e instanceof Uint8Array)this._buf=e;else throw new Error("Invalid key, should be String of Uint8Array");if(t==null&&(t=!0),t&&this.clean(),this._buf.byteLength===0||this._buf[0]!==i0)throw new Error("Invalid key")}toString(e="utf8"){return M(this._buf,e)}uint8Array(){return this._buf}get[Symbol.toStringTag](){return`Key(${this.toString()})`}static withNamespaces(e){return new Ce(e.join(si))}static random(){return new Ce(Ab().replace(/-/g,""))}static asKey(e){return e instanceof Uint8Array||typeof e=="string"?new Ce(e):typeof e.uint8Array=="function"?new Ce(e.uint8Array()):null}clean(){if((this._buf==null||this._buf.byteLength===0)&&(this._buf=Nb),this._buf[0]!==i0){let e=new Uint8Array(this._buf.byteLength+1);e.fill(i0,0,1),e.set(this._buf,1),this._buf=e}for(;this._buf.byteLength>1&&this._buf[this._buf.byteLength-1]===i0;)this._buf=this._buf.subarray(0,-1)}less(e){let t=this.list(),n=e.list();for(let s=0;s<t.length;s++){if(n.length<s+1)return!1;let i=t[s],o=n[s];if(i<o)return!0;if(i>o)return!1}return t.length<n.length}reverse(){return Ce.withNamespaces(this.list().slice().reverse())}namespaces(){return this.list()}baseNamespace(){let e=this.namespaces();return e[e.length-1]}list(){return this.toString().split(si).slice(1)}type(){return BM(this.baseNamespace())}name(){return MM(this.baseNamespace())}instance(e){return new Ce(this.toString()+":"+e)}path(){let e=this.parent().toString();return e.endsWith(si)||(e+=si),e+=this.type(),new Ce(e)}parent(){let e=this.list();return e.length===1?new Ce(si):new Ce(e.slice(0,-1).join(si))}child(e){return this.toString()===si?e:e.toString()===si?this:new Ce(this.toString()+e.toString(),!1)}isAncestorOf(e){return e.toString()===this.toString()?!1:e.toString().startsWith(this.toString())}isDecendantOf(e){return e.toString()===this.toString()?!1:this.toString().startsWith(e.toString())}isTopLevel(){return this.list().length===1}concat(...e){return Ce.withNamespaces([...this.namespaces(),...UM(e.map(t=>t.namespaces()))])}};function BM(r){let e=r.split(":");return e.length<2?"":e.slice(0,-1).join(":")}function MM(r){let e=r.split(":");return e[e.length-1]}function UM(r){return[].concat(...r)}var Ob="SHARDING";function VM(r){return r[Symbol.asyncIterator]!=null}function zM(r){if(VM(r))return(async()=>{let t=[];for await(let n of r)t.push(n);return t})();let e=[];for(let t of r)e.push(t);return e}var vu=zM;function qM(r){return r[Symbol.asyncIterator]!=null}function KM(r,e){return qM(r)?async function*(){yield*(await vu(r)).sort(e)}():function*(){yield*vu(r).sort(e)}()}var o0=KM;function $M(r){return r[Symbol.asyncIterator]!=null}function HM(r,e){return $M(r)?async function*(){let t=0;if(!(e<1)){for await(let n of r)if(yield n,t++,t===e)return}}():function*(){let t=0;if(!(e<1)){for(let n of r)if(yield n,t++,t===e)return}}()}var Li=HM;var ii=class{put(e,t,n){return Promise.reject(new Error(".put is not implemented"))}get(e,t){return Promise.reject(new Error(".get is not implemented"))}has(e,t){return Promise.reject(new Error(".has is not implemented"))}delete(e,t){return Promise.reject(new Error(".delete is not implemented"))}async*putMany(e,t={}){for await(let{key:n,value:s}of e)await this.put(n,s,t),yield n}async*getMany(e,t={}){for await(let n of e)yield{key:n,value:await this.get(n,t)}}async*deleteMany(e,t={}){for await(let n of e)await this.delete(n,t),yield n}batch(){let e=[],t=[];return{put(n,s){e.push({key:n,value:s})},delete(n){t.push(n)},commit:async n=>{await $r(this.putMany(e,n)),e=[],await $r(this.deleteMany(t,n)),t=[]}}}async*_all(e,t){throw new Error("._all is not implemented")}async*_allKeys(e,t){throw new Error("._allKeys is not implemented")}query(e,t){let n=this._all(e,t);if(e.prefix!=null){let s=e.prefix;n=Cr(n,i=>i.key.toString().startsWith(s))}if(Array.isArray(e.filters)&&(n=e.filters.reduce((s,i)=>Cr(s,i),n)),Array.isArray(e.orders)&&(n=e.orders.reduce((s,i)=>o0(s,i),n)),e.offset!=null){let s=0,i=e.offset;n=Cr(n,()=>s++>=i)}return e.limit!=null&&(n=Li(n,e.limit)),n}queryKeys(e,t){let n=this._allKeys(e,t);if(e.prefix!=null){let s=e.prefix;n=Cr(n,i=>i.toString().startsWith(s))}if(Array.isArray(e.filters)&&(n=e.filters.reduce((s,i)=>Cr(s,i),n)),Array.isArray(e.orders)&&(n=e.orders.reduce((s,i)=>o0(s,i),n)),e.offset!=null){let s=e.offset,i=0;n=Cr(n,()=>i++>=s)}return e.limit!=null&&(n=Li(n,e.limit)),n}};var Wo=class extends ii{data;constructor(){super(),this.data=new Map}put(e,t){return this.data.set(e.toString(),t),e}get(e){let t=this.data.get(e.toString());if(t==null)throw n0();return t}has(e){return this.data.has(e.toString())}delete(e){this.data.delete(e.toString())}*_all(){for(let[e,t]of this.data.entries())yield{key:new Ce(e),value:t}}*_allKeys(){for(let e of this.data.keys())yield new Ce(e)}};function GM(r){return r[Symbol.asyncIterator]!=null}function WM(r,e){if(GM(r))return async function*(){for await(let a of r)yield e(a)}();let t=tc(r),{value:n,done:s}=t.next();if(s===!0)return function*(){}();let i=e(n);if(typeof i.then=="function")return async function*(){yield await i;for await(let a of t)yield e(a)}();let o=e;return function*(){yield i;for(let a of t)yield o(a)}()}var Qn=WM;function Re(r,...e){if(r==null)throw new Error("Empty pipeline");if(Q2(r)){let n=r;r=()=>n.source}else if(Bb(r)||Lb(r)){let n=r;r=()=>n}let t=[r,...e];if(t.length>1&&Q2(t[t.length-1])&&(t[t.length-1]=t[t.length-1].sink),t.length>2)for(let n=1;n<t.length-1;n++)Q2(t[n])&&(t[n]=QM(t[n]));return YM(...t)}var YM=(...r)=>{let e;for(;r.length>0;)e=r.shift()(e);return e},Lb=r=>r?.[Symbol.asyncIterator]!=null,Bb=r=>r?.[Symbol.iterator]!=null,Q2=r=>r==null?!1:r.sink!=null&&r.source!=null,QM=r=>e=>{let t=r.sink(e);if(t?.then!=null){let n=yt({objectMode:!0});t.then(()=>{n.end()},o=>{n.end(o)});let s,i=r.source;if(Lb(i))s=async function*(){yield*i,n.end()};else if(Bb(i))s=function*(){yield*i,n.end()};else throw new Error("Unknown duplex source type - must be Iterable or AsyncIterable");return nr(n,s())}return r.source};var fce=new Ce(Ob);var an=W(hu(),1);an.default.formatters.b=r=>r==null?"undefined":or.baseEncode(r);an.default.formatters.t=r=>r==null?"undefined":rr.baseEncode(r);an.default.formatters.m=r=>r==null?"undefined":bu.baseEncode(r);an.default.formatters.p=r=>r==null?"undefined":r.toString();an.default.formatters.c=r=>r==null?"undefined":r.toString();an.default.formatters.k=r=>r==null?"undefined":r.toString();an.default.formatters.a=r=>r==null?"undefined":r.toString();function ZM(r){let e=()=>{};return e.enabled=!1,e.color="",e.diff=0,e.log=()=>{},e.namespace=r,e.destroy=()=>!0,e.extend=()=>e,e}function Ub(r){let e=ZM(`${r}:trace`);return an.default.enabled(`${r}:trace`)&&an.default.names.map(t=>t.toString()).find(t=>t.includes(":trace"))!=null&&(e=(0,an.default)(`${r}:trace`)),Object.assign((0,an.default)(r),{error:(0,an.default)(`${r}:error`),trace:e})}var Ice=Ub("datastore:core:tiered");function ot(r){let e=new globalThis.AbortController;function t(){e.abort();for(let i of r)i?.removeEventListener!=null&&i.removeEventListener("abort",t)}for(let i of r){if(i?.aborted===!0){t();break}i?.addEventListener!=null&&i.addEventListener("abort",t)}function n(){for(let i of r)i?.removeEventListener!=null&&i.removeEventListener("abort",t)}let s=e.signal;return s.clear=n,s}function JM(r){return r[Symbol.asyncIterator]!=null}function eU(r,e){if(JM(r))return async function*(){for await(let a of r)await e(a),yield a}();let t=tc(r),{value:n,done:s}=t.next();if(s===!0)return function*(){}();if(typeof e(n)?.then=="function")return async function*(){yield n;for await(let a of t)await e(a),yield a}();let o=e;return function*(){yield n;for(let a of t)o(a),yield a}()}var _u=eU;var tU=zb,Fb=128,rU=127,nU=~rU,sU=Math.pow(2,31);function zb(r,e,t){e=e||[],t=t||0;for(var n=t;r>=sU;)e[t++]=r&255|Fb,r/=128;for(;r&nU;)e[t++]=r&255|Fb,r>>>=7;return e[t]=r|0,zb.bytes=t-n+1,e}var iU=X2,oU=128,Vb=127;function X2(r,n){var t=0,n=n||0,s=0,i=n,o,a=r.length;do{if(i>=a)throw X2.bytes=0,new RangeError("Could not decode varint");o=r[i++],t+=s<28?(o&Vb)<<s:(o&Vb)*Math.pow(2,s),s+=7}while(o>=oU);return X2.bytes=i-n,t}var aU=Math.pow(2,7),cU=Math.pow(2,14),lU=Math.pow(2,21),uU=Math.pow(2,28),fU=Math.pow(2,35),hU=Math.pow(2,42),dU=Math.pow(2,49),pU=Math.pow(2,56),mU=Math.pow(2,63),gU=function(r){return r<aU?1:r<cU?2:r<lU?3:r<uU?4:r<fU?5:r<hU?6:r<dU?7:r<pU?8:r<mU?9:10},yU={encode:tU,decode:iU,encodingLength:gU},bU=yU,Su=bU;var Au=(r,e=0)=>[Su.decode(r,e),Su.decode.bytes],nc=(r,e,t=0)=>(Su.encode(r,e,t),e),sc=r=>Su.encodingLength(r);var Qce=new Uint8Array(0);var Kb=(r,e)=>{if(r===e)return!0;if(r.byteLength!==e.byteLength)return!1;for(let t=0;t<r.byteLength;t++)if(r[t]!==e[t])return!1;return!0},ic=r=>{if(r instanceof Uint8Array&&r.constructor.name==="Uint8Array")return r;if(r instanceof ArrayBuffer)return new Uint8Array(r);if(ArrayBuffer.isView(r))return new Uint8Array(r.buffer,r.byteOffset,r.byteLength);throw new Error("Unknown type, must be binary type")};var Ru=(r,e)=>{let t=e.byteLength,n=sc(r),s=n+sc(t),i=new Uint8Array(s+t);return nc(r,i,0),nc(t,i,n),i.set(e,s),new oc(r,t,e,i)},$b=r=>{let e=ic(r),[t,n]=Au(e),[s,i]=Au(e.subarray(n)),o=e.subarray(n+i);if(o.byteLength!==s)throw new Error("Incorrect length");return new oc(t,s,o,e)},Hb=(r,e)=>{if(r===e)return!0;{let t=e;return r.code===t.code&&r.size===t.size&&t.bytes instanceof Uint8Array&&Kb(r.bytes,t.bytes)}},oc=class{constructor(e,t,n,s){this.code=e,this.size=t,this.digest=n,this.bytes=s}};function wU(r,e){if(r.length>=255)throw new TypeError("Alphabet too long");for(var t=new Uint8Array(256),n=0;n<t.length;n++)t[n]=255;for(var s=0;s<r.length;s++){var i=r.charAt(s),o=i.charCodeAt(0);if(t[o]!==255)throw new TypeError(i+" is ambiguous");t[o]=s}var a=r.length,c=r.charAt(0),l=Math.log(a)/Math.log(256),u=Math.log(256)/Math.log(a);function f(d){if(d instanceof Uint8Array||(ArrayBuffer.isView(d)?d=new Uint8Array(d.buffer,d.byteOffset,d.byteLength):Array.isArray(d)&&(d=Uint8Array.from(d))),!(d instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(d.length===0)return"";for(var m=0,g=0,y=0,b=d.length;y!==b&&d[y]===0;)y++,m++;for(var w=(b-y)*u+1>>>0,v=new Uint8Array(w);y!==b;){for(var x=d[y],_=0,S=w-1;(x!==0||_<g)&&S!==-1;S--,_++)x+=256*v[S]>>>0,v[S]=x%a>>>0,x=x/a>>>0;if(x!==0)throw new Error("Non-zero carry");g=_,y++}for(var A=w-g;A!==w&&v[A]===0;)A++;for(var D=c.repeat(m);A<w;++A)D+=r.charAt(v[A]);return D}function h(d){if(typeof d!="string")throw new TypeError("Expected String");if(d.length===0)return new Uint8Array;var m=0;if(d[m]!==" "){for(var g=0,y=0;d[m]===c;)g++,m++;for(var b=(d.length-m)*l+1>>>0,w=new Uint8Array(b);d[m];){var v=t[d.charCodeAt(m)];if(v===255)return;for(var x=0,_=b-1;(v!==0||x<y)&&_!==-1;_--,x++)v+=a*w[_]>>>0,w[_]=v%256>>>0,v=v/256>>>0;if(v!==0)throw new Error("Non-zero carry");y=x,m++}if(d[m]!==" "){for(var S=b-y;S!==b&&w[S]===0;)S++;for(var A=new Uint8Array(g+(b-S)),D=g;S!==b;)A[D++]=w[S++];return A}}}function p(d){var m=h(d);if(m)return m;throw new Error(`Non-${e} character`)}return{encode:f,decodeUnsafe:h,decode:p}}var xU=wU,EU=xU,Wb=EU;var j2=class{constructor(e,t,n){this.name=e,this.prefix=t,this.baseEncode=n}encode(e){if(e instanceof Uint8Array)return`${this.prefix}${this.baseEncode(e)}`;throw Error("Unknown type, must be binary type")}},Z2=class{constructor(e,t,n){if(this.name=e,this.prefix=t,t.codePointAt(0)===void 0)throw new Error("Invalid prefix character");this.prefixCodePoint=t.codePointAt(0),this.baseDecode=n}decode(e){if(typeof e=="string"){if(e.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(e)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(e.slice(this.prefix.length))}else throw Error("Can only multibase decode strings")}or(e){return Yb(this,e)}},J2=class{constructor(e){this.decoders=e}or(e){return Yb(this,e)}decode(e){let t=e[0],n=this.decoders[t];if(n)return n.decode(e);throw RangeError(`Unable to decode multibase string ${JSON.stringify(e)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}},Yb=(r,e)=>new J2({...r.decoders||{[r.prefix]:r},...e.decoders||{[e.prefix]:e}}),em=class{constructor(e,t,n,s){this.name=e,this.prefix=t,this.baseEncode=n,this.baseDecode=s,this.encoder=new j2(e,t,n),this.decoder=new Z2(e,t,s)}encode(e){return this.encoder.encode(e)}decode(e){return this.decoder.decode(e)}},Qb=({name:r,prefix:e,encode:t,decode:n})=>new em(r,e,t,n),tm=({prefix:r,name:e,alphabet:t})=>{let{encode:n,decode:s}=Wb(t,e);return Qb({prefix:r,name:e,encode:n,decode:i=>ic(s(i))})},vU=(r,e,t,n)=>{let s={};for(let u=0;u<e.length;++u)s[e[u]]=u;let i=r.length;for(;r[i-1]==="=";)--i;let o=new Uint8Array(i*t/8|0),a=0,c=0,l=0;for(let u=0;u<i;++u){let f=s[r[u]];if(f===void 0)throw new SyntaxError(`Non-${n} character`);c=c<<t|f,a+=t,a>=8&&(a-=8,o[l++]=255&c>>a)}if(a>=t||255&c<<8-a)throw new SyntaxError("Unexpected end of data");return o},_U=(r,e,t)=>{let n=e[e.length-1]==="=",s=(1<<t)-1,i="",o=0,a=0;for(let c=0;c<r.length;++c)for(a=a<<8|r[c],o+=8;o>t;)o-=t,i+=e[s&a>>o];if(o&&(i+=e[s&a<<t-o]),n)for(;i.length*t&7;)i+="=";return i},_s=({name:r,prefix:e,bitsPerChar:t,alphabet:n})=>Qb({prefix:e,name:r,encode(s){return _U(s,n,t)},decode(s){return vU(s,n,t,r)}});var Xe=tm({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"}),nle=tm({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"});var Iu=_s({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5}),ole=_s({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5}),ale=_s({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5}),cle=_s({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5}),lle=_s({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5}),ule=_s({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5}),fle=_s({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5}),hle=_s({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5}),dle=_s({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5});var Xb=(r,e)=>{let{bytes:t,version:n}=r;switch(n){case 0:return AU(t,rm(r),e||Xe.encoder);default:return RU(t,rm(r),e||Iu.encoder)}};var jb=new WeakMap,rm=r=>{let e=jb.get(r);if(e==null){let t=new Map;return jb.set(r,t),t}return e},je=class{constructor(e,t,n,s){this.code=t,this.version=e,this.multihash=n,this.bytes=s,this["/"]=s}get asCID(){return this}get byteOffset(){return this.bytes.byteOffset}get byteLength(){return this.bytes.byteLength}toV0(){switch(this.version){case 0:return this;case 1:{let{code:e,multihash:t}=this;if(e!==Tu)throw new Error("Cannot convert a non dag-pb CID to CIDv0");if(t.code!==IU)throw new Error("Cannot convert non sha2-256 multihash CID to CIDv0");return je.createV0(t)}default:throw Error(`Can not convert CID version ${this.version} to version 0. This is a bug please report`)}}toV1(){switch(this.version){case 0:{let{code:e,digest:t}=this.multihash,n=Ru(e,t);return je.createV1(this.code,n)}case 1:return this;default:throw Error(`Can not convert CID version ${this.version} to version 1. This is a bug please report`)}}equals(e){return je.equals(this,e)}static equals(e,t){let n=t;return n&&e.code===n.code&&e.version===n.version&&Hb(e.multihash,n.multihash)}toString(e){return Xb(this,e)}toJSON(){return{"/":Xb(this)}}link(){return this}get[Symbol.toStringTag](){return"CID"}[Symbol.for("nodejs.util.inspect.custom")](){return`CID(${this.toString()})`}static asCID(e){if(e==null)return null;let t=e;if(t instanceof je)return t;if(t["/"]!=null&&t["/"]===t.bytes||t.asCID===t){let{version:n,code:s,multihash:i,bytes:o}=t;return new je(n,s,i,o||Zb(n,s,i.bytes))}else if(t[TU]===!0){let{version:n,multihash:s,code:i}=t,o=$b(s);return je.create(n,i,o)}else return null}static create(e,t,n){if(typeof t!="number")throw new Error("String codecs are no longer supported");if(!(n.bytes instanceof Uint8Array))throw new Error("Invalid digest");switch(e){case 0:{if(t!==Tu)throw new Error(`Version 0 CID must use dag-pb (code: ${Tu}) block encoding`);return new je(e,t,n,n.bytes)}case 1:{let s=Zb(e,t,n.bytes);return new je(e,t,n,s)}default:throw new Error("Invalid version")}}static createV0(e){return je.create(0,Tu,e)}static createV1(e,t){return je.create(1,e,t)}static decode(e){let[t,n]=je.decodeFirst(e);if(n.length)throw new Error("Incorrect length");return t}static decodeFirst(e){let t=je.inspectBytes(e),n=t.size-t.multihashSize,s=ic(e.subarray(n,n+t.multihashSize));if(s.byteLength!==t.multihashSize)throw new Error("Incorrect length");let i=s.subarray(t.multihashSize-t.digestSize),o=new oc(t.multihashCode,t.digestSize,i,s);return[t.version===0?je.createV0(o):je.createV1(t.codec,o),e.subarray(t.size)]}static inspectBytes(e){let t=0,n=()=>{let[f,h]=Au(e.subarray(t));return t+=h,f},s=n(),i=Tu;if(s===18?(s=0,t=0):i=n(),s!==0&&s!==1)throw new RangeError(`Invalid CID version ${s}`);let o=t,a=n(),c=n(),l=t+c,u=l-o;return{version:s,codec:i,multihashCode:a,digestSize:c,multihashSize:u,size:l}}static parse(e,t){let[n,s]=SU(e,t),i=je.decode(s);if(i.version===0&&e[0]!=="Q")throw Error("Version 0 CID string must not include multibase prefix");return rm(i).set(n,e),i}},SU=(r,e)=>{switch(r[0]){case"Q":{let t=e||Xe;return[Xe.prefix,t.decode(`${Xe.prefix}${r}`)]}case Xe.prefix:{let t=e||Xe;return[Xe.prefix,t.decode(r)]}case Iu.prefix:{let t=e||Iu;return[Iu.prefix,t.decode(r)]}default:{if(e==null)throw Error("To parse non base32 or base58btc encoded CID multibase decoder must be provided");return[r[0],e.decode(r)]}}},AU=(r,e,t)=>{let{prefix:n}=t;if(n!==Xe.prefix)throw Error(`Cannot string encode V0 in ${t.name} encoding`);let s=e.get(n);if(s==null){let i=t.encode(r).slice(1);return e.set(n,i),i}else return s},RU=(r,e,t)=>{let{prefix:n}=t,s=e.get(n);if(s==null){let i=t.encode(r);return e.set(n,i),i}else return s},Tu=112,IU=18,Zb=(r,e,t)=>{let n=sc(r),s=n+sc(e),i=new Uint8Array(s+t.byteLength);return nc(r,i,0),nc(e,i,n),i.set(t,s),i},TU=Symbol.for("@ipld/js-cid/CID");var nm=class extends Map{metric;constructor(e){super();let{name:t,metrics:n}=e;this.metric=n.registerMetric(t),this.updateComponentMetric()}set(e,t){return super.set(e,t),this.updateComponentMetric(),this}delete(e){let t=super.delete(e);return this.updateComponentMetric(),t}clear(){super.clear(),this.updateComponentMetric()}updateComponentMetric(){this.metric.update(this.size)}};function Ss(r){let{name:e,metrics:t}=r,n;return t!=null?n=new nm({name:e,metrics:t}):n=new Map,n}var a0=class extends Error{code;type;constructor(e="The operation was aborted"){super(e),this.code=a0.code,this.type=a0.type}},cn=a0;gt(cn,"code","ABORT_ERR"),gt(cn,"type","aborted");var E=class extends Error{code;props;constructor(e,t,n){super(e),this.code=t,this.name=n?.name??"CodeError",this.props=n??{}}};var im=({name:r,code:e,encode:t})=>new sm(r,e,t),sm=class{constructor(e,t,n){this.name=e,this.code=t,this.encode=n}digest(e){if(e instanceof Uint8Array){let t=this.encode(e);return t instanceof Uint8Array?Ru(this.code,t):t.then(n=>Ru(this.code,n))}else throw Error("Unknown type, must be binary type")}};var Jb=r=>async e=>new Uint8Array(await crypto.subtle.digest(r,e)),c0=im({name:"sha2-256",code:18,encode:Jb("SHA-256")}),Ale=im({name:"sha2-512",code:19,encode:Jb("SHA-512")});var aw=W(d9(),1);function be(r,e){if(r===e)return!0;if(r.byteLength!==e.byteLength)return!1;for(let t=0;t<r.byteLength;t++)if(r[t]!==e[t])return!1;return!0}var Yo=class{_refCounter;cid;priority;wantType;constructor(e,t,n){this._refCounter=1,this.cid=e,this.priority=t??1,this.wantType=n}inc(){this._refCounter+=1}dec(){this._refCounter=Math.max(0,this._refCounter-1)}hasRefs(){return this._refCounter>0}get[Symbol.toStringTag](){return`WantlistEntry <key: ${this.cid.toString(Xe)}, priority: ${this.priority}, refs: ${this._refCounter}>`}equals(e){return this._refCounter===e._refCounter&&this.cid.equals(e.cid)&&this.priority===e.priority&&this.wantType===e.wantType}};var Bi=class{entry;cancel;sendDontHave;constructor(e,t,n,s,i){this.entry=new Yo(e,t,n),this.cancel=!!s,this.sendDontHave=!!i}get cid(){return this.entry.cid}set cid(e){this.entry.cid=e}get priority(){return this.entry.priority}set priority(e){this.entry.priority=e}get wantType(){return this.entry.wantType}set wantType(e){this.entry.wantType=e}get[Symbol.toStringTag](){return`BitswapMessageEntry ${this.cid.toString(Xe)} <cancel: ${this.cancel}, priority: ${this.priority}>`}equals(e){return this.cancel===e.cancel&&this.sendDontHave===e.sendDontHave&&this.wantType===e.wantType&&this.entry.equals(e.entry)}};var Pn=(r,e)=>{let t=["bitswap"];return e!=null&&t.push(e),r!=null&&t.push(`${r.toString().slice(0,8)}`),C(t.join(":"))};var l0=(r,e)=>{if(r.size!==e.size)return!1;for(let[t,n]of r){let s=e.get(t);if(s===void 0||n instanceof Uint8Array&&s instanceof Uint8Array&&!be(n,s)||n instanceof Bi&&s instanceof Bi&&!n.equals(s))return!1}return!0};var Du=W(ac(),1);function tF(r){let e=new Uint8Array(r.reduce((n,s)=>n+Du.default.encodingLength(s),0)),t=0;for(let n of r)e=Du.encode(n,e,t),t+=Du.default.encodingLength(n);return e}var _9=tF;var Tm=W(xm(),1),nw=W(Q9(),1),sw=W(Xo(),1),Dm=W(Im(),1),iw=W(rw(),1);function uF(){sw.default._configure(),Tm.default._configure(nw.default),Dm.default._configure(iw.default)}uF();var ow=["uint64","int64","sint64","fixed64","sfixed64"];function fF(r){for(let e of ow){if(r[e]==null)continue;let t=r[e];r[e]=function(){return BigInt(t.call(this).toString())}}return r}function Cm(r){return fF(new Tm.default(r))}function hF(r){for(let e of ow){if(r[e]==null)continue;let t=r[e];r[e]=function(n){return t.call(this,n.toString())}}return r}function Pm(){return hF(Dm.default.create())}function de(r,e){let t=Cm(r instanceof Uint8Array?r:r.subarray());return e.decode(t)}function pe(r,e){let t=Pm();return e.encode(r,t,{lengthDelimited:!1}),t.finish()}var lc;(function(r){r[r.VARINT=0]="VARINT",r[r.BIT64=1]="BIT64",r[r.LENGTH_DELIMITED=2]="LENGTH_DELIMITED",r[r.START_GROUP=3]="START_GROUP",r[r.END_GROUP=4]="END_GROUP",r[r.BIT32=5]="BIT32"})(lc||(lc={}));function p0(r,e,t,n){return{name:r,type:e,encode:t,decode:n}}function Pt(r){function e(s){if(r[s.toString()]==null)throw new Error("Invalid enum value");return r[s]}let t=function(i,o){let a=e(i);o.int32(a)},n=function(i){let o=i.int32();return e(o)};return p0("enum",lc.VARINT,t,n)}function me(r,e){return p0("message",lc.LENGTH_DELIMITED,r,e)}var Hr;(function(r){let e;(function(a){let c;(function(h){h.Block="Block",h.Have="Have"})(c=a.WantType||(a.WantType={}));let l;(function(h){h[h.Block=0]="Block",h[h.Have=1]="Have"})(l||(l={})),function(h){h.codec=()=>Pt(l)}(c=a.WantType||(a.WantType={}));let u;(function(h){let p;h.codec=()=>(p==null&&(p=me((d,m,g={})=>{g.lengthDelimited!==!1&&m.fork(),d.block!=null&&d.block.byteLength>0&&(m.uint32(10),m.bytes(d.block)),d.priority!=null&&d.priority!==0&&(m.uint32(16),m.int32(d.priority)),d.cancel!=null&&d.cancel!==!1&&(m.uint32(24),m.bool(d.cancel)),d.wantType!=null&&l[d.wantType]!==0&&(m.uint32(32),r.Wantlist.WantType.codec().encode(d.wantType,m)),d.sendDontHave!=null&&d.sendDontHave!==!1&&(m.uint32(40),m.bool(d.sendDontHave)),g.lengthDelimited!==!1&&m.ldelim()},(d,m)=>{let g={block:new Uint8Array(0),priority:0,cancel:!1,wantType:c.Block,sendDontHave:!1},y=m==null?d.len:d.pos+m;for(;d.pos<y;){let b=d.uint32();switch(b>>>3){case 1:g.block=d.bytes();break;case 2:g.priority=d.int32();break;case 3:g.cancel=d.bool();break;case 4:g.wantType=r.Wantlist.WantType.codec().decode(d);break;case 5:g.sendDontHave=d.bool();break;default:d.skipType(b&7);break}}return g})),p),h.encode=d=>pe(d,h.codec()),h.decode=d=>de(d,h.codec())})(u=a.Entry||(a.Entry={}));let f;a.codec=()=>(f==null&&(f=me((h,p,d={})=>{if(d.lengthDelimited!==!1&&p.fork(),h.entries!=null)for(let m of h.entries)p.uint32(10),r.Wantlist.Entry.codec().encode(m,p);h.full!=null&&h.full!==!1&&(p.uint32(16),p.bool(h.full)),d.lengthDelimited!==!1&&p.ldelim()},(h,p)=>{let d={entries:[],full:!1},m=p==null?h.len:h.pos+p;for(;h.pos<m;){let g=h.uint32();switch(g>>>3){case 1:d.entries.push(r.Wantlist.Entry.codec().decode(h,h.uint32()));break;case 2:d.full=h.bool();break;default:h.skipType(g&7);break}}return d})),f),a.encode=h=>pe(h,a.codec()),a.decode=h=>de(h,a.codec())})(e=r.Wantlist||(r.Wantlist={}));let t;(function(a){let c;a.codec=()=>(c==null&&(c=me((l,u,f={})=>{f.lengthDelimited!==!1&&u.fork(),l.prefix!=null&&l.prefix.byteLength>0&&(u.uint32(10),u.bytes(l.prefix)),l.data!=null&&l.data.byteLength>0&&(u.uint32(18),u.bytes(l.data)),f.lengthDelimited!==!1&&u.ldelim()},(l,u)=>{let f={prefix:new Uint8Array(0),data:new Uint8Array(0)},h=u==null?l.len:l.pos+u;for(;l.pos<h;){let p=l.uint32();switch(p>>>3){case 1:f.prefix=l.bytes();break;case 2:f.data=l.bytes();break;default:l.skipType(p&7);break}}return f})),c),a.encode=l=>pe(l,a.codec()),a.decode=l=>de(l,a.codec())})(t=r.Block||(r.Block={}));let n;(function(a){a.Have="Have",a.DontHave="DontHave"})(n=r.BlockPresenceType||(r.BlockPresenceType={}));let s;(function(a){a[a.Have=0]="Have",a[a.DontHave=1]="DontHave"})(s||(s={})),function(a){a.codec=()=>Pt(s)}(n=r.BlockPresenceType||(r.BlockPresenceType={}));let i;(function(a){let c;a.codec=()=>(c==null&&(c=me((l,u,f={})=>{f.lengthDelimited!==!1&&u.fork(),l.cid!=null&&l.cid.byteLength>0&&(u.uint32(10),u.bytes(l.cid)),l.type!=null&&s[l.type]!==0&&(u.uint32(16),r.BlockPresenceType.codec().encode(l.type,u)),f.lengthDelimited!==!1&&u.ldelim()},(l,u)=>{let f={cid:new Uint8Array(0),type:n.Have},h=u==null?l.len:l.pos+u;for(;l.pos<h;){let p=l.uint32();switch(p>>>3){case 1:f.cid=l.bytes();break;case 2:f.type=r.BlockPresenceType.codec().decode(l);break;default:l.skipType(p&7);break}}return f})),c),a.encode=l=>pe(l,a.codec()),a.decode=l=>de(l,a.codec())})(i=r.BlockPresence||(r.BlockPresence={}));let o;r.codec=()=>(o==null&&(o=me((a,c,l={})=>{if(l.lengthDelimited!==!1&&c.fork(),a.wantlist!=null&&(c.uint32(10),r.Wantlist.codec().encode(a.wantlist,c)),a.blocks!=null)for(let u of a.blocks)c.uint32(18),c.bytes(u);if(a.payload!=null)for(let u of a.payload)c.uint32(26),r.Block.codec().encode(u,c);if(a.blockPresences!=null)for(let u of a.blockPresences)c.uint32(34),r.BlockPresence.codec().encode(u,c);a.pendingBytes!=null&&a.pendingBytes!==0&&(c.uint32(40),c.int32(a.pendingBytes)),l.lengthDelimited!==!1&&c.ldelim()},(a,c)=>{let l={blocks:[],payload:[],blockPresences:[],pendingBytes:0},u=c==null?a.len:a.pos+c;for(;a.pos<u;){let f=a.uint32();switch(f>>>3){case 1:l.wantlist=r.Wantlist.codec().decode(a,a.uint32());break;case 2:l.blocks.push(a.bytes());break;case 3:l.payload.push(r.Block.codec().decode(a,a.uint32()));break;case 4:l.blockPresences.push(r.BlockPresence.codec().decode(a,a.uint32()));break;case 5:l.pendingBytes=a.int32();break;default:a.skipType(f&7);break}}return l})),o),r.encode=a=>pe(a,r.codec()),r.decode=a=>de(a,r.codec())})(Hr||(Hr={}));var Is=class{full;wantlist;blocks;blockPresences;pendingBytes;constructor(e){this.full=e,this.wantlist=new Map,this.blocks=new Map,this.blockPresences=new Map,this.pendingBytes=0}get empty(){return this.blocks.size===0&&this.wantlist.size===0&&this.blockPresences.size===0}addEntry(e,t,n,s,i){n==null&&(n=Is.WantType.Block);let o=e.toString(Xe),a=this.wantlist.get(o);a!=null?(a.wantType===n&&(a.priority=t),s===!0&&(a.cancel=!!s),i===!0&&(a.sendDontHave=!!i),n===Is.WantType.Block&&a.wantType===Is.WantType.Have&&(a.wantType=n)):this.wantlist.set(o,new Bi(e,t,n,s,i))}addBlock(e,t){let n=e.toString(Xe);this.blocks.set(n,t)}addHave(e){let t=e.toString(Xe);this.blockPresences.has(t)||this.blockPresences.set(t,Is.BlockPresenceType.Have)}addDontHave(e){let t=e.toString(Xe);this.blockPresences.has(t)||this.blockPresences.set(t,Is.BlockPresenceType.DontHave)}cancel(e){let t=e.toString(Xe);this.wantlist.delete(t),this.addEntry(e,0,Is.WantType.Block,!0,!1)}setPendingBytes(e){this.pendingBytes=e}serializeToBitswap100(){return Hr.encode({wantlist:{entries:Array.from(this.wantlist.values()).map(e=>({block:e.cid.bytes,priority:Number(e.priority),cancel:!!e.cancel,wantType:Hr.Wantlist.WantType.Block,sendDontHave:!1})),full:!!this.full},blocks:Array.from(this.blocks.values())})}serializeToBitswap110(){let e={wantlist:{entries:Array.from(this.wantlist.values()).map(t=>({block:t.cid.bytes,priority:Number(t.priority),wantType:t.wantType,cancel:!!t.cancel,sendDontHave:!!t.sendDontHave})),full:!!this.full},blockPresences:[],payload:[],pendingBytes:this.pendingBytes,blocks:[]};for(let[t,n]of this.blocks.entries()){let s=je.parse(t),i=s.version,o=s.code,a=s.multihash.code,c=s.multihash.digest.length,l=_9([i,o,a,c]);e.payload.push({prefix:l,data:n})}for(let[t,n]of this.blockPresences)e.blockPresences.push({cid:je.parse(t).bytes,type:n});return this.pendingBytes>0&&(e.pendingBytes=this.pendingBytes),Hr.encode(e)}equals(e){return!(this.full!==e.full||this.pendingBytes!==e.pendingBytes||!l0(this.wantlist,e.wantlist)||!l0(this.blocks,e.blocks)||!l0(this.blockPresences,e.blockPresences))}get[Symbol.toStringTag](){let e=Array.from(this.wantlist.keys()),t=Array.from(this.blocks.keys());return`BitswapMessage <full: ${this.full}, list: ${e}, blocks: ${t}>`}},Kt=Is;gt(Kt,"Entry",Bi),gt(Kt,"WantType",{Block:Hr.Wantlist.WantType.Block,Have:Hr.Wantlist.WantType.Have}),gt(Kt,"BlockPresenceType",{Have:Hr.BlockPresenceType.Have,DontHave:Hr.BlockPresenceType.DontHave}),gt(Kt,"deserialize",async(e,t)=>{let n=Hr.decode(e),s=n.wantlist?.full===!0,i=new Is(s);return n.wantlist?.entries.forEach(o=>{if(o.block==null)return;let a=je.decode(o.block);i.addEntry(a,o.priority??0,o.wantType,!!o.cancel,!!o.sendDontHave)}),n.blockPresences.forEach(o=>{if(o.cid==null)return;let a=je.decode(o.cid);o.type===Is.BlockPresenceType.Have?i.addHave(a):i.addDontHave(a)}),n.blocks.length>0?(await Promise.all(n.blocks.map(async o=>{let a=await c0.digest(o),c=je.createV0(a);i.addBlock(c,o)})),i):(n.payload.length>0&&(await Promise.all(n.payload.map(async o=>{if(o.prefix==null||o.data==null)return;let a=(0,aw.default)(o.prefix),c=a[0],l=a[1],u=a[2],f=u===c0.code?c0:await t?.getHasher(u);if(f==null)throw new E("Unknown hash algorithm","ERR_UNKNOWN_HASH_ALG");let h=await f.digest(o.data),p=je.create(c,l,h);i.addBlock(p,o.data)})),i.setPendingBytes(n.pendingBytes)),i)}),gt(Kt,"blockPresenceSize",e=>e.bytes.length+1);var cw={Block:Hr.Wantlist.WantType.Block,Have:Hr.Wantlist.WantType.Have},dF=(r,e)=>Array.prototype.slice.call(e,0).sort((t,n)=>{let s=r(t),i=r(n);return s<i?-1:s>i?1:0}),oi=class{set;_stats;constructor(e,t){this.set=t!=null?Ss({name:"ipfs_bitswap_wantlist",metrics:t.metrics}):new Map,this._stats=e}get length(){return this.set.size}add(e,t,n){let s=e.toString(Xe),i=this.set.get(s);i!=null?(i.inc(),i.priority=t,i.wantType===cw.Have&&n===cw.Block&&(i.wantType=n)):(this.set.set(s,new Yo(e,t,n)),this._stats!=null&&this._stats.push(void 0,"wantListSize",1))}remove(e){let t=e.toString(Xe),n=this.set.get(t);n!=null&&(n.dec(),!n.hasRefs()&&(this.set.delete(t),this._stats!=null&&this._stats.push(void 0,"wantListSize",-1)))}removeForce(e){this.set.has(e)&&this.set.delete(e)}forEach(e){this.set.forEach(e)}entries(){return this.set.entries()}sortedEntries(){return new Map(dF(e=>e[1].key,Array.from(this.set.entries())))}contains(e){let t=e.toString(Xe);return this.set.has(t)}get(e){let t=e.toString(Xe);return this.set.get(t)}};gt(oi,"Entry",Yo);var m0=class{partner;wantlist;exchangeCount;accounting;lastExchange;constructor(e){this.partner=e,this.wantlist=new oi,this.exchangeCount=0,this.accounting={bytesSent:0,bytesRecv:0}}sentBytes(e){this.exchangeCount++,this.lastExchange=new Date().getTime(),this.accounting.bytesSent+=e}receivedBytes(e){this.exchangeCount++,this.lastExchange=new Date().getTime(),this.accounting.bytesRecv+=e}wants(e,t,n){this.wantlist.add(e,t,n)}cancelWant(e){this.wantlist.remove(e)}wantlistContains(e){return this.wantlist.get(e)}debtRatio(){return this.accounting.bytesSent/(this.accounting.bytesRecv+1)}};var ku=class extends Map{_cmp;_keys;constructor(e,t){super(),this._cmp=t??this._defaultSort,this._keys=[];for(let[n,s]of e??[])this.set(n,s)}update(e){if(e<0||e>=this._keys.length)return;let t=this._keys[e];this._keys.splice(e,1);let n=this._find(t);this._keys.splice(n,0,t)}set(e,t){if(this.has(e)){let s=this.indexOf(e);this._keys.splice(s,1)}super.set(e,t);let n=this._find(e);return this._keys.splice(n,0,e),this}clear(){super.clear(),this._keys=[]}delete(e){if(!this.has(e))return!1;let t=this.indexOf(e);return this._keys.splice(t,1),super.delete(e)}indexOf(e){if(!this.has(e))return-1;let t=this._find(e);if(this._keys[t]===e)return t;for(let n=1;n<this._keys.length;n++){if(this._keys[t+n]===e)return t+n;if(this._keys[t-n]===e)return t-n}return-1}_find(e){let t=0,n=this._keys.length;for(;t<n;){let s=t+n>>>1,i=this._kCmp(this._keys[s],e);if(i<0)t=s+1;else if(i>0)n=s;else return s}return t}*keys(){for(let e of this._keys)yield e}*values(){for(let e of this._keys)yield this.get(e)}*entries(){for(let e of this._keys)yield[e,this.get(e)]}*[Symbol.iterator](){yield*this.entries()}forEach(e,t=this){if(e!=null)for(let n of this._keys){let s=this.get(n);if(s==null)throw new Error("Value cannot be undefined");e.apply(t,[[n,s]])}}_defaultSort(e,t){return e[0]<t[0]?-1:t[0]<e[0]?1:0}_kCmp(e,t){return this._cmp([e,this.get(e)],[t,this.get(t)])}};var pF={hasNewInfo(){return!1},merge(){}},g0=class{_taskMerger;_byPeer;constructor(e=pF){this._taskMerger=e,this._byPeer=new ku([],y0.compare)}pushTasks(e,t){let n=this._byPeer.get(e.toString());n==null&&(n=new y0(e,this._taskMerger)),n.pushTasks(t),this._byPeer.set(e.toString(),n)}popTasks(e){let t=this._head();if(t===void 0)return{tasks:[],pendingSize:0};let{tasks:n,pendingSize:s}=t.popTasks(e);if(n.length===0)return{tasks:n,pendingSize:s};let i=t.peerId;return t.isIdle()?this._byPeer.delete(i.toString()):this._byPeer.update(0),{peerId:i,tasks:n,pendingSize:s}}_head(){if(this._byPeer.size!==0)for(let[,e]of this._byPeer)return e}remove(e,t){this._byPeer.get(t.toString())?.remove(e)}tasksDone(e,t){let n=this._byPeer.get(e.toString());if(n==null)return;let s=this._byPeer.indexOf(e.toString());for(let i of t)n.taskDone(i);this._byPeer.update(s)}},y0=class{peerId;_taskMerger;_activeTotalSize;_pending;_active;constructor(e,t){this.peerId=e,this._taskMerger=t,this._activeTotalSize=0,this._pending=new km,this._active=new Set}pushTasks(e){for(let t of e)this._pushTask(t)}_pushTask(e){if(!this._taskHasMoreInfoThanActiveTasks(e))return;let t=this._pending.get(e.topic);if(t!=null){e.priority>t.priority&&this._pending.updatePriority(e.topic,e.priority),this._taskMerger.merge(e,t);return}this._pending.add(e)}_taskHasMoreInfoThanActiveTasks(e){let t=[];for(let n of this._active)n.topic===e.topic&&t.push(n);return t.length===0?!0:this._taskMerger.hasNewInfo(e,t)}popTasks(e){let t=0,n=[],s=this._pending.tasks();for(let i=0;i<s.length&&t<e;i++){let o=s[i];n.push(o),t+=o.size,this._pending.delete(o.topic),this._activeTotalSize+=o.size,this._active.add(o)}return{tasks:n,pendingSize:this._pending.totalSize}}taskDone(e){this._active.has(e)&&(this._activeTotalSize-=e.size,this._active.delete(e))}remove(e){this._pending.delete(e)}isIdle(){return this._pending.length===0&&this._active.size===0}static compare(e,t){return e[1]._pending.length===0?1:t[1]._pending.length===0?-1:e[1]._activeTotalSize===t[1]._activeTotalSize?t[1]._pending.length-e[1]._pending.length:e[1]._activeTotalSize-t[1]._activeTotalSize}},km=class{_tasks;constructor(){this._tasks=new ku([],this._compare)}get length(){return this._tasks.size}get totalSize(){return[...this._tasks.values()].reduce((e,t)=>e+t.task.size,0)}get(e){return this._tasks?.get(e)?.task}add(e){this._tasks.set(e.topic,{created:Date.now(),task:e})}delete(e){this._tasks.delete(e)}tasks(){return[...this._tasks.values()].map(e=>e.task)}updatePriority(e,t){let n=this._tasks.get(e);if(n==null)return;let s=this._tasks.indexOf(e);n.task.priority=t,this._tasks.update(s)}_compare(e,t){return e[1].task.priority===t[1].task.priority?e[1].created-t[1].created:t[1].task.priority-e[1].task.priority}};var lw={hasNewInfo(r,e){let t=!1,n=!1;for(let s of e)s.data.haveBlock&&(t=!0),s.data.isWantBlock&&(n=!0);return!!(!n&&r.data.isWantBlock||!t&&r.data.haveBlock)},merge(r,e){let t=r.data,n=e.data;!n.haveBlock&&t.haveBlock&&(n.haveBlock=t.haveBlock,n.blockSize=t.blockSize),!n.isWantBlock&&t.isWantBlock&&(n.isWantBlock=!0,(!n.haveBlock||t.haveBlock)&&(n.haveBlock=t.haveBlock,e.size=r.size)),n.isWantBlock&&n.haveBlock&&(e.size=n.blockSize)}};var uw=Kt.WantType,mF=16*1024,gF=1024,b0=class{_log;blockstore;network;_stats;_opts;ledgerMap;_running;_requestQueue;constructor(e,t,n,s,i,o={}){this._log=Pn(e,"engine"),this.blockstore=t,this.network=n,this._stats=s,this._opts=this._processOpts(o),this.ledgerMap=Ss({name:"ipfs_bitswap_ledger_map",metrics:i.metrics}),this._running=!1,this._requestQueue=new g0(lw)}_processOpts(e){return{maxSizeReplaceHasWithBlock:gF,targetMessageSize:mF,...e}}_scheduleProcessTasks(){setTimeout(()=>{this._processTasks().catch(e=>{this._log.error("error processing stats",e)})})}async _processTasks(){if(!this._running)return;let{peerId:e,tasks:t,pendingSize:n}=this._requestQueue.popTasks(this._opts.targetMessageSize);if(t.length===0)return;let s=new Kt(!1);s.setPendingBytes(n);let i=[],o=new Map;for(let c of t){let l=je.parse(c.topic);c.data.haveBlock?c.data.isWantBlock?(i.push(l),o.set(c.topic,c.data)):s.addHave(l):s.addDontHave(l)}let a=await this._getBlocks(i);for(let[c,l]of o){let u=je.parse(c),f=a.get(c);f!=null?s.addBlock(u,f):l.sendDontHave&&s.addDontHave(u)}if(s.empty){e!=null&&this._requestQueue.tasksDone(e,t),this._scheduleProcessTasks();return}try{e!=null&&await this.network.sendMessage(e,s);for(let[c,l]of a.entries())e!=null&&this.messageSent(e,je.parse(c),l)}catch(c){this._log.error(c)}e!=null&&this._requestQueue.tasksDone(e,t),this._scheduleProcessTasks()}wantlistForPeer(e){let t=e.toString(),n=this.ledgerMap.get(t);return n!=null?n.wantlist.sortedEntries():new Map}ledgerForPeer(e){let t=e.toString(),n=this.ledgerMap.get(t);if(n!=null)return{peer:n.partner,value:n.debtRatio(),sent:n.accounting.bytesSent,recv:n.accounting.bytesRecv,exchanged:n.exchangeCount}}peers(){return Array.from(this.ledgerMap.values()).map(e=>e.partner)}receivedBlocks(e){if(e.length!==0){for(let t of this.ledgerMap.values())for(let{cid:n,block:s}of e){let i=t.wantlistContains(n);if(i==null)continue;let o=s.length,a=this._sendAsBlock(i.wantType,o),c=o;a||(c=Kt.blockPresenceSize(i.cid)),this._requestQueue.pushTasks(t.partner,[{topic:i.cid.toString(Xe),priority:i.priority,size:c,data:{blockSize:o,isWantBlock:a,haveBlock:!0,sendDontHave:!1}}])}this._scheduleProcessTasks()}}async messageReceived(e,t){let n=this._findOrCreate(e);if(t.empty)return;if(t.full&&(n.wantlist=new oi),this._updateBlockAccounting(t.blocks,n),t.wantlist.size===0){this._scheduleProcessTasks();return}let s=[],i=[];t.wantlist.forEach(o=>{o.cancel?(n.cancelWant(o.cid),s.push(o.cid)):(n.wants(o.cid,o.priority,o.wantType),i.push(o))}),this._cancelWants(e,s),await this._addWants(e,i),this._scheduleProcessTasks()}_cancelWants(e,t){for(let n of t)this._requestQueue.remove(n.toString(Xe),e)}async _addWants(e,t){let n=await this._getBlockSizes(t.map(i=>i.cid)),s=[];for(let i of t){let o=i.cid.toString(Xe),a=n.get(o);if(a==null)i.sendDontHave&&s.push({topic:o,priority:i.priority,size:Kt.blockPresenceSize(i.cid),data:{isWantBlock:i.wantType===uw.Block,blockSize:0,haveBlock:!1,sendDontHave:i.sendDontHave}});else{let c=this._sendAsBlock(i.wantType,a),l=a;c||(l=Kt.blockPresenceSize(i.cid)),s.push({topic:o,priority:i.priority,size:l,data:{isWantBlock:c,blockSize:a,haveBlock:!0,sendDontHave:i.sendDontHave}})}this._requestQueue.pushTasks(e,s)}}_sendAsBlock(e,t){return e===uw.Block||t<=this._opts.maxSizeReplaceHasWithBlock}async _getBlockSizes(e){let t=await this._getBlocks(e);return new Map([...t].map(([n,s])=>[n,s.length]))}async _getBlocks(e){let t=new Map;return await Promise.all(e.map(async n=>{try{let s=await this.blockstore.get(n);t.set(n.toString(Xe),s)}catch(s){s.code!=="ERR_NOT_FOUND"&&this._log.error("failed to query blockstore for %s: %s",n,s)}})),t}_updateBlockAccounting(e,t){for(let n of e.values())this._log("got block (%s bytes)",n.length),t.receivedBytes(n.length)}messageSent(e,t,n){let s=this._findOrCreate(e);s.sentBytes(n.length),s.wantlist.remove(t)}numBytesSentTo(e){return this._findOrCreate(e).accounting.bytesSent}numBytesReceivedFrom(e){return this._findOrCreate(e).accounting.bytesRecv}peerDisconnected(e){this.ledgerMap.delete(e.toString())}_findOrCreate(e){let t=e.toString(),n=this.ledgerMap.get(t);if(n!=null)return n;let s=new m0(e);return this.ledgerMap.set(t,s),this._stats!=null&&this._stats.push(t,"peerCount",1),s}start(){this._running=!0}stop(){this._running=!1}};var w0=Symbol.for("@libp2p/topology");function fw(r){return r!=null&&!!r[w0]}var hw=()=>{},Nm=class{min;max;peers;onConnect;onDisconnect;registrar;constructor(e){this.min=e.min??0,this.max=e.max??1/0,this.peers=new Set,this.onConnect=e.onConnect??hw,this.onDisconnect=e.onDisconnect??hw}get[Symbol.toStringTag](){return w0.toString()}[w0]=!0;async setRegistrar(e){this.registrar=e}disconnect(e){this.onDisconnect(e)}};function Fi(r){return new Nm(r)}var Nu=class extends Error{constructor(e,t){super(e??"The operation was aborted"),this.type="aborted",this.code=t??"ABORT_ERR"}};function dw(r){if(r!=null){if(typeof r[Symbol.iterator]=="function")return r[Symbol.iterator]();if(typeof r[Symbol.asyncIterator]=="function")return r[Symbol.asyncIterator]();if(typeof r.next=="function")return r}throw new Error("argument is not an iterator or iterable")}function bt(r,e,t){let n=t??{},s=dw(r);async function*i(){let o,a=()=>{o?.()};for(e.addEventListener("abort",a);;){let c;try{if(e.aborted){let{abortMessage:u,abortCode:f}=n;throw new Nu(u,f)}let l=new Promise((u,f)=>{o=()=>{let{abortMessage:h,abortCode:p}=n;f(new Nu(h,p))}});c=await Promise.race([l,s.next()]),o=null}catch(l){e.removeEventListener("abort",a);let u=l.type==="aborted"&&e.aborted;if(u&&n.onAbort!=null&&n.onAbort(r),typeof s.return=="function")try{let f=s.return();f instanceof Promise&&f.catch(h=>{n.onReturnError!=null&&n.onReturnError(h)})}catch(f){n.onReturnError!=null&&n.onReturnError(f)}if(u&&n.returnOnAbort===!0)return;throw l}if(c.done===!0)break;yield c.value}e.removeEventListener("abort",a)}return i()}function yF(r,e,t){return n=>r(bt(n,e,t))}function Er(r,e,t){return{sink:yF(r.sink,e,{...t,onAbort:void 0}),source:bt(r.source,e,t)}}function Ee(r,e){e==null&&(e=r.reduce((s,i)=>s+i.length,0));let t=on(e),n=0;for(let s of r)t.set(s,n),n+=s.length;return ri(t)}var mw=Symbol.for("@achingbrain/uint8arraylist");function pw(r,e){if(e==null||e<0)throw new RangeError("index is out of bounds");let t=0;for(let n of r){let s=t+n.byteLength;if(e<s)return{buf:n,index:e-t};t=s}throw new RangeError("index is out of bounds")}function x0(r){return!!r?.[mw]}var ye=class{constructor(...e){Object.defineProperty(this,mw,{value:!0}),this.bufs=[],this.length=0,e.length>0&&this.appendAll(e)}*[Symbol.iterator](){yield*this.bufs}get byteLength(){return this.length}append(...e){this.appendAll(e)}appendAll(e){let t=0;for(let n of e)if(n instanceof Uint8Array)t+=n.byteLength,this.bufs.push(n);else if(x0(n))t+=n.byteLength,this.bufs.push(...n.bufs);else throw new Error("Could not append value, must be an Uint8Array or a Uint8ArrayList");this.length+=t}prepend(...e){this.prependAll(e)}prependAll(e){let t=0;for(let n of e.reverse())if(n instanceof Uint8Array)t+=n.byteLength,this.bufs.unshift(n);else if(x0(n))t+=n.byteLength,this.bufs.unshift(...n.bufs);else throw new Error("Could not prepend value, must be an Uint8Array or a Uint8ArrayList");this.length+=t}get(e){let t=pw(this.bufs,e);return t.buf[t.index]}set(e,t){let n=pw(this.bufs,e);n.buf[n.index]=t}write(e,t=0){if(e instanceof Uint8Array)for(let n=0;n<e.length;n++)this.set(t+n,e[n]);else if(x0(e))for(let n=0;n<e.length;n++)this.set(t+n,e.get(n));else throw new Error("Could not write value, must be an Uint8Array or a Uint8ArrayList")}consume(e){if(e=Math.trunc(e),!(Number.isNaN(e)||e<=0)){if(e===this.byteLength){this.bufs=[],this.length=0;return}for(;this.bufs.length>0;)if(e>=this.bufs[0].byteLength)e-=this.bufs[0].byteLength,this.length-=this.bufs[0].byteLength,this.bufs.shift();else{this.bufs[0]=this.bufs[0].subarray(e),this.length-=e;break}}}slice(e,t){let{bufs:n,length:s}=this._subList(e,t);return Ee(n,s)}subarray(e,t){let{bufs:n,length:s}=this._subList(e,t);return n.length===1?n[0]:Ee(n,s)}sublist(e,t){let{bufs:n,length:s}=this._subList(e,t),i=new ye;return i.length=s,i.bufs=n,i}_subList(e,t){if(e=e??0,t=t??this.length,e<0&&(e=this.length+e),t<0&&(t=this.length+t),e<0||t>this.length)throw new RangeError("index is out of bounds");if(e===t)return{bufs:[],length:0};if(e===0&&t===this.length)return{bufs:[...this.bufs],length:this.length};let n=[],s=0;for(let i=0;i<this.bufs.length;i++){let o=this.bufs[i],a=s,c=a+o.byteLength;if(s=c,e>=c)continue;let l=e>=a&&e<c,u=t>a&&t<=c;if(l&&u){if(e===a&&t===c){n.push(o);break}let f=e-a;n.push(o.subarray(f,f+(t-e)));break}if(l){if(e===0){n.push(o);continue}n.push(o.subarray(e-a));continue}if(u){if(t===c){n.push(o);break}n.push(o.subarray(0,t-a));break}n.push(o)}return{bufs:n,length:t-e}}indexOf(e,t=0){if(!x0(e)&&!(e instanceof Uint8Array))throw new TypeError('The "value" argument must be a Uint8ArrayList or Uint8Array');let n=e instanceof Uint8Array?e:e.subarray();if(t=Number(t??0),isNaN(t)&&(t=0),t<0&&(t=this.length+t),t<0&&(t=0),e.length===0)return t>this.length?this.length:t;let s=n.byteLength;if(s===0)throw new TypeError("search must be at least 1 byte long");let i=256,o=new Int32Array(i);for(let f=0;f<i;f++)o[f]=-1;for(let f=0;f<s;f++)o[n[f]]=f;let a=o,c=this.byteLength-n.byteLength,l=n.byteLength-1,u;for(let f=t;f<=c;f+=u){u=0;for(let h=l;h>=0;h--){let p=this.get(f+h);if(n[h]!==p){u=Math.max(1,h-a[p]);break}}if(u===0)return f}return-1}getInt8(e){let t=this.subarray(e,e+1);return new DataView(t.buffer,t.byteOffset,t.byteLength).getInt8(0)}setInt8(e,t){let n=on(1);new DataView(n.buffer,n.byteOffset,n.byteLength).setInt8(0,t),this.write(n,e)}getInt16(e,t){let n=this.subarray(e,e+2);return new DataView(n.buffer,n.byteOffset,n.byteLength).getInt16(0,t)}setInt16(e,t,n){let s=ni(2);new DataView(s.buffer,s.byteOffset,s.byteLength).setInt16(0,t,n),this.write(s,e)}getInt32(e,t){let n=this.subarray(e,e+4);return new DataView(n.buffer,n.byteOffset,n.byteLength).getInt32(0,t)}setInt32(e,t,n){let s=ni(4);new DataView(s.buffer,s.byteOffset,s.byteLength).setInt32(0,t,n),this.write(s,e)}getBigInt64(e,t){let n=this.subarray(e,e+8);return new DataView(n.buffer,n.byteOffset,n.byteLength).getBigInt64(0,t)}setBigInt64(e,t,n){let s=ni(8);new DataView(s.buffer,s.byteOffset,s.byteLength).setBigInt64(0,t,n),this.write(s,e)}getUint8(e){let t=this.subarray(e,e+1);return new DataView(t.buffer,t.byteOffset,t.byteLength).getUint8(0)}setUint8(e,t){let n=on(1);new DataView(n.buffer,n.byteOffset,n.byteLength).setUint8(0,t),this.write(n,e)}getUint16(e,t){let n=this.subarray(e,e+2);return new DataView(n.buffer,n.byteOffset,n.byteLength).getUint16(0,t)}setUint16(e,t,n){let s=ni(2);new DataView(s.buffer,s.byteOffset,s.byteLength).setUint16(0,t,n),this.write(s,e)}getUint32(e,t){let n=this.subarray(e,e+4);return new DataView(n.buffer,n.byteOffset,n.byteLength).getUint32(0,t)}setUint32(e,t,n){let s=ni(4);new DataView(s.buffer,s.byteOffset,s.byteLength).setUint32(0,t,n),this.write(s,e)}getBigUint64(e,t){let n=this.subarray(e,e+8);return new DataView(n.buffer,n.byteOffset,n.byteLength).getBigUint64(0,t)}setBigUint64(e,t,n){let s=ni(8);new DataView(s.buffer,s.byteOffset,s.byteLength).setBigUint64(0,t,n),this.write(s,e)}getFloat32(e,t){let n=this.subarray(e,e+4);return new DataView(n.buffer,n.byteOffset,n.byteLength).getFloat32(0,t)}setFloat32(e,t,n){let s=ni(4);new DataView(s.buffer,s.byteOffset,s.byteLength).setFloat32(0,t,n),this.write(s,e)}getFloat64(e,t){let n=this.subarray(e,e+8);return new DataView(n.buffer,n.byteOffset,n.byteLength).getFloat64(0,t)}setFloat64(e,t,n){let s=ni(8);new DataView(s.buffer,s.byteOffset,s.byteLength).setFloat64(0,t,n),this.write(s,e)}equals(e){if(e==null||!(e instanceof ye)||e.bufs.length!==this.bufs.length)return!1;for(let t=0;t<this.bufs.length;t++)if(!be(this.bufs[t],e.bufs[t]))return!1;return!0}static fromUint8Arrays(e,t){let n=new ye;return n.bufs=e,t==null&&(t=e.reduce((s,i)=>s+i.byteLength,0)),n.length=t,n}};function E0(r){return r instanceof Uint8Array?{get(e){return r[e]},set(e,t){r[e]=t}}:{get(e){return r.get(e)},set(e,t){r.set(e,t)}}}var gw=4294967296,ln=class{constructor(e=0,t=0){this.hi=e,this.lo=t}toBigInt(e){if(e===!0)return BigInt(this.lo>>>0)+(BigInt(this.hi>>>0)<<32n);if(this.hi>>>31){let t=~this.lo+1>>>0,n=~this.hi>>>0;return t===0&&(n=n+1>>>0),-(BigInt(t)+(BigInt(n)<<32n))}return BigInt(this.lo>>>0)+(BigInt(this.hi>>>0)<<32n)}toNumber(e){return Number(this.toBigInt(e))}zzDecode(){let e=-(this.lo&1),t=((this.lo>>>1|this.hi<<31)^e)>>>0,n=(this.hi>>>1^e)>>>0;return new ln(n,t)}zzEncode(){let e=this.hi>>31,t=((this.hi<<1|this.lo>>>31)^e)>>>0,n=(this.lo<<1^e)>>>0;return new ln(t,n)}toBytes(e,t=0){let n=E0(e);for(;this.hi>0;)n.set(t++,this.lo&127|128),this.lo=(this.lo>>>7|this.hi<<25)>>>0,this.hi>>>=7;for(;this.lo>127;)n.set(t++,this.lo&127|128),this.lo=this.lo>>>7;n.set(t++,this.lo)}static fromBigInt(e){if(e===0n)return new ln;let t=e<0;t&&(e=-e);let n=Number(e>>32n)|0,s=Number(e-(BigInt(n)<<32n))|0;return t&&(n=~n>>>0,s=~s>>>0,++s>gw&&(s=0,++n>gw&&(n=0))),new ln(n,s)}static fromNumber(e){if(e===0)return new ln;let t=e<0;t&&(e=-e);let n=e>>>0,s=(e-n)/4294967296>>>0;return t&&(s=~s>>>0,n=~n>>>0,++n>4294967295&&(n=0,++s>4294967295&&(s=0))),new ln(s,n)}static fromBytes(e,t=0){let n=E0(e),s=new ln,i=0;if(e.length-t>4){for(;i<4;++i)if(s.lo=(s.lo|(n.get(t)&127)<<i*7)>>>0,n.get(t++)<128)return s;if(s.lo=(s.lo|(n.get(t)&127)<<28)>>>0,s.hi=(s.hi|(n.get(t)&127)>>4)>>>0,n.get(t++)<128)return s;i=0}else for(;i<4;++i){if(t>=e.length)throw RangeError(`index out of range: ${t} > ${e.length}`);if(s.lo=(s.lo|(n.get(t)&127)<<i*7)>>>0,n.get(t++)<128)return s}if(e.length-t>4){for(;i<5;++i)if(s.hi=(s.hi|(n.get(t)&127)<<i*7+3)>>>0,n.get(t++)<128)return s}else if(t<e.byteLength)for(;i<5;++i){if(t>=e.length)throw RangeError(`index out of range: ${t} > ${e.length}`);if(s.hi=(s.hi|(n.get(t)&127)<<i*7+3)>>>0,n.get(t++)<128)return s}throw RangeError("invalid varint encoding")}};var bF=Math.pow(2,7),wF=Math.pow(2,14),xF=Math.pow(2,21),EF=Math.pow(2,28),vF=Math.pow(2,35),_F=Math.pow(2,42),SF=Math.pow(2,49),AF=Math.pow(2,56),RF=Math.pow(2,63),un={encodingLength(r){return r<bF?1:r<wF?2:r<xF?3:r<EF?4:r<vF?5:r<_F?6:r<SF?7:r<AF?8:r<RF?9:10},encode(r,e,t=0){if(Number.MAX_SAFE_INTEGER!=null&&r>Number.MAX_SAFE_INTEGER)throw new RangeError("Could not encode varint");return e==null&&(e=on(un.encodingLength(r))),ln.fromNumber(r).toBytes(e,t),e},decode(r,e=0){return ln.fromBytes(r,e).toNumber(!0)}};function v0(r){return r[Symbol.asyncIterator]!=null}var _0=r=>{let e=un.encodingLength(r),t=on(e);return un.encode(r,t),_0.bytes=e,t};_0.bytes=0;function wt(r,e){e=e??{};let t=e.lengthEncoder??_0;function*n(s){let i=t(s.byteLength);i instanceof Uint8Array?yield i:yield*i,s instanceof Uint8Array?yield s:yield*s}return v0(r)?async function*(){for await(let s of r)yield*n(s)}():function*(){for(let s of r)yield*n(s)}()}wt.single=(r,e)=>{e=e??{};let t=e.lengthEncoder??_0;return new ye(t(r.byteLength),r)};var uc=W(Ko(),1);var IF=8,TF=1024*1024*4,Zo;(function(r){r[r.LENGTH=0]="LENGTH",r[r.DATA=1]="DATA"})(Zo||(Zo={}));var Om=r=>{let e=un.decode(r);return Om.bytes=un.encodingLength(e),e};Om.bytes=0;function kt(r,e){let t=new ye,n=Zo.LENGTH,s=-1,i=e?.lengthDecoder??Om,o=e?.maxLengthLength??IF,a=e?.maxDataLength??TF;function*c(){for(;t.byteLength>0;){if(n===Zo.LENGTH)try{if(s=i(t),s<0)throw(0,uc.default)(new Error("invalid message length"),"ERR_INVALID_MSG_LENGTH");if(s>a)throw(0,uc.default)(new Error("message length too long"),"ERR_MSG_DATA_TOO_LONG");let l=i.bytes;t.consume(l),e?.onLength!=null&&e.onLength(s),n=Zo.DATA}catch(l){if(l instanceof RangeError){if(t.byteLength>o)throw(0,uc.default)(new Error("message length length too long"),"ERR_MSG_LENGTH_TOO_LONG");break}throw l}if(n===Zo.DATA){if(t.byteLength<s)break;let l=t.sublist(0,s);t.consume(s),e?.onData!=null&&e.onData(l),yield l,n=Zo.LENGTH}}}return v0(r)?async function*(){for await(let l of r)t.append(l),yield*c();if(t.byteLength>0)throw(0,uc.default)(new Error("unexpected end of input"),"ERR_UNEXPECTED_EOF")}():function*(){for(let l of r)t.append(l),yield*c();if(t.byteLength>0)throw(0,uc.default)(new Error("unexpected end of input"),"ERR_UNEXPECTED_EOF")}()}kt.fromReader=(r,e)=>{let t=1,n=async function*(){for(;;)try{let{done:i,value:o}=await r.next(t);if(i===!0)return;o!=null&&(yield o)}catch(i){if(i.code==="ERR_UNDER_READ")return{done:!0,value:null};throw i}finally{t=1}}();return kt(n,{...e??{},onLength:i=>{t=i}})};var We=class extends Event{constructor(e,t){super(e),this.detail=t}};var Iw=W(_w(),1);var Sw=Math.pow(2,31)-1,Aw=1e3,Rw=1;var Mm="/ipfs/bitswap/1.0.0",Um="/ipfs/bitswap/1.1.0",Fm="/ipfs/bitswap/1.2.0",kF=1024,NF=1024,OF=3e4,A0=class{_log;_libp2p;_bitswap;_protocols;_stats;_running;_hashLoader;_maxInboundStreams;_maxOutboundStreams;_incomingStreamTimeout;_registrarIds;constructor(e,t,n,s={}){this._log=Pn(e.peerId,"network"),this._libp2p=e,this._bitswap=t,this._protocols=[Mm],s.b100Only!==!0&&(this._protocols.unshift(Um),this._protocols.unshift(Fm)),this._stats=n,this._running=!1,this._onPeerConnect=this._onPeerConnect.bind(this),this._onPeerDisconnect=this._onPeerDisconnect.bind(this),this._onConnection=this._onConnection.bind(this),this._hashLoader=s.hashLoader??{async getHasher(){throw new Error("Not implemented")}},this._maxInboundStreams=s.maxInboundStreams??kF,this._maxOutboundStreams=s.maxOutboundStreams??NF,this._incomingStreamTimeout=s.incomingStreamTimeout??OF}async start(){this._running=!0,await this._libp2p.handle(this._protocols,this._onConnection,{maxInboundStreams:this._maxInboundStreams,maxOutboundStreams:this._maxOutboundStreams});let e=Fi({onConnect:this._onPeerConnect,onDisconnect:this._onPeerDisconnect});this._registrarIds=[];for(let t of this._protocols)this._registrarIds.push(await this._libp2p.register(t,e));this._libp2p.getConnections().forEach(t=>{this._onPeerConnect(t.remotePeer)})}async stop(){if(this._running=!1,await this._libp2p.unhandle(this._protocols),this._registrarIds!=null){for(let e of this._registrarIds)this._libp2p.unregister(e);this._registrarIds=[]}}_onConnection(e){if(!this._running)return;let{stream:t,connection:n}=e,s=new Iw.TimeoutController(this._incomingStreamTimeout);Promise.resolve().then(async()=>{this._log("incoming new bitswap %s connection from %p",t.stat.protocol,n.remotePeer),await Re(bt(t.source,s.signal),i=>kt(i),async i=>{for await(let o of i){try{let a=await Kt.deserialize(o.subarray(),this._hashLoader);await this._bitswap._receiveMessage(n.remotePeer,a)}catch(a){this._bitswap._receiveError(a);break}s.reset()}})}).catch(i=>{this._log(i),t.abort(i)}).finally(()=>{s.clear(),t.close()})}_onPeerConnect(e){this._bitswap._onPeerConnected(e)}_onPeerDisconnect(e){this._bitswap._onPeerDisconnected(e)}findProviders(e,t={}){return t.onProgress?.(new We("bitswap:network:find-providers",e)),this._libp2p.contentRouting.findProviders(e,t)}async findAndConnect(e,t){await $r(Li(Qn(this.findProviders(e,t),async n=>this.connectTo(n.id,t).catch(s=>{this._log.error(s)})),3)).catch(n=>{this._log.error(n)})}async provide(e,t={}){t.onProgress?.(new We("bitswap:network:provide",e)),await this._libp2p.contentRouting.provide(e,t)}async sendMessage(e,t,n={}){if(!this._running)throw new Error("network isn't running");let s=e.toString();this._log("sendMessage to %s",s,t),n.onProgress?.(new We("bitswap:network:send-wantlist",e)),await this._writeMessage(e,t,n),this._updateSentStats(e,t.blocks)}async connectTo(e,t={}){if(!this._running)throw new Error("network isn't running");return t.onProgress?.(new We("bitswap:network:dial",e)),this._libp2p.dial(e,t)}_updateSentStats(e,t){let n=e.toString();if(this._stats!=null){for(let s of t.values())this._stats.push(n,"dataSent",s.length);this._stats.push(n,"blocksSent",t.size)}}async _writeMessage(e,t,n={}){let s=await this._libp2p.dialProtocol(e,[Fm,Um,Mm]);try{let i;switch(s.stat.protocol){case Mm:i=t.serializeToBitswap100();break;case Um:case Fm:i=t.serializeToBitswap110();break;default:throw new Error(`Unknown protocol: ${s.stat.protocol}`)}await Re([i],o=>wt(o),s)}catch(i){n.onProgress?.(new We("bitswap:network:send-wantlist:error",{peer:e,error:i})),this._log(i)}finally{s.close()}}};var Vw=W(fn(),1);var Uw=r=>`unwant:${M(r.multihash.bytes,"base64")}`,Fw=r=>`block:${M(r.multihash.bytes,"base64")}`,T0=class extends Vw.EventEmitter{_log;constructor(e){super(),this.setMaxListeners(Aw),this._log=Pn(e,"notif")}hasBlock(e,t){let n=Fw(e);this._log(n),this.emit(n,t)}async wantBlock(e,t={}){if(e==null)throw new Error("Not a valid cid");let n=Fw(e),s=Uw(e);return this._log(`wantBlock:${e}`),new Promise((i,o)=>{let a=()=>{this.removeListener(n,c),t.onProgress?.(new We("bitswap:want-block:unwant",e)),o(new Error(`Block for ${e} unwanted`))},c=l=>{this.removeListener(s,a),t.onProgress?.(new We("bitswap:want-block:block",e)),i(l)};this.once(s,a),this.once(n,c),t.signal?.addEventListener("abort",()=>{this.removeListener(n,c),this.removeListener(s,a),o(new Error(`Want for ${e} aborted`))})})}unwantBlock(e){let t=Uw(e);this._log(t),this.emit(t)}};var Gw=W(fn(),1);var $w=W(fn(),1),zm=W(Kw(),1),Lu=class extends $w.EventEmitter{_options;_queue;_stats;_frequencyLastTime;_frequencyAccumulators;_movingAverages;_enabled;_timeout;constructor(e,t){super(),this._options=t,this._queue=[],this._stats={},this._frequencyLastTime=Date.now(),this._frequencyAccumulators={},this._movingAverages={},this._update=this._update.bind(this),e.forEach(n=>{this._stats[n]=BigInt(0),this._movingAverages[n]={},this._options.movingAverageIntervals.forEach(s=>{(this._movingAverages[n][s]=(0,zm.default)(s)).push(this._frequencyLastTime,0)})}),this._enabled=this._options.enabled}enable(){this._enabled=!0}disable(){this._enabled=!1}stop(){this._timeout!=null&&clearTimeout(this._timeout)}get snapshot(){return Object.assign({},this._stats)}get movingAverages(){return Object.assign({},this._movingAverages)}push(e,t){this._enabled&&(this._queue.push([e,t,Date.now()]),this._resetComputeTimeout())}_resetComputeTimeout(){this._timeout!=null&&clearTimeout(this._timeout),this._timeout=setTimeout(this._update,this._nextTimeout())}_nextTimeout(){let e=this._queue.length/this._options.computeThrottleMaxQueueSize;return Math.max(this._options.computeThrottleTimeout*(1-e),0)}_update(){if(this._timeout=void 0,this._queue.length>0){let e;for(;this._queue.length>0;){let t=e=this._queue.shift();t!=null&&this._applyOp(t)}e!=null&&this._updateFrequency(e[2]),this.emit("update",this._stats)}}_updateFrequency(e){let t=e-this._frequencyLastTime;t>0&&Object.keys(this._stats).forEach(n=>{this._updateFrequencyFor(n,t,e)}),this._frequencyLastTime=e}_updateFrequencyFor(e,t,n){let s=this._frequencyAccumulators[e]??0;this._frequencyAccumulators[e]=0;let i=s/t*1e3,o=this._movingAverages[e];o==null&&(o=this._movingAverages[e]={}),this._options.movingAverageIntervals.forEach(a=>{let c=o[a];c==null&&(c=o[a]=(0,zm.default)(a)),c.push(n,i)})}_applyOp(e){let t=e[0],n=e[1];if(typeof n!="number")throw new Error(`invalid increment number: ${n}`);Object.prototype.hasOwnProperty.call(this._stats,t)||(this._stats[t]=BigInt(0)),this._stats[t]=BigInt(this._stats[t])+BigInt(n),this._frequencyAccumulators[t]==null&&(this._frequencyAccumulators[t]=0),this._frequencyAccumulators[t]+=n}};var Hw={enabled:!1,computeThrottleTimeout:1e3,computeThrottleMaxQueueSize:1e3,movingAverageIntervals:[60*1e3,5*60*1e3,15*60*1e3]},D0=class extends Gw.EventEmitter{_initialCounters;_options;_enabled;_global;_peers;constructor(e,t=[],n=Hw){super();let s=Object.assign({},Hw,n);if(typeof s.computeThrottleTimeout!="number")throw new Error("need computeThrottleTimeout");if(typeof s.computeThrottleMaxQueueSize!="number")throw new Error("need computeThrottleMaxQueueSize");this._initialCounters=t,this._options=s,this._enabled=this._options.enabled,this._global=new Lu(t,s),this._global.on("update",i=>this.emit("update",i)),this._peers=Ss({name:"ipfs_bitswap_stats_peers",metrics:e.metrics})}enable(){this._enabled=!0,this._options.enabled=!0,this._global.enable()}disable(){this._enabled=!1,this._options.enabled=!1,this._global.disable()}stop(){this._enabled=!1,this._global.stop();for(let e of this._peers)e[1].stop()}get snapshot(){return this._global.snapshot}get movingAverages(){return this._global.movingAverages}forPeer(e){let t=e.toString();return this._peers.get(t)}push(e,t,n){if(this._enabled&&(this._global.push(t,n),e!=null)){let s=this._peers.get(e);s==null&&(s=new Lu(this._initialCounters,this._options),this._peers.set(e,s)),s.push(t,n)}}disconnected(e){let t=e.toString(),n=this._peers.get(t);n!=null&&(n.stop(),this._peers.delete(t))}};var Ww=qF;function qF(r,e,t){var n=null,s=null,i=function(){n&&(clearTimeout(n),s=null,n=null)},o=function(){var c=s;i(),c&&c()},a=function(){if(!e)return r.apply(this,arguments);var c=this,l=arguments,u=t&&!n;if(i(),s=function(){r.apply(c,l)},n=setTimeout(function(){if(n=null,!u){var f=s;return s=null,f()}},e),u)return s()};return a.cancel=i,a.flush=o,a}var C0=class{peerId;refcnt;network;_entries;_log;constructor(e,t,n){this.peerId=t,this.network=n,this.refcnt=1,this._entries=[],this._log=Pn(e,"msgqueue"),this.sendEntries=Ww(this.sendEntries.bind(this),Rw)}addMessage(e,t={}){e.empty||this.send(e,t)}addEntries(e,t={}){this._entries=this._entries.concat(e),this.sendEntries(t)}sendEntries(e={}){if(this._entries.length===0)return;let t=new Kt(!1);this._entries.forEach(n=>{n.cancel===!0?t.cancel(n.cid):t.addEntry(n.cid,n.priority)}),this._entries=[],this.addMessage(t,e)}async send(e,t={}){try{await this.network.connectTo(this.peerId,t)}catch(n){this._log.error("cant connect to peer %p: %s",this.peerId,n.message);return}this._log("sending message to peer %p",this.peerId),this.network.sendMessage(this.peerId,e,t).catch(n=>{this._log.error("send error",n)})}};var P0=class{peers;wantlist;network;_peerId;_log;constructor(e,t,n,s){this.peers=Ss({name:"ipfs_bitswap_want_manager_peers",metrics:s.metrics}),this.wantlist=new oi(n,s),this.network=t,this._peerId=e,this._log=Pn(e,"want")}_addEntries(e,t,n,s={}){let i=e.map((o,a)=>new Kt.Entry(o,Sw-a,Kt.WantType.Block,t));i.forEach(o=>{o.cancel?n===!0?this.wantlist.removeForce(o.cid.toString(Xe)):this.wantlist.remove(o.cid):(this._log("adding to wantlist"),this.wantlist.add(o.cid,o.priority))});for(let o of this.peers.values())o.addEntries(i,s)}_startPeerHandler(e){let t=this.peers.get(e.toString());if(t!=null){t.refcnt++;return}t=new C0(this._peerId,e,this.network);let n=new Kt(!0);for(let s of this.wantlist.entries())n.addEntry(s[1].cid,s[1].priority);return t.addMessage(n),this.peers.set(e.toString(),t),t}_stopPeerHandler(e){let t=this.peers.get(e.toString());t!=null&&(t.refcnt--,!(t.refcnt>0)&&this.peers.delete(e.toString()))}wantBlocks(e,t={}){this._addEntries(e,!1,!1,t),t.signal?.addEventListener("abort",()=>{this.cancelWants(e)})}unwantBlocks(e){this._log("unwant blocks: %s",e.length),this._addEntries(e,!0,!0)}cancelWants(e){this._log("cancel wants: %s",e.length),this._addEntries(e,!0)}connectedPeers(){return Array.from(this.peers.keys())}connected(e){this._startPeerHandler(e)}disconnected(e){this._stopPeerHandler(e)}start(){}stop(){this.peers.forEach(e=>{this.disconnected(e.peerId)})}};var KF={async getHasher(){throw new Error("Not implemented")}},$F={maxInboundStreams:1024,maxOutboundStreams:1024,incomingStreamTimeout:3e4,hashLoader:KF,statsEnabled:!1,statsComputeThrottleTimeout:1e3,statsComputeThrottleMaxQueueSize:1e3},HF=["blocksReceived","dataReceived","dupBlksReceived","dupDataReceived","blocksSent","dataSent","providesBufferLength","wantListLength","peerCount"],k0=class{_libp2p;_log;stats;network;blockstore;engine;wm;notifications;started;constructor(e,t,n={}){this._libp2p=e,this._log=Pn(this.peerId),n=Object.assign({},$F,n),this.stats=new D0(e,HF,{enabled:n.statsEnabled,computeThrottleTimeout:n.statsComputeThrottleTimeout,computeThrottleMaxQueueSize:n.statsComputeThrottleMaxQueueSize}),this.network=new A0(e,this,this.stats,{hashLoader:n.hashLoader,maxInboundStreams:n.maxInboundStreams,maxOutboundStreams:n.maxOutboundStreams,incomingStreamTimeout:n.incomingStreamTimeout}),this.blockstore=t,this.engine=new b0(this.peerId,t,this.network,this.stats,e),this.wm=new P0(this.peerId,this.network,this.stats,e),this.notifications=new T0(this.peerId),this.started=!1}isStarted(){return this.started}get peerId(){return this._libp2p.peerId}async _receiveMessage(e,t){try{await this.engine.messageReceived(e,t)}catch{this._log("failed to receive message",t)}if(t.blocks.size===0)return;let n=[];for(let[s,i]of t.blocks.entries()){let o=je.parse(s);n.push({wasWanted:this.wm.wantlist.contains(o),cid:o,data:i})}this.wm.cancelWants(n.filter(({wasWanted:s})=>s).map(({cid:s})=>s)),await Promise.all(n.map(async({cid:s,wasWanted:i,data:o})=>{await this._handleReceivedBlock(e,s,o,i)}))}async _handleReceivedBlock(e,t,n,s){this._log("received block");let i=await this.blockstore.has(t);this._updateReceiveCounters(e.toString(),t,n,i),s&&await this.put(t,n)}_updateReceiveCounters(e,t,n,s){this.stats.push(e,"blocksReceived",1),this.stats.push(e,"dataReceived",n.length),s&&(this.stats.push(e,"dupBlksReceived",1),this.stats.push(e,"dupDataReceived",n.length))}_receiveError(e){this._log.error("ReceiveError",e)}_onPeerConnected(e){this.wm.connected(e)}_onPeerDisconnected(e){this.wm.disconnected(e),this.engine.peerDisconnected(e),this.stats.disconnected(e)}enableStats(){this.stats.enable()}disableStats(){this.stats.disable()}wantlistForPeer(e,t){return this.engine.wantlistForPeer(e)}ledgerForPeer(e){return this.engine.ledgerForPeer(e)}async want(e,t={}){let n=async(c,l)=>(this.wm.wantBlocks([c],l),this.notifications.wantBlock(c,l)),s=!1,i=async(c,l)=>{try{return await this.blockstore.get(c,l)}catch(u){if(u.code!=="ERR_NOT_FOUND")throw u;return s||(s=!0,this.network.findAndConnect(c,l).catch(f=>{this._log.error(f)})),await n(c,l)}},o=new AbortController,a=ot([o.signal,t.signal]);try{return await Promise.race([this.notifications.wantBlock(e,{...t,signal:a}),i(e,{...t,signal:a})])}finally{o.abort(),a.clear()}}unwant(e){let t=Array.isArray(e)?e:[e];this.wm.unwantBlocks(t),t.forEach(n=>{this.notifications.unwantBlock(n)})}cancelWants(e){this.wm.cancelWants(Array.isArray(e)?e:[e])}async put(e,t,n){await this.blockstore.put(e,t),this.notify(e,t)}async*putMany(e,t){yield*this.blockstore.putMany(_u(e,({cid:n,block:s})=>{this.notify(n,s)}),t)}notify(e,t,n={}){this.notifications.hasBlock(e,t),this.engine.receivedBlocks([{cid:e,block:t}]),this.network.provide(e,n).catch(s=>{this._log.error("Failed to provide: %s",s.message)})}getWantlist(){return this.wm.wantlist.entries()}get peers(){return this.engine.peers()}async start(){this.wm.start(),await this.network.start(),this.engine.start(),this.started=!0}async stop(){this.stats.stop(),this.wm.stop(),await this.network.stop(),this.engine.stop(),this.started=!1}};var Yw=(r,e,t={})=>new k0(r,e,t);var The=new Uint8Array(0);var Qw=(r,e)=>{if(r===e)return!0;if(r.byteLength!==e.byteLength)return!1;for(let t=0;t<r.byteLength;t++)if(r[t]!==e[t])return!1;return!0},ai=r=>{if(r instanceof Uint8Array&&r.constructor.name==="Uint8Array")return r;if(r instanceof ArrayBuffer)return new Uint8Array(r);if(ArrayBuffer.isView(r))return new Uint8Array(r.buffer,r.byteOffset,r.byteLength);throw new Error("Unknown type, must be binary type")};var WF=Zw,Xw=128,YF=127,QF=~YF,XF=Math.pow(2,31);function Zw(r,e,t){e=e||[],t=t||0;for(var n=t;r>=XF;)e[t++]=r&255|Xw,r/=128;for(;r&QF;)e[t++]=r&255|Xw,r>>>=7;return e[t]=r|0,Zw.bytes=t-n+1,e}var jF=qm,ZF=128,jw=127;function qm(r,n){var t=0,n=n||0,s=0,i=n,o,a=r.length;do{if(i>=a)throw qm.bytes=0,new RangeError("Could not decode varint");o=r[i++],t+=s<28?(o&jw)<<s:(o&jw)*Math.pow(2,s),s+=7}while(o>=ZF);return qm.bytes=i-n,t}var JF=Math.pow(2,7),eV=Math.pow(2,14),tV=Math.pow(2,21),rV=Math.pow(2,28),nV=Math.pow(2,35),sV=Math.pow(2,42),iV=Math.pow(2,49),oV=Math.pow(2,56),aV=Math.pow(2,63),cV=function(r){return r<JF?1:r<eV?2:r<tV?3:r<rV?4:r<nV?5:r<sV?6:r<iV?7:r<oV?8:r<aV?9:10},lV={encode:WF,decode:jF,encodingLength:cV},uV=lV,Bu=uV;var Mu=(r,e=0)=>[Bu.decode(r,e),Bu.decode.bytes],hc=(r,e,t=0)=>(Bu.encode(r,e,t),e),dc=r=>Bu.encodingLength(r);var Jo=(r,e)=>{let t=e.byteLength,n=dc(r),s=n+dc(t),i=new Uint8Array(s+t);return hc(r,i,0),hc(t,i,n),i.set(e,s),new pc(r,t,e,i)},Jw=r=>{let e=ai(r),[t,n]=Mu(e),[s,i]=Mu(e.subarray(n)),o=e.subarray(n+i);if(o.byteLength!==s)throw new Error("Incorrect length");return new pc(t,s,o,e)},ex=(r,e)=>{if(r===e)return!0;{let t=e;return r.code===t.code&&r.size===t.size&&t.bytes instanceof Uint8Array&&Qw(r.bytes,t.bytes)}},pc=class{constructor(e,t,n,s){this.code=e,this.size=t,this.digest=n,this.bytes=s}};var tx=0,fV="identity",rx=ai,hV=r=>Jo(tx,rx(r)),nx={code:tx,name:fV,encode:rx,digest:hV};var Hm=({name:r,code:e,encode:t})=>new $m(r,e,t),$m=class{constructor(e,t,n){this.name=e,this.code=t,this.encode=n}digest(e){if(e instanceof Uint8Array){let t=this.encode(e);return t instanceof Uint8Array?Jo(this.code,t):t.then(n=>Jo(this.code,n))}else throw Error("Unknown type, must be binary type")}};var sx=r=>async e=>new Uint8Array(await crypto.subtle.digest(r,e)),ix=Hm({name:"sha2-256",code:18,encode:sx("SHA-256")}),ox=Hm({name:"sha2-512",code:19,encode:sx("SHA-512")});var pV=["string","number","bigint","symbol"],mV=["Function","Generator","AsyncGenerator","GeneratorFunction","AsyncGeneratorFunction","AsyncFunction","Observable","Array","Buffer","Object","RegExp","Date","Error","Map","Set","WeakMap","WeakSet","ArrayBuffer","SharedArrayBuffer","DataView","Promise","URL","HTMLElement","Int8Array","Uint8Array","Uint8ClampedArray","Int16Array","Uint16Array","Int32Array","Uint32Array","Float32Array","Float64Array","BigInt64Array","BigUint64Array"];function ax(r){if(r===null)return"null";if(r===void 0)return"undefined";if(r===!0||r===!1)return"boolean";let e=typeof r;if(pV.includes(e))return e;if(e==="function")return"Function";if(Array.isArray(r))return"Array";if(gV(r))return"Buffer";let t=yV(r);return t||"Object"}function gV(r){return r&&r.constructor&&r.constructor.isBuffer&&r.constructor.isBuffer.call(null,r)}function yV(r){let e=Object.prototype.toString.call(r).slice(8,-1);if(mV.includes(e))return e}var I=class{constructor(e,t,n){this.major=e,this.majorEncoded=e<<5,this.name=t,this.terminal=n}toString(){return`Type[${this.major}].${this.name}`}compare(e){return this.major<e.major?-1:this.major>e.major?1:0}};I.uint=new I(0,"uint",!0);I.negint=new I(1,"negint",!0);I.bytes=new I(2,"bytes",!0);I.string=new I(3,"string",!0);I.array=new I(4,"array",!1);I.map=new I(5,"map",!1);I.tag=new I(6,"tag",!1);I.float=new I(7,"float",!0);I.false=new I(7,"false",!0);I.true=new I(7,"true",!0);I.null=new I(7,"null",!0);I.undefined=new I(7,"undefined",!0);I.break=new I(7,"break",!0);var U=class{constructor(e,t,n){this.type=e,this.value=t,this.encodedLength=n,this.encodedBytes=void 0,this.byteValue=void 0}toString(){return`Token[${this.type}].${this.value}`}};var mc=globalThis.process&&!globalThis.process.browser&&globalThis.Buffer&&typeof globalThis.Buffer.isBuffer=="function",bV=new TextDecoder,wV=new TextEncoder;function O0(r){return mc&&globalThis.Buffer.isBuffer(r)}function Uu(r){return r instanceof Uint8Array?O0(r)?new Uint8Array(r.buffer,r.byteOffset,r.byteLength):r:Uint8Array.from(r)}var fx=mc?(r,e,t)=>t-e>64?globalThis.Buffer.from(r.subarray(e,t)).toString("utf8"):lx(r,e,t):(r,e,t)=>t-e>64?bV.decode(r.subarray(e,t)):lx(r,e,t),L0=mc?r=>r.length>64?globalThis.Buffer.from(r):cx(r):r=>r.length>64?wV.encode(r):cx(r),Ts=r=>Uint8Array.from(r),gc=mc?(r,e,t)=>O0(r)?new Uint8Array(r.subarray(e,t)):r.slice(e,t):(r,e,t)=>r.slice(e,t),hx=mc?(r,e)=>(r=r.map(t=>t instanceof Uint8Array?t:globalThis.Buffer.from(t)),Uu(globalThis.Buffer.concat(r,e))):(r,e)=>{let t=new Uint8Array(e),n=0;for(let s of r)n+s.length>t.length&&(s=s.subarray(0,t.length-n)),t.set(s,n),n+=s.length;return t},dx=mc?r=>globalThis.Buffer.allocUnsafe(r):r=>new Uint8Array(r);function px(r,e){if(O0(r)&&O0(e))return r.compare(e);for(let t=0;t<r.length;t++)if(r[t]!==e[t])return r[t]<e[t]?-1:1;return 0}function cx(r,e=1/0){let t,n=r.length,s=null,i=[];for(let o=0;o<n;++o){if(t=r.charCodeAt(o),t>55295&&t<57344){if(!s){if(t>56319){(e-=3)>-1&&i.push(239,191,189);continue}else if(o+1===n){(e-=3)>-1&&i.push(239,191,189);continue}s=t;continue}if(t<56320){(e-=3)>-1&&i.push(239,191,189),s=t;continue}t=(s-55296<<10|t-56320)+65536}else s&&(e-=3)>-1&&i.push(239,191,189);if(s=null,t<128){if((e-=1)<0)break;i.push(t)}else if(t<2048){if((e-=2)<0)break;i.push(t>>6|192,t&63|128)}else if(t<65536){if((e-=3)<0)break;i.push(t>>12|224,t>>6&63|128,t&63|128)}else if(t<1114112){if((e-=4)<0)break;i.push(t>>18|240,t>>12&63|128,t>>6&63|128,t&63|128)}else throw new Error("Invalid code point")}return i}function lx(r,e,t){let n=[];for(;e<t;){let s=r[e],i=null,o=s>239?4:s>223?3:s>191?2:1;if(e+o<=t){let a,c,l,u;switch(o){case 1:s<128&&(i=s);break;case 2:a=r[e+1],(a&192)===128&&(u=(s&31)<<6|a&63,u>127&&(i=u));break;case 3:a=r[e+1],c=r[e+2],(a&192)===128&&(c&192)===128&&(u=(s&15)<<12|(a&63)<<6|c&63,u>2047&&(u<55296||u>57343)&&(i=u));break;case 4:a=r[e+1],c=r[e+2],l=r[e+3],(a&192)===128&&(c&192)===128&&(l&192)===128&&(u=(s&15)<<18|(a&63)<<12|(c&63)<<6|l&63,u>65535&&u<1114112&&(i=u))}}i===null?(i=65533,o=1):i>65535&&(i-=65536,n.push(i>>>10&1023|55296),i=56320|i&1023),n.push(i),e+=o}return Gm(n)}var ux=4096;function Gm(r){let e=r.length;if(e<=ux)return String.fromCharCode.apply(String,r);let t="",n=0;for(;n<e;)t+=String.fromCharCode.apply(String,r.slice(n,n+=ux));return t}var xV=256,Fu=class{constructor(e=xV){this.chunkSize=e,this.cursor=0,this.maxCursor=-1,this.chunks=[],this._initReuseChunk=null}reset(){this.cursor=0,this.maxCursor=-1,this.chunks.length&&(this.chunks=[]),this._initReuseChunk!==null&&(this.chunks.push(this._initReuseChunk),this.maxCursor=this._initReuseChunk.length-1)}push(e){let t=this.chunks[this.chunks.length-1];if(this.cursor+e.length<=this.maxCursor+1){let s=t.length-(this.maxCursor-this.cursor)-1;t.set(e,s)}else{if(t){let s=t.length-(this.maxCursor-this.cursor)-1;s<t.length&&(this.chunks[this.chunks.length-1]=t.subarray(0,s),this.maxCursor=this.cursor-1)}e.length<64&&e.length<this.chunkSize?(t=dx(this.chunkSize),this.chunks.push(t),this.maxCursor+=t.length,this._initReuseChunk===null&&(this._initReuseChunk=t),t.set(e,0)):(this.chunks.push(e),this.maxCursor+=e.length)}this.cursor+=e.length}toBytes(e=!1){let t;if(this.chunks.length===1){let n=this.chunks[0];e&&this.cursor>n.length/2?(t=this.cursor===n.length?n:n.subarray(0,this.cursor),this._initReuseChunk=null,this.chunks=[]):t=gc(n,0,this.cursor)}else t=hx(this.chunks,this.cursor);return e&&this.reset(),t}};var re="CBOR decode error:",yc="CBOR encode error:",Vu=[];Vu[23]=1;Vu[24]=2;Vu[25]=3;Vu[26]=5;Vu[27]=9;function ci(r,e,t){if(r.length-e<t)throw new Error(`${re} not enough data for type`)}var cr=[24,256,65536,4294967296,BigInt("18446744073709551616")];function hn(r,e,t){ci(r,e,1);let n=r[e];if(t.strict===!0&&n<cr[0])throw new Error(`${re} integer encoded in more bytes than necessary (strict decode)`);return n}function dn(r,e,t){ci(r,e,2);let n=r[e]<<8|r[e+1];if(t.strict===!0&&n<cr[1])throw new Error(`${re} integer encoded in more bytes than necessary (strict decode)`);return n}function pn(r,e,t){ci(r,e,4);let n=r[e]*16777216+(r[e+1]<<16)+(r[e+2]<<8)+r[e+3];if(t.strict===!0&&n<cr[2])throw new Error(`${re} integer encoded in more bytes than necessary (strict decode)`);return n}function mn(r,e,t){ci(r,e,8);let n=r[e]*16777216+(r[e+1]<<16)+(r[e+2]<<8)+r[e+3],s=r[e+4]*16777216+(r[e+5]<<16)+(r[e+6]<<8)+r[e+7],i=(BigInt(n)<<BigInt(32))+BigInt(s);if(t.strict===!0&&i<cr[3])throw new Error(`${re} integer encoded in more bytes than necessary (strict decode)`);if(i<=Number.MAX_SAFE_INTEGER)return Number(i);if(t.allowBigInt===!0)return i;throw new Error(`${re} integers outside of the safe integer range are not supported`)}function mx(r,e,t,n){return new U(I.uint,hn(r,e+1,n),2)}function gx(r,e,t,n){return new U(I.uint,dn(r,e+1,n),3)}function yx(r,e,t,n){return new U(I.uint,pn(r,e+1,n),5)}function bx(r,e,t,n){return new U(I.uint,mn(r,e+1,n),9)}function Nn(r,e){return gr(r,0,e.value)}function gr(r,e,t){if(t<cr[0]){let n=Number(t);r.push([e|n])}else if(t<cr[1]){let n=Number(t);r.push([e|24,n])}else if(t<cr[2]){let n=Number(t);r.push([e|25,n>>>8,n&255])}else if(t<cr[3]){let n=Number(t);r.push([e|26,n>>>24&255,n>>>16&255,n>>>8&255,n&255])}else{let n=BigInt(t);if(n<cr[4]){let s=[e|27,0,0,0,0,0,0,0],i=Number(n&BigInt(4294967295)),o=Number(n>>BigInt(32)&BigInt(4294967295));s[8]=i&255,i=i>>8,s[7]=i&255,i=i>>8,s[6]=i&255,i=i>>8,s[5]=i&255,s[4]=o&255,o=o>>8,s[3]=o&255,o=o>>8,s[2]=o&255,o=o>>8,s[1]=o&255,r.push(s)}else throw new Error(`${re} encountered BigInt larger than allowable range`)}}Nn.encodedSize=function(e){return gr.encodedSize(e.value)};gr.encodedSize=function(e){return e<cr[0]?1:e<cr[1]?2:e<cr[2]?3:e<cr[3]?5:9};Nn.compareTokens=function(e,t){return e.value<t.value?-1:e.value>t.value?1:0};function wx(r,e,t,n){return new U(I.negint,-1-hn(r,e+1,n),2)}function xx(r,e,t,n){return new U(I.negint,-1-dn(r,e+1,n),3)}function Ex(r,e,t,n){return new U(I.negint,-1-pn(r,e+1,n),5)}var Wm=BigInt(-1),vx=BigInt(1);function _x(r,e,t,n){let s=mn(r,e+1,n);if(typeof s!="bigint"){let i=-1-s;if(i>=Number.MIN_SAFE_INTEGER)return new U(I.negint,i,9)}if(n.allowBigInt!==!0)throw new Error(`${re} integers outside of the safe integer range are not supported`);return new U(I.negint,Wm-BigInt(s),9)}function B0(r,e){let t=e.value,n=typeof t=="bigint"?t*Wm-vx:t*-1-1;gr(r,e.type.majorEncoded,n)}B0.encodedSize=function(e){let t=e.value,n=typeof t=="bigint"?t*Wm-vx:t*-1-1;return n<cr[0]?1:n<cr[1]?2:n<cr[2]?3:n<cr[3]?5:9};B0.compareTokens=function(e,t){return e.value<t.value?1:e.value>t.value?-1:0};function zu(r,e,t,n){ci(r,e,t+n);let s=gc(r,e+t,e+t+n);return new U(I.bytes,s,t+n)}function Sx(r,e,t,n){return zu(r,e,1,t)}function Ax(r,e,t,n){return zu(r,e,2,hn(r,e+1,n))}function Rx(r,e,t,n){return zu(r,e,3,dn(r,e+1,n))}function Ix(r,e,t,n){return zu(r,e,5,pn(r,e+1,n))}function Tx(r,e,t,n){let s=mn(r,e+1,n);if(typeof s=="bigint")throw new Error(`${re} 64-bit integer bytes lengths not supported`);return zu(r,e,9,s)}function M0(r){return r.encodedBytes===void 0&&(r.encodedBytes=r.type===I.string?L0(r.value):r.value),r.encodedBytes}function bc(r,e){let t=M0(e);gr(r,e.type.majorEncoded,t.length),r.push(t)}bc.encodedSize=function(e){let t=M0(e);return gr.encodedSize(t.length)+t.length};bc.compareTokens=function(e,t){return vV(M0(e),M0(t))};function vV(r,e){return r.length<e.length?-1:r.length>e.length?1:px(r,e)}function qu(r,e,t,n,s){let i=t+n;ci(r,e,i);let o=new U(I.string,fx(r,e+t,e+i),i);return s.retainStringBytes===!0&&(o.byteValue=gc(r,e+t,e+i)),o}function Dx(r,e,t,n){return qu(r,e,1,t,n)}function Cx(r,e,t,n){return qu(r,e,2,hn(r,e+1,n),n)}function Px(r,e,t,n){return qu(r,e,3,dn(r,e+1,n),n)}function kx(r,e,t,n){return qu(r,e,5,pn(r,e+1,n),n)}function Nx(r,e,t,n){let s=mn(r,e+1,n);if(typeof s=="bigint")throw new Error(`${re} 64-bit integer string lengths not supported`);return qu(r,e,9,s,n)}var Ox=bc;function wc(r,e,t,n){return new U(I.array,n,t)}function Lx(r,e,t,n){return wc(r,e,1,t)}function Bx(r,e,t,n){return wc(r,e,2,hn(r,e+1,n))}function Mx(r,e,t,n){return wc(r,e,3,dn(r,e+1,n))}function Ux(r,e,t,n){return wc(r,e,5,pn(r,e+1,n))}function Fx(r,e,t,n){let s=mn(r,e+1,n);if(typeof s=="bigint")throw new Error(`${re} 64-bit integer array lengths not supported`);return wc(r,e,9,s)}function Vx(r,e,t,n){if(n.allowIndefinite===!1)throw new Error(`${re} indefinite length items not allowed`);return wc(r,e,1,1/0)}function U0(r,e){gr(r,I.array.majorEncoded,e.value)}U0.compareTokens=Nn.compareTokens;U0.encodedSize=function(e){return gr.encodedSize(e.value)};function xc(r,e,t,n){return new U(I.map,n,t)}function zx(r,e,t,n){return xc(r,e,1,t)}function qx(r,e,t,n){return xc(r,e,2,hn(r,e+1,n))}function Kx(r,e,t,n){return xc(r,e,3,dn(r,e+1,n))}function $x(r,e,t,n){return xc(r,e,5,pn(r,e+1,n))}function Hx(r,e,t,n){let s=mn(r,e+1,n);if(typeof s=="bigint")throw new Error(`${re} 64-bit integer map lengths not supported`);return xc(r,e,9,s)}function Gx(r,e,t,n){if(n.allowIndefinite===!1)throw new Error(`${re} indefinite length items not allowed`);return xc(r,e,1,1/0)}function F0(r,e){gr(r,I.map.majorEncoded,e.value)}F0.compareTokens=Nn.compareTokens;F0.encodedSize=function(e){return gr.encodedSize(e.value)};function Wx(r,e,t,n){return new U(I.tag,t,1)}function Yx(r,e,t,n){return new U(I.tag,hn(r,e+1,n),2)}function Qx(r,e,t,n){return new U(I.tag,dn(r,e+1,n),3)}function Xx(r,e,t,n){return new U(I.tag,pn(r,e+1,n),5)}function jx(r,e,t,n){return new U(I.tag,mn(r,e+1,n),9)}function V0(r,e){gr(r,I.tag.majorEncoded,e.value)}V0.compareTokens=Nn.compareTokens;V0.encodedSize=function(e){return gr.encodedSize(e.value)};var TV=20,DV=21,CV=22,PV=23;function Zx(r,e,t,n){if(n.allowUndefined===!1)throw new Error(`${re} undefined values are not supported`);return n.coerceUndefinedToNull===!0?new U(I.null,null,1):new U(I.undefined,void 0,1)}function Jx(r,e,t,n){if(n.allowIndefinite===!1)throw new Error(`${re} indefinite length items not allowed`);return new U(I.break,void 0,1)}function Ym(r,e,t){if(t){if(t.allowNaN===!1&&Number.isNaN(r))throw new Error(`${re} NaN values are not supported`);if(t.allowInfinity===!1&&(r===1/0||r===-1/0))throw new Error(`${re} Infinity values are not supported`)}return new U(I.float,r,e)}function eE(r,e,t,n){return Ym(Qm(r,e+1),3,n)}function tE(r,e,t,n){return Ym(Xm(r,e+1),5,n)}function rE(r,e,t,n){return Ym(oE(r,e+1),9,n)}function z0(r,e,t){let n=e.value;if(n===!1)r.push([I.float.majorEncoded|TV]);else if(n===!0)r.push([I.float.majorEncoded|DV]);else if(n===null)r.push([I.float.majorEncoded|CV]);else if(n===void 0)r.push([I.float.majorEncoded|PV]);else{let s,i=!1;(!t||t.float64!==!0)&&(sE(n),s=Qm(Zn,1),n===s||Number.isNaN(n)?(Zn[0]=249,r.push(Zn.slice(0,3)),i=!0):(iE(n),s=Xm(Zn,1),n===s&&(Zn[0]=250,r.push(Zn.slice(0,5)),i=!0))),i||(kV(n),s=oE(Zn,1),Zn[0]=251,r.push(Zn.slice(0,9)))}}z0.encodedSize=function(e,t){let n=e.value;if(n===!1||n===!0||n===null||n===void 0)return 1;if(!t||t.float64!==!0){sE(n);let s=Qm(Zn,1);if(n===s||Number.isNaN(n))return 3;if(iE(n),s=Xm(Zn,1),n===s)return 5}return 9};var nE=new ArrayBuffer(9),On=new DataView(nE,1),Zn=new Uint8Array(nE,0);function sE(r){if(r===1/0)On.setUint16(0,31744,!1);else if(r===-1/0)On.setUint16(0,64512,!1);else if(Number.isNaN(r))On.setUint16(0,32256,!1);else{On.setFloat32(0,r);let e=On.getUint32(0),t=(e&2139095040)>>23,n=e&8388607;if(t===255)On.setUint16(0,31744,!1);else if(t===0)On.setUint16(0,(r&2147483648)>>16|n>>13,!1);else{let s=t-127;s<-24?On.setUint16(0,0):s<-14?On.setUint16(0,(e&2147483648)>>16|1<<24+s,!1):On.setUint16(0,(e&2147483648)>>16|s+15<<10|n>>13,!1)}}}function Qm(r,e){if(r.length-e<2)throw new Error(`${re} not enough data for float16`);let t=(r[e]<<8)+r[e+1];if(t===31744)return 1/0;if(t===64512)return-1/0;if(t===32256)return NaN;let n=t>>10&31,s=t&1023,i;return n===0?i=s*2**-24:n!==31?i=(s+1024)*2**(n-25):i=s===0?1/0:NaN,t&32768?-i:i}function iE(r){On.setFloat32(0,r,!1)}function Xm(r,e){if(r.length-e<4)throw new Error(`${re} not enough data for float32`);let t=(r.byteOffset||0)+e;return new DataView(r.buffer,t,4).getFloat32(0,!1)}function kV(r){On.setFloat64(0,r,!1)}function oE(r,e){if(r.length-e<8)throw new Error(`${re} not enough data for float64`);let t=(r.byteOffset||0)+e;return new DataView(r.buffer,t,8).getFloat64(0,!1)}z0.compareTokens=Nn.compareTokens;function Ye(r,e,t){throw new Error(`${re} encountered invalid minor (${t}) for major ${r[e]>>>5}`)}function q0(r){return()=>{throw new Error(`${re} ${r}`)}}var q=[];for(let r=0;r<=23;r++)q[r]=Ye;q[24]=mx;q[25]=gx;q[26]=yx;q[27]=bx;q[28]=Ye;q[29]=Ye;q[30]=Ye;q[31]=Ye;for(let r=32;r<=55;r++)q[r]=Ye;q[56]=wx;q[57]=xx;q[58]=Ex;q[59]=_x;q[60]=Ye;q[61]=Ye;q[62]=Ye;q[63]=Ye;for(let r=64;r<=87;r++)q[r]=Sx;q[88]=Ax;q[89]=Rx;q[90]=Ix;q[91]=Tx;q[92]=Ye;q[93]=Ye;q[94]=Ye;q[95]=q0("indefinite length bytes/strings are not supported");for(let r=96;r<=119;r++)q[r]=Dx;q[120]=Cx;q[121]=Px;q[122]=kx;q[123]=Nx;q[124]=Ye;q[125]=Ye;q[126]=Ye;q[127]=q0("indefinite length bytes/strings are not supported");for(let r=128;r<=151;r++)q[r]=Lx;q[152]=Bx;q[153]=Mx;q[154]=Ux;q[155]=Fx;q[156]=Ye;q[157]=Ye;q[158]=Ye;q[159]=Vx;for(let r=160;r<=183;r++)q[r]=zx;q[184]=qx;q[185]=Kx;q[186]=$x;q[187]=Hx;q[188]=Ye;q[189]=Ye;q[190]=Ye;q[191]=Gx;for(let r=192;r<=215;r++)q[r]=Wx;q[216]=Yx;q[217]=Qx;q[218]=Xx;q[219]=jx;q[220]=Ye;q[221]=Ye;q[222]=Ye;q[223]=Ye;for(let r=224;r<=243;r++)q[r]=q0("simple values are not supported");q[244]=Ye;q[245]=Ye;q[246]=Ye;q[247]=Zx;q[248]=q0("simple values are not supported");q[249]=eE;q[250]=tE;q[251]=rE;q[252]=Ye;q[253]=Ye;q[254]=Ye;q[255]=Jx;var Jn=[];for(let r=0;r<24;r++)Jn[r]=new U(I.uint,r,1);for(let r=-1;r>=-24;r--)Jn[31-r]=new U(I.negint,r,1);Jn[64]=new U(I.bytes,new Uint8Array(0),1);Jn[96]=new U(I.string,"",1);Jn[128]=new U(I.array,0,1);Jn[160]=new U(I.map,0,1);Jn[244]=new U(I.false,!1,1);Jn[245]=new U(I.true,!0,1);Jn[246]=new U(I.null,null,1);function aE(r){switch(r.type){case I.false:return Ts([244]);case I.true:return Ts([245]);case I.null:return Ts([246]);case I.bytes:return r.value.length?void 0:Ts([64]);case I.string:return r.value===""?Ts([96]):void 0;case I.array:return r.value===0?Ts([128]):void 0;case I.map:return r.value===0?Ts([160]):void 0;case I.uint:return r.value<24?Ts([Number(r.value)]):void 0;case I.negint:if(r.value>=-24)return Ts([31-Number(r.value)])}}var OV={float64:!1,mapSorter:MV,quickEncodeToken:aE};function LV(){let r=[];return r[I.uint.major]=Nn,r[I.negint.major]=B0,r[I.bytes.major]=bc,r[I.string.major]=Ox,r[I.array.major]=U0,r[I.map.major]=F0,r[I.tag.major]=V0,r[I.float.major]=z0,r}var cE=LV(),jm=new Fu,Ec=class{constructor(e,t){this.obj=e,this.parent=t}includes(e){let t=this;do if(t.obj===e)return!0;while(t=t.parent);return!1}static createCheck(e,t){if(e&&e.includes(t))throw new Error(`${yc} object contains circular references`);return new Ec(t,e)}},zi={null:new U(I.null,null),undefined:new U(I.undefined,void 0),true:new U(I.true,!0),false:new U(I.false,!1),emptyArray:new U(I.array,0),emptyMap:new U(I.map,0)},qi={number(r,e,t,n){return!Number.isInteger(r)||!Number.isSafeInteger(r)?new U(I.float,r):r>=0?new U(I.uint,r):new U(I.negint,r)},bigint(r,e,t,n){return r>=BigInt(0)?new U(I.uint,r):new U(I.negint,r)},Uint8Array(r,e,t,n){return new U(I.bytes,r)},string(r,e,t,n){return new U(I.string,r)},boolean(r,e,t,n){return r?zi.true:zi.false},null(r,e,t,n){return zi.null},undefined(r,e,t,n){return zi.undefined},ArrayBuffer(r,e,t,n){return new U(I.bytes,new Uint8Array(r))},DataView(r,e,t,n){return new U(I.bytes,new Uint8Array(r.buffer,r.byteOffset,r.byteLength))},Array(r,e,t,n){if(!r.length)return t.addBreakTokens===!0?[zi.emptyArray,new U(I.break)]:zi.emptyArray;n=Ec.createCheck(n,r);let s=[],i=0;for(let o of r)s[i++]=K0(o,t,n);return t.addBreakTokens?[new U(I.array,r.length),s,new U(I.break)]:[new U(I.array,r.length),s]},Object(r,e,t,n){let s=e!=="Object",i=s?r.keys():Object.keys(r),o=s?r.size:i.length;if(!o)return t.addBreakTokens===!0?[zi.emptyMap,new U(I.break)]:zi.emptyMap;n=Ec.createCheck(n,r);let a=[],c=0;for(let l of i)a[c++]=[K0(l,t,n),K0(s?r.get(l):r[l],t,n)];return BV(a,t),t.addBreakTokens?[new U(I.map,o),a,new U(I.break)]:[new U(I.map,o),a]}};qi.Map=qi.Object;qi.Buffer=qi.Uint8Array;for(let r of"Uint8Clamped Uint16 Uint32 Int8 Int16 Int32 BigUint64 BigInt64 Float32 Float64".split(" "))qi[`${r}Array`]=qi.DataView;function K0(r,e={},t){let n=ax(r),s=e&&e.typeEncoders&&e.typeEncoders[n]||qi[n];if(typeof s=="function"){let o=s(r,n,e,t);if(o!=null)return o}let i=qi[n];if(!i)throw new Error(`${yc} unsupported type: ${n}`);return i(r,n,e,t)}function BV(r,e){e.mapSorter&&r.sort(e.mapSorter)}function MV(r,e){let t=Array.isArray(r[0])?r[0][0]:r[0],n=Array.isArray(e[0])?e[0][0]:e[0];if(t.type!==n.type)return t.type.compare(n.type);let s=t.type.major,i=cE[s].compareTokens(t,n);return i===0&&console.warn("WARNING: complex key types used, CBOR key sorting guarantees are gone"),i}function lE(r,e,t,n){if(Array.isArray(e))for(let s of e)lE(r,s,t,n);else t[e.type.major](r,e,n)}function uE(r,e,t){let n=K0(r,t);if(!Array.isArray(n)&&t.quickEncodeToken){let s=t.quickEncodeToken(n);if(s)return s;let i=e[n.type.major];if(i.encodedSize){let o=i.encodedSize(n,t),a=new Fu(o);if(i(a,n,t),a.chunks.length!==1)throw new Error(`Unexpected error: pre-calculated length for ${n} was wrong`);return Uu(a.chunks[0])}}return jm.reset(),lE(jm,n,e,t),jm.toBytes(!0)}function Ku(r,e){return e=Object.assign({},OV,e),uE(r,cE,e)}var UV={strict:!1,allowIndefinite:!0,allowUndefined:!0,allowBigInt:!0},Zm=class{constructor(e,t={}){this.pos=0,this.data=e,this.options=t}done(){return this.pos>=this.data.length}next(){let e=this.data[this.pos],t=Jn[e];if(t===void 0){let n=q[e];if(!n)throw new Error(`${re} no decoder for major type ${e>>>5} (byte 0x${e.toString(16).padStart(2,"0")})`);let s=e&31;t=n(this.data,this.pos,s,this.options)}return this.pos+=t.encodedLength,t}},$u=Symbol.for("DONE"),$0=Symbol.for("BREAK");function FV(r,e,t){let n=[];for(let s=0;s<r.value;s++){let i=Hu(e,t);if(i===$0){if(r.value===1/0)break;throw new Error(`${re} got unexpected break to lengthed array`)}if(i===$u)throw new Error(`${re} found array but not enough entries (got ${s}, expected ${r.value})`);n[s]=i}return n}function VV(r,e,t){let n=t.useMaps===!0,s=n?void 0:{},i=n?new Map:void 0;for(let o=0;o<r.value;o++){let a=Hu(e,t);if(a===$0){if(r.value===1/0)break;throw new Error(`${re} got unexpected break to lengthed map`)}if(a===$u)throw new Error(`${re} found map but not enough entries (got ${o} [no key], expected ${r.value})`);if(n!==!0&&typeof a!="string")throw new Error(`${re} non-string keys not supported (got ${typeof a})`);if(t.rejectDuplicateMapKeys===!0&&(n&&i.has(a)||!n&&a in s))throw new Error(`${re} found repeat map key "${a}"`);let c=Hu(e,t);if(c===$u)throw new Error(`${re} found map but not enough entries (got ${o} [no value], expected ${r.value})`);n?i.set(a,c):s[a]=c}return n?i:s}function Hu(r,e){if(r.done())return $u;let t=r.next();if(t.type===I.break)return $0;if(t.type.terminal)return t.value;if(t.type===I.array)return FV(t,r,e);if(t.type===I.map)return VV(t,r,e);if(t.type===I.tag){if(e.tags&&typeof e.tags[t.value]=="function"){let n=Hu(r,e);return e.tags[t.value](n)}throw new Error(`${re} tag not supported (${t.value})`)}throw new Error("unsupported")}function es(r,e){if(!(r instanceof Uint8Array))throw new Error(`${re} data to decode must be a Uint8Array`);e=Object.assign({},UV,e);let t=e.tokenizer||new Zm(r,e),n=Hu(t,e);if(n===$u)throw new Error(`${re} did not find any content to decode`);if(n===$0)throw new Error(`${re} got unexpected break`);if(!t.done())throw new Error(`${re} too many terminals, data makes no sense`);return n}function zV(r,e){if(r.length>=255)throw new TypeError("Alphabet too long");for(var t=new Uint8Array(256),n=0;n<t.length;n++)t[n]=255;for(var s=0;s<r.length;s++){var i=r.charAt(s),o=i.charCodeAt(0);if(t[o]!==255)throw new TypeError(i+" is ambiguous");t[o]=s}var a=r.length,c=r.charAt(0),l=Math.log(a)/Math.log(256),u=Math.log(256)/Math.log(a);function f(d){if(d instanceof Uint8Array||(ArrayBuffer.isView(d)?d=new Uint8Array(d.buffer,d.byteOffset,d.byteLength):Array.isArray(d)&&(d=Uint8Array.from(d))),!(d instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(d.length===0)return"";for(var m=0,g=0,y=0,b=d.length;y!==b&&d[y]===0;)y++,m++;for(var w=(b-y)*u+1>>>0,v=new Uint8Array(w);y!==b;){for(var x=d[y],_=0,S=w-1;(x!==0||_<g)&&S!==-1;S--,_++)x+=256*v[S]>>>0,v[S]=x%a>>>0,x=x/a>>>0;if(x!==0)throw new Error("Non-zero carry");g=_,y++}for(var A=w-g;A!==w&&v[A]===0;)A++;for(var D=c.repeat(m);A<w;++A)D+=r.charAt(v[A]);return D}function h(d){if(typeof d!="string")throw new TypeError("Expected String");if(d.length===0)return new Uint8Array;var m=0;if(d[m]!==" "){for(var g=0,y=0;d[m]===c;)g++,m++;for(var b=(d.length-m)*l+1>>>0,w=new Uint8Array(b);d[m];){var v=t[d.charCodeAt(m)];if(v===255)return;for(var x=0,_=b-1;(v!==0||x<y)&&_!==-1;_--,x++)v+=a*w[_]>>>0,w[_]=v%256>>>0,v=v/256>>>0;if(v!==0)throw new Error("Non-zero carry");y=x,m++}if(d[m]!==" "){for(var S=b-y;S!==b&&w[S]===0;)S++;for(var A=new Uint8Array(g+(b-S)),D=g;S!==b;)A[D++]=w[S++];return A}}}function p(d){var m=h(d);if(m)return m;throw new Error(`Non-${e} character`)}return{encode:f,decodeUnsafe:h,decode:p}}var qV=zV,KV=qV,fE=KV;var e3=class{constructor(e,t,n){this.name=e,this.prefix=t,this.baseEncode=n}encode(e){if(e instanceof Uint8Array)return`${this.prefix}${this.baseEncode(e)}`;throw Error("Unknown type, must be binary type")}},t3=class{constructor(e,t,n){if(this.name=e,this.prefix=t,t.codePointAt(0)===void 0)throw new Error("Invalid prefix character");this.prefixCodePoint=t.codePointAt(0),this.baseDecode=n}decode(e){if(typeof e=="string"){if(e.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(e)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(e.slice(this.prefix.length))}else throw Error("Can only multibase decode strings")}or(e){return hE(this,e)}},r3=class{constructor(e){this.decoders=e}or(e){return hE(this,e)}decode(e){let t=e[0],n=this.decoders[t];if(n)return n.decode(e);throw RangeError(`Unable to decode multibase string ${JSON.stringify(e)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}},hE=(r,e)=>new r3({...r.decoders||{[r.prefix]:r},...e.decoders||{[e.prefix]:e}}),n3=class{constructor(e,t,n,s){this.name=e,this.prefix=t,this.baseEncode=n,this.baseDecode=s,this.encoder=new e3(e,t,n),this.decoder=new t3(e,t,s)}encode(e){return this.encoder.encode(e)}decode(e){return this.decoder.decode(e)}},dE=({name:r,prefix:e,encode:t,decode:n})=>new n3(r,e,t,n),vc=({prefix:r,name:e,alphabet:t})=>{let{encode:n,decode:s}=fE(t,e);return dE({prefix:r,name:e,encode:n,decode:i=>ai(s(i))})},$V=(r,e,t,n)=>{let s={};for(let u=0;u<e.length;++u)s[e[u]]=u;let i=r.length;for(;r[i-1]==="=";)--i;let o=new Uint8Array(i*t/8|0),a=0,c=0,l=0;for(let u=0;u<i;++u){let f=s[r[u]];if(f===void 0)throw new SyntaxError(`Non-${n} character`);c=c<<t|f,a+=t,a>=8&&(a-=8,o[l++]=255&c>>a)}if(a>=t||255&c<<8-a)throw new SyntaxError("Unexpected end of data");return o},HV=(r,e,t)=>{let n=e[e.length-1]==="=",s=(1<<t)-1,i="",o=0,a=0;for(let c=0;c<r.length;++c)for(a=a<<8|r[c],o+=8;o>t;)o-=t,i+=e[s&a>>o];if(o&&(i+=e[s&a<<t-o]),n)for(;i.length*t&7;)i+="=";return i},Pr=({name:r,prefix:e,bitsPerChar:t,alphabet:n})=>dE({prefix:e,name:r,encode(s){return HV(s,n,t)},decode(s){return $V(s,n,t,r)}});var H0=vc({prefix:"k",name:"base36",alphabet:"0123456789abcdefghijklmnopqrstuvwxyz"}),U0e=vc({prefix:"K",name:"base36upper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"});var li=vc({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"}),z0e=vc({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"});var Gu=Pr({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5}),$0e=Pr({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5}),H0e=Pr({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5}),G0e=Pr({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5}),W0e=Pr({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5}),Y0e=Pr({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5}),Q0e=Pr({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5}),X0e=Pr({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5}),j0e=Pr({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5});var pE=(r,e)=>{let{bytes:t,version:n}=r;switch(n){case 0:return WV(t,s3(r),e||li.encoder);default:return YV(t,s3(r),e||Gu.encoder)}};var mE=new WeakMap,s3=r=>{let e=mE.get(r);if(e==null){let t=new Map;return mE.set(r,t),t}return e},xt=class{constructor(e,t,n,s){this.code=t,this.version=e,this.multihash=n,this.bytes=s,this["/"]=s}get asCID(){return this}get byteOffset(){return this.bytes.byteOffset}get byteLength(){return this.bytes.byteLength}toV0(){switch(this.version){case 0:return this;case 1:{let{code:e,multihash:t}=this;if(e!==Wu)throw new Error("Cannot convert a non dag-pb CID to CIDv0");if(t.code!==QV)throw new Error("Cannot convert non sha2-256 multihash CID to CIDv0");return xt.createV0(t)}default:throw Error(`Can not convert CID version ${this.version} to version 0. This is a bug please report`)}}toV1(){switch(this.version){case 0:{let{code:e,digest:t}=this.multihash,n=Jo(e,t);return xt.createV1(this.code,n)}case 1:return this;default:throw Error(`Can not convert CID version ${this.version} to version 1. This is a bug please report`)}}equals(e){return xt.equals(this,e)}static equals(e,t){let n=t;return n&&e.code===n.code&&e.version===n.version&&ex(e.multihash,n.multihash)}toString(e){return pE(this,e)}toJSON(){return{"/":pE(this)}}link(){return this}get[Symbol.toStringTag](){return"CID"}[Symbol.for("nodejs.util.inspect.custom")](){return`CID(${this.toString()})`}static asCID(e){if(e==null)return null;let t=e;if(t instanceof xt)return t;if(t["/"]!=null&&t["/"]===t.bytes||t.asCID===t){let{version:n,code:s,multihash:i,bytes:o}=t;return new xt(n,s,i,o||gE(n,s,i.bytes))}else if(t[XV]===!0){let{version:n,multihash:s,code:i}=t,o=Jw(s);return xt.create(n,i,o)}else return null}static create(e,t,n){if(typeof t!="number")throw new Error("String codecs are no longer supported");if(!(n.bytes instanceof Uint8Array))throw new Error("Invalid digest");switch(e){case 0:{if(t!==Wu)throw new Error(`Version 0 CID must use dag-pb (code: ${Wu}) block encoding`);return new xt(e,t,n,n.bytes)}case 1:{let s=gE(e,t,n.bytes);return new xt(e,t,n,s)}default:throw new Error("Invalid version")}}static createV0(e){return xt.create(0,Wu,e)}static createV1(e,t){return xt.create(1,e,t)}static decode(e){let[t,n]=xt.decodeFirst(e);if(n.length)throw new Error("Incorrect length");return t}static decodeFirst(e){let t=xt.inspectBytes(e),n=t.size-t.multihashSize,s=ai(e.subarray(n,n+t.multihashSize));if(s.byteLength!==t.multihashSize)throw new Error("Incorrect length");let i=s.subarray(t.multihashSize-t.digestSize),o=new pc(t.multihashCode,t.digestSize,i,s);return[t.version===0?xt.createV0(o):xt.createV1(t.codec,o),e.subarray(t.size)]}static inspectBytes(e){let t=0,n=()=>{let[f,h]=Mu(e.subarray(t));return t+=h,f},s=n(),i=Wu;if(s===18?(s=0,t=0):i=n(),s!==0&&s!==1)throw new RangeError(`Invalid CID version ${s}`);let o=t,a=n(),c=n(),l=t+c,u=l-o;return{version:s,codec:i,multihashCode:a,digestSize:c,multihashSize:u,size:l}}static parse(e,t){let[n,s]=GV(e,t),i=xt.decode(s);if(i.version===0&&e[0]!=="Q")throw Error("Version 0 CID string must not include multibase prefix");return s3(i).set(n,e),i}},GV=(r,e)=>{switch(r[0]){case"Q":{let t=e||li;return[li.prefix,t.decode(`${li.prefix}${r}`)]}case li.prefix:{let t=e||li;return[li.prefix,t.decode(r)]}case Gu.prefix:{let t=e||Gu;return[Gu.prefix,t.decode(r)]}default:{if(e==null)throw Error("To parse non base32 or base58btc encoded CID multibase decoder must be provided");return[r[0],e.decode(r)]}}},WV=(r,e,t)=>{let{prefix:n}=t;if(n!==li.prefix)throw Error(`Cannot string encode V0 in ${t.name} encoding`);let s=e.get(n);if(s==null){let i=t.encode(r).slice(1);return e.set(n,i),i}else return s},YV=(r,e,t)=>{let{prefix:n}=t,s=e.get(n);if(s==null){let i=t.encode(r);return e.set(n,i),i}else return s},Wu=112,QV=18,gE=(r,e,t)=>{let n=dc(r),s=n+dc(e),i=new Uint8Array(s+t.byteLength);return hc(r,i,0),hc(e,i,n),i.set(t,s),i},XV=Symbol.for("@ipld/js-cid/CID");var IE=W(bE(),1);var Qu=class extends Error{constructor(e){super(e),this.name="TimeoutError"}},o3=class extends Error{constructor(e){super(),this.name="AbortError",this.message=e}},wE=r=>globalThis.DOMException===void 0?new o3(r):new DOMException(r),xE=r=>{let e=r.reason===void 0?wE("This operation was aborted."):r.reason;return e instanceof Error?e:wE(e)};function a3(r,e,t,n){let s,i=new Promise((o,a)=>{if(typeof e!="number"||Math.sign(e)!==1)throw new TypeError(`Expected \`milliseconds\` to be a positive number, got \`${e}\``);if(e===Number.POSITIVE_INFINITY){o(r);return}if(n={customTimers:{setTimeout,clearTimeout},...n},n.signal){let{signal:c}=n;c.aborted&&a(xE(c)),c.addEventListener("abort",()=>{a(xE(c))})}s=n.customTimers.setTimeout.call(void 0,()=>{if(typeof t=="function"){try{o(t())}catch(u){a(u)}return}let c=typeof t=="string"?t:`Promise timed out after ${e} milliseconds`,l=t instanceof Error?t:new Qu(c);typeof r.cancel=="function"&&r.cancel(),a(l)},e),(async()=>{try{o(await r)}catch(c){a(c)}finally{n.customTimers.clearTimeout.call(void 0,s)}})()});return i.clear=()=>{clearTimeout(s),s=void 0},i}function c3(r,e,t){let n=0,s=r.length;for(;s>0;){let i=Math.trunc(s/2),o=n+i;t(r[o],e)<=0?(n=++o,s-=i+1):s=i}return n}var ta=function(r,e,t,n){if(t==="a"&&!n)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?r!==e||!n:!e.has(r))throw new TypeError("Cannot read private member from an object whose class did not declare it");return t==="m"?n:t==="a"?n.call(r):n?n.value:e.get(r)},ui,Xu=class{constructor(){ui.set(this,[])}enqueue(e,t){t={priority:0,...t};let n={priority:t.priority,run:e};if(this.size&&ta(this,ui,"f")[this.size-1].priority>=t.priority){ta(this,ui,"f").push(n);return}let s=c3(ta(this,ui,"f"),n,(i,o)=>o.priority-i.priority);ta(this,ui,"f").splice(s,0,n)}dequeue(){let e=ta(this,ui,"f").shift();return e?.run}filter(e){return ta(this,ui,"f").filter(t=>t.priority===e.priority).map(t=>t.run)}get size(){return ta(this,ui,"f").length}};ui=new WeakMap;var It=function(r,e,t,n,s){if(n==="m")throw new TypeError("Private method is not writable");if(n==="a"&&!s)throw new TypeError("Private accessor was defined without a setter");if(typeof e=="function"?r!==e||!s:!e.has(r))throw new TypeError("Cannot write private member to an object whose class did not declare it");return n==="a"?s.call(r,t):s?s.value=t:e.set(r,t),t},ne=function(r,e,t,n){if(t==="a"&&!n)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?r!==e||!n:!e.has(r))throw new TypeError("Cannot read private member from an object whose class did not declare it");return t==="m"?n:t==="a"?n.call(r):n?n.value:e.get(r)},$t,Zu,Ju,$i,Z0,ef,W0,ts,ju,gn,Y0,yn,tf,Ki,Q0,EE,vE,AE,_E,SE,X0,l3,u3,J0,RE,j0,ed=class extends Error{},Nt=class extends IE.default{constructor(e){var t,n,s,i;if(super(),$t.add(this),Zu.set(this,void 0),Ju.set(this,void 0),$i.set(this,0),Z0.set(this,void 0),ef.set(this,void 0),W0.set(this,0),ts.set(this,void 0),ju.set(this,void 0),gn.set(this,void 0),Y0.set(this,void 0),yn.set(this,0),tf.set(this,void 0),Ki.set(this,void 0),Q0.set(this,void 0),Object.defineProperty(this,"timeout",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),e={carryoverConcurrencyCount:!1,intervalCap:Number.POSITIVE_INFINITY,interval:0,concurrency:Number.POSITIVE_INFINITY,autoStart:!0,queueClass:Xu,...e},!(typeof e.intervalCap=="number"&&e.intervalCap>=1))throw new TypeError(`Expected \`intervalCap\` to be a number from 1 and up, got \`${(n=(t=e.intervalCap)===null||t===void 0?void 0:t.toString())!==null&&n!==void 0?n:""}\` (${typeof e.intervalCap})`);if(e.interval===void 0||!(Number.isFinite(e.interval)&&e.interval>=0))throw new TypeError(`Expected \`interval\` to be a finite number >= 0, got \`${(i=(s=e.interval)===null||s===void 0?void 0:s.toString())!==null&&i!==void 0?i:""}\` (${typeof e.interval})`);It(this,Zu,e.carryoverConcurrencyCount,"f"),It(this,Ju,e.intervalCap===Number.POSITIVE_INFINITY||e.interval===0,"f"),It(this,Z0,e.intervalCap,"f"),It(this,ef,e.interval,"f"),It(this,gn,new e.queueClass,"f"),It(this,Y0,e.queueClass,"f"),this.concurrency=e.concurrency,this.timeout=e.timeout,It(this,Q0,e.throwOnTimeout===!0,"f"),It(this,Ki,e.autoStart===!1,"f")}get concurrency(){return ne(this,tf,"f")}set concurrency(e){if(!(typeof e=="number"&&e>=1))throw new TypeError(`Expected \`concurrency\` to be a number from 1 and up, got \`${e}\` (${typeof e})`);It(this,tf,e,"f"),ne(this,$t,"m",J0).call(this)}async add(e,t={}){return t={timeout:this.timeout,throwOnTimeout:ne(this,Q0,"f"),...t},new Promise((n,s)=>{ne(this,gn,"f").enqueue(async()=>{var i,o,a;It(this,yn,(o=ne(this,yn,"f"),o++,o),"f"),It(this,$i,(a=ne(this,$i,"f"),a++,a),"f");try{if(!((i=t.signal)===null||i===void 0)&&i.aborted)throw new ed("The task was aborted.");let c=e({signal:t.signal});t.timeout&&(c=a3(Promise.resolve(c),t.timeout)),t.signal&&(c=Promise.race([c,ne(this,$t,"m",RE).call(this,t.signal)]));let l=await c;n(l),this.emit("completed",l)}catch(c){if(c instanceof Qu&&!t.throwOnTimeout){n();return}s(c),this.emit("error",c)}finally{ne(this,$t,"m",AE).call(this)}},t),this.emit("add"),ne(this,$t,"m",X0).call(this)})}async addAll(e,t){return Promise.all(e.map(async n=>this.add(n,t)))}start(){return ne(this,Ki,"f")?(It(this,Ki,!1,"f"),ne(this,$t,"m",J0).call(this),this):this}pause(){It(this,Ki,!0,"f")}clear(){It(this,gn,new(ne(this,Y0,"f")),"f")}async onEmpty(){ne(this,gn,"f").size!==0&&await ne(this,$t,"m",j0).call(this,"empty")}async onSizeLessThan(e){ne(this,gn,"f").size<e||await ne(this,$t,"m",j0).call(this,"next",()=>ne(this,gn,"f").size<e)}async onIdle(){ne(this,yn,"f")===0&&ne(this,gn,"f").size===0||await ne(this,$t,"m",j0).call(this,"idle")}get size(){return ne(this,gn,"f").size}sizeBy(e){return ne(this,gn,"f").filter(e).length}get pending(){return ne(this,yn,"f")}get isPaused(){return ne(this,Ki,"f")}};Zu=new WeakMap,Ju=new WeakMap,$i=new WeakMap,Z0=new WeakMap,ef=new WeakMap,W0=new WeakMap,ts=new WeakMap,ju=new WeakMap,gn=new WeakMap,Y0=new WeakMap,yn=new WeakMap,tf=new WeakMap,Ki=new WeakMap,Q0=new WeakMap,$t=new WeakSet,EE=function(){return ne(this,Ju,"f")||ne(this,$i,"f")<ne(this,Z0,"f")},vE=function(){return ne(this,yn,"f")<ne(this,tf,"f")},AE=function(){var e;It(this,yn,(e=ne(this,yn,"f"),e--,e),"f"),ne(this,$t,"m",X0).call(this),this.emit("next")},_E=function(){ne(this,$t,"m",u3).call(this),ne(this,$t,"m",l3).call(this),It(this,ju,void 0,"f")},SE=function(){let e=Date.now();if(ne(this,ts,"f")===void 0){let t=ne(this,W0,"f")-e;if(t<0)It(this,$i,ne(this,Zu,"f")?ne(this,yn,"f"):0,"f");else return ne(this,ju,"f")===void 0&&It(this,ju,setTimeout(()=>{ne(this,$t,"m",_E).call(this)},t),"f"),!0}return!1},X0=function(){if(ne(this,gn,"f").size===0)return ne(this,ts,"f")&&clearInterval(ne(this,ts,"f")),It(this,ts,void 0,"f"),this.emit("empty"),ne(this,yn,"f")===0&&this.emit("idle"),!1;if(!ne(this,Ki,"f")){let e=!ne(this,$t,"a",SE);if(ne(this,$t,"a",EE)&&ne(this,$t,"a",vE)){let t=ne(this,gn,"f").dequeue();return t?(this.emit("active"),t(),e&&ne(this,$t,"m",l3).call(this),!0):!1}}return!1},l3=function(){ne(this,Ju,"f")||ne(this,ts,"f")!==void 0||(It(this,ts,setInterval(()=>{ne(this,$t,"m",u3).call(this)},ne(this,ef,"f")),"f"),It(this,W0,Date.now()+ne(this,ef,"f"),"f"))},u3=function(){ne(this,$i,"f")===0&&ne(this,yn,"f")===0&&ne(this,ts,"f")&&(clearInterval(ne(this,ts,"f")),It(this,ts,void 0,"f")),It(this,$i,ne(this,Zu,"f")?ne(this,yn,"f"):0,"f"),ne(this,$t,"m",J0).call(this)},J0=function(){for(;ne(this,$t,"m",X0).call(this););},RE=async function(e){return new Promise((t,n)=>{e.addEventListener("abort",()=>{n(new ed("The task was aborted."))},{once:!0})})},j0=async function(e,t){return new Promise(n=>{let s=()=>{t&&!t()||(this.off(e,s),n())};this.on(e,s)})};var JV=new TextDecoder;function f3(r,e){let t=0;for(let n=0;;n+=7){if(n>=64)throw new Error("protobuf: varint overflow");if(e>=r.length)throw new Error("protobuf: unexpected end of data");let s=r[e++];if(t+=n<28?(s&127)<<n:(s&127)*2**n,s<128)break}return[t,e]}function td(r,e){let t;[t,e]=f3(r,e);let n=e+t;if(t<0||n<0)throw new Error("protobuf: invalid length");if(n>r.length)throw new Error("protobuf: unexpected end of data");return[r.subarray(e,n),n]}function TE(r,e){let t;return[t,e]=f3(r,e),[t&7,t>>3,e]}function ez(r){let e={},t=r.length,n=0;for(;n<t;){let s,i;if([s,i,n]=TE(r,n),i===1){if(e.Hash)throw new Error("protobuf: (PBLink) duplicate Hash section");if(s!==2)throw new Error(`protobuf: (PBLink) wrong wireType (${s}) for Hash`);if(e.Name!==void 0)throw new Error("protobuf: (PBLink) invalid order, found Name before Hash");if(e.Tsize!==void 0)throw new Error("protobuf: (PBLink) invalid order, found Tsize before Hash");[e.Hash,n]=td(r,n)}else if(i===2){if(e.Name!==void 0)throw new Error("protobuf: (PBLink) duplicate Name section");if(s!==2)throw new Error(`protobuf: (PBLink) wrong wireType (${s}) for Name`);if(e.Tsize!==void 0)throw new Error("protobuf: (PBLink) invalid order, found Tsize before Name");let o;[o,n]=td(r,n),e.Name=JV.decode(o)}else if(i===3){if(e.Tsize!==void 0)throw new Error("protobuf: (PBLink) duplicate Tsize section");if(s!==0)throw new Error(`protobuf: (PBLink) wrong wireType (${s}) for Tsize`);[e.Tsize,n]=f3(r,n)}else throw new Error(`protobuf: (PBLink) invalid fieldNumber, expected 1, 2 or 3, got ${i}`)}if(n>t)throw new Error("protobuf: (PBLink) unexpected end of data");return e}function DE(r){let e=r.length,t=0,n,s=!1,i;for(;t<e;){let a,c;if([a,c,t]=TE(r,t),a!==2)throw new Error(`protobuf: (PBNode) invalid wireType, expected 2, got ${a}`);if(c===1){if(i)throw new Error("protobuf: (PBNode) duplicate Data section");[i,t]=td(r,t),n&&(s=!0)}else if(c===2){if(s)throw new Error("protobuf: (PBNode) duplicate Links section");n||(n=[]);let l;[l,t]=td(r,t),n.push(ez(l))}else throw new Error(`protobuf: (PBNode) invalid fieldNumber, expected 1 or 2, got ${c}`)}if(t>e)throw new Error("protobuf: (PBNode) unexpected end of data");let o={};return i&&(o.Data=i),o.Links=n||[],o}var dde=new TextEncoder,pde=2**32,mde=2**31;var bde=new TextEncoder;var CE=112;function PE(r){let e=DE(r),t={};return e.Data&&(t.Data=e.Data),e.Links&&(t.Links=e.Links.map(n=>{let s={};try{s.Hash=Ve.decode(n.Hash)}catch{}if(!s.Hash)throw new Error("Invalid Hash field found in link, expected CID");return n.Name!==void 0&&(s.Name=n.Name),n.Tsize!==void 0&&(s.Tsize=n.Tsize),s})),t}var kE=class extends Array{constructor(){super(),this.inRecursive=[]}prefix(e){let t=this.inRecursive[this.inRecursive.length-1];t&&(t.type===I.array&&(t.elements++,t.elements!==1&&e.push([44])),t.type===I.map&&(t.elements++,t.elements!==1&&(t.elements%2===1?e.push([44]):e.push([58]))))}[I.uint.major](e,t){this.prefix(e);let n=String(t.value),s=[];for(let i=0;i<n.length;i++)s[i]=n.charCodeAt(i);e.push(s)}[I.negint.major](e,t){this[I.uint.major](e,t)}[I.bytes.major](e,t){throw new Error(`${yc} unsupported type: Uint8Array`)}[I.string.major](e,t){this.prefix(e);let n=L0(JSON.stringify(t.value));e.push(n.length>32?Uu(n):n)}[I.array.major](e,t){this.prefix(e),this.inRecursive.push({type:I.array,elements:0}),e.push([91])}[I.map.major](e,t){this.prefix(e),this.inRecursive.push({type:I.map,elements:0}),e.push([123])}[I.tag.major](e,t){}[I.float.major](e,t){if(t.type.name==="break"){let o=this.inRecursive.pop();if(o){if(o.type===I.array)e.push([93]);else if(o.type===I.map)e.push([125]);else throw new Error("Unexpected recursive type; this should not happen!");return}throw new Error("Unexpected break; this should not happen!")}if(t.value===void 0)throw new Error(`${yc} unsupported type: undefined`);if(this.prefix(e),t.type.name==="true"){e.push([116,114,117,101]);return}else if(t.type.name==="false"){e.push([102,97,108,115,101]);return}else if(t.type.name==="null"){e.push([110,117,108,108]);return}let n=String(t.value),s=[],i=!1;for(let o=0;o<n.length;o++)s[o]=n.charCodeAt(o),!i&&(s[o]===46||s[o]===101||s[o]===69)&&(i=!0);i||(s.push(46),s.push(48)),e.push(s)}};var _c=class{constructor(e,t={}){this.pos=0,this.data=e,this.options=t,this.modeStack=["value"],this.lastToken=""}done(){return this.pos>=this.data.length}ch(){return this.data[this.pos]}currentMode(){return this.modeStack[this.modeStack.length-1]}skipWhitespace(){let e=this.ch();for(;e===32||e===9||e===13||e===10;)e=this.data[++this.pos]}expect(e){if(this.data.length-this.pos<e.length)throw new Error(`${re} unexpected end of input at position ${this.pos}`);for(let t=0;t<e.length;t++)if(this.data[this.pos++]!==e[t])throw new Error(`${re} unexpected token at position ${this.pos}, expected to find '${String.fromCharCode(...e)}'`)}parseNumber(){let e=this.pos,t=!1,n=!1,s=a=>{for(;!this.done();){let c=this.ch();if(a.includes(c))this.pos++;else break}};if(this.ch()===45&&(t=!0,this.pos++),this.ch()===48)if(this.pos++,this.ch()===46)this.pos++,n=!0;else return new U(I.uint,0,this.pos-e);if(s([48,49,50,51,52,53,54,55,56,57]),t&&this.pos===e+1)throw new Error(`${re} unexpected token at position ${this.pos}`);if(!this.done()&&this.ch()===46){if(n)throw new Error(`${re} unexpected token at position ${this.pos}`);n=!0,this.pos++,s([48,49,50,51,52,53,54,55,56,57])}!this.done()&&(this.ch()===101||this.ch()===69)&&(n=!0,this.pos++,!this.done()&&(this.ch()===43||this.ch()===45)&&this.pos++,s([48,49,50,51,52,53,54,55,56,57]));let i=String.fromCharCode.apply(null,this.data.subarray(e,this.pos)),o=parseFloat(i);return n?new U(I.float,o,this.pos-e):this.options.allowBigInt!==!0||Number.isSafeInteger(o)?new U(o>=0?I.uint:I.negint,o,this.pos-e):new U(o>=0?I.uint:I.negint,BigInt(i),this.pos-e)}parseString(){if(this.ch()!==34)throw new Error(`${re} unexpected character at position ${this.pos}; this shouldn't happen`);this.pos++;for(let i=this.pos,o=0;i<this.data.length&&o<65536;i++,o++){let a=this.data[i];if(a===92||a<32||a>=128)break;if(a===34){let c=String.fromCharCode.apply(null,this.data.subarray(this.pos,i));return this.pos=i+1,new U(I.string,c,o)}}let e=this.pos,t=[],n=()=>{if(this.pos+4>=this.data.length)throw new Error(`${re} unexpected end of unicode escape sequence at position ${this.pos}`);let i=0;for(let o=0;o<4;o++){let a=this.ch();if(a>=48&&a<=57)a-=48;else if(a>=97&&a<=102)a=a-97+10;else if(a>=65&&a<=70)a=a-65+10;else throw new Error(`${re} unexpected unicode escape character at position ${this.pos}`);i=i*16+a,this.pos++}return i},s=()=>{let i=this.ch(),o=null,a=i>239?4:i>223?3:i>191?2:1;if(this.pos+a>this.data.length)throw new Error(`${re} unexpected unicode sequence at position ${this.pos}`);let c,l,u,f;switch(a){case 1:i<128&&(o=i);break;case 2:c=this.data[this.pos+1],(c&192)===128&&(f=(i&31)<<6|c&63,f>127&&(o=f));break;case 3:c=this.data[this.pos+1],l=this.data[this.pos+2],(c&192)===128&&(l&192)===128&&(f=(i&15)<<12|(c&63)<<6|l&63,f>2047&&(f<55296||f>57343)&&(o=f));break;case 4:c=this.data[this.pos+1],l=this.data[this.pos+2],u=this.data[this.pos+3],(c&192)===128&&(l&192)===128&&(u&192)===128&&(f=(i&15)<<18|(c&63)<<12|(l&63)<<6|u&63,f>65535&&f<1114112&&(o=f))}o===null?(o=65533,a=1):o>65535&&(o-=65536,t.push(o>>>10&1023|55296),o=56320|o&1023),t.push(o),this.pos+=a};for(;!this.done();){let i=this.ch(),o;switch(i){case 92:if(this.pos++,this.done())throw new Error(`${re} unexpected string termination at position ${this.pos}`);switch(o=this.ch(),this.pos++,o){case 34:case 39:case 92:case 47:t.push(o);break;case 98:t.push(8);break;case 116:t.push(9);break;case 110:t.push(10);break;case 102:t.push(12);break;case 114:t.push(13);break;case 117:t.push(n());break;default:throw new Error(`${re} unexpected string escape character at position ${this.pos}`)}break;case 34:return this.pos++,new U(I.string,Gm(t),this.pos-e);default:if(i<32)throw new Error(`${re} invalid control character at position ${this.pos}`);i<128?(t.push(i),this.pos++):s()}}throw new Error(`${re} unexpected end of string at position ${this.pos}`)}parseValue(){switch(this.ch()){case 123:return this.modeStack.push("obj-start"),this.pos++,new U(I.map,1/0,1);case 91:return this.modeStack.push("array-start"),this.pos++,new U(I.array,1/0,1);case 34:return this.parseString();case 110:return this.expect([110,117,108,108]),new U(I.null,null,4);case 102:return this.expect([102,97,108,115,101]),new U(I.false,!1,5);case 116:return this.expect([116,114,117,101]),new U(I.true,!0,4);case 45:case 48:case 49:case 50:case 51:case 52:case 53:case 54:case 55:case 56:case 57:return this.parseNumber();default:throw new Error(`${re} unexpected character at position ${this.pos}`)}}next(){switch(this.skipWhitespace(),this.currentMode()){case"value":return this.modeStack.pop(),this.parseValue();case"array-value":{if(this.modeStack.pop(),this.ch()===93)return this.pos++,this.skipWhitespace(),new U(I.break,void 0,1);if(this.ch()!==44)throw new Error(`${re} unexpected character at position ${this.pos}, was expecting array delimiter but found '${String.fromCharCode(this.ch())}'`);return this.pos++,this.modeStack.push("array-value"),this.skipWhitespace(),this.parseValue()}case"array-start":return this.modeStack.pop(),this.ch()===93?(this.pos++,this.skipWhitespace(),new U(I.break,void 0,1)):(this.modeStack.push("array-value"),this.skipWhitespace(),this.parseValue());case"obj-key":if(this.ch()===125)return this.modeStack.pop(),this.pos++,this.skipWhitespace(),new U(I.break,void 0,1);if(this.ch()!==44)throw new Error(`${re} unexpected character at position ${this.pos}, was expecting object delimiter but found '${String.fromCharCode(this.ch())}'`);this.pos++,this.skipWhitespace();case"obj-start":{if(this.modeStack.pop(),this.ch()===125)return this.pos++,this.skipWhitespace(),new U(I.break,void 0,1);let e=this.parseString();if(this.skipWhitespace(),this.ch()!==58)throw new Error(`${re} unexpected character at position ${this.pos}, was expecting key/value delimiter ':' but found '${String.fromCharCode(this.ch())}'`);return this.pos++,this.modeStack.push("obj-value"),e}case"obj-value":return this.modeStack.pop(),this.modeStack.push("obj-key"),this.skipWhitespace(),this.parseValue();default:throw new Error(`${re} unexpected parse state at position ${this.pos}; this shouldn't happen`)}}};function h3(r,e){return e=Object.assign({tokenizer:new _c(r,e)},e),es(r,e)}var NE=Pr({prefix:"m",name:"base64",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bitsPerChar:6}),Gde=Pr({prefix:"M",name:"base64pad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",bitsPerChar:6}),Wde=Pr({prefix:"u",name:"base64url",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",bitsPerChar:6}),Yde=Pr({prefix:"U",name:"base64urlpad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=",bitsPerChar:6});var OE=85;var LE={codec:CE,async*walk(r){yield*PE(r).Links.map(t=>t.Hash)}},BE={codec:OE,async*walk(){}},ME=42,UE={codec:113,async*walk(r){let e=[],t=[];t[ME]=n=>{if(n[0]!==0)throw new Error("Invalid CID for CBOR tag 42; expected leading 0x00");let s=xt.decode(n.subarray(1));return e.push(s),s},es(r,{tags:t}),yield*e}},d3=class extends _c{tokenBuffer;constructor(e,t){super(e,t),this.tokenBuffer=[]}done(){return this.tokenBuffer.length===0&&super.done()}_next(){return this.tokenBuffer.length>0?this.tokenBuffer.pop():super.next()}next(){let e=this._next();if(e.type===I.map){let t=this._next();if(t.type===I.string&&t.value==="/"){let n=this._next();if(n.type===I.string){if(this._next().type!==I.break)throw new Error("Invalid encoded CID form");return this.tokenBuffer.push(n),new U(I.tag,42,0)}if(n.type===I.map){let s=this._next();if(s.type===I.string&&s.value==="bytes"){let i=this._next();if(i.type===I.string){for(let a=0;a<2;a++)if(this._next().type!==I.break)throw new Error("Invalid encoded Bytes form");let o=NE.decode(`m${i.value}`);return new U(I.bytes,o,i.value.length)}this.tokenBuffer.push(i)}this.tokenBuffer.push(s)}this.tokenBuffer.push(n)}this.tokenBuffer.push(t)}return e}},FE={codec:297,async*walk(r){let e=[],t=[];t[ME]=n=>{let s=xt.parse(n);return e.push(s),s},h3(r,{tags:t,tokenizer:new d3(r,{tags:t,allowIndefinite:!0,allowUndefined:!0,allowNaN:!0,allowInfinity:!0,allowBigInt:!0,strict:!1,rejectDuplicateMapKeys:!1})}),yield*e}};var sz=[BE,LE,UE,FE],KE="/pin/",VE="/pinned-block/",p3=H0,zE=1;function qE(r){return r.version===0&&(r=r.toV1()),new Ce(`${KE}${r.toString(p3)}`)}var rd=class{datastore;blockstore;dagWalkers;constructor(e,t,n){this.datastore=e,this.blockstore=t,this.dagWalkers={},[...sz,...n].forEach(s=>{this.dagWalkers[s.codec]=s})}async add(e,t={}){let n=qE(e);if(await this.datastore.has(n))throw new Error("Already pinned");let s=Math.round(t.depth??1/0);if(s<0)throw new Error("Depth must be greater than or equal to 0");let i=new Nt({concurrency:zE});i.add(async()=>{await this.#e(e,i,c=>{c.pinnedBy.find(l=>be(l,e.bytes))==null&&(c.pinCount++,c.pinnedBy.push(e.bytes))},{...t,depth:s})});let o=De();i.on("error",c=>{i.clear(),o.reject(c)}),await Promise.race([i.onIdle(),o.promise]);let a={depth:s,metadata:t.metadata??{}};return await this.datastore.put(n,Ku(a),t),{cid:e,...a}}async#e(e,t,n,s){if(s.depth===-1)return;let i=this.dagWalkers[e.code];if(i==null)throw new Error(`No dag walker found for cid codec ${e.code}`);let o=await this.blockstore.get(e,s);await this.#t(e,n,s);for await(let a of i.walk(o))t.add(async()=>{await this.#e(a,t,n,{...s,depth:s.depth-1})})}async#t(e,t,n){let s=new Ce(`${VE}${p3.encode(e.multihash.bytes)}`),i={pinCount:0,pinnedBy:[]};try{i=es(await this.datastore.get(s,n))}catch(o){if(o.code!=="ERR_NOT_FOUND")throw o}if(t(i),i.pinCount===0&&await this.datastore.has(s)){await this.datastore.delete(s);return}await this.datastore.put(s,Ku(i),n),n.onProgress?.(new We("helia:pin:add",{detail:e}))}async rm(e,t={}){let n=qE(e),s=await this.datastore.get(n,t),i=es(s);await this.datastore.delete(n,t);let o=new Nt({concurrency:zE});return o.add(async()=>{await this.#e(e,o,a=>{a.pinCount--,a.pinnedBy=a.pinnedBy.filter(c=>be(c,e.bytes))},{...t,depth:i.depth})}),await o.onIdle(),{cid:e,...i}}async*ls(e={}){for await(let{key:t,value:n}of this.datastore.query({prefix:KE+(e.cid!=null?`${e.cid.toString(H0)}`:"")},e)){let s=xt.parse(t.toString().substring(5),H0),i=es(n);yield{cid:s,...i}}}async isPinned(e,t={}){let n=new Ce(`${VE}${p3.encode(e.multihash.bytes)}`);return this.datastore.has(n,t)}};var m3=class extends Error{constructor(e){super(e),this.name="TimeoutError"}},g3=class extends Error{constructor(e){super(),this.name="AbortError",this.message=e}},$E=r=>globalThis.DOMException===void 0?new g3(r):new DOMException(r),HE=r=>{let e=r.reason===void 0?$E("This operation was aborted."):r.reason;return e instanceof Error?e:$E(e)};function y3(r,e){let{milliseconds:t,fallback:n,message:s,customTimers:i={setTimeout,clearTimeout}}=e,o,c=new Promise((l,u)=>{if(typeof t!="number"||Math.sign(t)!==1)throw new TypeError(`Expected \`milliseconds\` to be a positive number, got \`${t}\``);if(e.signal){let{signal:h}=e;h.aborted&&u(HE(h)),h.addEventListener("abort",()=>{u(HE(h))})}if(t===Number.POSITIVE_INFINITY){r.then(l,u);return}let f=new m3;o=i.setTimeout.call(void 0,()=>{if(n){try{l(n())}catch(h){u(h)}return}typeof r.cancel=="function"&&r.cancel(),s===!1?l():s instanceof Error?u(s):(f.message=s??`Promise timed out after ${t} milliseconds`,u(f))},t),(async()=>{try{l(await r)}catch(h){u(h)}})()}).finally(()=>{c.clear()});return c.clear=()=>{i.clearTimeout.call(void 0,o),o=void 0},c}var GE=(r=21)=>crypto.getRandomValues(new Uint8Array(r)).reduce((e,t)=>(t&=63,t<36?e+=t.toString(36):t<62?e+=(t-26).toString(36).toUpperCase():t>62?e+="-":e+="_",e),"");var b3="lock:worker:request-read",w3="lock:worker:release-read",x3="lock:master:grant-read",E3="lock:worker:request-write",v3="lock:worker:release-write",_3="lock:master:grant-write";var Hi={},Sc=r=>{r.addEventListener("message",e=>{Sc.dispatchEvent("message",r,e)}),r.port!=null&&r.port.addEventListener("message",e=>{Sc.dispatchEvent("message",r,e)})};Sc.addEventListener=(r,e)=>{Hi[r]==null&&(Hi[r]=[]),Hi[r].push(e)};Sc.removeEventListener=(r,e)=>{Hi[r]!=null&&(Hi[r]=Hi[r].filter(t=>t===e))};Sc.dispatchEvent=function(r,e,t){Hi[r]!=null&&Hi[r].forEach(n=>n(e,t))};var S3=Sc;var WE=(r,e,t,n,s)=>(i,o)=>{if(o.data.type!==t)return;let a={type:o.data.type,name:o.data.name,identifier:o.data.identifier};r.dispatchEvent(new MessageEvent(e,{data:{name:a.name,handler:async()=>(i.postMessage({type:s,name:a.name,identifier:a.identifier}),await new Promise(c=>{let l=u=>{if(u==null||u.data==null)return;let f={type:u.data.type,name:u.data.name,identifier:u.data.identifier};f.type===n&&f.identifier===a.identifier&&(i.removeEventListener("message",l),c())};i.addEventListener("message",l)}))}}))},YE=(r,e,t,n)=>async()=>{let s=GE();return globalThis.postMessage({type:e,identifier:s,name:r}),await new Promise(i=>{let o=a=>{if(a==null||a.data==null)return;let c={type:a.data.type,identifier:a.data.identifier};c.type===t&&c.identifier===s&&(globalThis.removeEventListener("message",o),i(()=>{globalThis.postMessage({type:n,identifier:s,name:r})}))};globalThis.addEventListener("message",o)})},iz={singleProcess:!1},QE=r=>{if(r=Object.assign({},iz,r),!!globalThis.document||r.singleProcess){let t=new EventTarget;return S3.addEventListener("message",WE(t,"requestReadLock",b3,w3,x3)),S3.addEventListener("message",WE(t,"requestWriteLock",E3,v3,_3)),t}return{isWorker:!0,readLock:t=>YE(t,b3,x3,w3),writeLock:t=>YE(t,E3,_3,v3)}};var ra={},Gi;async function A3(r,e){let t,n=new Promise(s=>{t=s});return r.add(async()=>await y3((async()=>await new Promise(s=>{t(()=>{s()})}))(),{milliseconds:e.timeout})),await n}var oz=(r,e)=>{if(Gi.isWorker===!0)return{readLock:Gi.readLock(r,e),writeLock:Gi.writeLock(r,e)};let t=new Nt({concurrency:1}),n;return{async readLock(){if(n!=null)return await A3(n,e);n=new Nt({concurrency:e.concurrency,autoStart:!1});let s=n,i=A3(n,e);return t.add(async()=>(s.start(),await s.onIdle().then(()=>{n===s&&(n=null)}))),await i},async writeLock(){return n=null,await A3(t,e)}}},az={name:"lock",concurrency:1/0,timeout:846e5,singleProcess:!1};function rf(r){let e=Object.assign({},az,r);return Gi==null&&(Gi=QE(e),Gi.isWorker!==!0&&(Gi.addEventListener("requestReadLock",t=>{ra[t.data.name]!=null&&ra[t.data.name].readLock().then(async n=>await t.data.handler().finally(()=>n()))}),Gi.addEventListener("requestWriteLock",async t=>{ra[t.data.name]!=null&&ra[t.data.name].writeLock().then(async n=>await t.data.handler().finally(()=>n()))}))),ra[e.name]==null&&(ra[e.name]=oz(e.name,e)),ra[e.name]}var nd=class{lock;child;pins;constructor(e,t,n={}){this.child=e,this.pins=t,this.lock=rf({singleProcess:n.holdGcLock})}unwrap(){return this.child}async put(e,t,n={}){let s=await this.lock.readLock();try{return await this.child.put(e,t,n)}finally{s()}}async*putMany(e,t={}){let n=await this.lock.readLock();try{yield*this.child.putMany(e,t)}finally{n()}}async get(e,t={}){let n=await this.lock.readLock();try{return await this.child.get(e,t)}finally{n()}}async*getMany(e,t={}){let n=await this.lock.readLock();try{yield*this.child.getMany(e,t)}finally{n()}}async delete(e,t={}){let n=await this.lock.writeLock();try{if(await this.pins.isPinned(e))throw new Error("CID was pinned");await this.child.delete(e,t)}finally{n()}}async*deleteMany(e,t={}){let n=await this.lock.writeLock();try{let s=this;yield*this.child.deleteMany(async function*(){for await(let i of e){if(await s.pins.isPinned(i))throw new Error("CID was pinned");yield i}}(),t)}finally{n()}}async has(e,t={}){let n=await this.lock.readLock();try{return await this.child.has(e,t)}finally{n()}}async*getAll(e={}){let t=await this.lock.readLock();try{yield*this.child.getAll(e)}finally{t()}}};var R3=new Ce("/version"),XE=1;async function jE(r){if(!await r.has(R3)){await r.put(R3,$(`${XE}`));return}let e=await r.get(R3),t=M(e);if(parseInt(t,10)!==XE)throw new Error("Unknown datastore version, a datastore migration may be required")}var sd=class{child;bitswap;constructor(e,t={}){this.child=e,this.bitswap=t.bitswap}unwrap(){return this.child}async put(e,t,n={}){return await this.child.has(e)?(n.onProgress?.(new We("blocks:put:duplicate",e)),e):(this.bitswap?.isStarted()===!0&&(n.onProgress?.(new We("blocks:put:bitswap:notify",e)),this.bitswap.notify(e,t,n)),n.onProgress?.(new We("blocks:put:blockstore:put",e)),this.child.put(e,t,n))}async*putMany(e,t={}){let n=Cr(e,async({cid:i})=>{let o=await this.child.has(i);return o&&t.onProgress?.(new We("blocks:put-many:duplicate",i)),!o}),s=_u(n,({cid:i,block:o})=>{t.onProgress?.(new We("blocks:put-many:bitswap:notify",i)),this.bitswap?.notify(i,o,t)});t.onProgress?.(new We("blocks:put-many:blockstore:put-many")),yield*this.child.putMany(s,t)}async get(e,t={}){if(t.offline!==!0&&this.bitswap?.isStarted()!=null&&!await this.child.has(e)){t.onProgress?.(new We("blocks:get:bitswap:get",e));let n=await this.bitswap.want(e,t);return t.onProgress?.(new We("blocks:get:blockstore:put",e)),await this.child.put(e,n,t),n}return t.onProgress?.(new We("blocks:get:blockstore:get",e)),this.child.get(e,t)}async*getMany(e,t={}){t.onProgress?.(new We("blocks:get-many:blockstore:get-many")),yield*this.child.getMany(_u(e,async n=>{if(t.offline!==!0&&this.bitswap?.isStarted()===!0&&!await this.child.has(n)){t.onProgress?.(new We("blocks:get-many:bitswap:get",n));let s=await this.bitswap.want(n,t);t.onProgress?.(new We("blocks:get-many:blockstore:put",n)),await this.child.put(n,s,t)}}))}async delete(e,t={}){t.onProgress?.(new We("blocks:delete:blockstore:delete",e)),await this.child.delete(e,t)}async*deleteMany(e,t={}){t.onProgress?.(new We("blocks:delete-many:blockstore:delete-many")),yield*this.child.deleteMany(async function*(){for await(let n of e)yield n}(),t)}async has(e,t={}){return this.child.has(e,t)}async*getAll(e={}){e.onProgress?.(new We("blocks:get-all:blockstore:get-many")),yield*this.child.getAll(e)}};var I3=C("helia"),id=class{libp2p;blockstore;datastore;pins;#e;constructor(e){let t=[ix,ox,nx,...e.hashers??[]];this.#e=Yw(e.libp2p,e.blockstore,{hashLoader:{getHasher:async s=>{let i=t.find(o=>o.code===s||o.name===s);if(i!=null)return i;throw new Error(`Could not load hasher for code/name "${s}"`)}}});let n=new sd(e.blockstore,{bitswap:this.#e});this.pins=new rd(e.datastore,n,e.dagWalkers??[]),this.libp2p=e.libp2p,this.blockstore=new nd(n,this.pins,{holdGcLock:e.holdGcLock}),this.datastore=e.datastore}async start(){await jE(this.datastore),await this.#e?.start(),await this.libp2p.start()}async stop(){await this.libp2p.stop(),await this.#e?.stop()}async gc(e={}){let t=await this.blockstore.lock.writeLock();try{let n=this,s=this.blockstore.unwrap();I3("gc start"),await $r(s.deleteMany(async function*(){for await(let{cid:i}of s.getAll())try{if(await n.pins.isPinned(i,e))continue;yield i,e.onProgress?.(new We("helia:gc:deleted",i))}catch(o){I3.error("Error during gc",o),e.onProgress?.(new We("helia:gc:error",o))}}()))}finally{t()}I3("gc finished")}};var SI=W(fn(),1);var Vd={};Y(Vd,{generateEphemeralKeyPair:()=>H_,generateKeyPair:()=>If,generateKeyPairFromSeed:()=>oH,importKey:()=>Vc,keyStretcher:()=>j_,keysPBM:()=>Pc,marshalPrivateKey:()=>B4,marshalPublicKey:()=>Tf,supportedKeys:()=>Ms,unmarshalPrivateKey:()=>ls,unmarshalPublicKey:()=>Yr});var tme=W(af(),1),rme=W(h_(),1);var Fd=W(rt(),1);var w4={};Y(w4,{Ed25519PrivateKey:()=>ua,Ed25519PublicKey:()=>yf,generateKeyPair:()=>S$,generateKeyPairFromSeed:()=>b4,unmarshalEd25519PrivateKey:()=>v$,unmarshalEd25519PublicKey:()=>_$});function kK(r,e){if(r.length>=255)throw new TypeError("Alphabet too long");for(var t=new Uint8Array(256),n=0;n<t.length;n++)t[n]=255;for(var s=0;s<r.length;s++){var i=r.charAt(s),o=i.charCodeAt(0);if(t[o]!==255)throw new TypeError(i+" is ambiguous");t[o]=s}var a=r.length,c=r.charAt(0),l=Math.log(a)/Math.log(256),u=Math.log(256)/Math.log(a);function f(d){if(d instanceof Uint8Array||(ArrayBuffer.isView(d)?d=new Uint8Array(d.buffer,d.byteOffset,d.byteLength):Array.isArray(d)&&(d=Uint8Array.from(d))),!(d instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(d.length===0)return"";for(var m=0,g=0,y=0,b=d.length;y!==b&&d[y]===0;)y++,m++;for(var w=(b-y)*u+1>>>0,v=new Uint8Array(w);y!==b;){for(var x=d[y],_=0,S=w-1;(x!==0||_<g)&&S!==-1;S--,_++)x+=256*v[S]>>>0,v[S]=x%a>>>0,x=x/a>>>0;if(x!==0)throw new Error("Non-zero carry");g=_,y++}for(var A=w-g;A!==w&&v[A]===0;)A++;for(var D=c.repeat(m);A<w;++A)D+=r.charAt(v[A]);return D}function h(d){if(typeof d!="string")throw new TypeError("Expected String");if(d.length===0)return new Uint8Array;var m=0;if(d[m]!==" "){for(var g=0,y=0;d[m]===c;)g++,m++;for(var b=(d.length-m)*l+1>>>0,w=new Uint8Array(b);d[m];){var v=t[d.charCodeAt(m)];if(v===255)return;for(var x=0,_=b-1;(v!==0||x<y)&&_!==-1;_--,x++)v+=a*w[_]>>>0,w[_]=v%256>>>0,v=v/256>>>0;if(v!==0)throw new Error("Non-zero carry");y=x,m++}if(d[m]!==" "){for(var S=b-y;S!==b&&w[S]===0;)S++;for(var A=new Uint8Array(g+(b-S)),D=g;S!==b;)A[D++]=w[S++];return A}}}function p(d){var m=h(d);if(m)return m;throw new Error(`Non-${e} character`)}return{encode:f,decodeUnsafe:h,decode:p}}var NK=kK,OK=NK,d_=OK;var m1e=new Uint8Array(0);var uf=r=>{if(r instanceof Uint8Array&&r.constructor.name==="Uint8Array")return r;if(r instanceof ArrayBuffer)return new Uint8Array(r);if(ArrayBuffer.isView(r))return new Uint8Array(r.buffer,r.byteOffset,r.byteLength);throw new Error("Unknown type, must be binary type")};var X3=class{constructor(e,t,n){this.name=e,this.prefix=t,this.baseEncode=n}encode(e){if(e instanceof Uint8Array)return`${this.prefix}${this.baseEncode(e)}`;throw Error("Unknown type, must be binary type")}},j3=class{constructor(e,t,n){if(this.name=e,this.prefix=t,t.codePointAt(0)===void 0)throw new Error("Invalid prefix character");this.prefixCodePoint=t.codePointAt(0),this.baseDecode=n}decode(e){if(typeof e=="string"){if(e.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(e)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(e.slice(this.prefix.length))}else throw Error("Can only multibase decode strings")}or(e){return p_(this,e)}},Z3=class{constructor(e){this.decoders=e}or(e){return p_(this,e)}decode(e){let t=e[0],n=this.decoders[t];if(n)return n.decode(e);throw RangeError(`Unable to decode multibase string ${JSON.stringify(e)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}},p_=(r,e)=>new Z3({...r.decoders||{[r.prefix]:r},...e.decoders||{[e.prefix]:e}}),J3=class{constructor(e,t,n,s){this.name=e,this.prefix=t,this.baseEncode=n,this.baseDecode=s,this.encoder=new X3(e,t,n),this.decoder=new j3(e,t,s)}encode(e){return this.encoder.encode(e)}decode(e){return this.decoder.decode(e)}},m_=({name:r,prefix:e,encode:t,decode:n})=>new J3(r,e,t,n),e4=({prefix:r,name:e,alphabet:t})=>{let{encode:n,decode:s}=d_(t,e);return m_({prefix:r,name:e,encode:n,decode:i=>uf(s(i))})},LK=(r,e,t,n)=>{let s={};for(let u=0;u<e.length;++u)s[e[u]]=u;let i=r.length;for(;r[i-1]==="=";)--i;let o=new Uint8Array(i*t/8|0),a=0,c=0,l=0;for(let u=0;u<i;++u){let f=s[r[u]];if(f===void 0)throw new SyntaxError(`Non-${n} character`);c=c<<t|f,a+=t,a>=8&&(a-=8,o[l++]=255&c>>a)}if(a>=t||255&c<<8-a)throw new SyntaxError("Unexpected end of data");return o},BK=(r,e,t)=>{let n=e[e.length-1]==="=",s=(1<<t)-1,i="",o=0,a=0;for(let c=0;c<r.length;++c)for(a=a<<8|r[c],o+=8;o>t;)o-=t,i+=e[s&a>>o];if(o&&(i+=e[s&a<<t-o]),n)for(;i.length*t&7;)i+="=";return i},ff=({name:r,prefix:e,bitsPerChar:t,alphabet:n})=>m_({prefix:e,name:r,encode(s){return BK(s,n,t)},decode(s){return LK(s,n,t,r)}});var g_=e4({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"}),E1e=e4({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"});var MK=w_,y_=128,UK=127,FK=~UK,VK=Math.pow(2,31);function w_(r,e,t){e=e||[],t=t||0;for(var n=t;r>=VK;)e[t++]=r&255|y_,r/=128;for(;r&FK;)e[t++]=r&255|y_,r>>>=7;return e[t]=r|0,w_.bytes=t-n+1,e}var zK=t4,qK=128,b_=127;function t4(r,n){var t=0,n=n||0,s=0,i=n,o,a=r.length;do{if(i>=a)throw t4.bytes=0,new RangeError("Could not decode varint");o=r[i++],t+=s<28?(o&b_)<<s:(o&b_)*Math.pow(2,s),s+=7}while(o>=qK);return t4.bytes=i-n,t}var KK=Math.pow(2,7),$K=Math.pow(2,14),HK=Math.pow(2,21),GK=Math.pow(2,28),WK=Math.pow(2,35),YK=Math.pow(2,42),QK=Math.pow(2,49),XK=Math.pow(2,56),jK=Math.pow(2,63),ZK=function(r){return r<KK?1:r<$K?2:r<HK?3:r<GK?4:r<WK?5:r<YK?6:r<QK?7:r<XK?8:r<jK?9:10},JK={encode:MK,decode:zK,encodingLength:ZK},e$=JK,r4=e$;var n4=(r,e,t=0)=>(r4.encode(r,e,t),e),s4=r=>r4.encodingLength(r);var hf=(r,e)=>{let t=e.byteLength,n=s4(r),s=n+s4(t),i=new Uint8Array(s+t);return n4(r,i,0),n4(t,i,n),i.set(e,s),new i4(r,t,e,i)};var i4=class{constructor(e,t,n,s){this.code=e,this.size=t,this.digest=n,this.bytes=s}};var E_=0,r$="identity",v_=uf,n$=r=>hf(E_,v_(r)),__={code:E_,name:r$,encode:v_,digest:n$};var a4=({name:r,code:e,encode:t})=>new o4(r,e,t),o4=class{constructor(e,t,n){this.name=e,this.code=t,this.encode=n}digest(e){if(e instanceof Uint8Array){let t=this.encode(e);return t instanceof Uint8Array?hf(this.code,t):t.then(n=>hf(this.code,n))}else throw Error("Unknown type, must be binary type")}};var S_=r=>async e=>new Uint8Array(await crypto.subtle.digest(r,e)),Mn=a4({name:"sha2-256",code:18,encode:S_("SHA-256")}),k1e=a4({name:"sha2-512",code:19,encode:S_("SHA-512")});var s$=W(ia(),1);var hr=BigInt(0),Be=BigInt(1),Ji=BigInt(2),i$=BigInt(8),A_=BigInt("7237005577332262213973186563042994240857116359379907606001950938285454250989"),ut=Object.freeze({a:BigInt(-1),d:BigInt("37095705934669439343138083508754565189542113879843219016388785533085940283555"),P:BigInt("57896044618658097711785492504343953926634992332820282019728792003956564819949"),l:A_,n:A_,h:BigInt(8),Gx:BigInt("15112221349535400772501151409588531511454012693041857206046113283949847762202"),Gy:BigInt("46316835694926478169428394003475163141307993866256225615783033603165251855960")});var C_=BigInt("0x10000000000000000000000000000000000000000000000000000000000000000"),df=BigInt("19681161376707505956807079304988542015446066515923890162744021073123829784752"),O1e=BigInt("6853475219497561581579357271197624642482790079785650197046958215289687604742"),o$=BigInt("25063068953384623474111414158702152701244531502492656460079210482610430750235"),a$=BigInt("54469307008909316920995813868745141605393597292927456921205312896311721017578"),c$=BigInt("1159843021668779879193775521855586647937357759715417654439879720876111806838"),l$=BigInt("40440834346308536858101042469323190826248399146238708352240133220865137265952"),Ne=class{constructor(e,t,n,s){this.x=e,this.y=t,this.z=n,this.t=s}static fromAffine(e){if(!(e instanceof vt))throw new TypeError("ExtendedPoint#fromAffine: expected Point");return e.equals(vt.ZERO)?Ne.ZERO:new Ne(e.x,e.y,Be,L(e.x*e.y))}static toAffineBatch(e){let t=h$(e.map(n=>n.z));return e.map((n,s)=>n.toAffine(t[s]))}static normalizeZ(e){return this.toAffineBatch(e).map(this.fromAffine)}equals(e){I_(e);let{x:t,y:n,z:s}=this,{x:i,y:o,z:a}=e,c=L(t*a),l=L(i*s),u=L(n*a),f=L(o*s);return c===l&&u===f}negate(){return new Ne(L(-this.x),this.y,this.z,L(-this.t))}double(){let{x:e,y:t,z:n}=this,{a:s}=ut,i=L(e*e),o=L(t*t),a=L(Ji*L(n*n)),c=L(s*i),l=e+t,u=L(L(l*l)-i-o),f=c+o,h=f-a,p=c-o,d=L(u*h),m=L(f*p),g=L(u*p),y=L(h*f);return new Ne(d,m,y,g)}add(e){I_(e);let{x:t,y:n,z:s,t:i}=this,{x:o,y:a,z:c,t:l}=e,u=L((n-t)*(a+o)),f=L((n+t)*(a-o)),h=L(f-u);if(h===hr)return this.double();let p=L(s*Ji*l),d=L(i*Ji*c),m=d+p,g=f+u,y=d-p,b=L(m*h),w=L(g*y),v=L(m*y),x=L(h*g);return new Ne(b,w,x,v)}subtract(e){return this.add(e.negate())}precomputeWindow(e){let t=1+256/e,n=[],s=this,i=s;for(let o=0;o<t;o++){i=s,n.push(i);for(let a=1;a<2**(e-1);a++)i=i.add(s),n.push(i);s=i.double()}return n}wNAF(e,t){!t&&this.equals(Ne.BASE)&&(t=vt.BASE);let n=t&&t._WINDOW_SIZE||1;if(256%n)throw new Error("Point#wNAF: Invalid precomputation window, must be power of 2");let s=t&&h4.get(t);s||(s=this.precomputeWindow(n),t&&n!==1&&(s=Ne.normalizeZ(s),h4.set(t,s)));let i=Ne.ZERO,o=Ne.BASE,a=1+256/n,c=2**(n-1),l=BigInt(2**n-1),u=2**n,f=BigInt(n);for(let h=0;h<a;h++){let p=h*c,d=Number(e&l);e>>=f,d>c&&(d-=u,e+=Be);let m=p,g=p+Math.abs(d)-1,y=h%2!==0,b=d<0;d===0?o=o.add(R_(y,s[m])):i=i.add(R_(b,s[g]))}return Ne.normalizeZ([i,o])[0]}multiply(e,t){return this.wNAF(Ad(e,ut.l),t)}multiplyUnsafe(e){let t=Ad(e,ut.l,!1),n=Ne.BASE,s=Ne.ZERO;if(t===hr)return s;if(this.equals(s)||t===Be)return this;if(this.equals(n))return this.wNAF(t);let i=s,o=this;for(;t>hr;)t&Be&&(i=i.add(o)),o=o.double(),t>>=Be;return i}isSmallOrder(){return this.multiplyUnsafe(ut.h).equals(Ne.ZERO)}isTorsionFree(){let e=this.multiplyUnsafe(ut.l/Ji).double();return ut.l%Ji&&(e=e.add(this)),e.equals(Ne.ZERO)}toAffine(e){let{x:t,y:n,z:s}=this,i=this.equals(Ne.ZERO);e==null&&(e=i?i$:Rd(s));let o=L(t*e),a=L(n*e),c=L(s*e);if(i)return vt.ZERO;if(c!==Be)throw new Error("invZ was invalid");return new vt(o,a)}fromRistrettoBytes(){l4()}toRistrettoBytes(){l4()}fromRistrettoHash(){l4()}};Ne.BASE=new Ne(ut.Gx,ut.Gy,Be,L(ut.Gx*ut.Gy));Ne.ZERO=new Ne(hr,Be,Be,hr);function R_(r,e){let t=e.negate();return r?t:e}function I_(r){if(!(r instanceof Ne))throw new TypeError("ExtendedPoint expected")}function c4(r){if(!(r instanceof Wr))throw new TypeError("RistrettoPoint expected")}function l4(){throw new Error("Legacy method: switch to RistrettoPoint")}var Wr=class{constructor(e){this.ep=e}static calcElligatorRistrettoMap(e){let{d:t}=ut,n=L(df*e*e),s=L((n+Be)*c$),i=BigInt(-1),o=L((i-t*n)*L(n+t)),{isValid:a,value:c}=p4(s,o),l=L(c*e);Zi(l)||(l=L(-l)),a||(c=l),a||(i=n);let u=L(i*(n-Be)*l$-o),f=c*c,h=L((c+c)*o),p=L(u*o$),d=L(Be-f),m=L(Be+f);return new Ne(L(h*m),L(d*p),L(p*m),L(h*d))}static hashToCurve(e){e=eo(e,64);let t=u4(e.slice(0,32)),n=this.calcElligatorRistrettoMap(t),s=u4(e.slice(32,64)),i=this.calcElligatorRistrettoMap(s);return new Wr(n.add(i))}static fromHex(e){e=eo(e,32);let{a:t,d:n}=ut,s="RistrettoPoint.fromHex: the hex is not valid encoding of RistrettoPoint",i=u4(e);if(!p$(pf(i),e)||Zi(i))throw new Error(s);let o=L(i*i),a=L(Be+t*o),c=L(Be-t*o),l=L(a*a),u=L(c*c),f=L(t*n*l-u),{isValid:h,value:p}=D_(L(f*u)),d=L(p*c),m=L(p*d*f),g=L((i+i)*d);Zi(g)&&(g=L(-g));let y=L(a*m),b=L(g*y);if(!h||Zi(b)||y===hr)throw new Error(s);return new Wr(new Ne(g,y,Be,b))}toRawBytes(){let{x:e,y:t,z:n,t:s}=this.ep,i=L(L(n+t)*L(n-t)),o=L(e*t),a=L(o*o),{value:c}=D_(L(i*a)),l=L(c*i),u=L(c*o),f=L(l*u*s),h;if(Zi(s*f)){let d=L(t*df),m=L(e*df);e=d,t=m,h=L(l*a$)}else h=u;Zi(e*f)&&(t=L(-t));let p=L((n-t)*h);return Zi(p)&&(p=L(-p)),pf(p)}toHex(){return mf(this.toRawBytes())}toString(){return this.toHex()}equals(e){c4(e);let t=this.ep,n=e.ep,s=L(t.x*n.y)===L(t.y*n.x),i=L(t.y*n.y)===L(t.x*n.x);return s||i}add(e){return c4(e),new Wr(this.ep.add(e.ep))}subtract(e){return c4(e),new Wr(this.ep.subtract(e.ep))}multiply(e){return new Wr(this.ep.multiply(e))}multiplyUnsafe(e){return new Wr(this.ep.multiplyUnsafe(e))}};Wr.BASE=new Wr(Ne.BASE);Wr.ZERO=new Wr(Ne.ZERO);var h4=new WeakMap,vt=class{constructor(e,t){this.x=e,this.y=t}_setWindowSize(e){this._WINDOW_SIZE=e,h4.delete(this)}static fromHex(e,t=!0){let{d:n,P:s}=ut;e=eo(e,32);let i=e.slice();i[31]=e[31]&-129;let o=gf(i);if(t&&o>=s)throw new Error("Expected 0 < hex < P");if(!t&&o>=C_)throw new Error("Expected 0 < hex < 2**256");let a=L(o*o),c=L(a-Be),l=L(n*a+Be),{isValid:u,value:f}=p4(c,l);if(!u)throw new Error("Point.fromHex: invalid y coordinate");let h=(f&Be)===Be;return(e[31]&128)!==0!==h&&(f=L(-f)),new vt(f,o)}static async fromPrivateKey(e){return(await Id(e)).point}toRawBytes(){let e=pf(this.y);return e[31]|=this.x&Be?128:0,e}toHex(){return mf(this.toRawBytes())}toX25519(){let{y:e}=this,t=L((Be+e)*Rd(Be-e));return pf(t)}isTorsionFree(){return Ne.fromAffine(this).isTorsionFree()}equals(e){return this.x===e.x&&this.y===e.y}negate(){return new vt(L(-this.x),this.y)}add(e){return Ne.fromAffine(this).add(Ne.fromAffine(e)).toAffine()}subtract(e){return this.add(e.negate())}multiply(e){return Ne.fromAffine(this).multiply(e,this).toAffine()}};vt.BASE=new vt(ut.Gx,ut.Gy);vt.ZERO=new vt(hr,Be);var la=class{constructor(e,t){this.r=e,this.s=t,this.assertValidity()}static fromHex(e){let t=eo(e,64),n=vt.fromHex(t.slice(0,32),!1),s=gf(t.slice(32,64));return new la(n,s)}assertValidity(){let{r:e,s:t}=this;if(!(e instanceof vt))throw new Error("Expected Point instance");return Ad(t,ut.l,!1),this}toRawBytes(){let e=new Uint8Array(64);return e.set(this.r.toRawBytes()),e.set(pf(this.s),32),e}toHex(){return mf(this.toRawBytes())}};function T_(...r){if(!r.every(n=>n instanceof Uint8Array))throw new Error("Expected Uint8Array list");if(r.length===1)return r[0];let e=r.reduce((n,s)=>n+s.length,0),t=new Uint8Array(e);for(let n=0,s=0;n<r.length;n++){let i=r[n];t.set(i,s),s+=i.length}return t}var u$=Array.from({length:256},(r,e)=>e.toString(16).padStart(2,"0"));function mf(r){if(!(r instanceof Uint8Array))throw new Error("Uint8Array expected");let e="";for(let t=0;t<r.length;t++)e+=u$[r[t]];return e}function d4(r){if(typeof r!="string")throw new TypeError("hexToBytes: expected string, got "+typeof r);if(r.length%2)throw new Error("hexToBytes: received invalid unpadded hex");let e=new Uint8Array(r.length/2);for(let t=0;t<e.length;t++){let n=t*2,s=r.slice(n,n+2),i=Number.parseInt(s,16);if(Number.isNaN(i)||i<0)throw new Error("Invalid byte sequence");e[t]=i}return e}function P_(r){let t=r.toString(16).padStart(64,"0");return d4(t)}function pf(r){return P_(r).reverse()}function Zi(r){return(L(r)&Be)===Be}function gf(r){if(!(r instanceof Uint8Array))throw new Error("Expected Uint8Array");return BigInt("0x"+mf(Uint8Array.from(r).reverse()))}var f$=BigInt("0x7fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff");function u4(r){return L(gf(r)&f$)}function L(r,e=ut.P){let t=r%e;return t>=hr?t:e+t}function Rd(r,e=ut.P){if(r===hr||e<=hr)throw new Error(`invert: expected positive integers, got n=${r} mod=${e}`);let t=L(r,e),n=e,s=hr,i=Be,o=Be,a=hr;for(;t!==hr;){let l=n/t,u=n%t,f=s-o*l,h=i-a*l;n=t,t=u,s=o,i=a,o=f,a=h}if(n!==Be)throw new Error("invert: does not exist");return L(s,e)}function h$(r,e=ut.P){let t=new Array(r.length),n=r.reduce((i,o,a)=>o===hr?i:(t[a]=i,L(i*o,e)),Be),s=Rd(n,e);return r.reduceRight((i,o,a)=>o===hr?i:(t[a]=L(i*t[a],e),L(i*o,e)),s),t}function Ls(r,e){let{P:t}=ut,n=r;for(;e-- >hr;)n*=n,n%=t;return n}function d$(r){let{P:e}=ut,t=BigInt(5),n=BigInt(10),s=BigInt(20),i=BigInt(40),o=BigInt(80),c=r*r%e*r%e,l=Ls(c,Ji)*c%e,u=Ls(l,Be)*r%e,f=Ls(u,t)*u%e,h=Ls(f,n)*f%e,p=Ls(h,s)*h%e,d=Ls(p,i)*p%e,m=Ls(d,o)*d%e,g=Ls(m,o)*d%e,y=Ls(g,n)*f%e;return{pow_p_5_8:Ls(y,Ji)*r%e,b2:c}}function p4(r,e){let t=L(e*e*e),n=L(t*t*e),s=d$(r*n).pow_p_5_8,i=L(r*t*s),o=L(e*i*i),a=i,c=L(i*df),l=o===r,u=o===L(-r),f=o===L(-r*df);return l&&(i=a),(u||f)&&(i=c),Zi(i)&&(i=L(-i)),{isValid:l||u,value:i}}function D_(r){return p4(Be,r)}function Sd(r){return L(gf(r),ut.l)}function p$(r,e){if(r.length!==e.length)return!1;for(let t=0;t<r.length;t++)if(r[t]!==e[t])return!1;return!0}function eo(r,e){let t=r instanceof Uint8Array?Uint8Array.from(r):d4(r);if(typeof e=="number"&&t.length!==e)throw new Error(`Expected ${e} bytes`);return t}function Ad(r,e,t=!0){if(!e)throw new TypeError("Specify max value");if(typeof r=="number"&&Number.isSafeInteger(r)&&(r=BigInt(r)),typeof r=="bigint"&&r<e){if(t){if(hr<r)return r}else if(hr<=r)return r}throw new TypeError("Expected valid scalar: 0 < scalar < max")}function m$(r){return r[0]&=248,r[31]&=127,r[31]|=64,r}function g$(r){if(r=typeof r=="bigint"||typeof r=="number"?P_(Ad(r,C_)):eo(r),r.length!==32)throw new Error("Expected 32 bytes");return r}function y$(r){let e=m$(r.slice(0,32)),t=r.slice(32,64),n=Sd(e),s=vt.BASE.multiply(n),i=s.toRawBytes();return{head:e,prefix:t,scalar:n,point:s,pointBytes:i}}var f4;async function Id(r){return y$(await to.sha512(g$(r)))}async function m4(r){return(await Id(r)).pointBytes}async function k_(r,e){r=eo(r);let{prefix:t,scalar:n,pointBytes:s}=await Id(e),i=Sd(await to.sha512(t,r)),o=vt.BASE.multiply(i),a=Sd(await to.sha512(o.toRawBytes(),s,r)),c=L(i+a*n,ut.l);return new la(o,c).toRawBytes()}function b$(r,e,t){e=eo(e),t instanceof vt||(t=vt.fromHex(t,!1));let{r:n,s}=r instanceof la?r.assertValidity():la.fromHex(r),i=Ne.BASE.multiplyUnsafe(s);return{r:n,s,SB:i,pub:t,msg:e}}function w$(r,e,t,n){let s=Sd(n),i=Ne.fromAffine(r).multiplyUnsafe(s);return Ne.fromAffine(e).add(i).subtract(t).multiplyUnsafe(ut.h).equals(Ne.ZERO)}async function N_(r,e,t){let{r:n,SB:s,msg:i,pub:o}=b$(r,e,t),a=await to.sha512(n.toRawBytes(),o.toRawBytes(),i);return w$(o,n,s,a)}vt.BASE._setWindowSize(8);var ji={node:s$,web:typeof self=="object"&&"crypto"in self?self.crypto:void 0},to={bytesToHex:mf,hexToBytes:d4,concatBytes:T_,getExtendedPublicKey:Id,mod:L,invert:Rd,TORSION_SUBGROUP:["0100000000000000000000000000000000000000000000000000000000000000","c7176a703d4dd84fba3c0b760d10670f2a2053fa2c39ccc64ec7fd7792ac037a","0000000000000000000000000000000000000000000000000000000000000080","26e8958fc2b227b045c3f489f2ef98f0d5dfac05d3c63339b13802886d53fc05","ecffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff7f","26e8958fc2b227b045c3f489f2ef98f0d5dfac05d3c63339b13802886d53fc85","0000000000000000000000000000000000000000000000000000000000000000","c7176a703d4dd84fba3c0b760d10670f2a2053fa2c39ccc64ec7fd7792ac03fa"],hashToPrivateScalar:r=>{if(r=eo(r),r.length<40||r.length>1024)throw new Error("Expected 40-1024 bytes of private key as per FIPS 186");return L(gf(r),ut.l-Be)+Be},randomBytes:(r=32)=>{if(ji.web)return ji.web.getRandomValues(new Uint8Array(r));if(ji.node){let{randomBytes:e}=ji.node;return new Uint8Array(e(r).buffer)}else throw new Error("The environment doesn't have randomBytes function")},randomPrivateKey:()=>to.randomBytes(32),sha512:async(...r)=>{let e=T_(...r);if(ji.web){let t=await ji.web.subtle.digest("SHA-512",e.buffer);return new Uint8Array(t)}else{if(ji.node)return Uint8Array.from(ji.node.createHash("sha512").update(e).digest());throw new Error("The environment doesn't have sha512 function")}},precompute(r=8,e=vt.BASE){let t=e.equals(vt.BASE)?e:new vt(e.x,e.y);return t._setWindowSize(r),t.multiply(Ji),t},sha512Sync:void 0};Object.defineProperties(to,{sha512Sync:{configurable:!1,get(){return f4},set(r){f4||(f4=r)}}});var Dc=32,pi=64,Td=32;async function O_(){let r=to.randomPrivateKey(),e=await m4(r);return{privateKey:U_(r,e),publicKey:e}}async function L_(r){if(r.length!==Td)throw new TypeError('"seed" must be 32 bytes in length.');if(!(r instanceof Uint8Array))throw new TypeError('"seed" must be a node.js Buffer, or Uint8Array.');let e=r,t=await m4(e);return{privateKey:U_(e,t),publicKey:t}}async function B_(r,e){let t=r.subarray(0,Td);return k_(e,t)}async function M_(r,e,t){return N_(e,t,r)}function U_(r,e){let t=new Uint8Array(pi);for(let n=0;n<Td;n++)t[n]=r[n],t[Td+n]=e[n];return t}var Dd=ff({prefix:"m",name:"base64",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bitsPerChar:6}),B1e=ff({prefix:"M",name:"base64pad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",bitsPerChar:6}),M1e=ff({prefix:"u",name:"base64url",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",bitsPerChar:6}),U1e=ff({prefix:"U",name:"base64urlpad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=",bitsPerChar:6});var Gt={get(r=globalThis){let e=r.crypto;if(e==null||e.subtle==null)throw Object.assign(new Error("Missing Web Crypto API. The most likely cause of this error is that this page is being accessed from an insecure context (i.e. not HTTPS). For more information and possible resolutions see https://github.com/libp2p/js-libp2p-crypto/blob/master/README.md#web-crypto-api"),{code:"ERR_MISSING_WEB_CRYPTO"});return e}};var g4={alg:"A128GCM",ext:!0,k:"scm9jmO_4BJAgdwWGVulLg",key_ops:["encrypt","decrypt"],kty:"oct"};function Cd(r){let e=r?.algorithm??"AES-GCM",t=r?.keyLength??16,n=r?.nonceLength??12,s=r?.digest??"SHA-256",i=r?.saltLength??16,o=r?.iterations??32767,a=Gt.get();t*=8;async function c(f,h){let p=a.getRandomValues(new Uint8Array(i)),d=a.getRandomValues(new Uint8Array(n)),m={name:e,iv:d};typeof h=="string"&&(h=$(h));let g;if(h.length===0){g=await a.subtle.importKey("jwk",g4,{name:"AES-GCM"},!0,["encrypt"]);try{let b={name:"PBKDF2",salt:p,iterations:o,hash:{name:s}},w=await a.subtle.importKey("raw",h,{name:"PBKDF2"},!1,["deriveKey"]);g=await a.subtle.deriveKey(b,w,{name:e,length:t},!0,["encrypt"])}catch{g=await a.subtle.importKey("jwk",g4,{name:"AES-GCM"},!0,["encrypt"])}}else{let b={name:"PBKDF2",salt:p,iterations:o,hash:{name:s}},w=await a.subtle.importKey("raw",h,{name:"PBKDF2"},!1,["deriveKey"]);g=await a.subtle.deriveKey(b,w,{name:e,length:t},!0,["encrypt"])}let y=await a.subtle.encrypt(m,g,f);return Ee([p,m.iv,new Uint8Array(y)])}async function l(f,h){let p=f.subarray(0,i),d=f.subarray(i,i+n),m=f.subarray(i+n),g={name:e,iv:d};typeof h=="string"&&(h=$(h));let y;if(h.length===0)try{let w={name:"PBKDF2",salt:p,iterations:o,hash:{name:s}},v=await a.subtle.importKey("raw",h,{name:"PBKDF2"},!1,["deriveKey"]);y=await a.subtle.deriveKey(w,v,{name:e,length:t},!0,["decrypt"])}catch{y=await a.subtle.importKey("jwk",g4,{name:"AES-GCM"},!0,["decrypt"])}else{let w={name:"PBKDF2",salt:p,iterations:o,hash:{name:s}},v=await a.subtle.importKey("raw",h,{name:"PBKDF2"},!1,["deriveKey"]);y=await a.subtle.deriveKey(w,v,{name:e,length:t},!0,["decrypt"])}let b=await a.subtle.decrypt(g,y,m);return new Uint8Array(b)}return{encrypt:c,decrypt:l}}async function Cc(r,e){let n=await Cd().encrypt(r,e);return Dd.encode(n)}var Pc={};Y(Pc,{KeyType:()=>ft,PrivateKey:()=>is,PublicKey:()=>ss});var ft;(function(r){r.RSA="RSA",r.Ed25519="Ed25519",r.Secp256k1="Secp256k1"})(ft||(ft={}));var y4;(function(r){r[r.RSA=0]="RSA",r[r.Ed25519=1]="Ed25519",r[r.Secp256k1=2]="Secp256k1"})(y4||(y4={}));(function(r){r.codec=()=>Pt(y4)})(ft||(ft={}));var ss;(function(r){let e;r.codec=()=>(e==null&&(e=me((t,n,s={})=>{s.lengthDelimited!==!1&&n.fork(),t.Type!=null&&(n.uint32(8),ft.codec().encode(t.Type,n)),t.Data!=null&&(n.uint32(18),n.bytes(t.Data)),s.lengthDelimited!==!1&&n.ldelim()},(t,n)=>{let s={},i=n==null?t.len:t.pos+n;for(;t.pos<i;){let o=t.uint32();switch(o>>>3){case 1:s.Type=ft.codec().decode(t);break;case 2:s.Data=t.bytes();break;default:t.skipType(o&7);break}}return s})),e),r.encode=t=>pe(t,r.codec()),r.decode=t=>de(t,r.codec())})(ss||(ss={}));var is;(function(r){let e;r.codec=()=>(e==null&&(e=me((t,n,s={})=>{s.lengthDelimited!==!1&&n.fork(),t.Type!=null&&(n.uint32(8),ft.codec().encode(t.Type,n)),t.Data!=null&&(n.uint32(18),n.bytes(t.Data)),s.lengthDelimited!==!1&&n.ldelim()},(t,n)=>{let s={},i=n==null?t.len:t.pos+n;for(;t.pos<i;){let o=t.uint32();switch(o>>>3){case 1:s.Type=ft.codec().decode(t);break;case 2:s.Data=t.bytes();break;default:t.skipType(o&7);break}}return s})),e),r.encode=t=>pe(t,r.codec()),r.decode=t=>de(t,r.codec())})(is||(is={}));var yf=class{_key;constructor(e){this._key=kc(e,Dc)}async verify(e,t){return M_(this._key,t,e)}marshal(){return this._key}get bytes(){return ss.encode({Type:ft.Ed25519,Data:this.marshal()}).subarray()}equals(e){return be(this.bytes,e.bytes)}async hash(){let{bytes:e}=await Mn.digest(this.bytes);return e}},ua=class{_key;_publicKey;constructor(e,t){this._key=kc(e,pi),this._publicKey=kc(t,Dc)}async sign(e){return B_(this._key,e)}get public(){return new yf(this._publicKey)}marshal(){return this._key}get bytes(){return is.encode({Type:ft.Ed25519,Data:this.marshal()}).subarray()}equals(e){return be(this.bytes,e.bytes)}async hash(){let{bytes:e}=await Mn.digest(this.bytes);return e}async id(){let e=__.digest(this.public.bytes);return g_.encode(e.bytes).substring(1)}async export(e,t="libp2p-key"){if(t==="libp2p-key")return Cc(this.bytes,e);throw new E(`export format '${t}' is not supported`,"ERR_INVALID_EXPORT_FORMAT")}};function v$(r){if(r.length>pi){r=kc(r,pi+Dc);let n=r.subarray(0,pi),s=r.subarray(pi,r.length);return new ua(n,s)}r=kc(r,pi);let e=r.subarray(0,pi),t=r.subarray(Dc);return new ua(e,t)}function _$(r){return r=kc(r,Dc),new yf(r)}async function S$(){let{privateKey:r,publicKey:e}=await O_();return new ua(r,e)}async function b4(r){let{privateKey:e,publicKey:t}=await L_(r);return new ua(e,t)}function kc(r,e){if(r=Uint8Array.from(r??[]),r.length!==e)throw new E(`Key must be a Uint8Array of length ${e}, got ${r.length}`,"ERR_INVALID_KEY_TYPE");return r}var J1e=W(Ht(),1),e2e=W(xd(),1),V_=W(rt(),1);function os(r,e){let t=Uint8Array.from(r.abs().toByteArray());if(t=t[0]===0?t.subarray(1):t,e!=null){if(t.length>e)throw new Error("byte array longer than desired length");t=Ee([new Uint8Array(e-t.length),t])}return M(t,"base64url")}function bn(r){let e=Pd(r);return new V_.default.jsbn.BigInteger(M(e,"base16"),16)}function Pd(r,e){let t=$(r,"base64urlpad");if(e!=null){if(t.length>e)throw new Error("byte array longer than desired length");t=Ee([new Uint8Array(e-t.length),t])}return t}var z_={"P-256":256,"P-384":384,"P-521":521},A$=Object.keys(z_),x4=A$.join(" / ");async function q_(r){if(r!=="P-256"&&r!=="P-384"&&r!=="P-521")throw new E(`Unknown curve: ${r}. Must be ${x4}`,"ERR_INVALID_CURVE");let e=await Gt.get().subtle.generateKey({name:"ECDH",namedCurve:r},!0,["deriveBits"]),t=async(i,o)=>{let a;o!=null?a=await Gt.get().subtle.importKey("jwk",I$(r,o),{name:"ECDH",namedCurve:r},!1,["deriveBits"]):a=e.privateKey;let c=await Gt.get().subtle.importKey("jwk",$_(r,i),{name:"ECDH",namedCurve:r},!1,[]),l=await Gt.get().subtle.deriveBits({name:"ECDH",namedCurve:r,public:c},a,z_[r]);return new Uint8Array(l,0,l.byteLength)},n=await Gt.get().subtle.exportKey("jwk",e.publicKey);return{key:R$(n),genSharedKey:t}}var K_={"P-256":32,"P-384":48,"P-521":66};function R$(r){if(r.crv==null||r.x==null||r.y==null)throw new E("JWK was missing components","ERR_INVALID_PARAMETERS");if(r.crv!=="P-256"&&r.crv!=="P-384"&&r.crv!=="P-521")throw new E(`Unknown curve: ${r.crv}. Must be ${x4}`,"ERR_INVALID_CURVE");let e=K_[r.crv];return Ee([Uint8Array.from([4]),Pd(r.x,e),Pd(r.y,e)],1+e*2)}function $_(r,e){if(r!=="P-256"&&r!=="P-384"&&r!=="P-521")throw new E(`Unknown curve: ${r}. Must be ${x4}`,"ERR_INVALID_CURVE");let t=K_[r];if(!be(e.subarray(0,1),Uint8Array.from([4])))throw new E("Cannot unmarshal public key - invalid key format","ERR_INVALID_KEY_FORMAT");return{kty:"EC",crv:r,x:M(e.subarray(1,t+1),"base64url"),y:M(e.subarray(1+t),"base64url"),ext:!0}}var I$=(r,e)=>({...$_(r,e.public),d:M(e.private,"base64url")});var H_=q_;async function G_(r,e){let t=Dd.decode(r);return Cd().decrypt(t,e)}var W_={SHA1:20,SHA256:32,SHA512:64};var T$={SHA1:"SHA-1",SHA256:"SHA-256",SHA512:"SHA-512"},D$=async(r,e)=>{let t=await Gt.get().subtle.sign({name:"HMAC"},r,e);return new Uint8Array(t,0,t.byteLength)};async function Y_(r,e){let t=T$[r],n=await Gt.get().subtle.importKey("raw",e,{name:"HMAC",hash:{name:t}},!1,["sign"]);return{async digest(s){return D$(n,s)},length:W_[r]}}var X_={"AES-128":{ivSize:16,keySize:16},"AES-256":{ivSize:16,keySize:32},Blowfish:{ivSize:8,keySize:32}};async function j_(r,e,t){let n=X_[r];if(n==null){let b=Object.keys(X_).join(" / ");throw new E(`unknown cipher type '${r}'. Must be ${b}`,"ERR_INVALID_CIPHER_TYPE")}if(e==null)throw new E("missing hash type","ERR_MISSING_HASH_TYPE");let s=n.keySize,i=n.ivSize,o=20,a=$("key expansion"),c=2*(i+s+o),l=await Y_(e,t),u=await l.digest(a),f=[],h=0;for(;h<c;){let b=await l.digest(Ee([u,a])),w=b.length;h+w>c&&(w=c-h),f.push(b),h+=w,u=await l.digest(u)}let p=c/2,d=Ee(f),m=d.subarray(0,p),g=d.subarray(p,c),y=b=>({iv:b.subarray(0,i),cipherKey:b.subarray(i,i+s),macKey:b.subarray(i+s)});return{k1:y(m),k2:y(g)}}var P4={};Y(P4,{RsaPrivateKey:()=>Fc,RsaPublicKey:()=>Sf,fromJwk:()=>eH,generateKeyPair:()=>tH,unmarshalRsaPrivateKey:()=>Z$,unmarshalRsaPublicKey:()=>J$});var _f=W(rt(),1);var H2e=W(rS(),1);var P$=W(ia(),1);var Me=BigInt(0),dt=BigInt(1),no=BigInt(2),xf=BigInt(3),nS=BigInt(8),Ot=Object.freeze({a:Me,b:BigInt(7),P:BigInt("0xfffffffffffffffffffffffffffffffffffffffffffffffffffffffefffffc2f"),n:BigInt("0xfffffffffffffffffffffffffffffffebaaedce6af48a03bbfd25e8cd0364141"),h:dt,Gx:BigInt("55066263022277343669578718895168534326250603453777594175500187360389116729240"),Gy:BigInt("32670510020758816978083085130507043184471273380659243275938904335757337482424"),beta:BigInt("0x7ae96a2b657c07106e64479eac3434e99cf0497512f58995c1396c28719501ee")}),sS=(r,e)=>(r+e/no)/e,kd={beta:BigInt("0x7ae96a2b657c07106e64479eac3434e99cf0497512f58995c1396c28719501ee"),splitScalar(r){let{n:e}=Ot,t=BigInt("0x3086d221a7d46bcde86c90e49284eb15"),n=-dt*BigInt("0xe4437ed6010e88286f547fa90abfe4c3"),s=BigInt("0x114ca50f7a8e2f3f657c1108d9d44cfd8"),i=t,o=BigInt("0x100000000000000000000000000000000"),a=sS(i*r,e),c=sS(-n*r,e),l=Z(r-a*t-c*s,e),u=Z(-a*n-c*i,e),f=l>o,h=u>o;if(f&&(l=e-l),h&&(u=e-u),l>o||u>o)throw new Error("splitScalarEndo: Endomorphism failed, k="+r);return{k1neg:f,k1:l,k2neg:h,k2:u}}},as=32,Lc=32,k$=32,iS=as+1,oS=2*as+1;function aS(r){let{a:e,b:t}=Ot,n=Z(r*r),s=Z(n*r);return Z(s+e*r+t)}var Nd=Ot.a===Me,Bd=class extends Error{constructor(e){super(e)}};function cS(r){if(!(r instanceof Ke))throw new TypeError("JacobianPoint expected")}var Ke=class{constructor(e,t,n){this.x=e,this.y=t,this.z=n}static fromAffine(e){if(!(e instanceof Ze))throw new TypeError("JacobianPoint#fromAffine: expected Point");return e.equals(Ze.ZERO)?Ke.ZERO:new Ke(e.x,e.y,dt)}static toAffineBatch(e){let t=M$(e.map(n=>n.z));return e.map((n,s)=>n.toAffine(t[s]))}static normalizeZ(e){return Ke.toAffineBatch(e).map(Ke.fromAffine)}equals(e){cS(e);let{x:t,y:n,z:s}=this,{x:i,y:o,z:a}=e,c=Z(s*s),l=Z(a*a),u=Z(t*l),f=Z(i*c),h=Z(Z(n*a)*l),p=Z(Z(o*s)*c);return u===f&&h===p}negate(){return new Ke(this.x,Z(-this.y),this.z)}double(){let{x:e,y:t,z:n}=this,s=Z(e*e),i=Z(t*t),o=Z(i*i),a=e+i,c=Z(no*(Z(a*a)-s-o)),l=Z(xf*s),u=Z(l*l),f=Z(u-no*c),h=Z(l*(c-f)-nS*o),p=Z(no*t*n);return new Ke(f,h,p)}add(e){cS(e);let{x:t,y:n,z:s}=this,{x:i,y:o,z:a}=e;if(i===Me||o===Me)return this;if(t===Me||n===Me)return e;let c=Z(s*s),l=Z(a*a),u=Z(t*l),f=Z(i*c),h=Z(Z(n*a)*l),p=Z(Z(o*s)*c),d=Z(f-u),m=Z(p-h);if(d===Me)return m===Me?this.double():Ke.ZERO;let g=Z(d*d),y=Z(d*g),b=Z(u*g),w=Z(m*m-y-no*b),v=Z(m*(b-w)-h*y),x=Z(s*a*d);return new Ke(w,v,x)}subtract(e){return this.add(e.negate())}multiplyUnsafe(e){let t=Ke.ZERO;if(typeof e=="bigint"&&e===Me)return t;let n=fS(e);if(n===dt)return this;if(!Nd){let f=t,h=this;for(;n>Me;)n&dt&&(f=f.add(h)),h=h.double(),n>>=dt;return f}let{k1neg:s,k1:i,k2neg:o,k2:a}=kd.splitScalar(n),c=t,l=t,u=this;for(;i>Me||a>Me;)i&dt&&(c=c.add(u)),a&dt&&(l=l.add(u)),u=u.double(),i>>=dt,a>>=dt;return s&&(c=c.negate()),o&&(l=l.negate()),l=new Ke(Z(l.x*kd.beta),l.y,l.z),c.add(l)}precomputeWindow(e){let t=Nd?128/e+1:256/e+1,n=[],s=this,i=s;for(let o=0;o<t;o++){i=s,n.push(i);for(let a=1;a<2**(e-1);a++)i=i.add(s),n.push(i);s=i.double()}return n}wNAF(e,t){!t&&this.equals(Ke.BASE)&&(t=Ze.BASE);let n=t&&t._WINDOW_SIZE||1;if(256%n)throw new Error("Point#wNAF: Invalid precomputation window, must be power of 2");let s=t&&S4.get(t);s||(s=this.precomputeWindow(n),t&&n!==1&&(s=Ke.normalizeZ(s),S4.set(t,s)));let i=Ke.ZERO,o=Ke.BASE,a=1+(Nd?128/n:256/n),c=2**(n-1),l=BigInt(2**n-1),u=2**n,f=BigInt(n);for(let h=0;h<a;h++){let p=h*c,d=Number(e&l);e>>=f,d>c&&(d-=u,e+=dt);let m=p,g=p+Math.abs(d)-1,y=h%2!==0,b=d<0;d===0?o=o.add(Od(y,s[m])):i=i.add(Od(b,s[g]))}return{p:i,f:o}}multiply(e,t){let n=fS(e),s,i;if(Nd){let{k1neg:o,k1:a,k2neg:c,k2:l}=kd.splitScalar(n),{p:u,f}=this.wNAF(a,t),{p:h,f:p}=this.wNAF(l,t);u=Od(o,u),h=Od(c,h),h=new Ke(Z(h.x*kd.beta),h.y,h.z),s=u.add(h),i=f.add(p)}else{let{p:o,f:a}=this.wNAF(n,t);s=o,i=a}return Ke.normalizeZ([s,i])[0]}toAffine(e){let{x:t,y:n,z:s}=this,i=this.equals(Ke.ZERO);e==null&&(e=i?nS:Uc(s));let o=e,a=Z(o*o),c=Z(a*o),l=Z(t*a),u=Z(n*c),f=Z(s*o);if(i)return Ze.ZERO;if(f!==dt)throw new Error("invZ was invalid");return new Ze(l,u)}};Ke.BASE=new Ke(Ot.Gx,Ot.Gy,dt);Ke.ZERO=new Ke(Me,dt,Me);function Od(r,e){let t=e.negate();return r?t:e}var S4=new WeakMap,Ze=class{constructor(e,t){this.x=e,this.y=t}_setWindowSize(e){this._WINDOW_SIZE=e,S4.delete(this)}hasEvenY(){return this.y%no===Me}static fromCompressedHex(e){let t=e.length===32,n=so(t?e:e.subarray(1));if(!_4(n))throw new Error("Point is not on curve");let s=aS(n),i=B$(s),o=(i&dt)===dt;t?o&&(i=Z(-i)):(e[0]&1)===1!==o&&(i=Z(-i));let a=new Ze(n,i);return a.assertValidity(),a}static fromUncompressedHex(e){let t=so(e.subarray(1,as+1)),n=so(e.subarray(as+1,as*2+1)),s=new Ze(t,n);return s.assertValidity(),s}static fromHex(e){let t=Mc(e),n=t.length,s=t[0];if(n===as)return this.fromCompressedHex(t);if(n===iS&&(s===2||s===3))return this.fromCompressedHex(t);if(n===oS&&s===4)return this.fromUncompressedHex(t);throw new Error(`Point.fromHex: received invalid point. Expected 32-${iS} compressed bytes or ${oS} uncompressed bytes, not ${n}`)}static fromPrivateKey(e){return Ze.BASE.multiply(Ud(e))}static fromSignature(e,t,n){let{r:s,s:i}=hS(t);if(![0,1,2,3].includes(n))throw new Error("Cannot recover: invalid recovery bit");let o=I4(Mc(e)),{n:a}=Ot,c=n===2||n===3?s+a:s,l=Uc(c,a),u=Z(-o*l,a),f=Z(i*l,a),h=n&1?"03":"02",p=Ze.fromHex(h+Nc(c)),d=Ze.BASE.multiplyAndAddUnsafe(p,u,f);if(!d)throw new Error("Cannot recover signature: point at infinify");return d.assertValidity(),d}toRawBytes(e=!1){return ha(this.toHex(e))}toHex(e=!1){let t=Nc(this.x);return e?`${this.hasEvenY()?"02":"03"}${t}`:`04${t}${Nc(this.y)}`}toHexX(){return this.toHex(!0).slice(2)}toRawX(){return this.toRawBytes(!0).slice(1)}assertValidity(){let e="Point is not on elliptic curve",{x:t,y:n}=this;if(!_4(t)||!_4(n))throw new Error(e);let s=Z(n*n),i=aS(t);if(Z(s-i)!==Me)throw new Error(e)}equals(e){return this.x===e.x&&this.y===e.y}negate(){return new Ze(this.x,Z(-this.y))}double(){return Ke.fromAffine(this).double().toAffine()}add(e){return Ke.fromAffine(this).add(Ke.fromAffine(e)).toAffine()}subtract(e){return this.add(e.negate())}multiply(e){return Ke.fromAffine(this).multiply(e,this).toAffine()}multiplyAndAddUnsafe(e,t,n){let s=Ke.fromAffine(this),i=t===Me||t===dt||this!==Ze.BASE?s.multiplyUnsafe(t):s.multiply(t),o=Ke.fromAffine(e).multiplyUnsafe(n),a=i.add(o);return a.equals(Ke.ZERO)?void 0:a.toAffine()}};Ze.BASE=new Ze(Ot.Gx,Ot.Gy);Ze.ZERO=new Ze(Me,Me);function lS(r){return Number.parseInt(r[0],16)>=8?"00"+r:r}function uS(r){if(r.length<2||r[0]!==2)throw new Error(`Invalid signature integer tag: ${Bc(r)}`);let e=r[1],t=r.subarray(2,e+2);if(!e||t.length!==e)throw new Error("Invalid signature integer: wrong length");if(t[0]===0&&t[1]<=127)throw new Error("Invalid signature integer: trailing length");return{data:so(t),left:r.subarray(e+2)}}function N$(r){if(r.length<2||r[0]!=48)throw new Error(`Invalid signature tag: ${Bc(r)}`);if(r[1]!==r.length-2)throw new Error("Invalid signature: incorrect length");let{data:e,left:t}=uS(r.subarray(2)),{data:n,left:s}=uS(t);if(s.length)throw new Error(`Invalid signature: left bytes after parsing: ${Bc(s)}`);return{r:e,s:n}}var Bs=class{constructor(e,t){this.r=e,this.s=t,this.assertValidity()}static fromCompact(e){let t=e instanceof Uint8Array,n="Signature.fromCompact";if(typeof e!="string"&&!t)throw new TypeError(`${n}: Expected string or Uint8Array`);let s=t?Bc(e):e;if(s.length!==128)throw new Error(`${n}: Expected 64-byte hex`);return new Bs(Md(s.slice(0,64)),Md(s.slice(64,128)))}static fromDER(e){let t=e instanceof Uint8Array;if(typeof e!="string"&&!t)throw new TypeError("Signature.fromDER: Expected string or Uint8Array");let{r:n,s}=N$(t?e:ha(e));return new Bs(n,s)}static fromHex(e){return this.fromDER(e)}assertValidity(){let{r:e,s:t}=this;if(!vf(e))throw new Error("Invalid Signature: r must be 0 < r < n");if(!vf(t))throw new Error("Invalid Signature: s must be 0 < s < n")}hasHighS(){let e=Ot.n>>dt;return this.s>e}normalizeS(){return this.hasHighS()?new Bs(this.r,Z(-this.s,Ot.n)):this}toDERRawBytes(){return ha(this.toDERHex())}toDERHex(){let e=lS(wf(this.s)),t=lS(wf(this.r)),n=e.length/2,s=t.length/2,i=wf(n),o=wf(s);return`30${wf(s+n+4)}02${o}${t}02${i}${e}`}toRawBytes(){return this.toDERRawBytes()}toHex(){return this.toDERHex()}toCompactRawBytes(){return ha(this.toCompactHex())}toCompactHex(){return Nc(this.r)+Nc(this.s)}};function ro(...r){if(!r.every(n=>n instanceof Uint8Array))throw new Error("Uint8Array list expected");if(r.length===1)return r[0];let e=r.reduce((n,s)=>n+s.length,0),t=new Uint8Array(e);for(let n=0,s=0;n<r.length;n++){let i=r[n];t.set(i,s),s+=i.length}return t}var O$=Array.from({length:256},(r,e)=>e.toString(16).padStart(2,"0"));function Bc(r){if(!(r instanceof Uint8Array))throw new Error("Expected Uint8Array");let e="";for(let t=0;t<r.length;t++)e+=O$[r[t]];return e}var L$=BigInt("0x10000000000000000000000000000000000000000000000000000000000000000");function Nc(r){if(typeof r!="bigint")throw new Error("Expected bigint");if(!(Me<=r&&r<L$))throw new Error("Expected number 0 <= n < 2^256");return r.toString(16).padStart(64,"0")}function A4(r){let e=ha(Nc(r));if(e.length!==32)throw new Error("Error: expected 32 bytes");return e}function wf(r){let e=r.toString(16);return e.length&1?`0${e}`:e}function Md(r){if(typeof r!="string")throw new TypeError("hexToNumber: expected string, got "+typeof r);return BigInt(`0x${r}`)}function ha(r){if(typeof r!="string")throw new TypeError("hexToBytes: expected string, got "+typeof r);if(r.length%2)throw new Error("hexToBytes: received invalid unpadded hex"+r.length);let e=new Uint8Array(r.length/2);for(let t=0;t<e.length;t++){let n=t*2,s=r.slice(n,n+2),i=Number.parseInt(s,16);if(Number.isNaN(i)||i<0)throw new Error("Invalid byte sequence");e[t]=i}return e}function so(r){return Md(Bc(r))}function Mc(r){return r instanceof Uint8Array?Uint8Array.from(r):ha(r)}function fS(r){if(typeof r=="number"&&Number.isSafeInteger(r)&&r>0)return BigInt(r);if(typeof r=="bigint"&&vf(r))return r;throw new TypeError("Expected valid private scalar: 0 < scalar < curve.n")}function Z(r,e=Ot.P){let t=r%e;return t>=Me?t:e+t}function Un(r,e){let{P:t}=Ot,n=r;for(;e-- >Me;)n*=n,n%=t;return n}function B$(r){let{P:e}=Ot,t=BigInt(6),n=BigInt(11),s=BigInt(22),i=BigInt(23),o=BigInt(44),a=BigInt(88),c=r*r*r%e,l=c*c*r%e,u=Un(l,xf)*l%e,f=Un(u,xf)*l%e,h=Un(f,no)*c%e,p=Un(h,n)*h%e,d=Un(p,s)*p%e,m=Un(d,o)*d%e,g=Un(m,a)*m%e,y=Un(g,o)*d%e,b=Un(y,xf)*l%e,w=Un(b,i)*p%e,v=Un(w,t)*c%e,x=Un(v,no);if(x*x%e!==r)throw new Error("Cannot find square root");return x}function Uc(r,e=Ot.P){if(r===Me||e<=Me)throw new Error(`invert: expected positive integers, got n=${r} mod=${e}`);let t=Z(r,e),n=e,s=Me,i=dt,o=dt,a=Me;for(;t!==Me;){let l=n/t,u=n%t,f=s-o*l,h=i-a*l;n=t,t=u,s=o,i=a,o=f,a=h}if(n!==dt)throw new Error("invert: does not exist");return Z(s,e)}function M$(r,e=Ot.P){let t=new Array(r.length),n=r.reduce((i,o,a)=>o===Me?i:(t[a]=i,Z(i*o,e)),dt),s=Uc(n,e);return r.reduceRight((i,o,a)=>o===Me?i:(t[a]=Z(i*t[a],e),Z(i*o,e)),s),t}function U$(r){let e=r.length*8-Lc*8,t=so(r);return e>0?t>>BigInt(e):t}function I4(r,e=!1){let t=U$(r);if(e)return t;let{n}=Ot;return t>=n?t-n:t}var Oc,Ef,R4=class{constructor(e,t){if(this.hashLen=e,this.qByteLen=t,typeof e!="number"||e<2)throw new Error("hashLen must be a number");if(typeof t!="number"||t<2)throw new Error("qByteLen must be a number");this.v=new Uint8Array(e).fill(1),this.k=new Uint8Array(e).fill(0),this.counter=0}hmac(...e){return cs.hmacSha256(this.k,...e)}hmacSync(...e){return Ef(this.k,...e)}checkSync(){if(typeof Ef!="function")throw new Bd("hmacSha256Sync needs to be set")}incr(){if(this.counter>=1e3)throw new Error("Tried 1,000 k values for sign(), all were invalid");this.counter+=1}async reseed(e=new Uint8Array){this.k=await this.hmac(this.v,Uint8Array.from([0]),e),this.v=await this.hmac(this.v),e.length!==0&&(this.k=await this.hmac(this.v,Uint8Array.from([1]),e),this.v=await this.hmac(this.v))}reseedSync(e=new Uint8Array){this.checkSync(),this.k=this.hmacSync(this.v,Uint8Array.from([0]),e),this.v=this.hmacSync(this.v),e.length!==0&&(this.k=this.hmacSync(this.v,Uint8Array.from([1]),e),this.v=this.hmacSync(this.v))}async generate(){this.incr();let e=0,t=[];for(;e<this.qByteLen;){this.v=await this.hmac(this.v);let n=this.v.slice();t.push(n),e+=this.v.length}return ro(...t)}generateSync(){this.checkSync(),this.incr();let e=0,t=[];for(;e<this.qByteLen;){this.v=this.hmacSync(this.v);let n=this.v.slice();t.push(n),e+=this.v.length}return ro(...t)}};function vf(r){return Me<r&&r<Ot.n}function _4(r){return Me<r&&r<Ot.P}function F$(r,e,t,n=!0){let{n:s}=Ot,i=I4(r,!0);if(!vf(i))return;let o=Uc(i,s),a=Ze.BASE.multiply(i),c=Z(a.x,s);if(c===Me)return;let l=Z(o*Z(e+t*c,s),s);if(l===Me)return;let u=new Bs(c,l),f=(a.x===u.r?0:2)|Number(a.y&dt);return n&&u.hasHighS()&&(u=u.normalizeS(),f^=1),{sig:u,recovery:f}}function Ud(r){let e;if(typeof r=="bigint")e=r;else if(typeof r=="number"&&Number.isSafeInteger(r)&&r>0)e=BigInt(r);else if(typeof r=="string"){if(r.length!==2*Lc)throw new Error("Expected 32 bytes of private key");e=Md(r)}else if(r instanceof Uint8Array){if(r.length!==Lc)throw new Error("Expected 32 bytes of private key");e=so(r)}else throw new TypeError("Expected valid private key");if(!vf(e))throw new Error("Expected private key: 0 < key < n");return e}function V$(r){return r instanceof Ze?(r.assertValidity(),r):Ze.fromHex(r)}function hS(r){if(r instanceof Bs)return r.assertValidity(),r;try{return Bs.fromDER(r)}catch{return Bs.fromCompact(r)}}function T4(r,e=!1){return Ze.fromPrivateKey(r).toRawBytes(e)}function dS(r){let e=r.length>as?r.slice(0,as):r;return so(e)}function z$(r){let e=dS(r),t=Z(e,Ot.n);return pS(t<Me?e:t)}function pS(r){return A4(r)}function q$(r,e,t){if(r==null)throw new Error(`sign: expected valid message hash, not "${r}"`);let n=Mc(r),s=Ud(e),i=[pS(s),z$(n)];if(t!=null){t===!0&&(t=cs.randomBytes(as));let c=Mc(t);if(c.length!==as)throw new Error(`sign: Expected ${as} bytes of extra data`);i.push(c)}let o=ro(...i),a=dS(n);return{seed:o,m:a,d:s}}function K$(r,e){let{sig:t,recovery:n}=r,{der:s,recovered:i}=Object.assign({canonical:!0,der:!0},e),o=s?t.toDERRawBytes():t.toCompactRawBytes();return i?[o,n]:o}async function mS(r,e,t={}){let{seed:n,m:s,d:i}=q$(r,e,t.extraEntropy),o=new R4(k$,Lc);await o.reseed(n);let a;for(;!(a=F$(await o.generate(),s,i,t.canonical));)await o.reseed();return K$(a,t)}var $$={strict:!0};function gS(r,e,t,n=$$){let s;try{s=hS(r),e=Mc(e)}catch{return!1}let{r:i,s:o}=s;if(n.strict&&s.hasHighS())return!1;let a=I4(e),c;try{c=V$(t)}catch{return!1}let{n:l}=Ot,u=Uc(o,l),f=Z(a*u,l),h=Z(i*u,l),p=Ze.BASE.multiplyAndAddUnsafe(c,f,h);return p?Z(p.x,l)===i:!1}Ze.BASE._setWindowSize(8);var wn={node:P$,web:typeof self=="object"&&"crypto"in self?self.crypto:void 0};var Ld={},cs={bytesToHex:Bc,hexToBytes:ha,concatBytes:ro,mod:Z,invert:Uc,isValidPrivateKey(r){try{return Ud(r),!0}catch{return!1}},_bigintTo32Bytes:A4,_normalizePrivateKey:Ud,hashToPrivateKey:r=>{r=Mc(r);let e=Lc+8;if(r.length<e||r.length>1024)throw new Error("Expected valid bytes of private key as per FIPS 186");let t=Z(so(r),Ot.n-dt)+dt;return A4(t)},randomBytes:(r=32)=>{if(wn.web)return wn.web.getRandomValues(new Uint8Array(r));if(wn.node){let{randomBytes:e}=wn.node;return Uint8Array.from(e(r))}else throw new Error("The environment doesn't have randomBytes function")},randomPrivateKey:()=>cs.hashToPrivateKey(cs.randomBytes(Lc+8)),precompute(r=8,e=Ze.BASE){let t=e===Ze.BASE?e:new Ze(e.x,e.y);return t._setWindowSize(r),t.multiply(xf),t},sha256:async(...r)=>{if(wn.web){let e=await wn.web.subtle.digest("SHA-256",ro(...r));return new Uint8Array(e)}else if(wn.node){let{createHash:e}=wn.node,t=e("sha256");return r.forEach(n=>t.update(n)),Uint8Array.from(t.digest())}else throw new Error("The environment doesn't have sha256 function")},hmacSha256:async(r,...e)=>{if(wn.web){let t=await wn.web.subtle.importKey("raw",r,{name:"HMAC",hash:{name:"SHA-256"}},!1,["sign"]),n=ro(...e),s=await wn.web.subtle.sign("HMAC",t,n);return new Uint8Array(s)}else if(wn.node){let{createHmac:t}=wn.node,n=t("sha256",r);return e.forEach(s=>n.update(s)),Uint8Array.from(n.digest())}else throw new Error("The environment doesn't have hmac-sha256 function")},sha256Sync:void 0,hmacSha256Sync:void 0,taggedHash:async(r,...e)=>{let t=Ld[r];if(t===void 0){let n=await cs.sha256(Uint8Array.from(r,s=>s.charCodeAt(0)));t=ro(n,n),Ld[r]=t}return cs.sha256(t,...e)},taggedHashSync:(r,...e)=>{if(typeof Oc!="function")throw new Bd("sha256Sync is undefined, you need to set it");let t=Ld[r];if(t===void 0){let n=Oc(Uint8Array.from(r,s=>s.charCodeAt(0)));t=ro(n,n),Ld[r]=t}return Oc(t,...e)},_JacobianPoint:Ke};Object.defineProperties(cs,{sha256Sync:{configurable:!1,get(){return Oc},set(r){Oc||(Oc=r)}},hmacSha256Sync:{configurable:!1,get(){return Ef},set(r){Ef||(Ef=r)}}});function Fn(r){if(isNaN(r)||r<=0)throw new E("random bytes length must be a Number bigger than 0","ERR_INVALID_LENGTH");return cs.randomBytes(r)}var I2e=W(_d(),1),D4=W(rt(),1);function yS(r,e){return e.map(t=>bn(r[t]))}function bS(r){return D4.default.pki.setRsaPrivateKey(...yS(r,["n","e","d","p","q","dp","dq","qi"]))}function wS(r){return D4.default.pki.setRsaPublicKey(...yS(r,["n","e"]))}var da={};Y(da,{jwkToPkcs1:()=>W$,jwkToPkix:()=>Q$,pkcs1ToJwk:()=>G$,pkixToJwk:()=>Y$});var C2e=W(af(),1),P2e=W(_d(),1);var mi=W(rt(),1);function G$(r){let e=mi.default.asn1.fromDer(M(r,"ascii")),t=mi.default.pki.privateKeyFromAsn1(e);return{kty:"RSA",n:os(t.n),e:os(t.e),d:os(t.d),p:os(t.p),q:os(t.q),dp:os(t.dP),dq:os(t.dQ),qi:os(t.qInv),alg:"RS256"}}function W$(r){if(r.n==null||r.e==null||r.d==null||r.p==null||r.q==null||r.dp==null||r.dq==null||r.qi==null)throw new E("JWK was missing components","ERR_INVALID_PARAMETERS");let e=mi.default.pki.privateKeyToAsn1({n:bn(r.n),e:bn(r.e),d:bn(r.d),p:bn(r.p),q:bn(r.q),dP:bn(r.dp),dQ:bn(r.dq),qInv:bn(r.qi)});return $(mi.default.asn1.toDer(e).getBytes(),"ascii")}function Y$(r){let e=mi.default.asn1.fromDer(M(r,"ascii")),t=mi.default.pki.publicKeyFromAsn1(e);return{kty:"RSA",n:os(t.n),e:os(t.e)}}function Q$(r){if(r.n==null||r.e==null)throw new E("JWK was missing components","ERR_INVALID_PARAMETERS");let e=mi.default.pki.publicKeyToAsn1({n:bn(r.n),e:bn(r.e)});return $(mi.default.asn1.toDer(e).getBytes(),"ascii")}async function xS(r){let e=await Gt.get().subtle.generateKey({name:"RSASSA-PKCS1-v1_5",modulusLength:r,publicExponent:new Uint8Array([1,0,1]),hash:{name:"SHA-256"}},!0,["sign","verify"]),t=await _S(e);return{privateKey:t[0],publicKey:t[1]}}async function C4(r){let t=[await Gt.get().subtle.importKey("jwk",r,{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}},!0,["sign"]),await X$(r)],n=await _S({privateKey:t[0],publicKey:t[1]});return{privateKey:n[0],publicKey:n[1]}}async function ES(r,e){let t=await Gt.get().subtle.importKey("jwk",r,{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}},!1,["sign"]),n=await Gt.get().subtle.sign({name:"RSASSA-PKCS1-v1_5"},t,Uint8Array.from(e));return new Uint8Array(n,0,n.byteLength)}async function vS(r,e,t){let n=await Gt.get().subtle.importKey("jwk",r,{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}},!1,["verify"]);return Gt.get().subtle.verify({name:"RSASSA-PKCS1-v1_5"},n,e,t)}async function _S(r){if(r.privateKey==null||r.publicKey==null)throw new E("Private and public key are required","ERR_INVALID_PARAMETERS");return Promise.all([Gt.get().subtle.exportKey("jwk",r.privateKey),Gt.get().subtle.exportKey("jwk",r.publicKey)])}async function X$(r){return Gt.get().subtle.importKey("jwk",{kty:r.kty,n:r.n,e:r.e},{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}},!0,["verify"])}function SS(r,e,t,n){let s=e?wS(r):bS(r),i=M(Uint8Array.from(t),"ascii"),o=n(i,s);return $(o,"ascii")}function AS(r,e){return SS(r,!0,e,(t,n)=>n.encrypt(t))}function RS(r,e){return SS(r,!1,e,(t,n)=>n.decrypt(t))}var Sf=class{_key;constructor(e){this._key=e}async verify(e,t){return vS(this._key,t,e)}marshal(){return da.jwkToPkix(this._key)}get bytes(){return ss.encode({Type:ft.RSA,Data:this.marshal()}).subarray()}encrypt(e){return AS(this._key,e)}equals(e){return be(this.bytes,e.bytes)}async hash(){let{bytes:e}=await Mn.digest(this.bytes);return e}},Fc=class{_key;_publicKey;constructor(e,t){this._key=e,this._publicKey=t}genSecret(){return Fn(16)}async sign(e){return ES(this._key,e)}get public(){if(this._publicKey==null)throw new E("public key not provided","ERR_PUBKEY_NOT_PROVIDED");return new Sf(this._publicKey)}decrypt(e){return RS(this._key,e)}marshal(){return da.jwkToPkcs1(this._key)}get bytes(){return is.encode({Type:ft.RSA,Data:this.marshal()}).subarray()}equals(e){return be(this.bytes,e.bytes)}async hash(){let{bytes:e}=await Mn.digest(this.bytes);return e}async id(){let e=await this.public.hash();return M(e,"base58btc")}async export(e,t="pkcs-8"){if(t==="pkcs-8"){let n=new _f.default.util.ByteBuffer(this.marshal()),s=_f.default.asn1.fromDer(n),i=_f.default.pki.privateKeyFromAsn1(s),o={algorithm:"aes256",count:1e4,saltSize:128/8,prfAlgorithm:"sha512"};return _f.default.pki.encryptRsaPrivateKey(i,e,o)}else{if(t==="libp2p-key")return Cc(this.bytes,e);throw new E(`export format '${t}' is not supported`,"ERR_INVALID_EXPORT_FORMAT")}}};async function Z$(r){let e=da.pkcs1ToJwk(r),t=await C4(e);return new Fc(t.privateKey,t.publicKey)}function J$(r){let e=da.pkixToJwk(r);return new Sf(e)}async function eH(r){let e=await C4(r);return new Fc(e.privateKey,e.publicKey)}async function tH(r){let e=await xS(r);return new Fc(e.privateKey,e.publicKey)}var N4={};Y(N4,{Secp256k1PrivateKey:()=>Rf,Secp256k1PublicKey:()=>Af,generateKeyPair:()=>iH,unmarshalSecp256k1PrivateKey:()=>nH,unmarshalSecp256k1PublicKey:()=>sH});function IS(){return cs.randomPrivateKey()}async function TS(r,e){let{digest:t}=await Mn.digest(e);try{return await mS(t,r)}catch(n){throw new E(String(n),"ERR_INVALID_INPUT")}}async function DS(r,e,t){try{let{digest:n}=await Mn.digest(t);return gS(e,n,r)}catch(n){throw new E(String(n),"ERR_INVALID_INPUT")}}function CS(r){return Ze.fromHex(r).toRawBytes(!0)}function PS(r){try{T4(r,!0)}catch(e){throw new E(String(e),"ERR_INVALID_PRIVATE_KEY")}}function k4(r){try{Ze.fromHex(r)}catch(e){throw new E(String(e),"ERR_INVALID_PUBLIC_KEY")}}function kS(r){try{return T4(r,!0)}catch(e){throw new E(String(e),"ERR_INVALID_PRIVATE_KEY")}}var Af=class{_key;constructor(e){k4(e),this._key=e}async verify(e,t){return DS(this._key,t,e)}marshal(){return CS(this._key)}get bytes(){return ss.encode({Type:ft.Secp256k1,Data:this.marshal()}).subarray()}equals(e){return be(this.bytes,e.bytes)}async hash(){let{bytes:e}=await Mn.digest(this.bytes);return e}},Rf=class{_key;_publicKey;constructor(e,t){this._key=e,this._publicKey=t??kS(e),PS(this._key),k4(this._publicKey)}async sign(e){return TS(this._key,e)}get public(){return new Af(this._publicKey)}marshal(){return this._key}get bytes(){return is.encode({Type:ft.Secp256k1,Data:this.marshal()}).subarray()}equals(e){return be(this.bytes,e.bytes)}async hash(){let{bytes:e}=await Mn.digest(this.bytes);return e}async id(){let e=await this.public.hash();return M(e,"base58btc")}async export(e,t="libp2p-key"){if(t==="libp2p-key")return Cc(this.bytes,e);throw new E(`export format '${t}' is not supported`,"ERR_INVALID_EXPORT_FORMAT")}};function nH(r){return new Rf(r)}function sH(r){return new Af(r)}async function iH(){let r=IS();return new Rf(r)}var Ms={rsa:P4,ed25519:w4,secp256k1:N4};function O4(r){let e=Object.keys(Ms).join(" / ");return new E(`invalid or unsupported key type ${r}. Must be ${e}`,"ERR_UNSUPPORTED_KEY_TYPE")}function L4(r){if(r=r.toLowerCase(),r==="rsa"||r==="ed25519"||r==="secp256k1")return Ms[r];throw O4(r)}async function If(r,e){return L4(r).generateKeyPair(e??2048)}async function oH(r,e,t){if(r.toLowerCase()!=="ed25519")throw new E("Seed key derivation is unimplemented for RSA or secp256k1","ERR_UNSUPPORTED_KEY_DERIVATION_TYPE");return b4(e)}function Yr(r){let e=ss.decode(r),t=e.Data??new Uint8Array;switch(e.Type){case ft.RSA:return Ms.rsa.unmarshalRsaPublicKey(t);case ft.Ed25519:return Ms.ed25519.unmarshalEd25519PublicKey(t);case ft.Secp256k1:return Ms.secp256k1.unmarshalSecp256k1PublicKey(t);default:throw O4(e.Type??"RSA")}}function Tf(r,e){return e=(e??"rsa").toLowerCase(),L4(e),r.bytes}async function ls(r){let e=is.decode(r),t=e.Data??new Uint8Array;switch(e.Type){case ft.RSA:return Ms.rsa.unmarshalRsaPrivateKey(t);case ft.Ed25519:return Ms.ed25519.unmarshalEd25519PrivateKey(t);case ft.Secp256k1:return Ms.secp256k1.unmarshalSecp256k1PrivateKey(t);default:throw O4(e.Type??"RSA")}}function B4(r,e){return e=(e??"rsa").toLowerCase(),L4(e),r.bytes}async function Vc(r,e){try{let s=await G_(r,e);return await ls(s)}catch{}let t=Fd.default.pki.decryptRsaPrivateKey(r,e);if(t===null)throw new E("Cannot read the key, most likely the password is wrong or not a RSA key","ERR_CANNOT_DECRYPT_PEM");let n=Fd.default.asn1.toDer(Fd.default.pki.privateKeyToAsn1(t));return n=$(n.getBytes(),"ascii"),Ms.rsa.unmarshalRsaPrivateKey(n)}var Df=Symbol.for("@libp2p/content-routing");var pa=Symbol.for("@libp2p/peer-discovery");var Cf=Symbol.for("@libp2p/peer-routing");var $e=class extends EventTarget{#e=new Map;listenerCount(e){let t=this.#e.get(e);return t==null?0:t.length}addEventListener(e,t,n){super.addEventListener(e,t,n);let s=this.#e.get(e);s==null&&(s=[],this.#e.set(e,s)),s.push({callback:t,once:(n!==!0&&n!==!1&&n?.once)??!1})}removeEventListener(e,t,n){super.removeEventListener(e.toString(),t??null,n);let s=this.#e.get(e);s!=null&&(s=s.filter(({callback:i})=>i!==t),this.#e.set(e,s))}dispatchEvent(e){let t=super.dispatchEvent(e),n=this.#e.get(e.type);return n==null||(n=n.filter(({once:s})=>!s),this.#e.set(e.type,n)),t}safeDispatchEvent(e,t){return this.dispatchEvent(new tt(e,t))}},M4=class extends Event{detail;constructor(e,t){super(e,t),this.detail=t?.detail}},tt=globalThis.CustomEvent??M4;var pme=W(hd(),1),aH=W(rt(),1);var OS=W(V3(),1),LS=W(Ht(),1),NS={sha1:"sha1","sha2-256":"sha256","sha2-512":"sha512"};function Pf(r,e,t,n,s){if(s!=="sha1"&&s!=="sha2-256"&&s!=="sha2-512"){let a=Object.keys(NS).join(" / ");throw new E(`Hash '${s}' is unknown or not supported. Must be ${a}`,"ERR_UNSUPPORTED_HASH_TYPE")}let i=NS[s],o=(0,OS.default)(r,e,t,n,i);return LS.default.encode64(o,null)}var U4=Symbol.for("@libp2p/peer-id");function zd(r){return r!=null&&!!r[U4]}var K4={};Y(K4,{base58btc:()=>xn,base58flickr:()=>mH});function uH(r,e){if(r.length>=255)throw new TypeError("Alphabet too long");for(var t=new Uint8Array(256),n=0;n<t.length;n++)t[n]=255;for(var s=0;s<r.length;s++){var i=r.charAt(s),o=i.charCodeAt(0);if(t[o]!==255)throw new TypeError(i+" is ambiguous");t[o]=s}var a=r.length,c=r.charAt(0),l=Math.log(a)/Math.log(256),u=Math.log(256)/Math.log(a);function f(d){if(d instanceof Uint8Array||(ArrayBuffer.isView(d)?d=new Uint8Array(d.buffer,d.byteOffset,d.byteLength):Array.isArray(d)&&(d=Uint8Array.from(d))),!(d instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(d.length===0)return"";for(var m=0,g=0,y=0,b=d.length;y!==b&&d[y]===0;)y++,m++;for(var w=(b-y)*u+1>>>0,v=new Uint8Array(w);y!==b;){for(var x=d[y],_=0,S=w-1;(x!==0||_<g)&&S!==-1;S--,_++)x+=256*v[S]>>>0,v[S]=x%a>>>0,x=x/a>>>0;if(x!==0)throw new Error("Non-zero carry");g=_,y++}for(var A=w-g;A!==w&&v[A]===0;)A++;for(var D=c.repeat(m);A<w;++A)D+=r.charAt(v[A]);return D}function h(d){if(typeof d!="string")throw new TypeError("Expected String");if(d.length===0)return new Uint8Array;var m=0;if(d[m]!==" "){for(var g=0,y=0;d[m]===c;)g++,m++;for(var b=(d.length-m)*l+1>>>0,w=new Uint8Array(b);d[m];){var v=t[d.charCodeAt(m)];if(v===255)return;for(var x=0,_=b-1;(v!==0||x<y)&&_!==-1;_--,x++)v+=a*w[_]>>>0,w[_]=v%256>>>0,v=v/256>>>0;if(v!==0)throw new Error("Non-zero carry");y=x,m++}if(d[m]!==" "){for(var S=b-y;S!==b&&w[S]===0;)S++;for(var A=new Uint8Array(g+(b-S)),D=g;S!==b;)A[D++]=w[S++];return A}}}function p(d){var m=h(d);if(m)return m;throw new Error(`Non-${e} character`)}return{encode:f,decodeUnsafe:h,decode:p}}var fH=uH,hH=fH,BS=hH;var Tme=new Uint8Array(0);var MS=(r,e)=>{if(r===e)return!0;if(r.byteLength!==e.byteLength)return!1;for(let t=0;t<r.byteLength;t++)if(r[t]!==e[t])return!1;return!0},gi=r=>{if(r instanceof Uint8Array&&r.constructor.name==="Uint8Array")return r;if(r instanceof ArrayBuffer)return new Uint8Array(r);if(ArrayBuffer.isView(r))return new Uint8Array(r.buffer,r.byteOffset,r.byteLength);throw new Error("Unknown type, must be binary type")};var US=r=>new TextEncoder().encode(r),FS=r=>new TextDecoder().decode(r);var F4=class{constructor(e,t,n){this.name=e,this.prefix=t,this.baseEncode=n}encode(e){if(e instanceof Uint8Array)return`${this.prefix}${this.baseEncode(e)}`;throw Error("Unknown type, must be binary type")}},V4=class{constructor(e,t,n){if(this.name=e,this.prefix=t,t.codePointAt(0)===void 0)throw new Error("Invalid prefix character");this.prefixCodePoint=t.codePointAt(0),this.baseDecode=n}decode(e){if(typeof e=="string"){if(e.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(e)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(e.slice(this.prefix.length))}else throw Error("Can only multibase decode strings")}or(e){return zS(this,e)}},z4=class{constructor(e){this.decoders=e}or(e){return zS(this,e)}decode(e){let t=e[0],n=this.decoders[t];if(n)return n.decode(e);throw RangeError(`Unable to decode multibase string ${JSON.stringify(e)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}},zS=(r,e)=>new z4({...r.decoders||{[r.prefix]:r},...e.decoders||{[e.prefix]:e}}),q4=class{constructor(e,t,n,s){this.name=e,this.prefix=t,this.baseEncode=n,this.baseDecode=s,this.encoder=new F4(e,t,n),this.decoder=new V4(e,t,s)}encode(e){return this.encoder.encode(e)}decode(e){return this.decoder.decode(e)}},zc=({name:r,prefix:e,encode:t,decode:n})=>new q4(r,e,t,n),io=({prefix:r,name:e,alphabet:t})=>{let{encode:n,decode:s}=BS(t,e);return zc({prefix:r,name:e,encode:n,decode:i=>gi(s(i))})},dH=(r,e,t,n)=>{let s={};for(let u=0;u<e.length;++u)s[e[u]]=u;let i=r.length;for(;r[i-1]==="=";)--i;let o=new Uint8Array(i*t/8|0),a=0,c=0,l=0;for(let u=0;u<i;++u){let f=s[r[u]];if(f===void 0)throw new SyntaxError(`Non-${n} character`);c=c<<t|f,a+=t,a>=8&&(a-=8,o[l++]=255&c>>a)}if(a>=t||255&c<<8-a)throw new SyntaxError("Unexpected end of data");return o},pH=(r,e,t)=>{let n=e[e.length-1]==="=",s=(1<<t)-1,i="",o=0,a=0;for(let c=0;c<r.length;++c)for(a=a<<8|r[c],o+=8;o>t;)o-=t,i+=e[s&a>>o];if(o&&(i+=e[s&a<<t-o]),n)for(;i.length*t&7;)i+="=";return i},Lt=({name:r,prefix:e,bitsPerChar:t,alphabet:n})=>zc({prefix:e,name:r,encode(s){return pH(s,n,t)},decode(s){return dH(s,n,t,r)}});var xn=io({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"}),mH=io({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"});var $4={};Y($4,{identity:()=>gH});var gH=zc({prefix:"\0",name:"identity",encode:r=>FS(r),decode:r=>US(r)});var H4={};Y(H4,{base2:()=>yH});var yH=Lt({prefix:"0",name:"base2",alphabet:"01",bitsPerChar:1});var G4={};Y(G4,{base8:()=>bH});var bH=Lt({prefix:"7",name:"base8",alphabet:"01234567",bitsPerChar:3});var W4={};Y(W4,{base10:()=>wH});var wH=io({prefix:"9",name:"base10",alphabet:"0123456789"});var Y4={};Y(Y4,{base16:()=>xH,base16upper:()=>EH});var xH=Lt({prefix:"f",name:"base16",alphabet:"0123456789abcdef",bitsPerChar:4}),EH=Lt({prefix:"F",name:"base16upper",alphabet:"0123456789ABCDEF",bitsPerChar:4});var Q4={};Y(Q4,{base32:()=>qc,base32hex:()=>AH,base32hexpad:()=>IH,base32hexpadupper:()=>TH,base32hexupper:()=>RH,base32pad:()=>_H,base32padupper:()=>SH,base32upper:()=>vH,base32z:()=>DH});var qc=Lt({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5}),vH=Lt({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5}),_H=Lt({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5}),SH=Lt({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5}),AH=Lt({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5}),RH=Lt({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5}),IH=Lt({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5}),TH=Lt({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5}),DH=Lt({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5});var X4={};Y(X4,{base36:()=>CH,base36upper:()=>PH});var CH=io({prefix:"k",name:"base36",alphabet:"0123456789abcdefghijklmnopqrstuvwxyz"}),PH=io({prefix:"K",name:"base36upper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"});var j4={};Y(j4,{base64:()=>kH,base64pad:()=>NH,base64url:()=>OH,base64urlpad:()=>LH});var kH=Lt({prefix:"m",name:"base64",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bitsPerChar:6}),NH=Lt({prefix:"M",name:"base64pad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",bitsPerChar:6}),OH=Lt({prefix:"u",name:"base64url",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",bitsPerChar:6}),LH=Lt({prefix:"U",name:"base64urlpad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=",bitsPerChar:6});var Z4={};Y(Z4,{base256emoji:()=>VH});var qS=Array.from("\u{1F680}\u{1FA90}\u2604\u{1F6F0}\u{1F30C}\u{1F311}\u{1F312}\u{1F313}\u{1F314}\u{1F315}\u{1F316}\u{1F317}\u{1F318}\u{1F30D}\u{1F30F}\u{1F30E}\u{1F409}\u2600\u{1F4BB}\u{1F5A5}\u{1F4BE}\u{1F4BF}\u{1F602}\u2764\u{1F60D}\u{1F923}\u{1F60A}\u{1F64F}\u{1F495}\u{1F62D}\u{1F618}\u{1F44D}\u{1F605}\u{1F44F}\u{1F601}\u{1F525}\u{1F970}\u{1F494}\u{1F496}\u{1F499}\u{1F622}\u{1F914}\u{1F606}\u{1F644}\u{1F4AA}\u{1F609}\u263A\u{1F44C}\u{1F917}\u{1F49C}\u{1F614}\u{1F60E}\u{1F607}\u{1F339}\u{1F926}\u{1F389}\u{1F49E}\u270C\u2728\u{1F937}\u{1F631}\u{1F60C}\u{1F338}\u{1F64C}\u{1F60B}\u{1F497}\u{1F49A}\u{1F60F}\u{1F49B}\u{1F642}\u{1F493}\u{1F929}\u{1F604}\u{1F600}\u{1F5A4}\u{1F603}\u{1F4AF}\u{1F648}\u{1F447}\u{1F3B6}\u{1F612}\u{1F92D}\u2763\u{1F61C}\u{1F48B}\u{1F440}\u{1F62A}\u{1F611}\u{1F4A5}\u{1F64B}\u{1F61E}\u{1F629}\u{1F621}\u{1F92A}\u{1F44A}\u{1F973}\u{1F625}\u{1F924}\u{1F449}\u{1F483}\u{1F633}\u270B\u{1F61A}\u{1F61D}\u{1F634}\u{1F31F}\u{1F62C}\u{1F643}\u{1F340}\u{1F337}\u{1F63B}\u{1F613}\u2B50\u2705\u{1F97A}\u{1F308}\u{1F608}\u{1F918}\u{1F4A6}\u2714\u{1F623}\u{1F3C3}\u{1F490}\u2639\u{1F38A}\u{1F498}\u{1F620}\u261D\u{1F615}\u{1F33A}\u{1F382}\u{1F33B}\u{1F610}\u{1F595}\u{1F49D}\u{1F64A}\u{1F639}\u{1F5E3}\u{1F4AB}\u{1F480}\u{1F451}\u{1F3B5}\u{1F91E}\u{1F61B}\u{1F534}\u{1F624}\u{1F33C}\u{1F62B}\u26BD\u{1F919}\u2615\u{1F3C6}\u{1F92B}\u{1F448}\u{1F62E}\u{1F646}\u{1F37B}\u{1F343}\u{1F436}\u{1F481}\u{1F632}\u{1F33F}\u{1F9E1}\u{1F381}\u26A1\u{1F31E}\u{1F388}\u274C\u270A\u{1F44B}\u{1F630}\u{1F928}\u{1F636}\u{1F91D}\u{1F6B6}\u{1F4B0}\u{1F353}\u{1F4A2}\u{1F91F}\u{1F641}\u{1F6A8}\u{1F4A8}\u{1F92C}\u2708\u{1F380}\u{1F37A}\u{1F913}\u{1F619}\u{1F49F}\u{1F331}\u{1F616}\u{1F476}\u{1F974}\u25B6\u27A1\u2753\u{1F48E}\u{1F4B8}\u2B07\u{1F628}\u{1F31A}\u{1F98B}\u{1F637}\u{1F57A}\u26A0\u{1F645}\u{1F61F}\u{1F635}\u{1F44E}\u{1F932}\u{1F920}\u{1F927}\u{1F4CC}\u{1F535}\u{1F485}\u{1F9D0}\u{1F43E}\u{1F352}\u{1F617}\u{1F911}\u{1F30A}\u{1F92F}\u{1F437}\u260E\u{1F4A7}\u{1F62F}\u{1F486}\u{1F446}\u{1F3A4}\u{1F647}\u{1F351}\u2744\u{1F334}\u{1F4A3}\u{1F438}\u{1F48C}\u{1F4CD}\u{1F940}\u{1F922}\u{1F445}\u{1F4A1}\u{1F4A9}\u{1F450}\u{1F4F8}\u{1F47B}\u{1F910}\u{1F92E}\u{1F3BC}\u{1F975}\u{1F6A9}\u{1F34E}\u{1F34A}\u{1F47C}\u{1F48D}\u{1F4E3}\u{1F942}"),BH=qS.reduce((r,e,t)=>(r[t]=e,r),[]),MH=qS.reduce((r,e,t)=>(r[e.codePointAt(0)]=t,r),[]);function UH(r){return r.reduce((e,t)=>(e+=BH[t],e),"")}function FH(r){let e=[];for(let t of r){let n=MH[t.codePointAt(0)];if(n===void 0)throw new Error(`Non-base256emoji character: ${t}`);e.push(n)}return new Uint8Array(e)}var VH=zc({prefix:"\u{1F680}",name:"base256emoji",encode:UH,decode:FH});var rg={};Y(rg,{sha256:()=>Lf,sha512:()=>iG});var zH=HS,KS=128,qH=127,KH=~qH,$H=Math.pow(2,31);function HS(r,e,t){e=e||[],t=t||0;for(var n=t;r>=$H;)e[t++]=r&255|KS,r/=128;for(;r&KH;)e[t++]=r&255|KS,r>>>=7;return e[t]=r|0,HS.bytes=t-n+1,e}var HH=J4,GH=128,$S=127;function J4(r,n){var t=0,n=n||0,s=0,i=n,o,a=r.length;do{if(i>=a)throw J4.bytes=0,new RangeError("Could not decode varint");o=r[i++],t+=s<28?(o&$S)<<s:(o&$S)*Math.pow(2,s),s+=7}while(o>=GH);return J4.bytes=i-n,t}var WH=Math.pow(2,7),YH=Math.pow(2,14),QH=Math.pow(2,21),XH=Math.pow(2,28),jH=Math.pow(2,35),ZH=Math.pow(2,42),JH=Math.pow(2,49),eG=Math.pow(2,56),tG=Math.pow(2,63),rG=function(r){return r<WH?1:r<YH?2:r<QH?3:r<XH?4:r<jH?5:r<ZH?6:r<JH?7:r<eG?8:r<tG?9:10},nG={encode:zH,decode:HH,encodingLength:rG},sG=nG,kf=sG;var Nf=(r,e=0)=>[kf.decode(r,e),kf.decode.bytes],Kc=(r,e,t=0)=>(kf.encode(r,e,t),e),$c=r=>kf.encodingLength(r);var Us=(r,e)=>{let t=e.byteLength,n=$c(r),s=n+$c(t),i=new Uint8Array(s+t);return Kc(r,i,0),Kc(t,i,n),i.set(e,s),new Hc(r,t,e,i)},Of=r=>{let e=gi(r),[t,n]=Nf(e),[s,i]=Nf(e.subarray(n)),o=e.subarray(n+i);if(o.byteLength!==s)throw new Error("Incorrect length");return new Hc(t,s,o,e)},GS=(r,e)=>{if(r===e)return!0;{let t=e;return r.code===t.code&&r.size===t.size&&t.bytes instanceof Uint8Array&&MS(r.bytes,t.bytes)}},Hc=class{constructor(e,t,n,s){this.code=e,this.size=t,this.digest=n,this.bytes=s}};var tg=({name:r,code:e,encode:t})=>new eg(r,e,t),eg=class{constructor(e,t,n){this.name=e,this.code=t,this.encode=n}digest(e){if(e instanceof Uint8Array){let t=this.encode(e);return t instanceof Uint8Array?Us(this.code,t):t.then(n=>Us(this.code,n))}else throw Error("Unknown type, must be binary type")}};var YS=r=>async e=>new Uint8Array(await crypto.subtle.digest(r,e)),Lf=tg({name:"sha2-256",code:18,encode:YS("SHA-256")}),iG=tg({name:"sha2-512",code:19,encode:YS("SHA-512")});var ng={};Y(ng,{identity:()=>Wc});var QS=0,oG="identity",XS=gi,aG=r=>Us(QS,XS(r)),Wc={code:QS,name:oG,encode:XS,digest:aG};var Qme=new TextEncoder,Xme=new TextDecoder;var jS=(r,e)=>{let{bytes:t,version:n}=r;switch(n){case 0:return fG(t,sg(r),e||xn.encoder);default:return hG(t,sg(r),e||qc.encoder)}};var ZS=new WeakMap,sg=r=>{let e=ZS.get(r);if(e==null){let t=new Map;return ZS.set(r,t),t}return e},Tt=class{constructor(e,t,n,s){this.code=t,this.version=e,this.multihash=n,this.bytes=s,this["/"]=s}get asCID(){return this}get byteOffset(){return this.bytes.byteOffset}get byteLength(){return this.bytes.byteLength}toV0(){switch(this.version){case 0:return this;case 1:{let{code:e,multihash:t}=this;if(e!==Bf)throw new Error("Cannot convert a non dag-pb CID to CIDv0");if(t.code!==dG)throw new Error("Cannot convert non sha2-256 multihash CID to CIDv0");return Tt.createV0(t)}default:throw Error(`Can not convert CID version ${this.version} to version 0. This is a bug please report`)}}toV1(){switch(this.version){case 0:{let{code:e,digest:t}=this.multihash,n=Us(e,t);return Tt.createV1(this.code,n)}case 1:return this;default:throw Error(`Can not convert CID version ${this.version} to version 1. This is a bug please report`)}}equals(e){return Tt.equals(this,e)}static equals(e,t){let n=t;return n&&e.code===n.code&&e.version===n.version&&GS(e.multihash,n.multihash)}toString(e){return jS(this,e)}toJSON(){return{"/":jS(this)}}link(){return this}get[Symbol.toStringTag](){return"CID"}[Symbol.for("nodejs.util.inspect.custom")](){return`CID(${this.toString()})`}static asCID(e){if(e==null)return null;let t=e;if(t instanceof Tt)return t;if(t["/"]!=null&&t["/"]===t.bytes||t.asCID===t){let{version:n,code:s,multihash:i,bytes:o}=t;return new Tt(n,s,i,o||JS(n,s,i.bytes))}else if(t[pG]===!0){let{version:n,multihash:s,code:i}=t,o=Of(s);return Tt.create(n,i,o)}else return null}static create(e,t,n){if(typeof t!="number")throw new Error("String codecs are no longer supported");if(!(n.bytes instanceof Uint8Array))throw new Error("Invalid digest");switch(e){case 0:{if(t!==Bf)throw new Error(`Version 0 CID must use dag-pb (code: ${Bf}) block encoding`);return new Tt(e,t,n,n.bytes)}case 1:{let s=JS(e,t,n.bytes);return new Tt(e,t,n,s)}default:throw new Error("Invalid version")}}static createV0(e){return Tt.create(0,Bf,e)}static createV1(e,t){return Tt.create(1,e,t)}static decode(e){let[t,n]=Tt.decodeFirst(e);if(n.length)throw new Error("Incorrect length");return t}static decodeFirst(e){let t=Tt.inspectBytes(e),n=t.size-t.multihashSize,s=gi(e.subarray(n,n+t.multihashSize));if(s.byteLength!==t.multihashSize)throw new Error("Incorrect length");let i=s.subarray(t.multihashSize-t.digestSize),o=new Hc(t.multihashCode,t.digestSize,i,s);return[t.version===0?Tt.createV0(o):Tt.createV1(t.codec,o),e.subarray(t.size)]}static inspectBytes(e){let t=0,n=()=>{let[f,h]=Nf(e.subarray(t));return t+=h,f},s=n(),i=Bf;if(s===18?(s=0,t=0):i=n(),s!==0&&s!==1)throw new RangeError(`Invalid CID version ${s}`);let o=t,a=n(),c=n(),l=t+c,u=l-o;return{version:s,codec:i,multihashCode:a,digestSize:c,multihashSize:u,size:l}}static parse(e,t){let[n,s]=uG(e,t),i=Tt.decode(s);if(i.version===0&&e[0]!=="Q")throw Error("Version 0 CID string must not include multibase prefix");return sg(i).set(n,e),i}},uG=(r,e)=>{switch(r[0]){case"Q":{let t=e||xn;return[xn.prefix,t.decode(`${xn.prefix}${r}`)]}case xn.prefix:{let t=e||xn;return[xn.prefix,t.decode(r)]}case qc.prefix:{let t=e||qc;return[qc.prefix,t.decode(r)]}default:{if(e==null)throw Error("To parse non base32 or base58btc encoded CID multibase decoder must be provided");return[r[0],e.decode(r)]}}},fG=(r,e,t)=>{let{prefix:n}=t;if(n!==xn.prefix)throw Error(`Cannot string encode V0 in ${t.name} encoding`);let s=e.get(n);if(s==null){let i=t.encode(r).slice(1);return e.set(n,i),i}else return s},hG=(r,e,t)=>{let{prefix:n}=t,s=e.get(n);if(s==null){let i=t.encode(r);return e.set(n,i),i}else return s},Bf=112,dG=18,JS=(r,e,t)=>{let n=$c(r),s=n+$c(e),i=new Uint8Array(s+t.byteLength);return Kc(r,i,0),Kc(e,i,n),i.set(t,s),i},pG=Symbol.for("@ipld/js-cid/CID");var ig={...$4,...H4,...G4,...W4,...Y4,...Q4,...X4,...K4,...j4,...Z4},o3e={...rg,...ng};var mG=Symbol.for("nodejs.util.inspect.custom"),eA=Object.values(ig).map(r=>r.decoder).reduce((r,e)=>r.or(e),ig.identity.decoder),tA=114,og=36,ag=37,Mf=class{type;multihash;privateKey;publicKey;string;constructor(e){this.type=e.type,this.multihash=e.multihash,this.privateKey=e.privateKey,Object.defineProperty(this,"string",{enumerable:!1,writable:!0})}get[Symbol.toStringTag](){return`PeerId(${this.toString()})`}[U4]=!0;toString(){return this.string==null&&(this.string=xn.encode(this.multihash.bytes).slice(1)),this.string}toCID(){return Tt.createV1(tA,this.multihash)}toBytes(){return this.multihash.bytes}toJSON(){return this.toString()}equals(e){if(e instanceof Uint8Array)return be(this.multihash.bytes,e);if(typeof e=="string")return he(e).equals(this);if(e?.multihash?.bytes!=null)return be(this.multihash.bytes,e.multihash.bytes);throw new Error("not valid Id")}[mG](){return`PeerId(${this.toString()})`}},ma=class extends Mf{type="RSA";publicKey;constructor(e){super({...e,type:"RSA"}),this.publicKey=e.publicKey}},ga=class extends Mf{type="Ed25519";publicKey;constructor(e){super({...e,type:"Ed25519"}),this.publicKey=e.multihash.digest}},ya=class extends Mf{type="secp256k1";publicKey;constructor(e){super({...e,type:"secp256k1"}),this.publicKey=e.multihash.digest}};function rA(r){if(r.type==="RSA")return new ma(r);if(r.type==="Ed25519")return new ga(r);if(r.type==="secp256k1")return new ya(r);throw new E("Not a PeerId","ERR_INVALID_PARAMETERS")}function he(r,e){if(e=e??eA,r.charAt(0)==="1"||r.charAt(0)==="Q"){let t=Of(xn.decode(`z${r}`));return r.startsWith("12D")?new ga({multihash:t}):r.startsWith("16U")?new ya({multihash:t}):new ma({multihash:t})}return _t(eA.decode(r))}function _t(r){try{let e=Of(r);if(e.code===Wc.code){if(e.digest.length===og)return new ga({multihash:e});if(e.digest.length===ag)return new ya({multihash:e})}if(e.code===Lf.code)return new ma({multihash:e})}catch{return gG(Tt.decode(r))}throw new Error("Supplied PeerID CID is invalid")}function gG(r){if(r==null||r.multihash==null||r.version==null||r.version===1&&r.code!==tA)throw new Error("Supplied PeerID CID is invalid");let e=r.multihash;if(e.code===Lf.code)return new ma({multihash:r.multihash});if(e.code===Wc.code){if(e.digest.length===og)return new ga({multihash:r.multihash});if(e.digest.length===ag)return new ya({multihash:r.multihash})}throw new Error("Supplied PeerID CID is invalid")}async function _r(r,e){return r.length===og?new ga({multihash:Us(Wc.code,r),privateKey:e}):r.length===ag?new ya({multihash:Us(Wc.code,r),privateKey:e}):new ma({multihash:await Lf.digest(r),publicKey:r,privateKey:e})}var fA=W(uA(),1),oo=fA.default;var EA=W(xA(),1);var Ue;(function(r){r.ERR_INVALID_PARAMETERS="ERR_INVALID_PARAMETERS",r.ERR_INVALID_KEY_NAME="ERR_INVALID_KEY_NAME",r.ERR_INVALID_KEY_TYPE="ERR_INVALID_KEY_TYPE",r.ERR_KEY_ALREADY_EXISTS="ERR_KEY_ALREADY_EXISTS",r.ERR_INVALID_KEY_SIZE="ERR_INVALID_KEY_SIZE",r.ERR_KEY_NOT_FOUND="ERR_KEY_NOT_FOUND",r.ERR_OLD_KEY_NAME_INVALID="ERR_OLD_KEY_NAME_INVALID",r.ERR_NEW_KEY_NAME_INVALID="ERR_NEW_KEY_NAME_INVALID",r.ERR_PASSWORD_REQUIRED="ERR_PASSWORD_REQUIRED",r.ERR_PEM_REQUIRED="ERR_PEM_REQUIRED",r.ERR_CANNOT_READ_KEY="ERR_CANNOT_READ_KEY",r.ERR_MISSING_PRIVATE_KEY="ERR_MISSING_PRIVATE_KEY",r.ERR_INVALID_OLD_PASS_TYPE="ERR_INVALID_OLD_PASS_TYPE",r.ERR_INVALID_NEW_PASS_TYPE="ERR_INVALID_NEW_PASS_TYPE",r.ERR_INVALID_PASS_LENGTH="ERR_INVALID_PASS_LENGTH"})(Ue||(Ue={}));var Hd=C("libp2p:keychain"),LG="/pkcs8/",vA="/info/",ba=new WeakMap,wa={minKeyLength:112/8,minSaltLength:128/8,minIterationCount:1e3},lg={dek:{keyLength:512/8,iterationCount:1e4,salt:"you should override this value with a crypto secure random number",hash:"sha2-512"}};function yi(r){return r==null||typeof r!="string"?!1:r===(0,EA.default)(r.trim())&&r.length>0}async function st(){let t=Math.random()*800+200;await new Promise(n=>setTimeout(n,t))}function Fs(r){return new Ce(LG+r)}function ao(r){return new Ce(vA+r)}var xa=class{components;init;constructor(e,t){if(this.components=e,this.init=oo(lg,t),this.init.pass!=null&&this.init.pass?.length<20)throw new Error("pass must be least 20 characters");if(this.init.dek?.keyLength!=null&&this.init.dek.keyLength<wa.minKeyLength)throw new Error(`dek.keyLength must be least ${wa.minKeyLength} bytes`);if(this.init.dek?.salt?.length!=null&&this.init.dek.salt.length<wa.minSaltLength)throw new Error(`dek.saltLength must be least ${wa.minSaltLength} bytes`);if(this.init.dek?.iterationCount!=null&&this.init.dek.iterationCount<wa.minIterationCount)throw new Error(`dek.iterationCount must be least ${wa.minIterationCount}`);let n=this.init.pass!=null&&this.init.dek?.salt!=null?Pf(this.init.pass,this.init.dek?.salt,this.init.dek?.iterationCount,this.init.dek?.keyLength,this.init.dek?.hash):"";ba.set(this,{dek:n})}static generateOptions(){let e=Object.assign({},lg),t=Math.ceil(wa.minSaltLength/3)*3;return e.dek.salt=M(Fn(t),"base64"),e}static get options(){return lg}async createKey(e,t,n=2048){if(!yi(e)||e==="self")throw await st(),new E("Invalid key name",Ue.ERR_INVALID_KEY_NAME);if(typeof t!="string")throw await st(),new E("Invalid key type",Ue.ERR_INVALID_KEY_TYPE);let s=Fs(e);if(await this.components.datastore.has(s))throw await st(),new E("Key name already exists",Ue.ERR_KEY_ALREADY_EXISTS);switch(t.toLowerCase()){case"rsa":if(!Number.isSafeInteger(n)||n<2048)throw await st(),new E("Invalid RSA key size",Ue.ERR_INVALID_KEY_SIZE);break;default:break}let o;try{let a=await If(t,n),c=await a.id(),l=ba.get(this);if(l==null)throw new E("dek missing",Ue.ERR_INVALID_PARAMETERS);let u=l.dek,f=await a.export(u);o={name:e,id:c};let h=this.components.datastore.batch();h.put(s,$(f)),h.put(ao(e),$(JSON.stringify(o))),await h.commit()}catch(a){throw await st(),a}return o}async listKeys(){let e={prefix:vA},t=[];for await(let n of this.components.datastore.query(e))t.push(JSON.parse(M(n.value)));return t}async findKeyById(e){try{let n=(await this.listKeys()).find(s=>s.id===e);if(n==null)throw new E(`Key with id '${e}' does not exist.`,Ue.ERR_KEY_NOT_FOUND);return n}catch(t){throw await st(),t}}async findKeyByName(e){if(!yi(e))throw await st(),new E(`Invalid key name '${e}'`,Ue.ERR_INVALID_KEY_NAME);let t=ao(e);try{let n=await this.components.datastore.get(t);return JSON.parse(M(n))}catch(n){throw await st(),Hd.error(n),new E(`Key '${e}' does not exist.`,Ue.ERR_KEY_NOT_FOUND)}}async removeKey(e){if(!yi(e)||e==="self")throw await st(),new E(`Invalid key name '${e}'`,Ue.ERR_INVALID_KEY_NAME);let t=Fs(e),n=await this.findKeyByName(e),s=this.components.datastore.batch();return s.delete(t),s.delete(ao(e)),await s.commit(),n}async renameKey(e,t){if(!yi(e)||e==="self")throw await st(),new E(`Invalid old key name '${e}'`,Ue.ERR_OLD_KEY_NAME_INVALID);if(!yi(t)||t==="self")throw await st(),new E(`Invalid new key name '${t}'`,Ue.ERR_NEW_KEY_NAME_INVALID);let n=Fs(e),s=Fs(t),i=ao(e),o=ao(t);if(await this.components.datastore.has(s))throw await st(),new E(`Key '${t}' already exists`,Ue.ERR_KEY_ALREADY_EXISTS);try{let c=await this.components.datastore.get(n),l=await this.components.datastore.get(i),u=JSON.parse(M(l));u.name=t;let f=this.components.datastore.batch();return f.put(s,c),f.put(o,$(JSON.stringify(u))),f.delete(n),f.delete(i),await f.commit(),u}catch(c){throw await st(),c}}async exportKey(e,t){if(!yi(e))throw await st(),new E(`Invalid key name '${e}'`,Ue.ERR_INVALID_KEY_NAME);if(t==null)throw await st(),new E("Password is required",Ue.ERR_PASSWORD_REQUIRED);let n=Fs(e);try{let s=await this.components.datastore.get(n),i=M(s),o=ba.get(this);if(o==null)throw new E("dek missing",Ue.ERR_INVALID_PARAMETERS);let a=o.dek;return await(await Vc(i,a)).export(t)}catch(s){throw await st(),s}}async exportPeerId(e){let t="temporary-password",n=await this.exportKey(e,t),s=await Vc(n,t);return _r(s.public.bytes,s.bytes)}async importKey(e,t,n){if(!yi(e)||e==="self")throw await st(),new E(`Invalid key name '${e}'`,Ue.ERR_INVALID_KEY_NAME);if(t==null)throw await st(),new E("PEM encoded key is required",Ue.ERR_PEM_REQUIRED);let s=Fs(e);if(await this.components.datastore.has(s))throw await st(),new E(`Key '${e}' already exists`,Ue.ERR_KEY_ALREADY_EXISTS);let o;try{o=await Vc(t,n)}catch{throw await st(),new E("Cannot read the key, most likely the password is wrong",Ue.ERR_CANNOT_READ_KEY)}let a;try{a=await o.id();let u=ba.get(this);if(u==null)throw new E("dek missing",Ue.ERR_INVALID_PARAMETERS);let f=u.dek;t=await o.export(f)}catch(u){throw await st(),u}let c={name:e,id:a},l=this.components.datastore.batch();return l.put(s,$(t)),l.put(ao(e),$(JSON.stringify(c))),await l.commit(),c}async importPeer(e,t){try{if(!yi(e))throw new E(`Invalid key name '${e}'`,Ue.ERR_INVALID_KEY_NAME);if(t==null)throw new E("PeerId is required",Ue.ERR_MISSING_PRIVATE_KEY);if(t.privateKey==null)throw new E("PeerId.privKey is required",Ue.ERR_MISSING_PRIVATE_KEY);let n=await ls(t.privateKey),s=Fs(e);if(await this.components.datastore.has(s))throw await st(),new E(`Key '${e}' already exists`,Ue.ERR_KEY_ALREADY_EXISTS);let o=ba.get(this);if(o==null)throw new E("dek missing",Ue.ERR_INVALID_PARAMETERS);let a=o.dek,c=await n.export(a),l={name:e,id:t.toString()},u=this.components.datastore.batch();return u.put(s,$(c)),u.put(ao(e),$(JSON.stringify(l))),await u.commit(),l}catch(n){throw await st(),n}}async getPrivateKey(e){if(!yi(e))throw await st(),new E(`Invalid key name '${e}'`,Ue.ERR_INVALID_KEY_NAME);try{let t=Fs(e),n=await this.components.datastore.get(t);return M(n)}catch(t){throw await st(),Hd.error(t),new E(`Key '${e}' does not exist.`,Ue.ERR_KEY_NOT_FOUND)}}async rotateKeychainPass(e,t){if(typeof e!="string")throw await st(),new E(`Invalid old pass type '${typeof e}'`,Ue.ERR_INVALID_OLD_PASS_TYPE);if(typeof t!="string")throw await st(),new E(`Invalid new pass type '${typeof t}'`,Ue.ERR_INVALID_NEW_PASS_TYPE);if(t.length<20)throw await st(),new E(`Invalid pass length ${t.length}`,Ue.ERR_INVALID_PASS_LENGTH);Hd("recreating keychain");let n=ba.get(this);if(n==null)throw new E("dek missing",Ue.ERR_INVALID_PARAMETERS);let s=n.dek;this.init.pass=t;let i=t!=null&&this.init.dek?.salt!=null?Pf(t,this.init.dek.salt,this.init.dek?.iterationCount,this.init.dek?.keyLength,this.init.dek?.hash):"";ba.set(this,{dek:i});let o=await this.listKeys();for(let a of o){let c=await this.components.datastore.get(Fs(a.name)),l=M(c),u=await Vc(l,s),f=i.toString(),h=await u.export(f),p=this.components.datastore.batch(),d={name:a.name,id:a.id};p.put(Fs(a.name),$(h)),p.put(ao(a.name),$(JSON.stringify(d))),await p.commit()}Hd("keychain reconstructed")}};function bi(r,e){let t={[Symbol.iterator]:()=>t,next:()=>{let n=r.next(),s=n.value;return n.done===!0||s==null?{done:!0,value:void 0}:{done:!1,value:e(s)}}};return t}var Sr=class{map;constructor(e){if(this.map=new Map,e!=null)for(let[t,n]of e.entries())this.map.set(t.toString(),n)}[Symbol.iterator](){return this.entries()}clear(){this.map.clear()}delete(e){this.map.delete(e.toString())}entries(){return bi(this.map.entries(),e=>[he(e[0]),e[1]])}forEach(e){this.map.forEach((t,n)=>{e(t,he(n),this)})}get(e){return this.map.get(e.toString())}has(e){return this.map.has(e.toString())}set(e,t){this.map.set(e.toString(),t)}keys(){return bi(this.map.keys(),e=>he(e))}values(){return this.map.values()}get size(){return this.map.size}};var Ar=class{set;constructor(e){if(this.set=new Set,e!=null)for(let t of e)this.set.add(t.toString())}get size(){return this.set.size}[Symbol.iterator](){return this.values()}add(e){this.set.add(e.toString())}clear(){this.set.clear()}delete(e){this.set.delete(e.toString())}entries(){return bi(this.set.entries(),e=>{let t=he(e[0]);return[t,t]})}forEach(e){this.set.forEach(t=>{let n=he(t);e(n,n,this)})}has(e){return this.set.has(e.toString())}values(){return bi(this.set.values(),e=>he(e))}intersection(e){let t=new Ar;for(let n of e)this.has(n)&&t.add(n);return t}difference(e){let t=new Ar;for(let n of this)e.has(n)||t.add(n);return t}union(e){let t=new Ar;for(let n of e)t.add(n);for(let n of this)t.add(n);return t}};var Xc=class{list;constructor(e){if(this.list=[],e!=null)for(let t of e)this.list.push(t.toString())}[Symbol.iterator](){return bi(this.list.entries(),e=>he(e[1]))}concat(e){let t=new Xc(this);for(let n of e)t.push(n);return t}entries(){return bi(this.list.entries(),e=>[e[0],he(e[1])])}every(e){return this.list.every((t,n)=>e(he(t),n,this))}filter(e){let t=new Xc;return this.list.forEach((n,s)=>{let i=he(n);e(i,s,this)&&t.push(i)}),t}find(e){let t=this.list.find((n,s)=>e(he(n),s,this));if(t!=null)return he(t)}findIndex(e){return this.list.findIndex((t,n)=>e(he(t),n,this))}forEach(e){this.list.forEach((t,n)=>{e(he(t),n,this)})}includes(e){return this.list.includes(e.toString())}indexOf(e){return this.list.indexOf(e.toString())}pop(){let e=this.list.pop();if(e!=null)return he(e)}push(...e){for(let t of e)this.list.push(t.toString())}shift(){let e=this.list.shift();if(e!=null)return he(e)}unshift(...e){let t=this.list.length;for(let n=e.length-1;n>-1;n--)t=this.list.unshift(e[n].toString());return t}get length(){return this.list.length}};var ug;(function(r){let e;r.codec=()=>(e==null&&(e=me((t,n,s={})=>{s.lengthDelimited!==!1&&n.fork(),t.id!=null&&(n.uint32(10),n.bytes(t.id)),t.pubKey!=null&&(n.uint32(18),n.bytes(t.pubKey)),t.privKey!=null&&(n.uint32(26),n.bytes(t.privKey)),s.lengthDelimited!==!1&&n.ldelim()},(t,n)=>{let s={},i=n==null?t.len:t.pos+n;for(;t.pos<i;){let o=t.uint32();switch(o>>>3){case 1:s.id=t.bytes();break;case 2:s.pubKey=t.bytes();break;case 3:s.privKey=t.bytes();break;default:t.skipType(o&7);break}}return s})),e),r.encode=t=>pe(t,r.codec()),r.decode=t=>de(t,r.codec())})(ug||(ug={}));var Gd=async()=>{let r=await If("Ed25519"),e=await BG(r);if(e.type==="Ed25519")return e;throw new Error(`Generated unexpected PeerId type "${e.type}"`)};async function BG(r){return _r(Tf(r.public),B4(r))}var _A={ERR_SIGNATURE_NOT_VALID:"ERR_SIGNATURE_NOT_VALID"};var Uf;(function(r){let e;r.codec=()=>(e==null&&(e=me((t,n,s={})=>{s.lengthDelimited!==!1&&n.fork(),t.publicKey!=null&&t.publicKey.byteLength>0&&(n.uint32(10),n.bytes(t.publicKey)),t.payloadType!=null&&t.payloadType.byteLength>0&&(n.uint32(18),n.bytes(t.payloadType)),t.payload!=null&&t.payload.byteLength>0&&(n.uint32(26),n.bytes(t.payload)),t.signature!=null&&t.signature.byteLength>0&&(n.uint32(42),n.bytes(t.signature)),s.lengthDelimited!==!1&&n.ldelim()},(t,n)=>{let s={publicKey:new Uint8Array(0),payloadType:new Uint8Array(0),payload:new Uint8Array(0),signature:new Uint8Array(0)},i=n==null?t.len:t.pos+n;for(;t.pos<i;){let o=t.uint32();switch(o>>>3){case 1:s.publicKey=t.bytes();break;case 2:s.payloadType=t.bytes();break;case 3:s.payload=t.bytes();break;case 5:s.signature=t.bytes();break;default:t.skipType(o&7);break}}return s})),e),r.encode=t=>pe(t,r.codec()),r.decode=t=>de(t,r.codec())})(Uf||(Uf={}));var Ff=class{peerId;payloadType;payload;signature;marshaled;constructor(e){let{peerId:t,payloadType:n,payload:s,signature:i}=e;this.peerId=t,this.payloadType=n,this.payload=s,this.signature=i}marshal(){if(this.peerId.publicKey==null)throw new Error("Missing public key");return this.marshaled==null&&(this.marshaled=Uf.encode({publicKey:this.peerId.publicKey,payloadType:this.payloadType,payload:this.payload.subarray(),signature:this.signature})),this.marshaled}equals(e){return be(this.marshal(),e.marshal())}async validate(e){let t=SA(e,this.payloadType,this.payload);if(this.peerId.publicKey==null)throw new Error("Missing public key");return Yr(this.peerId.publicKey).verify(t.subarray(),this.signature)}},Lr=Ff;gt(Lr,"createFromProtobuf",async e=>{let t=Uf.decode(e),n=await _r(t.publicKey);return new Ff({peerId:n,payloadType:t.payloadType,payload:t.payload,signature:t.signature})}),gt(Lr,"seal",async(e,t)=>{if(t.privateKey==null)throw new Error("Missing private key");let n=e.domain,s=e.codec,i=e.marshal(),o=SA(n,s,i),c=await(await ls(t.privateKey)).sign(o.subarray());return new Ff({peerId:t,payloadType:s,payload:i,signature:c})}),gt(Lr,"openAndCertify",async(e,t)=>{let n=await Ff.createFromProtobuf(e);if(!await n.validate(t))throw new E("envelope signature is not valid for the given domain",_A.ERR_SIGNATURE_NOT_VALID);return n});var SA=(r,e,t)=>{let n=$(r),s=un.encode(n.byteLength),i=un.encode(e.length),o=un.encode(t.length);return new ye(s,n,i,e,o,t)};function AA(r,e){let t=(n,s)=>n.toString().localeCompare(s.toString());return r.length!==e.length?!1:(e.sort(t),r.sort(t).every((n,s)=>e[s].equals(n)))}var el=W(ac(),1);var Wd=class{index=0;input="";new(e){return this.index=0,this.input=e,this}readAtomically(e){let t=this.index,n=e();return n===void 0&&(this.index=t),n}parseWith(e){let t=e();if(this.index===this.input.length)return t}peekChar(){if(!(this.index>=this.input.length))return this.input[this.index]}readChar(){if(!(this.index>=this.input.length))return this.input[this.index++]}readGivenChar(e){return this.readAtomically(()=>{let t=this.readChar();if(t===e)return t})}readSeparator(e,t,n){return this.readAtomically(()=>{if(!(t>0&&this.readGivenChar(e)===void 0))return n()})}readNumber(e,t,n,s){return this.readAtomically(()=>{let i=0,o=0,a=this.peekChar();if(a===void 0)return;let c=a==="0",l=2**(8*s)-1;for(;;){let u=this.readAtomically(()=>{let f=this.readChar();if(f===void 0)return;let h=Number.parseInt(f,e);if(!Number.isNaN(h))return h});if(u===void 0)break;if(i*=e,i+=u,i>l||(o+=1,t!==void 0&&o>t))return}if(o!==0)return!n&&c&&o>1?void 0:i})}readIPv4Addr(){return this.readAtomically(()=>{let e=new Uint8Array(4);for(let t=0;t<e.length;t++){let n=this.readSeparator(".",t,()=>this.readNumber(10,3,!1,1));if(n===void 0)return;e[t]=n}return e})}readIPv6Addr(){let e=t=>{for(let n=0;n<t.length/2;n++){let s=n*2;if(n<t.length-3){let o=this.readSeparator(":",n,()=>this.readIPv4Addr());if(o!==void 0)return t[s]=o[0],t[s+1]=o[1],t[s+2]=o[2],t[s+3]=o[3],[s+4,!0]}let i=this.readSeparator(":",n,()=>this.readNumber(16,4,!0,2));if(i===void 0)return[s,!1];t[s]=i>>8,t[s+1]=i&255}return[t.length,!1]};return this.readAtomically(()=>{let t=new Uint8Array(16),[n,s]=e(t);if(n===16)return t;if(s||this.readGivenChar(":")===void 0||this.readGivenChar(":")===void 0)return;let i=new Uint8Array(14),o=16-(n+2),[a]=e(i.subarray(0,o));return t.set(i.subarray(0,a),16-a),t})}readIPAddr(){return this.readIPv4Addr()??this.readIPv6Addr()}};var RA=45,MG=15,jc=new Wd;function fg(r){if(!(r.length>MG))return jc.new(r).parseWith(()=>jc.readIPv4Addr())}function hg(r){if(!(r.length>RA))return jc.new(r).parseWith(()=>jc.readIPv6Addr())}function Yd(r){if(!(r.length>RA))return jc.new(r).parseWith(()=>jc.readIPAddr())}var A4e=parseInt("0xFFFF",16),R4e=new Uint8Array([0,0,0,0,0,0,0,0,0,0,255,255]);var Vs=W(ac(),1);function DA(r){return!!fg(r)}function CA(r){return!!hg(r)}function Zc(r){return!!Yd(r)}var PA=DA,qG=CA,dg=function(r){let e=0;if(r=r.toString().trim(),PA(r)){let t=new Uint8Array(e+4);return r.split(/\./g).forEach(n=>{t[e++]=parseInt(n,10)&255}),t}if(qG(r)){let t=r.split(":",8),n;for(n=0;n<t.length;n++){let i=PA(t[n]),o;i&&(o=dg(t[n]),t[n]=M(o.slice(0,2),"base16")),o!=null&&++n<8&&t.splice(n,0,M(o.slice(2,4),"base16"))}if(t[0]==="")for(;t.length<8;)t.unshift("0");else if(t[t.length-1]==="")for(;t.length<8;)t.push("0");else if(t.length<8){for(n=0;n<t.length&&t[n]!=="";n++);let i=[n,1];for(n=9-t.length;n>0;n--)i.push("0");t.splice.apply(t,i)}let s=new Uint8Array(e+16);for(n=0;n<t.length;n++){let i=parseInt(t[n],16);s[e++]=i>>8&255,s[e++]=i&255}return s}throw new Error("invalid ip address")},kA=function(r,e=0,t){e=~~e,t=t??r.length-e;let n=new DataView(r.buffer);if(t===4){let s=[];for(let i=0;i<t;i++)s.push(r[e+i]);return s.join(".")}if(t===16){let s=[];for(let i=0;i<t;i+=2)s.push(n.getUint16(e+i).toString(16));return s.join(":").replace(/(^|:)0(:0)*:0(:|$)/,"$1::$3").replace(/:{3,4}/,"::")}return""};var Jc={},pg={},$G=[[4,32,"ip4"],[6,16,"tcp"],[33,16,"dccp"],[41,128,"ip6"],[42,-1,"ip6zone"],[43,8,"ipcidr"],[53,-1,"dns",!0],[54,-1,"dns4",!0],[55,-1,"dns6",!0],[56,-1,"dnsaddr",!0],[132,16,"sctp"],[273,16,"udp"],[275,0,"p2p-webrtc-star"],[276,0,"p2p-webrtc-direct"],[277,0,"p2p-stardust"],[280,0,"webrtc-direct"],[281,0,"webrtc"],[290,0,"p2p-circuit"],[301,0,"udt"],[302,0,"utp"],[400,-1,"unix",!1,!0],[421,-1,"ipfs"],[421,-1,"p2p"],[443,0,"https"],[444,96,"onion"],[445,296,"onion3"],[446,-1,"garlic64"],[448,0,"tls"],[449,-1,"sni"],[460,0,"quic"],[461,0,"quic-v1"],[465,0,"webtransport"],[466,-1,"certhash"],[477,0,"ws"],[478,0,"wss"],[479,0,"p2p-websocket-star"],[480,0,"http"],[777,-1,"memory"]];$G.forEach(r=>{let e=HG(...r);pg[e.code]=e,Jc[e.name]=e});function HG(r,e,t,n,s){return{code:r,size:e,name:t,resolvable:!!n,path:!!s}}function se(r){if(typeof r=="number"){if(pg[r]!=null)return pg[r];throw new Error(`no protocol with code: ${r}`)}else if(typeof r=="string"){if(Jc[r]!=null)return Jc[r];throw new Error(`no protocol with name: ${r}`)}throw new Error(`invalid protocol id type: ${typeof r}`)}var lge=se("ip4"),uge=se("ip6"),fge=se("ipcidr");function Vf(r,e){switch(se(r).code){case 4:case 41:return WG(e);case 42:return LA(e);case 6:case 273:case 33:case 132:return MA(e).toString();case 53:case 54:case 55:case 56:case 400:case 449:case 777:return LA(e);case 421:return jG(e);case 444:return BA(e);case 445:return BA(e);case 466:return XG(e);default:return M(e,"base16")}}function gg(r,e){switch(se(r).code){case 4:return NA(e);case 41:return NA(e);case 42:return OA(e);case 6:case 273:case 33:case 132:return yg(parseInt(e,10));case 53:case 54:case 55:case 56:case 400:case 449:case 777:return OA(e);case 421:return YG(e);case 444:return ZG(e);case 445:return JG(e);case 466:return QG(e);default:return $(e,"base16")}}var mg=Object.values(Eu).map(r=>r.decoder),GG=function(){let r=mg[0].or(mg[1]);return mg.slice(2).forEach(e=>r=r.or(e)),r}();function NA(r){if(!Zc(r))throw new Error("invalid ip address");return dg(r)}function WG(r){let e=kA(r,0,r.length);if(e==null)throw new Error("ipBuff is required");if(!Zc(e))throw new Error("invalid ip address");return e}function yg(r){let e=new ArrayBuffer(2);return new DataView(e).setUint16(0,r),new Uint8Array(e)}function MA(r){return new DataView(r.buffer).getUint16(r.byteOffset)}function OA(r){let e=$(r),t=Uint8Array.from(Vs.default.encode(e.length));return Ee([t,e],t.length+e.length)}function LA(r){let e=Vs.default.decode(r);if(r=r.slice(Vs.default.decode.bytes),r.length!==e)throw new Error("inconsistent lengths");return M(r)}function YG(r){let e;r[0]==="Q"||r[0]==="1"?e=ec(or.decode(`z${r}`)).bytes:e=Ve.parse(r).multihash.bytes;let t=Uint8Array.from(Vs.default.encode(e.length));return Ee([t,e],t.length+e.length)}function QG(r){let e=GG.decode(r),t=Uint8Array.from(Vs.default.encode(e.length));return Ee([t,e],t.length+e.length)}function XG(r){let e=Vs.default.decode(r),t=r.slice(Vs.default.decode.bytes);if(t.length!==e)throw new Error("inconsistent lengths");return"u"+M(t,"base64url")}function jG(r){let e=Vs.default.decode(r),t=r.slice(Vs.default.decode.bytes);if(t.length!==e)throw new Error("inconsistent lengths");return M(t,"base58btc")}function ZG(r){let e=r.split(":");if(e.length!==2)throw new Error(`failed to parse onion addr: ["'${e.join('", "')}'"]' does not contain a port number`);if(e[0].length!==16)throw new Error(`failed to parse onion addr: ${e[0]} not a Tor onion address.`);let t=rr.decode("b"+e[0]),n=parseInt(e[1],10);if(n<1||n>65536)throw new Error("Port number is not in range(1, 65536)");let s=yg(n);return Ee([t,s],t.length+s.length)}function JG(r){let e=r.split(":");if(e.length!==2)throw new Error(`failed to parse onion addr: ["'${e.join('", "')}'"]' does not contain a port number`);if(e[0].length!==56)throw new Error(`failed to parse onion addr: ${e[0]} not a Tor onion3 address.`);let t=rr.decode(`b${e[0]}`),n=parseInt(e[1],10);if(n<1||n>65536)throw new Error("Port number is not in range(1, 65536)");let s=yg(n);return Ee([t,s],t.length+s.length)}function BA(r){let e=r.slice(0,r.length-2),t=r.slice(r.length-2),n=M(e,"base32"),s=MA(t);return`${n}:${s}`}function UA(r){r=bg(r);let e=[],t=[],n=null,s=r.split("/").slice(1);if(s.length===1&&s[0]==="")return{bytes:new Uint8Array,string:"/",tuples:[],stringTuples:[],path:null};for(let i=0;i<s.length;i++){let o=s[i],a=se(o);if(a.size===0){e.push([a.code]),t.push([a.code]);continue}if(i++,i>=s.length)throw VA("invalid address: "+r);if(a.path===!0){n=bg(s.slice(i).join("/")),e.push([a.code,gg(a.code,n)]),t.push([a.code,n]);break}let c=gg(a.code,s[i]);e.push([a.code,c]),t.push([a.code,Vf(a.code,c)])}return{string:FA(t),bytes:xg(e),tuples:e,stringTuples:t,path:n}}function wg(r){let e=[],t=[],n=null,s=0;for(;s<r.length;){let i=el.default.decode(r,s),o=el.default.decode.bytes??0,a=se(i),c=eW(a,r.slice(s+o));if(c===0){e.push([i]),t.push([i]),s+=o;continue}let l=r.slice(s+o,s+o+c);if(s+=c+o,s>r.length)throw VA("Invalid address Uint8Array: "+M(r,"base16"));e.push([i,l]);let u=Vf(i,l);if(t.push([i,u]),a.path===!0){n=u;break}}return{bytes:Uint8Array.from(r),string:FA(t),tuples:e,stringTuples:t,path:n}}function FA(r){let e=[];return r.map(t=>{let n=se(t[0]);return e.push(n.name),t.length>1&&t[1]!=null&&e.push(t[1]),null}),bg(e.join("/"))}function xg(r){return Ee(r.map(e=>{let t=se(e[0]),n=Uint8Array.from(el.default.encode(t.code));return e.length>1&&e[1]!=null&&(n=Ee([n,e[1]])),n}))}function eW(r,e){return r.size>0?r.size/8:r.size===0?0:el.default.decode(e)+(el.default.decode.bytes??0)}function bg(r){return"/"+r.trim().split("/").filter(e=>e).join("/")}function VA(r){return new Error("Error parsing address: "+r)}var tW=Symbol.for("nodejs.util.inspect.custom"),rW=[se("dns").code,se("dns4").code,se("dns6").code,se("dnsaddr").code],Eg=new Map,zA=Symbol.for("@multiformats/js-multiaddr/multiaddr");function Ea(r){return!!r?.[zA]}var wi=class{bytes;#e;#t;#r;#n;[zA]=!0;constructor(e){e==null&&(e="");let t;if(e instanceof Uint8Array)t=wg(e);else if(typeof e=="string"){if(e.length>0&&e.charAt(0)!=="/")throw new Error(`multiaddr "${e}" must start with a "/"`);t=UA(e)}else if(Ea(e))t=wg(e.bytes);else throw new Error("addr must be a string, Buffer, or another Multiaddr");this.bytes=t.bytes,this.#e=t.string,this.#t=t.tuples,this.#r=t.stringTuples,this.#n=t.path}toString(){return this.#e}toJSON(){return this.toString()}toOptions(){let e,t,n,s,i="",o=se("tcp"),a=se("udp"),c=se("ip4"),l=se("ip6"),u=se("dns6"),f=se("ip6zone");for(let[p,d]of this.stringTuples())p===f.code&&(i=`%${d??""}`),rW.includes(p)&&(t=o.name,s=443,n=`${d??""}${i}`,e=p===u.code?6:4),(p===o.code||p===a.code)&&(t=se(p).name,s=parseInt(d??"")),(p===c.code||p===l.code)&&(t=se(p).name,n=`${d??""}${i}`,e=p===l.code?6:4);if(e==null||t==null||n==null||s==null)throw new Error('multiaddr must have a valid format: "/{ip4, ip6, dns4, dns6, dnsaddr}/{address}/{tcp, udp}/{port}".');return{family:e,host:n,transport:t,port:s}}protos(){return this.#t.map(([e])=>Object.assign({},se(e)))}protoCodes(){return this.#t.map(([e])=>e)}protoNames(){return this.#t.map(([e])=>se(e).name)}tuples(){return this.#t}stringTuples(){return this.#r}encapsulate(e){return e=new wi(e),new wi(this.toString()+e.toString())}decapsulate(e){let t=e.toString(),n=this.toString(),s=n.lastIndexOf(t);if(s<0)throw new Error(`Address ${this.toString()} does not contain subaddress: ${e.toString()}`);return new wi(n.slice(0,s))}decapsulateCode(e){let t=this.tuples();for(let n=t.length-1;n>=0;n--)if(t[n][0]===e)return new wi(xg(t.slice(0,n)));return this}getPeerId(){try{let e=[];this.stringTuples().forEach(([n,s])=>{n===Jc.p2p.code&&e.push([n,s]),n===Jc["p2p-circuit"].code&&(e=[])});let t=e.pop();if(t?.[1]!=null){let n=t[1];return n[0]==="Q"||n[0]==="1"?M(or.decode(`z${n}`),"base58btc"):M(Ve.parse(n).multihash.bytes,"base58btc")}return null}catch{return null}}getPath(){return this.#n}equals(e){return be(this.bytes,e.bytes)}async resolve(e){let t=this.protos().find(i=>i.resolvable);if(t==null)return[this];let n=Eg.get(t.name);if(n==null)throw new E(`no available resolver for ${t.name}`,"ERR_NO_AVAILABLE_RESOLVER");return(await n(this,e)).map(i=>new wi(i))}nodeAddress(){let e=this.toOptions();if(e.transport!=="tcp"&&e.transport!=="udp")throw new Error(`multiaddr must have a valid format - no protocol with name: "${e.transport}". Must have a valid transport protocol: "{tcp, udp}"`);return{family:e.family,address:e.host,port:e.port}}isThinWaistAddress(e){let t=(e??this).protos();return!(t.length!==2||t[0].code!==4&&t[0].code!==41||t[1].code!==6&&t[1].code!==273)}[tW](){return`Multiaddr(${this.#e})`}};function fe(r){return new wi(r)}var qA="libp2p-peer-record",KA=Uint8Array.from([3,1]);var zf;(function(r){let e;(function(n){let s;n.codec=()=>(s==null&&(s=me((i,o,a={})=>{a.lengthDelimited!==!1&&o.fork(),i.multiaddr!=null&&i.multiaddr.byteLength>0&&(o.uint32(10),o.bytes(i.multiaddr)),a.lengthDelimited!==!1&&o.ldelim()},(i,o)=>{let a={multiaddr:new Uint8Array(0)},c=o==null?i.len:i.pos+o;for(;i.pos<c;){let l=i.uint32();switch(l>>>3){case 1:a.multiaddr=i.bytes();break;default:i.skipType(l&7);break}}return a})),s),n.encode=i=>pe(i,n.codec()),n.decode=i=>de(i,n.codec())})(e=r.AddressInfo||(r.AddressInfo={}));let t;r.codec=()=>(t==null&&(t=me((n,s,i={})=>{if(i.lengthDelimited!==!1&&s.fork(),n.peerId!=null&&n.peerId.byteLength>0&&(s.uint32(10),s.bytes(n.peerId)),n.seq!=null&&n.seq!==0n&&(s.uint32(16),s.uint64(n.seq)),n.addresses!=null)for(let o of n.addresses)s.uint32(26),r.AddressInfo.codec().encode(o,s);i.lengthDelimited!==!1&&s.ldelim()},(n,s)=>{let i={peerId:new Uint8Array(0),seq:0n,addresses:[]},o=s==null?n.len:n.pos+s;for(;n.pos<o;){let a=n.uint32();switch(a>>>3){case 1:i.peerId=n.bytes();break;case 2:i.seq=n.uint64();break;case 3:i.addresses.push(r.AddressInfo.codec().decode(n,n.uint32()));break;default:n.skipType(a&7);break}}return i})),t),r.encode=n=>pe(n,r.codec()),r.decode=n=>de(n,r.codec())})(zf||(zf={}));var tl=class{peerId;multiaddrs;seqNumber;domain=tl.DOMAIN;codec=tl.CODEC;marshaled;constructor(e){let{peerId:t,multiaddrs:n,seqNumber:s}=e;this.peerId=t,this.multiaddrs=n??[],this.seqNumber=s??BigInt(Date.now())}marshal(){return this.marshaled==null&&(this.marshaled=zf.encode({peerId:this.peerId.toBytes(),seq:BigInt(this.seqNumber),addresses:this.multiaddrs.map(e=>({multiaddr:e.bytes}))})),this.marshaled}equals(e){return!(!(e instanceof tl)||!this.peerId.equals(e.peerId)||this.seqNumber!==e.seqNumber||!AA(this.multiaddrs,e.multiaddrs))}},Rr=tl;gt(Rr,"createFromProtobuf",e=>{let t=zf.decode(e),n=_t(t.peerId),s=(t.addresses??[]).map(o=>fe(o.multiaddr)),i=t.seq;return new tl({peerId:n,multiaddrs:s,seqNumber:i})}),gt(Rr,"DOMAIN",qA),gt(Rr,"CODEC",KA);var Gge=new Uint8Array(0);var vg=class{constructor(e,t,n){this.name=e,this.prefix=t,this.baseEncode=n}encode(e){if(e instanceof Uint8Array)return`${this.prefix}${this.baseEncode(e)}`;throw Error("Unknown type, must be binary type")}},_g=class{constructor(e,t,n){if(this.name=e,this.prefix=t,t.codePointAt(0)===void 0)throw new Error("Invalid prefix character");this.prefixCodePoint=t.codePointAt(0),this.baseDecode=n}decode(e){if(typeof e=="string"){if(e.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(e)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(e.slice(this.prefix.length))}else throw Error("Can only multibase decode strings")}or(e){return $A(this,e)}},Sg=class{constructor(e){this.decoders=e}or(e){return $A(this,e)}decode(e){let t=e[0],n=this.decoders[t];if(n)return n.decode(e);throw RangeError(`Unable to decode multibase string ${JSON.stringify(e)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}},$A=(r,e)=>new Sg({...r.decoders||{[r.prefix]:r},...e.decoders||{[e.prefix]:e}}),Ag=class{constructor(e,t,n,s){this.name=e,this.prefix=t,this.baseEncode=n,this.baseDecode=s,this.encoder=new vg(e,t,n),this.decoder=new _g(e,t,s)}encode(e){return this.encoder.encode(e)}decode(e){return this.decoder.decode(e)}},nW=({name:r,prefix:e,encode:t,decode:n})=>new Ag(r,e,t,n);var sW=(r,e,t,n)=>{let s={};for(let u=0;u<e.length;++u)s[e[u]]=u;let i=r.length;for(;r[i-1]==="=";)--i;let o=new Uint8Array(i*t/8|0),a=0,c=0,l=0;for(let u=0;u<i;++u){let f=s[r[u]];if(f===void 0)throw new SyntaxError(`Non-${n} character`);c=c<<t|f,a+=t,a>=8&&(a-=8,o[l++]=255&c>>a)}if(a>=t||255&c<<8-a)throw new SyntaxError("Unexpected end of data");return o},iW=(r,e,t)=>{let n=e[e.length-1]==="=",s=(1<<t)-1,i="",o=0,a=0;for(let c=0;c<r.length;++c)for(a=a<<8|r[c],o+=8;o>t;)o-=t,i+=e[s&a>>o];if(o&&(i+=e[s&a<<t-o]),n)for(;i.length*t&7;)i+="=";return i},zs=({name:r,prefix:e,bitsPerChar:t,alphabet:n})=>nW({prefix:e,name:r,encode(s){return iW(s,n,t)},decode(s){return sW(s,n,t,r)}});var HA=zs({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5}),e8e=zs({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5}),t8e=zs({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5}),r8e=zs({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5}),n8e=zs({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5}),s8e=zs({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5}),i8e=zs({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5}),o8e=zs({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5}),a8e=zs({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5});var yr={ERR_INVALID_PARAMETERS:"ERR_INVALID_PARAMETERS"};var rl;(function(r){let e;(function(s){let i;s.codec=()=>(i==null&&(i=me((o,a,c={})=>{c.lengthDelimited!==!1&&a.fork(),o.key!=null&&o.key!==""&&(a.uint32(10),a.string(o.key)),o.value!=null&&o.value.byteLength>0&&(a.uint32(18),a.bytes(o.value)),c.lengthDelimited!==!1&&a.ldelim()},(o,a)=>{let c={key:"",value:new Uint8Array(0)},l=a==null?o.len:o.pos+a;for(;o.pos<l;){let u=o.uint32();switch(u>>>3){case 1:c.key=o.string();break;case 2:c.value=o.bytes();break;default:o.skipType(u&7);break}}return c})),i),s.encode=o=>pe(o,s.codec()),s.decode=o=>de(o,s.codec())})(e=r.Peer$metadataEntry||(r.Peer$metadataEntry={}));let t;(function(s){let i;s.codec=()=>(i==null&&(i=me((o,a,c={})=>{c.lengthDelimited!==!1&&a.fork(),o.key!=null&&o.key!==""&&(a.uint32(10),a.string(o.key)),o.value!=null&&(a.uint32(18),Xd.codec().encode(o.value,a)),c.lengthDelimited!==!1&&a.ldelim()},(o,a)=>{let c={key:""},l=a==null?o.len:o.pos+a;for(;o.pos<l;){let u=o.uint32();switch(u>>>3){case 1:c.key=o.string();break;case 2:c.value=Xd.codec().decode(o,o.uint32());break;default:o.skipType(u&7);break}}return c})),i),s.encode=o=>pe(o,s.codec()),s.decode=o=>de(o,s.codec())})(t=r.Peer$tagsEntry||(r.Peer$tagsEntry={}));let n;r.codec=()=>(n==null&&(n=me((s,i,o={})=>{if(o.lengthDelimited!==!1&&i.fork(),s.addresses!=null)for(let a of s.addresses)i.uint32(10),Qd.codec().encode(a,i);if(s.protocols!=null)for(let a of s.protocols)i.uint32(18),i.string(a);if(s.publicKey!=null&&(i.uint32(34),i.bytes(s.publicKey)),s.peerRecordEnvelope!=null&&(i.uint32(42),i.bytes(s.peerRecordEnvelope)),s.metadata!=null&&s.metadata.size!==0)for(let[a,c]of s.metadata.entries())i.uint32(50),r.Peer$metadataEntry.codec().encode({key:a,value:c},i);if(s.tags!=null&&s.tags.size!==0)for(let[a,c]of s.tags.entries())i.uint32(58),r.Peer$tagsEntry.codec().encode({key:a,value:c},i);o.lengthDelimited!==!1&&i.ldelim()},(s,i)=>{let o={addresses:[],protocols:[],metadata:new Map,tags:new Map},a=i==null?s.len:s.pos+i;for(;s.pos<a;){let c=s.uint32();switch(c>>>3){case 1:o.addresses.push(Qd.codec().decode(s,s.uint32()));break;case 2:o.protocols.push(s.string());break;case 4:o.publicKey=s.bytes();break;case 5:o.peerRecordEnvelope=s.bytes();break;case 6:{let l=r.Peer$metadataEntry.codec().decode(s,s.uint32());o.metadata.set(l.key,l.value);break}case 7:{let l=r.Peer$tagsEntry.codec().decode(s,s.uint32());o.tags.set(l.key,l.value);break}default:s.skipType(c&7);break}}return o})),n),r.encode=s=>pe(s,r.codec()),r.decode=s=>de(s,r.codec())})(rl||(rl={}));var Qd;(function(r){let e;r.codec=()=>(e==null&&(e=me((t,n,s={})=>{s.lengthDelimited!==!1&&n.fork(),t.multiaddr!=null&&t.multiaddr.byteLength>0&&(n.uint32(10),n.bytes(t.multiaddr)),t.isCertified!=null&&(n.uint32(16),n.bool(t.isCertified)),s.lengthDelimited!==!1&&n.ldelim()},(t,n)=>{let s={multiaddr:new Uint8Array(0)},i=n==null?t.len:t.pos+n;for(;t.pos<i;){let o=t.uint32();switch(o>>>3){case 1:s.multiaddr=t.bytes();break;case 2:s.isCertified=t.bool();break;default:t.skipType(o&7);break}}return s})),e),r.encode=t=>pe(t,r.codec()),r.decode=t=>de(t,r.codec())})(Qd||(Qd={}));var Xd;(function(r){let e;r.codec=()=>(e==null&&(e=me((t,n,s={})=>{s.lengthDelimited!==!1&&n.fork(),t.value!=null&&t.value!==0&&(n.uint32(8),n.uint32(t.value)),t.expiry!=null&&(n.uint32(16),n.uint64(t.expiry)),s.lengthDelimited!==!1&&n.ldelim()},(t,n)=>{let s={value:0},i=n==null?t.len:t.pos+n;for(;t.pos<i;){let o=t.uint32();switch(o>>>3){case 1:s.value=t.uint32();break;case 2:s.expiry=t.uint64();break;default:t.skipType(o&7);break}}return s})),e),r.encode=t=>pe(t,r.codec()),r.decode=t=>de(t,r.codec())})(Xd||(Xd={}));function nl(r,e){let t=rl.decode(e);t.publicKey!=null&&r.publicKey==null&&(r=rA({...r,publicKey:r.publicKey}));let n=new Map,s=BigInt(Date.now());for(let[i,o]of t.tags.entries())o.expiry!=null&&o.expiry<s||n.set(i,o);return{...t,id:r,addresses:t.addresses.map(({multiaddr:i,isCertified:o})=>({multiaddr:fe(i),isCertified:o??!1})),metadata:t.metadata,peerRecordEnvelope:t.peerRecordEnvelope??void 0,tags:n}}var Rg="/peers/";function sl(r){if(!zd(r)||r.type==null)throw new E("Invalid PeerId",yr.ERR_INVALID_PARAMETERS);let e=r.toCID().toString();return new Ce(`${Rg}${e}`)}async function GA(r,e,t){let n=new Map;for(let s of t){if(s==null)continue;if(s.multiaddr instanceof Uint8Array&&(s.multiaddr=fe(s.multiaddr)),!Ea(s.multiaddr))throw new E("Multiaddr was invalid",yr.ERR_INVALID_PARAMETERS);if(!await e(r,s.multiaddr))continue;let i=s.isCertified??!1,o=s.multiaddr.toString(),a=n.get(o);a!=null?s.isCertified=a.isCertified||i:n.set(o,{multiaddr:s.multiaddr,isCertified:i})}return[...n.values()].sort((s,i)=>s.multiaddr.toString().localeCompare(i.multiaddr.toString())).map(({isCertified:s,multiaddr:i})=>({isCertified:s,multiaddr:i.bytes}))}async function Zd(r,e,t,n){if(e==null)throw new E("Invalid PeerData",yr.ERR_INVALID_PARAMETERS);if(e.publicKey!=null&&r.publicKey!=null&&!be(e.publicKey,r.publicKey))throw new E("publicKey bytes do not match peer id publicKey bytes",yr.ERR_INVALID_PARAMETERS);let s=n.existingPeer;if(s!=null&&!r.equals(s.id))throw new E("peer id did not match existing peer id",yr.ERR_INVALID_PARAMETERS);let i=s?.addresses??[],o=new Set(s?.protocols??[]),a=s?.metadata??new Map,c=s?.tags??new Map,l=s?.peerRecordEnvelope;if(t==="patch"){if((e.multiaddrs!=null||e.addresses!=null)&&(i=[],e.multiaddrs!=null&&i.push(...e.multiaddrs.map(f=>({isCertified:!1,multiaddr:f}))),e.addresses!=null&&i.push(...e.addresses)),e.protocols!=null&&(o=new Set(e.protocols)),e.metadata!=null){let f=e.metadata instanceof Map?[...e.metadata.entries()]:Object.entries(e.metadata);a=jd(f,{validate:WA})}if(e.tags!=null){let f=e.tags instanceof Map?[...e.tags.entries()]:Object.entries(e.tags);c=jd(f,{validate:YA,map:QA})}e.peerRecordEnvelope!=null&&(l=e.peerRecordEnvelope)}if(t==="merge"){if(e.multiaddrs!=null&&i.push(...e.multiaddrs.map(f=>({isCertified:!1,multiaddr:f}))),e.addresses!=null&&i.push(...e.addresses),e.protocols!=null&&(o=new Set([...o,...e.protocols])),e.metadata!=null){let f=e.metadata instanceof Map?[...e.metadata.entries()]:Object.entries(e.metadata);for(let[h,p]of f)p==null?a.delete(h):a.set(h,p);a=jd([...a.entries()],{validate:WA})}if(e.tags!=null){let f=e.tags instanceof Map?[...e.tags.entries()]:Object.entries(e.tags),h=new Map(c);for(let[p,d]of f)d==null?h.delete(p):h.set(p,d);c=jd([...h.entries()],{validate:YA,map:QA})}e.peerRecordEnvelope!=null&&(l=e.peerRecordEnvelope)}let u={addresses:await GA(r,n.addressFilter??(async()=>!0),i),protocols:[...o.values()].sort((f,h)=>f.localeCompare(h)),metadata:a,tags:c,publicKey:s?.id.publicKey??e.publicKey??r.publicKey,peerRecordEnvelope:l};return r.type!=="RSA"&&delete u.publicKey,u}function jd(r,e){let t=new Map;for(let[n,s]of r)s!=null&&e.validate(n,s);for(let[n,s]of r.sort(([i],[o])=>i.localeCompare(o)))s!=null&&t.set(n,e.map?.(n,s)??s);return t}function WA(r,e){if(typeof r!="string")throw new E("Metadata key must be a string",yr.ERR_INVALID_PARAMETERS);if(!(e instanceof Uint8Array))throw new E("Metadata value must be a Uint8Array",yr.ERR_INVALID_PARAMETERS)}function YA(r,e){if(typeof r!="string")throw new E("Tag name must be a string",yr.ERR_INVALID_PARAMETERS);if(e.value!=null){if(parseInt(`${e.value}`,10)!==e.value)throw new E("Tag value must be an integer",yr.ERR_INVALID_PARAMETERS);if(e.value<0||e.value>100)throw new E("Tag value must be between 0-100",yr.ERR_INVALID_PARAMETERS)}if(e.ttl!=null){if(parseInt(`${e.ttl}`,10)!==e.ttl)throw new E("Tag ttl must be an integer",yr.ERR_INVALID_PARAMETERS);if(e.ttl<0)throw new E("Tag ttl must be between greater than 0",yr.ERR_INVALID_PARAMETERS)}}function QA(r,e){let t;return e.expiry!=null&&(t=e.expiry),e.ttl!=null&&(t=BigInt(Date.now()+Number(e.ttl))),{value:e.value??0,expiry:t}}function Jd(r,e,t){let n=r.toString().split("/")[2],s=HA.decode(n),i=_t(s),o=t.get(i);if(o!=null)return o;let a=nl(i,e);return t.set(i,a),a}function oW(r,e){return r==null?{}:{prefix:Rg,filters:(r.filters??[]).map(t=>({key:n,value:s})=>t(Jd(n,s,e))),orders:(r.orders??[]).map(t=>(n,s)=>t(Jd(n.key,n.value,e),Jd(s.key,s.value,e)))}}var ep=class{peerId;datastore;lock;addressFilter;constructor(e,t={}){this.peerId=e.peerId,this.datastore=e.datastore,this.addressFilter=t.addressFilter,this.lock=rf({name:"peer-store",singleProcess:!0})}async has(e){return this.datastore.has(sl(e))}async delete(e){if(this.peerId.equals(e))throw new E("Cannot delete self peer",yr.ERR_INVALID_PARAMETERS);await this.datastore.delete(sl(e))}async load(e){let t=await this.datastore.get(sl(e));return nl(e,t)}async save(e,t){let{existingBuf:n,existingPeer:s}=await this.#e(e),i=await Zd(e,t,"patch",{addressFilter:this.addressFilter});return this.#t(e,i,n,s)}async patch(e,t){let{existingBuf:n,existingPeer:s}=await this.#e(e),i=await Zd(e,t,"patch",{addressFilter:this.addressFilter,existingPeer:s});return this.#t(e,i,n,s)}async merge(e,t){let{existingBuf:n,existingPeer:s}=await this.#e(e),i=await Zd(e,t,"merge",{addressFilter:this.addressFilter,existingPeer:s});return this.#t(e,i,n,s)}async*all(e){let t=new Sr;for await(let{key:n,value:s}of this.datastore.query(oW(e??{},t))){let i=Jd(n,s,t);i.id.equals(this.peerId)||(yield i)}}async#e(e){try{let t=await this.datastore.get(sl(e)),n=nl(e,t);return{existingBuf:t,existingPeer:n}}catch(t){if(t.code!=="ERR_NOT_FOUND")throw t}return{}}async#t(e,t,n,s){let i=rl.encode(t);return n!=null&&be(i,n)?{peer:nl(e,i),previous:s,updated:!1}:(await this.datastore.put(sl(e),i),{peer:nl(e,i),previous:s,updated:!0})}};var ct=C("libp2p:peer-store"),tp=class{store;events;peerId;constructor(e,t={}){this.events=e.events,this.peerId=e.peerId,this.store=new ep(e,t)}async forEach(e,t){ct.trace("forEach await read lock");let n=await this.store.lock.readLock();ct.trace("forEach got read lock");try{for await(let s of this.store.all(t))e(s)}finally{ct.trace("forEach release read lock"),n()}}async all(e){ct.trace("all await read lock");let t=await this.store.lock.readLock();ct.trace("all got read lock");try{return await vu(this.store.all(e))}finally{ct.trace("all release read lock"),t()}}async delete(e){ct.trace("delete await write lock");let t=await this.store.lock.writeLock();ct.trace("delete got write lock");try{await this.store.delete(e)}finally{ct.trace("delete release write lock"),t()}}async has(e){ct.trace("has await read lock");let t=await this.store.lock.readLock();ct.trace("has got read lock");try{return await this.store.has(e)}finally{ct.trace("has release read lock"),t()}}async get(e){ct.trace("get await read lock");let t=await this.store.lock.readLock();ct.trace("get got read lock");try{return await this.store.load(e)}finally{ct.trace("get release read lock"),t()}}async save(e,t){ct.trace("save await write lock");let n=await this.store.lock.writeLock();ct.trace("save got write lock");try{let s=await this.store.save(e,t);return this.#e(e,s),s.peer}finally{ct.trace("save release write lock"),n()}}async patch(e,t){ct.trace("patch await write lock");let n=await this.store.lock.writeLock();ct.trace("patch got write lock");try{let s=await this.store.patch(e,t);return this.#e(e,s),s.peer}finally{ct.trace("patch release write lock"),n()}}async merge(e,t){ct.trace("merge await write lock");let n=await this.store.lock.writeLock();ct.trace("merge got write lock");try{let s=await this.store.merge(e,t);return this.#e(e,s),s.peer}finally{ct.trace("merge release write lock"),n()}}async consumePeerRecord(e,t){let n=await Lr.openAndCertify(e,Rr.DOMAIN);if(t?.equals(n.peerId)===!1)return ct("envelope peer id was not the expected peer id - expected: %p received: %p",t,n.peerId),!1;let s=Rr.createFromProtobuf(n.payload),i;try{i=await this.get(n.peerId)}catch(o){if(o.code!=="ERR_NOT_FOUND")throw o}if(i?.peerRecordEnvelope!=null){let o=await Lr.createFromProtobuf(i.peerRecordEnvelope),a=Rr.createFromProtobuf(o.payload);if(a.seqNumber>=s.seqNumber)return ct("sequence number was lower or equal to existing sequence number - stored: %d received: %d",a.seqNumber,s.seqNumber),!1}return await this.patch(s.peerId,{peerRecordEnvelope:e,addresses:s.multiaddrs.map(o=>({isCertified:!0,multiaddr:o}))}),!0}#e(e,t){t.updated&&(this.peerId.equals(e)?this.events.safeDispatchEvent("self:peer:update",{detail:t}):this.events.safeDispatchEvent("peer:update",{detail:t}))}};function XA(r,e){let t;return function(){let n=function(){t=void 0,r()};clearTimeout(t),t=setTimeout(n,e)}}var aW=C("libp2p:address-manager"),cW=r=>r;function Ig(r,e){let t=r.getPeerId();return t!=null&&he(t).equals(e)&&(r=r.decapsulate(fe(`/p2p/${e.toString()}`))),r}var rp=class{components;listen;announce;observed;announceFilter;constructor(e,t={}){let{listen:n=[],announce:s=[]}=t;this.components=e,this.listen=n.map(i=>i.toString()),this.announce=new Set(s.map(i=>i.toString())),this.observed=new Map,this.announceFilter=t.announceFilter??cW,this._updatePeerStoreAddresses=XA(this._updatePeerStoreAddresses.bind(this),1e3),e.events.addEventListener("transport:listening",()=>{this._updatePeerStoreAddresses()}),e.events.addEventListener("transport:close",()=>{this._updatePeerStoreAddresses()})}_updatePeerStoreAddresses(){let e=this.getAnnounceAddrs().concat(this.components.transportManager.getAddrs()).concat([...this.observed.entries()].filter(([t,n])=>n.confident).map(([t])=>fe(t))).map(t=>t.getPeerId()===this.components.peerId.toString()?t.decapsulate(`/p2p/${this.components.peerId.toString()}`):t);this.components.peerStore.patch(this.components.peerId,{multiaddrs:e}).catch(t=>{aW.error("error updating addresses",t)})}getListenAddrs(){return Array.from(this.listen).map(e=>fe(e))}getAnnounceAddrs(){return Array.from(this.announce).map(e=>fe(e))}getObservedAddrs(){return Array.from(this.observed).map(([e])=>fe(e))}addObservedAddr(e){e=Ig(e,this.components.peerId);let t=e.toString();this.observed.has(t)||this.observed.set(t,{confident:!1})}confirmObservedAddr(e){e=Ig(e,this.components.peerId);let t=e.toString(),s=(this.observed.get(t)??{confident:!1}).confident;this.observed.set(t,{confident:!0}),s||this._updatePeerStoreAddresses()}removeObservedAddr(e){e=Ig(e,this.components.peerId);let t=e.toString();this.observed.delete(t)}getAddresses(){let e=this.getAnnounceAddrs().map(n=>n.toString());e.length===0&&(e=this.components.transportManager.getAddrs().map(n=>n.toString())),e=e.concat(Array.from(this.observed).filter(([n,s])=>s.confident).map(([n])=>n));let t=new Set(e);return this.announceFilter(Array.from(t).map(n=>fe(n))).map(n=>n.protos().pop()?.path===!0||n.getPeerId()===this.components.peerId.toString()?n:n.encapsulate(`/p2p/${this.components.peerId.toString()}`))}};function jA(r){return r!=null&&typeof r.start=="function"&&typeof r.stop=="function"}var Tg=class{components={};_started=!1;constructor(e={}){this.components={};for(let[t,n]of Object.entries(e))this.components[t]=n}isStarted(){return this._started}async _invokeStartableMethod(e){await Promise.all(Object.values(this.components).filter(t=>jA(t)).map(async t=>{await t[e]?.()}))}async beforeStart(){await this._invokeStartableMethod("beforeStart")}async start(){await this._invokeStartableMethod("start"),this._started=!0}async afterStart(){await this._invokeStartableMethod("afterStart")}async beforeStop(){await this._invokeStartableMethod("beforeStop")}async stop(){await this._invokeStartableMethod("stop"),this._started=!1}async afterStop(){await this._invokeStartableMethod("afterStop")}},lW=["metrics","connectionProtector"],uW=["components","isStarted","beforeStart","start","afterStart","beforeStop","stop","afterStop","then","_invokeStartableMethod"];function ZA(r={}){let e=new Tg(r);return new Proxy(e,{get(n,s,i){if(typeof s=="string"&&!uW.includes(s)){let o=e.components[s];if(o==null&&!lW.includes(s))throw new E(`${s} not set`,"ERR_SERVICE_MISSING");return o}return Reflect.get(n,s,i)},set(n,s,i){return typeof s=="string"?e.components[s]=i:Reflect.set(n,s,i),!0}})}var iR=W(JA(),1);var eR="[a-fA-F\\d:]",co=r=>r&&r.includeBoundaries?`(?:(?<=\\s|^)(?=${eR})|(?<=${eR})(?=\\s|$))`:"",us="(?:25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]\\d|\\d)(?:\\.(?:25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]\\d|\\d)){3}",jt="[a-fA-F\\d]{1,4}",np=`
(?:
(?:${jt}:){7}(?:${jt}|:)|                                    // 1:2:3:4:5:6:7::  1:2:3:4:5:6:7:8
(?:${jt}:){6}(?:${us}|:${jt}|:)|                             // 1:2:3:4:5:6::    1:2:3:4:5:6::8   1:2:3:4:5:6::8  1:2:3:4:5:6::1.2.3.4
(?:${jt}:){5}(?::${us}|(?::${jt}){1,2}|:)|                   // 1:2:3:4:5::      1:2:3:4:5::7:8   1:2:3:4:5::8    1:2:3:4:5::7:1.2.3.4
(?:${jt}:){4}(?:(?::${jt}){0,1}:${us}|(?::${jt}){1,3}|:)| // 1:2:3:4::        1:2:3:4::6:7:8   1:2:3:4::8      1:2:3:4::6:7:1.2.3.4
(?:${jt}:){3}(?:(?::${jt}){0,2}:${us}|(?::${jt}){1,4}|:)| // 1:2:3::          1:2:3::5:6:7:8   1:2:3::8        1:2:3::5:6:7:1.2.3.4
(?:${jt}:){2}(?:(?::${jt}){0,3}:${us}|(?::${jt}){1,5}|:)| // 1:2::            1:2::4:5:6:7:8   1:2::8          1:2::4:5:6:7:1.2.3.4
(?:${jt}:){1}(?:(?::${jt}){0,4}:${us}|(?::${jt}){1,6}|:)| // 1::              1::3:4:5:6:7:8   1::8            1::3:4:5:6:7:1.2.3.4
(?::(?:(?::${jt}){0,5}:${us}|(?::${jt}){1,7}|:))             // ::2:3:4:5:6:7:8  ::2:3:4:5:6:7:8  ::8             ::1.2.3.4
)(?:%[0-9a-zA-Z]{1,})?                                             // %eth0            %1
`.replace(/\s*\/\/.*$/gm,"").replace(/\n/g,"").trim(),fW=new RegExp(`(?:^${us}$)|(?:^${np}$)`),hW=new RegExp(`^${us}$`),dW=new RegExp(`^${np}$`),Dg=r=>r&&r.exact?fW:new RegExp(`(?:${co(r)}${us}${co(r)})|(?:${co(r)}${np}${co(r)})`,"g");Dg.v4=r=>r&&r.exact?hW:new RegExp(`${co(r)}${us}${co(r)}`,"g");Dg.v6=r=>r&&r.exact?dW:new RegExp(`${co(r)}${np}${co(r)}`,"g");var tR=Dg;var oR=W(nR(),1),{isValid:pW,parse:mW}=oR.default,gW=["0.0.0.0/8","10.0.0.0/8","100.64.0.0/10","127.0.0.0/8","169.254.0.0/16","172.16.0.0/12","192.0.0.0/24","192.0.0.0/29","192.0.0.8/32","192.0.0.9/32","192.0.0.10/32","192.0.0.170/32","192.0.0.171/32","192.0.2.0/24","192.31.196.0/24","192.52.193.0/24","192.88.99.0/24","192.168.0.0/16","192.175.48.0/24","198.18.0.0/15","198.51.100.0/24","203.0.113.0/24","240.0.0.0/4","255.255.255.255/32"],yW=gW.map(r=>new iR.Netmask(r));function bW(r){for(let e of yW)if(e.contains(r))return!0;return!1}function sR(r){return/^::$/.test(r)||/^::1$/.test(r)||/^::f{4}:([0-9]{1,3})\.([0-9]{1,3})\.([0-9]{1,3})\.([0-9]{1,3})$/.test(r)||/^::f{4}:0.([0-9]{1,3})\.([0-9]{1,3})\.([0-9]{1,3})\.([0-9]{1,3})$/.test(r)||/^64:ff9b::([0-9]{1,3})\.([0-9]{1,3})\.([0-9]{1,3})\.([0-9]{1,3})$/.test(r)||/^100::([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4})$/.test(r)||/^2001::([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4})$/.test(r)||/^2001:2[0-9a-fA-F]:([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4})$/.test(r)||/^2001:db8:([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4})$/.test(r)||/^2002:([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4})$/.test(r)||/^f[c-d]([0-9a-fA-F]{2,2}):/i.test(r)||/^fe[8-9a-bA-B][0-9a-fA-F]:/i.test(r)||/^ff([0-9a-fA-F]{2,2}):/i.test(r)}var aR=r=>{if(pW(r)){let e=mW(r);if(e.kind()==="ipv4")return bW(e.toNormalizedString());if(e.kind()==="ipv6")return sR(r)}else if(Zc(r)&&tR.v6().test(r))return sR(r)};var Vn=aR;function cR(r={}){return{denyDialPeer:async()=>!1,denyDialMultiaddr:async e=>{let t=e.stringTuples();return t[0][0]===4||t[0][0]===41?!!Vn(`${t[0][1]}`):!1},denyInboundConnection:async()=>!1,denyOutboundConnection:async()=>!1,denyInboundEncryptedConnection:async()=>!1,denyOutboundEncryptedConnection:async()=>!1,denyInboundUpgradedConnection:async()=>!1,denyOutboundUpgradedConnection:async()=>!1,filterMultiaddrForPeer:async()=>!0,...r}}var qs=Symbol.for("@libp2p/transport");var lo;(function(r){r[r.FATAL_ALL=0]="FATAL_ALL",r[r.NO_FATAL=1]="NO_FATAL"})(lo||(lo={}));function Cg(r){try{let{address:e}=r.nodeAddress();return!!Vn(e)}catch{return!0}}function il(r,e){let t=Cg(r.multiaddr),n=Cg(e.multiaddr);return t&&!n?1:!t&&n||r.isCertified&&!e.isCertified?-1:!r.isCertified&&e.isCertified?1:0}var kg=W(hu(),1),Ng=W(fR(),1);var hR=globalThis.fetch,dR=globalThis.Headers,b5e=globalThis.Request,w5e=globalThis.Response;function ip(r,e,t){return`${r}?name=${e}&type=${t}`}async function pR(r,e){return await(await hR(r,{headers:new dR({accept:"application/dns-json"}),signal:e})).json()}function va(r,e){return`${e}_${r}`}var Pg=Object.assign((0,kg.default)("dns-over-http-resolver"),{error:(0,kg.default)("dns-over-http-resolver:error")}),Og=class{constructor(e={}){this._cache=new Ng.default({max:e?.maxCache??100}),this._TXTcache=new Ng.default({max:e?.maxCache??100}),this._servers=["https://cloudflare-dns.com/dns-query","https://dns.google/resolve"],this._request=e.request??pR,this._abortControllers=[]}cancel(){this._abortControllers.forEach(e=>e.abort())}getServers(){return this._servers}_getShuffledServers(){let e=[...this._servers];for(let t=e.length-1;t>0;t--){let n=Math.floor(Math.random()*t),s=e[t];e[t]=e[n],e[n]=s}return e}setServers(e){this._servers=e}async resolve(e,t="A"){switch(t){case"A":return await this.resolve4(e);case"AAAA":return await this.resolve6(e);case"TXT":return await this.resolveTxt(e);default:throw new Error(`${t} is not supported`)}}async resolve4(e){let t="A",n=this._cache.get(va(e,t));if(n!=null)return n;let s=!1;for(let i of this._getShuffledServers()){let o=new AbortController;this._abortControllers.push(o);try{let a=await this._request(ip(i,e,t),o.signal),c=a.Answer.map(u=>u.data),l=Math.min(...a.Answer.map(u=>u.TTL));return this._cache.set(va(e,t),c,{ttl:l}),c}catch{o.signal.aborted&&(s=!0),Pg.error(`${i} could not resolve ${e} record ${t}`)}finally{this._abortControllers=this._abortControllers.filter(a=>a!==o)}}throw s?Object.assign(new Error("queryA ECANCELLED"),{code:"ECANCELLED"}):new Error(`Could not resolve ${e} record ${t}`)}async resolve6(e){let t="AAAA",n=this._cache.get(va(e,t));if(n!=null)return n;let s=!1;for(let i of this._getShuffledServers()){let o=new AbortController;this._abortControllers.push(o);try{let a=await this._request(ip(i,e,t),o.signal),c=a.Answer.map(u=>u.data),l=Math.min(...a.Answer.map(u=>u.TTL));return this._cache.set(va(e,t),c,{ttl:l}),c}catch{o.signal.aborted&&(s=!0),Pg.error(`${i} could not resolve ${e} record ${t}`)}finally{this._abortControllers=this._abortControllers.filter(a=>a!==o)}}throw s?Object.assign(new Error("queryAaaa ECANCELLED"),{code:"ECANCELLED"}):new Error(`Could not resolve ${e} record ${t}`)}async resolveTxt(e){let t="TXT",n=this._TXTcache.get(va(e,t));if(n!=null)return n;let s=!1;for(let i of this._getShuffledServers()){let o=new AbortController;this._abortControllers.push(o);try{let a=await this._request(ip(i,e,t),o.signal),c=a.Answer.map(u=>[u.data.replace(/['"]+/g,"")]),l=Math.min(...a.Answer.map(u=>u.TTL));return this._TXTcache.set(va(e,t),c,{ttl:l}),c}catch{o.signal.aborted&&(s=!0),Pg.error(`${i} could not resolve ${e} record ${t}`)}finally{this._abortControllers=this._abortControllers.filter(a=>a!==o)}}throw s?Object.assign(new Error("queryTxt ECANCELLED"),{code:"ECANCELLED"}):new Error(`Could not resolve ${e} record ${t}`)}clearCache(){this._cache.clear(),this._TXTcache.clear()}},mR=Og;var gR=mR;var{code:_W}=se("dnsaddr");async function ol(r,e={}){let t=new gR;e.signal!=null&&e.signal.addEventListener("abort",()=>{t.cancel()});let n=r.getPeerId(),[,s]=r.stringTuples().find(([a])=>a===_W)??[];if(s==null)throw new Error("No hostname found in multiaddr");let o=(await t.resolveTxt(`_dnsaddr.${s}`)).flat().map(a=>a.split("=")[1]).filter(Boolean);return n!=null&&(o=o.filter(a=>a.includes(n))),o}var Ks;(function(r){r.NOT_STARTED_YET="The libp2p node is not started yet",r.DHT_DISABLED="DHT is not available",r.PUBSUB_DISABLED="PubSub is not available",r.CONN_ENCRYPTION_REQUIRED="At least one connection encryption module is required",r.ERR_TRANSPORTS_REQUIRED="At least one transport module is required",r.ERR_PROTECTOR_REQUIRED="Private network is enforced, but no protector was provided",r.NOT_FOUND="Not found"})(Ks||(Ks={}));var z;(function(r){r.DHT_DISABLED="ERR_DHT_DISABLED",r.ERR_PUBSUB_DISABLED="ERR_PUBSUB_DISABLED",r.PUBSUB_NOT_STARTED="ERR_PUBSUB_NOT_STARTED",r.DHT_NOT_STARTED="ERR_DHT_NOT_STARTED",r.CONN_ENCRYPTION_REQUIRED="ERR_CONN_ENCRYPTION_REQUIRED",r.ERR_TRANSPORTS_REQUIRED="ERR_TRANSPORTS_REQUIRED",r.ERR_PROTECTOR_REQUIRED="ERR_PROTECTOR_REQUIRED",r.ERR_PEER_DIAL_INTERCEPTED="ERR_PEER_DIAL_INTERCEPTED",r.ERR_CONNECTION_INTERCEPTED="ERR_CONNECTION_INTERCEPTED",r.ERR_INVALID_PROTOCOLS_FOR_STREAM="ERR_INVALID_PROTOCOLS_FOR_STREAM",r.ERR_CONNECTION_ENDED="ERR_CONNECTION_ENDED",r.ERR_CONNECTION_FAILED="ERR_CONNECTION_FAILED",r.ERR_NODE_NOT_STARTED="ERR_NODE_NOT_STARTED",r.ERR_ALREADY_ABORTED="ERR_ALREADY_ABORTED",r.ERR_TOO_MANY_ADDRESSES="ERR_TOO_MANY_ADDRESSES",r.ERR_NO_VALID_ADDRESSES="ERR_NO_VALID_ADDRESSES",r.ERR_RELAYED_DIAL="ERR_RELAYED_DIAL",r.ERR_DIALED_SELF="ERR_DIALED_SELF",r.ERR_DISCOVERED_SELF="ERR_DISCOVERED_SELF",r.ERR_DUPLICATE_TRANSPORT="ERR_DUPLICATE_TRANSPORT",r.ERR_ENCRYPTION_FAILED="ERR_ENCRYPTION_FAILED",r.ERR_HOP_REQUEST_FAILED="ERR_HOP_REQUEST_FAILED",r.ERR_INVALID_KEY="ERR_INVALID_KEY",r.ERR_INVALID_MESSAGE="ERR_INVALID_MESSAGE",r.ERR_INVALID_PARAMETERS="ERR_INVALID_PARAMETERS",r.ERR_INVALID_PEER="ERR_INVALID_PEER",r.ERR_MUXER_UNAVAILABLE="ERR_MUXER_UNAVAILABLE",r.ERR_NOT_FOUND="ERR_NOT_FOUND",r.ERR_TIMEOUT="ERR_TIMEOUT",r.ERR_TRANSPORT_UNAVAILABLE="ERR_TRANSPORT_UNAVAILABLE",r.ERR_TRANSPORT_DIAL_FAILED="ERR_TRANSPORT_DIAL_FAILED",r.ERR_UNSUPPORTED_PROTOCOL="ERR_UNSUPPORTED_PROTOCOL",r.ERR_PROTOCOL_HANDLER_ALREADY_REGISTERED="ERR_PROTOCOL_HANDLER_ALREADY_REGISTERED",r.ERR_INVALID_MULTIADDR="ERR_INVALID_MULTIADDR",r.ERR_SIGNATURE_NOT_VALID="ERR_SIGNATURE_NOT_VALID",r.ERR_FIND_SELF="ERR_FIND_SELF",r.ERR_NO_ROUTERS_AVAILABLE="ERR_NO_ROUTERS_AVAILABLE",r.ERR_CONNECTION_NOT_MULTIPLEXED="ERR_CONNECTION_NOT_MULTIPLEXED",r.ERR_NO_DIAL_TOKENS="ERR_NO_DIAL_TOKENS",r.ERR_KEYCHAIN_REQUIRED="ERR_KEYCHAIN_REQUIRED",r.ERR_INVALID_CMS="ERR_INVALID_CMS",r.ERR_MISSING_KEYS="ERR_MISSING_KEYS",r.ERR_NO_KEY="ERR_NO_KEY",r.ERR_INVALID_KEY_NAME="ERR_INVALID_KEY_NAME",r.ERR_INVALID_KEY_TYPE="ERR_INVALID_KEY_TYPE",r.ERR_KEY_ALREADY_EXISTS="ERR_KEY_ALREADY_EXISTS",r.ERR_INVALID_KEY_SIZE="ERR_INVALID_KEY_SIZE",r.ERR_KEY_NOT_FOUND="ERR_KEY_NOT_FOUND",r.ERR_OLD_KEY_NAME_INVALID="ERR_OLD_KEY_NAME_INVALID",r.ERR_NEW_KEY_NAME_INVALID="ERR_NEW_KEY_NAME_INVALID",r.ERR_PASSWORD_REQUIRED="ERR_PASSWORD_REQUIRED",r.ERR_PEM_REQUIRED="ERR_PEM_REQUIRED",r.ERR_CANNOT_READ_KEY="ERR_CANNOT_READ_KEY",r.ERR_MISSING_PRIVATE_KEY="ERR_MISSING_PRIVATE_KEY",r.ERR_MISSING_PUBLIC_KEY="ERR_MISSING_PUBLIC_KEY",r.ERR_INVALID_OLD_PASS_TYPE="ERR_INVALID_OLD_PASS_TYPE",r.ERR_INVALID_NEW_PASS_TYPE="ERR_INVALID_NEW_PASS_TYPE",r.ERR_INVALID_PASS_LENGTH="ERR_INVALID_PASS_LENGTH",r.ERR_NOT_IMPLEMENTED="ERR_NOT_IMPLEMENTED",r.ERR_WRONG_PING_ACK="ERR_WRONG_PING_ACK",r.ERR_INVALID_RECORD="ERR_INVALID_RECORD",r.ERR_ALREADY_SUCCEEDED="ERR_ALREADY_SUCCEEDED",r.ERR_NO_HANDLER_FOR_PROTOCOL="ERR_NO_HANDLER_FOR_PROTOCOL",r.ERR_TOO_MANY_OUTBOUND_PROTOCOL_STREAMS="ERR_TOO_MANY_OUTBOUND_PROTOCOL_STREAMS",r.ERR_TOO_MANY_INBOUND_PROTOCOL_STREAMS="ERR_TOO_MANY_INBOUND_PROTOCOL_STREAMS",r.ERR_CONNECTION_DENIED="ERR_CONNECTION_DENIED",r.ERR_TRANSFER_LIMIT_EXCEEDED="ERR_TRANSFER_LIMIT_EXCEEDED"})(z||(z={}));var SW={addresses:{listen:[],announce:[],noAnnounce:[],announceFilter:r=>r},connectionManager:{resolvers:{dnsaddr:ol},addressSorter:il},transportManager:{faultTolerance:lo.FATAL_ALL}};function yR(r){let e=oo(SW,r);if(e.transports==null||e.transports.length<1)throw new E(Ks.ERR_TRANSPORTS_REQUIRED,z.ERR_TRANSPORTS_REQUIRED);if(e.connectionProtector===null&&globalThis.process?.env?.LIBP2P_FORCE_PNET!=null)throw new E(Ks.ERR_PROTECTOR_REQUIRED,z.ERR_PROTECTOR_REQUIRED);return e}var bR="keep-alive";var gI=W(Yg(),1);var oY=C("libp2p:get-peer");function ap(r){if(zd(r))return{peerId:r,multiaddrs:[]};Array.isArray(r)||(r=[r]);let e;if(r.length>0){let t=r[0].getPeerId();e=t==null?void 0:he(t),r.forEach(n=>{if(!Ea(n))throw oY.error("multiaddr %s was invalid",n),new E("Invalid Multiaddr",z.ERR_INVALID_MULTIADDR);let s=n.getPeerId();if(s==null){if(e!=null)throw new E("Multiaddrs must all have the same peer id or have no peer id",z.ERR_INVALID_PARAMETERS)}else{let i=he(s);if(e==null||!e.equals(i))throw new E("Multiaddrs must all have the same peer id or have no peer id",z.ERR_INVALID_PARAMETERS)}})}return{peerId:e,multiaddrs:r}}function aY(r,e,t){let n=0,s=r.length;for(;s>0;){let i=Math.trunc(s/2),o=n+i;t(r[o],e)<=0?(n=++o,s-=i+1):s=i}return n}var Qg=class{#e=[];enqueue(e,t){let n=t?.peerId,s=t?.priority??0;if(n==null)throw new E("missing peer id",z.ERR_INVALID_PARAMETERS);let i={priority:s,peerId:n,run:e};if(this.size>0&&this.#e[this.size-1].priority>=s){this.#e.push(i);return}let o=aY(this.#e,i,(a,c)=>c.priority-a.priority);this.#e.splice(o,0,i)}dequeue(){return this.#e.shift()?.run}filter(e){if(e.peerId!=null){let t=e.peerId;return this.#e.filter(n=>t.equals(n.peerId)).map(n=>n.run)}return this.#e.filter(t=>t.priority===e.priority).map(t=>t.run)}get size(){return this.#e.length}},fl=class extends Nt{constructor(e={}){super({...e,queueClass:Qg})}hasJob(e){return this.sizeBy({peerId:e})>0}};var br=C("libp2p:connection-manager:auto-dial"),Hf={minConnections:50,maxQueueLength:100,autoDialConcurrency:25,autoDialPriority:0,autoDialInterval:5e3},cp=class{connectionManager;peerStore;queue;minConnections;autoDialPriority;autoDialIntervalMs;autoDialMaxQueueLength;autoDialInterval;started;running;constructor(e,t){this.connectionManager=e.connectionManager,this.peerStore=e.peerStore,this.minConnections=t.minConnections??Hf.minConnections,this.autoDialPriority=t.autoDialPriority??Hf.autoDialPriority,this.autoDialIntervalMs=t.autoDialInterval??Hf.autoDialInterval,this.autoDialMaxQueueLength=t.maxQueueLength??Hf.maxQueueLength,this.started=!1,this.running=!1,this.queue=new fl({concurrency:t.autoDialConcurrency??Hf.autoDialConcurrency}),this.queue.addListener("error",n=>{br.error("error during auto-dial",n)}),e.events.addEventListener("connection:close",()=>{this.autoDial().catch(n=>{br.error(n)})})}isStarted(){return this.started}start(){this.autoDialInterval=setTimeout(()=>{this.autoDial().catch(e=>{br.error("error while autodialing",e)})},this.autoDialIntervalMs),this.started=!0}afterStart(){this.autoDial().catch(e=>{br.error("error while autodialing",e)})}stop(){this.queue.clear(),clearTimeout(this.autoDialInterval),this.started=!1,this.running=!1}async autoDial(){if(!this.started)return;let e=this.connectionManager.getConnectionsMap(),t=e.size;if(t>=this.minConnections){br.trace("have enough connections %d/%d",t,this.minConnections);return}if(this.queue.size>this.autoDialMaxQueueLength){br("not enough connections %d/%d but auto dial queue is full",t,this.minConnections);return}if(this.running){br("not enough connections %d/%d - but skipping autodial as it is already running",t,this.minConnections);return}this.running=!0,br("not enough connections %d/%d - will dial peers to increase the number of connections",t,this.minConnections);let n=new Ar(this.connectionManager.getDialQueue().map(c=>c.peerId).filter(Boolean)),s=await this.peerStore.all({filters:[c=>c.addresses.length===0?(br.trace("not autodialing %p because they have no addresses"),!1):e.has(c.id)?(br.trace("not autodialing %p because they are already connected"),!1):n.has(c.id)?(br.trace("not autodialing %p because they are already being dialed"),!1):this.queue.hasJob(c.id)?(br.trace("not autodialing %p because they are already being autodialed"),!1):!0]}),i=s.sort(()=>Math.random()>.5?1:-1),o=new Sr;for(let c of i)o.has(c.id)||o.set(c.id,[...c.tags.values()].reduce((l,u)=>l+u.value,0));let a=i.sort((c,l)=>{let u=o.get(c.id)??0,f=o.get(l.id)??0;return u>f?-1:u<f?1:0});br("selected %d/%d peers to dial",a.length,s.length);for(let c of a)this.queue.add(async()=>{let l=this.connectionManager.getConnectionsMap().size;if(l>=this.minConnections){br("got enough connections now %d/%d",l,this.minConnections),this.queue.clear();return}br("connecting to a peerStore stored peer %p",c.id),await this.connectionManager.openConnection(c.id,{priority:this.autoDialPriority})},{peerId:c.id}).catch(l=>{br.error("could not connect to peerStore stored peer",l)});this.running=!1,this.started&&(this.autoDialInterval=setTimeout(()=>{this.autoDial().catch(c=>{br.error("error while autodialing",c)})},this.autoDialIntervalMs))}};var hl=C("libp2p:connection-manager:connection-pruner"),dI={maxConnections:300,allow:[]},lp=class{maxConnections;connectionManager;peerStore;allow;events;constructor(e,t={}){this.maxConnections=t.maxConnections??dI.maxConnections,this.allow=t.allow??dI.allow,this.connectionManager=e.connectionManager,this.peerStore=e.peerStore,this.events=e.events,e.events.addEventListener("connection:open",()=>{this.maybePruneConnections().catch(n=>{hl.error(n)})})}async maybePruneConnections(){let e=this.connectionManager.getConnections(),t=e.length,n=Math.max(t-this.maxConnections,0);if(hl("checking max connections limit %d/%d",t,this.maxConnections),t<=this.maxConnections)return;hl("max connections limit exceeded %d/%d, pruning %d connection(s)",t,this.maxConnections,n);let s=new Sr;for(let a of e){let c=a.remotePeer;if(!s.has(c)){s.set(c,0);try{let l=await this.peerStore.get(c);s.set(c,[...l.tags.values()].reduce((u,f)=>u+f.value,0))}catch(l){l.code!=="ERR_NOT_FOUND"&&hl.error("error loading peer tags",l)}}}let i=e.sort((a,c)=>{let l=s.get(a.remotePeer)??0,u=s.get(c.remotePeer)??0;if(l>u)return 1;if(l<u)return-1;let f=a.stat.timeline.open,h=c.stat.timeline.open;return f<h?1:f>h?-1:0}),o=[];for(let a of i)if(hl("too many connections open - closing a connection to %p",a.remotePeer),this.allow.some(l=>a.remoteAddr.toString().startsWith(l.toString()))||o.push(a),o.length===n)break;await Promise.all(o.map(async a=>{try{await a.close()}catch(c){hl.error(c)}})),this.events.safeDispatchEvent("connection:prune",{detail:o})}};var r8=W(fn(),1);var e8=W(fn(),1);var pI=C("libp2p:connection-manager:utils");async function t8(r,e){if(!r.protoNames().includes("dnsaddr"))return[r];let n=await lY(r,e),o=(await Promise.all(n.map(async a=>t8(a,e)))).flat().reduce((a,c)=>(a.find(l=>l.equals(c))==null&&a.push(c),a),[]);return pI("resolved %s to",r,o.map(a=>a.toString())),o}async function lY(r,e){try{return r=fe(r.toString()),await r.resolve(e)}catch(t){return pI.error(`multiaddr ${r.toString()} could not be resolved`,t),[]}}function mI(...r){let e=[];for(let n of r)if(n!=null){try{(0,e8.setMaxListeners)?.(1/0,n)}catch{}e.push(n)}let t=ot(e);try{(0,e8.setMaxListeners)?.(1/0,t)}catch{}return t}var Ir=C("libp2p:connection-manager:dial-queue"),Gf={addressSorter:il,maxParallelDials:100,maxPeerAddrsToDial:25,maxParallelDialsPerPeer:10,dialTimeout:3e4,resolvers:{dnsaddr:ol}},up=class{pendingDials;queue;peerId;peerStore;connectionGater;transportManager;addressSorter;maxPeerAddrsToDial;maxParallelDialsPerPeer;dialTimeout;inProgressDialCount;pendingDialCount;shutDownController;constructor(e,t={}){this.addressSorter=t.addressSorter??Gf.addressSorter,this.maxPeerAddrsToDial=t.maxPeerAddrsToDial??Gf.maxPeerAddrsToDial,this.maxParallelDialsPerPeer=t.maxParallelDialsPerPeer??Gf.maxParallelDialsPerPeer,this.dialTimeout=t.dialTimeout??Gf.dialTimeout,this.peerId=e.peerId,this.peerStore=e.peerStore,this.connectionGater=e.connectionGater,this.transportManager=e.transportManager,this.shutDownController=new AbortController;try{(0,r8.setMaxListeners)?.(1/0,this.shutDownController.signal)}catch{}this.pendingDialCount=e.metrics?.registerMetric("libp2p_dialler_pending_dials"),this.inProgressDialCount=e.metrics?.registerMetric("libp2p_dialler_in_progress_dials"),this.pendingDials=[];for(let[n,s]of Object.entries(t.resolvers??{}))Eg.set(n,s);this.queue=new Nt({concurrency:t.maxParallelDials??Gf.maxParallelDials}),this.queue.on("add",()=>{this.pendingDialCount?.update(this.queue.size),this.inProgressDialCount?.update(this.queue.pending)}),this.queue.on("active",()=>{this.pendingDialCount?.update(this.queue.size),this.inProgressDialCount?.update(this.queue.pending)}),this.queue.on("completed",()=>{this.pendingDialCount?.update(this.queue.size),this.inProgressDialCount?.update(this.queue.pending)}),this.queue.on("error",n=>{Ir.error("error in dial queue",n),this.pendingDialCount?.update(this.queue.size),this.inProgressDialCount?.update(this.queue.pending)}),this.queue.on("empty",()=>{this.pendingDialCount?.update(this.queue.size),this.inProgressDialCount?.update(this.queue.pending)}),this.queue.on("idle",()=>{this.pendingDialCount?.update(this.queue.size),this.inProgressDialCount?.update(this.queue.pending)})}stop(){this.shutDownController.abort()}async dial(e,t={}){let{peerId:n,multiaddrs:s}=ap(e),i=s.map(u=>({multiaddr:u,isCertified:!1})),o=this.createDialAbortControllers(t.signal),a;try{a=await this.calculateMultiaddrs(n,i,{...t,signal:o})}catch(u){throw o.clear(),u}let c=this.pendingDials.find(u=>!!(u.peerId!=null&&n!=null&&u.peerId.equals(n)||a.map(({multiaddr:f})=>f.toString()).join()===u.multiaddrs.map(f=>f.toString()).join()));if(c!=null)return Ir("joining existing dial target for %p",n),o.clear(),c.promise;Ir("creating dial target for",a.map(({multiaddr:u})=>u.toString()));let l={id:fY(),status:"queued",peerId:n,multiaddrs:a.map(({multiaddr:u})=>u)};return l.promise=this.performDial(l,{...t,signal:o}).finally(()=>{this.pendingDials=this.pendingDials.filter(u=>u.id!==l.id),o.clear()}).catch(u=>{throw Ir.error("dial failed to %s",l.multiaddrs.map(f=>f.toString()).join(", "),u),o.aborted?new E(u.message,z.ERR_TIMEOUT):u}),this.pendingDials.push(l),l.promise}createDialAbortControllers(e){let t=ot([AbortSignal.timeout(this.dialTimeout),this.shutDownController.signal,e]);try{(0,r8.setMaxListeners)?.(1/0,t)}catch{}return t}async calculateMultiaddrs(e,t=[],n={}){if(e!=null){if(this.peerId.equals(e))throw new E("Tried to dial self",z.ERR_DIALED_SELF);if(await this.connectionGater.denyDialPeer?.(e)===!0)throw new E("The dial request is blocked by gater.allowDialPeer",z.ERR_PEER_DIAL_INTERCEPTED);if(t.length===0){Ir("loading multiaddrs for %p",e);try{let u=await this.peerStore.get(e);t.push(...u.addresses),Ir("loaded multiaddrs for %p",e,t.map(({multiaddr:f})=>f.toString()))}catch(u){if(u.code!==z.ERR_NOT_FOUND)throw u}}}let s=(await Promise.all(t.map(async u=>{let f=await t8(u.multiaddr,n);return f.length===1&&f[0].equals(u.multiaddr)?u:f.map(h=>({multiaddr:h,isCertified:!1}))}))).flat(),i=s.filter(u=>!!this.transportManager.transportForMultiaddr(u.multiaddr)),o=new Map;for(let u of i){let f=u.multiaddr.toString(),h=o.get(f);if(h!=null){h.isCertified=h.isCertified||u.isCertified||!1;continue}o.set(f,u)}let a=[...o.values()];if((a.length===0||a.length>this.maxPeerAddrsToDial)&&(Ir("addresses for %p before filtering",e??"unknown peer",s.map(({multiaddr:u})=>u.toString())),Ir("addresses for %p after filtering",e??"unknown peer",a.map(({multiaddr:u})=>u.toString()))),a.length===0)throw new E("The dial request has no valid addresses",z.ERR_NO_VALID_ADDRESSES);if(a.length>this.maxPeerAddrsToDial)throw new E("dial with more addresses than allowed",z.ERR_TOO_MANY_ADDRESSES);if(e!=null){let u=`/p2p/${e.toString()}`;a=a.map(f=>{let h=f.multiaddr.getPeerId();return f.multiaddr.protos().pop()?.path===!0?f:h!==e.toString()?{multiaddr:f.multiaddr.encapsulate(u),isCertified:f.isCertified}:f})}let c=[];for(let u of a)this.connectionGater.denyDialMultiaddr!=null&&await this.connectionGater.denyDialMultiaddr(u.multiaddr)||c.push(u);let l=c.sort(this.addressSorter);if(l.length===0)throw new E("The connection gater denied all addresses in the dial request",z.ERR_NO_VALID_ADDRESSES);return l}async performDial(e,t={}){let n=e.multiaddrs.map(()=>new AbortController);try{let s=new Nt({concurrency:this.maxParallelDialsPerPeer});s.on("error",o=>{Ir.error("error dialling",o)});let i=await Promise.any(e.multiaddrs.map(async(o,a)=>{let c=n[a];if(c==null)throw new E("dialAction did not come with an AbortController",z.ERR_INVALID_PARAMETERS);let l=mI(c.signal,t.signal);l.addEventListener("abort",()=>{Ir("dial to %s aborted",o)});let u=De();return await s.add(async()=>{if(l.aborted){Ir("dial to %s was aborted before reaching the head of the peer dial queue",o),u.reject(new cn);return}await this.queue.add(async()=>{try{if(l.aborted){Ir("dial to %s was aborted before reaching the head of the dial queue",o),u.reject(new cn);return}e.status="active";let f=await this.transportManager.dial(o,{...t,signal:l});if(c.signal.aborted){Ir("multiple dials succeeded, closing superfluous connection"),f.close().catch(h=>{Ir.error("error closing superfluous connection",h)}),u.reject(new cn);return}n[a]=void 0,n.forEach(h=>{h!==void 0&&h.abort()}),Ir("dial to %s succeeded",o),u.resolve(f)}catch(f){Ir.error("error during dial of %s",o,f),u.reject(f)}},{...t,signal:l}).catch(f=>{u.reject(f)})},{signal:l}).catch(f=>{u.reject(f)}).finally(()=>{l.clear()}),u.promise}));if(i==null)throw new E("successful dial led to empty object returned from peer dial queue",z.ERR_TRANSPORT_DIAL_FAILED);return e.status="success",i}catch(s){throw e.status="error",e.multiaddrs.length===1&&s.name==="AggregateError"?s.errors[0]:s}}};function fY(){return`${parseInt(String(Math.random()*1e9),10).toString()}${Date.now()}`}var vn=C("libp2p:connection-manager"),pY=50,Sa={minConnections:50,maxConnections:300,inboundConnectionThreshold:5,maxIncomingPendingConnections:10,autoDialConcurrency:25,autoDialPriority:0,autoDialMaxQueueLength:100},fp=class{started;connections;allow;deny;maxIncomingPendingConnections;incomingPendingConnections;maxConnections;dialQueue;autoDial;connectionPruner;inboundConnectionRateLimiter;peerStore;metrics;events;constructor(e,t={}){this.maxConnections=t.maxConnections??Sa.maxConnections;let n=t.minConnections??Sa.minConnections;if(this.maxConnections<n)throw new E("Connection Manager maxConnections must be greater than minConnections",z.ERR_INVALID_PARAMETERS);this.connections=new Sr,this.started=!1,this.peerStore=e.peerStore,this.metrics=e.metrics,this.events=e.events,this.onConnect=this.onConnect.bind(this),this.onDisconnect=this.onDisconnect.bind(this),this.events.addEventListener("connection:open",this.onConnect),this.events.addEventListener("connection:close",this.onDisconnect),this.allow=(t.allow??[]).map(s=>fe(s)),this.deny=(t.deny??[]).map(s=>fe(s)),this.incomingPendingConnections=0,this.maxIncomingPendingConnections=t.maxIncomingPendingConnections??Sa.maxIncomingPendingConnections,this.inboundConnectionRateLimiter=new gI.RateLimiterMemory({points:t.inboundConnectionThreshold??Sa.inboundConnectionThreshold,duration:1}),this.autoDial=new cp({connectionManager:this,peerStore:e.peerStore,events:e.events},{minConnections:n,autoDialConcurrency:t.autoDialConcurrency??Sa.autoDialConcurrency,autoDialPriority:t.autoDialPriority??Sa.autoDialPriority,maxQueueLength:t.autoDialMaxQueueLength??Sa.autoDialMaxQueueLength}),this.connectionPruner=new lp({connectionManager:this,peerStore:e.peerStore,events:e.events},{maxConnections:this.maxConnections,allow:this.allow}),this.dialQueue=new up({peerId:e.peerId,metrics:e.metrics,peerStore:e.peerStore,transportManager:e.transportManager,connectionGater:e.connectionGater},{addressSorter:t.addressSorter??il,maxParallelDials:t.maxParallelDials??100,maxPeerAddrsToDial:t.maxPeerAddrsToDial??25,dialTimeout:t.dialTimeout??3e4,resolvers:t.resolvers??{dnsaddr:ol}})}isStarted(){return this.started}async start(){this.metrics?.registerMetricGroup("libp2p_connection_manager_connections",{calculate:()=>{let e={inbound:0,outbound:0};for(let t of this.connections.values())for(let n of t)n.stat.direction==="inbound"?e.inbound++:e.outbound++;return e}}),this.metrics?.registerMetricGroup("libp2p_protocol_streams_total",{label:"protocol",calculate:()=>{let e={};for(let t of this.connections.values())for(let n of t)for(let s of n.streams){let i=`${s.stat.direction} ${s.stat.protocol??"unnegotiated"}`;e[i]=(e[i]??0)+1}return e}}),this.metrics?.registerMetricGroup("libp2p_connection_manager_protocol_streams_per_connection_90th_percentile",{label:"protocol",calculate:()=>{let e={};for(let n of this.connections.values())for(let s of n){let i={};for(let o of s.streams){let a=`${o.stat.direction} ${o.stat.protocol??"unnegotiated"}`;i[a]=(i[a]??0)+1}for(let[o,a]of Object.entries(i))e[o]=e[o]??[],e[o].push(a)}let t={};for(let[n,s]of Object.entries(e)){s=s.sort((o,a)=>o-a);let i=Math.floor(s.length*.9);t[n]=s[i]}return t}}),this.autoDial.start(),this.started=!0,vn("started")}async afterStart(){Promise.resolve().then(async()=>{let e=await this.peerStore.all({filters:[t=>t.tags.has(bR)]});await Promise.all(e.map(async t=>{await this.openConnection(t.id).catch(n=>{vn.error(n)})}))}).catch(e=>{vn.error(e)}),this.autoDial.afterStart()}async stop(){this.dialQueue.stop(),this.autoDial.stop();let e=[];for(let t of this.connections.values())for(let n of t)e.push((async()=>{try{await n.close()}catch(s){vn.error(s)}})());vn("closing %d connections",e.length),await Promise.all(e),this.connections.clear(),vn("stopped")}onConnect(e){this._onConnect(e).catch(t=>{vn.error(t)})}async _onConnect(e){let{detail:t}=e;if(!this.started){await t.close();return}let n=t.remotePeer,s=this.connections.get(n),i=!1;s!=null?s.push(t):(i=!0,this.connections.set(n,[t])),n.publicKey!=null&&n.type==="RSA"&&await this.peerStore.patch(n,{publicKey:n.publicKey}),i&&this.events.safeDispatchEvent("peer:connect",{detail:t.remotePeer})}onDisconnect(e){let{detail:t}=e;if(!this.started)return;let n=t.remotePeer,s=this.connections.get(n);s!=null&&s.length>1?(s=s.filter(i=>i.id!==t.id),this.connections.set(n,s)):s!=null&&(this.connections.delete(n),this.events.safeDispatchEvent("peer:disconnect",{detail:t.remotePeer}))}getConnections(e){if(e!=null)return this.connections.get(e)??[];let t=[];for(let n of this.connections.values())t=t.concat(n);return t}getConnectionsMap(){return this.connections}async openConnection(e,t={}){if(!this.isStarted())throw new E("Not started",z.ERR_NODE_NOT_STARTED);let{peerId:n}=ap(e);if(n!=null){vn("dial %p",n);let a=this.getConnections(n);if(a.length>0)return vn("had an existing connection to %p",n),a[0]}let s=await this.dialQueue.dial(e,{...t,priority:t.priority??pY}),i=this.connections.get(s.remotePeer);i==null&&(i=[],this.connections.set(s.remotePeer,i));let o=!1;for(let a of i)a.id===s.id&&(o=!0);return o||i.push(s),s}async closeConnections(e){let t=this.connections.get(e)??[];await Promise.all(t.map(async n=>{await n.close()}))}async acceptIncomingConnection(e){if(this.deny.some(s=>e.remoteAddr.toString().startsWith(s.toString())))return vn("connection from %s refused - connection remote address was in deny list",e.remoteAddr),!1;if(this.allow.some(s=>e.remoteAddr.toString().startsWith(s.toString())))return this.incomingPendingConnections++,!0;if(this.incomingPendingConnections===this.maxIncomingPendingConnections)return vn("connection from %s refused - incomingPendingConnections exceeded by peer %s",e.remoteAddr),!1;if(e.remoteAddr.isThinWaistAddress()){let s=e.remoteAddr.nodeAddress().address;try{await this.inboundConnectionRateLimiter.consume(s,1)}catch{return vn("connection from %s refused - inboundConnectionThreshold exceeded by host %s",s,e.remoteAddr),!1}}return this.getConnections().length<this.maxConnections?(this.incomingPendingConnections++,!0):(vn("connection from %s refused - maxConnections exceeded",e.remoteAddr),!1)}afterUpgradeInbound(){this.incomingPendingConnections--}getDialQueue(){return this.dialQueue.pendingDials}};async function*Wf(r,e){yield*Qn(r,async t=>(await e.merge(t.id,{multiaddrs:t.multiaddrs}),t))}function hp(r){let e=new Set;return Cr(r,t=>e.has(t.id.toString())?!1:(e.add(t.id.toString()),!0))}async function*dp(r,e=1){let t=0;for await(let n of r)t++,yield n;if(t<e)throw new E(`more peers required, seen: ${t}  min: ${e}`,"NOT_FOUND")}var pp=class{routers;started;components;constructor(e,t){this.routers=t.routers??[],this.started=!1,this.components=e}isStarted(){return this.started}async start(){this.started=!0}async stop(){this.started=!1}async*findProviders(e,t={}){if(this.routers.length===0)throw new E("No content routers available",z.ERR_NO_ROUTERS_AVAILABLE);yield*Re(nr(...this.routers.map(n=>n.findProviders(e,t))),n=>Wf(n,this.components.peerStore),n=>hp(n),n=>dp(n))}async provide(e,t={}){if(this.routers.length===0)throw new E("No content routers available",z.ERR_NO_ROUTERS_AVAILABLE);await Promise.all(this.routers.map(async n=>{await n.provide(e,t)}))}async put(e,t,n){if(!this.isStarted())throw new E(Ks.NOT_STARTED_YET,z.DHT_NOT_STARTED);await Promise.all(this.routers.map(async s=>{await s.put(e,t,n)}))}async get(e,t){if(!this.isStarted())throw new E(Ks.NOT_STARTED_YET,z.DHT_NOT_STARTED);return Promise.any(this.routers.map(async n=>n.get(e,t)))}};function mY(r){return r[Symbol.asyncIterator]!=null}function gY(r){if(mY(r))return(async()=>{for await(let e of r)return e})();for(let e of r)return e}var fs=gY;var yY=C("libp2p:peer-routing"),mp=class{components;routers;constructor(e,t){this.components=e,this.routers=t.routers??[]}async findPeer(e,t){if(this.routers.length===0)throw new E("No peer routers available",z.ERR_NO_ROUTERS_AVAILABLE);if(e.toString()===this.components.peerId.toString())throw new E("Should not try to find self",z.ERR_FIND_SELF);let n=await Re(nr(...this.routers.map(s=>async function*(){try{yield await s.findPeer(e,t)}catch(i){yY.error(i)}}())),s=>Cr(s,Boolean),s=>Wf(s,this.components.peerStore),async s=>fs(s));if(n!=null)return n;throw new E(Ks.NOT_FOUND,z.ERR_NOT_FOUND)}async*getClosestPeers(e,t){if(this.routers.length===0)throw new E("No peer routers available",z.ERR_NO_ROUTERS_AVAILABLE);yield*Re(nr(...this.routers.map(n=>n.getClosestPeers(e,t))),n=>Wf(n,this.components.peerStore),n=>hp(n),n=>dp(n))}};var gp=C("libp2p:registrar"),o8=32,a8=64,yp=class{topologies;handlers;components;constructor(e){this.topologies=new Map,this.handlers=new Map,this.components=e,this._onDisconnect=this._onDisconnect.bind(this),this._onPeerUpdate=this._onPeerUpdate.bind(this),this._onConnect=this._onConnect.bind(this),this.components.events.addEventListener("peer:disconnect",this._onDisconnect),this.components.events.addEventListener("peer:connect",this._onConnect),this.components.events.addEventListener("peer:update",this._onPeerUpdate)}getProtocols(){return Array.from(new Set([...this.handlers.keys()])).sort()}getHandler(e){let t=this.handlers.get(e);if(t==null)throw new E(`No handler registered for protocol ${e}`,z.ERR_NO_HANDLER_FOR_PROTOCOL);return t}getTopologies(e){let t=this.topologies.get(e);return t==null?[]:[...t.values()]}async handle(e,t,n){if(this.handlers.has(e))throw new E(`Handler already registered for protocol ${e}`,z.ERR_PROTOCOL_HANDLER_ALREADY_REGISTERED);let s=oo.bind({ignoreUndefined:!0})({maxInboundStreams:o8,maxOutboundStreams:a8},n);this.handlers.set(e,{handler:t,options:s}),await this.components.peerStore.merge(this.components.peerId,{protocols:[e]})}async unhandle(e){let t=Array.isArray(e)?e:[e];t.forEach(n=>{this.handlers.delete(n)}),await this.components.peerStore.patch(this.components.peerId,{protocols:t})}async register(e,t){if(!fw(t))throw gp.error("topology must be an instance of interfaces/topology"),new E("topology must be an instance of interfaces/topology",z.ERR_INVALID_PARAMETERS);let n=`${(Math.random()*1e9).toString(36)}${Date.now()}`,s=this.topologies.get(e);return s==null&&(s=new Map,this.topologies.set(e,s)),s.set(n,t),await t.setRegistrar(this),n}unregister(e){for(let[t,n]of this.topologies.entries())n.has(e)&&(n.delete(e),n.size===0&&this.topologies.delete(t))}_onDisconnect(e){let t=e.detail;this.components.peerStore.get(t).then(n=>{for(let s of n.protocols){let i=this.topologies.get(s);if(i!=null)for(let o of i.values())o.onDisconnect(t)}}).catch(n=>{n.code!==z.ERR_NOT_FOUND&&gp.error("could not inform topologies of disconnecting peer %p",t,n)})}_onConnect(e){let t=e.detail;this.components.peerStore.get(t).then(n=>{let s=this.components.connectionManager.getConnections(n.id)[0];if(s==null){gp("peer %p connected but the connection manager did not have a connection",n);return}for(let i of n.protocols){let o=this.topologies.get(i);if(o!=null)for(let a of o.values())a.onConnect(t,s)}}).catch(n=>{n.code!==z.ERR_NOT_FOUND&&gp.error("could not inform topologies of connecting peer %p",t,n)})}_onPeerUpdate(e){let{peer:t,previous:n}=e.detail,s=(n?.protocols??[]).filter(o=>!t.protocols.includes(o)),i=t.protocols.filter(o=>!(n?.protocols??[]).includes(o));for(let o of s){let a=this.topologies.get(o);if(a!=null)for(let c of a.values())c.onDisconnect(t.id)}for(let o of i){let a=this.topologies.get(o);if(a!=null)for(let c of a.values()){let l=this.components.connectionManager.getConnections(t.id)[0];l!=null&&c.onConnect(t.id,l)}}}};var Aa=C("libp2p:transports"),bp=class{components;transports;listeners;faultTolerance;started;constructor(e,t={}){this.components=e,this.started=!1,this.transports=new Map,this.listeners=Ss({name:"libp2p_transport_manager_listeners",metrics:this.components.metrics}),this.faultTolerance=t.faultTolerance??lo.FATAL_ALL}add(e){let t=e[Symbol.toStringTag];if(t==null)throw new E("Transport must have a valid tag",z.ERR_INVALID_KEY);if(this.transports.has(t))throw new E(`There is already a transport with the tag ${t}`,z.ERR_DUPLICATE_TRANSPORT);Aa("adding transport %s",t),this.transports.set(t,e),this.listeners.has(t)||this.listeners.set(t,[])}isStarted(){return this.started}start(){this.started=!0}async afterStart(){let e=this.components.addressManager.getListenAddrs();await this.listen(e)}async stop(){let e=[];for(let[t,n]of this.listeners)for(Aa("closing listeners for %s",t);n.length>0;){let s=n.pop();s!=null&&e.push(s.close())}await Promise.all(e),Aa("all listeners closed");for(let t of this.listeners.keys())this.listeners.set(t,[]);this.started=!1}async dial(e,t){let n=this.transportForMultiaddr(e);if(n==null)throw new E(`No transport available for address ${String(e)}`,z.ERR_TRANSPORT_UNAVAILABLE);try{return await n.dial(e,{...t,upgrader:this.components.upgrader})}catch(s){throw s.code==null&&(s.code=z.ERR_TRANSPORT_DIAL_FAILED),s}}getAddrs(){let e=[];for(let t of this.listeners.values())for(let n of t)e=[...e,...n.getAddrs()];return e}getTransports(){return Array.of(...this.transports.values())}getListeners(){return Array.of(...this.listeners.values()).flat()}transportForMultiaddr(e){for(let t of this.transports.values())if(t.filter([e]).length>0)return t}async listen(e){if(e==null||e.length===0){Aa("no addresses were provided for listening, this node is dial only");return}let t=[];for(let[n,s]of this.transports.entries()){let i=s.filter(e),o=[];for(let l of i){Aa("creating listener for %s on %s",n,l);let u=s.createListener({upgrader:this.components.upgrader}),f=this.listeners.get(n)??[];f==null&&(f=[],this.listeners.set(n,f)),f.push(u),u.addEventListener("listening",()=>{this.components.events.safeDispatchEvent("transport:listening",{detail:u})}),u.addEventListener("close",()=>{let h=f.findIndex(p=>p===u);f.splice(h,1),this.components.events.safeDispatchEvent("transport:close",{detail:u})}),o.push(u.listen(l))}if(o.length===0){t.push(n);continue}if((await Promise.allSettled(o)).find(l=>l.status==="fulfilled")==null&&this.faultTolerance!==lo.NO_FATAL)throw new E(`Transport (${n}) could not listen on any available address`,z.ERR_NO_VALID_ADDRESSES)}if(t.length===this.transports.size){let n=`no valid addresses were provided for transports [${t.join(", ")}]`;if(this.faultTolerance===lo.FATAL_ALL)throw new E(n,z.ERR_NO_VALID_ADDRESSES);Aa(`libp2p in dial mode only: ${n}`)}}async remove(e){Aa("removing %s",e);for(let t of this.listeners.get(e)??[])await t.close();this.transports.delete(e),this.listeners.delete(e)}async removeAll(){let e=[];for(let t of this.transports.keys())e.push(this.remove(t));await Promise.all(e)}};var f8=W(fn(),1);var xi="/multistream/1.0.0";function c8(r){let e=async function*(){let t=yield,n=new ye;for await(let s of r){if(t==null){n.append(s),t=yield n,n=new ye;continue}for(n.append(s);n.length>=t;){let i=n.sublist(0,t);if(n.consume(t),t=yield i,t==null){n.length>0&&(t=yield n,n=new ye);break}}}if(t!=null)throw Object.assign(new Error(`stream ended before ${t} bytes became available`),{code:"ERR_UNDER_READ",buffer:n})}();return e.next(),e}function wp(r){let e=yt(),t=c8(r.source),n=De(),s,i=r.sink(async function*(){yield*e,yield*await n.promise}());return i.catch(a=>{s=a}),{reader:t,writer:e,stream:{sink:async a=>{if(s!=null){await Promise.reject(s);return}n.resolve(a),await i},source:t},rest:()=>e.end(),write:e.push,read:async()=>{let a=await t.next();if(a.value!=null)return a.value}}}var wY=C("libp2p:mss"),yI=$(`
`);function Yf(r){let e=new ye(r,yI);return wt.single(e)}function Ra(r,e,t={}){let n=Yf(e);t.writeBytes===!0?r.push(n.subarray()):r.push(n)}function bI(r,e,t={}){let n=new ye;for(let s of e)n.append(Yf(s));t.writeBytes===!0?r.push(n.subarray()):r.push(n)}async function xY(r,e){let t=1,n={[Symbol.asyncIterator]:()=>n,next:async()=>r.next(t)},s=n;e?.signal!=null&&(s=bt(n,e.signal));let i=a=>{t=a},o=await Re(s,a=>kt(a,{onLength:i,maxDataLength:1024}),async a=>fs(a));if(o==null||o.length===0)throw new E("no buffer returned","ERR_INVALID_MULTISTREAM_SELECT_MESSAGE");if(o.get(o.byteLength-1)!==yI[0])throw wY.error("Invalid mss message - missing newline - %s",o.subarray()),new E("missing newline","ERR_INVALID_MULTISTREAM_SELECT_MESSAGE");return o.sublist(0,-1)}async function dl(r,e){let t=await xY(r,e);return M(t.subarray())}var Qf=C("libp2p:mss:select");async function Xf(r,e,t={}){e=Array.isArray(e)?[...e]:[e];let{reader:n,writer:s,rest:i,stream:o}=wp(r),a=e.shift();if(a==null)throw new Error("At least one protocol must be specified");Qf.trace('select: write ["%s", "%s"]',xi,a);let c=$(xi),l=$(a);bI(s,[c,l],t);let u=await dl(n,t);if(Qf.trace('select: read "%s"',u),u===xi&&(u=await dl(n,t),Qf.trace('select: read "%s"',u)),u===a)return i(),{stream:o,protocol:a};for(let f of e){Qf.trace('select: write "%s"',f),Ra(s,$(f),t);let h=await dl(n,t);if(Qf.trace('select: read "%s" for "%s"',h,f),h===f)return i(),{stream:o,protocol:f}}throw i(),new E("protocol selection failed","ERR_UNSUPPORTED_PROTOCOL")}var jf=C("libp2p:mss:handle");async function Zf(r,e,t){e=Array.isArray(e)?e:[e];let{writer:n,reader:s,rest:i,stream:o}=wp(r);for(;;){let a=await dl(s,t);if(jf.trace('read "%s"',a),a===xi){jf.trace('respond with "%s" for "%s"',xi,a),Ra(n,$(xi),t);continue}if(e.includes(a))return Ra(n,$(a),t),jf.trace('respond with "%s" for "%s"',a,a),i(),{stream:o,protocol:a};if(a==="ls"){Ra(n,new ye(...e.map(c=>Yf($(c)))),t),jf.trace('respond with "%s" for %s',e,a);continue}Ra(n,$("na"),t),jf('respond with "na" for "%s"',a)}}var xI=Symbol.for("@libp2p/connection");var EI="OPEN",l8="CLOSING",xp="CLOSED";var vY=C("libp2p:connection"),u8=class{id;remoteAddr;remotePeer;stat;tags;_newStream;_close;_getStreams;_closing;constructor(e){let{remoteAddr:t,remotePeer:n,newStream:s,close:i,getStreams:o,stat:a}=e;this.id=`${parseInt(String(Math.random()*1e9)).toString(36)}${Date.now()}`,this.remoteAddr=t,this.remotePeer=n,this.stat={...a,status:EI},this._newStream=s,this._close=i,this._getStreams=o,this.tags=[],this._closing=!1}[Symbol.toStringTag]="Connection";[xI]=!0;get streams(){return this._getStreams()}async newStream(e,t){if(this.stat.status===l8)throw new E("the connection is being closed","ERR_CONNECTION_BEING_CLOSED");if(this.stat.status===xp)throw new E("the connection is closed","ERR_CONNECTION_CLOSED");Array.isArray(e)||(e=[e]);let n=await this._newStream(e,t);return n.stat.direction="outbound",n}addStream(e){e.stat.direction="inbound"}removeStream(e){}async close(){if(!(this.stat.status===xp||this._closing)){this.stat.status=l8;try{this.streams.forEach(e=>{e.close()})}catch(e){vY.error(e)}this._closing=!0,await this._close(),this._closing=!1,this.stat.timeline.close=Date.now(),this.stat.status=xp}}};function vI(r){return new u8(r)}var St=C("libp2p:upgrader");function SY(r,e){try{let{options:t}=e.getHandler(r);return t.maxInboundStreams}catch(t){if(t.code!==z.ERR_NO_HANDLER_FOR_PROTOCOL)throw t}return o8}function AY(r,e,t={}){try{let{options:n}=e.getHandler(r);if(n.maxOutboundStreams!=null)return n.maxOutboundStreams}catch(n){if(n.code!==z.ERR_NO_HANDLER_FOR_PROTOCOL)throw n}return t.maxOutboundStreams??a8}function _I(r,e,t){let n=0;return t.streams.forEach(s=>{s.stat.direction===e&&s.stat.protocol===r&&n++}),n}var Ep=class{components;connectionEncryption;muxers;inboundUpgradeTimeout;events;constructor(e,t){this.components=e,this.connectionEncryption=new Map,t.connectionEncryption.forEach(n=>{this.connectionEncryption.set(n.protocol,n)}),this.muxers=new Map,t.muxers.forEach(n=>{this.muxers.set(n.protocol,n)}),this.inboundUpgradeTimeout=t.inboundUpgradeTimeout??3e4,this.events=e.events}async shouldBlockConnection(e,t,n){let s=this.components.connectionGater[n];if(s!==void 0&&await s(e,t))throw new E(`The multiaddr connection is blocked by gater.${n}`,z.ERR_CONNECTION_INTERCEPTED)}async upgradeInbound(e,t){if(!await this.components.connectionManager.acceptIncomingConnection(e))throw new E("connection denied",z.ERR_CONNECTION_DENIED);let s,i,o,a,c,l=ot([AbortSignal.timeout(this.inboundUpgradeTimeout)]);try{(0,f8.setMaxListeners)?.(1/0,l)}catch{}try{let u=Er(e,l);if(e.source=u.source,e.sink=u.sink,await this.components.connectionGater.denyInboundConnection?.(e)===!0)throw new E("The multiaddr connection is blocked by gater.acceptConnection",z.ERR_CONNECTION_INTERCEPTED);this.components.metrics?.trackMultiaddrConnection(e),St("starting the inbound connection upgrade");let f=e;if(t?.skipProtection!==!0){let h=this.components.connectionProtector;h!=null&&(St("protecting the inbound connection"),f=await h.protect(e))}try{if(s=f,t?.skipEncryption!==!0){({conn:s,remotePeer:i,protocol:c}=await this._encryptInbound(f));let h={...f,...s};await this.shouldBlockConnection(i,h,"denyInboundEncryptedConnection")}else{let h=e.remoteAddr.getPeerId();if(h==null)throw new E("inbound connection that skipped encryption must have a peer id",z.ERR_INVALID_MULTIADDR);let p=he(h);c="native",i=p}if(o=s,t?.muxerFactory!=null)a=t.muxerFactory;else if(this.muxers.size>0){let h=await this._multiplexInbound({...f,...s},this.muxers);a=h.muxerFactory,o=h.stream}}catch(h){throw St.error("Failed to upgrade inbound connection",h),h}return await this.shouldBlockConnection(i,e,"denyInboundUpgradedConnection"),St("Successfully upgraded inbound connection"),this._createConnection({cryptoProtocol:c,direction:"inbound",maConn:e,upgradedConn:o,muxerFactory:a,remotePeer:i})}finally{this.components.connectionManager.afterUpgradeInbound(),l.clear()}}async upgradeOutbound(e,t){let n=e.remoteAddr.getPeerId(),s;n!=null&&(s=he(n),await this.shouldBlockConnection(s,e,"denyOutboundConnection"));let i,o,a,c,l;this.components.metrics?.trackMultiaddrConnection(e),St("Starting the outbound connection upgrade");let u=e;if(t?.skipProtection!==!0){let f=this.components.connectionProtector;f!=null&&(u=await f.protect(e))}try{if(i=u,t?.skipEncryption!==!0){({conn:i,remotePeer:o,protocol:c}=await this._encryptOutbound(u,s));let f={...u,...i};await this.shouldBlockConnection(o,f,"denyOutboundEncryptedConnection")}else{if(s==null)throw new E("Encryption was skipped but no peer id was passed",z.ERR_INVALID_PEER);c="native",o=s}if(a=i,t?.muxerFactory!=null)l=t.muxerFactory;else if(this.muxers.size>0){let f=await this._multiplexOutbound({...u,...i},this.muxers);l=f.muxerFactory,a=f.stream}}catch(f){throw St.error("Failed to upgrade outbound connection",f),await e.close(f),f}return await this.shouldBlockConnection(o,e,"denyOutboundUpgradedConnection"),St("Successfully upgraded outbound connection"),this._createConnection({cryptoProtocol:c,direction:"outbound",maConn:e,upgradedConn:a,muxerFactory:l,remotePeer:o})}_createConnection(e){let{cryptoProtocol:t,direction:n,maConn:s,upgradedConn:i,remotePeer:o,muxerFactory:a}=e,c,l,u;a!=null&&(c=a.createStreamMuxer({direction:n,onIncomingStream:p=>{u!=null&&Promise.resolve().then(async()=>{let d=this.components.registrar.getProtocols(),{stream:m,protocol:g}=await Zf(p,d);if(St("%s: incoming stream opened on %s",n,g),u==null)return;let y=SY(g,this.components.registrar);if(_I(g,"inbound",u)===y){let w=new E(`Too many inbound protocol streams for protocol "${g}" - limit ${y}`,z.ERR_TOO_MANY_INBOUND_PROTOCOL_STREAMS);throw p.abort(w),w}p.source=m.source,p.sink=m.sink,p.stat.protocol=g,await this.components.peerStore.merge(o,{protocols:[g]}),u.addStream(p),this.components.metrics?.trackProtocolStream(p,u),this._onStream({connection:u,stream:p,protocol:g})}).catch(d=>{St.error(d),p.stat.timeline.close==null&&p.close()})},onStreamEnd:p=>{u?.removeStream(p.id)}}),l=async(p,d={})=>{if(c==null)throw new E("Stream is not multiplexed",z.ERR_MUXER_UNAVAILABLE);St("%s: starting new stream on %s",n,p);let m=await c.newStream();try{if(d.signal==null){St("No abort signal was passed while trying to negotiate protocols %s falling back to default timeout",p),d.signal=AbortSignal.timeout(3e4);try{(0,f8.setMaxListeners)?.(1/0,d.signal)}catch{}}let{stream:g,protocol:y}=await Xf(m,p,d),b=AY(y,this.components.registrar,d);if(_I(y,"outbound",u)>=b){let v=new E(`Too many outbound protocol streams for protocol "${y}" - limit ${b}`,z.ERR_TOO_MANY_OUTBOUND_PROTOCOL_STREAMS);throw m.abort(v),v}return await this.components.peerStore.merge(o,{protocols:[y]}),m.source=g.source,m.sink=g.sink,m.stat.protocol=y,this.components.metrics?.trackProtocolStream(m,u),m}catch(g){throw St.error("could not create new stream",g),m.stat.timeline.close==null&&m.close(),g.code!=null?g:new E(String(g),z.ERR_UNSUPPORTED_PROTOCOL)}},Promise.all([c.sink(i.source),i.sink(c.source)]).catch(p=>{St.error(p)}));let f=s.timeline;s.timeline=new Proxy(f,{set:(...p)=>(u!=null&&p[1]==="close"&&p[2]!=null&&f.close==null&&(async()=>{try{u.stat.status==="OPEN"&&await u.close()}catch(d){St.error(d)}finally{this.events.safeDispatchEvent("connection:close",{detail:u})}})().catch(d=>{St.error(d)}),Reflect.set(...p))}),s.timeline.upgraded=Date.now();let h=()=>{throw new E("connection is not multiplexed",z.ERR_CONNECTION_NOT_MULTIPLEXED)};return u=vI({remoteAddr:s.remoteAddr,remotePeer:o,stat:{status:"OPEN",direction:n,timeline:s.timeline,multiplexer:c?.protocol,encryption:t},newStream:l??h,getStreams:()=>c!=null?c.streams:h(),close:async()=>{await s.close(),c?.close()}}),this.events.safeDispatchEvent("connection:open",{detail:u}),u}_onStream(e){let{connection:t,stream:n,protocol:s}=e,{handler:i}=this.components.registrar.getHandler(s);i({connection:t,stream:n})}async _encryptInbound(e){let t=Array.from(this.connectionEncryption.keys());St("handling inbound crypto protocol selection",t);try{let{stream:n,protocol:s}=await Zf(e,t,{writeBytes:!0}),i=this.connectionEncryption.get(s);if(i==null)throw new Error(`no crypto module found for ${s}`);return St("encrypting inbound connection..."),{...await i.secureInbound(this.components.peerId,n),protocol:s}}catch(n){throw new E(String(n),z.ERR_ENCRYPTION_FAILED)}}async _encryptOutbound(e,t){let n=Array.from(this.connectionEncryption.keys());St("selecting outbound crypto protocol",n);try{let{stream:s,protocol:i}=await Xf(e,n,{writeBytes:!0}),o=this.connectionEncryption.get(i);if(o==null)throw new Error(`no crypto module found for ${i}`);return St("encrypting outbound connection to %p",t),{...await o.secureOutbound(this.components.peerId,s,t),protocol:i}}catch(s){throw new E(String(s),z.ERR_ENCRYPTION_FAILED)}}async _multiplexOutbound(e,t){let n=Array.from(t.keys());St("outbound selecting muxer %s",n);try{let{stream:s,protocol:i}=await Xf(e,n,{writeBytes:!0});St("%s selected as muxer protocol",i);let o=t.get(i);return{stream:s,muxerFactory:o}}catch(s){throw St.error("error multiplexing outbound stream",s),new E(String(s),z.ERR_MUXER_UNAVAILABLE)}}async _multiplexInbound(e,t){let n=Array.from(t.keys());St("inbound handling muxers %s",n);try{let{stream:s,protocol:i}=await Zf(e,n,{writeBytes:!0}),o=t.get(i);return{stream:s,muxerFactory:o}}catch(s){throw St.error("error multiplexing inbound stream",s),new E(String(s),z.ERR_MUXER_UNAVAILABLE)}}};var Qr=C("libp2p"),h8=class extends $e{peerId;peerStore;contentRouting;peerRouting;keychain;metrics;services;components;#e;constructor(e){super();let t=new $e,n=t.dispatchEvent.bind(t);t.dispatchEvent=c=>{let l=n(c),u=this.dispatchEvent(new tt(c.type,{detail:c.detail}));return l||u};try{(0,SI.setMaxListeners)?.(1/0,t)}catch{}this.#e=!1,this.peerId=e.peerId,this.services={};let s=this.components=ZA({peerId:e.peerId,events:t,datastore:e.datastore??new Wo,connectionGater:cR(e.connectionGater)});this.peerStore=this.configureComponent("peerStore",new tp(s,{addressFilter:this.components.connectionGater.filterMultiaddrForPeer,...e.peerStore})),e.metrics!=null&&(this.metrics=this.configureComponent("metrics",e.metrics(this.components))),s.events.addEventListener("peer:update",c=>{c.detail.previous==null&&this.safeDispatchEvent("peer:discovery",{detail:c.detail.peer})}),e.connectionProtector!=null&&this.configureComponent("connectionProtector",e.connectionProtector(s)),this.components.upgrader=new Ep(this.components,{connectionEncryption:(e.connectionEncryption??[]).map((c,l)=>this.configureComponent(`connection-encryption-${l}`,c(this.components))),muxers:(e.streamMuxers??[]).map((c,l)=>this.configureComponent(`stream-muxers-${l}`,c(this.components))),inboundUpgradeTimeout:e.connectionManager.inboundUpgradeTimeout}),this.configureComponent("transportManager",new bp(this.components,e.transportManager)),this.configureComponent("connectionManager",new fp(this.components,e.connectionManager)),this.configureComponent("registrar",new yp(this.components)),this.configureComponent("addressManager",new rp(this.components,e.addresses));let i=xa.generateOptions();this.keychain=this.configureComponent("keyChain",new xa(this.components,{...i,...e.keychain}));let o=(e.peerRouters??[]).map((c,l)=>this.configureComponent(`peer-router-${l}`,c(this.components)));this.peerRouting=this.components.peerRouting=this.configureComponent("peerRouting",new mp(this.components,{routers:o}));let a=(e.contentRouters??[]).map((c,l)=>this.configureComponent(`content-router-${l}`,c(this.components)));if(this.contentRouting=this.components.contentRouting=this.configureComponent("contentRouting",new pp(this.components,{routers:a})),(e.peerDiscovery??[]).forEach((c,l)=>{this.configureComponent(`peer-discovery-${l}`,c(this.components)).addEventListener("peer",f=>{this.#t(f)})}),e.transports.forEach((c,l)=>{this.components.transportManager.add(this.configureComponent(`transport-${l}`,c(this.components)))}),e.services!=null)for(let c of Object.keys(e.services)){let l=e.services[c],u=l(this.components);if(u==null){Qr.error("service factory %s returned null or undefined instance",c);continue}this.services[c]=u,this.configureComponent(c,u),u[Df]!=null&&(Qr("registering service %s for content routing",c),a.push(u[Df])),u[Cf]!=null&&(Qr("registering service %s for peer routing",c),o.push(u[Cf])),u[pa]!=null&&(Qr("registering service %s for peer discovery",c),u[pa].addEventListener("peer",f=>{this.#t(f)}))}}configureComponent(e,t){return t==null&&Qr.error("component %s was null or undefined",e),this.components[e]=t,t}async start(){if(this.#e)return;this.#e=!0,Qr("libp2p is starting"),(await this.keychain.listKeys()).find(t=>t.name==="self")==null&&(Qr("importing self key into keychain"),await this.keychain.importPeer("self",this.components.peerId));try{await this.components.beforeStart?.(),await this.components.start(),await this.components.afterStart?.(),this.safeDispatchEvent("start",{detail:this}),Qr("libp2p has started")}catch(t){throw Qr.error("An error occurred starting libp2p",t),await this.stop(),t}}async stop(){this.#e&&(Qr("libp2p is stopping"),this.#e=!1,await this.components.beforeStop?.(),await this.components.stop(),await this.components.afterStop?.(),this.safeDispatchEvent("stop",{detail:this}),Qr("libp2p has stopped"))}isStarted(){return this.#e}getConnections(e){return this.components.connectionManager.getConnections(e)}getDialQueue(){return this.components.connectionManager.getDialQueue()}getPeers(){let e=new Ar;for(let t of this.components.connectionManager.getConnections())e.add(t.remotePeer);return Array.from(e)}async dial(e,t={}){return this.components.connectionManager.openConnection(e,t)}async dialProtocol(e,t,n={}){if(t==null)throw new E("no protocols were provided to open a stream",z.ERR_INVALID_PROTOCOLS_FOR_STREAM);if(t=Array.isArray(t)?t:[t],t.length===0)throw new E("no protocols were provided to open a stream",z.ERR_INVALID_PROTOCOLS_FOR_STREAM);return(await this.dial(e,n)).newStream(t,n)}getMultiaddrs(){return this.components.addressManager.getAddresses()}getProtocols(){return this.components.registrar.getProtocols()}async hangUp(e){Ea(e)&&(e=he(e.getPeerId()??"")),await this.components.connectionManager.closeConnections(e)}async getPublicKey(e,t={}){if(Qr("getPublicKey %p",e),e.publicKey!=null)return e.publicKey;let n=await this.peerStore.get(e);if(n.id.publicKey!=null)return n.id.publicKey;let s=Ee([$("/pk/"),e.multihash.digest]),i=await this.contentRouting.get(s,t);return Yr(i),await this.peerStore.patch(e,{publicKey:i}),i}async handle(e,t,n){Array.isArray(e)||(e=[e]),await Promise.all(e.map(async s=>{await this.components.registrar.handle(s,t,n)}))}async unhandle(e){Array.isArray(e)||(e=[e]),await Promise.all(e.map(async t=>{await this.components.registrar.unhandle(t)}))}async register(e,t){return this.components.registrar.register(e,t)}unregister(e){this.components.registrar.unregister(e)}#t(e){let{detail:t}=e;if(t.id.toString()===this.peerId.toString()){Qr.error(new Error(z.ERR_DISCOVERED_SELF));return}this.components.peerStore.merge(t.id,{multiaddrs:t.multiaddrs,protocols:t.protocols}).catch(n=>{Qr.error(n)})}};async function AI(r){if(r.peerId==null){let e=r.datastore;if(e!=null)try{let t=new xa({datastore:e},oo(xa.generateOptions(),r.keychain));r.peerId=await t.exportPeerId("self")}catch(t){if(t.code!=="ERR_NOT_FOUND")throw t}}return r.peerId==null&&(r.peerId=await Gd()),new h8(yR(r))}async function RI(r){let e=await AI(r);return r.start!==!1&&await e.start(),e}var vp=class{constructor(e,t,n){this.gossip=e,this.msgs=new Map,this.history=[],this.notValidatedCount=0,this.msgIdToStrFn=n;for(let s=0;s<t;s++)this.history[s]=[]}get size(){return this.msgs.size}put(e,t,n=!1){let{msgIdStr:s}=e;return this.msgs.has(s)?!1:(this.msgs.set(s,{message:t,validated:n,originatingPeers:new Set,iwantCounts:new Map}),this.history[0].push({...e,topic:t.topic}),n||this.notValidatedCount++,!0)}observeDuplicate(e,t){let n=this.msgs.get(e);n&&!n.validated&&n.originatingPeers.add(t)}get(e){return this.msgs.get(this.msgIdToStrFn(e))?.message}getWithIWantCount(e,t){let n=this.msgs.get(e);if(!n)return null;let s=(n.iwantCounts.get(t)??0)+1;return n.iwantCounts.set(t,s),{msg:n.message,count:s}}getGossipIDs(e){let t=new Map;for(let n=0;n<this.gossip;n++)this.history[n].forEach(s=>{let i=this.msgs.get(s.msgIdStr);if(i&&i.validated&&e.has(s.topic)){let o=t.get(s.topic);o||(o=[],t.set(s.topic,o)),o.push(s.msgId)}});return t}validate(e){let t=this.msgs.get(e);if(!t)return null;t.validated||this.notValidatedCount--;let{message:n,originatingPeers:s}=t;return t.validated=!0,t.originatingPeers=new Set,{message:n,originatingPeers:s}}shift(){this.history[this.history.length-1].forEach(t=>{let n=this.msgs.get(t.msgIdStr);n&&(this.msgs.delete(t.msgIdStr),n.validated||this.notValidatedCount--)}),this.history.pop(),this.history.unshift([])}remove(e){let t=this.msgs.get(e);return t?(this.msgs.delete(e),t):null}};var iT=W(sT(),1),{RPC:nh}=iT.default;var R8="/floodsub/1.0.0",I8="/meshsub/1.0.0",T8="/meshsub/1.1.0";var oT="ERR_TOPIC_VALIDATOR_REJECT",aT="ERR_TOPIC_VALIDATOR_IGNORE";function Gs(r){if(r.length<=1)return r;let e=()=>Math.floor(Math.random()*Math.floor(r.length));for(let t=0;t<r.length;t++){let n=e(),s=r[t];r[t]=r[n],r[n]=s}return r}function cT(r){return M(r,"base64")}var Da="StrictSign",pl="StrictNoSign",ds;(function(r){r.Accept="accept",r.Ignore="ignore",r.Reject="reject"})(ds||(ds={}));var lT;(function(r){r.StrictSign="StrictSign",r.StrictNoSign="StrictNoSign"})(lT||(lT={}));var mo;(function(r){r[r.Signing=0]="Signing",r[r.Anonymous=1]="Anonymous"})(mo||(mo={}));var Br;(function(r){r.Error="error",r.Ignore="ignore",r.Reject="reject",r.Blacklisted="blacklisted"})(Br||(Br={}));var Tr;(function(r){r.InvalidSignature="invalid_signature",r.InvalidSeqno="invalid_seqno",r.InvalidPeerId="invalid_peerid",r.SignaturePresent="signature_present",r.SeqnoPresent="seqno_present",r.FromPresent="from_present",r.TransformFailed="transform_failed"})(Tr||(Tr={}));var Kn;(function(r){r.duplicate="duplicate",r.invalid="invalid",r.valid="valid"})(Kn||(Kn={}));function D8(r){switch(r){case ds.Ignore:return Br.Ignore;case ds.Reject:return Br.Reject}}async function C8(r,e){switch(r){case Da:{if(!e)throw Error("Must provide PeerId");if(e.privateKey==null)throw Error("Cannot sign message, no private key present");if(e.publicKey==null)throw Error("Cannot sign message, no public key present");let t=await ls(e.privateKey);return{type:mo.Signing,author:e,key:e.publicKey,privateKey:t}}case pl:return{type:mo.Anonymous};default:throw new Error(`Unknown signature policy "${r}"`)}}var it="ERR_INVALID_PEER_SCORE_PARAMS";var OY={topics:{},topicScoreCap:10,appSpecificScore:()=>0,appSpecificWeight:10,IPColocationFactorWeight:-5,IPColocationFactorThreshold:10,IPColocationFactorWhitelist:new Set,behaviourPenaltyWeight:-10,behaviourPenaltyThreshold:0,behaviourPenaltyDecay:.2,decayInterval:1e3,decayToZero:.1,retainScore:3600*1e3},LY={topicWeight:.5,timeInMeshWeight:1,timeInMeshQuantum:1,timeInMeshCap:3600,firstMessageDeliveriesWeight:1,firstMessageDeliveriesDecay:.5,firstMessageDeliveriesCap:2e3,meshMessageDeliveriesWeight:-1,meshMessageDeliveriesDecay:.5,meshMessageDeliveriesCap:100,meshMessageDeliveriesThreshold:20,meshMessageDeliveriesWindow:10,meshMessageDeliveriesActivation:5e3,meshFailurePenaltyWeight:-1,meshFailurePenaltyDecay:.5,invalidMessageDeliveriesWeight:-1,invalidMessageDeliveriesDecay:.3};function uT(r={}){return{...OY,...r,topics:r.topics?Object.entries(r.topics).reduce((e,[t,n])=>(e[t]=BY(n),e),{}):{}}}function BY(r={}){return{...LY,...r}}function fT(r){for(let[e,t]of Object.entries(r.topics))try{MY(t)}catch(n){throw new E(`invalid score parameters for topic ${e}: ${n.message}`,it)}if(r.topicScoreCap<0)throw new E("invalid topic score cap; must be positive (or 0 for no cap)",it);if(r.appSpecificScore===null||r.appSpecificScore===void 0)throw new E("missing application specific score function",it);if(r.IPColocationFactorWeight>0)throw new E("invalid IPColocationFactorWeight; must be negative (or 0 to disable)",it);if(r.IPColocationFactorWeight!==0&&r.IPColocationFactorThreshold<1)throw new E("invalid IPColocationFactorThreshold; must be at least 1",it);if(r.behaviourPenaltyWeight>0)throw new E("invalid BehaviourPenaltyWeight; must be negative (or 0 to disable)",it);if(r.behaviourPenaltyWeight!==0&&(r.behaviourPenaltyDecay<=0||r.behaviourPenaltyDecay>=1))throw new E("invalid BehaviourPenaltyDecay; must be between 0 and 1",it);if(r.decayInterval<1e3)throw new E("invalid DecayInterval; must be at least 1s",it);if(r.decayToZero<=0||r.decayToZero>=1)throw new E("invalid DecayToZero; must be between 0 and 1",it)}function MY(r){if(r.topicWeight<0)throw new E("invalid topic weight; must be >= 0",it);if(r.timeInMeshQuantum===0)throw new E("invalid TimeInMeshQuantum; must be non zero",it);if(r.timeInMeshWeight<0)throw new E("invalid TimeInMeshWeight; must be positive (or 0 to disable)",it);if(r.timeInMeshWeight!==0&&r.timeInMeshQuantum<=0)throw new E("invalid TimeInMeshQuantum; must be positive",it);if(r.timeInMeshWeight!==0&&r.timeInMeshCap<=0)throw new E("invalid TimeInMeshCap; must be positive",it);if(r.firstMessageDeliveriesWeight<0)throw new E("invallid FirstMessageDeliveriesWeight; must be positive (or 0 to disable)",it);if(r.firstMessageDeliveriesWeight!==0&&(r.firstMessageDeliveriesDecay<=0||r.firstMessageDeliveriesDecay>=1))throw new E("invalid FirstMessageDeliveriesDecay; must be between 0 and 1",it);if(r.firstMessageDeliveriesWeight!==0&&r.firstMessageDeliveriesCap<=0)throw new E("invalid FirstMessageDeliveriesCap; must be positive",it);if(r.meshMessageDeliveriesWeight>0)throw new E("invalid MeshMessageDeliveriesWeight; must be negative (or 0 to disable)",it);if(r.meshMessageDeliveriesWeight!==0&&(r.meshMessageDeliveriesDecay<=0||r.meshMessageDeliveriesDecay>=1))throw new E("invalid MeshMessageDeliveriesDecay; must be between 0 and 1",it);if(r.meshMessageDeliveriesWeight!==0&&r.meshMessageDeliveriesCap<=0)throw new E("invalid MeshMessageDeliveriesCap; must be positive",it);if(r.meshMessageDeliveriesWeight!==0&&r.meshMessageDeliveriesThreshold<=0)throw new E("invalid MeshMessageDeliveriesThreshold; must be positive",it);if(r.meshMessageDeliveriesWindow<0)throw new E("invalid MeshMessageDeliveriesWindow; must be non-negative",it);if(r.meshMessageDeliveriesWeight!==0&&r.meshMessageDeliveriesActivation<1e3)throw new E("invalid MeshMessageDeliveriesActivation; must be at least 1s",it);if(r.meshFailurePenaltyWeight>0)throw new E("invalid MeshFailurePenaltyWeight; must be negative (or 0 to disable)",it);if(r.meshFailurePenaltyWeight!==0&&(r.meshFailurePenaltyDecay<=0||r.meshFailurePenaltyDecay>=1))throw new E("invalid MeshFailurePenaltyDecay; must be between 0 and 1",it);if(r.invalidMessageDeliveriesWeight>0)throw new E("invalid InvalidMessageDeliveriesWeight; must be negative (or 0 to disable)",it);if(r.invalidMessageDeliveriesDecay<=0||r.invalidMessageDeliveriesDecay>=1)throw new E("invalid InvalidMessageDeliveriesDecay; must be between 0 and 1",it)}var UY={gossipThreshold:-10,publishThreshold:-50,graylistThreshold:-80,acceptPXThreshold:10,opportunisticGraftThreshold:20};function hT(r={}){return{...UY,...r}}function dT(r,e,t,n){let s=0;Object.entries(e.topics).forEach(([o,a])=>{let c=t.topics[o];if(c===void 0)return;let l=0;if(a.inMesh){let p=a.meshTime/c.timeInMeshQuantum;p>c.timeInMeshCap&&(p=c.timeInMeshCap),l+=p*c.timeInMeshWeight}let u=a.firstMessageDeliveries;if(u>c.firstMessageDeliveriesCap&&(u=c.firstMessageDeliveriesCap),l+=u*c.firstMessageDeliveriesWeight,a.meshMessageDeliveriesActive&&a.meshMessageDeliveries<c.meshMessageDeliveriesThreshold){let p=c.meshMessageDeliveriesThreshold-a.meshMessageDeliveries,d=p*p;l+=d*c.meshMessageDeliveriesWeight}let f=a.meshFailurePenalty;l+=f*c.meshFailurePenaltyWeight;let h=a.invalidMessageDeliveries*a.invalidMessageDeliveries;l+=h*c.invalidMessageDeliveriesWeight,s+=l*c.topicWeight}),t.topicScoreCap>0&&s>t.topicScoreCap&&(s=t.topicScoreCap);let i=t.appSpecificScore(r);if(s+=i*t.appSpecificWeight,e.knownIPs.forEach(o=>{if(t.IPColocationFactorWhitelist.has(o))return;let a=n.get(o),c=a?a.size:0;if(c>t.IPColocationFactorThreshold){let l=c-t.IPColocationFactorThreshold,u=l*l;s+=u*t.IPColocationFactorWeight}}),e.behaviourPenalty>t.behaviourPenaltyThreshold){let o=e.behaviourPenalty-t.behaviourPenaltyThreshold,a=o*o;s+=a*t.behaviourPenaltyWeight}return s}var gT=W(mT(),1),Mr;(function(r){r[r.unknown=0]="unknown",r[r.valid=1]="valid",r[r.invalid=2]="invalid",r[r.ignored=3]="ignored"})(Mr||(Mr={}));var Ap=class{constructor(){this.records=new Map,this.queue=new gT.default}ensureRecord(e){let t=this.records.get(e);if(t)return t;t={status:Mr.unknown,firstSeen:Date.now(),validated:0,peers:new Set},this.records.set(e,t);let n={msgId:e,expire:Date.now()+12e4};return this.queue.push(n),t}gc(){let e=Date.now(),t=this.queue.peekFront();for(;t&&t.expire<e;)this.records.delete(t.msgId),this.queue.shift(),t=this.queue.peekFront()}clear(){this.records.clear(),this.queue.clear()}};function Ip(r,e,t=()=>!0){let n=new Set;if(e<=0)return n;for(let s of r){if(n.size>=e)break;t(s)&&(n.add(s),r.delete(s))}return n}function yT(r,e){return Ip(r,e,()=>!0)}var Rp=class extends Map{constructor(e){super(),this.getDefault=e}getOrDefault(e){let t=super.get(e);return t===void 0&&(t=this.getDefault(),this.set(e,t)),t}};var ml=C("libp2p:gossipsub:score"),Tp=class{constructor(e,t,n){this.params=e,this.metrics=t,this.peerStats=new Map,this.peerIPs=new Rp(()=>new Set),this.scoreCache=new Map,this.deliveryRecords=new Ap,fT(e),this.scoreCacheValidityMs=n.scoreCacheValidityMs,this.computeScore=n.computeScore??dT}get size(){return this.peerStats.size}start(){if(this._backgroundInterval){ml("Peer score already running");return}this._backgroundInterval=setInterval(()=>this.background(),this.params.decayInterval),ml("started")}stop(){if(!this._backgroundInterval){ml("Peer score already stopped");return}clearInterval(this._backgroundInterval),delete this._backgroundInterval,this.peerIPs.clear(),this.peerStats.clear(),this.deliveryRecords.clear(),ml("stopped")}background(){this.refreshScores(),this.deliveryRecords.gc()}dumpPeerScoreStats(){return Object.fromEntries(Array.from(this.peerStats.entries()).map(([e,t])=>[e,t]))}refreshScores(){let e=Date.now(),t=this.params.decayToZero;this.peerStats.forEach((n,s)=>{if(!n.connected){e>n.expire&&(this.removeIPsForPeer(s,n.knownIPs),this.peerStats.delete(s),this.scoreCache.delete(s));return}Object.entries(n.topics).forEach(([i,o])=>{let a=this.params.topics[i];a!==void 0&&(o.firstMessageDeliveries*=a.firstMessageDeliveriesDecay,o.firstMessageDeliveries<t&&(o.firstMessageDeliveries=0),o.meshMessageDeliveries*=a.meshMessageDeliveriesDecay,o.meshMessageDeliveries<t&&(o.meshMessageDeliveries=0),o.meshFailurePenalty*=a.meshFailurePenaltyDecay,o.meshFailurePenalty<t&&(o.meshFailurePenalty=0),o.invalidMessageDeliveries*=a.invalidMessageDeliveriesDecay,o.invalidMessageDeliveries<t&&(o.invalidMessageDeliveries=0),o.inMesh&&(o.meshTime=e-o.graftTime,o.meshTime>a.meshMessageDeliveriesActivation&&(o.meshMessageDeliveriesActive=!0)))}),n.behaviourPenalty*=this.params.behaviourPenaltyDecay,n.behaviourPenalty<t&&(n.behaviourPenalty=0)})}score(e){this.metrics?.scoreFnCalls.inc();let t=this.peerStats.get(e);if(!t)return 0;let n=Date.now(),s=this.scoreCache.get(e);if(s&&s.cacheUntil>n)return s.score;this.metrics?.scoreFnRuns.inc();let i=this.computeScore(e,t,this.params,this.peerIPs),o=n+this.scoreCacheValidityMs;return s?(this.metrics?.scoreCachedDelta.observe(Math.abs(i-s.score)),s.score=i,s.cacheUntil=o):this.scoreCache.set(e,{score:i,cacheUntil:o}),i}addPenalty(e,t,n){let s=this.peerStats.get(e);s&&(s.behaviourPenalty+=t,this.metrics?.onScorePenalty(n))}addPeer(e){let t={connected:!0,expire:0,topics:{},knownIPs:new Set,behaviourPenalty:0};this.peerStats.set(e,t)}addIP(e,t){let n=this.peerStats.get(e);n&&n.knownIPs.add(t),this.peerIPs.getOrDefault(t).add(e)}removeIP(e,t){let n=this.peerStats.get(e);n&&n.knownIPs.delete(t);let s=this.peerIPs.get(t);s&&(s.delete(e),s.size===0&&this.peerIPs.delete(t))}removePeer(e){let t=this.peerStats.get(e);if(t){if(this.score(e)>0){this.removeIPsForPeer(e,t.knownIPs),this.peerStats.delete(e);return}Object.entries(t.topics).forEach(([n,s])=>{s.firstMessageDeliveries=0;let i=this.params.topics[n].meshMessageDeliveriesThreshold;if(s.inMesh&&s.meshMessageDeliveriesActive&&s.meshMessageDeliveries<i){let o=i-s.meshMessageDeliveries;s.meshFailurePenalty+=o*o}s.inMesh=!1,s.meshMessageDeliveriesActive=!1}),t.connected=!1,t.expire=Date.now()+this.params.retainScore}}graft(e,t){let n=this.peerStats.get(e);if(n){let s=this.getPtopicStats(n,t);s&&(s.inMesh=!0,s.graftTime=Date.now(),s.meshTime=0,s.meshMessageDeliveriesActive=!1)}}prune(e,t){let n=this.peerStats.get(e);if(n){let s=this.getPtopicStats(n,t);if(s){let i=this.params.topics[t].meshMessageDeliveriesThreshold;if(s.meshMessageDeliveriesActive&&s.meshMessageDeliveries<i){let o=i-s.meshMessageDeliveries;s.meshFailurePenalty+=o*o}s.meshMessageDeliveriesActive=!1,s.inMesh=!1}}}validateMessage(e){this.deliveryRecords.ensureRecord(e)}deliverMessage(e,t,n){this.markFirstMessageDelivery(e,n);let s=this.deliveryRecords.ensureRecord(t),i=Date.now();if(s.status!==Mr.unknown){ml("unexpected delivery: message from %s was first seen %s ago and has delivery status %s",e,i-s.firstSeen,Mr[s.status]);return}s.status=Mr.valid,s.validated=i,s.peers.forEach(o=>{o!==e.toString()&&this.markDuplicateMessageDelivery(o,n)})}rejectInvalidMessage(e,t){this.markInvalidMessageDelivery(e,t)}rejectMessage(e,t,n,s){switch(s){case Br.Error:this.markInvalidMessageDelivery(e,n);return;case Br.Blacklisted:return}let i=this.deliveryRecords.ensureRecord(t);if(i.status!==Mr.unknown){ml("unexpected rejection: message from %s was first seen %s ago and has delivery status %d",e,Date.now()-i.firstSeen,Mr[i.status]);return}if(s===Br.Ignore){i.status=Mr.ignored,i.peers.clear();return}i.status=Mr.invalid,this.markInvalidMessageDelivery(e,n),i.peers.forEach(o=>{this.markInvalidMessageDelivery(o,n)}),i.peers.clear()}duplicateMessage(e,t,n){let s=this.deliveryRecords.ensureRecord(t);if(!s.peers.has(e))switch(s.status){case Mr.unknown:s.peers.add(e);break;case Mr.valid:s.peers.add(e),this.markDuplicateMessageDelivery(e,n,s.validated);break;case Mr.invalid:this.markInvalidMessageDelivery(e,n);break;case Mr.ignored:break}}markInvalidMessageDelivery(e,t){let n=this.peerStats.get(e);if(n){let s=this.getPtopicStats(n,t);s&&(s.invalidMessageDeliveries+=1)}}markFirstMessageDelivery(e,t){let n=this.peerStats.get(e);if(n){let s=this.getPtopicStats(n,t);if(s){let i=this.params.topics[t].firstMessageDeliveriesCap;s.firstMessageDeliveries=Math.min(i,s.firstMessageDeliveries+1),s.inMesh&&(i=this.params.topics[t].meshMessageDeliveriesCap,s.meshMessageDeliveries=Math.min(i,s.meshMessageDeliveries+1))}}}markDuplicateMessageDelivery(e,t,n){let s=this.peerStats.get(e);if(s){let i=n!==void 0?Date.now():0,o=this.getPtopicStats(s,t);if(o&&o.inMesh){let a=this.params.topics[t];if(n!==void 0){let l=i-n,u=l>a.meshMessageDeliveriesWindow;if(this.metrics?.onDuplicateMsgDelivery(t,l,u),u)return}let c=a.meshMessageDeliveriesCap;o.meshMessageDeliveries=Math.min(c,o.meshMessageDeliveries+1)}}}removeIPsForPeer(e,t){for(let n of t){let s=this.peerIPs.get(n);s&&(s.delete(e),s.size===0&&this.peerIPs.delete(n))}}getPtopicStats(e,t){let n=e.topics[t];return n!==void 0?n:this.params.topics[t]!==void 0?(n={inMesh:!1,graftTime:0,meshTime:0,firstMessageDeliveries:0,meshMessageDeliveries:0,meshMessageDeliveriesActive:!1,meshFailurePenalty:0,invalidMessageDeliveries:0},e.topics[t]=n,n):null}};var Dp=class{constructor(e,t,n){this.gossipsubIWantFollowupMs=e,this.msgIdToStrFn=t,this.metrics=n,this.promises=new Map,this.requestMsByMsg=new Map,this.requestMsByMsgExpire=10*e}get size(){return this.promises.size}get requestMsByMsgSize(){return this.requestMsByMsg.size}addPromise(e,t){let n=Math.floor(Math.random()*t.length),s=t[n],i=this.msgIdToStrFn(s),o=this.promises.get(i);o||(o=new Map,this.promises.set(i,o));let a=Date.now();o.has(e)||(o.set(e,a+this.gossipsubIWantFollowupMs),this.metrics&&(this.metrics.iwantPromiseStarted.inc(1),this.requestMsByMsg.has(i)||this.requestMsByMsg.set(i,a)))}getBrokenPromises(){let e=Date.now(),t=new Map,n=0;return this.promises.forEach((s,i)=>{s.forEach((o,a)=>{o<e&&(t.set(a,(t.get(a)??0)+1),s.delete(a),n++)}),s.size||this.promises.delete(i)}),this.metrics?.iwantPromiseBroken.inc(n),t}deliverMessage(e,t=!1){this.trackMessage(e);let n=this.promises.get(e);n&&(this.promises.delete(e),this.metrics&&(this.metrics.iwantPromiseResolved.inc(1),t&&this.metrics.iwantPromiseResolvedFromDuplicate.inc(1),this.metrics.iwantPromiseResolvedPeers.inc(n.size)))}rejectMessage(e,t){switch(this.trackMessage(e),t){case Br.Error:return}this.promises.delete(e)}clear(){this.promises.clear()}prune(){let e=Date.now()-this.requestMsByMsgExpire,t=0;for(let[n,s]of this.requestMsByMsg.entries())if(s<e)this.requestMsByMsg.delete(n),t++;else break;this.metrics?.iwantMessagePruned.inc(t)}trackMessage(e){if(this.metrics){let t=this.requestMsByMsg.get(e);t!==void 0&&(this.metrics.iwantPromiseDeliveryTime.observe((Date.now()-t)/1e3),this.requestMsByMsg.delete(e))}}};var gl=class{constructor(e){this.entries=new Map,this.validityMs=e.validityMs}get size(){return this.entries.size}put(e,t){return this.entries.has(e)?!0:(this.entries.set(e,{value:t,validUntilMs:Date.now()+this.validityMs}),!1)}prune(){let e=Date.now();for(let[t,n]of this.entries.entries())if(n.validUntilMs<e)this.entries.delete(t);else break}has(e){return this.entries.has(e)}get(e){let t=this.entries.get(e);return t&&t.validUntilMs>=Date.now()?t.value:void 0}clear(){this.entries.clear()}};var bT;(function(r){r.forward="forward",r.publish="publish"})(bT||(bT={}));var Ei;(function(r){r.Fanout="fanout",r.Random="random",r.Subscribed="subscribed",r.Outbound="outbound",r.NotEnough="not_enough",r.Opportunistic="opportunistic"})(Ei||(Ei={}));var Ca;(function(r){r.Dc="disconnected",r.BadScore="bad_score",r.Prune="prune",r.Unsub="unsubscribed",r.Excess="excess"})(Ca||(Ca={}));var bl;(function(r){r.GraftBackoff="graft_backoff",r.BrokenPromise="broken_promise",r.MessageDeficit="message_deficit",r.IPColocation="IP_colocation"})(bl||(bl={}));var wl;(function(r){r.LowScore="low_score",r.MaxIhave="max_ihave",r.MaxIasked="max_iasked"})(wl||(wl={}));var yl;(function(r){r.graylist="graylist",r.publish="publish",r.gossip="gossip",r.mesh="mesh"})(yl||(yl={}));function wT(r,e,t){return{protocolsEnabled:r.gauge({name:"gossipsub_protocol",help:"Status of enabled protocols",labelNames:["protocol"]}),topicSubscriptionStatus:r.gauge({name:"gossipsub_topic_subscription_status",help:"Status of our subscription to this topic",labelNames:["topicStr"]}),topicPeersCount:r.gauge({name:"gossipsub_topic_peer_count",help:"Number of peers subscribed to each topic",labelNames:["topicStr"]}),meshPeerCounts:r.gauge({name:"gossipsub_mesh_peer_count",help:"Number of peers in our mesh",labelNames:["topicStr"]}),meshPeerInclusionEvents:r.gauge({name:"gossipsub_mesh_peer_inclusion_events_total",help:"Number of times we include peers in a topic mesh for different reasons",labelNames:["reason"]}),meshPeerInclusionEventsByTopic:r.gauge({name:"gossipsub_mesh_peer_inclusion_events_by_topic_total",help:"Number of times we include peers in a topic",labelNames:["topic"]}),meshPeerChurnEvents:r.gauge({name:"gossipsub_peer_churn_events_total",help:"Number of times we remove peers in a topic mesh for different reasons",labelNames:["reason"]}),meshPeerChurnEventsByTopic:r.gauge({name:"gossipsub_peer_churn_events_by_topic_total",help:"Number of times we remove peers in a topic",labelNames:["topic"]}),peersPerProtocol:r.gauge({name:"gossipsub_peers_per_protocol_count",help:"Peers connected for each topic",labelNames:["protocol"]}),heartbeatDuration:r.histogram({name:"gossipsub_heartbeat_duration_seconds",help:"The time it takes to complete one iteration of the heartbeat",buckets:[.01,.1,1]}),heartbeatSkipped:r.gauge({name:"gossipsub_heartbeat_skipped",help:"Heartbeat run took longer than heartbeat interval so next is skipped"}),asyncValidationResult:r.gauge({name:"gossipsub_async_validation_result_total",help:"Message validation result",labelNames:["acceptance"]}),asyncValidationResultByTopic:r.gauge({name:"gossipsub_async_validation_result_by_topic_total",help:"Message validation result for each topic",labelNames:["topic"]}),asyncValidationMcacheHit:r.gauge({name:"gossipsub_async_validation_mcache_hit_total",help:"Async validation result reported by the user layer",labelNames:["hit"]}),peerReadStreamError:r.gauge({name:"gossipsub_peer_read_stream_err_count_total",help:"Peer read stream error"}),rpcRecvBytes:r.gauge({name:"gossipsub_rpc_recv_bytes_total",help:"RPC recv"}),rpcRecvCount:r.gauge({name:"gossipsub_rpc_recv_count_total",help:"RPC recv"}),rpcRecvSubscription:r.gauge({name:"gossipsub_rpc_recv_subscription_total",help:"RPC recv"}),rpcRecvMessage:r.gauge({name:"gossipsub_rpc_recv_message_total",help:"RPC recv"}),rpcRecvControl:r.gauge({name:"gossipsub_rpc_recv_control_total",help:"RPC recv"}),rpcRecvIHave:r.gauge({name:"gossipsub_rpc_recv_ihave_total",help:"RPC recv"}),rpcRecvIWant:r.gauge({name:"gossipsub_rpc_recv_iwant_total",help:"RPC recv"}),rpcRecvGraft:r.gauge({name:"gossipsub_rpc_recv_graft_total",help:"RPC recv"}),rpcRecvPrune:r.gauge({name:"gossipsub_rpc_recv_prune_total",help:"RPC recv"}),rpcDataError:r.gauge({name:"gossipsub_rpc_data_err_count_total",help:"RPC data error"}),rpcRecvError:r.gauge({name:"gossipsub_rpc_recv_err_count_total",help:"RPC recv error"}),rpcRecvNotAccepted:r.gauge({name:"gossipsub_rpc_rcv_not_accepted_total",help:"Total count of RPC dropped because acceptFrom() == false"}),rpcSentBytes:r.gauge({name:"gossipsub_rpc_sent_bytes_total",help:"RPC sent"}),rpcSentCount:r.gauge({name:"gossipsub_rpc_sent_count_total",help:"RPC sent"}),rpcSentSubscription:r.gauge({name:"gossipsub_rpc_sent_subscription_total",help:"RPC sent"}),rpcSentMessage:r.gauge({name:"gossipsub_rpc_sent_message_total",help:"RPC sent"}),rpcSentControl:r.gauge({name:"gossipsub_rpc_sent_control_total",help:"RPC sent"}),rpcSentIHave:r.gauge({name:"gossipsub_rpc_sent_ihave_total",help:"RPC sent"}),rpcSentIWant:r.gauge({name:"gossipsub_rpc_sent_iwant_total",help:"RPC sent"}),rpcSentGraft:r.gauge({name:"gossipsub_rpc_sent_graft_total",help:"RPC sent"}),rpcSentPrune:r.gauge({name:"gossipsub_rpc_sent_prune_total",help:"RPC sent"}),msgPublishCount:r.gauge({name:"gossipsub_msg_publish_count_total",help:"Total count of msg published by topic",labelNames:["topic"]}),msgPublishPeersByTopic:r.gauge({name:"gossipsub_msg_publish_peers_total",help:"Total count of peers that we publish a msg to",labelNames:["topic"]}),msgPublishPeersByGroup:r.gauge({name:"gossipsub_msg_publish_peers_by_group",help:"Total count of peers (by group) that we publish a msg to",labelNames:["peerGroup"]}),msgPublishBytes:r.gauge({name:"gossipsub_msg_publish_bytes_total",help:"Total count of msg publish data.length bytes",labelNames:["topic"]}),msgForwardCount:r.gauge({name:"gossipsub_msg_forward_count_total",help:"Total count of msg forwarded by topic",labelNames:["topic"]}),msgForwardPeers:r.gauge({name:"gossipsub_msg_forward_peers_total",help:"Total count of peers that we forward a msg to",labelNames:["topic"]}),msgReceivedPreValidation:r.gauge({name:"gossipsub_msg_received_prevalidation_total",help:"Total count of recv msgs before any validation",labelNames:["topic"]}),msgReceivedError:r.gauge({name:"gossipsub_msg_received_error_total",help:"Total count of recv msgs error",labelNames:["topic"]}),msgReceivedStatus:r.gauge({name:"gossipsub_msg_received_status_total",help:"Tracks distribution of recv msgs by duplicate, invalid, valid",labelNames:["status"]}),msgReceivedTopic:r.gauge({name:"gossipsub_msg_received_topic_total",help:"Tracks distribution of recv msgs by topic label",labelNames:["topic"]}),msgReceivedInvalid:r.gauge({name:"gossipsub_msg_received_invalid_total",help:"Tracks specific reason of invalid",labelNames:["error"]}),msgReceivedInvalidByTopic:r.gauge({name:"gossipsub_msg_received_invalid_by_topic_total",help:"Tracks specific invalid message by topic",labelNames:["topic"]}),duplicateMsgDeliveryDelay:r.histogram({name:"gossisub_duplicate_msg_delivery_delay_seconds",help:"Time since the 1st duplicated message validated",labelNames:["topic"],buckets:[.25*t.maxMeshMessageDeliveriesWindowSec,.5*t.maxMeshMessageDeliveriesWindowSec,1*t.maxMeshMessageDeliveriesWindowSec,2*t.maxMeshMessageDeliveriesWindowSec,4*t.maxMeshMessageDeliveriesWindowSec]}),duplicateMsgLateDelivery:r.gauge({name:"gossisub_duplicate_msg_late_delivery_total",help:"Total count of late duplicate message delivery by topic, which triggers P3 penalty",labelNames:["topic"]}),duplicateMsgIgnored:r.gauge({name:"gossisub_ignored_published_duplicate_msgs_total",help:"Total count of published duplicate message ignored by topic",labelNames:["topic"]}),scoreFnCalls:r.gauge({name:"gossipsub_score_fn_calls_total",help:"Total times score() is called"}),scoreFnRuns:r.gauge({name:"gossipsub_score_fn_runs_total",help:"Total times score() call actually computed computeScore(), no cache"}),scoreCachedDelta:r.histogram({name:"gossipsub_score_cache_delta",help:"Delta of score between cached values that expired",buckets:[10,100,1e3]}),peersByScoreThreshold:r.gauge({name:"gossipsub_peers_by_score_threshold_count",help:"Current count of peers by score threshold",labelNames:["threshold"]}),score:r.avgMinMax({name:"gossipsub_score",help:"Avg min max of gossip scores"}),scoreWeights:r.avgMinMax({name:"gossipsub_score_weights",help:"Separate score weights",labelNames:["topic","p"]}),scorePerMesh:r.avgMinMax({name:"gossipsub_score_per_mesh",help:"Histogram of the scores for each mesh topic",labelNames:["topic"]}),scoringPenalties:r.gauge({name:"gossipsub_scoring_penalties_total",help:"A counter of the kind of penalties being applied to peers",labelNames:["penalty"]}),behaviourPenalty:r.histogram({name:"gossipsub_peer_stat_behaviour_penalty",help:"Current peer stat behaviour_penalty at each scrape",buckets:[.25*t.behaviourPenaltyThreshold,.5*t.behaviourPenaltyThreshold,1*t.behaviourPenaltyThreshold,2*t.behaviourPenaltyThreshold,4*t.behaviourPenaltyThreshold]}),ihaveRcvIgnored:r.gauge({name:"gossipsub_ihave_rcv_ignored_total",help:"Total received IHAVE messages that we ignore for some reason",labelNames:["reason"]}),ihaveRcvMsgids:r.gauge({name:"gossipsub_ihave_rcv_msgids_total",help:"Total received IHAVE messages by topic",labelNames:["topic"]}),ihaveRcvNotSeenMsgids:r.gauge({name:"gossipsub_ihave_rcv_not_seen_msgids_total",help:"Total messages per topic we do not have, not actual requests",labelNames:["topic"]}),iwantRcvMsgids:r.gauge({name:"gossipsub_iwant_rcv_msgids_total",help:"Total received IWANT messages by topic",labelNames:["topic"]}),iwantRcvDonthaveMsgids:r.gauge({name:"gossipsub_iwant_rcv_dont_have_msgids_total",help:"Total requested messageIDs that we do not have"}),iwantPromiseStarted:r.gauge({name:"gossipsub_iwant_promise_sent_total",help:"Total count of started IWANT promises"}),iwantPromiseResolved:r.gauge({name:"gossipsub_iwant_promise_resolved_total",help:"Total count of resolved IWANT promises"}),iwantPromiseResolvedFromDuplicate:r.gauge({name:"gossipsub_iwant_promise_resolved_from_duplicate_total",help:"Total count of resolved IWANT promises from duplicate messages"}),iwantPromiseResolvedPeers:r.gauge({name:"gossipsub_iwant_promise_resolved_peers",help:"Total count of peers we have asked IWANT promises that are resolved"}),iwantPromiseBroken:r.gauge({name:"gossipsub_iwant_promise_broken",help:"Total count of broken IWANT promises"}),iwantMessagePruned:r.gauge({name:"gossipsub_iwant_message_pruned",help:"Total count of pruned IWANT messages"}),iwantPromiseDeliveryTime:r.histogram({name:"gossipsub_iwant_promise_delivery_seconds",help:"Histogram of delivery time of resolved IWANT promises",buckets:[.5*t.gossipPromiseExpireSec,1*t.gossipPromiseExpireSec,2*t.gossipPromiseExpireSec,4*t.gossipPromiseExpireSec]}),iwantPromiseUntracked:r.gauge({name:"gossip_iwant_promise_untracked",help:"Total count of untracked IWANT promise"}),cacheSize:r.gauge({name:"gossipsub_cache_size",help:"Unbounded cache sizes",labelNames:["cache"]}),mcacheSize:r.gauge({name:"gossipsub_mcache_size",help:"Current mcache msg count"}),mcacheNotValidatedCount:r.gauge({name:"gossipsub_mcache_not_validated_count",help:"Current mcache msg count not validated"}),fastMsgIdCacheCollision:r.gauge({name:"gossipsub_fastmsgid_cache_collision_total",help:"Total count of key collisions on fastmsgid cache put"}),newConnectionCount:r.gauge({name:"gossipsub_new_connection_total",help:"Total new connection by status",labelNames:["status"]}),topicStrToLabel:e,toTopic(n){return this.topicStrToLabel.get(n)??n},onJoin(n){this.topicSubscriptionStatus.set({topicStr:n},1),this.meshPeerCounts.set({topicStr:n},0)},onLeave(n){this.topicSubscriptionStatus.set({topicStr:n},0),this.meshPeerCounts.set({topicStr:n},0)},onAddToMesh(n,s,i){let o=this.toTopic(n);this.meshPeerInclusionEvents.inc({reason:s},i),this.meshPeerInclusionEventsByTopic.inc({topic:o},i)},onRemoveFromMesh(n,s,i){let o=this.toTopic(n);this.meshPeerChurnEvents.inc({reason:s},i),this.meshPeerChurnEventsByTopic.inc({topic:o},i)},onReportValidationMcacheHit(n){this.asyncValidationMcacheHit.inc({hit:n?"hit":"miss"})},onReportValidation(n,s){let i=this.toTopic(n);this.asyncValidationResult.inc({acceptance:s}),this.asyncValidationResultByTopic.inc({topic:i})},onScorePenalty(n){this.scoringPenalties.inc({penalty:n},1)},onIhaveRcv(n,s,i){let o=this.toTopic(n);this.ihaveRcvMsgids.inc({topic:o},s),this.ihaveRcvNotSeenMsgids.inc({topic:o},i)},onIwantRcv(n,s){for(let[i,o]of n){let a=this.toTopic(i);this.iwantRcvMsgids.inc({topic:a},o)}this.iwantRcvDonthaveMsgids.inc(s)},onForwardMsg(n,s){let i=this.toTopic(n);this.msgForwardCount.inc({topic:i},1),this.msgForwardPeers.inc({topic:i},s)},onPublishMsg(n,s,i,o){let a=this.toTopic(n);this.msgPublishCount.inc({topic:a},1),this.msgPublishBytes.inc({topic:a},i*o),this.msgPublishPeersByTopic.inc({topic:a},i),this.msgPublishPeersByGroup.inc({peerGroup:"direct"},s.direct),this.msgPublishPeersByGroup.inc({peerGroup:"floodsub"},s.floodsub),this.msgPublishPeersByGroup.inc({peerGroup:"mesh"},s.mesh),this.msgPublishPeersByGroup.inc({peerGroup:"fanout"},s.fanout)},onMsgRecvPreValidation(n){let s=this.toTopic(n);this.msgReceivedPreValidation.inc({topic:s},1)},onMsgRecvError(n){let s=this.toTopic(n);this.msgReceivedError.inc({topic:s},1)},onMsgRecvResult(n,s){let i=this.toTopic(n);this.msgReceivedTopic.inc({topic:i}),this.msgReceivedStatus.inc({status:s})},onMsgRecvInvalid(n,s){let i=this.toTopic(n),o=s.reason===Br.Error?s.error:s.reason;this.msgReceivedInvalid.inc({error:o},1),this.msgReceivedInvalidByTopic.inc({topic:i},1)},onDuplicateMsgDelivery(n,s,i){if(this.duplicateMsgDeliveryDelay.observe(s/1e3),i){let o=this.toTopic(n);this.duplicateMsgLateDelivery.inc({topic:o},1)}},onPublishDuplicateMsg(n){let s=this.toTopic(n);this.duplicateMsgIgnored.inc({topic:s},1)},onPeerReadStreamError(){this.peerReadStreamError.inc(1)},onRpcRecvError(){this.rpcRecvError.inc(1)},onRpcDataError(){this.rpcDataError.inc(1)},onRpcRecv(n,s){this.rpcRecvBytes.inc(s),this.rpcRecvCount.inc(1),n.subscriptions&&this.rpcRecvSubscription.inc(n.subscriptions.length),n.messages&&this.rpcRecvMessage.inc(n.messages.length),n.control&&(this.rpcRecvControl.inc(1),n.control.ihave&&this.rpcRecvIHave.inc(n.control.ihave.length),n.control.iwant&&this.rpcRecvIWant.inc(n.control.iwant.length),n.control.graft&&this.rpcRecvGraft.inc(n.control.graft.length),n.control.prune&&this.rpcRecvPrune.inc(n.control.prune.length))},onRpcSent(n,s){if(this.rpcSentBytes.inc(s),this.rpcSentCount.inc(1),n.subscriptions&&this.rpcSentSubscription.inc(n.subscriptions.length),n.messages&&this.rpcSentMessage.inc(n.messages.length),n.control){let i=n.control.ihave?.length??0,o=n.control.iwant?.length??0,a=n.control.graft?.length??0,c=n.control.prune?.length??0;i>0&&this.rpcSentIHave.inc(i),o>0&&this.rpcSentIWant.inc(o),a>0&&this.rpcSentGraft.inc(a),c>0&&this.rpcSentPrune.inc(c),(i>0||o>0||a>0||c>0)&&this.rpcSentControl.inc(1)}},registerScores(n,s){let i=0,o=0,a=0,c=0;for(let l of n)l>=s.graylistThreshold&&i++,l>=s.publishThreshold&&o++,l>=s.gossipThreshold&&a++,l>=0&&c++;this.peersByScoreThreshold.set({threshold:yl.graylist},i),this.peersByScoreThreshold.set({threshold:yl.publish},o),this.peersByScoreThreshold.set({threshold:yl.gossip},a),this.peersByScoreThreshold.set({threshold:yl.mesh},c),this.score.set(n)},registerScoreWeights(n){for(let[s,i]of n.byTopic)this.scoreWeights.set({topic:s,p:"p1"},i.p1w),this.scoreWeights.set({topic:s,p:"p2"},i.p2w),this.scoreWeights.set({topic:s,p:"p3"},i.p3w),this.scoreWeights.set({topic:s,p:"p3b"},i.p3bw),this.scoreWeights.set({topic:s,p:"p4"},i.p4w);this.scoreWeights.set({p:"p5"},n.p5w),this.scoreWeights.set({p:"p6"},n.p6w),this.scoreWeights.set({p:"p7"},n.p7w)},registerScorePerMesh(n,s){let i=new Map;n.forEach((o,a)=>{let c=this.topicStrToLabel.get(a)??"unknown",l=i.get(c);l||(l=new Set,i.set(c,l)),o.forEach(u=>l?.add(u))});for(let[o,a]of i){let c=[];a.forEach(l=>{c.push(s.get(l)??0)}),this.scorePerMesh.set({topic:o},c)}}}}var xT=$("libp2p-pubsub:");async function ET(r,e,t,n){switch(r.type){case mo.Signing:{let s={from:r.author.toBytes(),data:n,seqno:Fn(8),topic:e,signature:void 0,key:void 0},i=Ee([xT,nh.Message.encode(s).finish()]);s.signature=await r.privateKey.sign(i),s.key=r.key;let o={type:"signed",from:r.author,data:t,sequenceNumber:BigInt(`0x${M(s.seqno,"base16")}`),topic:e,signature:s.signature,key:s.key};return{raw:s,msg:o}}case mo.Anonymous:return{raw:{from:void 0,data:n,seqno:void 0,topic:e,signature:void 0,key:void 0},msg:{type:"unsigned",data:t,topic:e}}}}async function vT(r,e){switch(r){case pl:return e.signature!=null?{valid:!1,error:Tr.SignaturePresent}:e.seqno!=null?{valid:!1,error:Tr.SeqnoPresent}:e.key!=null?{valid:!1,error:Tr.FromPresent}:{valid:!0,message:{type:"unsigned",topic:e.topic,data:e.data??new Uint8Array(0)}};case Da:{if(e.seqno==null)return{valid:!1,error:Tr.InvalidSeqno};if(e.seqno.length!==8)return{valid:!1,error:Tr.InvalidSeqno};if(e.signature==null)return{valid:!1,error:Tr.InvalidSignature};if(e.from==null)return{valid:!1,error:Tr.InvalidPeerId};let t;try{t=_t(e.from)}catch{return{valid:!1,error:Tr.InvalidPeerId}}let n;if(e.key){if(n=Yr(e.key),t.publicKey!==void 0&&!be(n.bytes,t.publicKey))return{valid:!1,error:Tr.InvalidPeerId}}else{if(t.publicKey==null)return{valid:!1,error:Tr.InvalidPeerId};n=Yr(t.publicKey)}let s={from:e.from,data:e.data,seqno:e.seqno,topic:e.topic,signature:void 0,key:void 0},i=Ee([xT,nh.Message.encode(s).finish()]);return await n.verify(i,e.signature)?{valid:!0,message:{type:"signed",from:t,data:e.data??new Uint8Array(0),sequenceNumber:BigInt(`0x${M(e.seqno,"base16")}`),topic:e.topic,signature:e.signature,key:e.key??Tf(n)}}:{valid:!1,error:Tr.InvalidSignature}}}}var B9e=new Uint8Array(0);var VY=AT,_T=128,zY=127,qY=~zY,KY=Math.pow(2,31);function AT(r,e,t){e=e||[],t=t||0;for(var n=t;r>=KY;)e[t++]=r&255|_T,r/=128;for(;r&qY;)e[t++]=r&255|_T,r>>>=7;return e[t]=r|0,AT.bytes=t-n+1,e}var $Y=P8,HY=128,ST=127;function P8(r,n){var t=0,n=n||0,s=0,i=n,o,a=r.length;do{if(i>=a)throw P8.bytes=0,new RangeError("Could not decode varint");o=r[i++],t+=s<28?(o&ST)<<s:(o&ST)*Math.pow(2,s),s+=7}while(o>=HY);return P8.bytes=i-n,t}var GY=Math.pow(2,7),WY=Math.pow(2,14),YY=Math.pow(2,21),QY=Math.pow(2,28),XY=Math.pow(2,35),jY=Math.pow(2,42),ZY=Math.pow(2,49),JY=Math.pow(2,56),eQ=Math.pow(2,63),tQ=function(r){return r<GY?1:r<WY?2:r<YY?3:r<QY?4:r<XY?5:r<jY?6:r<ZY?7:r<JY?8:r<eQ?9:10},rQ={encode:VY,decode:$Y,encodingLength:tQ},nQ=rQ,k8=nQ;var N8=(r,e,t=0)=>(k8.encode(r,e,t),e),O8=r=>k8.encodingLength(r);var B8=(r,e)=>{let t=e.byteLength,n=O8(r),s=n+O8(t),i=new Uint8Array(s+t);return N8(r,i,0),N8(t,i,n),i.set(e,s),new L8(r,t,e,i)};var L8=class{constructor(e,t,n,s){this.code=e,this.size=t,this.digest=n,this.bytes=s}};var U8=({name:r,code:e,encode:t})=>new M8(r,e,t),M8=class{constructor(e,t,n){this.name=e,this.code=t,this.encode=n}digest(e){if(e instanceof Uint8Array){let t=this.encode(e);return t instanceof Uint8Array?B8(this.code,t):t.then(n=>B8(this.code,n))}else throw Error("Unknown type, must be binary type")}};var RT=r=>async e=>new Uint8Array(await crypto.subtle.digest(r,e)),IT=U8({name:"sha2-256",code:18,encode:RT("SHA-256")}),G9e=U8({name:"sha2-512",code:19,encode:RT("SHA-512")});var Y9e=new Uint8Array(0);var oQ=CT,TT=128,aQ=127,cQ=~aQ,lQ=Math.pow(2,31);function CT(r,e,t){e=e||[],t=t||0;for(var n=t;r>=lQ;)e[t++]=r&255|TT,r/=128;for(;r&cQ;)e[t++]=r&255|TT,r>>>=7;return e[t]=r|0,CT.bytes=t-n+1,e}var uQ=F8,fQ=128,DT=127;function F8(r,n){var t=0,n=n||0,s=0,i=n,o,a=r.length;do{if(i>=a)throw F8.bytes=0,new RangeError("Could not decode varint");o=r[i++],t+=s<28?(o&DT)<<s:(o&DT)*Math.pow(2,s),s+=7}while(o>=fQ);return F8.bytes=i-n,t}var hQ=Math.pow(2,7),dQ=Math.pow(2,14),pQ=Math.pow(2,21),mQ=Math.pow(2,28),gQ=Math.pow(2,35),yQ=Math.pow(2,42),bQ=Math.pow(2,49),wQ=Math.pow(2,56),xQ=Math.pow(2,63),EQ=function(r){return r<hQ?1:r<dQ?2:r<pQ?3:r<mQ?4:r<gQ?5:r<yQ?6:r<bQ?7:r<wQ?8:r<xQ?9:10},vQ={encode:oQ,decode:uQ,encodingLength:EQ},_Q=vQ,V8=_Q;var z8=(r,e,t=0)=>(V8.encode(r,e,t),e),q8=r=>V8.encodingLength(r);var $8=(r,e)=>{let t=e.byteLength,n=q8(r),s=n+q8(t),i=new Uint8Array(s+t);return z8(r,i,0),z8(t,i,n),i.set(e,s),new K8(r,t,e,i)};var K8=class{constructor(e,t,n,s){this.code=e,this.size=t,this.digest=n,this.bytes=s}};var G8=({name:r,code:e,encode:t})=>new H8(r,e,t),H8=class{constructor(e,t,n){this.name=e,this.code=t,this.encode=n}digest(e){if(e instanceof Uint8Array){let t=this.encode(e);return t instanceof Uint8Array?$8(this.code,t):t.then(n=>$8(this.code,n))}else throw Error("Unknown type, must be binary type")}};var PT=r=>async e=>new Uint8Array(await crypto.subtle.digest(r,e)),RQ=G8({name:"sha2-256",code:18,encode:PT("SHA-256")}),swe=G8({name:"sha2-512",code:19,encode:PT("SHA-512")});var kT=(r,e)=>{let t=$(e.toString(16).padStart(16,"0"),"base16"),n=new Uint8Array(r.length+t.length);return n.set(r,0),n.set(t,r.length),n};function NT(r){if(r.type!=="signed")throw new Error("expected signed message type");if(r.sequenceNumber==null)throw Error("missing seqno field");return kT(r.from.toBytes(),r.sequenceNumber)}async function OT(r){return await IT.encode(r.data)}function IQ(r,e,t,n,s){let i=0,o=new Map;if(Object.entries(e.topics).forEach(([h,p])=>{let d=s.get(h)??"unknown",m=t.topics[h];if(m===void 0)return;let g=o.get(d);g||(g={p1w:0,p2w:0,p3w:0,p3bw:0,p4w:0},o.set(d,g));let y=0,b=0,w=0,v=0,x=0;if(p.inMesh){let D=Math.max(p.meshTime/m.timeInMeshQuantum,m.timeInMeshCap);y+=D*m.timeInMeshWeight}let _=p.firstMessageDeliveries;if(_>m.firstMessageDeliveriesCap&&(_=m.firstMessageDeliveriesCap),b+=_*m.firstMessageDeliveriesWeight,p.meshMessageDeliveriesActive&&p.meshMessageDeliveries<m.meshMessageDeliveriesThreshold){let D=m.meshMessageDeliveriesThreshold-p.meshMessageDeliveries,H=D*D;w+=H*m.meshMessageDeliveriesWeight}let S=p.meshFailurePenalty;v+=S*m.meshFailurePenaltyWeight;let A=p.invalidMessageDeliveries*p.invalidMessageDeliveries;x+=A*m.invalidMessageDeliveriesWeight,i+=(y+b+w+v+x)*m.topicWeight,g.p1w+=y,g.p2w+=b,g.p3w+=w,g.p3bw+=v,g.p4w+=x}),t.topicScoreCap>0&&i>t.topicScoreCap){i=t.topicScoreCap;let h=t.topicScoreCap/i;for(let p of o.values())p.p1w*=h,p.p2w*=h,p.p3w*=h,p.p3bw*=h,p.p4w*=h}let a=0,c=0,l=0,u=t.appSpecificScore(r);a+=u*t.appSpecificWeight,e.knownIPs.forEach(h=>{if(t.IPColocationFactorWhitelist.has(h))return;let p=n.get(h),d=p?p.size:0;if(d>t.IPColocationFactorThreshold){let m=d-t.IPColocationFactorThreshold,g=m*m;c+=g*t.IPColocationFactorWeight}});let f=e.behaviourPenalty*e.behaviourPenalty;return l+=f*t.behaviourPenaltyWeight,i+=a+c+l,{byTopic:o,p5w:a,p6w:c,p7w:l,score:i}}function LT(r,e,t,n,s){let i={byTopic:new Map,p5w:[],p6w:[],p7w:[],score:[]};for(let o of r){let a=e.get(o);if(a){let c=IQ(o,a,t,n,s);for(let[l,u]of c.byTopic){let f=i.byTopic.get(l);f||(f={p1w:[],p2w:[],p3w:[],p3bw:[],p4w:[]},i.byTopic.set(l,f)),f.p1w.push(u.p1w),f.p2w.push(u.p2w),f.p3w.push(u.p3w),f.p3bw.push(u.p3bw),f.p4w.push(u.p4w)}i.p5w.push(c.p5w),i.p6w.push(c.p6w),i.p7w.push(c.p7w),i.score.push(c.score)}else i.p5w.push(0),i.p6w.push(0),i.p7w.push(0),i.score.push(0)}return i}var Cp=class{constructor(e,t,n){this.rawStream=e,this.pushable=yt({objectMode:!1}),this.closeController=new AbortController,this.maxBufferSize=n.maxBufferSize??1/0,Re(bt(this.pushable,this.closeController.signal,{returnOnAbort:!0}),s=>wt(s),this.rawStream).catch(t)}get protocol(){return this.rawStream.stat.protocol}push(e){if(this.pushable.readableLength>this.maxBufferSize)throw Error(`OutboundStream buffer full, size > ${this.maxBufferSize}`);this.pushable.push(e)}close(){this.closeController.abort(),this.pushable.return(),this.rawStream.close()}},Pp=class{constructor(e,t={}){this.rawStream=e,this.closeController=new AbortController,this.source=bt(Re(this.rawStream,n=>kt(n,t)),this.closeController.signal,{returnOnAbort:!0})}close(){this.closeController.abort(),this.rawStream.close()}};var BT=W(A8(),1),MT={maxSubscriptions:1/0,maxMessages:1/0,maxIhaveMessageIDs:1/0,maxIwantMessageIDs:1/0,maxControlMessages:1/0,maxPeerInfos:1/0};function UT(r,e){e={...e};let t=BT.default.Reader.create(r),n=r.length,s=n===void 0?t.len:t.pos+n,i={};for(;t.pos<s;){let o=t.uint32();switch(o>>>3){case 1:i.subscriptions&&i.subscriptions.length||(i.subscriptions=[]),i.subscriptions.length<e.maxSubscriptions?i.subscriptions.push(TQ(t,t.uint32())):t.skipType(o&7);break;case 2:i.messages&&i.messages.length||(i.messages=[]),i.messages.length<e.maxMessages?i.messages.push(DQ(t,t.uint32())):t.skipType(o&7);break;case 3:i.control=CQ(t,t.uint32(),e);break;default:t.skipType(o&7);break}}return i}function TQ(r,e){let t=e===void 0?r.len:r.pos+e,n={};for(;r.pos<t;){let s=r.uint32();switch(s>>>3){case 1:n.subscribe=r.bool();break;case 2:n.topic=r.string();break;default:r.skipType(s&7);break}}return n}function DQ(r,e){let t=e===void 0?r.len:r.pos+e,n={};for(;r.pos<t;){let s=r.uint32();switch(s>>>3){case 1:n.from=r.bytes();break;case 2:n.data=r.bytes();break;case 3:n.seqno=r.bytes();break;case 4:n.topic=r.string();break;case 5:n.signature=r.bytes();break;case 6:n.key=r.bytes();break;default:r.skipType(s&7);break}}if(!n.topic)throw Error("missing required 'topic'");return n}function CQ(r,e,t){let n=e===void 0?r.len:r.pos+e,s={};for(;r.pos<n;){let i=r.uint32();switch(i>>>3){case 1:s.ihave&&s.ihave.length||(s.ihave=[]),s.ihave.length<t.maxControlMessages?s.ihave.push(PQ(r,r.uint32(),t)):r.skipType(i&7);break;case 2:s.iwant&&s.iwant.length||(s.iwant=[]),s.iwant.length<t.maxControlMessages?s.iwant.push(kQ(r,r.uint32(),t)):r.skipType(i&7);break;case 3:s.graft&&s.graft.length||(s.graft=[]),s.graft.length<t.maxControlMessages?s.graft.push(NQ(r,r.uint32())):r.skipType(i&7);break;case 4:s.prune&&s.prune.length||(s.prune=[]),s.prune.length<t.maxControlMessages?s.prune.push(OQ(r,r.uint32(),t)):r.skipType(i&7);break;default:r.skipType(i&7);break}}return s}function PQ(r,e,t){let n=e===void 0?r.len:r.pos+e,s={};for(;r.pos<n;){let i=r.uint32();switch(i>>>3){case 1:s.topicID=r.string();break;case 2:s.messageIDs&&s.messageIDs.length||(s.messageIDs=[]),t.maxIhaveMessageIDs-- >0?s.messageIDs.push(r.bytes()):r.skipType(i&7);break;default:r.skipType(i&7);break}}return s}function kQ(r,e,t){let n=e===void 0?r.len:r.pos+e,s={};for(;r.pos<n;){let i=r.uint32();switch(i>>>3){case 1:s.messageIDs&&s.messageIDs.length||(s.messageIDs=[]),t.maxIwantMessageIDs-- >0?s.messageIDs.push(r.bytes()):r.skipType(i&7);break;default:r.skipType(i&7);break}}return s}function NQ(r,e){let t=e===void 0?r.len:r.pos+e,n={};for(;r.pos<t;){let s=r.uint32();switch(s>>>3){case 1:n.topicID=r.string();break;default:r.skipType(s&7);break}}return n}function OQ(r,e,t){let n=e===void 0?r.len:r.pos+e,s={};for(;r.pos<n;){let i=r.uint32();switch(i>>>3){case 1:s.topicID=r.string();break;case 2:s.peers&&s.peers.length||(s.peers=[]),t.maxPeerInfos-- >0?s.peers.push(LQ(r,r.uint32())):r.skipType(i&7);break;case 3:s.backoff=r.uint64();break;default:r.skipType(i&7);break}}return s}function LQ(r,e){let t=e===void 0?r.len:r.pos+e,n={};for(;r.pos<t;){let s=r.uint32();switch(s>>>3){case 1:n.peerID=r.bytes();break;case 2:n.signedPeerRecord=r.bytes();break;default:r.skipType(s&7);break}}return n}var kp;(function(r){r[r.ip4=4]="ip4",r[r.ip6=41]="ip6"})(kp||(kp={}));function FT(r){for(let e of r.tuples())switch(e[0]){case kp.ip4:case kp.ip6:return Vf(e[0],e[1])}return null}var _n;(function(r){r[r.started=0]="started",r[r.stopped=1]="stopped"})(_n||(_n={}));var Np=class extends $e{constructor(e,t={}){super(),this.multicodecs=[T8,I8],this.peers=new Set,this.streamsInbound=new Map,this.streamsOutbound=new Map,this.outboundInflightQueue=yt({objectMode:!0}),this.direct=new Set,this.floodsubPeers=new Set,this.acceptFromWhitelist=new Map,this.topics=new Map,this.subscriptions=new Set,this.mesh=new Map,this.fanout=new Map,this.fanoutLastpub=new Map,this.gossip=new Map,this.control=new Map,this.peerhave=new Map,this.iasked=new Map,this.backoff=new Map,this.outbound=new Map,this.topicValidators=new Map,this.heartbeatTicks=0,this.directPeerInitial=null,this.status={code:_n.stopped},this.heartbeatTimer=null,this.runHeartbeat=()=>{let s=this.metrics?.heartbeatDuration.startTimer();this.heartbeat().catch(i=>{this.log("Error running heartbeat",i)}).finally(()=>{if(s?.(),this.status.code===_n.started){clearTimeout(this.status.heartbeatTimeout);let i=this.opts.heartbeatInterval-(Date.now()-this.status.hearbeatStartMs)%this.opts.heartbeatInterval;i<this.opts.heartbeatInterval*.25&&(i+=this.opts.heartbeatInterval,this.metrics?.heartbeatSkipped.inc()),this.status.heartbeatTimeout=setTimeout(this.runHeartbeat,i)}})};let n={fallbackToFloodsub:!0,floodPublish:!0,doPX:!1,directPeers:[],D:6,Dlo:4,Dhi:12,Dscore:4,Dout:2,Dlazy:6,heartbeatInterval:1e3,fanoutTTL:6e4,mcacheLength:5,mcacheGossip:3,seenTTL:12e4,gossipsubIWantFollowupMs:3e3,prunePeers:16,pruneBackoff:6e4,graftFloodThreshold:1e4,opportunisticGraftPeers:2,opportunisticGraftTicks:60,directConnectTicks:300,...t,scoreParams:uT(t.scoreParams),scoreThresholds:hT(t.scoreThresholds)};if(this.components=e,this.decodeRpcLimits=n.decodeRpcLimits??MT,this.globalSignaturePolicy=n.globalSignaturePolicy??Da,n.fallbackToFloodsub&&this.multicodecs.push(R8),this.log=C(n.debugName??"libp2p:gossipsub"),this.opts=n,this.direct=new Set(n.directPeers.map(s=>s.id.toString())),this.seenCache=new gl({validityMs:n.seenTTL}),this.publishedMessageIds=new gl({validityMs:n.seenTTL}),t.msgIdFn)this.msgIdFn=t.msgIdFn;else switch(this.globalSignaturePolicy){case Da:this.msgIdFn=NT;break;case pl:this.msgIdFn=OT;break}if(t.fastMsgIdFn&&(this.fastMsgIdFn=t.fastMsgIdFn,this.fastMsgIdCache=new gl({validityMs:n.seenTTL})),this.msgIdToStrFn=t.msgIdToStrFn??cT,this.mcache=t.messageCache||new vp(n.mcacheGossip,n.mcacheLength,this.msgIdToStrFn),t.dataTransform&&(this.dataTransform=t.dataTransform),t.metricsRegister){if(!t.metricsTopicStrToLabel)throw Error("Must set metricsTopicStrToLabel with metrics");let s=Math.max(...Object.values(n.scoreParams.topics).map(o=>o.meshMessageDeliveriesWindow),1e3),i=wT(t.metricsRegister,t.metricsTopicStrToLabel,{gossipPromiseExpireSec:this.opts.gossipsubIWantFollowupMs/1e3,behaviourPenaltyThreshold:n.scoreParams.behaviourPenaltyThreshold,maxMeshMessageDeliveriesWindowSec:s/1e3});i.mcacheSize.addCollect(()=>this.onScrapeMetrics(i));for(let o of this.multicodecs)i.protocolsEnabled.set({protocol:o},1);this.metrics=i}else this.metrics=null;this.gossipTracer=new Dp(this.opts.gossipsubIWantFollowupMs,this.msgIdToStrFn,this.metrics),this.score=new Tp(this.opts.scoreParams,this.metrics,{scoreCacheValidityMs:n.heartbeatInterval}),this.maxInboundStreams=t.maxInboundStreams,this.maxOutboundStreams=t.maxOutboundStreams,this.allowedTopics=n.allowedTopics?new Set(n.allowedTopics):null}getPeers(){return[...this.peers.keys()].map(e=>he(e))}isStarted(){return this.status.code===_n.started}async start(){if(this.isStarted())return;this.log("starting"),this.publishConfig=await C8(this.globalSignaturePolicy,this.components.peerId),this.outboundInflightQueue=yt({objectMode:!0}),Re(this.outboundInflightQueue,async i=>{for await(let{peerId:o,connection:a}of i)await this.createOutboundStream(o,a)}).catch(i=>this.log.error("outbound inflight queue error",i)),await Promise.all(this.opts.directPeers.map(async i=>{await this.components.peerStore.merge(i.id,{multiaddrs:i.addrs})}));let e=this.components.registrar;await Promise.all(this.multicodecs.map(i=>e.handle(i,this.onIncomingStream.bind(this),{maxInboundStreams:this.maxInboundStreams,maxOutboundStreams:this.maxOutboundStreams})));let t=Fi({onConnect:this.onPeerConnected.bind(this),onDisconnect:this.onPeerDisconnected.bind(this)}),n=await Promise.all(this.multicodecs.map(i=>e.register(i,t))),s=setTimeout(this.runHeartbeat,100);this.status={code:_n.started,registrarTopologyIds:n,heartbeatTimeout:s,hearbeatStartMs:Date.now()+100},this.score.start(),this.directPeerInitial=setTimeout(()=>{Promise.resolve().then(async()=>{await Promise.all(Array.from(this.direct).map(async i=>await this.connect(i)))}).catch(i=>{this.log(i)})},1e3),this.log("started")}async stop(){if(this.log("stopping"),this.status.code!==_n.started)return;let{registrarTopologyIds:e}=this.status;this.status={code:_n.stopped};let t=this.components.registrar;await Promise.all(this.multicodecs.map(n=>t.unhandle(n))),e.forEach(n=>t.unregister(n)),this.outboundInflightQueue.end();for(let n of this.streamsOutbound.values())n.close();this.streamsOutbound.clear();for(let n of this.streamsInbound.values())n.close();this.streamsInbound.clear(),this.peers.clear(),this.subscriptions.clear(),this.heartbeatTimer&&(this.heartbeatTimer.cancel(),this.heartbeatTimer=null),this.score.stop(),this.mesh.clear(),this.fanout.clear(),this.fanoutLastpub.clear(),this.gossip.clear(),this.control.clear(),this.peerhave.clear(),this.iasked.clear(),this.backoff.clear(),this.outbound.clear(),this.gossipTracer.clear(),this.seenCache.clear(),this.fastMsgIdCache&&this.fastMsgIdCache.clear(),this.directPeerInitial&&clearTimeout(this.directPeerInitial),this.log("stopped")}dumpPeerScoreStats(){return this.score.dumpPeerScoreStats()}onIncomingStream({stream:e,connection:t}){if(!this.isStarted())return;let n=t.remotePeer;this.addPeer(n,t.stat.direction,t.remoteAddr),this.createInboundStream(n,e),this.outboundInflightQueue.push({peerId:n,connection:t})}onPeerConnected(e,t){this.metrics?.newConnectionCount.inc({status:t.stat.status}),!(!this.isStarted()||t.stat.status!=="OPEN")&&(this.addPeer(e,t.stat.direction,t.remoteAddr),this.outboundInflightQueue.push({peerId:e,connection:t}))}onPeerDisconnected(e){this.log("connection ended %p",e),this.removePeer(e)}async createOutboundStream(e,t){if(!this.isStarted())return;let n=e.toString();if(this.peers.has(n)&&!this.streamsOutbound.has(n))try{let s=new Cp(await t.newStream(this.multicodecs),o=>this.log.error("outbound pipe error",o),{maxBufferSize:this.opts.maxOutboundBufferSize});this.log("create outbound stream %p",e),this.streamsOutbound.set(n,s);let i=s.protocol;i===R8&&this.floodsubPeers.add(n),this.metrics?.peersPerProtocol.inc({protocol:i},1),this.subscriptions.size>0&&(this.log("send subscriptions to",n),this.sendSubscriptions(n,Array.from(this.subscriptions),!0))}catch(s){this.log.error("createOutboundStream error",s)}}async createInboundStream(e,t){if(!this.isStarted())return;let n=e.toString();if(!this.peers.has(n))return;let s=this.streamsInbound.get(n);s!==void 0&&(this.log("replacing existing inbound steam %s",n),s.close()),this.log("create inbound stream %s",n);let i=new Pp(t,{maxDataLength:this.opts.maxInboundDataLength});this.streamsInbound.set(n,i),this.pipePeerReadStream(e,i.source).catch(o=>this.log(o))}addPeer(e,t,n){let s=e.toString();if(!this.peers.has(s)){this.log("new peer %p",e),this.peers.add(s),this.score.addPeer(s);let i=FT(n);i!==null?this.score.addIP(s,i):this.log("Added peer has no IP in current address %s %s",s,n.toString()),this.outbound.has(s)||this.outbound.set(s,t==="outbound")}}removePeer(e){let t=e.toString();if(!this.peers.has(t))return;this.log("delete peer %p",e),this.peers.delete(t);let n=this.streamsOutbound.get(t),s=this.streamsInbound.get(t);n&&this.metrics?.peersPerProtocol.inc({protocol:n.protocol},-1),n?.close(),s?.close(),this.streamsOutbound.delete(t),this.streamsInbound.delete(t);for(let i of this.topics.values())i.delete(t);for(let[i,o]of this.mesh)o.delete(t)===!0&&this.metrics?.onRemoveFromMesh(i,Ca.Dc,1);for(let i of this.fanout.values())i.delete(t);this.floodsubPeers.delete(t),this.gossip.delete(t),this.control.delete(t),this.outbound.delete(t),this.score.removePeer(t),this.acceptFromWhitelist.delete(t)}get started(){return this.status.code===_n.started}getMeshPeers(e){let t=this.mesh.get(e);return t?Array.from(t):[]}getSubscribers(e){let t=this.topics.get(e);return(t?Array.from(t):[]).map(n=>he(n))}getTopics(){return Array.from(this.subscriptions)}async pipePeerReadStream(e,t){try{await Re(t,async n=>{for await(let s of n)try{let i=s.subarray(),o=UT(i,this.decodeRpcLimits);if(this.metrics?.onRpcRecv(o,i.length),this.opts.awaitRpcHandler)try{await this.handleReceivedRpc(e,o)}catch(a){this.metrics?.onRpcRecvError(),this.log(a)}else this.handleReceivedRpc(e,o).catch(a=>{this.metrics?.onRpcRecvError(),this.log(a)})}catch(i){this.metrics?.onRpcDataError(),this.log(i)}})}catch(n){this.metrics?.onPeerReadStreamError(),this.handlePeerReadStreamError(n,e)}}handlePeerReadStreamError(e,t){this.log.error(e),this.onPeerDisconnected(t)}async handleReceivedRpc(e,t){if(!this.acceptFrom(e.toString())){this.log("received message from unacceptable peer %p",e),this.metrics?.rpcRecvNotAccepted.inc();return}let n=t.subscriptions?t.subscriptions.length:0,s=t.messages?t.messages.length:0,i=0,o=0,a=0,c=0;if(t.control&&(t.control.ihave&&(i=t.control.ihave.length),t.control.iwant&&(o=t.control.iwant.length),t.control.graft&&(a=t.control.graft.length),t.control.prune&&(c=t.control.prune.length)),this.log(`rpc.from ${e.toString()} subscriptions ${n} messages ${s} ihave ${i} iwant ${o} graft ${a} prune ${c}`),t.subscriptions&&t.subscriptions.length>0){let l=[];t.subscriptions.forEach(u=>{let f=u.topic,h=u.subscribe===!0;if(f!=null){if(this.allowedTopics&&!this.allowedTopics.has(f))return;this.handleReceivedSubscription(e,f,h),l.push({topic:f,subscribe:h})}}),this.dispatchEvent(new tt("subscription-change",{detail:{peerId:e,subscriptions:l}}))}if(t.messages)for(let l of t.messages){if(this.allowedTopics&&!this.allowedTopics.has(l.topic))continue;let u=this.handleReceivedMessage(e,l).catch(f=>{this.metrics?.onMsgRecvError(l.topic),this.log(f)});this.opts.awaitRpcMessageHandler&&await u}t.control&&await this.handleControlMessage(e.toString(),t.control)}handleReceivedSubscription(e,t,n){this.log("subscription update from %p topic %s",e,t);let s=this.topics.get(t);s==null&&(s=new Set,this.topics.set(t,s)),n?s.add(e.toString()):s.delete(e.toString())}async handleReceivedMessage(e,t){this.metrics?.onMsgRecvPreValidation(t.topic);let n=await this.validateReceivedMessage(e,t);switch(this.metrics?.onMsgRecvResult(t.topic,n.code),n.code){case Kn.duplicate:this.score.duplicateMessage(e.toString(),n.msgIdStr,t.topic),this.gossipTracer.deliverMessage(n.msgIdStr,!0),this.mcache.observeDuplicate(n.msgIdStr,e.toString());return;case Kn.invalid:if(n.msgIdStr){let s=n.msgIdStr;this.score.rejectMessage(e.toString(),s,t.topic,n.reason),this.gossipTracer.rejectMessage(s,n.reason)}else this.score.rejectInvalidMessage(e.toString(),t.topic);this.metrics?.onMsgRecvInvalid(t.topic,n);return;case Kn.valid:this.score.validateMessage(n.messageId.msgIdStr),this.gossipTracer.deliverMessage(n.messageId.msgIdStr),this.mcache.put(n.messageId,t,!this.opts.asyncValidation),this.subscriptions.has(t.topic)&&(!this.components.peerId.equals(e)||this.opts.emitSelf)&&(super.dispatchEvent(new tt("gossipsub:message",{detail:{propagationSource:e,msgId:n.messageId.msgIdStr,msg:n.msg}})),super.dispatchEvent(new tt("message",{detail:n.msg}))),this.opts.asyncValidation||this.forwardMessage(n.messageId.msgIdStr,t,e.toString())}}async validateReceivedMessage(e,t){let n=this.fastMsgIdFn?.(t),s=n!==void 0?this.fastMsgIdCache?.get(n):void 0;if(s)return{code:Kn.duplicate,msgIdStr:s};let i=await vT(this.globalSignaturePolicy,t);if(!i.valid)return{code:Kn.invalid,reason:Br.Error,error:i.error};let o=i.message;try{this.dataTransform&&(o.data=this.dataTransform.inboundTransform(t.topic,o.data))}catch(f){return this.log("Invalid message, transform failed",f),{code:Kn.invalid,reason:Br.Error,error:Tr.TransformFailed}}let a=await this.msgIdFn(o),c=this.msgIdToStrFn(a),l={msgId:a,msgIdStr:c};if(n!==void 0&&this.fastMsgIdCache&&this.fastMsgIdCache.put(n,c)&&this.metrics?.fastMsgIdCacheCollision.inc(),this.seenCache.has(c))return{code:Kn.duplicate,msgIdStr:c};this.seenCache.put(c);let u=this.topicValidators.get(t.topic);if(u!=null){let f;try{f=await u(e,o)}catch(h){let p=h.code;p===aT&&(f=ds.Ignore),p===oT?f=ds.Reject:f=ds.Ignore}if(f!==ds.Accept)return{code:Kn.invalid,reason:D8(f),msgIdStr:c}}return{code:Kn.valid,messageId:l,msg:o}}getScore(e){return this.score.score(e)}sendSubscriptions(e,t,n){this.sendRpc(e,{subscriptions:t.map(s=>({topic:s,subscribe:n}))})}async handleControlMessage(e,t){if(t===void 0)return;let n=t.ihave?this.handleIHave(e,t.ihave):[],s=t.iwant?this.handleIWant(e,t.iwant):[],i=t.graft?await this.handleGraft(e,t.graft):[];if(t.prune&&await this.handlePrune(e,t.prune),!n.length&&!s.length&&!i.length)return;let o=this.sendRpc(e,{messages:s,control:{iwant:n,prune:i}}),a=n[0]?.messageIDs;a&&(o?this.gossipTracer.addPromise(e,a):this.metrics?.iwantPromiseUntracked.inc(1))}acceptFrom(e){if(this.direct.has(e))return!0;let t=Date.now(),n=this.acceptFromWhitelist.get(e);if(n&&n.messagesAccepted<128&&n.acceptUntil>=t)return n.messagesAccepted+=1,!0;let s=this.score.score(e);return s>=0?this.acceptFromWhitelist.set(e,{messagesAccepted:0,acceptUntil:t+1e3}):this.acceptFromWhitelist.delete(e),s>=this.opts.scoreThresholds.graylistThreshold}handleIHave(e,t){if(!t.length)return[];let n=this.score.score(e);if(n<this.opts.scoreThresholds.gossipThreshold)return this.log("IHAVE: ignoring peer %s with score below threshold [ score = %d ]",e,n),this.metrics?.ihaveRcvIgnored.inc({reason:wl.LowScore}),[];let s=(this.peerhave.get(e)??0)+1;if(this.peerhave.set(e,s),s>10)return this.log("IHAVE: peer %s has advertised too many times (%d) within this heartbeat interval; ignoring",e,s),this.metrics?.ihaveRcvIgnored.inc({reason:wl.MaxIhave}),[];let i=this.iasked.get(e)??0;if(i>=5e3)return this.log("IHAVE: peer %s has already advertised too many messages (%d); ignoring",e,i),this.metrics?.ihaveRcvIgnored.inc({reason:wl.MaxIasked}),[];let o=new Map;if(t.forEach(({topicID:l,messageIDs:u})=>{if(!l||!u||!this.mesh.has(l))return;let f=0;u.forEach(h=>{let p=this.msgIdToStrFn(h);this.seenCache.has(p)||(o.set(p,h),f++)}),this.metrics?.onIhaveRcv(l,u.length,f)}),!o.size)return[];let a=o.size;a+i>5e3&&(a=5e3-i),this.log("IHAVE: Asking for %d out of %d messages from %s",a,o.size,e);let c=Array.from(o.values());return Gs(c),c=c.slice(0,a),this.iasked.set(e,i+a),[{messageIDs:c}]}handleIWant(e,t){if(!t.length)return[];let n=this.score.score(e);if(n<this.opts.scoreThresholds.gossipThreshold)return this.log("IWANT: ignoring peer %s with score below threshold [score = %d]",e,n),[];let s=new Map,i=new Map,o=0;return t.forEach(({messageIDs:a})=>{a&&a.forEach(c=>{let l=this.msgIdToStrFn(c),u=this.mcache.getWithIWantCount(l,e);if(u==null){o++;return}if(i.set(u.msg.topic,1+(i.get(u.msg.topic)??0)),u.count>3){this.log("IWANT: Peer %s has asked for message %s too many times: ignoring request",e,c);return}s.set(l,u.msg)})}),this.metrics?.onIwantRcv(i,o),s.size?(this.log("IWANT: Sending %d messages to %s",s.size,e),Array.from(s.values())):(this.log("IWANT: Could not provide any wanted messages to %s",e),[])}async handleGraft(e,t){let n=[],s=this.score.score(e),i=Date.now(),o=this.opts.doPX;return t.forEach(({topicID:a})=>{if(!a)return;let c=this.mesh.get(a);if(!c){o=!1;return}if(c.has(e))return;if(this.direct.has(e)){this.log("GRAFT: ignoring request from direct peer %s",e),n.push(a),o=!1;return}let l=this.backoff.get(a)?.get(e);if(typeof l=="number"&&i<l){this.log("GRAFT: ignoring backed off peer %s",e),this.score.addPenalty(e,1,bl.GraftBackoff),o=!1;let u=l+this.opts.graftFloodThreshold-this.opts.pruneBackoff;i<u&&this.score.addPenalty(e,1,bl.GraftBackoff),this.addBackoff(e,a),n.push(a);return}if(s<0){this.log("GRAFT: ignoring peer %s with negative score: score=%d, topic=%s",e,s,a),n.push(a),o=!1,this.addBackoff(e,a);return}if(c.size>=this.opts.Dhi&&!this.outbound.get(e)){n.push(a),this.addBackoff(e,a);return}this.log("GRAFT: Add mesh link from %s in %s",e,a),this.score.graft(e,a),c.add(e),this.metrics?.onAddToMesh(a,Ei.Subscribed,1)}),n.length?await Promise.all(n.map(a=>this.makePrune(e,a,o))):[]}async handlePrune(e,t){let n=this.score.score(e);for(let{topicID:s,backoff:i,peers:o}of t){if(s==null)continue;let a=this.mesh.get(s);if(!a)return;if(this.log("PRUNE: Remove mesh link to %s in %s",e,s),this.score.prune(e,s),a.has(e)&&(a.delete(e),this.metrics?.onRemoveFromMesh(s,Ca.Unsub,1)),typeof i=="number"&&i>0?this.doAddBackoff(e,s,i*1e3):this.addBackoff(e,s),o&&o.length){if(n<this.opts.scoreThresholds.acceptPXThreshold){this.log("PRUNE: ignoring PX from peer %s with insufficient score [score = %d, topic = %s]",e,n,s);continue}await this.pxConnect(o)}}}addBackoff(e,t){this.doAddBackoff(e,t,this.opts.pruneBackoff)}doAddBackoff(e,t,n){let s=this.backoff.get(t);s||(s=new Map,this.backoff.set(t,s));let i=Date.now()+n;(s.get(e)??0)<i&&s.set(e,i)}applyIwantPenalties(){this.gossipTracer.getBrokenPromises().forEach((e,t)=>{this.log("peer %s didn't follow up in %d IWANT requests; adding penalty",t,e),this.score.addPenalty(t,e,bl.BrokenPromise)})}clearBackoff(){if(this.heartbeatTicks%15!==0)return;let e=Date.now();this.backoff.forEach((t,n)=>{t.forEach((s,i)=>{s<e&&t.delete(i)}),t.size===0&&this.backoff.delete(n)})}async directConnect(){let e=[];this.direct.forEach(t=>{this.streamsOutbound.has(t)||e.push(t)}),await Promise.all(e.map(async t=>await this.connect(t)))}async pxConnect(e){e.length>this.opts.prunePeers&&(Gs(e),e=e.slice(0,this.opts.prunePeers));let t=[];await Promise.all(e.map(async n=>{if(!n.peerID)return;let s=_t(n.peerID),i=s.toString();if(!this.peers.has(i)){if(!n.signedPeerRecord){t.push(i);return}try{if(!await this.components.peerStore.consumePeerRecord(n.signedPeerRecord,s)){this.log("bogus peer record obtained through px: could not add peer record to address book");return}t.push(i)}catch{this.log("bogus peer record obtained through px: invalid signature or not a peer record")}}})),t.length&&await Promise.all(t.map(async n=>await this.connect(n)))}async connect(e){this.log("Initiating connection with %s",e);let t=he(e),n=await this.components.connectionManager.openConnection(t);for(let s of this.multicodecs)for(let i of this.components.registrar.getTopologies(s))i.onConnect(t,n)}subscribe(e){if(this.status.code!==_n.started)throw new Error("Pubsub has not started");if(!this.subscriptions.has(e)){this.subscriptions.add(e);for(let t of this.peers.keys())this.sendSubscriptions(t,[e],!0)}this.join(e)}unsubscribe(e){if(this.status.code!==_n.started)throw new Error("Pubsub is not started");let t=this.subscriptions.delete(e);if(this.log("unsubscribe from %s - am subscribed %s",e,t),t)for(let n of this.peers.keys())this.sendSubscriptions(n,[e],!1);this.leave(e)}join(e){if(this.status.code!==_n.started)throw new Error("Gossipsub has not started");if(this.mesh.has(e))return;this.log("JOIN %s",e),this.metrics?.onJoin(e);let t=new Set,n=this.fanout.get(e);if(n&&(this.fanout.delete(e),this.fanoutLastpub.delete(e),n.forEach(s=>{!this.direct.has(s)&&this.score.score(s)>=0&&t.add(s)}),this.metrics?.onAddToMesh(e,Ei.Fanout,t.size)),t.size<this.opts.D){let s=t.size;this.getRandomGossipPeers(e,this.opts.D,o=>!t.has(o)&&!this.direct.has(o)&&this.score.score(o)>=0).forEach(o=>{t.add(o)}),this.metrics?.onAddToMesh(e,Ei.Random,t.size-s)}this.mesh.set(e,t),t.forEach(s=>{this.log("JOIN: Add mesh link to %s in %s",s,e),this.sendGraft(s,e)})}leave(e){if(this.status.code!==_n.started)throw new Error("Gossipsub has not started");this.log("LEAVE %s",e),this.metrics?.onLeave(e);let t=this.mesh.get(e);t&&(Promise.all(Array.from(t).map(async n=>(this.log("LEAVE: Remove mesh link to %s in %s",n,e),await this.sendPrune(n,e)))).catch(n=>{this.log("Error sending prunes to mesh peers",n)}),this.mesh.delete(e))}selectPeersToForward(e,t,n){let s=new Set,i=this.topics.get(e);i&&(this.direct.forEach(a=>{i.has(a)&&t!==a&&!n?.has(a)&&s.add(a)}),this.floodsubPeers.forEach(a=>{i.has(a)&&t!==a&&!n?.has(a)&&this.score.score(a)>=this.opts.scoreThresholds.publishThreshold&&s.add(a)}));let o=this.mesh.get(e);return o&&o.size>0&&o.forEach(a=>{t!==a&&!n?.has(a)&&s.add(a)}),s}selectPeersToPublish(e){let t=new Set,n={direct:0,floodsub:0,mesh:0,fanout:0},s=this.topics.get(e);if(s)if(this.opts.floodPublish)s.forEach(i=>{this.direct.has(i)?(t.add(i),n.direct++):this.score.score(i)>=this.opts.scoreThresholds.publishThreshold&&(t.add(i),n.floodsub++)});else{this.direct.forEach(o=>{s.has(o)&&(t.add(o),n.direct++)}),this.floodsubPeers.forEach(o=>{s.has(o)&&this.score.score(o)>=this.opts.scoreThresholds.publishThreshold&&(t.add(o),n.floodsub++)});let i=this.mesh.get(e);if(i&&i.size>0)i.forEach(o=>{t.add(o),n.mesh++});else{let o=this.fanout.get(e);if(o&&o.size>0)o.forEach(a=>{t.add(a),n.fanout++});else{let a=this.getRandomGossipPeers(e,this.opts.D,c=>this.score.score(c)>=this.opts.scoreThresholds.publishThreshold);a.size>0&&(this.fanout.set(e,a),a.forEach(c=>{t.add(c),n.fanout++}))}this.fanoutLastpub.set(e,Date.now())}}return{tosend:t,tosendCount:n}}forwardMessage(e,t,n,s){n&&this.score.deliverMessage(n,e,t.topic);let i=this.selectPeersToForward(t.topic,n,s);i.forEach(o=>{this.sendRpc(o,{messages:[t]})}),this.metrics?.onForwardMsg(t.topic,i.size)}async publish(e,t,n){let s=this.dataTransform?this.dataTransform.outboundTransform(e,t):t;if(this.publishConfig==null)throw Error("PublishError.Uninitialized");let{raw:i,msg:o}=await ET(this.publishConfig,e,t,s),a=await this.msgIdFn(o),c=this.msgIdToStrFn(a),l=n?.ignoreDuplicatePublishError??this.opts.ignoreDuplicatePublishError;if(this.seenCache.has(c)){if(l)return this.metrics?.onPublishDuplicateMsg(e),{recipients:[]};throw Error("PublishError.Duplicate")}let{tosend:u,tosendCount:f}=this.selectPeersToPublish(e),h=this.opts.emitSelf===!0&&this.subscriptions.has(e),p=n?.allowPublishToZeroPeers??this.opts.allowPublishToZeroPeers;if(u.size===0&&!p&&!h)throw Error("PublishError.InsufficientPeers");this.seenCache.put(c),this.mcache.put({msgId:a,msgIdStr:c},i,!0),this.publishedMessageIds.put(c);for(let d of u)this.sendRpc(d,{messages:[i]})||u.delete(d);return this.metrics?.onPublishMsg(e,f,u.size,i.data!=null?i.data.length:0),h&&(u.add(this.components.peerId.toString()),super.dispatchEvent(new tt("gossipsub:message",{detail:{propagationSource:this.components.peerId,msgId:c,msg:o}})),super.dispatchEvent(new tt("message",{detail:o}))),{recipients:Array.from(u.values()).map(d=>he(d))}}reportMessageValidationResult(e,t,n){if(n===ds.Accept){let s=this.mcache.validate(e);if(this.metrics?.onReportValidationMcacheHit(s!==null),s!=null){let{message:i,originatingPeers:o}=s;this.score.deliverMessage(t.toString(),e,i.topic),this.forwardMessage(e,s.message,t.toString(),o),this.metrics?.onReportValidation(i.topic,n)}}else{let s=this.mcache.remove(e);if(this.metrics?.onReportValidationMcacheHit(s!==null),s){let i=D8(n),{message:o,originatingPeers:a}=s;this.score.rejectMessage(t.toString(),e,o.topic,i);for(let c of a)this.score.rejectMessage(c,e,o.topic,i);this.metrics?.onReportValidation(o.topic,n)}}}sendGraft(e,t){let n=[{topicID:t}];this.sendRpc(e,{control:{graft:n}})}async sendPrune(e,t){let n=[await this.makePrune(e,t,this.opts.doPX)];this.sendRpc(e,{control:{prune:n}})}sendRpc(e,t){let n=this.streamsOutbound.get(e);if(!n)return this.log(`Cannot send RPC to ${e} as there is no open stream to it available`),!1;let s=this.control.get(e);s&&(this.piggybackControl(e,t,s),this.control.delete(e));let i=this.gossip.get(e);i&&(this.piggybackGossip(e,t,i),this.gossip.delete(e));let o=nh.encode(t).finish();try{n.push(o)}catch(a){return this.log.error(`Cannot send rpc to ${e}`,a),s&&this.control.set(e,s),i&&this.gossip.set(e,i),!1}return this.metrics?.onRpcSent(t,o.length),!0}piggybackControl(e,t,n){if(n.graft){t.control||(t.control={}),t.control.graft||(t.control.graft=[]);for(let s of n.graft)s.topicID&&this.mesh.get(s.topicID)?.has(e)&&t.control.graft.push(s)}if(n.prune){t.control||(t.control={}),t.control.prune||(t.control.prune=[]);for(let s of n.prune)s.topicID&&!this.mesh.get(s.topicID)?.has(e)&&t.control.prune.push(s)}}piggybackGossip(e,t,n){t.control||(t.control={}),t.control.ihave=n}async sendGraftPrune(e,t,n){let s=this.opts.doPX;for(let[i,o]of e){let a=o.map(u=>({topicID:u})),c=[],l=t.get(i);l&&(c=await Promise.all(l.map(async u=>await this.makePrune(i,u,s&&!(n.get(i)??!1)))),t.delete(i)),this.sendRpc(i,{control:{graft:a,prune:c}})}for(let[i,o]of t){let a=await Promise.all(o.map(async c=>await this.makePrune(i,c,s&&!(n.get(i)??!1))));this.sendRpc(i,{control:{prune:a}})}}emitGossip(e){let t=this.mcache.getGossipIDs(new Set(e.keys()));for(let[n,s]of e)this.doEmitGossip(n,s,t.get(n)??[])}doEmitGossip(e,t,n){if(!n.length||(Gs(n),n.length>5e3&&this.log("too many messages for gossip; will truncate IHAVE list (%d messages)",n.length),!t.size))return;let s=this.opts.Dlazy,i=.25*t.size,o=t;i>s&&(s=i),s>o.size?s=o.size:o=Gs(Array.from(o)).slice(0,s),o.forEach(a=>{let c=n;n.length>5e3&&(c=Gs(c.slice()).slice(0,5e3)),this.pushGossip(a,{topicID:e,messageIDs:c})})}flush(){for(let[e,t]of this.gossip.entries())this.gossip.delete(e),this.sendRpc(e,{control:{ihave:t}});for(let[e,t]of this.control.entries())this.control.delete(e),this.sendRpc(e,{control:{graft:t.graft,prune:t.prune}})}pushGossip(e,t){this.log("Add gossip to %s",e);let n=this.gossip.get(e)||[];this.gossip.set(e,n.concat(t))}async makePrune(e,t,n){if(this.score.prune(e,t),this.streamsOutbound.get(e).protocol===I8)return{topicID:t,peers:[]};let s=this.opts.pruneBackoff/1e3;if(!n)return{topicID:t,peers:[],backoff:s};let i=this.getRandomGossipPeers(t,this.opts.prunePeers,a=>a!==e&&this.score.score(a)>=0),o=await Promise.all(Array.from(i).map(async a=>{let c=he(a),l;try{l=await this.components.peerStore.get(c)}catch(u){if(u.code!=="ERR_NOT_FOUND")throw u}return{peerID:c.toBytes(),signedPeerRecord:l?.peerRecordEnvelope}}));return{topicID:t,peers:o,backoff:s}}async heartbeat(){let{D:e,Dlo:t,Dhi:n,Dscore:s,Dout:i,fanoutTTL:o}=this.opts;this.heartbeatTicks++;let a=new Map,c=d=>{let m=a.get(d);return m===void 0&&(m=this.score.score(d),a.set(d,m)),m},l=new Map,u=new Map,f=new Map;this.clearBackoff(),this.peerhave.clear(),this.metrics?.cacheSize.set({cache:"iasked"},this.iasked.size),this.iasked.clear(),this.applyIwantPenalties(),this.heartbeatTicks%this.opts.directConnectTicks===0&&await this.directConnect(),this.fastMsgIdCache?.prune(),this.seenCache.prune(),this.gossipTracer.prune(),this.publishedMessageIds.prune();let h=new Map;this.mesh.forEach((d,m)=>{let g=this.topics.get(m),y=new Set,b=new Set;if(h.set(m,b),g){let x=Gs(Array.from(g)),_=this.backoff.get(m);for(let S of x){let A=this.streamsOutbound.get(S);if(A&&this.multicodecs.includes(A.protocol)&&!d.has(S)&&!this.direct.has(S)){let D=c(S);(!_||!_.has(S))&&D>=0&&y.add(S),D>=this.opts.scoreThresholds.gossipThreshold&&b.add(S)}}}let w=(x,_)=>{this.log("HEARTBEAT: Remove mesh link to %s in %s",x,m),this.addBackoff(x,m),d.delete(x),c(x)>=this.opts.scoreThresholds.gossipThreshold&&b.add(x),this.metrics?.onRemoveFromMesh(m,_,1);let S=u.get(x);S?S.push(m):u.set(x,[m])},v=(x,_)=>{this.log("HEARTBEAT: Add mesh link to %s in %s",x,m),this.score.graft(x,m),d.add(x),b.delete(x),this.metrics?.onAddToMesh(m,_,1);let S=l.get(x);S?S.push(m):l.set(x,[m])};if(d.forEach(x=>{let _=c(x);_<0&&(this.log("HEARTBEAT: Prune peer %s with negative score: score=%d, topic=%s",x,_,m),w(x,Ca.BadScore),f.set(x,!0))}),d.size<t){let x=e-d.size;yT(y,x).forEach(S=>{v(S,Ei.NotEnough)})}if(d.size>n){let x=Array.from(d);x.sort((S,A)=>c(A)-c(S)),x=x.slice(0,s).concat(Gs(x.slice(s)));let _=0;if(x.slice(0,e).forEach(S=>{this.outbound.get(S)&&_++}),_<i){let S=D=>{let H=x[D];for(let ee=D;ee>0;ee--)x[ee]=x[ee-1];x[0]=H};if(_>0){let D=_;for(let H=1;H<e&&D>0;H++)this.outbound.get(x[H])&&(S(H),D--)}let A=e-_;for(let D=e;D<x.length&&A>0;D++)this.outbound.get(x[D])&&(S(D),A--)}x.slice(e).forEach(S=>{w(S,Ca.Excess)})}if(d.size>=t){let x=0;if(d.forEach(_=>{this.outbound.get(_)&&x++}),x<i){let _=i-x;Ip(y,_,A=>this.outbound.get(A)===!0).forEach(A=>{v(A,Ei.Outbound)})}}if(this.heartbeatTicks%this.opts.opportunisticGraftTicks===0&&d.size>1){let x=Array.from(d).sort((A,D)=>c(A)-c(D)),_=Math.floor(d.size/2),S=c(x[_]);if(S<this.opts.scoreThresholds.opportunisticGraftThreshold){let A=this.opts.opportunisticGraftPeers,D=Ip(y,A,H=>c(H)>S);for(let H of D)this.log("HEARTBEAT: Opportunistically graft peer %s on topic %s",H,m),v(H,Ei.Opportunistic)}}});let p=Date.now();this.fanoutLastpub.forEach((d,m)=>{d+o<p&&(this.fanout.delete(m),this.fanoutLastpub.delete(m))}),this.fanout.forEach((d,m)=>{let g=this.topics.get(m);d.forEach(v=>{(!g.has(v)||c(v)<this.opts.scoreThresholds.publishThreshold)&&d.delete(v)});let y=this.topics.get(m),b=[],w=new Set;if(h.set(m,w),y){let v=Gs(Array.from(y));for(let x of v){let _=this.streamsOutbound.get(x);if(_&&this.multicodecs.includes(_.protocol)&&!d.has(x)&&!this.direct.has(x)){let S=c(x);S>=this.opts.scoreThresholds.publishThreshold&&b.push(x),S>=this.opts.scoreThresholds.gossipThreshold&&w.add(x)}}}if(d.size<e){let v=e-d.size;b.slice(0,v).forEach(x=>{d.add(x),w?.delete(x)})}}),this.emitGossip(h),await this.sendGraftPrune(l,u,f),this.flush(),this.mcache.shift(),this.dispatchEvent(new tt("gossipsub:heartbeat"))}getRandomGossipPeers(e,t,n=()=>!0){let s=this.topics.get(e);if(!s)return new Set;let i=[];return s.forEach(o=>{let a=this.streamsOutbound.get(o);a&&this.multicodecs.includes(a.protocol)&&n(o)&&i.push(o)}),i=Gs(i),t>0&&i.length>t&&(i=i.slice(0,t)),new Set(i)}onScrapeMetrics(e){e.mcacheSize.set(this.mcache.size),e.mcacheNotValidatedCount.set(this.mcache.notValidatedCount),e.cacheSize.set({cache:"direct"},this.direct.size),e.cacheSize.set({cache:"seenCache"},this.seenCache.size),e.cacheSize.set({cache:"fastMsgIdCache"},this.fastMsgIdCache?.size??0),e.cacheSize.set({cache:"publishedMessageIds"},this.publishedMessageIds.size),e.cacheSize.set({cache:"mcache"},this.mcache.size),e.cacheSize.set({cache:"score"},this.score.size),e.cacheSize.set({cache:"gossipTracer.promises"},this.gossipTracer.size),e.cacheSize.set({cache:"gossipTracer.requests"},this.gossipTracer.requestMsByMsgSize),e.cacheSize.set({cache:"topics"},this.topics.size),e.cacheSize.set({cache:"subscriptions"},this.subscriptions.size),e.cacheSize.set({cache:"mesh"},this.mesh.size),e.cacheSize.set({cache:"fanout"},this.fanout.size),e.cacheSize.set({cache:"peers"},this.peers.size),e.cacheSize.set({cache:"streamsOutbound"},this.streamsOutbound.size),e.cacheSize.set({cache:"streamsInbound"},this.streamsInbound.size),e.cacheSize.set({cache:"acceptFromWhitelist"},this.acceptFromWhitelist.size),e.cacheSize.set({cache:"gossip"},this.gossip.size),e.cacheSize.set({cache:"control"},this.control.size),e.cacheSize.set({cache:"peerhave"},this.peerhave.size),e.cacheSize.set({cache:"outbound"},this.outbound.size);let t=0;for(let o of this.backoff.values())t+=o.size;e.cacheSize.set({cache:"backoff"},t);for(let[o,a]of this.topics)e.topicPeersCount.set({topicStr:o},a.size);for(let[o,a]of this.mesh)e.meshPeerCounts.set({topicStr:o},a.size);let n=[],s=new Map;e.behaviourPenalty.reset();for(let o of this.peers.keys()){let a=this.score.score(o);n.push(a),s.set(o,a),e.behaviourPenalty.observe(this.score.peerStats.get(o)?.behaviourPenalty??0)}e.registerScores(n,this.opts.scoreThresholds),e.registerScorePerMesh(this.mesh,s);let i=LT(this.peers.keys(),this.score.peerStats,this.score.params,this.score.peerIPs,e.topicStrToLabel);e.registerScoreWeights(i)}};Np.multicodec=T8;function zT(r={}){return e=>new Np(e,r)}function W8(){let r=De(),e=!1;return{sink:async t=>{if(e)throw new Error("already piped");e=!0,r.resolve(t)},source:async function*(){yield*await r.promise}()}}function qT(){let r=W8(),e=W8();return[{source:r.source,sink:e.sink},{source:e.source,sink:r.sink}]}var Op=W(Ko(),1);var KT=r=>un.decode(r);KT.bytes=0;function jr(r,e){let t=yt();r.sink(t).catch(o=>{t.end(o)}),r.sink=async o=>{for await(let a of o)t.push(a);t.end()};let n=r.source;r.source[Symbol.iterator]!=null?n=r.source[Symbol.iterator]():r.source[Symbol.asyncIterator]!=null&&(n=r.source[Symbol.asyncIterator]());let s=new ye,i={read:async o=>{if(o==null){let{done:c,value:l}=await n.next();return c===!0?new ye:l}for(;s.byteLength<o;){let{value:c,done:l}=await n.next();if(l===!0)throw(0,Op.default)(new Error("unexpected end of input"),"ERR_UNEXPECTED_EOF");s.append(c)}let a=s.sublist(0,o);return s.consume(o),a},readLP:async()=>{let o=-1,a=new ye,c=e?.lengthDecoder??KT;for(;;){a.append(await i.read(1));try{o=c(a)}catch(l){if(l instanceof RangeError)continue;throw l}if(o>-1)break;if(e?.maxLengthLength!=null&&a.byteLength>e.maxLengthLength)throw(0,Op.default)(new Error("message length length too long"),"ERR_MSG_LENGTH_TOO_LONG")}if(e?.maxDataLength!=null&&o>e.maxDataLength)throw(0,Op.default)(new Error("message length too long"),"ERR_MSG_DATA_TOO_LONG");return i.read(o)},readPB:async o=>{let a=await i.readLP();if(a==null)throw new Error("Value is null");let c=a instanceof Uint8Array?a:a.subarray();return o.decode(c)},write:o=>{o instanceof Uint8Array?t.push(o):t.push(o.subarray())},writeLP:o=>{i.write(wt.single(o,e))},writePB:(o,a)=>{i.writeLP(a.encode(o))},pb:o=>({read:async()=>i.readPB(o),write:a=>{i.writePB(a,o)},unwrap:()=>i}),unwrap:()=>{let o=r.source;return r.source=async function*(){yield*s,yield*o}(),r}};return i}var $T=!!globalThis.process?.env?.DUMP_SESSION_KEYS;var lX=r=>r instanceof Uint8Array;var $n=r=>new Uint32Array(r.buffer,r.byteOffset,Math.floor(r.byteLength/4)),HT=r=>new DataView(r.buffer,r.byteOffset,r.byteLength),uX=new Uint8Array(new Uint32Array([287454020]).buffer)[0]===68;if(!uX)throw new Error("Non little-endian hardware is not supported");function Lp(r){if(typeof r!="string")throw new Error(`utf8ToBytes expected string, got ${typeof r}`);return new Uint8Array(new TextEncoder().encode(r))}function Bp(r){if(typeof r=="string"&&(r=Lp(r)),!lX(r))throw new Error(`expected Uint8Array, got ${typeof r}`);return r}var fX=r=>Object.prototype.toString.call(r)==="[object Object]"&&r.constructor===Object;function GT(r,e){if(e!==void 0&&(typeof e!="object"||!fX(e)))throw new Error("Options should be object or undefined");return Object.assign(r,e)}function sh(r,e){if(!(r instanceof Uint8Array))throw new Error("Uint8Array expected");if(typeof e=="number"&&r.length!==e)throw new Error(`Uint8Array length ${e} expected`)}function WT(r,e){if(r.length!==e.length)throw new Error("equalBytes: Different size of Uint8Arrays");let t=!0;for(let n=0;n<r.length;n++)t&&(t=r[n]===e[n]);return t}function Y8(r,e,t,n){if(typeof r.setBigUint64=="function")return r.setBigUint64(e,t,n);let s=BigInt(32),i=BigInt(4294967295),o=Number(t>>s&i),a=Number(t&i),c=n?4:0,l=n?0:4;r.setUint32(e+c,o,n),r.setUint32(e+l,a,n)}function Q8(r){if(!Number.isSafeInteger(r)||r<0)throw new Error(`Wrong positive integer: ${r}`)}function hX(r){if(typeof r!="boolean")throw new Error(`Expected boolean, not ${r}`)}function YT(r,...e){if(!(r instanceof Uint8Array))throw new Error("Expected Uint8Array");if(e.length>0&&!e.includes(r.length))throw new Error(`Expected Uint8Array of length ${e}, not of length=${r.length}`)}function dX(r){if(typeof r!="function"||typeof r.create!="function")throw new Error("Hash should be wrapped by utils.wrapConstructor");Q8(r.outputLen),Q8(r.blockLen)}function pX(r,e=!0){if(r.destroyed)throw new Error("Hash instance has been destroyed");if(e&&r.finished)throw new Error("Hash#digest() has already been called")}function mX(r,e){YT(r);let t=e.outputLen;if(r.length<t)throw new Error(`digestInto() expects output buffer of length at least ${t}`)}var gX={number:Q8,bool:hX,bytes:YT,hash:dX,exists:pX,output:mX},Ur=gX;var wr=(r,e)=>r[e++]&255|(r[e++]&255)<<8,X8=class{constructor(e){this.blockLen=16,this.outputLen=16,this.buffer=new Uint8Array(16),this.r=new Uint16Array(10),this.h=new Uint16Array(10),this.pad=new Uint16Array(8),this.pos=0,this.finished=!1,e=Bp(e),sh(e,32);let t=wr(e,0),n=wr(e,2),s=wr(e,4),i=wr(e,6),o=wr(e,8),a=wr(e,10),c=wr(e,12),l=wr(e,14);this.r[0]=t&8191,this.r[1]=(t>>>13|n<<3)&8191,this.r[2]=(n>>>10|s<<6)&7939,this.r[3]=(s>>>7|i<<9)&8191,this.r[4]=(i>>>4|o<<12)&255,this.r[5]=o>>>1&8190,this.r[6]=(o>>>14|a<<2)&8191,this.r[7]=(a>>>11|c<<5)&8065,this.r[8]=(c>>>8|l<<8)&8191,this.r[9]=l>>>5&127;for(let u=0;u<8;u++)this.pad[u]=wr(e,16+2*u)}process(e,t,n=!1){let s=n?0:2048,{h:i,r:o}=this,a=o[0],c=o[1],l=o[2],u=o[3],f=o[4],h=o[5],p=o[6],d=o[7],m=o[8],g=o[9],y=wr(e,t+0),b=wr(e,t+2),w=wr(e,t+4),v=wr(e,t+6),x=wr(e,t+8),_=wr(e,t+10),S=wr(e,t+12),A=wr(e,t+14),D=i[0]+(y&8191),H=i[1]+((y>>>13|b<<3)&8191),ee=i[2]+((b>>>10|w<<6)&8191),j=i[3]+((w>>>7|v<<9)&8191),ie=i[4]+((v>>>4|x<<12)&8191),Ie=i[5]+(x>>>1&8191),le=i[6]+((x>>>14|_<<2)&8191),we=i[7]+((_>>>11|S<<5)&8191),V=i[8]+((S>>>8|A<<8)&8191),F=i[9]+(A>>>5|s),P=0,K=P+D*a+H*(5*g)+ee*(5*m)+j*(5*d)+ie*(5*p);P=K>>>13,K&=8191,K+=Ie*(5*h)+le*(5*f)+we*(5*u)+V*(5*l)+F*(5*c),P+=K>>>13,K&=8191;let J=P+D*c+H*a+ee*(5*g)+j*(5*m)+ie*(5*d);P=J>>>13,J&=8191,J+=Ie*(5*p)+le*(5*h)+we*(5*f)+V*(5*u)+F*(5*l),P+=J>>>13,J&=8191;let oe=P+D*l+H*c+ee*a+j*(5*g)+ie*(5*m);P=oe>>>13,oe&=8191,oe+=Ie*(5*d)+le*(5*p)+we*(5*h)+V*(5*f)+F*(5*u),P+=oe>>>13,oe&=8191;let ve=P+D*u+H*l+ee*c+j*a+ie*(5*g);P=ve>>>13,ve&=8191,ve+=Ie*(5*m)+le*(5*d)+we*(5*p)+V*(5*h)+F*(5*f),P+=ve>>>13,ve&=8191;let ke=P+D*f+H*u+ee*l+j*c+ie*a;P=ke>>>13,ke&=8191,ke+=Ie*(5*g)+le*(5*m)+we*(5*d)+V*(5*p)+F*(5*h),P+=ke>>>13,ke&=8191;let Ge=P+D*h+H*f+ee*u+j*l+ie*c;P=Ge>>>13,Ge&=8191,Ge+=Ie*a+le*(5*g)+we*(5*m)+V*(5*d)+F*(5*p),P+=Ge>>>13,Ge&=8191;let Te=P+D*p+H*h+ee*f+j*u+ie*l;P=Te>>>13,Te&=8191,Te+=Ie*c+le*a+we*(5*g)+V*(5*m)+F*(5*d),P+=Te>>>13,Te&=8191;let Fe=P+D*d+H*p+ee*h+j*f+ie*u;P=Fe>>>13,Fe&=8191,Fe+=Ie*l+le*c+we*a+V*(5*g)+F*(5*m),P+=Fe>>>13,Fe&=8191;let Rt=P+D*m+H*d+ee*p+j*h+ie*f;P=Rt>>>13,Rt&=8191,Rt+=Ie*u+le*l+we*c+V*a+F*(5*g),P+=Rt>>>13,Rt&=8191;let zt=P+D*g+H*m+ee*d+j*p+ie*h;P=zt>>>13,zt&=8191,zt+=Ie*f+le*u+we*l+V*c+F*a,P+=zt>>>13,zt&=8191,P=(P<<2)+P|0,P=P+K|0,K=P&8191,P=P>>>13,J+=P,i[0]=K,i[1]=J,i[2]=oe,i[3]=ve,i[4]=ke,i[5]=Ge,i[6]=Te,i[7]=Fe,i[8]=Rt,i[9]=zt}finalize(){let{h:e,pad:t}=this,n=new Uint16Array(10),s=e[1]>>>13;e[1]&=8191;for(let a=2;a<10;a++)e[a]+=s,s=e[a]>>>13,e[a]&=8191;e[0]+=s*5,s=e[0]>>>13,e[0]&=8191,e[1]+=s,s=e[1]>>>13,e[1]&=8191,e[2]+=s,n[0]=e[0]+5,s=n[0]>>>13,n[0]&=8191;for(let a=1;a<10;a++)n[a]=e[a]+s,s=n[a]>>>13,n[a]&=8191;n[9]-=8192;let i=(s^1)-1;for(let a=0;a<10;a++)n[a]&=i;i=~i;for(let a=0;a<10;a++)e[a]=e[a]&i|n[a];e[0]=(e[0]|e[1]<<13)&65535,e[1]=(e[1]>>>3|e[2]<<10)&65535,e[2]=(e[2]>>>6|e[3]<<7)&65535,e[3]=(e[3]>>>9|e[4]<<4)&65535,e[4]=(e[4]>>>12|e[5]<<1|e[6]<<14)&65535,e[5]=(e[6]>>>2|e[7]<<11)&65535,e[6]=(e[7]>>>5|e[8]<<8)&65535,e[7]=(e[8]>>>8|e[9]<<5)&65535;let o=e[0]+t[0];e[0]=o&65535;for(let a=1;a<8;a++)o=(e[a]+t[a]|0)+(o>>>16)|0,e[a]=o&65535}update(e){Ur.exists(this);let{buffer:t,blockLen:n}=this;e=Bp(e);let s=e.length;for(let i=0;i<s;){let o=Math.min(n-this.pos,s-i);if(o===n){for(;n<=s-i;i+=n)this.process(e,i);continue}t.set(e.subarray(i,i+o),this.pos),this.pos+=o,i+=o,this.pos===n&&(this.process(t,0,!1),this.pos=0)}return this}destroy(){this.h.fill(0),this.r.fill(0),this.buffer.fill(0),this.pad.fill(0)}digestInto(e){Ur.exists(this),Ur.output(e,this),this.finished=!0;let{buffer:t,h:n}=this,{pos:s}=this;if(s){for(t[s++]=1;s<16;s++)t[s]=0;this.process(t,0,!0)}this.finalize();let i=0;for(let o=0;o<8;o++)e[i++]=n[o]>>>0,e[i++]=n[o]>>>8;return e}digest(){let{buffer:e,outputLen:t}=this;this.digestInto(e);let n=e.slice(0,t);return this.destroy(),n}};function yX(r){let e=(n,s)=>r(s).update(Bp(n)).digest(),t=r(new Uint8Array(32));return e.outputLen=t.outputLen,e.blockLen=t.blockLen,e.create=n=>r(n),e}var QT=yX(r=>new X8(r));var bX=Lp("expand 16-byte k"),wX=Lp("expand 32-byte k"),xX=$n(bX),EX=$n(wX),XT=r=>!(r.byteOffset%4),El=r=>{let{core:e,rounds:t,counterRight:n,counterLen:s,allow128bitKeys:i,extendNonceFn:o,blockLen:a}=GT({rounds:20,counterRight:!1,counterLen:8,allow128bitKeys:!0,blockLen:64},r);Ur.number(s),Ur.number(t),Ur.number(a),Ur.bool(n),Ur.bool(i);let c=a/4;if(a%4!==0)throw new Error("Salsa/ChaCha: blockLen should be aligned to 4 bytes");return(l,u,f,h,p=0)=>{if(Ur.bytes(l),Ur.bytes(u),Ur.bytes(f),h||(h=new Uint8Array(f.length)),Ur.bytes(h),Ur.number(p),p<0||p>=2**32-1)throw new Error("Salsa/ChaCha: counter overflow");if(h.length<f.length)throw new Error(`Salsa/ChaCha: output (${h.length}) is shorter than data (${f.length})`);let d=[],m,g;if(l.length===32)m=l,g=EX;else if(l.length===16&&i)m=new Uint8Array(32),m.set(l),m.set(l,16),g=xX,d.push(m);else throw new Error(`Salsa/ChaCha: wrong key length=${l.length}, expected`);if(o){if(u.length<=16)throw new Error("Salsa/ChaCha: extended nonce should be bigger than 16 bytes");m=o(g,m,u.subarray(0,16),new Uint8Array(32)),d.push(m),u=u.subarray(16)}let y=16-s;if(u.length!==y)throw new Error(`Salsa/ChaCha: nonce should be ${y} or 16 bytes`);if(y!==12){let D=new Uint8Array(12);D.set(u,n?0:12-u.length),d.push(u=D)}let b=new Uint8Array(a),w=$n(b),v=$n(m),x=$n(u),_=XT(f)&&$n(f),S=XT(h)&&$n(h);d.push(w);let A=f.length;for(let D=0,H=p;D<A;H++){if(e(g,v,x,w,H,t),H>=2**32-1)throw new Error("Salsa/ChaCha: counter overflow");let ee=Math.min(a,A-D);if(ee===a&&S&&_){let j=D/4;if(D%4!==0)throw new Error("Salsa/ChaCha: wrong block position");for(let ie=0;ie<c;ie++)S[j+ie]=_[j+ie]^w[ie];D+=a;continue}for(let j=0;j<ee;j++)h[D+j]=f[D+j]^b[j];D+=ee}for(let D=0;D<d.length;D++)d[D].fill(0);return h}};var te=(r,e)=>r<<e|r>>>32-e;function ih(r,e,t,n,s,i=20){let o=r[0],a=r[1],c=r[2],l=r[3],u=e[0],f=e[1],h=e[2],p=e[3],d=e[4],m=e[5],g=e[6],y=e[7],b=s,w=t[0],v=t[1],x=t[2],_=o,S=a,A=c,D=l,H=u,ee=f,j=h,ie=p,Ie=d,le=m,we=g,V=y,F=b,P=w,K=v,J=x;for(let ve=0;ve<i;ve+=2)_=_+H|0,F=te(F^_,16),Ie=Ie+F|0,H=te(H^Ie,12),_=_+H|0,F=te(F^_,8),Ie=Ie+F|0,H=te(H^Ie,7),S=S+ee|0,P=te(P^S,16),le=le+P|0,ee=te(ee^le,12),S=S+ee|0,P=te(P^S,8),le=le+P|0,ee=te(ee^le,7),A=A+j|0,K=te(K^A,16),we=we+K|0,j=te(j^we,12),A=A+j|0,K=te(K^A,8),we=we+K|0,j=te(j^we,7),D=D+ie|0,J=te(J^D,16),V=V+J|0,ie=te(ie^V,12),D=D+ie|0,J=te(J^D,8),V=V+J|0,ie=te(ie^V,7),_=_+ee|0,J=te(J^_,16),we=we+J|0,ee=te(ee^we,12),_=_+ee|0,J=te(J^_,8),we=we+J|0,ee=te(ee^we,7),S=S+j|0,F=te(F^S,16),V=V+F|0,j=te(j^V,12),S=S+j|0,F=te(F^S,8),V=V+F|0,j=te(j^V,7),A=A+ie|0,P=te(P^A,16),Ie=Ie+P|0,ie=te(ie^Ie,12),A=A+ie|0,P=te(P^A,8),Ie=Ie+P|0,ie=te(ie^Ie,7),D=D+H|0,K=te(K^D,16),le=le+K|0,H=te(H^le,12),D=D+H|0,K=te(K^D,8),le=le+K|0,H=te(H^le,7);let oe=0;n[oe++]=o+_|0,n[oe++]=a+S|0,n[oe++]=c+A|0,n[oe++]=l+D|0,n[oe++]=u+H|0,n[oe++]=f+ee|0,n[oe++]=h+j|0,n[oe++]=p+ie|0,n[oe++]=d+Ie|0,n[oe++]=m+le|0,n[oe++]=g+we|0,n[oe++]=y+V|0,n[oe++]=b+F|0,n[oe++]=w+P|0,n[oe++]=v+K|0,n[oe++]=x+J|0}function vX(r,e,t,n){let s=$n(e),i=$n(t),o=$n(n),a=r[0],c=r[1],l=r[2],u=r[3],f=s[0],h=s[1],p=s[2],d=s[3],m=s[4],g=s[5],y=s[6],b=s[7],w=i[0],v=i[1],x=i[2],_=i[3];for(let S=0;S<20;S+=2)a=a+f|0,w=te(w^a,16),m=m+w|0,f=te(f^m,12),a=a+f|0,w=te(w^a,8),m=m+w|0,f=te(f^m,7),c=c+h|0,v=te(v^c,16),g=g+v|0,h=te(h^g,12),c=c+h|0,v=te(v^c,8),g=g+v|0,h=te(h^g,7),l=l+p|0,x=te(x^l,16),y=y+x|0,p=te(p^y,12),l=l+p|0,x=te(x^l,8),y=y+x|0,p=te(p^y,7),u=u+d|0,_=te(_^u,16),b=b+_|0,d=te(d^b,12),u=u+d|0,_=te(_^u,8),b=b+_|0,d=te(d^b,7),a=a+h|0,_=te(_^a,16),y=y+_|0,h=te(h^y,12),a=a+h|0,_=te(_^a,8),y=y+_|0,h=te(h^y,7),c=c+p|0,w=te(w^c,16),b=b+w|0,p=te(p^b,12),c=c+p|0,w=te(w^c,8),b=b+w|0,p=te(p^b,7),l=l+d|0,v=te(v^l,16),m=m+v|0,d=te(d^m,12),l=l+d|0,v=te(v^l,8),m=m+v|0,d=te(d^m,7),u=u+f|0,x=te(x^u,16),g=g+x|0,f=te(f^g,12),u=u+f|0,x=te(x^u,8),g=g+x|0,f=te(f^g,7);return o[0]=a,o[1]=c,o[2]=l,o[3]=u,o[4]=w,o[5]=v,o[6]=x,o[7]=_,n}var wxe=El({core:ih,counterRight:!1,counterLen:8}),_X=El({core:ih,counterRight:!1,counterLen:4,allow128bitKeys:!1}),SX=El({core:ih,counterRight:!1,counterLen:8,extendNonceFn:vX,allow128bitKeys:!1}),xxe=El({core:ih,counterRight:!1,counterLen:4,rounds:8}),Exe=El({core:ih,counterRight:!1,counterLen:4,rounds:12}),AX=new Uint8Array(16),jT=(r,e)=>{r.update(e);let t=e.length%16;t&&r.update(AX.subarray(t))},ZT=(r,e,t,n,s)=>{let i=r(e,t,new Uint8Array(32)),o=QT.create(i);s&&jT(o,s),jT(o,n);let a=new Uint8Array(16),c=HT(a);Y8(c,0,BigInt(s?s.length:0),!0),Y8(c,8,BigInt(n.length),!0),o.update(a);let l=o.digest();return i.fill(0),l},JT=r=>(e,t,n)=>(sh(e,32),sh(t),{tagLength:16,encrypt:i=>{let o=new Uint8Array(i.length+16);r(e,t,i,o,1);let a=ZT(r,e,t,o.subarray(0,-16),n);return o.set(a,i.length),o},decrypt:i=>{if(i.length<16)throw new Error("Encrypted data should be at least 16");let o=i.subarray(-16),a=i.subarray(0,-16),c=ZT(r,e,t,a,n);if(!WT(o,c))throw new Error("Wrong tag");return r(e,t,a,void 0,1)}}),j8=JT(_X),vxe=JT(SX);function Z8(r){if(!Number.isSafeInteger(r)||r<0)throw new Error(`Wrong positive integer: ${r}`)}function RX(r){if(typeof r!="boolean")throw new Error(`Expected boolean, not ${r}`)}function eD(r,...e){if(!(r instanceof Uint8Array))throw new Error("Expected Uint8Array");if(e.length>0&&!e.includes(r.length))throw new Error(`Expected Uint8Array of length ${e}, not of length=${r.length}`)}function IX(r){if(typeof r!="function"||typeof r.create!="function")throw new Error("Hash should be wrapped by utils.wrapConstructor");Z8(r.outputLen),Z8(r.blockLen)}function TX(r,e=!0){if(r.destroyed)throw new Error("Hash instance has been destroyed");if(e&&r.finished)throw new Error("Hash#digest() has already been called")}function DX(r,e){eD(r);let t=e.outputLen;if(r.length<t)throw new Error(`digestInto() expects output buffer of length at least ${t}`)}var CX={number:Z8,bool:RX,bytes:eD,hash:IX,exists:TX,output:DX},Sn=CX;var Mp=typeof globalThis=="object"&&"crypto"in globalThis?globalThis.crypto:void 0;var tD=r=>r instanceof Uint8Array;var Up=r=>new DataView(r.buffer,r.byteOffset,r.byteLength),ps=(r,e)=>r<<32-e|r>>>e,PX=new Uint8Array(new Uint32Array([287454020]).buffer)[0]===68;if(!PX)throw new Error("Non little-endian hardware is not supported");var Ixe=Array.from({length:256},(r,e)=>e.toString(16).padStart(2,"0"));function J8(r){if(typeof r!="string")throw new Error(`utf8ToBytes expected string, got ${typeof r}`);return new Uint8Array(new TextEncoder().encode(r))}function go(r){if(typeof r=="string"&&(r=J8(r)),!tD(r))throw new Error(`expected Uint8Array, got ${typeof r}`);return r}function rD(...r){let e=new Uint8Array(r.reduce((n,s)=>n+s.length,0)),t=0;return r.forEach(n=>{if(!tD(n))throw new Error("Uint8Array expected");e.set(n,t),t+=n.length}),e}var vl=class{clone(){return this._cloneInto()}};function yo(r){let e=n=>r().update(go(n)).digest(),t=r();return e.outputLen=t.outputLen,e.blockLen=t.blockLen,e.create=()=>r(),e}function e5(r=32){if(Mp&&typeof Mp.getRandomValues=="function")return Mp.getRandomValues(new Uint8Array(r));throw new Error("crypto.getRandomValues must be defined")}function kX(r,e,t,n){if(typeof r.setBigUint64=="function")return r.setBigUint64(e,t,n);let s=BigInt(32),i=BigInt(4294967295),o=Number(t>>s&i),a=Number(t&i),c=n?4:0,l=n?0:4;r.setUint32(e+c,o,n),r.setUint32(e+l,a,n)}var _l=class extends vl{constructor(e,t,n,s){super(),this.blockLen=e,this.outputLen=t,this.padOffset=n,this.isLE=s,this.finished=!1,this.length=0,this.pos=0,this.destroyed=!1,this.buffer=new Uint8Array(e),this.view=Up(this.buffer)}update(e){Sn.exists(this);let{view:t,buffer:n,blockLen:s}=this;e=go(e);let i=e.length;for(let o=0;o<i;){let a=Math.min(s-this.pos,i-o);if(a===s){let c=Up(e);for(;s<=i-o;o+=s)this.process(c,o);continue}n.set(e.subarray(o,o+a),this.pos),this.pos+=a,o+=a,this.pos===s&&(this.process(t,0),this.pos=0)}return this.length+=e.length,this.roundClean(),this}digestInto(e){Sn.exists(this),Sn.output(e,this),this.finished=!0;let{buffer:t,view:n,blockLen:s,isLE:i}=this,{pos:o}=this;t[o++]=128,this.buffer.subarray(o).fill(0),this.padOffset>s-o&&(this.process(n,0),o=0);for(let f=o;f<s;f++)t[f]=0;kX(n,s-8,BigInt(this.length*8),i),this.process(n,0);let a=Up(e),c=this.outputLen;if(c%4)throw new Error("_sha2: outputLen should be aligned to 32bit");let l=c/4,u=this.get();if(l>u.length)throw new Error("_sha2: outputLen bigger than state");for(let f=0;f<l;f++)a.setUint32(4*f,u[f],i)}digest(){let{buffer:e,outputLen:t}=this;this.digestInto(e);let n=e.slice(0,t);return this.destroy(),n}_cloneInto(e){e||(e=new this.constructor),e.set(...this.get());let{blockLen:t,buffer:n,length:s,finished:i,destroyed:o,pos:a}=this;return e.length=s,e.pos=a,e.finished=i,e.destroyed=o,s%t&&e.buffer.set(n),e}};var Fp=BigInt(4294967295),t5=BigInt(32);function nD(r,e=!1){return e?{h:Number(r&Fp),l:Number(r>>t5&Fp)}:{h:Number(r>>t5&Fp)|0,l:Number(r&Fp)|0}}function NX(r,e=!1){let t=new Uint32Array(r.length),n=new Uint32Array(r.length);for(let s=0;s<r.length;s++){let{h:i,l:o}=nD(r[s],e);[t[s],n[s]]=[i,o]}return[t,n]}var OX=(r,e)=>BigInt(r>>>0)<<t5|BigInt(e>>>0),LX=(r,e,t)=>r>>>t,BX=(r,e,t)=>r<<32-t|e>>>t,MX=(r,e,t)=>r>>>t|e<<32-t,UX=(r,e,t)=>r<<32-t|e>>>t,FX=(r,e,t)=>r<<64-t|e>>>t-32,VX=(r,e,t)=>r>>>t-32|e<<64-t,zX=(r,e)=>e,qX=(r,e)=>r,KX=(r,e,t)=>r<<t|e>>>32-t,$X=(r,e,t)=>e<<t|r>>>32-t,HX=(r,e,t)=>e<<t-32|r>>>64-t,GX=(r,e,t)=>r<<t-32|e>>>64-t;function WX(r,e,t,n){let s=(e>>>0)+(n>>>0);return{h:r+t+(s/2**32|0)|0,l:s|0}}var YX=(r,e,t)=>(r>>>0)+(e>>>0)+(t>>>0),QX=(r,e,t,n)=>e+t+n+(r/2**32|0)|0,XX=(r,e,t,n)=>(r>>>0)+(e>>>0)+(t>>>0)+(n>>>0),jX=(r,e,t,n,s)=>e+t+n+s+(r/2**32|0)|0,ZX=(r,e,t,n,s)=>(r>>>0)+(e>>>0)+(t>>>0)+(n>>>0)+(s>>>0),JX=(r,e,t,n,s,i)=>e+t+n+s+i+(r/2**32|0)|0,ej={fromBig:nD,split:NX,toBig:OX,shrSH:LX,shrSL:BX,rotrSH:MX,rotrSL:UX,rotrBH:FX,rotrBL:VX,rotr32H:zX,rotr32L:qX,rotlSH:KX,rotlSL:$X,rotlBH:HX,rotlBL:GX,add:WX,add3L:YX,add3H:QX,add4L:XX,add4H:jX,add5H:JX,add5L:ZX},Se=ej;var[tj,rj]=Se.split(["0x428a2f98d728ae22","0x7137449123ef65cd","0xb5c0fbcfec4d3b2f","0xe9b5dba58189dbbc","0x3956c25bf348b538","0x59f111f1b605d019","0x923f82a4af194f9b","0xab1c5ed5da6d8118","0xd807aa98a3030242","0x12835b0145706fbe","0x243185be4ee4b28c","0x550c7dc3d5ffb4e2","0x72be5d74f27b896f","0x80deb1fe3b1696b1","0x9bdc06a725c71235","0xc19bf174cf692694","0xe49b69c19ef14ad2","0xefbe4786384f25e3","0x0fc19dc68b8cd5b5","0x240ca1cc77ac9c65","0x2de92c6f592b0275","0x4a7484aa6ea6e483","0x5cb0a9dcbd41fbd4","0x76f988da831153b5","0x983e5152ee66dfab","0xa831c66d2db43210","0xb00327c898fb213f","0xbf597fc7beef0ee4","0xc6e00bf33da88fc2","0xd5a79147930aa725","0x06ca6351e003826f","0x142929670a0e6e70","0x27b70a8546d22ffc","0x2e1b21385c26c926","0x4d2c6dfc5ac42aed","0x53380d139d95b3df","0x650a73548baf63de","0x766a0abb3c77b2a8","0x81c2c92e47edaee6","0x92722c851482353b","0xa2bfe8a14cf10364","0xa81a664bbc423001","0xc24b8b70d0f89791","0xc76c51a30654be30","0xd192e819d6ef5218","0xd69906245565a910","0xf40e35855771202a","0x106aa07032bbd1b8","0x19a4c116b8d2d0c8","0x1e376c085141ab53","0x2748774cdf8eeb99","0x34b0bcb5e19b48a8","0x391c0cb3c5c95a63","0x4ed8aa4ae3418acb","0x5b9cca4f7763e373","0x682e6ff3d6b2b8a3","0x748f82ee5defb2fc","0x78a5636f43172f60","0x84c87814a1f0ab72","0x8cc702081a6439ec","0x90befffa23631e28","0xa4506cebde82bde9","0xbef9a3f7b2c67915","0xc67178f2e372532b","0xca273eceea26619c","0xd186b8c721c0c207","0xeada7dd6cde0eb1e","0xf57d4f7fee6ed178","0x06f067aa72176fba","0x0a637dc5a2c898a6","0x113f9804bef90dae","0x1b710b35131c471b","0x28db77f523047d84","0x32caab7b40c72493","0x3c9ebe0a15c9bebc","0x431d67c49c100d4c","0x4cc5d4becb3e42b6","0x597f299cfc657e2a","0x5fcb6fab3ad6faec","0x6c44198c4a475817"].map(r=>BigInt(r))),bo=new Uint32Array(80),wo=new Uint32Array(80),Sl=class extends _l{constructor(){super(128,64,16,!1),this.Ah=1779033703,this.Al=-205731576,this.Bh=-1150833019,this.Bl=-2067093701,this.Ch=1013904242,this.Cl=-23791573,this.Dh=-1521486534,this.Dl=1595750129,this.Eh=1359893119,this.El=-1377402159,this.Fh=-1694144372,this.Fl=725511199,this.Gh=528734635,this.Gl=-79577749,this.Hh=1541459225,this.Hl=327033209}get(){let{Ah:e,Al:t,Bh:n,Bl:s,Ch:i,Cl:o,Dh:a,Dl:c,Eh:l,El:u,Fh:f,Fl:h,Gh:p,Gl:d,Hh:m,Hl:g}=this;return[e,t,n,s,i,o,a,c,l,u,f,h,p,d,m,g]}set(e,t,n,s,i,o,a,c,l,u,f,h,p,d,m,g){this.Ah=e|0,this.Al=t|0,this.Bh=n|0,this.Bl=s|0,this.Ch=i|0,this.Cl=o|0,this.Dh=a|0,this.Dl=c|0,this.Eh=l|0,this.El=u|0,this.Fh=f|0,this.Fl=h|0,this.Gh=p|0,this.Gl=d|0,this.Hh=m|0,this.Hl=g|0}process(e,t){for(let w=0;w<16;w++,t+=4)bo[w]=e.getUint32(t),wo[w]=e.getUint32(t+=4);for(let w=16;w<80;w++){let v=bo[w-15]|0,x=wo[w-15]|0,_=Se.rotrSH(v,x,1)^Se.rotrSH(v,x,8)^Se.shrSH(v,x,7),S=Se.rotrSL(v,x,1)^Se.rotrSL(v,x,8)^Se.shrSL(v,x,7),A=bo[w-2]|0,D=wo[w-2]|0,H=Se.rotrSH(A,D,19)^Se.rotrBH(A,D,61)^Se.shrSH(A,D,6),ee=Se.rotrSL(A,D,19)^Se.rotrBL(A,D,61)^Se.shrSL(A,D,6),j=Se.add4L(S,ee,wo[w-7],wo[w-16]),ie=Se.add4H(j,_,H,bo[w-7],bo[w-16]);bo[w]=ie|0,wo[w]=j|0}let{Ah:n,Al:s,Bh:i,Bl:o,Ch:a,Cl:c,Dh:l,Dl:u,Eh:f,El:h,Fh:p,Fl:d,Gh:m,Gl:g,Hh:y,Hl:b}=this;for(let w=0;w<80;w++){let v=Se.rotrSH(f,h,14)^Se.rotrSH(f,h,18)^Se.rotrBH(f,h,41),x=Se.rotrSL(f,h,14)^Se.rotrSL(f,h,18)^Se.rotrBL(f,h,41),_=f&p^~f&m,S=h&d^~h&g,A=Se.add5L(b,x,S,rj[w],wo[w]),D=Se.add5H(A,y,v,_,tj[w],bo[w]),H=A|0,ee=Se.rotrSH(n,s,28)^Se.rotrBH(n,s,34)^Se.rotrBH(n,s,39),j=Se.rotrSL(n,s,28)^Se.rotrBL(n,s,34)^Se.rotrBL(n,s,39),ie=n&i^n&a^i&a,Ie=s&o^s&c^o&c;y=m|0,b=g|0,m=p|0,g=d|0,p=f|0,d=h|0,{h:f,l:h}=Se.add(l|0,u|0,D|0,H|0),l=a|0,u=c|0,a=i|0,c=o|0,i=n|0,o=s|0;let le=Se.add3L(H,j,Ie);n=Se.add3H(le,D,ee,ie),s=le|0}({h:n,l:s}=Se.add(this.Ah|0,this.Al|0,n|0,s|0)),{h:i,l:o}=Se.add(this.Bh|0,this.Bl|0,i|0,o|0),{h:a,l:c}=Se.add(this.Ch|0,this.Cl|0,a|0,c|0),{h:l,l:u}=Se.add(this.Dh|0,this.Dl|0,l|0,u|0),{h:f,l:h}=Se.add(this.Eh|0,this.El|0,f|0,h|0),{h:p,l:d}=Se.add(this.Fh|0,this.Fl|0,p|0,d|0),{h:m,l:g}=Se.add(this.Gh|0,this.Gl|0,m|0,g|0),{h:y,l:b}=Se.add(this.Hh|0,this.Hl|0,y|0,b|0),this.set(n,s,i,o,a,c,l,u,f,h,p,d,m,g,y,b)}roundClean(){bo.fill(0),wo.fill(0)}destroy(){this.buffer.fill(0),this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0)}},r5=class extends Sl{constructor(){super(),this.Ah=-1942145080,this.Al=424955298,this.Bh=1944164710,this.Bl=-1982016298,this.Ch=502970286,this.Cl=855612546,this.Dh=1738396948,this.Dl=1479516111,this.Eh=258812777,this.El=2077511080,this.Fh=2011393907,this.Fl=79989058,this.Gh=1067287976,this.Gl=1780299464,this.Hh=286451373,this.Hl=-1848208735,this.outputLen=28}},n5=class extends Sl{constructor(){super(),this.Ah=573645204,this.Al=-64227540,this.Bh=-1621794909,this.Bl=-934517566,this.Ch=596883563,this.Cl=1867755857,this.Dh=-1774684391,this.Dl=1497426621,this.Eh=-1775747358,this.El=-1467023389,this.Fh=-1101128155,this.Fl=1401305490,this.Gh=721525244,this.Gl=746961066,this.Hh=246885852,this.Hl=-2117784414,this.outputLen=32}},s5=class extends Sl{constructor(){super(),this.Ah=-876896931,this.Al=-1056596264,this.Bh=1654270250,this.Bl=914150663,this.Ch=-1856437926,this.Cl=812702999,this.Dh=355462360,this.Dl=-150054599,this.Eh=1731405415,this.El=-4191439,this.Fh=-1900787065,this.Fl=1750603025,this.Gh=-619958771,this.Gl=1694076839,this.Hh=1203062813,this.Hl=-1090891868,this.outputLen=48}},i5=yo(()=>new Sl),Bxe=yo(()=>new r5),Mxe=yo(()=>new n5),Uxe=yo(()=>new s5);var Vxe=BigInt(0),nj=BigInt(1),sj=BigInt(2),Vp=r=>r instanceof Uint8Array,ij=Array.from({length:256},(r,e)=>e.toString(16).padStart(2,"0"));function oh(r){if(!Vp(r))throw new Error("Uint8Array expected");let e="";for(let t=0;t<r.length;t++)e+=ij[r[t]];return e}function sD(r){if(typeof r!="string")throw new Error("hex string expected, got "+typeof r);return BigInt(r===""?"0":`0x${r}`)}function iD(r){if(typeof r!="string")throw new Error("hex string expected, got "+typeof r);let e=r.length;if(e%2)throw new Error("padded hex string expected, got unpadded hex of length "+e);let t=new Uint8Array(e/2);for(let n=0;n<t.length;n++){let s=n*2,i=r.slice(s,s+2),o=Number.parseInt(i,16);if(Number.isNaN(o)||o<0)throw new Error("Invalid byte sequence");t[n]=o}return t}function o5(r){return sD(oh(r))}function Ws(r){if(!Vp(r))throw new Error("Uint8Array expected");return sD(oh(Uint8Array.from(r).reverse()))}function a5(r,e){return iD(r.toString(16).padStart(e*2,"0"))}function xo(r,e){return a5(r,e).reverse()}function Zr(r,e,t){let n;if(typeof e=="string")try{n=iD(e)}catch(i){throw new Error(`${r} must be valid hex string, got "${e}". Cause: ${i}`)}else if(Vp(e))n=Uint8Array.from(e);else throw new Error(`${r} must be hex string or Uint8Array`);let s=n.length;if(typeof t=="number"&&s!==t)throw new Error(`${r} expected ${t} bytes, got ${s}`);return n}function zp(...r){let e=new Uint8Array(r.reduce((n,s)=>n+s.length,0)),t=0;return r.forEach(n=>{if(!Vp(n))throw new Error("Uint8Array expected");e.set(n,t),t+=n.length}),e}var oD=r=>(sj<<BigInt(r-1))-nj;var oj={bigint:r=>typeof r=="bigint",function:r=>typeof r=="function",boolean:r=>typeof r=="boolean",string:r=>typeof r=="string",isSafeInteger:r=>Number.isSafeInteger(r),array:r=>Array.isArray(r),field:(r,e)=>e.Fp.isValid(r),hash:r=>typeof r=="function"&&Number.isSafeInteger(r.outputLen)};function vi(r,e,t={}){let n=(s,i,o)=>{let a=oj[i];if(typeof a!="function")throw new Error(`Invalid validator "${i}", expected function`);let c=r[s];if(!(o&&c===void 0)&&!a(c,r))throw new Error(`Invalid param ${String(s)}=${c} (${typeof c}), expected ${i}`)};for(let[s,i]of Object.entries(e))n(s,i,!1);for(let[s,i]of Object.entries(t))n(s,i,!0);return r}var sr=BigInt(0),Mt=BigInt(1),Pa=BigInt(2),cj=BigInt(3),c5=BigInt(4),aD=BigInt(5),cD=BigInt(8),lj=BigInt(9),uj=BigInt(16);function pt(r,e){let t=r%e;return t>=sr?t:e+t}function l5(r,e,t){if(t<=sr||e<sr)throw new Error("Expected power/modulo > 0");if(t===Mt)return sr;let n=Mt;for(;e>sr;)e&Mt&&(n=n*r%t),r=r*r%t,e>>=Mt;return n}function Hn(r,e,t){let n=r;for(;e-- >sr;)n*=n,n%=t;return n}function lD(r,e){if(r===sr||e<=sr)throw new Error(`invert: expected positive integers, got n=${r} mod=${e}`);let t=pt(r,e),n=e,s=sr,i=Mt,o=Mt,a=sr;for(;t!==sr;){let l=n/t,u=n%t,f=s-o*l,h=i-a*l;n=t,t=u,s=o,i=a,o=f,a=h}if(n!==Mt)throw new Error("invert: does not exist");return pt(s,e)}function fj(r){let e=(r-Mt)/Pa,t,n,s;for(t=r-Mt,n=0;t%Pa===sr;t/=Pa,n++);for(s=Pa;s<r&&l5(s,e,r)!==r-Mt;s++);if(n===1){let o=(r+Mt)/c5;return function(c,l){let u=c.pow(l,o);if(!c.eql(c.sqr(u),l))throw new Error("Cannot find square root");return u}}let i=(t+Mt)/Pa;return function(a,c){if(a.pow(c,e)===a.neg(a.ONE))throw new Error("Cannot find square root");let l=n,u=a.pow(a.mul(a.ONE,s),t),f=a.pow(c,i),h=a.pow(c,t);for(;!a.eql(h,a.ONE);){if(a.eql(h,a.ZERO))return a.ZERO;let p=1;for(let m=a.sqr(h);p<l&&!a.eql(m,a.ONE);p++)m=a.sqr(m);let d=a.pow(u,Mt<<BigInt(l-p-1));u=a.sqr(d),f=a.mul(f,d),h=a.mul(h,u),l=p}return f}}function hj(r){if(r%c5===cj){let e=(r+Mt)/c5;return function(n,s){let i=n.pow(s,e);if(!n.eql(n.sqr(i),s))throw new Error("Cannot find square root");return i}}if(r%cD===aD){let e=(r-aD)/cD;return function(n,s){let i=n.mul(s,Pa),o=n.pow(i,e),a=n.mul(s,o),c=n.mul(n.mul(a,Pa),o),l=n.mul(a,n.sub(c,n.ONE));if(!n.eql(n.sqr(l),s))throw new Error("Cannot find square root");return l}}return r%uj,fj(r)}var uD=(r,e)=>(pt(r,e)&Mt)===Mt,dj=["create","isValid","is0","neg","inv","sqrt","sqr","eql","add","sub","mul","pow","div","addN","subN","mulN","sqrN"];function fD(r){let e={ORDER:"bigint",MASK:"bigint",BYTES:"isSafeInteger",BITS:"isSafeInteger"},t=dj.reduce((n,s)=>(n[s]="function",n),e);return vi(r,t)}function pj(r,e,t){if(t<sr)throw new Error("Expected power > 0");if(t===sr)return r.ONE;if(t===Mt)return e;let n=r.ONE,s=e;for(;t>sr;)t&Mt&&(n=r.mul(n,s)),s=r.sqr(s),t>>=Mt;return n}function mj(r,e){let t=new Array(e.length),n=e.reduce((i,o,a)=>r.is0(o)?i:(t[a]=i,r.mul(i,o)),r.ONE),s=r.inv(n);return e.reduceRight((i,o,a)=>r.is0(o)?i:(t[a]=r.mul(i,t[a]),r.mul(i,o)),s),t}function u5(r,e){let t=e!==void 0?e:r.toString(2).length,n=Math.ceil(t/8);return{nBitLength:t,nByteLength:n}}function hD(r,e,t=!1,n={}){if(r<=sr)throw new Error(`Expected Fp ORDER > 0, got ${r}`);let{nBitLength:s,nByteLength:i}=u5(r,e);if(i>2048)throw new Error("Field lengths over 2048 bytes are not supported");let o=hj(r),a=Object.freeze({ORDER:r,BITS:s,BYTES:i,MASK:oD(s),ZERO:sr,ONE:Mt,create:c=>pt(c,r),isValid:c=>{if(typeof c!="bigint")throw new Error(`Invalid field element: expected bigint, got ${typeof c}`);return sr<=c&&c<r},is0:c=>c===sr,isOdd:c=>(c&Mt)===Mt,neg:c=>pt(-c,r),eql:(c,l)=>c===l,sqr:c=>pt(c*c,r),add:(c,l)=>pt(c+l,r),sub:(c,l)=>pt(c-l,r),mul:(c,l)=>pt(c*l,r),pow:(c,l)=>pj(a,c,l),div:(c,l)=>pt(c*lD(l,r),r),sqrN:c=>c*c,addN:(c,l)=>c+l,subN:(c,l)=>c-l,mulN:(c,l)=>c*l,inv:c=>lD(c,r),sqrt:n.sqrt||(c=>o(a,c)),invertBatch:c=>mj(a,c),cmov:(c,l,u)=>u?l:c,toBytes:c=>t?xo(c,i):a5(c,i),fromBytes:c=>{if(c.length!==i)throw new Error(`Fp.fromBytes: expected ${i}, got ${c.length}`);return t?Ws(c):o5(c)}});return Object.freeze(a)}function dD(r,e){if(!r.isOdd)throw new Error("Field doesn't have isOdd");let t=r.sqrt(e);return r.isOdd(t)?r.neg(t):t}var gj=BigInt(0),f5=BigInt(1);function pD(r,e){let t=(s,i)=>{let o=i.negate();return s?o:i},n=s=>{let i=Math.ceil(e/s)+1,o=2**(s-1);return{windows:i,windowSize:o}};return{constTimeNegate:t,unsafeLadder(s,i){let o=r.ZERO,a=s;for(;i>gj;)i&f5&&(o=o.add(a)),a=a.double(),i>>=f5;return o},precomputeWindow(s,i){let{windows:o,windowSize:a}=n(i),c=[],l=s,u=l;for(let f=0;f<o;f++){u=l,c.push(u);for(let h=1;h<a;h++)u=u.add(l),c.push(u);l=u.double()}return c},wNAF(s,i,o){let{windows:a,windowSize:c}=n(s),l=r.ZERO,u=r.BASE,f=BigInt(2**s-1),h=2**s,p=BigInt(s);for(let d=0;d<a;d++){let m=d*c,g=Number(o&f);o>>=p,g>c&&(g-=h,o+=f5);let y=m,b=m+Math.abs(g)-1,w=d%2!==0,v=g<0;g===0?u=u.add(t(w,i[y])):l=l.add(t(v,i[b]))}return{p:l,f:u}},wNAFCached(s,i,o,a){let c=s._WINDOW_SIZE||1,l=i.get(s);return l||(l=this.precomputeWindow(s,c),c!==1&&i.set(s,a(l))),this.wNAF(c,l,o)}}}function mD(r){return fD(r.Fp),vi(r,{n:"bigint",h:"bigint",Gx:"field",Gy:"field"},{nBitLength:"isSafeInteger",nByteLength:"isSafeInteger"}),Object.freeze({...u5(r.n,r.nBitLength),...r,p:r.Fp.ORDER})}var ms=BigInt(0),An=BigInt(1),qp=BigInt(2),yj=BigInt(8),bj={zip215:!0};function wj(r){let e=mD(r);return vi(r,{hash:"function",a:"bigint",d:"bigint",randomBytes:"function"},{adjustScalarBytes:"function",domain:"function",uvRatio:"function",mapToCurve:"function"}),Object.freeze({...e})}function Kp(r){let e=wj(r),{Fp:t,n,prehash:s,hash:i,randomBytes:o,nByteLength:a,h:c}=e,l=qp<<BigInt(a*8)-An,u=t.create,f=e.uvRatio||((F,P)=>{try{return{isValid:!0,value:t.sqrt(F*t.inv(P))}}catch{return{isValid:!1,value:ms}}}),h=e.adjustScalarBytes||(F=>F),p=e.domain||((F,P,K)=>{if(P.length||K)throw new Error("Contexts/pre-hash are not supported");return F}),d=F=>typeof F=="bigint"&&ms<F,m=(F,P)=>d(F)&&d(P)&&F<P,g=F=>F===ms||m(F,l);function y(F,P){if(m(F,P))return F;throw new Error(`Expected valid scalar < ${P}, got ${typeof F} ${F}`)}function b(F){return F===ms?F:y(F,n)}let w=new Map;function v(F){if(!(F instanceof x))throw new Error("ExtendedPoint expected")}class x{constructor(P,K,J,oe){if(this.ex=P,this.ey=K,this.ez=J,this.et=oe,!g(P))throw new Error("x required");if(!g(K))throw new Error("y required");if(!g(J))throw new Error("z required");if(!g(oe))throw new Error("t required")}get x(){return this.toAffine().x}get y(){return this.toAffine().y}static fromAffine(P){if(P instanceof x)throw new Error("extended point not allowed");let{x:K,y:J}=P||{};if(!g(K)||!g(J))throw new Error("invalid affine point");return new x(K,J,An,u(K*J))}static normalizeZ(P){let K=t.invertBatch(P.map(J=>J.ez));return P.map((J,oe)=>J.toAffine(K[oe])).map(x.fromAffine)}_setWindowSize(P){this._WINDOW_SIZE=P,w.delete(this)}assertValidity(){let{a:P,d:K}=e;if(this.is0())throw new Error("bad point: ZERO");let{ex:J,ey:oe,ez:ve,et:ke}=this,Ge=u(J*J),Te=u(oe*oe),Fe=u(ve*ve),Rt=u(Fe*Fe),zt=u(Ge*P),vs=u(Fe*u(zt+Te)),Kr=u(Rt+u(K*u(Ge*Te)));if(vs!==Kr)throw new Error("bad point: equation left != right (1)");let Ni=u(J*oe),Js=u(ve*ke);if(Ni!==Js)throw new Error("bad point: equation left != right (2)")}equals(P){v(P);let{ex:K,ey:J,ez:oe}=this,{ex:ve,ey:ke,ez:Ge}=P,Te=u(K*Ge),Fe=u(ve*oe),Rt=u(J*Ge),zt=u(ke*oe);return Te===Fe&&Rt===zt}is0(){return this.equals(x.ZERO)}negate(){return new x(u(-this.ex),this.ey,this.ez,u(-this.et))}double(){let{a:P}=e,{ex:K,ey:J,ez:oe}=this,ve=u(K*K),ke=u(J*J),Ge=u(qp*u(oe*oe)),Te=u(P*ve),Fe=K+J,Rt=u(u(Fe*Fe)-ve-ke),zt=Te+ke,vs=zt-Ge,Kr=Te-ke,Ni=u(Rt*vs),Js=u(zt*Kr),Xh=u(Rt*Kr),jh=u(vs*zt);return new x(Ni,Js,jh,Xh)}add(P){v(P);let{a:K,d:J}=e,{ex:oe,ey:ve,ez:ke,et:Ge}=this,{ex:Te,ey:Fe,ez:Rt,et:zt}=P;if(K===BigInt(-1)){let M7=u((ve-oe)*(Fe+Te)),U7=u((ve+oe)*(Fe-Te)),x2=u(U7-M7);if(x2===ms)return this.double();let F7=u(ke*qp*zt),V7=u(Ge*qp*Rt),z7=V7+F7,q7=U7+M7,K7=V7-F7,KL=u(z7*x2),$L=u(q7*K7),HL=u(z7*K7),GL=u(x2*q7);return new x(KL,$L,GL,HL)}let vs=u(oe*Te),Kr=u(ve*Fe),Ni=u(Ge*J*zt),Js=u(ke*Rt),Xh=u((oe+ve)*(Te+Fe)-vs-Kr),jh=Js-Ni,L7=Js+Ni,B7=u(Kr-K*vs),FL=u(Xh*jh),VL=u(L7*B7),zL=u(Xh*B7),qL=u(jh*L7);return new x(FL,VL,qL,zL)}subtract(P){return this.add(P.negate())}wNAF(P){return A.wNAFCached(this,w,P,x.normalizeZ)}multiply(P){let{p:K,f:J}=this.wNAF(y(P,n));return x.normalizeZ([K,J])[0]}multiplyUnsafe(P){let K=b(P);return K===ms?S:this.equals(S)||K===An?this:this.equals(_)?this.wNAF(K).p:A.unsafeLadder(this,K)}isSmallOrder(){return this.multiplyUnsafe(c).is0()}isTorsionFree(){return A.unsafeLadder(this,n).is0()}toAffine(P){let{ex:K,ey:J,ez:oe}=this,ve=this.is0();P==null&&(P=ve?yj:t.inv(oe));let ke=u(K*P),Ge=u(J*P),Te=u(oe*P);if(ve)return{x:ms,y:An};if(Te!==An)throw new Error("invZ was invalid");return{x:ke,y:Ge}}clearCofactor(){let{h:P}=e;return P===An?this:this.multiplyUnsafe(P)}static fromHex(P,K=!1){let{d:J,a:oe}=e,ve=t.BYTES;P=Zr("pointHex",P,ve);let ke=P.slice(),Ge=P[ve-1];ke[ve-1]=Ge&-129;let Te=Ws(ke);Te===ms||(K?y(Te,l):y(Te,t.ORDER));let Fe=u(Te*Te),Rt=u(Fe-An),zt=u(J*Fe-oe),{isValid:vs,value:Kr}=f(Rt,zt);if(!vs)throw new Error("Point.fromHex: invalid y coordinate");let Ni=(Kr&An)===An,Js=(Ge&128)!==0;if(!K&&Kr===ms&&Js)throw new Error("Point.fromHex: x=0 and x_0=1");return Js!==Ni&&(Kr=u(-Kr)),x.fromAffine({x:Kr,y:Te})}static fromPrivateKey(P){return ee(P).point}toRawBytes(){let{x:P,y:K}=this.toAffine(),J=xo(K,t.BYTES);return J[J.length-1]|=P&An?128:0,J}toHex(){return oh(this.toRawBytes())}}x.BASE=new x(e.Gx,e.Gy,An,u(e.Gx*e.Gy)),x.ZERO=new x(ms,An,An,ms);let{BASE:_,ZERO:S}=x,A=pD(x,a*8);function D(F){return pt(F,n)}function H(F){return D(Ws(F))}function ee(F){let P=a;F=Zr("private key",F,P);let K=Zr("hashed private key",i(F),2*P),J=h(K.slice(0,P)),oe=K.slice(P,2*P),ve=H(J),ke=_.multiply(ve),Ge=ke.toRawBytes();return{head:J,prefix:oe,scalar:ve,point:ke,pointBytes:Ge}}function j(F){return ee(F).pointBytes}function ie(F=new Uint8Array,...P){let K=zp(...P);return H(i(p(K,Zr("context",F),!!s)))}function Ie(F,P,K={}){F=Zr("message",F),s&&(F=s(F));let{prefix:J,scalar:oe,pointBytes:ve}=ee(P),ke=ie(K.context,J,F),Ge=_.multiply(ke).toRawBytes(),Te=ie(K.context,Ge,ve,F),Fe=D(ke+Te*oe);b(Fe);let Rt=zp(Ge,xo(Fe,t.BYTES));return Zr("result",Rt,a*2)}let le=bj;function we(F,P,K,J=le){let{context:oe,zip215:ve}=J,ke=t.BYTES;F=Zr("signature",F,2*ke),P=Zr("message",P),s&&(P=s(P));let Ge=Ws(F.slice(ke,2*ke)),Te,Fe,Rt;try{Te=x.fromHex(K,ve),Fe=x.fromHex(F.slice(0,ke),ve),Rt=_.multiplyUnsafe(Ge)}catch{return!1}if(!ve&&Te.isSmallOrder())return!1;let zt=ie(oe,Fe.toRawBytes(),Te.toRawBytes(),P);return Fe.add(Te.multiplyUnsafe(zt)).subtract(Rt).clearCofactor().equals(x.ZERO)}return _._setWindowSize(8),{CURVE:e,getPublicKey:j,sign:Ie,verify:we,ExtendedPoint:x,utils:{getExtendedPublicKey:ee,randomPrivateKey:()=>o(t.BYTES),precompute(F=8,P=x.BASE){return P._setWindowSize(F),P.multiply(BigInt(3)),P}}}}var ah=BigInt(0),h5=BigInt(1);function xj(r){return vi(r,{a:"bigint"},{montgomeryBits:"isSafeInteger",nByteLength:"isSafeInteger",adjustScalarBytes:"function",domain:"function",powPminus2:"function",Gu:"bigint"}),Object.freeze({...r})}function gD(r){let e=xj(r),{P:t}=e,n=w=>pt(w,t),s=e.montgomeryBits,i=Math.ceil(s/8),o=e.nByteLength,a=e.adjustScalarBytes||(w=>w),c=e.powPminus2||(w=>l5(w,t-BigInt(2),t));function l(w,v,x){let _=n(w*(v-x));return v=n(v-_),x=n(x+_),[v,x]}function u(w){if(typeof w=="bigint"&&ah<=w&&w<t)return w;throw new Error("Expected valid scalar 0 < scalar < CURVE.P")}let f=(e.a-BigInt(2))/BigInt(4);function h(w,v){let x=u(w),_=u(v),S=x,A=h5,D=ah,H=x,ee=h5,j=ah,ie;for(let le=BigInt(s-1);le>=ah;le--){let we=_>>le&h5;j^=we,ie=l(j,A,H),A=ie[0],H=ie[1],ie=l(j,D,ee),D=ie[0],ee=ie[1],j=we;let V=A+D,F=n(V*V),P=A-D,K=n(P*P),J=F-K,oe=H+ee,ve=H-ee,ke=n(ve*V),Ge=n(oe*P),Te=ke+Ge,Fe=ke-Ge;H=n(Te*Te),ee=n(S*n(Fe*Fe)),A=n(F*K),D=n(J*(F+n(f*J)))}ie=l(j,A,H),A=ie[0],H=ie[1],ie=l(j,D,ee),D=ie[0],ee=ie[1];let Ie=c(D);return n(A*Ie)}function p(w){return xo(n(w),i)}function d(w){let v=Zr("u coordinate",w,i);return o===i&&(v[o-1]&=127),Ws(v)}function m(w){let v=Zr("scalar",w);if(v.length!==i&&v.length!==o)throw new Error(`Expected ${i} or ${o} bytes, got ${v.length}`);return Ws(a(v))}function g(w,v){let x=d(v),_=m(w),S=h(x,_);if(S===ah)throw new Error("Invalid private or public key received");return p(S)}let y=p(e.Gu);function b(w){return g(w,y)}return{scalarMult:g,scalarMultBase:b,getSharedSecret:(w,v)=>g(w,v),getPublicKey:w=>b(w),utils:{randomPrivateKey:()=>e.randomBytes(e.nByteLength)},GuBytes:y}}var ch=BigInt("57896044618658097711785492504343953926634992332820282019728792003956564819949"),yD=BigInt("19681161376707505956807079304988542015446066515923890162744021073123829784752"),dEe=BigInt(0),Ej=BigInt(1),d5=BigInt(2),vj=BigInt(5),bD=BigInt(10),_j=BigInt(20),Sj=BigInt(40),wD=BigInt(80);function xD(r){let e=ch,n=r*r%e*r%e,s=Hn(n,d5,e)*n%e,i=Hn(s,Ej,e)*r%e,o=Hn(i,vj,e)*i%e,a=Hn(o,bD,e)*o%e,c=Hn(a,_j,e)*a%e,l=Hn(c,Sj,e)*c%e,u=Hn(l,wD,e)*l%e,f=Hn(u,wD,e)*l%e,h=Hn(f,bD,e)*o%e;return{pow_p_5_8:Hn(h,d5,e)*r%e,b2:n}}function ED(r){return r[0]&=248,r[31]&=127,r[31]|=64,r}function Aj(r,e){let t=ch,n=pt(e*e*e,t),s=pt(n*n*e,t),i=xD(r*s).pow_p_5_8,o=pt(r*n*i,t),a=pt(e*o*o,t),c=o,l=pt(o*yD,t),u=a===r,f=a===pt(-r,t),h=a===pt(-r*yD,t);return u&&(o=c),(f||h)&&(o=l),uD(o,t)&&(o=pt(-o,t)),{isValid:u||f,value:o}}var _i=hD(ch,void 0,!0),p5={a:BigInt(-1),d:BigInt("37095705934669439343138083508754565189542113879843219016388785533085940283555"),Fp:_i,n:BigInt("7237005577332262213973186563042994240857116359379907606001950938285454250989"),h:BigInt(8),Gx:BigInt("15112221349535400772501151409588531511454012693041857206046113283949847762202"),Gy:BigInt("46316835694926478169428394003475163141307993866256225615783033603165251855960"),hash:i5,randomBytes:e5,adjustScalarBytes:ED,uvRatio:Aj},pEe=Kp(p5);function vD(r,e,t){if(e.length>255)throw new Error("Context is too big");return rD(J8("SigEd25519 no Ed25519 collisions"),new Uint8Array([t?1:0,e.length]),e,r)}var mEe=Kp({...p5,domain:vD}),gEe=Kp({...p5,domain:vD,prehash:i5}),lh=(()=>gD({P:ch,a:BigInt(486662),montgomeryBits:255,nByteLength:32,Gu:BigInt(9),powPminus2:r=>{let e=ch,{pow_p_5_8:t,b2:n}=xD(r);return pt(Hn(t,BigInt(3),e)*n,e)},adjustScalarBytes:ED,randomBytes:e5}))();var Rj=(_i.ORDER+BigInt(3))/BigInt(8),yEe=_i.pow(d5,Rj),bEe=_i.sqrt(_i.neg(_i.ONE)),wEe=(_i.ORDER-BigInt(5))/BigInt(8),xEe=BigInt(486662);var EEe=dD(_i,_i.neg(BigInt(486664)));var vEe=BigInt("25063068953384623474111414158702152701244531502492656460079210482610430750235"),_Ee=BigInt("54469307008909316920995813868745141605393597292927456921205312896311721017578"),SEe=BigInt("1159843021668779879193775521855586647937357759715417654439879720876111806838"),AEe=BigInt("40440834346308536858101042469323190826248399146238708352240133220865137265952");var REe=BigInt("0x7fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff");var $p=class extends vl{constructor(e,t){super(),this.finished=!1,this.destroyed=!1,Sn.hash(e);let n=go(t);if(this.iHash=e.create(),typeof this.iHash.update!="function")throw new Error("Expected instance of class which extends utils.Hash");this.blockLen=this.iHash.blockLen,this.outputLen=this.iHash.outputLen;let s=this.blockLen,i=new Uint8Array(s);i.set(n.length>s?e.create().update(n).digest():n);for(let o=0;o<i.length;o++)i[o]^=54;this.iHash.update(i),this.oHash=e.create();for(let o=0;o<i.length;o++)i[o]^=106;this.oHash.update(i),i.fill(0)}update(e){return Sn.exists(this),this.iHash.update(e),this}digestInto(e){Sn.exists(this),Sn.bytes(e,this.outputLen),this.finished=!0,this.iHash.digestInto(e),this.oHash.update(e),this.oHash.digestInto(e),this.destroy()}digest(){let e=new Uint8Array(this.oHash.outputLen);return this.digestInto(e),e}_cloneInto(e){e||(e=Object.create(Object.getPrototypeOf(this),{}));let{oHash:t,iHash:n,finished:s,destroyed:i,blockLen:o,outputLen:a}=this;return e=e,e.finished=s,e.destroyed=i,e.blockLen=o,e.outputLen=a,e.oHash=t._cloneInto(e.oHash),e.iHash=n._cloneInto(e.iHash),e}destroy(){this.destroyed=!0,this.oHash.destroy(),this.iHash.destroy()}},Hp=(r,e,t)=>new $p(r,e).update(t).digest();Hp.create=(r,e)=>new $p(r,e);function SD(r,e,t){return Sn.hash(r),t===void 0&&(t=new Uint8Array(r.outputLen)),Hp(r,go(t),go(e))}var m5=new Uint8Array([0]),_D=new Uint8Array;function AD(r,e,t,n=32){if(Sn.hash(r),Sn.number(n),n>255*r.outputLen)throw new Error("Length should be <= 255*HashLen");let s=Math.ceil(n/r.outputLen);t===void 0&&(t=_D);let i=new Uint8Array(s*r.outputLen),o=Hp.create(r,e),a=o._cloneInto(),c=new Uint8Array(o.outputLen);for(let l=0;l<s;l++)m5[0]=l+1,a.update(l===0?_D:c).update(t).update(m5).digestInto(c),i.set(c,r.outputLen*l),o._cloneInto(a);return o.destroy(),a.destroy(),c.fill(0),m5.fill(0),i.slice(0,n)}var Ij=(r,e,t)=>r&e^~r&t,Tj=(r,e,t)=>r&e^r&t^e&t,Dj=new Uint32Array([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]),Eo=new Uint32Array([1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225]),vo=new Uint32Array(64),Gp=class extends _l{constructor(){super(64,32,8,!1),this.A=Eo[0]|0,this.B=Eo[1]|0,this.C=Eo[2]|0,this.D=Eo[3]|0,this.E=Eo[4]|0,this.F=Eo[5]|0,this.G=Eo[6]|0,this.H=Eo[7]|0}get(){let{A:e,B:t,C:n,D:s,E:i,F:o,G:a,H:c}=this;return[e,t,n,s,i,o,a,c]}set(e,t,n,s,i,o,a,c){this.A=e|0,this.B=t|0,this.C=n|0,this.D=s|0,this.E=i|0,this.F=o|0,this.G=a|0,this.H=c|0}process(e,t){for(let f=0;f<16;f++,t+=4)vo[f]=e.getUint32(t,!1);for(let f=16;f<64;f++){let h=vo[f-15],p=vo[f-2],d=ps(h,7)^ps(h,18)^h>>>3,m=ps(p,17)^ps(p,19)^p>>>10;vo[f]=m+vo[f-7]+d+vo[f-16]|0}let{A:n,B:s,C:i,D:o,E:a,F:c,G:l,H:u}=this;for(let f=0;f<64;f++){let h=ps(a,6)^ps(a,11)^ps(a,25),p=u+h+Ij(a,c,l)+Dj[f]+vo[f]|0,m=(ps(n,2)^ps(n,13)^ps(n,22))+Tj(n,s,i)|0;u=l,l=c,c=a,a=o+p|0,o=i,i=s,s=n,n=p+m|0}n=n+this.A|0,s=s+this.B|0,i=i+this.C|0,o=o+this.D|0,a=a+this.E|0,c=c+this.F|0,l=l+this.G|0,u=u+this.H|0,this.set(n,s,i,o,a,c,l,u)}roundClean(){vo.fill(0)}destroy(){this.set(0,0,0,0,0,0,0,0),this.buffer.fill(0)}},g5=class extends Gp{constructor(){super(),this.A=-1056596264,this.B=914150663,this.C=812702999,this.D=-150054599,this.E=-4191439,this.F=1750603025,this.G=1694076839,this.H=-1090891868,this.outputLen=28}},Wp=yo(()=>new Gp),MEe=yo(()=>new g5);var y5={hashSHA256(r){return Wp(r)},getHKDF(r,e){let t=SD(Wp,e,r),s=AD(Wp,t,void 0,96),i=s.subarray(0,32),o=s.subarray(32,64),a=s.subarray(64,96);return[i,o,a]},generateX25519KeyPair(){let r=lh.utils.randomPrivateKey();return{publicKey:lh.getPublicKey(r),privateKey:r}},generateX25519KeyPairFromSeed(r){return{publicKey:lh.getPublicKey(r),privateKey:r}},generateX25519SharedKey(r,e){return lh.getSharedSecret(r,e)},chaCha20Poly1305Encrypt(r,e,t,n){return j8(n,e,t).encrypt(r)},chaCha20Poly1305Decrypt(r,e,t,n,s){let i=j8(n,e,t).decrypt(r);return s&&s.set(i),i}};var Cj=r=>globalThis.Buffer?globalThis.Buffer.allocUnsafe(r):new Uint8Array(r),Al=r=>{let e=Cj(2);return new DataView(e.buffer,e.byteOffset,e.byteLength).setUint16(0,r,!1),e};Al.bytes=2;var uh=r=>{if(r.length<2)throw RangeError("Could not decode int16BE");return r instanceof Uint8Array?new DataView(r.buffer,r.byteOffset,r.byteLength).getUint16(0,!1):r.getUint16(0)};uh.bytes=2;function RD(r){return Ee([r.ne,r.ciphertext],r.ne.length+r.ciphertext.length)}function ID(r){return Ee([r.ne,r.ns,r.ciphertext],r.ne.length+r.ns.length+r.ciphertext.length)}function TD(r){return Ee([r.ns,r.ciphertext],r.ns.length+r.ciphertext.length)}function DD(r){if(r.length<32)throw new Error("Cannot decode stage 0 MessageBuffer: length less than 32 bytes.");return{ne:r.subarray(0,32),ciphertext:r.subarray(32,r.length),ns:new Uint8Array(0)}}function CD(r){if(r.length<80)throw new Error("Cannot decode stage 1 MessageBuffer: length less than 80 bytes.");return{ne:r.subarray(0,32),ns:r.subarray(32,80),ciphertext:r.subarray(80,r.length)}}function PD(r){if(r.length<48)throw new Error("Cannot decode stage 2 MessageBuffer: length less than 48 bytes.");return{ne:new Uint8Array(0),ns:r.subarray(0,48),ciphertext:r.subarray(48,r.length)}}var ND=16;function OD(r,e){return async function*(t){for await(let n of t)for(let s=0;s<n.length;s+=65519){let i=s+65519;i>n.length&&(i=n.length);let o=r.encrypt(n.subarray(s,i),r.session);e?.encryptedPackets.increment(),yield Al(o.byteLength),yield o}}}function LD(r,e){return async function*(t){for await(let n of t)for(let s=0;s<n.length;s+=65535){let i=s+65535;if(i>n.length&&(i=n.length),i-ND<s)throw new Error("Invalid chunk");let o=n.subarray(s,i),a=n.subarray(s,i-ND),{plaintext:c,valid:l}=r.decrypt(o,r.session,a);if(!l)throw e?.decryptErrors.increment(),new Error("Failed to validate decrypted chunk");e?.decryptedPackets.increment(),yield c}}}var b5=class extends Error{code;constructor(e="Unexpected Peer"){super(e),this.code=b5.code}},Rl=b5;gt(Rl,"code","ERR_UNEXPECTED_PEER");var w5=class extends Error{code;constructor(e="Invalid crypto exchange"){super(e),this.code=w5.code}},_o=w5;gt(_o,"code","ERR_INVALID_CRYPTO_EXCHANGE");var Yp;(function(r){let e;r.codec=()=>(e==null&&(e=me((t,n,s={})=>{if(s.lengthDelimited!==!1&&n.fork(),t.webtransportCerthashes!=null)for(let i of t.webtransportCerthashes)n.uint32(10),n.bytes(i);s.lengthDelimited!==!1&&n.ldelim()},(t,n)=>{let s={webtransportCerthashes:[]},i=n==null?t.len:t.pos+n;for(;t.pos<i;){let o=t.uint32();switch(o>>>3){case 1:s.webtransportCerthashes.push(t.bytes());break;default:t.skipType(o&7);break}}return s})),e),r.encode=t=>pe(t,r.codec()),r.decode=t=>de(t,r.codec())})(Yp||(Yp={}));var hh;(function(r){let e;r.codec=()=>(e==null&&(e=me((t,n,s={})=>{s.lengthDelimited!==!1&&n.fork(),(s.writeDefaults===!0||t.identityKey!=null&&t.identityKey.byteLength>0)&&(n.uint32(10),n.bytes(t.identityKey??new Uint8Array(0))),(s.writeDefaults===!0||t.identitySig!=null&&t.identitySig.byteLength>0)&&(n.uint32(18),n.bytes(t.identitySig??new Uint8Array(0))),t.extensions!=null&&(n.uint32(34),Yp.codec().encode(t.extensions,n,{writeDefaults:!1})),s.lengthDelimited!==!1&&n.ldelim()},(t,n)=>{let s={identityKey:new Uint8Array(0),identitySig:new Uint8Array(0)},i=n==null?t.len:t.pos+n;for(;t.pos<i;){let o=t.uint32();switch(o>>>3){case 1:s.identityKey=t.bytes();break;case 2:s.identitySig=t.bytes();break;case 4:s.extensions=Yp.codec().decode(t,t.uint32());break;default:t.skipType(o&7);break}}return s})),e),r.encode=t=>pe(t,r.codec()),r.decode=t=>de(t,r.codec())})(hh||(hh={}));async function BD(r,e,t){let n=await kj(r,MD(e));if(r.publicKey==null)throw new Error("PublicKey was missing from local PeerId");return Pj(r.publicKey,n,t)}function Pj(r,e,t){return hh.encode({identityKey:r,identitySig:e,extensions:t??{webtransportCerthashes:[]}}).subarray()}async function kj(r,e){if(r.privateKey==null)throw new Error("PrivateKey was missing from PeerId");return(await ls(r.privateKey)).sign(e)}async function x5(r){return _r(r.identityKey)}function E5(r){return hh.decode(r)}function MD(r){let e=$("noise-libp2p-static-key:");return Ee([e,r],e.length+r.length)}async function v5(r,e,t){let n=await _r(e.identityKey);if(!n.equals(t))throw new Error(`Payload identity key ${n.toString()} does not match expected remote peer ${t.toString()}`);let s=MD(r);if(n.publicKey==null)throw new Error("PublicKey was missing from PeerId");if(e.identitySig==null)throw new Error("Signature was missing from message");if(!await Yr(n.publicKey).verify(s,e.identitySig))throw new Error("Static key doesn't match to peer that signed payload!");return n}function dh(r){return!(!(r instanceof Uint8Array)||r.length!==32)}function Qp(r,e){for(let t=0;t<r.byteLength;t++){if(r[t]<e[t])return-1;if(r[t]>e[t])return 1}return r.byteLength>e.byteLength?1:r.byteLength<e.byteLength?-1:0}function Si(r,e){if(r.length!==e.length)throw new Error("Inputs should have the same length");let t=on(r.length);for(let n=0;n<r.length;n++)t[n]=r[n]^e[n];return ri(t)}var pr=C("libp2p:noise");var Gn;$T?Gn=pr:Gn=Object.assign(()=>{},{enabled:!1,trace:()=>{},error:()=>{}});function UD(r){Gn(`LOCAL_STATIC_PUBLIC_KEY ${M(r.publicKey,"hex")}`),Gn(`LOCAL_STATIC_PRIVATE_KEY ${M(r.privateKey,"hex")}`)}function _5(r){r?(Gn(`LOCAL_PUBLIC_EPHEMERAL_KEY ${M(r.publicKey,"hex")}`),Gn(`LOCAL_PRIVATE_EPHEMERAL_KEY ${M(r.privateKey,"hex")}`)):Gn("Missing local ephemeral keys.")}function FD(r){Gn(`REMOTE_STATIC_PUBLIC_KEY ${M(r,"hex")}`)}function S5(r){Gn(`REMOTE_EPHEMERAL_PUBLIC_KEY ${M(r,"hex")}`)}function VD(r){r.cs1&&r.cs2?(Gn(`CIPHER_STATE_1 ${r.cs1.n.getUint64()} ${M(r.cs1.k,"hex")}`),Gn(`CIPHER_STATE_2 ${r.cs2.n.getUint64()} ${M(r.cs2.k,"hex")}`)):Gn("Missing cipher state.")}var Nj="Cipherstate has reached maximum n, a new handshake must be performed",Xp=class{n;bytes;view;constructor(e=0){this.n=e,this.bytes=new Uint8Array(12),this.view=new DataView(this.bytes.buffer,this.bytes.byteOffset,this.bytes.byteLength),this.view.setUint32(4,e,!0)}increment(){this.n++,this.view.setUint32(4,this.n,!0)}getBytes(){return this.bytes}getUint64(){return this.n}assertValue(){if(this.n>4294967295)throw new Error(Nj)}};var jp=class{crypto;constructor(e){this.crypto=e}encryptWithAd(e,t,n){let s=this.encrypt(e.k,e.n,t,n);return e.n.increment(),s}decryptWithAd(e,t,n,s){let{plaintext:i,valid:o}=this.decrypt(e.k,e.n,t,n,s);return o&&e.n.increment(),{plaintext:i,valid:o}}hasKey(e){return!this.isEmptyKey(e.k)}createEmptyKey(){return new Uint8Array(32)}isEmptyKey(e){let t=this.createEmptyKey();return be(t,e)}encrypt(e,t,n,s){return t.assertValue(),this.crypto.chaCha20Poly1305Encrypt(s,t.getBytes(),n,e)}encryptAndHash(e,t){let n;return this.hasKey(e.cs)?n=this.encryptWithAd(e.cs,e.h,t):n=t,this.mixHash(e,n),n}decrypt(e,t,n,s,i){t.assertValue();let o=this.crypto.chaCha20Poly1305Decrypt(s,t.getBytes(),n,e,i);return o?{plaintext:o,valid:!0}:{plaintext:new Uint8Array(0),valid:!1}}decryptAndHash(e,t){let n,s=!0;return this.hasKey(e.cs)?{plaintext:n,valid:s}=this.decryptWithAd(e.cs,e.h,t):n=t,this.mixHash(e,t),{plaintext:n,valid:s}}dh(e,t){try{let n=this.crypto.generateX25519SharedKey(e,t);return n.length===32?n:n.subarray(0,32)}catch(n){let s=n;return pr.error(s),new Uint8Array(32)}}mixHash(e,t){e.h=this.getHash(e.h,t)}getHash(e,t){return this.crypto.hashSHA256(Ee([e,t],e.length+t.length))}mixKey(e,t){let[n,s]=this.crypto.getHKDF(e.ck,t);e.cs=this.initializeKey(s),e.ck=n}initializeKey(e){return{k:e,n:new Xp}}initializeSymmetric(e){let t=$(e,"utf-8"),n=this.hashProtocolName(t),s=n,i=this.createEmptyKey();return{cs:this.initializeKey(i),ck:s,h:n}}hashProtocolName(e){if(e.length<=32){let t=new Uint8Array(32);return t.set(e),t}else return this.getHash(e,new Uint8Array(0))}split(e){let[t,n]=this.crypto.getHKDF(e.ck,new Uint8Array(0)),s=this.initializeKey(t),i=this.initializeKey(n);return{cs1:s,cs2:i}}writeMessageRegular(e,t){let n=this.encryptWithAd(e,new Uint8Array(0),t),s=this.createEmptyKey(),i=new Uint8Array(0);return{ne:s,ns:i,ciphertext:n}}readMessageRegular(e,t){return this.decryptWithAd(e,new Uint8Array(0),t.ciphertext)}};var Zp=class extends jp{initializeInitiator(e,t,n,s){let i="Noise_XX_25519_ChaChaPoly_SHA256",o=this.initializeSymmetric(i);this.mixHash(o,e);let a=new Uint8Array(32);return{ss:o,s:t,rs:n,psk:s,re:a}}initializeResponder(e,t,n,s){let i="Noise_XX_25519_ChaChaPoly_SHA256",o=this.initializeSymmetric(i);this.mixHash(o,e);let a=new Uint8Array(32);return{ss:o,s:t,rs:n,psk:s,re:a}}writeMessageA(e,t,n){let s=new Uint8Array(0);n!==void 0?e.e=n:e.e=this.crypto.generateX25519KeyPair();let i=e.e.publicKey;this.mixHash(e.ss,i);let o=this.encryptAndHash(e.ss,t);return{ne:i,ns:s,ciphertext:o}}writeMessageB(e,t){e.e=this.crypto.generateX25519KeyPair();let n=e.e.publicKey;this.mixHash(e.ss,n),this.mixKey(e.ss,this.dh(e.e.privateKey,e.re));let s=e.s.publicKey,i=this.encryptAndHash(e.ss,s);this.mixKey(e.ss,this.dh(e.s.privateKey,e.re));let o=this.encryptAndHash(e.ss,t);return{ne:n,ns:i,ciphertext:o}}writeMessageC(e,t){let n=e.s.publicKey,s=this.encryptAndHash(e.ss,n);this.mixKey(e.ss,this.dh(e.s.privateKey,e.re));let i=this.encryptAndHash(e.ss,t),a={ne:this.createEmptyKey(),ns:s,ciphertext:i},{cs1:c,cs2:l}=this.split(e.ss);return{h:e.ss.h,messageBuffer:a,cs1:c,cs2:l}}readMessageA(e,t){return dh(t.ne)&&(e.re=t.ne),this.mixHash(e.ss,e.re),this.decryptAndHash(e.ss,t.ciphertext)}readMessageB(e,t){if(dh(t.ne)&&(e.re=t.ne),this.mixHash(e.ss,e.re),!e.e)throw new Error("Handshake state `e` param is missing.");this.mixKey(e.ss,this.dh(e.e.privateKey,e.re));let{plaintext:n,valid:s}=this.decryptAndHash(e.ss,t.ns);s&&dh(n)&&(e.rs=n),this.mixKey(e.ss,this.dh(e.e.privateKey,e.rs));let{plaintext:i,valid:o}=this.decryptAndHash(e.ss,t.ciphertext);return{plaintext:i,valid:s&&o}}readMessageC(e,t){let{plaintext:n,valid:s}=this.decryptAndHash(e.ss,t.ns);if(s&&dh(n)&&(e.rs=n),!e.e)throw new Error("Handshake state `e` param is missing.");this.mixKey(e.ss,this.dh(e.e.privateKey,e.rs));let{plaintext:i,valid:o}=this.decryptAndHash(e.ss,t.ciphertext),{cs1:a,cs2:c}=this.split(e.ss);return{h:e.ss.h,plaintext:i,valid:s&&o,cs1:a,cs2:c}}initSession(e,t,n){let s=this.createEmptyKey(),i=new Uint8Array(32),o;return e?o=this.initializeInitiator(t,n,i,s):o=this.initializeResponder(t,n,i,s),{hs:o,i:e,mc:0}}sendMessage(e,t,n){let s;if(e.mc===0)s=this.writeMessageA(e.hs,t,n);else if(e.mc===1)s=this.writeMessageB(e.hs,t);else if(e.mc===2){let{h:i,messageBuffer:o,cs1:a,cs2:c}=this.writeMessageC(e.hs,t);s=o,e.h=i,e.cs1=a,e.cs2=c}else if(e.mc>2)if(e.i){if(!e.cs1)throw new Error("CS1 (cipher state) is not defined");s=this.writeMessageRegular(e.cs1,t)}else{if(!e.cs2)throw new Error("CS2 (cipher state) is not defined");s=this.writeMessageRegular(e.cs2,t)}else throw new Error("Session invalid.");return e.mc++,s}recvMessage(e,t){let n=new Uint8Array(0),s=!1;if(e.mc===0)({plaintext:n,valid:s}=this.readMessageA(e.hs,t));else if(e.mc===1)({plaintext:n,valid:s}=this.readMessageB(e.hs,t));else if(e.mc===2){let{h:i,plaintext:o,valid:a,cs1:c,cs2:l}=this.readMessageC(e.hs,t);n=o,s=a,e.h=i,e.cs1=c,e.cs2=l}return e.mc++,{plaintext:n,valid:s}}};var Jp=class{isInitiator;session;remotePeer;remoteExtensions={webtransportCerthashes:[]};payload;connection;xx;staticKeypair;prologue;constructor(e,t,n,s,i,o,a,c){this.isInitiator=e,this.payload=t,this.prologue=n,this.staticKeypair=i,this.connection=o,a&&(this.remotePeer=a),this.xx=c??new Zp(s),this.session=this.xx.initSession(this.isInitiator,this.prologue,this.staticKeypair)}async propose(){if(UD(this.session.hs.s),this.isInitiator){pr.trace("Stage 0 - Initiator starting to send first message.");let e=this.xx.sendMessage(this.session,new Uint8Array(0));this.connection.writeLP(RD(e)),pr.trace("Stage 0 - Initiator finished sending first message."),_5(this.session.hs.e)}else{pr.trace("Stage 0 - Responder waiting to receive first message...");let e=DD((await this.connection.readLP()).subarray()),{valid:t}=this.xx.recvMessage(this.session,e);if(!t)throw new _o("xx handshake stage 0 validation fail");pr.trace("Stage 0 - Responder received first message."),S5(this.session.hs.re)}}async exchange(){if(this.isInitiator){pr.trace("Stage 1 - Initiator waiting to receive first message from responder...");let e=CD((await this.connection.readLP()).subarray()),{plaintext:t,valid:n}=this.xx.recvMessage(this.session,e);if(!n)throw new _o("xx handshake stage 1 validation fail");pr.trace("Stage 1 - Initiator received the message."),S5(this.session.hs.re),FD(this.session.hs.rs),pr.trace("Initiator going to check remote's signature...");try{let s=E5(t);this.remotePeer=this.remotePeer||await x5(s),await v5(this.session.hs.rs,s,this.remotePeer),this.setRemoteNoiseExtension(s.extensions)}catch(s){let i=s;throw new Rl(`Error occurred while verifying signed payload: ${i.message}`)}pr.trace("All good with the signature!")}else{pr.trace("Stage 1 - Responder sending out first message with signed payload and static key.");let e=this.xx.sendMessage(this.session,this.payload);this.connection.writeLP(ID(e)),pr.trace("Stage 1 - Responder sent the second handshake message with signed payload."),_5(this.session.hs.e)}}async finish(){if(this.isInitiator){pr.trace("Stage 2 - Initiator sending third handshake message.");let e=this.xx.sendMessage(this.session,this.payload);this.connection.writeLP(TD(e)),pr.trace("Stage 2 - Initiator sent message with signed payload.")}else{pr.trace("Stage 2 - Responder waiting for third handshake message...");let e=PD((await this.connection.readLP()).subarray()),{plaintext:t,valid:n}=this.xx.recvMessage(this.session,e);if(!n)throw new _o("xx handshake stage 2 validation fail");pr.trace("Stage 2 - Responder received the message, finished handshake.");try{let s=E5(t);this.remotePeer=this.remotePeer||await x5(s),await v5(this.session.hs.rs,s,this.remotePeer),this.setRemoteNoiseExtension(s.extensions)}catch(s){let i=s;throw new Rl(`Error occurred while verifying signed payload: ${i.message}`)}}VD(this.session)}encrypt(e,t){let n=this.getCS(t);return this.xx.encryptWithAd(n,new Uint8Array(0),e)}decrypt(e,t,n){let s=this.getCS(t,!1);return this.xx.decryptWithAd(s,new Uint8Array(0),e,n)}getRemoteStaticKey(){return this.session.hs.rs}getCS(e,t=!0){if(!e.cs1||!e.cs2)throw new _o("Handshake not completed properly, cipher state does not exist.");return this.isInitiator?t?e.cs1:e.cs2:t?e.cs2:e.cs1}setRemoteNoiseExtension(e){e&&(this.remoteExtensions=e)}};function zD(r){return{xxHandshakeSuccesses:r.registerCounter("libp2p_noise_xxhandshake_successes_total",{help:"Total count of noise xxHandshakes successes_"}),xxHandshakeErrors:r.registerCounter("libp2p_noise_xxhandshake_error_total",{help:"Total count of noise xxHandshakes errors"}),encryptedPackets:r.registerCounter("libp2p_noise_encrypted_packets_total",{help:"Total count of noise encrypted packets successfully"}),decryptedPackets:r.registerCounter("libp2p_noise_decrypted_packets_total",{help:"Total count of noise decrypted packets"}),decryptErrors:r.registerCounter("libp2p_noise_decrypt_errors_total",{help:"Total count of noise decrypt errors"})}}var e1=class{protocol="/noise";crypto;prologue;staticKeys;extensions;metrics;constructor(e={}){let{staticNoiseKey:t,extensions:n,crypto:s,prologueBytes:i,metrics:o}=e;this.crypto=s??y5,this.extensions=n,this.metrics=o?zD(o):void 0,t?this.staticKeys=this.crypto.generateX25519KeyPairFromSeed(t):this.staticKeys=this.crypto.generateX25519KeyPair(),this.prologue=i??new Uint8Array(0)}async secureOutbound(e,t,n){let s=jr(t,{lengthEncoder:Al,lengthDecoder:uh,maxDataLength:65535}),i=await this.performHandshake({connection:s,isInitiator:!0,localPeer:e,remotePeer:n});return{conn:await this.createSecureConnection(s,i),remoteExtensions:i.remoteExtensions,remotePeer:i.remotePeer}}async secureInbound(e,t,n){let s=jr(t,{lengthEncoder:Al,lengthDecoder:uh,maxDataLength:65535}),i=await this.performHandshake({connection:s,isInitiator:!1,localPeer:e,remotePeer:n});return{conn:await this.createSecureConnection(s,i),remotePeer:i.remotePeer,remoteExtensions:i.remoteExtensions}}async performHandshake(e){let t=await BD(e.localPeer,this.staticKeys.publicKey,this.extensions);return this.performXXHandshake(e,t)}async performXXHandshake(e,t){let{isInitiator:n,remotePeer:s,connection:i}=e,o=new Jp(n,t,this.prologue,this.crypto,this.staticKeys,i,s);try{await o.propose(),await o.exchange(),await o.finish(),this.metrics?.xxHandshakeSuccesses.increment()}catch(a){if(this.metrics?.xxHandshakeErrors.increment(),a instanceof Error)throw a.message=`Error occurred during XX handshake: ${a.message}`,a}return o}async createSecureConnection(e,t){let[n,s]=qT(),i=e.unwrap();return await Re(n,OD(t,this.metrics),i,o=>kt(o,{lengthDecoder:uh}),LD(t,this.metrics),n),s}};function Il(r={}){return()=>new e1(r)}var Tl="ERR_INVALID_FRAME",A5="ERR_UNREQUESTED_PING",R5="ERR_NOT_MATCHING_PING",I5="ERR_STREAM_ALREADY_EXISTS",T5="ERR_DECODE_INVALID_VERSION",D5="ERR_BOTH_CLIENTS",C5="ERR_RECV_WINDOW_EXCEEDED",qD=new Set([Tl,A5,R5,I5,T5,D5,C5]),So="ERR_INVALID_CONFIG",t1="ERR_MUXER_LOCAL_CLOSED",P5="ERR_MUXER_REMOTE_CLOSED",KD="ERR_STREAM_RESET",ph="ERR_STREAM_ABORT",$D="ERROR_MAX_OUTBOUND_STREAMS_EXCEEDED",HD="ERR_DECODE_IN_PROGRESS",mh=256*1024,GD=16*1024*1024;var WD={log:C("libp2p:yamux"),enableKeepAlive:!0,keepAliveInterval:3e4,maxInboundStreams:1e3,maxOutboundStreams:1e3,initialStreamWindowSize:mh,maxStreamWindowSize:GD,maxMessageSize:64*1024};function YD(r){if(r.keepAliveInterval<=0)throw new E("keep-alive interval must be positive",So);if(r.maxInboundStreams<0)throw new E("max inbound streams must be larger or equal 0",So);if(r.maxOutboundStreams<0)throw new E("max outbound streams must be larger or equal 0",So);if(r.initialStreamWindowSize<mh)throw new E("InitialStreamWindowSize must be larger or equal 256 kB",So);if(r.maxStreamWindowSize<r.initialStreamWindowSize)throw new E("MaxStreamWindowSize must be larger than the InitialStreamWindowSize",So);if(r.maxStreamWindowSize>2**32-1)throw new E("MaxStreamWindowSize must be less than equal MAX_UINT32",So);if(r.maxMessageSize<1024)throw new E("MaxMessageSize must be greater than a kilobyte",So)}var Dt;(function(r){r[r.Data=0]="Data",r[r.WindowUpdate=1]="WindowUpdate",r[r.Ping=2]="Ping",r[r.GoAway=3]="GoAway"})(Dt||(Dt={}));var mt;(function(r){r[r.SYN=1]="SYN",r[r.ACK=2]="ACK",r[r.FIN=4]="FIN",r[r.RST=8]="RST"})(mt||(mt={}));var Oj=Object.values(mt).filter(r=>typeof r!="string"),QD=0,Jr;(function(r){r[r.NormalTermination=0]="NormalTermination",r[r.ProtocolError=1]="ProtocolError",r[r.InternalError=2]="InternalError"})(Jr||(Jr={}));var Ao=12;function k5(r){let e=Oj.filter(t=>(r.flag&t)===t).map(t=>mt[t]).join("|");return`streamID=${r.streamID} type=${Dt[r.type]} flag=${e} length=${r.length}`}var XD=2**24;function Lj(r){if(r[0]!==QD)throw new E("Invalid frame version",T5);return{type:r[1],flag:(r[2]<<8)+r[3],streamID:r[4]*XD+(r[5]<<16)+(r[6]<<8)+r[7],length:r[8]*XD+(r[9]<<16)+(r[10]<<8)+r[11]}}var r1=class{source;buffer;frameInProgress;constructor(e){this.source=Bj(e),this.buffer=new ye,this.frameInProgress=!1}async*emitFrames(){for await(let e of this.source)for(this.buffer.append(e);;){let t=this.readHeader();if(t===void 0)break;let{type:n,length:s}=t;n===Dt.Data?(this.frameInProgress=!0,yield{header:t,readData:this.readBytes.bind(this,s)}):yield{header:t}}}readHeader(){if(this.frameInProgress)throw new E("decoding frame already in progress",HD);if(this.buffer.length<Ao)return;let e=Lj(this.buffer.subarray(0,Ao));return this.buffer.consume(Ao),e}async readBytes(e){if(this.buffer.length<e){for await(let n of this.source)if(this.buffer.append(n),this.buffer.length>=e)break}let t=this.buffer.sublist(0,e);return this.buffer.consume(e),this.frameInProgress=!1,t}};function Bj(r){if(r[Symbol.iterator]!==void 0){let e=r[Symbol.iterator]();return e.return=void 0,{[Symbol.iterator](){return e}}}else if(r[Symbol.asyncIterator]!==void 0){let e=r[Symbol.asyncIterator]();return e.return=void 0,{[Symbol.asyncIterator](){return e}}}else throw new Error("a source must be either an iterable or an async iterable")}function N5(r){let e=new Uint8Array(Ao);return e[1]=r.type,e[2]=r.flag>>>8,e[3]=r.flag,e[4]=r.streamID>>>24,e[5]=r.streamID>>>16,e[6]=r.streamID>>>8,e[7]=r.streamID,e[8]=r.length>>>24,e[9]=r.length>>>16,e[10]=r.length>>>8,e[11]=r.length,e}var Yt;(function(r){r[r.Init=0]="Init",r[r.SYNSent=1]="SYNSent",r[r.SYNReceived=2]="SYNReceived",r[r.Established=3]="Established",r[r.Finished=4]="Finished"})(Yt||(Yt={}));var Fr;(function(r){r[r.Open=0]="Open",r[r.Closed=1]="Closed",r[r.Reset=2]="Reset"})(Fr||(Fr={}));var n1=class{id;name;stat;metadata;state;readState;writeState;sourceInput;source;sink;config;log;_id;sendWindowCapacity;sendWindowCapacityUpdate;recvWindow;recvWindowCapacity;epochStart;getRTT;abortController;sendFrame;onStreamEnd;constructor(e){this.config=e.config,this.log=e.log,this._id=e.id,this.id=String(e.id),this.name=e.name,this.stat={direction:e.direction,timeline:{open:Date.now()}},this.metadata={},this.state=e.state,this.readState=Fr.Open,this.writeState=Fr.Open,this.sendWindowCapacity=mh,this.recvWindow=this.config.initialStreamWindowSize,this.recvWindowCapacity=this.recvWindow,this.epochStart=Date.now(),this.getRTT=e.getRTT,this.abortController=new AbortController,this.sendFrame=e.sendFrame,this.onStreamEnd=e.onStreamEnd,this.sourceInput=yt({onEnd:t=>{t!=null?this.log?.error("stream source ended id=%s",this._id,t):this.log?.trace("stream source ended id=%s",this._id),this.closeRead()}}),this.source=this.createSource(),this.sink=async t=>{if(this.writeState!==Fr.Open)throw new Error("stream closed for writing");t=bt(t,this.abortController.signal,{returnOnAbort:!0});try{for await(let n of t)for(;n.length!==0;){this.sendWindowCapacity===0&&await this.waitForSendWindowCapacity();let s=Math.min(this.sendWindowCapacity,this.config.maxMessageSize-Ao,n.length);this.sendData(n.subarray(0,s)),this.sendWindowCapacity-=s,n=n.subarray(s)}}catch(n){this.log?.error("stream sink error id=%s",this._id,n)}finally{this.log?.trace("stream sink ended id=%s",this._id),this.closeWrite()}}}async*createSource(){try{for await(let e of this.sourceInput)this.sendWindowUpdate(),yield e}catch(e){if(e.code!==ph)throw this.log?.error("stream source error id=%s",this._id,e),e}}close(){this.log?.trace("stream close id=%s",this._id),this.closeRead(),this.closeWrite()}closeRead(){this.state!==Yt.Finished&&this.readState===Fr.Open&&(this.log?.trace("stream close read id=%s",this._id),this.readState=Fr.Closed,this.sourceInput.end(),this.writeState!==Fr.Open&&this.finish())}closeWrite(){this.state!==Yt.Finished&&this.writeState===Fr.Open&&(this.log?.trace("stream close write id=%s",this._id),this.writeState=Fr.Closed,this.sendClose(),this.abortController.abort(),this.readState!==Fr.Open&&this.finish())}abort(e){switch(this.state){case Yt.Finished:return;case Yt.Init:break;case Yt.SYNSent:case Yt.SYNReceived:case Yt.Established:this.sendReset();break;default:throw new Error("unreachable")}e!=null?this.log?.error("stream abort id=%s error=%s",this._id,e):this.log?.trace("stream abort id=%s",this._id),this.onReset(new E(String(e)??"stream aborted",ph))}reset(){this.state!==Yt.Finished&&(this.log?.trace("stream reset id=%s",this._id),this.onReset(new E("stream reset",KD)))}onReset(e){this.writeState===Fr.Open&&(this.writeState=Fr.Reset),this.readState===Fr.Open&&(this.readState=Fr.Reset),this.state=Yt.Finished,this.sourceInput.end(e),this.abortController.abort(),this.finish()}async waitForSendWindowCapacity(){if(this.abortController.signal.aborted)throw new E("stream aborted",ph);if(this.sendWindowCapacity>0)return;let e,t=()=>{e(new E("stream aborted",ph))};this.abortController.signal.addEventListener("abort",t),await new Promise((n,s)=>{this.sendWindowCapacityUpdate=()=>{this.abortController.signal.removeEventListener("abort",t),n(void 0)},e=s})}handleWindowUpdate(e){this.log?.trace("stream received window update id=%s",this._id),this.processFlags(e.flag);let t=this.sendWindowCapacity;this.sendWindowCapacity+=e.length,t===0&&e.length>0&&this.sendWindowCapacityUpdate?.()}async handleData(e,t){if(this.log?.trace("stream received data id=%s",this._id),this.processFlags(e.flag),this.recvWindowCapacity<e.length)throw new E("receive window exceeded",C5,{available:this.recvWindowCapacity,recv:e.length});let n=await t();this.recvWindowCapacity-=e.length,this.sourceInput.push(n)}processFlags(e){(e&mt.ACK)===mt.ACK&&this.state===Yt.SYNSent&&(this.state=Yt.Established),(e&mt.FIN)===mt.FIN&&this.closeRead(),(e&mt.RST)===mt.RST&&this.reset()}finish(){this.log?.trace("stream finished id=%s",this._id),this.state=Yt.Finished,this.stat.timeline.close=Date.now(),this.onStreamEnd()}getSendFlags(){switch(this.state){case Yt.Init:return this.state=Yt.SYNSent,mt.SYN;case Yt.SYNReceived:return this.state=Yt.Established,mt.ACK;default:return 0}}sendWindowUpdate(){let e=this.getSendFlags(),t=Date.now(),n=this.getRTT();if(e===0&&n>0&&t-this.epochStart<n*4&&(this.recvWindow=Math.min(this.recvWindow*2,this.config.maxStreamWindowSize)),this.recvWindowCapacity>=this.recvWindow&&e===0)return;let s=this.recvWindow-this.recvWindowCapacity;this.recvWindowCapacity=this.recvWindow,this.epochStart=t,this.sendFrame({type:Dt.WindowUpdate,flag:e,streamID:this._id,length:s})}sendData(e){let t=this.getSendFlags();this.sendFrame({type:Dt.Data,flag:t,streamID:this._id,length:e.length},e)}sendClose(){let e=this.getSendFlags()|mt.FIN;this.sendFrame({type:Dt.WindowUpdate,flag:e,streamID:this._id,length:0})}sendReset(){this.sendFrame({type:Dt.WindowUpdate,flag:mt.RST,streamID:this._id,length:0})}};var jD="/yamux/1.0.0",s1=class{protocol=jD;_init;constructor(e={}){this._init=e}createStreamMuxer(e){return new O5({...this._init,...e})}},O5=class{protocol=jD;source;sink;_init;config;log;closeController;nextStreamID;_streams;nextPingID;activePing;rtt;client;localGoAway;remoteGoAway;numInboundStreams;numOutboundStreams;onIncomingStream;onStreamEnd;constructor(e){this._init=e,this.client=e.direction==="outbound",this.config={...WD,...e},this.log=this.config.log,YD(this.config),this.closeController=new AbortController,this.onIncomingStream=e.onIncomingStream,this.onStreamEnd=e.onStreamEnd,this._streams=new Map,this.source=yt({onEnd:t=>{this.log?.trace("muxer source ended"),this.close(t)}}),this.sink=async t=>{let n;this._init.signal!=null&&(n=ot([this.closeController.signal,this._init.signal])),t=bt(t,n??this.closeController.signal,{returnOnAbort:!0});let s,i;try{let o=new r1(t);await Re(o.emitFrames.bind(o),async a=>{for await(let{header:c,readData:l}of a)await this.handleFrame(c,l)}),s=Jr.NormalTermination}catch(o){let a=o.code;qD.has(a)?(this.log?.error("protocol error in sink",o),s=Jr.ProtocolError):(this.log?.error("internal error in sink",o),s=Jr.InternalError),i=o}finally{n?.clear()}this.log?.trace("muxer sink ended"),this.close(i,s)},this.numInboundStreams=0,this.numOutboundStreams=0,this.nextStreamID=this.client?1:2,this.nextPingID=0,this.rtt=0,this.log?.trace("muxer created"),this.config.enableKeepAlive&&this.keepAliveLoop().catch(t=>this.log?.error("keepalive error: %s",t))}get streams(){return Array.from(this._streams.values())}newStream(e){if(this.remoteGoAway!==void 0)throw new E("muxer closed remotely",P5);if(this.localGoAway!==void 0)throw new E("muxer closed locally",t1);let t=this.nextStreamID;if(this.nextStreamID+=2,this.numOutboundStreams>=this.config.maxOutboundStreams)throw new E("max outbound streams exceeded",$D);this.log?.trace("new outgoing stream id=%s",t);let n=this._newStream(t,e,Yt.Init,"outbound");return this._streams.set(t,n),this.numOutboundStreams++,n.sendWindowUpdate(),n}async ping(){if(this.remoteGoAway!==void 0)throw new E("muxer closed remotely",P5);if(this.localGoAway!==void 0)throw new E("muxer closed locally",t1);if(this.activePing===void 0){let e=()=>{};this.activePing={id:this.nextPingID++,promise:new Promise((s,i)=>{let o=()=>{i(new E("muxer closed locally",t1))};this.closeController.signal.addEventListener("abort",o,{once:!0}),e=()=>{this.closeController.signal.removeEventListener("abort",o),s()}}),resolve:e};let t=Date.now();this.sendPing(this.activePing.id);try{await this.activePing.promise}finally{delete this.activePing}let n=Date.now();this.rtt=n-t}else await this.activePing.promise;return this.rtt}getRTT(){return this.rtt}close(e,t){if(!this.closeController.signal.aborted){if(t=t??(e===void 0?Jr.InternalError:Jr.NormalTermination),e!=null?this.log?.error("muxer close reason=%s error=%s",Jr[t],e):this.log?.trace("muxer close reason=%s",Jr[t]),e===void 0)for(let n of this._streams.values())n.close();else for(let n of this._streams.values())n.abort(e);this.sendGoAway(t),this._closeMuxer()}}isClosed(){return this.closeController.signal.aborted}_closeMuxer(){this.closeController.abort(),this.source.end()}_newStream(e,t,n,s){if(this._streams.get(e)!=null)throw new E("Stream already exists",I5,{id:e});let i=new n1({id:e,name:t,state:n,direction:s,sendFrame:this.sendFrame.bind(this),onStreamEnd:()=>{this.closeStream(e),this.onStreamEnd?.(i)},log:this.log,config:this.config,getRTT:this.getRTT.bind(this)});return i}closeStream(e){this.client===(e%2===0)?this.numInboundStreams--:this.numOutboundStreams--,this._streams.delete(e)}async keepAliveLoop(){let e=new Promise((t,n)=>{this.closeController.signal.addEventListener("abort",n,{once:!0})});for(this.log?.trace("muxer keepalive enabled interval=%s",this.config.keepAliveInterval);;){let t;try{await Promise.race([e,new Promise(n=>{t=setTimeout(n,this.config.keepAliveInterval)})]),this.ping().catch(n=>this.log?.error("ping error: %s",n))}catch{clearInterval(t);return}}}async handleFrame(e,t){let{streamID:n,type:s,length:i}=e;if(this.log?.trace("received frame %s",k5(e)),n===0)switch(s){case Dt.Ping:{this.handlePing(e);return}case Dt.GoAway:{this.handleGoAway(i);return}default:throw new E("Invalid frame type",Tl,{header:e})}else switch(e.type){case Dt.Data:case Dt.WindowUpdate:{await this.handleStreamMessage(e,t);return}default:throw new E("Invalid frame type",Tl,{header:e})}}handlePing(e){if(e.flag===mt.SYN)this.log?.trace("received ping request pingId=%s",e.length),this.sendPing(e.length,mt.ACK);else if(e.flag===mt.ACK)this.log?.trace("received ping response pingId=%s",e.length),this.handlePingResponse(e.length);else throw new E("Invalid frame flag",Tl,{header:e})}handlePingResponse(e){if(this.activePing===void 0)throw new E("ping not requested",A5);if(this.activePing.id!==e)throw new E("ping doesn't match our id",R5);this.activePing.resolve()}handleGoAway(e){this.log?.trace("received GoAway reason=%s",Jr[e]??"unknown"),this.remoteGoAway=e;for(let t of this._streams.values())t.reset();this._closeMuxer()}async handleStreamMessage(e,t){let{streamID:n,flag:s,type:i}=e;(s&mt.SYN)===mt.SYN&&this.incomingStream(n);let o=this._streams.get(n);if(o===void 0){if(i===Dt.Data){if(this.log?.("discarding data for stream id=%s",n),t===void 0)throw new Error("unreachable");await t()}else this.log?.("frame for missing stream id=%s",n);return}switch(i){case Dt.WindowUpdate:{o.handleWindowUpdate(e);return}case Dt.Data:{if(t===void 0)throw new Error("unreachable");await o.handleData(e,t);return}default:throw new Error("unreachable")}}incomingStream(e){if(this.client!==(e%2===0))throw new E("both endpoints are clients",D5);if(this._streams.has(e))return;if(this.log?.trace("new incoming stream id=%s",e),this.localGoAway!==void 0){this.sendFrame({type:Dt.WindowUpdate,flag:mt.RST,streamID:e,length:0});return}if(this.numInboundStreams>=this.config.maxInboundStreams){this.log?.("maxIncomingStreams exceeded, forcing stream reset"),this.sendFrame({type:Dt.WindowUpdate,flag:mt.RST,streamID:e,length:0});return}let t=this._newStream(e,void 0,Yt.SYNReceived,"inbound");this.numInboundStreams++,this._streams.set(e,t),this.onIncomingStream?.(t)}sendFrame(e,t){if(this.log?.trace("sending frame %s",k5(e)),e.type===Dt.Data){if(t===void 0)throw new E("invalid frame",Tl);this.source.push(N5(e)),this.source.push(t)}else this.source.push(N5(e))}sendPing(e,t=mt.SYN){t===mt.SYN?this.log?.trace("sending ping request pingId=%s",e):this.log?.trace("sending ping response pingId=%s",e),this.sendFrame({type:Dt.Ping,flag:t,streamID:0,length:e})}sendGoAway(e=Jr.NormalTermination){this.log?.("sending GoAway reason=%s",Jr[e]),this.localGoAway=e,this.sendFrame({type:Dt.GoAway,flag:0,streamID:0,length:e})}};function ZD(r={}){return()=>new s1(r)}var Mj=Q("dns4"),Uj=Q("dns6"),Fj=Q("dnsaddr"),Io=Qt(Q("dns"),Fj,Mj,Uj),i1=Qt(Q("ip4"),Q("ip6")),Dl=Qt(ge(i1,Q("tcp")),ge(Io,Q("tcp"))),o1=ge(i1,Q("udp")),Vj=ge(o1,Q("utp")),zj=ge(o1,Q("quic")),qj=ge(o1,Q("quic-v1")),L5=Qt(ge(Dl,Q("ws")),ge(Io,Q("ws"))),Cl=Qt(ge(L5,Q("p2p")),L5),B5=Qt(ge(Dl,Q("wss")),ge(Io,Q("wss")),ge(Dl,Q("tls"),Q("ws")),ge(Io,Q("tls"),Q("ws"))),ka=Qt(ge(B5,Q("p2p")),B5),M5=Qt(ge(Dl,Q("http")),ge(i1,Q("http")),ge(Io,Q("http"))),U5=Qt(ge(Dl,Q("https")),ge(i1,Q("https")),ge(Io,Q("https"))),JD=ge(o1,Q("webrtc-direct"),Q("certhash")),rC=Qt(ge(JD,Q("p2p")),JD),eC=ge(qj,Q("webtransport"),Q("certhash"),Q("certhash")),nC=Qt(ge(eC,Q("p2p")),eC),sC=Qt(ge(Cl,Q("p2p-webrtc-star"),Q("p2p")),ge(ka,Q("p2p-webrtc-star"),Q("p2p")),ge(Cl,Q("p2p-webrtc-star")),ge(ka,Q("p2p-webrtc-star"))),N_e=Qt(ge(Cl,Q("p2p-websocket-star"),Q("p2p")),ge(ka,Q("p2p-websocket-star"),Q("p2p")),ge(Cl,Q("p2p-websocket-star")),ge(ka,Q("p2p-websocket-star"))),iC=Qt(ge(M5,Q("p2p-webrtc-direct"),Q("p2p")),ge(U5,Q("p2p-webrtc-direct"),Q("p2p")),ge(M5,Q("p2p-webrtc-direct")),ge(U5,Q("p2p-webrtc-direct"))),Na=Qt(L5,B5,M5,U5,sC,iC,Dl,Vj,zj,Io,rC,nC),O_e=Qt(ge(Na,Q("p2p-stardust"),Q("p2p")),ge(Na,Q("p2p-stardust"))),Ro=Qt(ge(Na,Q("p2p")),sC,iC,rC,nC,Q("p2p")),tC=Qt(ge(Ro,Q("p2p-circuit"),Ro),ge(Ro,Q("p2p-circuit")),ge(Q("p2p-circuit"),Ro),ge(Na,Q("p2p-circuit")),ge(Q("p2p-circuit"),Na),Q("p2p-circuit")),oC=()=>Qt(ge(tC,oC),tC),gs=oC(),aC=Qt(ge(gs,Ro,gs),ge(Ro,gs),ge(gs,Ro),gs,Ro);var L_e=Qt(ge(gs,Q("webrtc"),Q("p2p")),ge(gs,Q("webrtc")),ge(Na,Q("webrtc"),Q("p2p")),ge(Na,Q("webrtc")),Q("webrtc"));function cC(r){function e(t){let n;try{n=fe(t)}catch{return!1}let s=r(n.protoNames());return s===null?!1:s===!0||s===!1?s:s.length===0}return e}function ge(...r){function e(t){if(t.length<r.length)return null;let n=t;return r.some(s=>(n=typeof s=="function"?s().partialMatch(t):s.partialMatch(t),Array.isArray(n)&&(t=n),n===null)),n}return{toString:function(){return"{ "+r.join(" ")+" }"},input:r,matches:cC(e),partialMatch:e}}function Qt(...r){function e(n){let s=null;return r.some(i=>{let o=typeof i=="function"?i().partialMatch(n):i.partialMatch(n);return o!=null?(s=o,!0):!1}),s}return{toString:function(){return"{ "+r.join(" ")+" }"},input:r,matches:cC(e),partialMatch:e}}function Q(r){let e=r;function t(s){let i;try{i=fe(s)}catch{return!1}let o=i.protoNames();return o.length===1&&o[0]===e}function n(s){return s.length===0?null:s[0]===e?s.slice(1):null}return{toString:function(){return e},matches:t,partialMatch:n}}var a1=C("libp2p:bootstrap"),Kj="bootstrap",$j=50,Hj=12e4,Gj=1e3,c1=class extends $e{timer;list;timeout;components;_init;constructor(e,t={list:[]}){if(t.list==null||t.list.length===0)throw new Error("Bootstrap requires a list of peer addresses");super(),this.components=e,this.timeout=t.timeout??Gj,this.list=[];for(let n of t.list){if(!aC.matches(n)){a1.error("Invalid multiaddr");continue}let s=fe(n),i=s.getPeerId();if(i==null){a1.error("Invalid bootstrap multiaddr without peer id");continue}let o={id:he(i),multiaddrs:[s],protocols:[]};this.list.push(o)}this._init=t}[pa]=this;[Symbol.toStringTag]="@libp2p/bootstrap";isStarted(){return!!this.timer}start(){this.isStarted()||(a1("Starting bootstrap node discovery, discovering peers after %s ms",this.timeout),this.timer=setTimeout(()=>{this._discoverBootstrapPeers().catch(e=>{a1.error(e)})},this.timeout))}async _discoverBootstrapPeers(){if(this.timer!=null)for(let e of this.list){if(await this.components.peerStore.merge(e.id,{tags:{[this._init.tagName??Kj]:{value:this._init.tagValue??$j,ttl:this._init.tagTTL??Hj}}}),this.timer==null)return;this.safeDispatchEvent("peer",{detail:e})}}stop(){this.timer!=null&&clearTimeout(this.timer),this.timer=void 0}};gt(c1,"tag","bootstrap");function uC(r){return e=>new c1(e,r)}async function*F5(r,e={}){let t=r.getReader();try{for(;;){let n=await t.read();if(n.done)return;yield n.value}}finally{e.preventCancel!==!0&&await t.cancel(),t.releaseLock()}}var gC=W(pC(),1);var u1=C("ipni-content-routing"),mC={concurrentRequests:4,timeout:3e4},z5=class{started;httpQueue;shutDownController;clientUrl;timeout;constructor(e,t={}){u1("enabled IPNI routing via",e),this.started=!1,this.shutDownController=new AbortController,this.httpQueue=new Nt({concurrency:t.concurrentRequests??mC.concurrentRequests}),this.clientUrl=e instanceof URL?e:new URL(e),this.timeout=t.timeout??mC.timeout}isStarted(){return this.started}start(){this.started=!0}stop(){this.httpQueue.clear(),this.shutDownController.abort(),this.started=!1}async*findProviders(e,t={}){u1("findProviders starts: %c",e);let n=ot([this.shutDownController.signal,t.signal,AbortSignal.timeout(this.timeout)]),s=De(),i=De();this.httpQueue.add(async()=>(s.resolve(),i.promise));try{await s.promise;let o=`${this.clientUrl}cid/${e.toString()}?cascade=ipfs-dht`,c=await fetch(o,{headers:{Accept:"application/x-ndjson"},signal:n});if(c.body==null)throw new E("IPNI response had no body","ERR_BAD_RESPONSE");for await(let l of(0,gC.default)(F5(c.body)))l.Metadata==="gBI="&&(yield this.mapEvent(l))}catch(o){u1.error("findProviders errored:",o)}finally{n.clear(),i.resolve(),u1("findProviders finished: %c",e)}}mapEvent(e){let t=he(e.Provider.ID),n=[];for(let i of e.Provider.Addrs){let o=fe(i);n.push(o)}return{id:t,multiaddrs:n,protocols:[]}}async provide(){}async put(){}async get(){throw new E("Not found","ERR_NOT_FOUND")}};function yC(r,e={}){return()=>new z5(r,e)}function bC(r,e,t){if(t.length===0){let o="No records given";throw new E(o,"ERR_NO_RECORDS_RECEIVED")}let s=M(e).split("/");if(s.length<3){let o="Record key does not have a selector function";throw new E(o,"ERR_NO_SELECTOR_FUNCTION_FOR_RECORD_KEY")}let i=r[s[1].toString()];if(i==null){let o=`Unrecognized key prefix: ${s[1]}`;throw new E(o,"ERR_UNRECOGNIZED_KEY_PREFIX")}return t.length===1?0:i(e,t)}function Wj(r,e){return 0}var wC={pk:Wj};var oSe=new Uint8Array(0);var Yj=vC,xC=128,Qj=127,Xj=~Qj,jj=Math.pow(2,31);function vC(r,e,t){e=e||[],t=t||0;for(var n=t;r>=jj;)e[t++]=r&255|xC,r/=128;for(;r&Xj;)e[t++]=r&255|xC,r>>>=7;return e[t]=r|0,vC.bytes=t-n+1,e}var Zj=q5,Jj=128,EC=127;function q5(r,n){var t=0,n=n||0,s=0,i=n,o,a=r.length;do{if(i>=a)throw q5.bytes=0,new RangeError("Could not decode varint");o=r[i++],t+=s<28?(o&EC)<<s:(o&EC)*Math.pow(2,s),s+=7}while(o>=Jj);return q5.bytes=i-n,t}var eZ=Math.pow(2,7),tZ=Math.pow(2,14),rZ=Math.pow(2,21),nZ=Math.pow(2,28),sZ=Math.pow(2,35),iZ=Math.pow(2,42),oZ=Math.pow(2,49),aZ=Math.pow(2,56),cZ=Math.pow(2,63),lZ=function(r){return r<eZ?1:r<tZ?2:r<rZ?3:r<nZ?4:r<sZ?5:r<iZ?6:r<oZ?7:r<aZ?8:r<cZ?9:10},uZ={encode:Yj,decode:Zj,encodingLength:lZ},fZ=uZ,K5=fZ;var $5=(r,e,t=0)=>(K5.encode(r,e,t),e),H5=r=>K5.encodingLength(r);var W5=(r,e)=>{let t=e.byteLength,n=H5(r),s=n+H5(t),i=new Uint8Array(s+t);return $5(r,i,0),$5(t,i,n),i.set(e,s),new G5(r,t,e,i)};var G5=class{constructor(e,t,n,s){this.code=e,this.size=t,this.digest=n,this.bytes=s}};var Q5=({name:r,code:e,encode:t})=>new Y5(r,e,t),Y5=class{constructor(e,t,n){this.name=e,this.code=t,this.encode=n}digest(e){if(e instanceof Uint8Array){let t=this.encode(e);return t instanceof Uint8Array?W5(this.code,t):t.then(n=>W5(this.code,n))}else throw Error("Unknown type, must be binary type")}};var _C=r=>async e=>new Uint8Array(await crypto.subtle.digest(r,e)),SC=Q5({name:"sha2-256",code:18,encode:_C("SHA-256")}),gSe=Q5({name:"sha2-512",code:19,encode:_C("SHA-512")});async function Pl(r,e){let t=e.key,s=M(t).split("/");if(s.length<3)return;let i=r[s[1].toString()];if(i==null){let o="Invalid record keytype";throw new E(o,"ERR_INVALID_RECORD_KEY_TYPE")}await i(t,e.value)}var pZ=async(r,e)=>{if(!(r instanceof Uint8Array))throw new E('"key" must be a Uint8Array',"ERR_INVALID_RECORD_KEY_NOT_BUFFER");if(r.byteLength<5)throw new E("invalid public key record","ERR_INVALID_RECORD_KEY_TOO_SHORT");if(M(r.subarray(0,4))!=="/pk/")throw new E("key was not prefixed with /pk/","ERR_INVALID_RECORD_KEY_BAD_PREFIX");let n=r.slice(4),s=await SC.digest(e);if(!be(n,s.bytes))throw new E("public key does not match passed in key","ERR_INVALID_RECORD_HASH_MISMATCH")},AC={pk:pZ};var RC="/lan",IC="/ipfs",TC="/kad/1.0.0",DC="/dht/record",X5="/dht/provider";var gh;(function(r){let e;r.codec=()=>(e==null&&(e=me((t,n,s={})=>{s.lengthDelimited!==!1&&n.fork(),t.key!=null&&t.key.byteLength>0&&(n.uint32(10),n.bytes(t.key)),t.value!=null&&t.value.byteLength>0&&(n.uint32(18),n.bytes(t.value)),t.timeReceived!=null&&t.timeReceived!==""&&(n.uint32(42),n.string(t.timeReceived)),s.lengthDelimited!==!1&&n.ldelim()},(t,n)=>{let s={key:new Uint8Array(0),value:new Uint8Array(0),timeReceived:""},i=n==null?t.len:t.pos+n;for(;t.pos<i;){let o=t.uint32();switch(o>>>3){case 1:s.key=t.bytes();break;case 2:s.value=t.bytes();break;case 5:s.timeReceived=t.string();break;default:t.skipType(o&7);break}}return s})),e),r.encode=t=>pe(t,r.codec()),r.decode=t=>de(t,r.codec())})(gh||(gh={}));function CC(r){let e=r.getUTCFullYear(),t=String(r.getUTCMonth()+1).padStart(2,"0"),n=String(r.getUTCDate()).padStart(2,"0"),s=String(r.getUTCHours()).padStart(2,"0"),i=String(r.getUTCMinutes()).padStart(2,"0"),o=String(r.getUTCSeconds()).padStart(2,"0"),a=r.getUTCMilliseconds(),c=String(a*1e3*1e3).padStart(9,"0");return`${e}-${t}-${n}T${s}:${i}:${o}.${c}Z`}function PC(r){let e=new RegExp("(\\d{4})-(\\d{2})-(\\d{2})T(\\d{2}):(\\d{2}):(\\d{2})\\.(\\d+)Z"),t=String(r).trim().match(e);if(t==null)throw new Error("Invalid format");let n=parseInt(t[1],10),s=parseInt(t[2],10)-1,i=parseInt(t[3],10),o=parseInt(t[4],10),a=parseInt(t[5],10),c=parseInt(t[6],10),l=parseInt(t[7].slice(0,-6),10);return new Date(Date.UTC(n,s,i,o,a,c,l))}var Zt=class{key;value;timeReceived;constructor(e,t,n){if(!(e instanceof Uint8Array))throw new Error("key must be a Uint8Array");if(!(t instanceof Uint8Array))throw new Error("value must be a Uint8Array");this.key=e,this.value=t,this.timeReceived=n}serialize(){return gh.encode(this.prepareSerialize())}prepareSerialize(){return{key:this.key,value:this.value,timeReceived:CC(this.timeReceived)}}static deserialize(e){let t=gh.decode(e);return new Zt(t.key,t.value,new Date(t.timeReceived))}static fromDeserialized(e){let t=PC(e.timeReceived);if(e.key==null)throw new Error("key missing from deserialized object");if(e.value==null)throw new Error("value missing from deserialized object");return new Zt(e.key,e.value,t)}};var f1=globalThis.CustomEvent??Event;async function*Oa(r,e={}){let t=e.concurrency??1/0;t<1&&(t=1/0);let n=e.ordered==null?!1:e.ordered,s=new EventTarget,i=[],o=De(),a=De(),c=!1,l,u=!1;s.addEventListener("task-complete",()=>{a.resolve()}),Promise.resolve().then(async()=>{try{for await(let d of r){if(i.length===t&&(o=De(),await o.promise),u)break;let m={done:!1};i.push(m),d().then(g=>{m.done=!0,m.ok=!0,m.value=g,s.dispatchEvent(new f1("task-complete"))},g=>{m.done=!0,m.err=g,s.dispatchEvent(new f1("task-complete"))})}c=!0,s.dispatchEvent(new f1("task-complete"))}catch(d){l=d,s.dispatchEvent(new f1("task-complete"))}});function f(){return n?i[0]?.done:!!i.find(d=>d.done)}function*h(){for(;i.length>0&&i[0].done;){let d=i[0];if(i.shift(),d.ok)yield d.value;else throw u=!0,o.resolve(),d.err;o.resolve()}}function*p(){for(;f();)for(let d=0;d<i.length;d++)if(i[d].done){let m=i[d];if(i.splice(d,1),d--,m.ok)yield m.value;else throw u=!0,o.resolve(),m.err;o.resolve()}}for(;;){if(f()||(a=De(),await a.promise),l!=null)throw l;if(n?yield*h():yield*p(),c&&i.length===0)break}}var kC;(function(r){let e;r.codec=()=>(e==null&&(e=me((t,n,s={})=>{s.lengthDelimited!==!1&&n.fork(),t.key!=null&&(n.uint32(10),n.bytes(t.key)),t.value!=null&&(n.uint32(18),n.bytes(t.value)),t.author!=null&&(n.uint32(26),n.bytes(t.author)),t.signature!=null&&(n.uint32(34),n.bytes(t.signature)),t.timeReceived!=null&&(n.uint32(42),n.string(t.timeReceived)),s.lengthDelimited!==!1&&n.ldelim()},(t,n)=>{let s={},i=n==null?t.len:t.pos+n;for(;t.pos<i;){let o=t.uint32();switch(o>>>3){case 1:s.key=t.bytes();break;case 2:s.value=t.bytes();break;case 3:s.author=t.bytes();break;case 4:s.signature=t.bytes();break;case 5:s.timeReceived=t.string();break;default:t.skipType(o&7);break}}return s})),e),r.encode=t=>pe(t,r.codec()),r.decode=t=>de(t,r.codec())})(kC||(kC={}));var To;(function(r){let e;(function(a){a.PUT_VALUE="PUT_VALUE",a.GET_VALUE="GET_VALUE",a.ADD_PROVIDER="ADD_PROVIDER",a.GET_PROVIDERS="GET_PROVIDERS",a.FIND_NODE="FIND_NODE",a.PING="PING"})(e=r.MessageType||(r.MessageType={}));let t;(function(a){a[a.PUT_VALUE=0]="PUT_VALUE",a[a.GET_VALUE=1]="GET_VALUE",a[a.ADD_PROVIDER=2]="ADD_PROVIDER",a[a.GET_PROVIDERS=3]="GET_PROVIDERS",a[a.FIND_NODE=4]="FIND_NODE",a[a.PING=5]="PING"})(t||(t={})),function(a){a.codec=()=>Pt(t)}(e=r.MessageType||(r.MessageType={}));let n;(function(a){a.NOT_CONNECTED="NOT_CONNECTED",a.CONNECTED="CONNECTED",a.CAN_CONNECT="CAN_CONNECT",a.CANNOT_CONNECT="CANNOT_CONNECT"})(n=r.ConnectionType||(r.ConnectionType={}));let s;(function(a){a[a.NOT_CONNECTED=0]="NOT_CONNECTED",a[a.CONNECTED=1]="CONNECTED",a[a.CAN_CONNECT=2]="CAN_CONNECT",a[a.CANNOT_CONNECT=3]="CANNOT_CONNECT"})(s||(s={})),function(a){a.codec=()=>Pt(s)}(n=r.ConnectionType||(r.ConnectionType={}));let i;(function(a){let c;a.codec=()=>(c==null&&(c=me((l,u,f={})=>{if(f.lengthDelimited!==!1&&u.fork(),l.id!=null&&(u.uint32(10),u.bytes(l.id)),l.addrs!=null)for(let h of l.addrs)u.uint32(18),u.bytes(h);l.connection!=null&&(u.uint32(24),r.ConnectionType.codec().encode(l.connection,u)),f.lengthDelimited!==!1&&u.ldelim()},(l,u)=>{let f={addrs:[]},h=u==null?l.len:l.pos+u;for(;l.pos<h;){let p=l.uint32();switch(p>>>3){case 1:f.id=l.bytes();break;case 2:f.addrs.push(l.bytes());break;case 3:f.connection=r.ConnectionType.codec().decode(l);break;default:l.skipType(p&7);break}}return f})),c),a.encode=l=>pe(l,a.codec()),a.decode=l=>de(l,a.codec())})(i=r.Peer||(r.Peer={}));let o;r.codec=()=>(o==null&&(o=me((a,c,l={})=>{if(l.lengthDelimited!==!1&&c.fork(),a.type!=null&&(c.uint32(8),r.MessageType.codec().encode(a.type,c)),a.clusterLevelRaw!=null&&(c.uint32(80),c.int32(a.clusterLevelRaw)),a.key!=null&&(c.uint32(18),c.bytes(a.key)),a.record!=null&&(c.uint32(26),c.bytes(a.record)),a.closerPeers!=null)for(let u of a.closerPeers)c.uint32(66),r.Peer.codec().encode(u,c);if(a.providerPeers!=null)for(let u of a.providerPeers)c.uint32(74),r.Peer.codec().encode(u,c);l.lengthDelimited!==!1&&c.ldelim()},(a,c)=>{let l={closerPeers:[],providerPeers:[]},u=c==null?a.len:a.pos+c;for(;a.pos<u;){let f=a.uint32();switch(f>>>3){case 1:l.type=r.MessageType.codec().decode(a);break;case 10:l.clusterLevelRaw=a.int32();break;case 2:l.key=a.bytes();break;case 3:l.record=a.bytes();break;case 8:l.closerPeers.push(r.Peer.codec().decode(a,a.uint32()));break;case 9:l.providerPeers.push(r.Peer.codec().decode(a,a.uint32()));break;default:a.skipType(f&7);break}}return l})),o),r.encode=a=>pe(a,r.codec()),r.decode=a=>de(a,r.codec())})(To||(To={}));var Xt=To.MessageType,gZ=To.ConnectionType,LC=Object.keys(Xt),At=class{type;key;clusterLevelRaw;closerPeers;providerPeers;record;constructor(e,t,n){if(!(t instanceof Uint8Array))throw new Error("Key must be a Uint8Array");this.type=e,this.key=t,this.clusterLevelRaw=n,this.closerPeers=[],this.providerPeers=[],this.record=void 0}get clusterLevel(){let e=this.clusterLevelRaw-1;return e<0?0:e}set clusterLevel(e){this.clusterLevelRaw=e}serialize(){return To.encode({key:this.key,type:this.type,clusterLevelRaw:this.clusterLevelRaw,closerPeers:this.closerPeers.map(NC),providerPeers:this.providerPeers.map(NC),record:this.record==null?void 0:this.record.serialize().subarray()})}static deserialize(e){let t=To.decode(e),n=new At(t.type??To.MessageType.PUT_VALUE,t.key??Uint8Array.from([]),t.clusterLevelRaw??0);return n.closerPeers=t.closerPeers.map(OC),n.providerPeers=t.providerPeers.map(OC),t.record?.length!=null&&(n.record=Zt.deserialize(t.record)),n}};function NC(r){return{id:r.id.toBytes(),addrs:(r.multiaddrs??[]).map(t=>t.bytes),connection:gZ.CONNECTED}}function OC(r){if(r.id==null)throw new Error("Invalid peer in message");return{id:_t(r.id),multiaddrs:(r.addrs??[]).map(e=>fe(e)),protocols:[]}}function j5(r,e={}){let t={...r,name:"SEND_QUERY",type:0,messageName:r.type,messageType:LC.indexOf(r.type.toString())};return e.onProgress?.(new tt("kad-dht:query:send-query",{detail:t})),t}function yh(r,e={}){let t={...r,name:"PEER_RESPONSE",type:1,messageName:r.messageType,closer:r.closer!=null?r.closer:[],providers:r.providers!=null?r.providers:[]};return e.onProgress?.(new tt("kad-dht:query:peer-response",{detail:t})),t}function h1(r,e={}){let t={...r,name:"FINAL_PEER",type:2};return e.onProgress?.(new tt("kad-dht:query:final-peer",{detail:t})),t}function Vr(r,e={}){let t={...r,name:"QUERY_ERROR",type:3};return e.onProgress?.(new tt("kad-dht:query:query-error",{detail:t})),t}function Z5(r,e={}){let t={...r,name:"PROVIDER",type:4};return e.onProgress?.(new tt("kad-dht:query:provider",{detail:t})),t}function bh(r,e={}){let t={...r,name:"VALUE",type:5};return e.onProgress?.(new tt("kad-dht:query:value",{detail:t})),t}function J5(r,e={}){let t={...r,name:"DIAL_PEER",type:7};return e.onProgress?.(new tt("kad-dht:query:dial-peer",{detail:t})),t}var yZ=$("/pk/");function kl(r){return{...r,multiaddrs:r.multiaddrs.filter(e=>{let[[t,n]]=e.stringTuples();if(t===53||t===54||t===55)return n!=="localhost";if(t!==4&&t!==6||n==null)return!1;let s=Vn(n);return s==null?!0:!s})}}function Nl(r){return{...r,multiaddrs:r.multiaddrs.filter(e=>{let[[t,n]]=e.stringTuples();if(n==="localhost")return!0;if(t!==4&&t!==6||n==null)return!1;let s=Vn(n);return s??!1})}}async function Do(r){return(await xu.digest(r)).digest}async function ys(r){return Do(r.toBytes())}function Ai(r){return new Ce(`${DC}/${M(r,"base32")}`,!1)}function BC(r){return Ee([yZ,r.toBytes()])}function MC(r){return M(r.subarray(0,4))==="/pk/"}function UC(r){return _t(r.subarray(4))}function ey(r,e){let t=new Date;return new Zt(r,e,t).serialize()}function FC(r,e=100){let t;return()=>{clearTimeout(t),t=setTimeout(()=>{r()},e)}}var d1=class{log;components;validators;selectors;peerRouting;queryManager;network;constructor(e,t){let{validators:n,selectors:s,peerRouting:i,queryManager:o,network:a,lan:c}=t;this.components=e,this.log=C(`libp2p:kad-dht:${c?"lan":"wan"}:content-fetching`),this.validators=n,this.selectors=s,this.peerRouting=i,this.queryManager=o,this.network=a}async putLocal(e,t){let n=Ai(e);await this.components.datastore.put(n,t)}async getLocal(e){this.log("getLocal %b",e);let t=Ai(e);this.log("fetching record for key %k",t);let n=await this.components.datastore.get(t);this.log("found %k in local datastore",t);let s=Zt.deserialize(n);return await Pl(this.validators,s),s}async*sendCorrectionRecord(e,t,n,s={}){this.log("sendCorrection for %b",e);let i=ey(e,n);for(let{value:o,from:a}of t){if(be(o,n)){this.log("record was ok");continue}if(this.components.peerId.equals(a)){try{let u=Ai(e);this.log(`Storing corrected record for key ${u.toString()}`),await this.components.datastore.put(u,i.subarray())}catch(u){this.log.error("Failed error correcting self",u)}continue}let c=!1,l=new At(Xt.PUT_VALUE,e,0);l.record=Zt.deserialize(i);for await(let u of this.network.sendRequest(a,l,s))u.name==="PEER_RESPONSE"&&u.record!=null&&be(u.record.value,Zt.deserialize(i).value)&&(c=!0),yield u;c||(yield Vr({from:a,error:new E("value not put correctly","ERR_PUT_VALUE_INVALID")},s)),this.log.error("Failed error correcting entry")}}async*put(e,t,n={}){this.log("put key %b value %b",e,t);let s=ey(e,t),i=Ai(e);this.log(`storing record for key ${i.toString()}`),await this.components.datastore.put(i,s.subarray()),yield*Re(this.peerRouting.getClosestPeers(e,{signal:n.signal}),o=>Qn(o,a=>async()=>{if(a.name!=="FINAL_PEER")return[a];let c=[],l=new At(Xt.PUT_VALUE,e,0);l.record=Zt.deserialize(s),this.log("send put to %p",a.peer.id);for await(let u of this.network.sendRequest(a.peer.id,l,n))c.push(u),u.name==="PEER_RESPONSE"&&(u.record!=null&&be(u.record.value,Zt.deserialize(s).value)||c.push(Vr({from:a.peer.id,error:new E("value not put correctly","ERR_PUT_VALUE_INVALID")},n)));return c}),o=>Oa(o,{ordered:!1,concurrency:3}),async function*(o){for await(let a of o)yield*a})}async*get(e,t={}){this.log("get %b",e);let n=[];for await(let a of this.getMany(e,t))a.name==="VALUE"&&n.push(a),yield a;if(n.length===0)return;let s=n.map(a=>a.value),i=0;try{i=bC(this.selectors,e,s)}catch(a){if(a.code!=="ERR_NO_SELECTOR_FUNCTION_FOR_RECORD_KEY")throw a}let o=s[i];if(this.log("GetValue %b %b",e,o),o==null)throw new E("best value was not found","ERR_NOT_FOUND");yield*this.sendCorrectionRecord(e,n,o,t),yield n[i]}async*getMany(e,t={}){this.log("getMany values for %b",e);try{let i=await this.getLocal(e);yield bh({value:i.value,from:this.components.peerId},t)}catch(i){this.log("error getting local value for %b",e,i)}let n=this,s=async function*({peer:i,signal:o}){for await(let a of n.peerRouting.getValueOrPeers(i,e,{signal:o}))yield a,a.name==="PEER_RESPONSE"&&a.record!=null&&(yield bh({from:i,value:a.record.value},t))};yield*this.queryManager.run(e,s,t)}};var p1=class{log;components;network;peerRouting;queryManager;routingTable;providers;constructor(e,t){let{network:n,peerRouting:s,queryManager:i,routingTable:o,providers:a,lan:c}=t;this.components=e,this.log=C(`libp2p:kad-dht:${c?"lan":"wan"}:content-routing`),this.network=n,this.peerRouting=s,this.queryManager=i,this.routingTable=o,this.providers=a}async*provide(e,t,n={}){this.log("provide %s",e),await this.providers.addProvider(e,this.components.peerId);let s=new At(Xt.ADD_PROVIDER,e.multihash.bytes,0);s.providerPeers=[{id:this.components.peerId,multiaddrs:t,protocols:[]}];let i=0,o=a=>async()=>{if(a.name!=="FINAL_PEER")return[a];let c=[];this.log("putProvider %s to %p",e,a.peer.id);try{this.log("sending provider record for %s to %p",e,a.peer.id);for await(let l of this.network.sendMessage(a.peer.id,s,n))l.name==="PEER_RESPONSE"&&(this.log("sent provider record for %s to %p",e,a.peer.id),i++),c.push(l)}catch(l){this.log.error("error sending provide record to peer %p",a.peer.id,l),c.push(Vr({from:a.peer.id,error:l},n))}return c};yield*Re(this.peerRouting.getClosestPeers(e.multihash.bytes,n),a=>Qn(a,c=>o(c)),a=>Oa(a,{ordered:!1,concurrency:3}),async function*(a){for await(let c of a)yield*c}),this.log("sent provider records to %d peers",i)}async*findProviders(e,t){let n=this.routingTable.kBucketSize,s=e.multihash.bytes,i=this;this.log("findProviders %c",e);let o=await this.providers.getProviders(e);if(o.length>0){let l=[];for(let u of o.slice(0,n))try{let f=await this.components.peerStore.get(u);l.push({id:u,multiaddrs:f.addresses.map(({multiaddr:h})=>h),protocols:f.protocols})}catch(f){if(f.code!=="ERR_NOT_FOUND")throw f;this.log("no peer store entry for %p",u)}yield yh({from:this.components.peerId,messageType:Xt.GET_PROVIDERS,providers:l},t),yield Z5({from:this.components.peerId,providers:l},t)}if(o.length>=n)return;let a=async function*({peer:l,signal:u}){let f=new At(Xt.GET_PROVIDERS,s,0);yield*i.network.sendRequest(l,f,{...t,signal:u})},c=new Set(o.map(l=>l.toString()));for await(let l of this.queryManager.run(s,a,t))if(yield l,l.name==="PEER_RESPONSE"){this.log("Found %d provider entries for %c and %d closer peers",l.providers.length,e,l.closer.length);let u=[];for(let f of l.providers)c.has(f.id.toString())||(c.add(f.id.toString()),u.push(f));if(u.length>0&&(yield Z5({from:l.from,providers:u},t)),c.size===n)return}}};var m1=class extends $e{log;protocol;running;components;constructor(e,t){super();let{protocol:n,lan:s}=t;this.components=e,this.log=C(`libp2p:kad-dht:${s?"lan":"wan"}:network`),this.running=!1,this.protocol=n}async start(){this.running||(this.running=!0)}async stop(){this.running=!1}isStarted(){return this.running}async*sendRequest(e,t,n={}){if(!this.running)return;this.log("sending %s to %p",t.type,e),yield J5({peer:e},n),yield j5({to:e,type:t.type},n);let s;try{let o=await(await this.components.connectionManager.openConnection(e,n)).newStream(this.protocol,n),a=await this._writeReadMessage(o,t.serialize(),n);yield yh({from:e,messageType:a.type,closer:a.closerPeers,providers:a.providerPeers,record:a.record},n)}catch(i){yield Vr({from:e,error:i},n)}finally{s?.close()}}async*sendMessage(e,t,n={}){if(!this.running)return;this.log("sending %s to %p",t.type,e),yield J5({peer:e},n),yield j5({to:e,type:t.type},n);let s;try{let o=await(await this.components.connectionManager.openConnection(e,n)).newStream(this.protocol,n);await this._writeMessage(o,t.serialize(),n),yield yh({from:e,messageType:t.type},n)}catch(i){yield Vr({from:e,error:i},n)}finally{s?.close()}}async _writeMessage(e,t,n){n.signal!=null&&(e=Er(e,n.signal)),await Re([t],s=>wt(s),e,$r)}async _writeReadMessage(e,t,n){n.signal!=null&&(e=Er(e,n.signal));let s=await Re([t],o=>wt(o),e,o=>kt(o),async o=>{let a=await fs(o);if(a!=null)return a;throw new E("No message received","ERR_NO_MESSAGE_RECEIVED")}),i=At.deserialize(s);return i.closerPeers.forEach(o=>{this.dispatchEvent(new tt("peer",{detail:o}))}),i.providerPeers.forEach(o=>{this.dispatchEvent(new tt("peer",{detail:o}))}),i}};var g1=class{originDhtKey;capacity;peerDistances;constructor(e,t){this.originDhtKey=e,this.capacity=t,this.peerDistances=[]}get length(){return this.peerDistances.length}get peers(){return this.peerDistances.map(e=>e.peerId)}async add(e){if(this.peerDistances.find(s=>s.peerId.equals(e))!=null)return;let t=await ys(e),n={peerId:e,distance:Si(this.originDhtKey,t)};this.peerDistances.push(n),this.peerDistances.sort((s,i)=>Qp(s.distance,i.distance)),this.peerDistances=this.peerDistances.slice(0,this.capacity)}async anyCloser(e){if(e.length===0)return!1;if(this.length===0)return!0;let t=await Promise.all(e.map(ys)),n=this.peerDistances[this.peerDistances.length-1].distance;for(let s of t){let i=Si(this.originDhtKey,s);if(Qp(i,n)<0)return!0}return!1}};var y1=class{components;log;routingTable;network;validators;queryManager;constructor(e,t){let{routingTable:n,network:s,validators:i,queryManager:o,lan:a}=t;this.components=e,this.routingTable=n,this.network=s,this.validators=i,this.queryManager=o,this.log=C(`libp2p:kad-dht:${a?"lan":"wan"}:peer-routing`)}async findPeerLocal(e){let t,n=await this.routingTable.find(e);if(n!=null){this.log("findPeerLocal found %p in routing table",e);try{t=await this.components.peerStore.get(n)}catch(s){if(s.code!=="ERR_NOT_FOUND")throw s}}if(t==null)try{t=await this.components.peerStore.get(e)}catch(s){if(s.code!=="ERR_NOT_FOUND")throw s}if(t!=null)return this.log("findPeerLocal found %p in peer store",e),{id:t.id,multiaddrs:t.addresses.map(s=>s.multiaddr),protocols:[]}}async*_getValueSingle(e,t,n={}){let s=new At(Xt.GET_VALUE,t,0);yield*this.network.sendRequest(e,s,n)}async*getPublicKeyFromNode(e,t={}){let n=BC(e);for await(let s of this._getValueSingle(e,n,t))if(yield s,s.name==="PEER_RESPONSE"&&s.record!=null){let i=await _r(Vd.marshalPublicKey({bytes:s.record.value}));if(!i.equals(e))throw new E("public key does not match id","ERR_PUBLIC_KEY_DOES_NOT_MATCH_ID");if(i.publicKey==null)throw new E("public key missing","ERR_PUBLIC_KEY_MISSING");yield bh({from:e,value:i.publicKey},t)}throw new E(`Node not responding with its public key: ${e.toString()}`,"ERR_INVALID_RECORD")}async*findPeer(e,t={}){this.log("findPeer %p",e);let n=await this.findPeerLocal(e);if(n!=null){this.log("found local"),yield h1({from:this.components.peerId,peer:n},t);return}let s=this,i=async function*({peer:a,signal:c}){let l=new At(Xt.FIND_NODE,e.toBytes(),0);for await(let u of s.network.sendRequest(a,l,{...t,signal:c}))if(yield u,u.name==="PEER_RESPONSE"){let f=u.closer.find(h=>h.id.equals(e));f!=null&&(yield h1({from:u.from,peer:f},t))}},o=!1;for await(let a of this.queryManager.run(e.toBytes(),i,t))a.name==="FINAL_PEER"&&(o=!0),yield a;o||(yield Vr({from:this.components.peerId,error:new E("Not found","ERR_NOT_FOUND")},t))}async*getClosestPeers(e,t={}){this.log("getClosestPeers to %b",e);let n=await Do(e),s=this.routingTable.closestPeers(n),i=this,o=new g1(n,this.routingTable.kBucketSize);await Promise.all(s.map(async c=>{await o.add(c)}));let a=async function*({peer:c,signal:l}){i.log("closerPeersSingle %s from %p",M(e,"base32"),c);let u=new At(Xt.FIND_NODE,e,0);yield*i.network.sendRequest(c,u,{...t,signal:l})};for await(let c of this.queryManager.run(e,a,t))yield c,c.name==="PEER_RESPONSE"&&await Promise.all(c.closer.map(async l=>{await o.add(l.id)}));this.log("found %d peers close to %b",o.length,e);for(let c of o.peers)try{let l=await this.components.peerStore.get(c);yield h1({from:this.components.peerId,peer:{id:c,multiaddrs:l.addresses.map(({multiaddr:u})=>u),protocols:l.protocols}},t)}catch(l){if(l.code!=="ERR_NOT_FOUND")throw l}}async*getValueOrPeers(e,t,n={}){for await(let s of this._getValueSingle(e,t,n)){if(s.name==="PEER_RESPONSE"&&s.record!=null)try{await this._verifyRecordOnline(s.record)}catch{let o="invalid record received, discarded";this.log(o),yield Vr({from:s.from,error:new E(o,"ERR_INVALID_RECORD")},n);continue}yield s}}async _verifyRecordOnline(e){if(e.timeReceived==null)throw new E("invalid record received","ERR_INVALID_RECORD");await Pl(this.validators,new Zt(e.key,e.value,e.timeReceived))}async getCloserPeersOffline(e,t){let n=await Do(e),s=this.routingTable.closestPeers(n),i=[];for(let o of s)if(!o.equals(t))try{let a=await this.components.peerStore.get(o);i.push({id:o,multiaddrs:a.addresses.map(({multiaddr:c})=>c),protocols:a.protocols})}catch(a){if(a.code!=="ERR_NOT_FOUND")throw a}return i.length>0?this.log("getCloserPeersOffline found %d peer(s) closer to %b than %p",i.length,e,t):this.log("getCloserPeersOffline could not find peer closer to %b than %p",e,t),i}};var qC=W(zC(),1);var ry=W(ac(),1);var Ri=C("libp2p:kad-dht:providers"),b1=class{components;cache;cleanupInterval;provideValidity;syncQueue;started;cleaner;constructor(e,t={}){let{cacheSize:n,cleanupInterval:s,provideValidity:i}=t;this.components=e,this.cleanupInterval=s??36e5,this.provideValidity=i??864e5,this.cache=(0,qC.default)(n??256),this.syncQueue=new Nt({concurrency:1}),this.started=!1}isStarted(){return this.started}async start(){this.started||(this.started=!0,this.cleaner=setInterval(()=>{this._cleanup().catch(e=>{Ri.error(e)})},this.cleanupInterval))}async stop(){this.started=!1,this.cleaner!=null&&(clearInterval(this.cleaner),this.cleaner=void 0)}async _cleanup(){await this.syncQueue.add(async()=>{let e=Date.now(),t=0,n=0,s=new Map,i=this.components.datastore.batch(),o=this.components.datastore.query({prefix:X5});for await(let a of o)try{let{cid:c,peerId:l}=KC(a.key),u=$C(a.value).getTime(),f=Date.now(),h=f-u,p=h>this.provideValidity;if(Ri("comparing: %d - %d = %d > %d %s",f,u,h,this.provideValidity,p?"(expired)":""),p){n++,i.delete(a.key);let d=s.get(c)??new Set;d.add(l),s.set(c,d)}t++}catch(c){Ri.error(c.message)}s.size>0?(Ri("deleting %d / %d entries",n,t),await i.commit()):Ri("nothing to delete");for(let[a,c]of s){let l=wh(a),u=this.cache.get(l);if(u!=null){for(let f of c)u.delete(f);u.size===0?this.cache.remove(l):this.cache.set(l,u)}}Ri("Cleanup successful (%dms)",Date.now()-e)})}async _getProvidersMap(e){let t=wh(e),n=this.cache.get(t);return n==null&&(n=await vZ(this.components.datastore,e),this.cache.set(t,n)),n}async addProvider(e,t){await this.syncQueue.add(async()=>{Ri("%p provides %s",t,e);let n=await this._getProvidersMap(e);Ri("loaded %s provs",n.size);let s=new Date;n.set(t.toString(),s);let i=wh(e);this.cache.set(i,n),await EZ(this.components.datastore,e,t,s)})}async getProviders(e){return this.syncQueue.add(async()=>(Ri("get providers for %s",e),[...(await this._getProvidersMap(e)).keys()].map(n=>he(n))),{throwOnTimeout:!0})}};function wh(r){let e=typeof r=="string"?r:M(r.multihash.bytes,"base32");return`${X5}/${e}`}async function EZ(r,e,t,n){let s=[wh(e),"/",t.toString()].join(""),i=new Ce(s),o=Uint8Array.from(ry.default.encode(n.getTime()));await r.put(i,o)}function KC(r){let e=r.toString().split("/");if(e.length!==5)throw new Error(`incorrectly formatted provider entry key in datastore: ${r.toString()}`);return{cid:e[3],peerId:e[4]}}async function vZ(r,e){let t=new Map,n=r.query({prefix:wh(e)});for await(let s of n){let{peerId:i}=KC(s.key);t.set(i,$C(s.value))}return t}function $C(r){return new Date(ry.default.decode(r))}var La=W(fn(),1);var _Z=BigInt("0xFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF");async function*HC(r){let{key:e,startingPeer:t,ourPeerId:n,signal:s,query:i,alpha:o,pathIndex:a,numPaths:c,cleanUp:l,queryFuncTimeout:u,log:f,peersSeen:h}=r,p=new Nt({concurrency:o}),d=await Do(e);function m(g,y){if(g==null)return;h.add(g);let b=BigInt("0x"+M(Si(y,d),"base16"));p.add(async()=>{let w=[s];u!=null&&w.push(AbortSignal.timeout(u));let v=ot(w);try{for await(let x of i({key:e,peer:g,signal:v,pathIndex:a,numPaths:c})){if(v.aborted)return;if(x.name==="PEER_RESPONSE")for(let _ of x.closer){if(h.has(_.id)){f("already seen %p in query",_.id);continue}if(n.equals(_.id)){f("not querying ourselves");continue}let S=await ys(_.id);if(BigInt("0x"+M(Si(S,d),"base16"))>b){f("skipping %p as they are not closer to %b than %p",_.id,e,g);continue}f("querying closer peer %p",_.id),m(_.id,S)}p.emit("completed",x)}}catch(x){if(!s.aborted)return Vr({from:g,error:x},r)}finally{v.clear()}},{priority:_Z-b}).catch(w=>{f.error(w)})}m(t,await ys(t)),yield*SZ(p,s,l,f)}async function*SZ(r,e,t,n){let s=De(),i=!0,o=[],a=()=>{i&&(n("clean up queue, results %d, queue size %d, pending tasks %d",o.length,r.size,r.pending),i=!1,r.clear(),o.splice(0,o.length))};for(r.on("completed",c=>{o.push(c),s.resolve()}),r.on("error",c=>{n("queue error",c),a(),s.reject(c)}),r.on("idle",()=>{n("queue idle"),i=!1,s.resolve()}),e.addEventListener("abort",()=>{n("abort queue");let c=i;a(),c&&s.reject(new E("Query aborted","ERR_QUERY_ABORTED"))}),t.addEventListener("cleanup",()=>{a(),s.resolve()});i;)for(await s.promise,s=De();o.length>0;){let c=o.shift();c!=null&&(yield c)}yield*o}var x1=class{components;lan;disjointPaths;alpha;shutDownController;running;queries;metrics;routingTable;initialQuerySelfHasRun;constructor(e,t){let{lan:n=!1,disjointPaths:s=20,alpha:i=3}=t;this.components=e,this.disjointPaths=s??20,this.running=!1,this.alpha=i??3,this.lan=n,this.queries=0,this.initialQuerySelfHasRun=t.initialQuerySelfHasRun,this.routingTable=t.routingTable,this.shutDownController=new AbortController;try{La.setMaxListeners!=null&&(0,La.setMaxListeners)(1/0,this.shutDownController.signal)}catch{}}isStarted(){return this.running}async start(){this.running=!0,this.components.metrics!=null&&this.metrics==null&&(this.metrics={runningQueries:this.components.metrics.registerMetric(`libp2p_kad_dht_${this.lan?"lan":"wan"}_running_queries`),queryTime:this.components.metrics.registerMetric(`libp2p_kad_dht_${this.lan?"lan":"wan"}_query_time_seconds`)})}async stop(){this.running=!1,this.shutDownController.abort()}async*run(e,t,n={}){if(!this.running)throw new Error("QueryManager not started");let s=this.metrics?.queryTime.timer();if(n.signal==null){n.signal=AbortSignal.timeout(3e4);try{La.setMaxListeners!=null&&(0,La.setMaxListeners)(1/0,n.signal)}catch{}}let i=ot([this.shutDownController.signal,n.signal]);try{La.setMaxListeners!=null&&(0,La.setMaxListeners)(1/0,i)}catch{}let o=C(`libp2p:kad-dht:${this.lan?"lan":"wan"}:query:`+M(e,"base58btc")),a=Date.now(),c=new $e;try{n.isSelfQuery!==!0&&this.initialQuerySelfHasRun!=null&&(o("waiting for initial query-self query before continuing"),await Promise.race([new Promise((d,m)=>{i.addEventListener("abort",()=>{m(new cn("Query was aborted before self-query ran"))})}),this.initialQuerySelfHasRun.promise]),this.initialQuerySelfHasRun=void 0),o("query:start"),this.queries++,this.metrics?.runningQueries.update(this.queries);let l=await Do(e),u=this.routingTable.closestPeers(l),f=u.slice(0,Math.min(this.disjointPaths,u.length));if(u.length===0){o.error("Running query with no peers");return}let h=new Ar,p=f.map((d,m)=>HC({key:e,startingPeer:d,ourPeerId:this.components.peerId,signal:i,query:t,pathIndex:m,numPaths:f.length,alpha:this.alpha,cleanUp:c,queryFuncTimeout:n.queryFuncTimeout,log:o,peersSeen:h,onProgress:n.onProgress}));for await(let d of nr(...p))yield d,d.name==="QUERY_ERROR"&&o("error",d.error)}catch(l){if(!(!this.running&&l.code==="ERR_QUERY_ABORTED"))throw l}finally{i.clear(),this.queries--,this.metrics?.runningQueries.update(this.queries),s?.(),c.dispatchEvent(new tt("cleanup")),o("query:done in %dms",Date.now()-a)}}};var iy=W(fn(),1);function RZ(r){return r[Symbol.asyncIterator]!=null}function IZ(r){if(RZ(r))return(async()=>{let e=0;for await(let t of r)e++;return e})();{let e=0;for(let t of r)e++;return e}}var E1=IZ;var v1=class extends Error{constructor(e){super(e),this.name="TimeoutError"}},ny=class extends Error{constructor(e){super(),this.name="AbortError",this.message=e}},GC=r=>globalThis.DOMException===void 0?new ny(r):new DOMException(r),WC=r=>{let e=r.reason===void 0?GC("This operation was aborted."):r.reason;return e instanceof Error?e:GC(e)};function sy(r,e){let{milliseconds:t,fallback:n,message:s,customTimers:i={setTimeout,clearTimeout}}=e,o,c=new Promise((l,u)=>{if(typeof t!="number"||Math.sign(t)!==1)throw new TypeError(`Expected \`milliseconds\` to be a positive number, got \`${t}\``);if(e.signal){let{signal:h}=e;h.aborted&&u(WC(h)),h.addEventListener("abort",()=>{u(WC(h))})}if(t===Number.POSITIVE_INFINITY){r.then(l,u);return}let f=new v1;o=i.setTimeout.call(void 0,()=>{if(n){try{l(n())}catch(h){u(h)}return}typeof r.cancel=="function"&&r.cancel(),s===!1?l():s instanceof Error?u(s):(f.message=s??`Promise timed out after ${t} milliseconds`,u(f))},t),(async()=>{try{l(await r)}catch(h){u(h)}})()}).finally(()=>{c.clear()});return c.clear=()=>{i.clearTimeout.call(void 0,o),o=void 0},c}var TZ=r=>{let e=r.on||r.addListener||r.addEventListener,t=r.off||r.removeListener||r.removeEventListener;if(!e||!t)throw new TypeError("Emitter is not compatible");return{addListener:e.bind(r),removeListener:t.bind(r)}};function DZ(r,e,t){let n,s=new Promise((i,o)=>{if(t={rejectionEvents:["error"],multiArgs:!1,resolveImmediately:!1,...t},!(t.count>=0&&(t.count===Number.POSITIVE_INFINITY||Number.isInteger(t.count))))throw new TypeError("The `count` option should be at least 0 or more");t.signal?.throwIfAborted();let a=[e].flat(),c=[],{addListener:l,removeListener:u}=TZ(r),f=(...p)=>{let d=t.multiArgs?p:p[0];t.filter&&!t.filter(d)||(c.push(d),t.count===c.length&&(n(),i(c)))},h=p=>{n(),o(p)};n=()=>{for(let p of a)u(p,f);for(let p of t.rejectionEvents)u(p,h)};for(let p of a)l(p,f);for(let p of t.rejectionEvents)l(p,h);t.signal&&t.signal.addEventListener("abort",()=>{h(t.signal.reason)},{once:!0}),t.resolveImmediately&&i(c)});if(s.cancel=n,typeof t.timeout=="number"){let i=sy(s,{milliseconds:t.timeout});return i.cancel=n,i}return s}function YC(r,e,t){typeof t=="function"&&(t={filter:t}),t={...t,count:1,resolveImmediately:!1};let n=DZ(r,e,t),s=n.then(i=>i[0]);return s.cancel=n.cancel,s}var _1=class{log;components;peerRouting;routingTable;count;interval;initialInterval;queryTimeout;started;timeoutId;controller;initialQuerySelfHasRun;querySelfPromise;constructor(e,t){let{peerRouting:n,lan:s,count:i,interval:o,queryTimeout:a,routingTable:c}=t;this.components=e,this.log=C(`libp2p:kad-dht:${s?"lan":"wan"}:query-self`),this.started=!1,this.peerRouting=n,this.routingTable=c,this.count=i??20,this.interval=o??3e5,this.initialInterval=t.initialInterval??1e3,this.queryTimeout=a??5e3,this.initialQuerySelfHasRun=t.initialQuerySelfHasRun}isStarted(){return this.started}start(){this.started||(this.started=!0,clearTimeout(this.timeoutId),this.timeoutId=setTimeout(()=>{this.querySelf().catch(e=>{this.log.error("error running self-query",e)})},this.initialInterval))}stop(){this.started=!1,this.timeoutId!=null&&clearTimeout(this.timeoutId),this.controller!=null&&this.controller.abort()}async querySelf(){if(!this.started){this.log("skip self-query because we are not started");return}if(this.querySelfPromise!=null)return this.log("joining existing self query"),this.querySelfPromise.promise;if(this.querySelfPromise=De(),this.routingTable.size===0&&await YC(this.routingTable,"peer:add"),this.started){this.controller=new AbortController;let e=ot([this.controller.signal,AbortSignal.timeout(this.queryTimeout)]);try{iy.setMaxListeners!=null&&(0,iy.setMaxListeners)(1/0,e)}catch{}try{this.log("run self-query, look for %d peers timing out after %dms",this.count,this.queryTimeout);let t=await Re(this.peerRouting.getClosestPeers(this.components.peerId.toBytes(),{signal:e,isSelfQuery:!0}),n=>Li(n,this.count),async n=>E1(n));this.log("self-query ran successfully - found %d peers",t),this.initialQuerySelfHasRun!=null&&(this.initialQuerySelfHasRun.resolve(),this.initialQuerySelfHasRun=void 0)}catch(t){this.log.error("self-query error",t)}finally{e.clear()}}this.querySelfPromise.resolve(),this.querySelfPromise=void 0,this.started&&(this.timeoutId=setTimeout(()=>{this.querySelf().catch(e=>{this.log.error("error running self-query",e)})},this.interval))}};function QC(r,e){if(r===e)return!0;if(r.length!==e.length)return!1;for(let t=0,n=r.length;t<n;++t)if(r[t]!==e[t])return!1;return!0}function oy(){return{contacts:[],dontSplit:!1,left:null,right:null}}function xh(r,e){if(!(e instanceof Uint8Array))throw new TypeError(r+" is not a Uint8Array")}var Ba=class extends $e{localNodeId;root;numberOfNodesPerKBucket;numberOfNodesToPing;distance;arbiter;constructor(e){super(),this.localNodeId=e.localNodeId,this.numberOfNodesPerKBucket=e.numberOfNodesPerKBucket??20,this.numberOfNodesToPing=e.numberOfNodesToPing??3,this.distance=e.distance??Ba.distance,this.arbiter=e.arbiter??Ba.arbiter,xh("option.localNodeId as parameter 1",this.localNodeId),this.root=oy()}static arbiter(e,t){return(e.vectorClock??0)>(t.vectorClock??0)?e:t}static distance(e,t){let n=0,s=0,i=Math.min(e.length,t.length),o=Math.max(e.length,t.length);for(;s<i;++s)n=n*256+(e[s]^t[s]);for(;s<o;++s)n=n*256+255;return n}add(e){xh("contact.id",e?.id);let t=0,n=this.root;for(;n.contacts===null;)n=this._determineNode(n,e.id,t++);let s=this._indexOf(n,e.id);return s>=0?(this._update(n,s,e),this):n.contacts.length<this.numberOfNodesPerKBucket?(n.contacts.push(e),this.safeDispatchEvent("added",{detail:e}),this):n.dontSplit?(this.safeDispatchEvent("ping",{detail:{oldContacts:n.contacts.slice(0,this.numberOfNodesToPing),newContact:e}}),this):(this._split(n,t),this.add(e))}closest(e,t=1/0){if(xh("id",e),!Number.isInteger(t)&&t!==1/0||t<=0)throw new TypeError("n is not positive number");let n=[];for(let s=[this.root],i=0;s.length>0&&n.length<t;){let o=s.pop();if(o!=null)if(o.contacts===null){let a=this._determineNode(o,e,i++);s.push(o.left===a?o.right:o.left),s.push(a)}else n=n.concat(o.contacts)}return n.map(s=>({distance:this.distance(s.id,e),contact:s})).sort((s,i)=>s.distance-i.distance).slice(0,t).map(s=>s.contact)}count(){let e=0;for(let t=[this.root];t.length>0;){let n=t.pop();n!=null&&(n.contacts===null?t.push(n.right,n.left):e+=n.contacts.length)}return e}_determineNode(e,t,n){let s=n>>3,i=n%8;return t.length<=s&&i!==0?e.left:t[s]&1<<7-i?e.right:e.left}get(e){xh("id",e);let t=0,n=this.root;for(;n.contacts===null;)n=this._determineNode(n,e,t++);let s=this._indexOf(n,e);return s>=0?n.contacts[s]:void 0}_indexOf(e,t){for(let n=0;n<e.contacts.length;++n)if(QC(e.contacts[n].id,t))return n;return-1}remove(e){xh("the id as parameter 1",e);let t=0,n=this.root;for(;n.contacts===null;)n=this._determineNode(n,e,t++);let s=this._indexOf(n,e);if(s>=0){let i=n.contacts.splice(s,1)[0];this.safeDispatchEvent("removed",{detail:i})}return this}_split(e,t){e.left=oy(),e.right=oy();for(let i of e.contacts)this._determineNode(e,i.id,t).contacts.push(i);e.contacts=null;let n=this._determineNode(e,this.localNodeId,t),s=e.left===n?e.right:e.left;s.dontSplit=!0}toArray(){let e=[];for(let t=[this.root];t.length>0;){let n=t.pop();n!=null&&(n.contacts===null?t.push(n.right,n.left):e=e.concat(n.contacts))}return e}*toIterable(){for(let e=[this.root];e.length>0;){let t=e.pop();t!=null&&(t.contacts===null?e.push(t.right,t.left):yield*t.contacts)}}_update(e,t,n){if(!QC(e.contacts[t].id,n.id))throw new Error("wrong index for _update");let s=e.contacts[t],i=this.arbiter(s,n);i===s&&s!==n||(e.contacts.splice(t,1),e.contacts.push(i),this.safeDispatchEvent("updated",{detail:{incumbent:s,selection:i}}))}};var NZ="kad-close",OZ=50,XC=20,LZ=1e4,BZ=10,S1=class extends $e{kBucketSize;kb;pingQueue;log;components;lan;pingTimeout;pingConcurrency;running;protocol;tagName;tagValue;metrics;constructor(e,t){super();let{kBucketSize:n,pingTimeout:s,lan:i,pingConcurrency:o,protocol:a,tagName:c,tagValue:l}=t;this.components=e,this.log=C(`libp2p:kad-dht:${i?"lan":"wan"}:routing-table`),this.kBucketSize=n??XC,this.pingTimeout=s??LZ,this.pingConcurrency=o??BZ,this.lan=i,this.running=!1,this.protocol=a,this.tagName=c??NZ,this.tagValue=l??OZ;let u=()=>{this.metrics?.pingQueueSize.update(this.pingQueue.size),this.metrics?.pingRunning.update(this.pingQueue.pending)};this.pingQueue=new Nt({concurrency:this.pingConcurrency}),this.pingQueue.addListener("add",u),this.pingQueue.addListener("next",u),this._onPing=this._onPing.bind(this)}isStarted(){return this.running}async start(){this.running=!0,this.components.metrics!=null&&(this.metrics={routingTableSize:this.components.metrics.registerMetric(`libp2p_kad_dht_${this.lan?"lan":"wan"}_routing_table_size`),pingQueueSize:this.components.metrics.registerMetric(`libp2p_kad_dht_${this.lan?"lan":"wan"}_ping_queue_size`),pingRunning:this.components.metrics.registerMetric(`libp2p_kad_dht_${this.lan?"lan":"wan"}_ping_running`)});let e=new Ba({localNodeId:await ys(this.components.peerId),numberOfNodesPerKBucket:this.kBucketSize,numberOfNodesToPing:1});this.kb=e,e.addEventListener("ping",this._onPing),this._tagPeers(e)}async stop(){this.running=!1,this.pingQueue.clear(),this.kb=void 0}_tagPeers(e){let t=new Ar,n=FC(()=>{let s=new Ar(e.closest(e.localNodeId,XC).map(a=>a.peer)),i=s.difference(t),o=t.difference(s);Promise.resolve().then(async()=>{for(let a of i)await this.components.peerStore.merge(a,{tags:{[this.tagName]:{value:this.tagValue}}});for(let a of o)await this.components.peerStore.merge(a,{tags:{[this.tagName]:void 0}})}).catch(a=>{this.log.error("Could not update peer tags",a)}),t=s});e.addEventListener("added",s=>{n(),this.safeDispatchEvent("peer:add",{detail:s.detail.peer})}),e.addEventListener("removed",s=>{n(),this.safeDispatchEvent("peer:remove",{detail:s.detail.peer})})}_onPing(e){let{oldContacts:t,newContact:n}=e.detail;this.pingQueue.add(async()=>{if(!this.running)return;let s=0;try{await Promise.all(t.map(async i=>{try{let o={signal:AbortSignal.timeout(this.pingTimeout)};this.log("pinging old contact %p",i.peer),(await(await this.components.connectionManager.openConnection(i.peer,o)).newStream(this.protocol,o)).close(),s++}catch(o){this.running&&this.kb!=null&&(this.log.error("could not ping peer %p",i.peer,o),this.log("evicting old contact after ping failed %p",i.peer),this.kb.remove(i.id))}finally{this.metrics?.routingTableSize.update(this.size)}})),this.running&&s<t.length&&this.kb!=null&&(this.log("adding new contact %p",n.peer),this.kb.add(n))}catch(i){this.log.error("could not process k-bucket ping event",i)}}).catch(s=>{this.log.error("could not process k-bucket ping event",s)})}get size(){return this.kb==null?0:this.kb.count()}async find(e){let t=await ys(e),n=this.closestPeer(t);if(n!=null&&e.equals(n))return n}closestPeer(e){let t=this.closestPeers(e,1);if(t.length>0)return t[0]}closestPeers(e,t=this.kBucketSize){return this.kb==null?[]:this.kb.closest(e,t).map(s=>s.peer)}async add(e){if(this.kb==null)throw new Error("RoutingTable is not started");let t=await ys(e);this.kb.add({id:t,peer:e}),this.log("added %p with kad id %b",e,t),this.metrics?.routingTableSize.update(this.size)}async remove(e){if(this.kb==null)throw new Error("RoutingTable is not started");let t=await ys(e);this.kb.remove(t),this.metrics?.routingTableSize.update(this.size)}};var jC=[77591,22417,43971,28421,740,29829,71467,228973,196661,78537,27689,36431,44415,14362,19456,106025,96308,2882,49509,21149,87173,131409,75844,23676,121838,30291,17492,2953,7564,110620,129477,127283,53113,72417,165166,109690,21200,102125,24049,71504,90342,25307,72039,26812,26715,32264,133800,71161,88956,171987,51779,24425,16671,30251,186294,247761,14202,2121,8465,35024,4876,85917,169730,3638,256836,96184,943,18678,6583,52907,35807,112254,214097,18796,11595,9243,23554,887,268203,382004,24590,111335,11625,16619,29039,102425,69006,97976,92362,32552,63717,41433,128974,137630,59943,10019,13986,35430,33665,108037,43799,43280,38195,29078,58629,18265,14425,46832,235538,40830,77881,110717,58937,3463,325358,51300,47623,117252,19007,10170,20540,91237,294813,4951,79841,56232,36270,128547,69209,66275,100156,32063,73531,34439,80937,28892,44466,88595,216307,32583,49620,16605,82127,45807,21630,78726,20235,40163,111007,96926,5567,72083,21665,58844,39419,179767,48328,42662,51550,5251,37811,49608,81056,50854,55513,20922,18891,197409,164656,32593,71449,220474,58919,85682,67854,13758,35066,3565,61905,214793,119572,141419,21504,10302,27354,67003,46131,32668,15165,64871,34450,17821,2757,11452,34189,5160,12257,85523,560,53385,65887,119549,135620,312353,115979,122356,10867,193231,124537,54783,90675,120791,4715,142253,50943,17271,43358,25331,4917,120566,34580,12878,33786,160528,32523,4869,301307,104817,81491,23276,8832,97911,31265,52065,7998,49622,9715,43998,34091,84587,20664,69041,29419,53205,10838,58288,116145,6185,5154,141795,35924,21307,144738,43730,12085,8279,10002,119,133779,199668,72938,31768,39176,67875,38453,9700,44144,4121,116048,41733,12868,82669,92308,128,34262,11332,7712,90764,36141,13553,71312,77470,117314,96549,49135,23602,54468,28605,6327,62308,17171,67531,21319,14105,894,107722,46157,8503,51069,100472,45138,15246,14577,35609,191464,1757,13364,161349,32067,91705,81144,52339,5408,91066,21983,14157,100545,4372,26630,129112,1423,29676,213626,4397,88436,99190,6877,49958,26122,114348,60661,29818,293118,50042,179738,16400,163423,89627,31040,43973,36638,45952,5153,1894,109322,1898,134021,12402,112077,68309,190269,69866,31938,107383,11522,105232,11248,14868,39852,71707,186525,16530,38162,106212,11700,5130,16608,26998,59586,108399,230033,43683,48135,82179,2073,5015,196684,189293,16378,23452,8301,35640,11632,214551,29240,57644,33137,91949,55157,52384,117313,5090,17717,89668,49363,82238,241035,66216,29066,184088,97206,62820,26595,4241,135635,173672,8202,459,71355,146294,29587,3008,135385,141203,14803,6634,45094,69362,50925,546,51884,62011,83296,234584,44515,56050,89476,87751,19373,12691,149923,19794,13833,35846,87557,58339,2884,19145,25647,12224,11024,77338,64608,122297,53025,7205,36189,36294,170779,21750,7739,173883,75192,35664,224240,113121,30181,26267,27036,117827,92015,106516,55628,203549,67949,60462,60844,35911,20457,1820,920,19773,8738,73173,181993,38521,98254,76257,46008,92796,5384,26868,151566,22124,2411,15919,186872,180021,28099,152961,78811,80237,62352,102653,74259,184890,16792,123702,224945,29940,19512,75283,14059,112691,92811,233329,20411,138569,53341,109802,50600,134528,66747,5529,166531,31578,64732,67189,1596,126357,967,167999,206598,109752,119431,207825,78791,91938,10301,27311,24233,252343,28831,32812,66002,112267,90895,8786,8095,16824,22866,21813,60507,174833,19549,130985,117051,52110,6938,81923,123864,38061,919,18680,53534,46739,112893,161529,85429,26761,11900,81121,91968,15390,217947,56524,1713,6654,37089,85630,138866,61850,16491,75577,16884,98296,73523,6140,44645,6062,36366,29844,57946,37932,42472,5266,20834,19309,33753,127182,134259,35810,41805,45878,312001,14881,47757,49251,120050,44252,3708,25856,107864,120347,1228,36550,41682,34496,47025,8393,173365,246526,12894,161607,35670,90785,126572,2095,124731,157033,58694,554,12786,9642,4817,16136,47864,174698,66992,4639,69284,10625,40710,27763,51738,30404,264105,137904,109882,52487,42824,57514,2740,10479,146799,107390,16586,88038,174951,9410,16185,44158,5568,40658,46108,12763,97385,26175,108859,664,230732,67470,46663,14395,50750,141320,93140,15361,47997,55784,6791,307840,118569,107326,18056,58281,260415,54691,8790,73332,45633,7511,45674,143373,14031,11799,94491,35646,96544,14560,26049,32983,25791,83814,42094,231370,63955,139212,2359,169908,3108,183486,105867,28197,32941,124968,26402,88267,149768,23053,3078,19091,52924,25383,19209,111548,97361,3959,24880,235061,9099,24921,161254,151405,20508,7159,34381,20133,11434,74036,19974,34769,36585,1076,22454,17354,38727,235160,111547,96454,117448,156940,91330,37299,7310,26915,117060,51369,22620,61861,322264,106850,111694,15091,2624,40345,300446,177064,1707,27389,54792,327783,132669,183543,59003,17744,20603,151134,106923,53084,71803,279424,319816,11579,21946,16728,38274,72711,5085,83391,88646,40159,25027,34680,10752,12988,54126,30365,18338,100445,230674,44874,84974,143877,123253,139372,28082,91477,144002,13096,219729,46016,50029,42377,14601,6660,58244,58978,23918,88206,113611,64452,17541,41032,10942,12021,49189,10978,40175,37156,10947,71709,106894,112538,57007,137486,150608,152719,40615,7746,279716,13101,19524,28708,40578,72320,1096,182051,94527,51275,22833,45164,81917,77519,48508,5421,140302,37845,149830,5587,27579,5357,428725,248187,6326,206760,39814,32585,89923,44341,288753,284443,96368,31201,94189,119504,20359,52073,103216,179,27934,32801,96035,34111,34309,101326,18198,20704,210266,37643,27880,141873,106e3,19414,56614,167714,66483,107885,86602,4379,20796,75467,4987,5017,118857,26003,34308,114428,29198,6686,29697,73632,3739,69795,16798,41504,7207,30722,21436,36735,28067,28545,3239,11221,36031,41889,100010,19247,317673,29495,174554,6424,129725,53845,94986,7955,59676,2604,191497,19735,102214,62954,23844,11872,179525,261436,34492,428,78404,142035,16747,17246,27578,37021,33672,57944,26056,135760,2369,61674,122066,31327,19374,157065,40553,130982,69619,71290,38855,72100,92903,95940,51422,165999,65713,57873,50726,7288,20272,2081,42326,22624,81120,57914,79352,19447,1684,72302,11774,302559,161481,96396,13692,414988,3721,79066,56627,46883,21150,11747,12184,5856,113458,176117,84416,52079,27933,3354,59765,141359,2212,216309,2555,23458,196722,142463,45701,44548,28798,19418,215,29916,9396,10574,114226,84475,13520,18694,34056,4524,90302,62930,13539,19407,77209,7728,38088,9535,2263,23875,183945,17750,26274,67172,10585,28042,22199,7478,51331,66030,26774,192929,31434,25850,50197,52926,178158,4679,181256,70184,229600,9959,105594,72158,73974,2726,35085,78087,23284,35568,51713,155676,5401,27254,11966,17569,223253,71993,103357,111477,55722,30504,26034,46774,35392,36285,214814,41143,163465,1051,16094,81044,6636,76489,179102,20712,39178,35683,125177,54219,30617,52994,25324,50123,2543,87529,58995,10688,125199,12388,60158,125481,131646,7642,133350,65874,3438,97277,101450,10075,56344,116821,50778,60547,98016,106135,13859,14255,16300,77373,173521,8285,45932,37426,4054,114295,55947,7703,39114,52,51119,128135,19714,60715,9554,50492,88180,2823,118271,52993,122625,97919,23859,37895,25040,33614,32102,20431,3577,9275,15686,43031,157741,110358,1884,40291,125391,13736,5008,64881,87336,77381,70711,43032,49155,118587,70494,4318,10168,30126,12580,10524,280104,104001,145413,2862,84140,6603,106005,13566,12780,11251,42830,571,179910,82443,13146,469,42714,32591,265217,424024,92553,54721,134100,6007,15242,114681,59030,16718,85465,200214,85982,55174,165013,23493,56964,82529,109150,32706,27568,82442,5350,14976,13165,44890,60021,21343,33978,17264,4655,22328,27819,75730,16567,55483,14510,17926,45827,150609,3704,7385,272531,161543,76904,122163,52405,2039,19165,41623,14423,228354,3369,176360,85491,7122,35789,303724,4465,13628,2233,55311,118771,20713,10006,221519,45115,71021,35650,29775,7337,10864,20665,21142,1746,15080,1624,32449,10905,105743,229797,7701,3940,22997,178467,57208,389057,39683,59403,63344,63125,54847,69691,18336,56448,3362,37202,18282,29648,138224,35867,10495,5911,28814,26653,31514,176702,26550,45621,11734,4525,40543,73944,121080,27858,155561,14887,44670,30742,8796,107455,113472,56369,75581,183777,240095,133699,153299,8768,160464,26058,49078,103971,21875,71486,44888,17156,9678,89541,123019,102337,3972,83930,21245,87852,109660,287918,183019,686,10100,39177,283941,11274,24736,26793,26214,25995,77011,141580,4070,23742,46285,46632,30700,26669,19056,35951,115575,174034,56097,35463,87425,24575,44245,38701,82317,85922,281616,100333,147697,61503,7730,84330,8530,59917,61597,17173,9092,32658,90288,193136,39023,20381,56654,31132,7779,1919,1375,117128,30819,11169,40938,23935,115201,101155,151034,4835,11231,74550,89388,59951,91704,107312,167882,115062,12732,72738,88703,464019,158267,57995,60496,737,14371,123867,4174,243339,159946,7568,16025,134556,110916,38103,191,80226,88794,29688,27230,10454,76308,57647,77409,113483,66864,14745,19808,12023,46583,84805,16015,17102,2231,20611,3547,95740,250131,34559,108894,8498,15853,159169,148920,20942,2813,93160,45188,210613,45531,52587,149062,39782,28194,57849,60965,84954,89766,84453,100927,16501,27658,165311,103841,54192,207341,19558,20084,319622,5672,205467,98462,61849,36279,13609,147177,24726,165015,209489,59591,31157,6551,117580,75060,141146,277310,21072,22023,106474,63041,137443,122965,68371,5383,42146,98961,113467,30863,23794,4843,99630,30392,82679,13699,241612,33601,93146,24319,18643,32155,95669,40440,15333,34089,67799,142144,58245,38633,114531,117400,77861,188726,5507,2568,8853,10987,107222,2663,2421,11530,13345,30075,41785,118661,104786,17459,12490,16281,71936,193555,17431,5944,71758,26485,77317,20803,367167,158,7362,93430,11735,172445,46002,11532,54482,930,62911,2235,23004,179236,4764,101859,208113,22477,55163,95579,14098,67320,162556,90709,156949,3826,57492,4025,34092,87442,104565,6718,186015,28214,14209,10039,107186,233912,58877,81637,55265,39828,6194,145813,50831,105849,4974,88319,122296,10272,197216,95714,51540,72418,23324,91555,8743,140452,250249,51666,34124,7229,38592,129641,78169,174242,22464,149964,51450,14034,10026,95376,26190,120062,14401,8700,265,31386,143573,7203,229889,61567,4227,140981,2466,72052,10787,10062,30958,6099,38471,30103,23202,208101,70847,467,58934,32271,32984,36637,24107,30771,17109,73353,13650,2098,157040,67366,66904,106018,265380,107238,18535,44025,32681,144983,62505,91295,56120,3082,77508,10322,63023,36700,81885,224127,16721,45023,239261,111272,13852,7866,149243,204199,32309,22084,42029,38316,126644,104973,14406,43454,67322,61310,15789,40285,24026,181047,6301,70927,23319,115823,27248,66693,115875,278566,63007,146844,56841,59007,87368,180001,22370,42114,80605,12022,10374,308,25079,14689,12618,63368,7936,264973,212291,136713,95999,105801,18965,32075,48700,52230,35119,96912,32992,8586,16606,101333,101812,14969,39930,759,193090,27387,42914,12937,5058,62646,64528,38624,25743,37502,3716,4435,30352,178687,26461,132611,42002,138442,35833,59582,16345,8048,60319,49349,309,47800,49739,90482,26405,34470,63786,32479,85028,39866,47846,11649,23934,29466,2816,42864,31828,7410,74885,49632,47629,111801,90749,19536,18767,105764,59606,21223,10746,76298,22220,39408,7190,79654,64856,11602,82156,272765,17079,70089,245473,51813,184407,384678,1576,122249,5064,27481,6188,25790,74361,27541,318284,45430,31488,620,93579,45723,192118,22670,51913,4162,70244,35966,26397,16199,50899,209613,121702,287507,2993,36101,132229,67345,33062,76295,118628,78705,52316,34375,107083,107454,44863,127561,33964,3073,154010,190914,55967,39074,6272,31047,5550,41123,26154,98638,47110,19998,148091,50229,31329,59900,195442,19106,61347,73497,70015,682,45850,25776,38022,148951,6288,37411,232526,109277,27286,32342,9262,5220,16651,23175,46740,129438,78614,121925,66914,88710,127952,5563,21500,34521,10739,14863,191006,62956,17359,16749,67027,56284,69134,43301,35039,58883,54466,60823,404451,75743,59856,86979,7923,34273,83785,32142,7693,268986,197428,282681,17049,22346,22990,92245,107180,3357,37104,96724,49153,7683,31197,43267,82231,164276,23696,20848,188364,22309,24821,158707,1018,22514,70922,27792,45589,59709,10765,736,35218,63479,51987,24275,63588,55361,92929,81964,4658,20122,12330,44058,13065,311456,72224,8337,211229,38979,22590,138478,52757,32595,133600,8838,31549,94412,43391,90056,1585,94802,127271,6223,31889,137038,132910,2165,57616,230152,6080,10748,36737,74579,134062,50525,180532,119270,34556,76155,82394,52595,29258,31435,87820,67996,26943,183878,38007,2410,13526,180297,69856,3503,187396,167700,7838,16701,9199,56267,3661,37407,65994,23767,5708,62508,221700,67088,86978,46776,84434,32088,5612,9149,88244,21685,95151,46750,189612,2979,506311,2594,3628,40074,105039,78243,28523,6651,38058,71999,30992,12764,68261,108991,6165,26450,61961,13400,22426,7490,60890,109623,2070,12958,50355,67979,257096,7213,42578,52121,35716,65461,7516,124758,39268,302,64712,14977,1467,219452,2840,34229,11121,21602,19270,63574,8024,1532,17331,79839,78885,52029,180767,57957,6069,91265,61380,55767,8927,32881,287603,22149,35029,68876,6428,199567,46926,13412,104132,21434,366616,45060,110046,81924,128910,45886,52821,130416,29416,77342,21762,67329,121432,79924,11724,38625,81006,102033,28338,13326,3250,82056,82526,38212,21112,12382,111495,3263,7414,86274,93490,40844,30224,45212,24019,48411,71367,24941,76729,57776,3769,38114,202019,197745,31953,237533,33270,201580,255648,100798,44741,32241,98468,106931,10085,15090,170358,33154,66787,18819,69760,25061,234005,82660,6295,131975,16874,9076,4094,25005,17740,40908,19533,220019,44330,99792,50040,19619,13950,55228,24423,31253,95308,103177,184795,28590,82285,5059,3210,75525,49894,70007,56178,10580,36051,139681,21617,98736,3555,106306,164189,37352,63915,47824,24883,145530,61904,28444,11483,19837,145446,30420,112972,85939,11835,191233,2262,20705,58630,1753,148334,1197,144714,6887,11223,107667,60879,77914,4151,57417,81594,96681,169430,1784,20444,95138,254041,27038,596,7117,72808,13759,3353,126776,21074,55322,27081,36942,39547,139830,179275,4453,713,8722,71399,19204,25785,22794,23923,104114,11291,25458,102309,88396,75288,230440,206396,104551,58447,130857,37247,94734,31548,176529,226077,65159,20104,10096,66881,94191,237909,27109,37404,1520,27421,25220,113003,23423,24884,50585,6286,231877,150800,11789,3226,90004,60642,5053,202400,61442,132531,175329,57138,30116,103847,9973,75367,16452,32360,59119,21246,10191,164804,23305,61051,37348,154530,13214,5468,50403,66754,130976,50559,80515,14436,155492,84017,5472,43107,41240,2890,90431,70188,382,76234,48040,50211,281038,237007,32115,142178,1536,22761,96429,1811,31243,1679,49143,55209,17402,235054,61494,7462,77030,34925,87609,78002,9499,9027,73289,201078,101379,63544,27666,5469,10642,30029,49816,132979,95620,58086,351930,116300,2110,2043,30845,6154,11279,16727,4122,2277,27281,4971,3650,39060,61970,65951,39674,75686,38151,11370,130809,177895,32665,63725,122267,7857,39618,118483,44792,157755,178624,136994,24260,41308,22471,12404,21707,12486,30473,52781,50246,20247,39065,909,56825,103158,128603,31542,1089,41935,32744,12428,37963,84420,33134,72921,208449,42622,168151,127335,147107,46699,38216,12591,94342,85814,31423,24944,2605,87542,67473,192551,4496,56321,91819,17630,6300,256183,114569,202090,33209,35289,34897,24967,40520,43470,5344,10199,34810,14283,10381,10017,62923,49924,23233,64539,13051,35686,19698,11570,135555,120868,44924,87065,52318,52335,47586,140906,245885,109834,78668,9065,46990,25258,72022,61243,40838,4545,146387,10537,11557,17470,36930,68104,46711,24264,79401,81043,18225,120488,24746,84338,81652,28266,13776,21878,46973,1047,230465,73357,95777,24973,210160,62210,58404,110633,169651,6937,41870,9909,26822,191062,76553,27519,96256,239070,2478,205678,67955,58532,20601,50120,19148,78501,195724,110740,8249,109665,27446,30568,57631,31425,49752,32820,65504,50079,3663,102256,219898,23849,211315,14645,4359,91767,9528,12449,49366,7941,49763,107848,8930,27086,50686,9744,10447,81935,39513,46514,1670,29229,6172,22312,137280,97759,9806,14445,22976,56458,73391,34983,93760,174219,52573,33149,59747,2429,136277,75123,165263,91040,7446,57632,48633,97140,246081,84766,151684,79918,93268,120346,54059,54875,77858,32996,103590,45276,11968,19600,25849,17159,132907,42828,16817,4913,99462,103303,27395,5737,74184,20749,21160,14377,77062,131403,158735,10999,27799,77785,9320,34366,51593,61070,33746,47048,29268,36675,30262,53297,9832,82e3,20188,122292,39917,7331,18160,68301,185935,134830,15031,4935,10004,165845,185534,46923,30109,44134,122631,18874,22903,112790,26561,18549,348902,82871,140345,255565,135390,63556,103747,145055,179600,145662,296111,61661,211987,23952,52342,126343,48450,32919,44277,82185,9591,62139,205363,376969,394874,108461,18040,120885,14798,39863,16571,16794,58271,81025,55206,14640,118656,6361,44092,85970,6262,153863,108244,180200,72264,79947,38044,10050,5735,61221,80712,5471,115689,11391,11661,184257,20010,60116,30320,19327,134598,45455,27542,18004,125092,452272,1549,91523,46567,180063,156026,2608,11174,58848,37788,65907,80194,30490,5786,40775,119519,106241,11323,156297,8425,61495,2617,29675,2425,59886,112582,49142,59618,4863,50597,86710,50650,168632,27693,85641,83643,18993,25768,84284,28090,93592,36627,312804,43381,9887,9402,100931,97165,3311,173330,66805,28935,4963,184460,3201,78102,19126,21607,37496,24938,22615,16153,32862,134792,153318,61120,6067,2812,12826,12792,23825,37559,64662,202250,102694,155488,85881,149193,46233,65383,15521,106982,11358,176786,25752,39717,34208,24510,32464,77742,39371,72028,138229,60688,71386,102834,132477,2208,11548,63670,271279,28351,30338,38620,32491,99845,143885,152266,13252,2825,178663,108097,1775,78201,14897,113573,163346,62292,171129,22183,96598,38733,64971,166776,117445,9968,146393,44677,74867,20908,97328,12761,25656,26785,9148,112344,26115,99176,110121,22437,49547,6180,79320,5835,31392,43328,33377,75870,119860,69497,80273,7325,155219,43167,111173,28347,20222,3763,71752,55041,47252,14618,28088,15012,97805,194698,54636,2036,41349,6173,96604,61530,51859,43782,13361,24334,22668,24792,7070,23441,16789,3209,36211,208475,26242,32880,122181,182407,21444,31060,88459,29929,77907,12716,10934,97005,20599,31690,8403,58445,30303,22700,10336,86731,103115,337709,72556,46788,112566,47684,67089,53548,36874,56487,41387,125985,26893,40071,106683,73712,18787,40105,72992,67246,137276,50802,36790,70328,138827,22466,39263,183295,29858,50975,9322,57397,10654,24364,30383,55799,41600,23584,127295,296610,129078,143558,244131,86397,36049,1085,80677,3820,108139,5476,34767,24683,7758,13060,7239,131671,250593,59556,103392,29810,4188,252323,39404,116877,7651,43600,40338,13554,157253,39196,25978,144387,61211,234,50104,6129,10449,93777,9240,356378,274148,4439,72970,3724,147770,78680,62570,115877,40027,40547,36817,224392,64609,34795,165027,67440,2477,37206,23431,50754,164797,46018,94995,170982,27051,7957,22767,3674,27900,56419,18930,60701,41302,2692,84749,339721,61996,111094,80221,50129,1045,8153,62945,19202,8250,37208,37418,32560,79477,41106,88569,33963,36693,5892,30570,1581,66471,49647,11922,160717,29442,5643,114865,82962,95982,132098,22633,22838,94726,54556,28566,205039,162340,33216,16849,35847,221339,94851,26533,71469,1805,3804,12935,45483,71020,36310,65381,192960,34240,35165,59773,1248,46954,155332,96864,4246,388800,16129,57133,74592,44807,442014,38203,42574,80818,91592,26377,36424,65760,977,77387,22628,147610,28018,30561,98454,6969,119628,63648,18170,36854,26601,64018,22027,37279,51395,152934,21153,9430,58760,194742,5330,55115,34158,28917,174111,13171,122326,1526,43896,66094,25325,4234,148354,11450,275,18999,112191,44365,22723,68409,8733,57746,96565,75007,14196,108844,29475,88599,177563,100792,106156,86323,93726,14248,135341,194131,40126,47099,14779,8272,39597,95983,171398,65882,28052,10393,47213,40689,22120,72212,106829,34964,109146,753,648,21660,30047,17527,181025,5619,145357,4085,216883,9359,186951,24779,53931,24545,36197,223296,62628,168101,4243,107313,30321,26642,13049,51059,31027,107912,807,73550,26551,84369,122422,165872,49754,74213,234264,33151,52014,33100,87183,22365,52500,40013,23302,5652,72723,21404,26107,48434,587,94049,168493,96418,32871,70860,31709,25128,443,71597,166253,15670,70994,26341,133675,28280,75491,54756,47955,56028,26182,11952,113272,472197,64640,110753,17919,337,50642,22576,142,87371,53391,93210,126694,15285,19642,85667,14148,1506,42092,52962,33243,11970,20734,135843,57044,58880,13002,219134,22876,64754,232519,4257,43120,321573,24799,64526,124728,52579,81472,70831,276848,17403,74359,23021,182101,74597,23744,148267,12055,7976,5349,11772,67540,167347,65318,18720,127832,108238,22828,90233,9987,259080,118185,73209,79270,13775,90100,137742,90799,70569,15699,19961,9087,67475,57872,39731,8810,134897,131868,146849,19898,3334,2281,167061,91073,60356,467742,74712,188,53179,137679,92769,29241,9537,132595,80119,1041,88962,5976,40171,44911,102859,139059,104558,98987,47761,19272,71472,113864,175377,73338,10857,23402,23758,1591,139864,5644,4076,118760,16427,134198,18853,20291,100849,37423,22038,36677,19071,195521,57445,11069,31869,55718,66882,148490,44,41296,75242,49704,166810,9906,20943,122258,49112,105667,15969,10344,6408,187694,21399,72742,58970,14867,14376,81889,41856,23225,15042,56993,16074,131389,74276,72407,53875,383108,53597,37363,68993,44854,122548,430927,198279,38430,80409,12245,2981,628,2818,17760,37437,238229,7968,46892,2200,3730,34190,65983,37959,112291,87850,70827,6522,20750,73913,111621,41652,19587,2780,58668,25916,85259,18200,168962,95781,42445,102050,7776,57662,103313,47742,96358,41964,66174,100396,29069,204735,19679,27978,7479,40264,22534,61183,36081,107436,58223,14680,23002,101311,24716,124108,12908,5646,31750,40380,14215,232799,102772,14122,96775,61398,50917,12096,149880,67833,598749,124194,155871,49216,790,14677,65319,56917,7440,145744,95701,12206,49405,129269,76199,45732,9767,11058,9047,210885,11051,7392,26307,2130,8132,147526,20802,232698,115660,50060,59789,57344,107623,80343,112676,23291,9866,160971,34032,118291,15719,59730,164911,28975,2659,58046,78480,21854,66209,53863,109085,116045,29021,46481,107552,22130,18764,70254,31272,11300,52460,43933,84738,20721,53869,190840,79673,105300,7561,321817,66924,13940,33281,101046,183181,32176,71878,5678,62924,79535,56646,40303,19559,27703,93042,73368,42187,3670,37376,46440,7023,36816,109628,20680,5940,276440,275233,170848,112093,136996,14984,20226,111441,77693,112960,48577,39370,55707,50314,123404,26570,54281,61372,123391,4857,35928,246740,132507,106646,44241,7196,92258,9825,37688,51197,303141,5590,15476,132986,10955,85782,34486,26696,7991,28813,18858,39546,11703,11365,38185,5716,93555,11925,40121,60002,6985,10976,171384,3887,43394,13337,56346,6381,252336,39573,75042,53711,1028,31781,44295,95925,131713,7214,68125,43571,70954,213234,1628,8760,13391,65485,17320,56038,1710,25248,60803,57399,19839,3870,326,281556,50945,72400,21460,316244,75619,56246,98775,481,13513,55765,50427,7388,123519,32929,57908,27124,61316,101097,57467,30228,48792,10788,20402,37318,50526,155730,34456,158065,145305,17832,43733,64052,4506,35072,205355,177028,184004,187081,68616,35938,83703,10367,36892,93186,260137,51934,89970,4985,23445,26755,21558,7948,78741,23376,124405,85594,68596,57536,49351,12619,56593,132668,99924,109728,71844,71935,196018,65464,17617,14987,89701,143773,33997,8687,22701,33258,2914,4436,72108,85610,9671,49067,2327,82988,1361,1672,44033,35777,30269,24057,10605,82236,616,15793,13919,47249,112086,116698,9484,80207,90574,33304,68624,93127,56101,42210,160929,4827,38995,38095,4701,125119,5027,33680,9236,231236,14135,87837,23318,70261,78893,30151,81482,14332,1084,74256,27532,46644,79185,3148,62615,6981,55672,31668,36825,1849,14536,37446,14738,23779,43058,162749,72199,1168,21346,5592,85932,85302,9668,18351,57135,150360,2080,228015,77953,34670,119302,151751,31009,106725,84265,45214,59289,74178,113071,263206,111009,4021,44449,188119,192629,123592,392506,292847,114487,12831,205858,9852,20780,79648,75767,357014,97721,18166,21005,67950,33226,204009,16536,2987,11335,66717,144910,47950,17262,55060,15063,2934,51038,26775,178497,66008,3427,49433,128592,20036,157553,63861,3089,23015,51210,28696,35933,49942,71135,231518,99620,17248,21835,176536,20676,16944,38700,165831,233253,295625,36723,13023,52745,10907,19423,67972,125868,95473,82875,1183,108455,52685,33417,64095,21433,52438,33191,127809,44505,211823,7810,2752,95548,162031,7185,91196,47563,61721,33359,17897,23682,42806,178101,22874,49707,199897,75419,82456,8618,11171,79712,116847,18783,44190,46564,5346,59046,95032,7893,14916,3214,26800,24172,121453,34362,10250,17408,18888,4840,68696,22831,13162,36005,32512,14800,62357,41723,45046,27247,37486,5372,2564,34261,298500,66509,133920,89138,31305,117697,19097,108304,81386,84106,23802,46411,63304,946,51417,41777,41041,19501,115864,60743,294354,37955,94165,18116,1156,17937,20645,57114,90804,58042,48643,92288,9861,2557,88546,61333,101008,12853,5148,87856,4152,144503,73841,18718,9789,147565,10846,42085,12789,30223,8993,56352,67203,2448,28215,6052,23540,126319,75933,36689,80235,23231,23561,21383,38800,77548,102798,21234,31468,158608,46188,63960,191679,8051,67014,11185,170078,42186,28827,34777,41930,212079,12421,34750,24111,110344,73918,45171,70826,141949,40063,23979,24254,37309,26724,27179,24718,83648,54938,14591,17425,29525,102675,48975,48654,12316,8929,60640,41709,50168,63264,89812,50716,48632,38755,138583,160123,55579,71829,24230,233277,46322,39650,166388,34718,24108,98252,7031,106695,62498,18258,35062,217827,78731,34824,33354,19520,60852,2432,60224,8587,2836,62955,702,20227,42285,40560,95592,62486,11094,53035,143291,18842,46177,77994,1770,9657,107422,172915,32655,128716,25886,25164,156740,119928,165875,85817,11007,89110,33956,12652,65156,180266,8494,36889,19958,20955,96,1264,118288,135769,44754,86671,5632,19026,168220,289120,33569,93821,66144,70635,7687,5642,2714,55445,56636,71545,184182,93133,7332,37389,12643,52315,22729,11014,158742,17050,152889,50178,34601,41945,52136,9948,26914,63548,95721,115951,40759,8960,158258,38938,49232,48325,42234,81523,253019,66128,40978,20048,238048,38760,62928,122560,118532,43687,137472,163689,26680,9878,17448,51035,16211,60834,36749,29178,14241,59868,150086,2305,26477,42422,34342,165341,83279,33894,14257,29928,12743,13957,125571,89134,66712,10952,16507,147839,30146,7249,16565,45399,39874,114565,215780,31990,230881,171477,102,196546,44538,10880,84948,281705,86651,10617,31395,2342,453658,43569,60561,132901,21845,17727,58556,258242,22262,58728,4008,77997,11806,37431,30599,81375,109137,185787,114085,217292,97453,169085,30593,60212,11544,102056,65580,2384,91655,4855,95725,7295,157994,16228,20669,53276,141590,105246,17334,25440,76067,17967,39321,38911,11362,28559,63807,21627,26468,85816,40120,1025,15234,58319,69516,66512,124548,75845,78873,22137,46681,51242,85683,32909,76747,35555,43396,101465,1765,73094,1077,2962,39028,66777,57831,42048,15828,13962,36041,63657,52412,5242,58846,2141,5506,219012,134451,3936,182230,17558,17153,152237,22621,49377,170216,35257,68233,65374,6510,11126,212151,7184,2480,22517,3437,33073,30156,16557,3768,55067,86829,91e3,12350,148650,66017,79424,70885,49066,28250,21369,51213,34533,11510,3258,18176,18465,84413,6315,36411,163765,4346,356,107618,598,13727,285026,162695,8749,14583,7132,63521,184253,32378,25991,5604,30961,53675,4874,84693,5086,34811,26978,56564,7904,33519,51221,113942,69253,6664,125563,22055,220680,102008,742,51930,19494,176108,44424,35123,13025,75685,11759,74335,22250,181453,131147,16984,132115,154311,11991,76452,52609,85351,196,30969,9198,74919,2529,56838,71779,29187,116304,3504,62330,41190,86153,28393,254926,104228,105189,13264,84359,3574,12415,8534,57147,10175,188174,59504,60932,66318,16407,107921,17638,99103,49278,28403,39786,145865,8462,3558,43406,142271,29139,21989,36552,93955,72365,7176,13556,106185,37957,321774,17782,129017,51154,27938,24952,1935,39366,2791,33489,41582,56078,24558,9311,5449,218786,27808,190429,68013,36020,86003,29735,3404,87348,119357,115714,2324,86796,81973,40992,43376,93621,28784,16808,36367,2517,2909,191926,24978,55303,53308,205724,60068,3098,21375,64784,23949,26579,63121,12319,80145,39967,97861,6757,70143,67642,37082,34698,69140,122883,46151,62187,80934,429,19437,135071,137885,222647,13331,154065,327,61778,74257,40116,37493,14855,85079,237641,42342,102164,199965,71204,4662,29368,5042,113914,122214,8955,13149,102503,43173,5659,163787,69003,307084,63392,171080,21390,81918,86666,36622,24126,28887,5736,28054,207170,163428,79891,346467,95363,38980,111806,80828,9200,19288,294896,114468,87405,111715,141705,7015,72754,68463,48738,243147,33397,101210,37051,98801,82847,20397,4940,185559,18716,54718,83491,11725,40803,1128,12128,23060,5174,7745,67007,46701,1571,27807,180186,256996,18975,16837,7877,212758,250379,15440,87954,57755,24719,124057,83461,258,50864,8874,29038,71289,31627,15429,9005,4061,113851,107716,82819,13651,79656,117851,17539,111446,12938,39724,190787,4352,15402,21070,62708,8539,23777,73853,13552,38810,86117,16285,56400,1718,75342,142863,29033,378,110113,180321,32586,23606,26393,160984,207987,23783,8406,16904,24596,47274,11693,46539,60524,78595,48423,31718,20170,9009,146268,15183,191060,172765,1349,138436,37365,10970,40509,225817,20021,70394,152138,21541,66559,66544,89352,2725,17258,91345,7313,3815,115868,8660,40362,4071,103524,39388,118275,21950,6549,38226,32754,209574,29201,43495,18028,20296,40597,18370,47520,202450,24134,2219,8195,69545,38041,136934,46374,19041,159811,84865,58620,846,98749,13569,30714,97246,32186,4479,27355,92973,35214,151491,75963,37631,1561,27200,238083,23182,60756,12291,25766,39355,102333,87362,65741,59906,19538,201575,48772,102938,24438,292580,39964,66366,9004,61379,50548,37622,38732,28379,68180,76622,17488,69849,5963,7219,48143,43413,55358,540,58691,29506,19245,52193,48621,5518,13048,118625,44755,191081,42061,89197,2259,60665,66994,71210,51232,3585,142096,55024,7892,8345,58653,463307,65658,64319,137941,136323,53499,12746,43492,6978,95163,29925,60175,5128,7352,41463,184756,121146,20473,18426,4598,5309,54580,14277,121151,10691,56711,43880,63409,76682,11830,172218,264898,32632,66536,81062,31649,25788,92774,60222,11100,63159,9432,224657,25240,53613,152,138620,163829,2397,85345,12501,37507,64932,38575,43522,65789,80198,78796,35226,3851,108891,73311,3060,28391,93671,39663,46142,30982,66041,37281,68157,26553,71872,81142,211527,39747,118119,22695,2859,11066,20232,168911,7933,197005,17066,111071,44434,133994,120798,12766,227798,45756,132852,29917,36076,55352,65281,129800,41958,18944,84678,18580,168093,132621,39997,54092,27740,32354,3770,114118,103242,43918,15899,18574,145944,3190,123469,219903,24169,100571,62403,16776,92779,14535,17168,16475,14304,37231,1712,28218,242754,61688,28980,1318,51359,222657,99200,67989,31772,23932,35351,201251,49041,27306,19128,40135,3986,77333,19649,120683,151927,21081,7076,78375,77501,101599,8011,89585,96715,58179,5378,102138,106793,26051,217276,4197,16297,27014,46721,13322,22806,5278,29629,70632,9647,71519,58818,40603,128530,8903,36770,56900,31483,26935,43845,34265,34920,87658,6114,84767,64250,47318,50720,19264,162514,33357,13117,6705,46696,75032,71054,87004,42035,69138,11903,99854,102328,19611,34525,69312,6431,49842,101600,133178,108751,41829,89939,225664,48916,99556,9195,130387,5960,36857,116724,53518,94002,39077,53996,6945,22261,64291,8314,152785,57588,16522,9091,5048,87671,35441,39509,1945,12423,158923,178413,37549,14095,1475,73188,62878,4819,24012,68534,42606,4010,120809,57497,59564,101758,103718,32701,80116,12345,95834,46918,21468,53213,15665,31200,3867,5140,96013,250744,21016,10069,13968,35449,180829,27683,39704,59956,22893,3115,26293,32785,75934,62445,141162,62720,2018,83638,19949,114012,95006,3330,99829,130935,309272,9565,55874,121727,37017,23586,319858,40970,27602,8625,112329,61060,100088,118525,25922,16232,1907,60671,51583,44553,80993,5262,94679,8676,940,20736,11823,3020,16476,12340,152600,97416,3703,25744,66826,16245,16876,46446,84798,74227,176020,45192,61955,75496,23946,23626,40372,26036,6149,11822,30582,16541,41914,82385,232823,40921,80773,14930,3631,7517,39619,4348,36180,126106,138939,62611,1477,113512,47321,25052,14546,118881,29060,23589,128322,36795,18401,137921,104699,267929,36194,172791,18113,4766,188215,30083,332586,94089,5805,77909,22194,68234,154976,43220,40660,70001,184893,138095,11128,103010,22663,5108,212615,8485,5565,49222,54614,26530,42639,16319,55062,152662,105595,21114,22216,10294,68158,10436,86950,7206,62115,3977,3657,59874,456,118617,18156,106663,112229,80992,17442,8217,55551,5133,34344,251927,51153,39364,201321,7816,66803,23057,156724,145664,14276,95705,979,2796,6875,13429,212525,50602,26276,28284,3424,19465,52397,46963,31420,51399,206476,92317,48851,637,100820,83349,10317,60227,21972,6908,282439,32857,224767,95629,83882,42106,87338,69757,29840,68709,37665,45244,114577,49188,175943,54009,186746,106158,70168,3358,234002,50555,9221,129338,9562,20118,32923,78479,118280,65752,4977,10474,102174,60947,129006,10570,83451,8598,8078,159367,123785,80438,16742,5905,5281,181513,42402,6977,163136,93179,42191,14968,50421,112401,105440,33456,57347,121611,4221,94954,36517,24046,27796,6255,33394,72990,135408,116627,1233,57874,25654,95419,68156,401399,313338,55208,45573,93124,119251,47200,38196,11909,130667,45391,73904,64964,167846,4137,115606,52036,62214,7969,160925,7187,1132,134835,40309,73195,64494,80472,444841,61111,26500,45323,40743,53625,52797,22659,15631,29739,36706,28841,39147,102836,26794,10536,14845,87305,45874,12241,127587,83833,57183,79722,30844,41304,84655,20825,92500,3722,25655,27811,10157,81634,31362,34088,92487,70123,22190,185100,72658,139035,192523,88241,2078,230490,44528,85638,100198,22088,29982,291233,241062,13865,4445,137791,37835,107218,31726,19718,38234,72528,23046,19177,66695,5109,17251,28077,5617,21554,47839,72425,133825,1486,73065,181275,141508,21768,62971,63082,2512,34200,9904,120309,6392,91243,68416,268253,41199,116757,138551,185526,41246,28986,4093,19057,17295,4148,245766,122360,35356,112075,20301,75441,10998,7977,19769,62922,937,63547,100196,26427,157820,20983,236696,22935,8140,90315,156004,47204,140973,7726,45097,52725,22636,23436,257282,105247,522,88389,216031,202204,46812,211666,19693,68828,81691,45925,11256,30292,372,5236,167826,88328,232776,151611,5360,82104,18841,80393,25465,18285,20320,72377,31730,33160,45803,38715,27705,37379,24163,18360,103586,4015,32305,269494,91252,20080,36567,54650,7797,57073,12650,31164,42209,6375,261663,105528,81661,106002,2800,5375,17247,43151,4442,15727,194619,100855,144898,62320,78465,39929,16454,1967,28311,61363,17219,9395,8745,121445,76939,80385,162380,22009,54191,44248,16299,122830,48151,74429,78291,64755,14238,44966,2511,17712,67954,93583,829,105899,49935,84750,11591,33185,85447,42717,27409,208542,28965,62052,52525,5597,25694,65594,16343,63224,276188,12475,9331,127507,38522,57287,24128,133161,79723,105548,133695,48917,27558,43278,46520,13778,141954,110785,83366,17715,46317,105763,66298,147013,41086,94180,16478,220447,44611,730,19722,78975,117889,125643,26254,16574,18480,65006,15806,38549,246418,46052,36056,8440,34984,30170,3163,59800,4458,115442,4283,41970,33507,104078,1653,22,121158,276486,3655,6338,24048,133421,23641,2161,24422,36006,8086,10675,181474,12307,29514,59143,14729,52509,87128,122470,19446,80852,33314,24573,119864,14237,9652,57779,6612,51851,15284,98871,90581,124466,156831,21190,22015,71380,161906,87247,69201,18392,17908,108470,72962,40719,14338,17911,95260,43339,20610,78916,20710,72451,11315,31448,17263,58853,178878,48111,116002,45497,80506,82605,85880,36300,121755,25215,36118,301929,88728,405223,276136,553,34704,212438,49970,78329,922,20711,25036,257130,38295,145369,18128,15385,30829,55656,48345,8012,3561,28004,122041,192900,58338,112508,41085,29976,87040,47117,23905,4336,92061,138880,97407,42083,172121,6256,25192,172671,5,93568,1420,12677,31605,56743,40620,6015,78415,231077,31298,80026,13902,19048,24924,170586,32955,176119,87859,36731,6773,27711,24658,26475,115216,133207,93250,95820,88522,8317,5714,124047,55219,86860,19677,23961,22928,162209,8904,225992,359835,56084,96201,29392,96558,86071,93643,55114,13347,8183,95129,82012,2017,123336,34219,115554,157159,47747,101684,41008,18735,193781,104151,226906,7552,179874,124113,31159,21162,44010,14771,51268,166128,31382,73124,77438,92830,205709,12113,1292,38937,13114,1334,2118,15597,69581,14449,21934,76618,48728,67038,14967,51495,24243,87736,147249,26720,11119,46063,43749,5843,44147,152629,133428,65703,14269,45604,57982,28672,55616,45957,8438,95433,37698,220862,132034,39456,61870,4161,26501,73560,56418,9845,4654,20916,10456,88920,119358,9015,65931,96507,48029,38534,21676,109081,43078,34943,25089,6131,28766,23665,5477,10255,16695,67,45778,42443,42770,29534,23733,100513,62617,42630,48746,14191,43753,50295,26007,8792,57243,43119,54725,164253,58250,112304,131796,25165,4651,3188,24831,47748,3705,19540,13211,102095,5593,18699,23666,32005,117571,33541,60584,74573,86311,99443,25172,27222,168938,7143,11853,53560,18834,19960,86522,28217,53266,117700,72989,34323,18721,66450,34346,74056,47217,202002,46269,9429,68582,75458,37823,82843,96652,32549,145144,27958,19820,158086,31955,201406,135379,31207,192545,12950,51704,9094,248263,76147,64028,110009,79407,89345,99284,223492,47966,26848,15359,201137,2861,110507,71231,72297,31851,118777,71039,151051,240855,16333,50766,14727,7939,4149,80908,418780,88378,59276,1327,7284,38576,79814,65820,42199,84860,49574,62596,12396,70598,40117,8648,7994,16836,7630,14047,359699,106878,525,29037,28064,13380,11675,50669,74216,103539,180314,27449,56299,172344,19274,7301,246099,32043,19422,36506,129317,6806,30140,4614,46639,66926,932,86600,6322,27847,233103,10541,39025,34887,3517,12972,26220,2031,66561,115015,48658,47596,12714,33845,3893,16165,35237,89983,14769,11962,147224,47018,29977,27979,5552,82338,86023,131368,1218,24853,237840,132193,15455,40873,3668,65351,53388,15229,59889,272245,47934,11858,34347,18038,90853,86981,300602,19343,114181,29362,84921,6095,106059,79472,38015,1206,48741,6208,8e4,21916,17423,6002,108083,24479,34931,56661,9511,26995,100694,163853,35997,81254,58321,18919,171890,86877,91341,74503,70477,53412,7027,59281,39892,131302,5864,15947,61301,67466,162369,47956,27874,35624,282324,21270,111847,102548,41482,30955,116737,28264,8592,55458,22301,75090,29821,30697,51709,3041,19208,8038,24634,30467,87509,126428,19389,18814,152686,20701,83474,45832,80891,105808,11378,153223,120770,98186,150633,49838,9141,12755,30962,5260,74490,21256,31678,65062,33326,289838,187831,20595,89768,2805,58535,10844,70085,12090,2451,138068,98544,24461,4511,6754,41684,28203,3383,65355,82833,30161,83924,234361,128424,28921,222594,33975,125491,34069,11508,67464,144226,41850,98703,34371,7901,21254,38398,65651,23549,53883,213340,123269,12028,71764,177701,28758,2623,68395,11549,15232,68603,9660,63116,36079,57093,31198,20475,48467,89984,35619,186847,107469,31389,43631,73867,41949,68841,114250,1605,30564,63403,17588,27680,99533,12641,70325,50428,73426,78379,11855,91651,72081,91720,60198,15743,12065,83398,140046,6761,46598,45900,5068,886,62448,148968,37347,19405,9680,15819,43496,63370,75667,163700,37639,3633,22774,34341,183131,134335,37200,23915,7054,14194,12970,26438,13350,285521,25594,8219,104410,91039,168804,138480,149734,15907,33818,61132,60082,4622,110187,56736,13551,73571,3945,73463,65498,17758,263266,17593,2710,27585,54469,38200,45367,63754,28881,3473,12791,98287,31895,65787,4463,94536,24951,36332,59901,28803,52130,86403,7668,181822,74831,18977,9850,177206,145485,109798,7292,31421,26280,77211,58511,12507,127004,11113,147,8729,56208,43066,79926,129937,31345,83947,39915,46146,98763,42566,1337,13192,18323,105163,80570,117753,16555,72883,11077,159438,40764,70933,83329,26066,12276,72059,21655,173836,126713,69454,153482,91585,70644,102558,110483,6764,127864,190133,3961,101798,20945,71138,82402,90884,69669,44753,923,16939,59700,164258,25969,27082,31399,43846,6306,246093,51342,6153,151581,202801,182731,56475,162188,89426,141356,14355,121815,27536,28023,65257,77523,106668,127314,24947,12790,38796,169698,23555,10725,44573,183083,42088,62716,43265,105958,32050,44067,50118,1668,3874,6243,318411,16599,1691,94999,52378,28671,216728,123258,2059,34969,69225,5913,136280,171443,141515,91662,22175,135282,80020,92270,1663,4808,4482,3495,34691,5226,109830,108512,17342,107488,11606,123190,100247,29666,146527,113014,15794,30894,13224,39585,243192,22351,9903,7836,47699,11078,25468,122291,48821,26780,122679,75521,81450,630,4895,92900,55074,74293,17441,3563,111657,103102,51613,12318,52370,36191,68245,34269,40445,41354,122901,168604,182500,62012,42557,11259,24428,115113,86345,12362,3909,78430,86852,134602,20459,47853,93879,22577,7659,3688,38555,13349,17381,56715,91639,12493,10895,92438,3142,37057,28928,2004,36427,32268,34222,209974,10432,67436,41989,173518,107930,27079,62729,30908,55558,5828,45031,14902,53546,8204,144263,60255,14520,88212,86582,109589,69356,8064,47449,8505,66558,16886,4844,52817,111260,215129,12941,91118,650,20770,6273,73089,40618,62790,2873,35002,14023,97208,19386,102646,36993,143736,135457,35385,113601,17893,32627,84439,100619,56016,6581,57264,172160,45452,111710,203627,70131,24100,322787,1996,35665,70078,22358,90922,83658,4097,63200,58499,14542,99153,52159,6615,12414,63415,31986,16823,1579,65405,137809,8841,16898,48082,259,33014,42375,12260,179850,73667,91389,98882,29532,17311,326251,41092,5928,20742,44964,48019,43505,9317,49265,6643,192712,48424,163487,19861,20113,70848,31928,105333,23685,78563,14638,54755,7158,24142,44018,20774,125255,20331,24280,10163,1285,2336,39851,4299,117269,46714,63816,87779,159624,11731,9971,990,137317,108831,50994,74554,162680,23640,131597,146962,170620,34829,91205,21184,1913,63616,18427,93136,156592,17519,67565,115882,138220,78622,88535,18115,2711,33554,109492,54298,971,24914,25863,36363,45715,27099,194995,14299,178181,111488,72395,322385,157719,130787,11897,81843,83999,11369,49280,118604,40922,61332,110343,53407,75639,40582,300440,54722,25637,13694,48248,48278,194521,56203,52779,48783,72627,10953,376,16733,280238,26351,230789,15132,25168,137270,3588,63704,73376,94031,74284,19443,159557,9697,39901,13351,119050,15406,146455,3460,29556,75195,37673,102524,92329,47289,98413,15311,100684,56345,7116,95480,11590,7200,167,23610,58426,17730,136656,27944,53151,2701,8824,103124,3017,90744,113588,53216,79736,65940,26931,498,29568,80540,143543,21292,1740,59268,16561,180816,42323,50174,40890,52866,10703,57169,4700,17191,4424,93511,49698,166650,26972,48631,165169,82879,69326,202970,4007,2376,231325,139592,22119,62851,37504,68816,58345,67398,186643,43331,277416,53749,15746,23102,17432,4793,151138,48822,54265,48203,198688,14305,54287,2291,18018,113378,123260,7180,97549,87027,120085,2920,76080,8190,102005,5641,64580,14955,59802,54028,58884,19367,81779,412567,85957,97053,103637,78871,29364,27637,141728,4767,30686,112738,130146,42745,12730,105040,14844,232,210944,36581,152317,135543,29744,3129,55647,58149,46319,27265,17499,28005,59948,7170,34138,5702,293047,110892,408,91760,218674,18469,46095,81403,14389,4610,35672,73060,11006,74848,104820,118143,190357,20043,105358,141735,5115,27093,45924,123073,52599,29433,9616,238350,78610,24851,58858,26769,31969,24613,18294,4982,32735,39639,143563,112073,202205,12567,4873,88601,44897,81503,101648,81362,34662,85277,17574,48173,21435,221188,40215,39576,80786,26544,64668,81841,10731,37733,247986,149188,127703,495,18382,54388,72446,43071,30974,198723,89608,41360,190,33045,8386,31658,19992,237838,119015,137622,50890,100913,6460,116233,267230,26621,104129,65114,14190,41542,14888,85962,23342,23041,26453,43725,71809,45186,4770,46452,53894,56616,221286,18973,9038,109299,55365,19366,26863,18808,60909,69353,41738,83463,12100,68561,72860,3980,13796,49340,12332,31311,27418,4255,53430,18976,45523,510,14224,30477,26581,4530,3651,101663,139840,22709,150861,31996,63923,120623,262522,3076,10528,2929,14672,130238,18087,9816,121894,100308,25085,55111,14565,18952,53293,2042,369988,23674,61789,133529,28783,108293,35477,47119,36448,71049,40015,33055,78598,198442,1833,159937,40654,77444,189245,113153,8621,18599,38553,35223,166072,2375,11659,21786,89523,6032,12116,63046,159398,18454,3678,32521,47626,11411,103527,38896,42946,15696,26370,10185,8413,37080,165583,4331,63555,14907,72220,50056,6623,62236,36565,49783,10049,17503,100581,55951,146244,24724,9626,17969,25524,109300,173965,99994,101056,46459,43647,53737,277968,8347,123521,74858,33829,44762,77574,877,81377,222525,123532,30602,43881,53145,2973,16284,81940,61281,127044,63620,9875,14756,114829,19032,9202,52759,119141,23928,120551,19607,3599,33401,76821,73233,117430,39968,36539,7071,5446,121735,194059,15206,45283,6706,15603,65615,1207,165723,92275,34773,104447,8396,32353,205240,164323,13600,60555,79205,25532,22907,33410,57480,107111,69630,32137,47832,70913,33161,20321,2371,117348,10714,86246,1625,11763,17900,268,78457,99175,97940,101092,86660,32221,14041,128504,125080,53744,124263,31017,13897,403,31859,21964,5633,111630,5547,77329,17961,18241,84995,25984,12983,67491,62168,47262,5241,297,51191,7351,8967,147212,82060,16821,782,11033,82431,62957,5026,43459,77963,203477,53528,6247,191852,87774,74164,215654,13467,1522,219964,28589,244104,16242,117821,67725,72570,156792,17186,15979,26990,44128,193014,35276,57125,16212,166451,68017,6905,77608,16364,53777,75921,76426,37975,26203,269296,64099,84122,12077,38533,830,4407,20139,963,43028,38902,42911,37503,83343,85045,16979,1165,60835,137387,58380,86990,110066,134540,56331,193845,81238,17922,163093,38744,110641,12502,56404,34862,26865,125964,12965,111648,25547,7771,27196,136980,9555,29551,107158,57885,18831,37705,35505,101742,13970,102109,62548,124657,23328,11124,89592,146376,248050,6241,22033,18337,80685,29898,11908,216623,67721,106162,146610,21377,15085,91552,42041,62560,122532,125336,102365,121537,142559,29693,223919,11515,110495,18776,22494,5895,185059,103592,229351,51220,100102,37027,257855,29359,54123,36066,106493,12244,79258,32002,432,56205,94836,90182,6726,14762,29391,48938,26864,38083,60364,3310,60192,14766,205567,57504,110760,22649,24666,46333,21517,3430,13135,28873,27052,158809,11597,20529,6695,23138,22960,37137,45574,6545,305877,43423,26153,24769,59844,14501,10430,134352,56169,13213,103432,49523,35181,13435,12408,129475,64620,230854,77390,51990,15653,83248,33466,44571,117828,51481,2187,10559,68019,18021,54895,48247,18354,33737,4554,108595,37288,39767,116707,9175,3726,108877,21616,83684,49862,1938,8543,276466,20134,108498,48770,102254,31914,131520,185291,100559,51890,209,19526,76471,50544,71814,99351,8172,198526,28816,20419,9109,98389,136777,76479,75596,30635,165417,48216,120220,25955,211071,39314,24308,32164,2559,146280,43403,9233,17947,90585,1786,86920,125662,2457,64741,32152,32918,122882,78538,44001,31723,56426,23375,103172,88177,145697,52506,49319,68016,31664,41488,18486,110400,7030,28241,986,109199,19900,42147,56864,65287,49183,7858,24e3,30453,840,16673,25907,68916,89927,6309,158335,36407,199737,130464,13137,59603,201778,195292,21015,42466,179062,172561,89492,11075,180407,31868,72493,20998,60217,9865,19530,39274,130266,54539,21623,12535,13505,40641,73375,4087,85633,2153,3117,70680,55788,92096,47509,98493,37490,271936,151475,3032,16171,96642,34106,78425,125761,19591,3366,19316,54508,24183,50786,194248,91528,33253,34622,108355,41741,705,3814,3883,108929,13203,67831,10142,59754,68208,29128,84820,56880,38794,24972,48571,40821,40476,18137,164254,24064,236309,79181,11282,395,39169,2013,51587,28551,9645,701,109513,115899,113566,12762,62045,58322,103726,41343,40866,244102,143816,2490,70346,40973,52618,15412,30720,104315,38917,42027,93676,17513,107418,20706,123890,13399,97727,24044,87962,65606,44250,98044,65276,74790,101473,19350,91570,1326,87790,172042,7577,100813,86896,85891,41512,108130,27794,14875,71431,12835,156250,58135,3759,22476,42176,115873,34686,56523,73643,108505,51491,20838,12721,32863,45700,29496,13700,34294,55360,29206,155942,123812,7706,163234,203,132720,49358,144431,8130,175788,35818,3270,76832,25710,54095,97274,28779,94621,74396,19092,128242,58067,20885,14670,93255,15107,63291,23654,126900,129421,59294,262659,9798,3251,67344,28600,44629,50672,29072,26999,31526,23183,49175,165843,175455,17282,175411,32022,45989,30298,90690,78118,83156,23749,35636,31317,7069,80381,94561,133756,14960,97404,6138,41065,78041,32843,16601,34123,9559,146529,123377,96395,54441,42012,84257,123541,10745,22139,106459,11720,150883,172651,154996,110538,4728,53447,25704,2009,71152,119354,21166,66604,1429,216162,8637,122250,63520,27180,29172,36124,276428,107787,77184,4680,14952,104903,24418,14793,51561,52931,8371,26342,48526,7118,92066,67280,40653,8847,34597,105438,14198,50163,61188,146286,50315,41205,170829,161496,585,197359,95056,1687,365794,91349,48507,5804,49263,5146,104902,96365,117343,132222,46084,96919,16875,8073,262381,79982,52663,13928,16056,153908,15145,109256,132308,18763,24904,167644,13618,40750,18686,147124,114709,150038,52849,2938,12568,48617,8778,5459,44202,44591,74914,17183,248689,13878,7822,80060,23116,194037,18487,2067,7798,43077,33678,244028,31320,74273,2794,19466,8218,36280,183997,48124,19416,29656,19280,98734,7715,18311,30701,133602,150307,126956,7378,2933,79903,13178,12593,86571,26604,92446,13574,44205,65699,427599,21118,8245,14407,27877,47936,33542,7916,26460,117762,21596,37818,2249,127359,209394,60044,47677,308089,36791,154971,31417,6998,150042,174360,12255,43009,29335,48739,3912,101398,53340,2580,146939,151295,45360,125275,15273,45383,27456,48761,23314,8750,60801,85823,104759,27894,123685,66968,39480,26917,55290,83305,2696,98390,57569,145853,340733,4919,20024,52268,30884,7413,203685,70989,112855,4129,50536,349518,68205,332641,159581,135361,236026,37563,176404,64899,6578,122033,63871,1850,85234,82089,66124,74145,121098,107351,12687,36881,117334,13136,14698,85933,93866,18047,32620,310,15094,46e3,88451,23632,36645,27940,87618,80520,58892,20976,27702,140090,96075,67841,103292,238964,87778,107338,17019,83427,67522,7302,8261,47570,116787,8730,80484,61772,174422,56005,131193,52875,14588,28471,59817,9586,15720,158155,51307,109734,15196,11025,59331,3884,52626,102602,84797,25158,27314,4437,20488,76214,189248,35023,114952,157376,2827,62439,102878,129749,36405,10329,109339,108633,36662,1254,13267,5470,87105,58004,15397,10434,159667,21864,52022,179464,3013,32147,31496,116832,18494,105502,129227,107267,50033,13481,9954,24267,22141,16257,116154,36185,950,115685,11305,176708,2048,178671,112573,287867,162328,497663,95170,50979,193861,50987,30368,136257,31830,46549,15119,169876,23788,17462,249887,57377,1949,35448,14791,43769,210091,3783,34612,282103,88380,245190,5457,20491,98908,11402,86899,117916,16028,162584,60644,320177,156096,31065,55876,22e3,77655,9992,23397,13757,317623,63978,215255,2443,17648,93231,27388,104529,93807,55505,140477,12046,112040,70887,40152,94365,112353,25063,114679,266061,71248,119555,15589,2244,617,14129,211431,70110,100652,7777,4383,85911,89221,21010,120615,58357,86405,37554,41647,18,15143,69662,60491,14714,186134,148344,42347,5410,168175,44535,42449,343894,129417,99682,20659,27272,140483,63455,222159,17536,13722,42637,62324,11976,114691,148109,2283,32057,182393,4295,147364,33705,2075,44303,30274,28331,63740,69740,29148,10346,44862,33716,73937,153333,12930,38784,247159,2515,41053,20256,83368,256189,54639,115240,5096,24661,175419,153552,26516,141,138176,63885,34115,47222,55709,2765,28479,38875,236608,12229,22921,77291,54426,45388,2860,57787,114579,295139,105782,17826,71066,19119,54364,69385,16568,12323,28057,33346,34919,124763,155533,101386,31644,8627,49001,303600,29868,63213,9103,77280,71333,9696,138789,37059,24823,5057,21352,32368,114208,56803,19424,10445,58514,8661,209508,26187,171838,10460,63454,14016,122504,41328,21329,46618,32493,38225,7855,31763,7945,29876,8734,6438,24205,97490,139977,130740,47323,33195,85390,57194,13813,60600,21313,96251,7699,27584,170521,139271,1363,4402,336738,129223,84983,69150,13147,3590,163929,207225,155260,55916,20288,4503,8398,98490,11773,27512,37113,84976,86558,28365,11756,116005,182148,13733,115313,47644,67208,85069,9347,14995,226141,14704,101835,41159,35314,13113,63526,214039,29978,50446,83339,17440,129441,72522,118641,97816,24907,73844,15717,118884,167255,96509,162793,30847,36849,51297,78974,77793,10427,1873,2972,9999,35074,28190,64297,146836,46298,60038,163007,108919,61219,2403,75022,127339,4233,110389,69022,9833,128097,88016,79390,222936,22570,94657,28462,56956,38803,81536,30474,152794,19566,16481,147408,74574,81895,20731,1918,1366,76367,187321,54494,24366,21690,61696,33283,107477,77499,31112,414383,74362,18463,218441,120929,59848,258629,201924,69269,454,19989,13054,59894,3623,58908,20681,35723,78523,102680,38988,184112,108087,50944,132704,52966,21699,18860,96349,201411,82697,85395,95658,5093,6427,177894,44191,32755,26961,155739,6249,31310,81030,26574,84311,120155,86730,113535,7424,48888,13516,45747,98098,20077,183995,81945,43210,26704,40420,75831,45648,11180,6855,57927,65528,124096,34851,2598,156633,107572,127352,38169,123845,60142,62722,105584,232364,23211,68120,1601,22169,89299,747,258039,80572,7258,152249,11862,101204,8834,121434,33761,19175,133142,46343,40178,48723,3589,41977,30210,38868,62257,10087,82658,87827,90646,16415,47552,351723,28298,72225,91146,272760,1701,11295,1652,109651,300747,51863,198800,29446,11794,32345,37538,22356,33102,37590,113544,37970,11478,179743,25454,103417,59905,221970,105196,145604,7817,164809,102360,16974,75840,255333,56902,6659,1954,645,59400,67769,7689,18675,5215,13793,20536,27852,3387,29523,259718,16860,94625,43143,29245,15848,233581,22685,63631,78557,22836,133302,84513,1348,51826,47129,98836,58284,1830,1749,94642,10933,6145,12506,10975,13879,103781,144434,10268,28409,32346,52968,121567,107374,77268,23686,35097,10501,155275,15303,47136,21102,168741,55332,90385,15996,84817,681,137803,25054,142275,6163,38175,8056,124296,240642,65621,4934,178205,16101,62803,60964,18230,100622,76465,44689,14545,9543,47514,16852,93380,28048,12047,107106,37575,101485,77047,57326,34819,96137,76916,6469,46264,115983,75768,87668,69942,13027,165,8373,114231,26434,52844,42799,182044,23580,146254,38081,43236,33883,146220,382894,14606,46035,36481,166621,35417,95382,2957,59384,60428,36358,66343,75378,22267,22950,83528,17577,56474,25285,4619,179691,75355,95836,53295,34588,171410,4487,14679,84208,44015,18562,109133,54101,11531,86052,174479,303157,28095,9953,35642,14564,39802,16145,77606,117406,53038,121117,53624,22062,1212,7632,127157,237292,189087,10478,127345,102515,181997,86752,87623,10966,121602,68783,68681,83042,114380,138349,191305,67176,50085,39016,1427,42384,1412,67118,122616,72389,25260,2237,13576,137346,19938,20304,2191,68759,5373,61364,238507,75814,23931,69565,38993,131741,38364,12528,87762,5679,129853,5310,186831,32653,90338,260176,389531,108118,26843,43985,50175,30563,25106,56965,18130,140428,4542,165503,117991,24219,229605,1819,129663,1240,3797,76093,18398,71339,51919,93043,27175,47060,216257,6483,35051,1217,16512,80798,129064,13225,69339,8548,237079,72298,2575,34280,51379,117910,55671,53345,247552,29486,39328,140821,34681,57045,60177,5004,90269,78522,2479,322607,48474,61296,13057,31558,4678,59271,6699,27044,31988,35944,12503,83480,4389,136508,3781,114121,70279,4488,155829,42214,2898,68191,75695,305850,45041,74344,106509,30087,17429,93292,12477,290,23080,114802,35714,18751,26554,105424,17775,2144,2412,100610,65192,113975,52975,180272,135050,129815,76238,106483,21440,63186,4260,46189,9711,28249,4169,23429,23390,8324,141585,63809,67668,38457,38063,39226,59972,1189,203916,62368,14403,16949,61767,85801,1739,40147,35049,76757,33124,62102,15780,103593,103009,53484,22952,67973,114645,6566,5245,50462,7601,8288,3513,194571,80276,1908,54592,5124,58571,2513,6800,273997,193904,1119,17991,117245,2508,129156,82366,26278,71465,63341,56943,39662,106116,94966,156875,9736,2204,122308,94418,27134,1280,24539,49022,45314,3764,50904,46424,30699,28087,293839,9400,33646,40165,822,147499,50263,116179,29085,11863,31314,5578,17797,5104,12454,1604,15342,219206,10232,67800,94261,25872,13565,90339,78971,75377,26649,41184,47695,11514,35369,20767,14227,41953,309396,148270,147938,33074,14453,27499,109019,39018,25738,240196,158931,52820,8612,95853,21524,137010,84901,70869,70021,116794,48404,38771,6732,1070,70990,187297,49140,5238,576,3564,253975,16027,16483,2811,37775,19034,25259,4053,2e3,70083,95774,19713,33431,92703,91314,42381,288770,48194,95985,3991,77418,13406,241328,245086,56533,35275,62725,9246,51924,70181,95331,16163,31410,79016,39312,120878,119371,275987,80124,27712,9186,220,23598,146167,85209,68238,282190,57048,31273,30555,80913,17594,75779,59160,135002,101219,189377,29225,96735,60126,62522,104e3,27620,86814,17240,147533,11001,5425,43682,410,49460,87270,69480,46315,59448,1816,76201,9431,11788,87960,29063,65539,47347,11678,33846,7008,196704,9895,6753,8633,120892,59970,572824,115934,6646,202559,892,48351,37611,251282,57823,67263,57750,26527,34485,90747,7685,88370,6144,64182,1709,41969,21458,62327,181657,49247,225330,122600,114574,107124,85361,111833,63243,71420,15655,191178,72430,18063,51425,54002,12364,53225,86557,18193,97580,41232,138398,67821,128724,8944,233212,101353,52099,42127,14006,120107,32789,32132,3498,18123,33758,56058,5779,128760,59888,98869,18445,84702,51911,13234,218379,20093,39031,8074,70195,20708,23462,24355,131384,60189,26390,10403,41060,7140,10781,49410,42261,87202,82566,41663,43105,60276,2768,5733,74176,28329,2297,145430,131632,83615,122915,105441,655,224102,5284,136426,67763,16294,188511,32538,61049,27893,3394,13951,159099,28542,17930,145360,9492,190122,32285,78855,26440,13570,58648,73908,4239,124561,2444,74172,53131,11468,10794,73566,11623,35343,64710,30481,4163,10328,38309,29901,10538,154377,76132,92405,24839,11679,3465,13449,11637,7824,2337,57754,1260,14458,41118,19878,38661,13416,159180,37074,163164,54137,28627,52134,184900,8520,40385,29546,30502,22386,66527,107458,6850,24022,47983,30603,35083,8934,304066,39500,9,28261,33026,77251,9374,44833,116312,34990,29236,63563,125639,135405,165398,159055,55690,88141,69643,236964,31983,25572,20436,36746,60896,31850,16179,11828,5888,3043,66368,9750,31167,7915,53111,36430,1333,64344,93659,20061,60596,180191,51630,6792,30244,43509,101058,22409,420,44210,109783,43223,27030,72477,72831,32679,29235,7675,47556,12258,39907,149412,84926,118247,24692,71717,105038,86009,45941,41189,89453,29856,52543,30627,226798,67303,59230,67415,34408,1367,99685,16867,128419,52147,4111,125381,117881,16173,44093,102224,31575,23234,24870,83790,127407,239098,3200,994,1255,100903,242275,117266,55116,38205,16140,29662,11307,40414,208793,123355,56470,4862,75600,30119,58218,70828,24075,26974,7802,192353,4851,5475,78720,66596,3409,28573,64396,30381,30690,59859,88256,5406,99945,103064,34463,37727,24238,86643,60088,4057,23741,5967,162904,38240,28356,93858,25510,122879,6897,3278,7057,11971,4400,35461,211413,21395,59615,39471,87233,55795,128426,3051,22470,41950,14705,3974,180108,80476,78442,204996,91987,15634,67610,139015,142373,35611,51134,10387,4353,153456,57749,181039,14183,68447,151532,21107,36452,20551,3186,46247,46383,129666,88736,140662,146243,2066,8360,7978,64818,106963,17896,47801,10723,114821,223295,74192,3293,3393,16987,74064,11277,91622,4270,29828,27951,387869,103235,1374,61988,120083,477,145892,128378,11779,211263,61354,18221,17869,46530,83061,108538,157981,90608,67199,95080,49064,195814,12302,66307,10348,231346,160732,112859,63633,146558,21271,31037,198802,47622,12862,95710,3910,77850,73961,85585,34752,61e3,4082,24595,103679,71107,8208,79568,150019,16615,24961,139857,32664,197366,4559,54735,32696,4126,162019,75698,13916,70108,159638,19834,9349,24675,175560,49643,18206,52459,27992,10809,88865,401975,133172,29e3,34558,30915,3658,25834,42430,36562,125265,18182,10155,40149,97082,208980,19575,60853,90529,66545,9600,789,46420,2317,88593,55595,98980,115302,5742,169155,1073,177901,3472,11189,63711,78643,65472,50459,127979,93,42202,67053,21720,157650,11145,141378,42033,22824,85705,79114,35584,15974,1510,54172,28562,12451,104226,19190,97151,73024,20948,5151,81741,21499,29006,84183,198074,54003,45120,170125,26240,35177,28389,64863,79974,60778,176915,232183,45342,2038,80253,41564,40703,32689,5430,100689,5366,23007,134279,14266,26712,73993,24934,64242,52113,102887,61801,46415,201049,54251,62133,122757,164883,30815,139966,2319,30842,766,13362,10287,134518,86111,81665,82440,28333,43019,18963,8804,161944,23439,102144,101145,80029,39052,248708,30350,117340,11878,128467,974,138625,63961,5237,74778,61834,67040,43814,13690,65947,33809,232476,115258,181745,28824,94013,9510,10246,93722,81976,7217,114383,3493,16014,69045,72692,12145,80981,9507,6692,1620,60820,330444,35474,33962,4797,7053,295463,46445,27026,12491,77988,49524,35675,90947,29114,166705,101385,133782,32704,6186,84595,176031,185623,45966,151302,63069,1699,107491,947,15458,74452,196212,6046,10498,12163,10239,35191,243951,9277,9090,29539,54460,22820,26514,112549,60372,51753,48756,21812,70861,260326,41,44222,10441,16961,48148,138771,216194,5914,52153,53400,212036,56519,26245,10117,45888,15294,138019,90913,26368,43842,42111,23348,6082,194845,161089,156206,51546,11647,30759,302912,262094,8635,78876,26535,35283,54183,31183,85484,147873,12989,5197,6356,72894,65347,20150,27370,73787,1493,45918,12366,190217,20724,13858,10981,67449,81213,7553,14115,72242,271517,11842,48310,88743,143726,22177,3290,243231,58452,62937,12592,1654,40066,33477,13751,9921,128442,15868,7106,75236,83773,10775,36938,10482,170465,17368,17469,161508,32752,98340,800,19824,264456,3901,87319,2867,26782,9630,113102,185815,24197,44584,86366,40224,3636,140916,31731,267731,9567,53678,72984,29389,27963,17106,50282,284911,60170,8322,12608,23374,89652,5268,39044,229766,8869,151350,31436,177342,12269,183212,120418,116270,2843,78888,69192,7865,184099,1086,129897,18383,70508,20242,18508,229924,124569,35749,50589,55626,9884,83115,40971,30671,18135,14452,38861,17844,201826,5549,26413,17189,13561,38539,10679,143331,3314,36785,171194,49685,187713,67506,4618,104039,17060,195080,50648,33159,19238,67559,134840,28599,157523,17130,38064,117398,94355,31918,13575,34538,40326,13997,3494,348283,62481,26862,3603,104426,244363,153709,112487,304612,199674,41239,35545,54869,293005,28223,26277,26899,4533,18518,15492,38587,80488,70485,160395,263,60162,11382,222152,4696,250751,51921,182609,10707,48463,46243,1227,49111,111564,46502,33342,56846,68541,63559,858,139927,16654,229375,76759,26478,33205,95828,23399,92945,2637,35630,28470,143992,50214,14174,21456,166191,65665,1711,21594,78019,97599,111701,36,147151,110246,189022,43021,30397,40757,131935,42065,73335,48039,26596,28984,15102,2361,7421,202167,69744,43766,52826,3642,83304,33873,75140,63169,192389,36551,92748,13039,123959,233220,21738,84447,77230,20228,187852,19095,25799,92136,108774,29237,53947,2299,118106,2687,8830,42331,202924,33667,2023,73763,30704,19363,19779,16737,35629,48081,24068,101013,162338,291912,13749,24745,328289,167679,70086,48299,23306,16732,17801,43322,54589,3586,63653,43624,53474,925,109177,251316,43805,13082,19511,86565,142182,92461,17117,101033,103319,64589,4022,4351,235897,5352,82705,107142,46391,156084,5860,61365,10558,13045,7717,18357,33922,12590,33065,6928,46993,783,46937,67846,8952,26295,6107,119656,18799,17458,50747,4229,179559,112727,118080,20683,41464,125468,51560,49749,44231,7359,35339,62988,136487,67015,5208,29150,24956,105186,48858,6143,18097,6972,16404,73489,58742,97196,36357,164616,5834,32267,13746,147733,15113,132091,34127,106298,39729,106426,22294,9780,15602,36213,71502,42808,66802,599,60755,5851,39120,67363,108623,126368,72770,91263,32486,30596,151717,7951,52002,43103,11768,68942,40901,39344,24037,127500,116890,48403,16926,86750,17745,48648,159545,34460,58419,5634,114317,67865,31462,23352,24010,98185,125708,69686,68337,13610,26271,70691,2980,4768,27225,102402,75453,28106,8104,6931,1176,6274,6475,112635,22498,6176,238686,26832,28893,90319,14441,15682,15087,39517,45270,109134,104440,45965,47645,81772,7876,52683,87720,12898,4505,185665,2769,113401,15664,57592,105229,137381,97059,119268,6876,43309,33886,128363,35476,144249,67013,143587,83367,25703,91436,59347,53236,2289,16519,19844,46309,58558,99834,23313,218816,231303,36388,51333,183535,109792,139277,54306,90139,18235,8275,32710,37677,82464,86025,92204,88842,117723,37570,128723,234242,76350,73795,34896,148247,58424,11105,11744,45746,63372,17118,49772,199520,81902,38004,22911,33752,3125,1995,53792,4689,26909,108150,146062,69674,41811,161444,84855,8999,28561,16731,93937,3189,21967,24890,22943,1356,145300,51569,28802,517,118679,31703,40607,48098,108854,25003,10233,73969,177495,5248,24516,215347,146192,48712,60626,69188,40735,5866,586,101541,6509,47590,52129,5969,222045,110933,25733,24223,65339,62812,2414,155418,35819,16022,78423,43138,20995,128255,240673,46745,236093,72176,57085,97841,61248,107,36068,193177,105427,55726,215229,20446,47228,100420,87091,14429,121708,23605,21157,187721,21880,2997,203976,99166,95068,25877,7724,98925,83401,4829,13182,18229,13718,239662,38653,116505,153497,30589,89029,38962,181302,43853,78872,180301,4786,248240,7401,106136,112590,77745,19731,60880,77789,125748,135487,5975,48627,34084,12419,215770,47557,254582,10364,106495,21856,67539,88981,38805,21428,48732,42316,12149,16078,52808,25327,51322,33850,51147,12253,122354,46077,56483,254553,115417,81834,150991,94662,86668,7381,12841,100650,18218,15741,22372,68294,50705,15535,84660,61887,22553,72299,31361,24824,17743,46820,64288,31582,77006,111674,116384,30760,80920,86149,77192,51979,79691,60342,122805,103800,240873,160744,233114,78962,54920,8608,3484,316104,72548,24337,5088,230040,21926,10172,36838,26,86221,83458,102176,12062,17571,41929,41170,28428,68239,41750,103930,2634,18313,53019,34825,97837,63115,24606,73157,152474,14715,91439,37033,109806,140259,30668,174760,380,135597,95673,136073,65073,134249,13829,17279,122305,4420,46444,10237,64848,203623,70728,10349,182885,65075,24519,25783,40318,34139,22222,63394,55266,102764,41422,20126,65100,90408,53640,35128,48932,11192,38935,96839,34782,39492,19396,41332,6250,5511,19492,51304,25936,104466,54099,73771,86115,5080,7669,30891,111700,13931,25276,72289,135447,14820,258641,25265,31005,281179,75286,393,95359,14623,13584,6680,101227,80173,44933,76666,54542,13244,39348,458,25379,109451,134348,81143,6959,65554,12027,51311,8716,57589,140731,28467,23316,17272,30458,25980,55229,77197,83798,28302,114784,7428,34548,26241,14712,39336,103304,18928,54080,12870,334,87722,15208,16895,142098,114262,39820,83913,57817,28682,7721,14900,108672,11250,62246,42849,415188,1724,26555,24549,25505,26443,107450,145899,61035,43528,6901,60726,65906,267741,21338,147590,42079,18924,73017,135236,15393,5206,4026,84185,1531,5988,113890,82647,303391,7386,69844,71611,189865,76523,31877,13315,19314,198575,32821,1928,67641,25913,104475,103489,3297,70391,18406,15446,113347,19295,93790,27856,1792,167471,116449,8541,4408,41757,63233,25765,86680,64501,27034,24816,34975,6079,4486,49693,36229,16917,21581,62426,27862,11612,54284,35702,194034,355,24277,48262,87411,70504,310164,118018,12516,47559,43502,57433,107139,9290,66533,80863,14634,34312,91725,28606,21342,67241,72355,43244,375789,37402,174015,105070,8342,44167,67494,1890,16365,11723,271002,1865,47918,8350,45564,27742,25110,125803,8553,49504,81925,62211,4534,15491,19011,80373,206920,667,102405,128623,245524,5553,113309,192739,65766,19567,22832,261958,29679,21293,71134,20962,105123,24721,860,21752,33448,18372,157167,94822,35770,173224,232737,75729,28937,46828,28062,25453,5207,140366,36665,30652,6169,67920,150458,92040,23186,184604,92330,20891,176492,49427,27828,38305,42495,143982,49560,25503,90043,29747,65328,47830,12932,11068,77721,9003,25213,94205,140426,46090,89945,138173,192691,33329,112232,129905,35709,27514,1841,19957,31411,127476,53572,17497,173549,55063,175135,19841,69314,5192,237921,117660,150697,4060,273045,50414,98940,65348,153665,164423,58804,156695,48994,213928,86036,28608,8355,39574,34540,16927,135680,18374,151587,10830,53805,16878,16623,4282,48030,8537,14986,46102,13062,72897,72,33050,108227,39451,45935,651,113320,40535,95176,57450,48843,5003,19019,10407,211163,3848,1068,4988,32091,30095,41692,15099,43602,107434,50744,7627,171349,16313,150832,352665,207750,33937,38256,51091,156e3,87889,90663,84175,24908,114900,50365,31494,83829,5398,169342,47521,54818,18935,8356,43094,41212,174536,10082,92550,6678,60614,23355,69721,14796,34149,128830,58187,3179,208,40325,28399,225029,401412,51150,31580,207268,6657,10993,69818,64282,289845,23308,12961,38447,6681,52944,31855,2572,47646,120728,179148,37240,45196,218274,4816,3695,21961,50084,35209,18073,51452,27004,6100,33941,1377,84831,171214,85,141510,9078,99227,32610,6417,11718,49868,65579,87902,73018,49062,46280,61742,21512,40862,107733,15941,29168,157765,144919,14487,5767,158014,140070,7241,573,71584,16921,223566,40331,179473,35081,47926,140885,41508,52104,59180,42310,32811,29048,123517,102413,80208,10104,14746,12649,153641,126022,37965,113017,4171,83,142592,2809,6362,50416,71323,116894,260776,16204,1524,5760,30351,12658,20703,54403,36083,45408,74772,4946,14485,50759,111222,10890,2195,167147,92962,130534,16283,177256,35016,15472,210156,151187,73922,117691,43250,52051,37392,24811,24358,30830,5775,818,21969,1476,127322,151783,58392,31021,106913,65215,89407,90802,28531,11690,20234,95249,44602,37256,18707,11928,5161,4410,26571,51903,49768,22008,25252,65780,209499,68769,203726,13249,137363,48845,86823,6658,5674,31881,1083,1823,108676,34518,166752,13791,14287,91576,91429,8665,11529,26401,16191,91972,30964,5254,28486,54697,79613,66520,18447,22870,45203,194466,22822,51703,12278,76716,44595,73455,33546,12235,144843,36154,51247,11116,33040,3180,225753,60864,1972,28469,12891,28879,10338,144157,56294,353058,38302,41447,87532,110616,27065,168438,6557,1213,50804,144643,24817,2390,136531,38174,247513,16190,4059,122791,131994,137430,39506,57650,16305,5188,54309,106128,20628,88071,67394,395446,250285,66176,91254,1399,114196,43915,60230,44853,27206,106353,43013,18733,345105,226453,51202,16607,57106,117175,35492,10476,89598,127439,15187,39624,13688,61570,10615,31111,59370,6238,175252,32143,224492,41388,95408,34384,148238,78307,38959,9340,160091,61443,15737,11216,41244,170,38299,102443,113097,26382,14027,33707,3957,76300,66160,19431,18900,6952,1717,108656,82206,188021,257335,27295,43999,41210,31777,46956,57457,12657,11489,15697,48060,204748,53583,82422,284790,30503,137341,8120,19615,220311,15991,10217,63424,9808,67431,70976,98221,4491,15177,28535,144789,751,13230,2394,1504,33977,132104,30316,22230,931,97193,185240,24826,22687,174322,15307,22988,1390,188745,180325,29580,59068,74903,18994,29195,79,15436,7622,38462,11566,138710,44828,45774,37768,99236,68137,84083,19282,22698,17134,74807,126662,173497,46248,16938,119735,3212,28292,213652,49013,9975,32180,45660,86250,4801,68788,95490,77482,113751,11994,44624,94452,46839,128497,100316,5798,58588,73184,202987,65417,37790,88524,1606,43156,97964,105717,34947,11203,100060,37742,130074,93653,107799,94311,196106,41347,8035,10780,16390,27883,118236,167395,1979,25006,19375,31628,18916,144723,78502,114047,103107,86492,107686,5844,20934,206963,23556,22591,16562,146333,20167,10471,117434,33085,2863,9740,36669,41849,37271,22790,18209,28979,8231,12952,54408,21731,25130,45208,55748,138120,75826,414,29593,9925,292865,25999,683,123149,7036,92159,86055,61827,103680,23176,54918,58466,57578,13305,5709,86479,16697,31064,17660,200919,10770,49793,33423,32370,52047,16488,62555,6459,8426,83493,7763,59725,82812,18628,67760,79405,68557,9612,7673,28102,56517,69620,171797,32458,29541,15870,81109,32080,207644,71495,21202,11039,91036,61230,2810,130800,32260,4613,60590,37112,75214,33979,126402,155062,30642,63875,12810,194463,82799,47664,16725,36685,43367,61099,449,172150,102867,21691,301838,36745,7130,18671,57316,34852,38034,54182,35578,65900,99486,19771,3456,2658,16914,99866,28390,28109,8262,21147,34353,20006,4228,137085,1675,203023,283196,198286,214375,163329,290603,152574,40471,83506,30068,14730,23177,131539,34759,27668,32178,71896,104799,116305,85430,119262,42860,25160,8911,23428,49437,105322,6519,16203,6349,74711,1230,38045,8540,75165,44736,25909,51026,317034,4984,32281,91312,27060,44431,17817,45363,155937,239085,35697,59784,91993,29531,126740,213757,76560,167776,285273,24262,8237,65030,41160,74437,48804,118916,13159,37842,1031,75349,1478,11655,108777,23435,277425,101734,67469,70231,124711,43532,28514,65526,54956,1e3,21882,17728,25302,40952,52214,149632,1999,2111,3259,63362,89961,220561,39777,26335,9063,10572,12416,34551,34623,38604,24723,5947,15588,69927,66252,119177,69173,46629,28714,70715,212408,20521,406913,74380,11716,50659,50862,37009,88460,130101,7210,53853,538,65120,151950,55806,163748,52837,13153,21100,16674,64536,6091,138201,44837,58547,3723,163,2177,32288,85454,34033,8497,14282,25742,10535,10741,79559,117493,243787,49337,100718,79495,40139,42956,7551,55433,15421,31509,23034,45081,547,61176,53434,328001,8470,36263,30145,4519,74173,53935,11845,73774,60211,78025,3,4102,73782,109293,315332,48412,26683,13714,6865,20128,18490,104141,325,39470,171970,115860,15707,7268,73301,74336,31370,2368,111827,107757,136231,142844,97138,96638,84053,38691,23801,1588,10573,122098,77039,240,186135,146101,11996,18143,112963,46171,155836,348769,47795,121213,116266,132515,3344,144804,31286,99187,255838,129694,35894,48779,55235,148582,71967,65282,15174,13920,47080,6147,108242,157593,125025,7136,1286,28957,127956,28402,98813,20805,7532,109417,40610,5041,32958,15142,18408,108596,33543,50517,27748,80114,233434,91447,487,37094,100048,30541,43477,10639,89862,155868,37667,8726,60684,237903,73408,99589,12190,38739,97348,3914,13594,2680,149016,13907,30171,28343,23530,115225,61104,35821,147679,14337,4297,244282,24085,326976,56428,7851,21303,131620,71446,83253,68692,111870,5224,15813,38197,49026,45057,13660,3306,76345,40671,27905,91072,996,68527,62085,91351,122634,55109,168209,2024,27560,112707,17352,8306,167115,169921,166958,5031,46020,11844,67284,19130,76185,6920,32849,5450,14610,22451,21002,17392,31872,66682,84796,13709,40210,59898,12029,8719,53564,21462,91884,21647,88379,194428,12754,37797,132826,160016,22567,54383,53186,77611,31107,8339,4694,19185,90355,23597,17222,140675,28442,23668,55977,9128,61555,28774,155229,17658,9390,24379,69357,15752,127381,239631,62460,93181,55913,45133,140155,18676,25249,33164,29581,82837,67223,22362,29975,7317,52813,1943,29613,20012,207130,49617,49651,5636,15334,36313,29226,28084,95247,72072,19e3,224932,15811,114,32127,38097,37508,88507,37225,27359,91626,12193,69279,20608,11055,88156,92808,2152,57259,55275,72789,24475,104414,1708,9882,3818,48661,66897,1631,34806,227930,85815,87753,18321,250664,72733,25107,206797,50891,8082,196411,92596,96764,152823,65514,22819,387277,62176,51225,40329,15563,189,3659,73670,64357,51793,275136,33482,86653,74615,67058,11318,125720,15388,22388,8267,1730,102663,170910,40784,7144,85373,13040,7088,94309,583,44224,140424,77439,18496,164026,36578,4722,9151,5824,63365,26510,35199,40500,79277,32495,44614,35233,9566,203293,152144,7097,2330,183480,98629,13423,330887,44130,68600,30939,97829,31012,345465,56747,94879,4939,160027,149761,99423,46099,32251,15332,8761,96094,128555,5763,235318,222223,55729,30241,55420,201746,3987,81382,8259,49325,23287,7719,24633,251100,92311,18591,110533,64759,170260,393860,7175,21144,132887,3593,75346,101277,91109,16387,259187,11627,57459,173829,44694,55780,49797,89192,120443,62622,3904,14814,23887,1027,112258,64955,99800,11132,66353,36202,48624,18158,88481,96882,43059,11040,2455,7077,21651,181159,99126,100434,61388,68186,19161,110468,120052,8819,55324,41494,7014,37689,3618,87729,92615,207943,9823,128657,12587,15857,6379,67628,51216,71775,157617,63244,1503,3864,218754,110864,5769,21492,7243,1192,87921,85529,31512,18537,42698,35350,73510,84474,34301,8991,21013,35034,566,38832,19838,35586,37216,39413,55006,12178,59742,856,84563,6900,25632,17437,49786,30723,13847,70845,4044,7843,23944,235976,55530,48942,6518,20939,73769,192653,52936,95207,23895,132542,142982,22632,87452,48042,54018,178468,10728,26230,23559,363,81269,142012,5718,346258,31456,84333,246476,51018,66692,101804,120570,39962,30373,70593,2864,60541,19425,54209,104092,7201,31545,48018,25865,15442,46257,40443,8328,6451,111782,47527,97754,33046,470,245116,31095,39,91934,87208,73470,36708,36521,12801,70624,36272,8892,79768,12427,55454,103756,5908,52390,62962,22720,141138,94634,41689,128402,126390,6628,106394,35527,134394,82727,254651,194502,148064,89549,3202,28359,957,21954,27906,49840,142747,8307,24206,48978,1186,71728,133038,71474,91306,6333,110959,74600,70387,18983,62609,56057,22970,1147,135850,1321,28834,3578,59715,102227,32827,81415,99952,55636,257598,390,22702,35701,85872,402916,39216,189795,14929,19467,10112,144422,61514,5279,63421,134686,41436,8424,51925,10598,132295,124416,4604,194739,210929,57866,31829,51626,50007,9976,91878,61906,56168,81906,60918,61859,40017,23059,16887,40927,62064,12785,32893,32913,21782,93965,20169,44387,79084,38463,11457,93950,27127,157050,2697,337088,5116,54128,48255,33279,8821,27352,25515,124022,65710,28906,38557,33390,1722,104435,72215,38551,12094,30978,25113,6671,37355,175109,42862,98024,65406,221276,59624,118012,64637,78760,86697,21426,1639,40350,12584,67193,84144,31396,7863,143011,69629,63112,9454,28666,65798,46372,134721,6314,51402,30837,151922,2847,38676,38008,92823,136245,17540,5504,109295,205242,37606,5211,214892,1586,20670,208711,137743,19328,40652,16995,20023,14657,154919,34422,12996,13918,38221,47690,16398,2959,37680,89122,6721,198469,91876,172043,83898,101992,26084,94570,3635,76958,22853,76497,38266,176590,168403,44464,142840,79180,184594,1984,41806,83147,11985,6546,366068,59732,24533,271505,8736,39084,222992,93429,28962,58985,86665,8432,30028,14548,32439,54424,165029,55175,27458,69046,121277,46168,33732,20661,24581,135574,123110,37556,79260,72611,16957,12939,46162,58238,44907,72936,253758,41324,32518,96480,11949,124438,65280,43256,34107,53533,43531,37037,28366,45970,32741,173438,6121,194202,62969,26355,30314,58370,28455,1848,50519,82830,90393,21761,295490,10936,256940,133568,44050,20269,4089,27457,21610,219460,36743,14821,101388,52005,13124,30979,140816,167362,26054,18458,60789,34917,40447,26606,33422,9066,3452,83614,5761,20263,137238,25038,91310,101,52322,74548,42572,38084,214054,186568,31802,17665,30620,141936,37730,14420,4265,187218,49640,188208,51441,55388,96452,66659,40869,42039,60967,221027,19234,178581,29105,96050,9165,196118,157335,3738,40354,117436,2965,34136,59659,15570,50843,230035,31444,71260,43886,18316,5387,38500,168508,17406,32174,8828,103373,143806,90367,3560,18719,122310,16508,26719,2541,105429,6645,37998,73190,10591,235916,49737,87112,233941,53188,32193,79154,4544,52905,126477,7580,63501,57314,3216,31337,6541,103083,60846,49,9756,15481,1355,43840,14319,13743,27486,10222,73114,230718,418644,16706,6674,279748,23058,45273,295831,86306,2743,5535,88773,21829,35253,120938,31153,3169,16839,42847,8751,80974,33942,36867,35514,16485,26474,77775,56877,5391,48346,3882,108713,31403,27804,55248,26235,43821,136104,40118,175507,28034,203908,18732,1788,34030,106427,36958,54359,7251,44936,15356,69139,455,157915,22173,140291,50348,43275,82066,49621,54952,15216,36226,96695,66855,6936,1987,8227,196087,4631,68827,99004,47541,110265,17953,147605,110242,58520,31312,38724,329975,642,3155,34497,75937,6207,73843,6120,17249,51429,117746,3218,910,68961,319671,14938,29555,34700,1649,66673,72268,9655,76800,153087,6941,210168,27130,35398,1780,73242,3135,56689,19556,165307,8765,35967,121458,13333,70453,17350,117253,22265,13340,44265,39869,441,3742,135025,23581,33309,16543,17731,13291,157637,283005,21408,101360,63887,52312,83873,5338,233779,23759,186949,34531,177320,38069,156465,91004,19353,59852,68160,14891,1338,1072,29823,1950,28901,81407,313445,73038,84807,162348,240257,37162,138934,16111,58013,41253,102951,16457,96056,19541,56402,67217,41638,94381,89674,29481,37456,80815,151579,13937,13683,132537,19699,134545,67020,29816,222341,141235,427578,48868,129557,233342,23077,87871,16213,18728,16184,9469,37913,19680,2798,171356,178328,13216,50049,72690,71904,124644,55455,7504,29052,41036,266546,19899,30391,188755,8659,59469,16,104298,112943,53865,76203,138226,68857,139953,14125,107625,119795,173133,4398,50273,48808,54390,16466,122086,31835,67035,50971,48859,7508,46427,66477,73021,84615,39985,83076,46779,201569,53336,36443,60865,168164,143810,51393,25548,169307,32896,24485,38424,21837,29087,275813,51674,6714,64883,46169,187369,55186,76192,12852,12018,62134,31067,118303,16542,12125,10579,4928,26291,43854,7091,10946,253716,109062,39283,17261,113012,258512,47764,125126,32646,55892,80279,201623,149872,3192,385,1208,48750,5376,58738,22335,5427,82416,47811,32435,143086,38930,94128,59975,156037,37977,38224,62485,7698,50405,71027,16462,21559,136153,34131,107506,162069,63703,3101,215029,40407,4178,3774,9187,80019,17880,97926,67579,2600,18405,8351,47924,86638,70820,92206,86453,29610,42241,119200,3198,15466,67813,57863,35454,4779,99518,4649,104641,144269,33730,38073,65864,6838,109456,193298,154007,5623,45741,30846,182578,25573,157224,1543,58575,138703,146140,44971,49356,18275,59064,20300,13122,11848,24453,11973,9797,86843,2919,25530,49210,1130,161220,76788,75373,85604,34926,36014,17777,17255,51533,11676,92226,51845,119859,21525,5936,18507,28050,1140,31418,14857,34207,47859,10750,36382,32079,106909,59426,87757,38393,110042,15965,97104,33757,35344,97993,53979,33651,45407,41884,82515,173089,7177,58371,35365,47543,51927,35587,10670,23544,29306,84233,39976,76076,62097,9007,8668,28119,78281,120790,19835,143020,54968,18670,64959,20649,34469,42570,33001,136570,87796,120044,1106,58700,63951,127623,12805,83057,40212,31773,49850,7361,54336,347524,101314,23751,19569,48791,29174,49369,20467,7465,75842,38281,623,112457,60210,28849,51003,94720,6426,90047,85560,43761,3579,85105,34607,90410,118528,7224,42907,111163,18168,6960,161135,191298,5247,100584,127552,171568,20121,91173,12636,54615,20199,63730,98105,2396,40387,14438,125012,4765,33235,12865,45299,37728,82098,77872,114037,59253,19675,24838,398016,102561,11446,17069,57508,178277,65836,99941,26114,2585,271882,136866,50126,11027,155648,118367,14585,8910,123015,335383,40434,41016,53021,14439,87098,176860,201543,121888,2358,9286,5739,22666,54270,37884,169381,33984,93859,16124,89364,72207,51639,76366,99029,65812,2198,12147,174891,194289,6986,30252,88822,21284,11445,288337,160821,33034,100869,43852,25761,52882,1144,103809,1924,84458,86079,43411,13542,139276,18141,34978,41298,7276,26481,173800,33210,17951,142652,33616,33677,2210,19941,98568,2486,192414,80136,12058,235883,50963,249638,29572,27221,47034,6124,72107,63346,97620,158513,299699,40388,23235,37176,224244,198386,121323,67992,23827,63170,17838,106622,158590,26807,5345,23489,91891,55474,74834,37981,13058,5977,72552,34706,26828,145172,19904,21367,34043,960,77092,91381,4733,47446,7680,41697,5170,16960,14741,46101,13656,473,51842,37433,11103,11551,121951,13191,97536,165932,50397,51628,129028,9069,44885,6590,59195,47045,32940,225472,90345,21833,13303,29407,96615,141951,5198,6028,18395,7181,3861,14966,156358,167182,36529,55253,25942,173153,30959,27261,50691,150176,162201,38467,48462,80602,42163,118482,168,108756,26011,17166,54149,456538,22512,91374,13816,90358,131615,18132,226707,1824,28139,26860,42253,93877,77351,65575,8980,80574,22020,27948,40422,91324,76376,13528,39281,91685,82215,122541,144066,1983,193851,17283,26320,2739,194978,4790,26845,42627,61300,65815,174612,55133,4200,191130,79771,158321,52280,166796,221620,62461,11278,4067,88152,83409,31717,121367,13522,47325,37945,10406,174348,249321,154101,64912,29938,51775,17220,15776,166138,78890,84425,54121,42861,16368,24572,291647,10197,32073,22651,11677,97509,26952,35787,18424,41910,71614,94977,72318,41594,70024,275419,37702,60199,7335,39107,61315,18271,18394,33768,87884,104277,123724,7277,56288,71981,189803,49320,3352,6798,14240,8954,69220,94433,57372,28620,68863,193727,85575,42309,41667,67689,42081,22543,44824,12719,28540,114236,101553,27638,27296,4300,5353,4663,19379,94098,3758,95888,95144,80344,87320,28447,259518,12718,71391,152731,37063,24132,31911,104896,15672,103782,1521,4945,72541,23717,122632,15619,87175,206120,29428,189780,61416,28350,44457,972,1175,47233,198738,95789,41907,21953,97034,59341,22864,53713,16873,32971,20693,20954,31336,21477,16169,38370,16412,9019,3841,24599,21938,17085,6484,81198,76413,5849,72514,12320,65247,276175,37234,59796,52642,16312,57349,198507,94148,46134,18958,125552,1747,18725,151873,14901,5490,68287,29470,3689,64794,40814,26018,25692,54450,2703,88278,124886,173087,174e3,24159,179477,24276,46004,201876,209202,445,52876,31948,30206,157610,39180,18439,44124,50469,5774,96278,222758,200216,50290,45486,20435,46986,46276,140133,142326,15569,13363,47522,92583,2182,7135,16853,22998,30272,4952,63263,35623,39096,53789,44864,20053,110392,124213,4630,16087,28221,127787,25839,77481,44693,13464,113146,6983,27069,55717,50102,4760,7107,26186,66507,59145,36032,104182,71328,29425,64317,50781,47465,94298,69706,74899,22754,120756,25108,93077,56834,73286,39928,16218,41699,176763,7555,70819,50083,26895,23315,26014,16773,123079,41712,5719,31516,90427,158540,85051,183128,40864,27505,55392,9058,45224,96857,30901,136622,96557,56304,120061,11501,151448,5773,89743,7769,86069,2935,18471,41628,10114,33660,110170,49479,26745,92846,33221,26731,18795,87076,8550,2100,29972,120289,3077,72490,33784,2630,208722,50861,63483,79029,6419,39467,14302,45286,64207,9686,67513,44170,1050,77246,59266,17055,53801,7150,11111,42432,4278,94579,362117,36175,42902,41933,39002,98489,22913,74161,84773,57036,17556,162288,74485,178760,93867,73635,128860,50362,261,67455,80001,46080,35662,4368,25247,19230,74393,22588,1822,27682,235324,13798,85998,13194,235067,23514,71669,147632,23191,134748,214683,105101,1518,25489,247114,7380,54842,26922,3971,26361,20844,68642,170517,77339,123255,8963,77818,150998,48466,36806,2732,23261,11741,236162,18243,126216,28690,50546,16385,92760,197383,246558,201295,88255,67588,71687,176076,172653,169058,33906,63747,24835,157621,43338,30050,46152,132741,2770,51371,94835,6614,15112,11749,56936,1250,19027,399017,58036,100215,23388,55815,308768,124152,94803,9521,64186,8971,28,30427,62163,7616,103838,35079,29203,131235,7743,17389,10882,37420,61460,228512,85363,41581,131077,62822,119647,10130,54445,26925,19968,29016,24446,74028,24176,61448,67185,9254,8563,119129,9771,99184,37716,39514,10532,221512,258753,218630,55980,23394,32141,61924,66749,32411,3741,36475,26678,77010,44946,91203,128749,116953,20476,49625,53116,13735,102335,29376,51946,83407,67892,59212,34685,21083,1546,112982,32972,74397,1078,190545,16082,86140,58591,89611,101531,10061,105104,76319,20035,17551,52611,169061,190842,100780,23907,90413,115619,9675,34710,193435,49443,129734,11183,258877,16318,136182,126808,44635,27304,192375,2599,125648,47051,12091,23814,721,58800,40137,66726,97930,60877,74487,7942,54326,9841,41428,13762,8211,85383,6950,99177,79806,201786,296464,124087,13144,29741,41721,47634,55088,254286,106408,17041,99064,12942,64086,45233,14005,2612,55827,255,7984,13980,38574,12776,46654,73499,249951,2101,26676,25996,132326,116415,119062,50449,31033,23038,11589,179252,20007,14860,129270,21143,17796,144715,60106,70758,69842,34674,282133,44014,16774,57268,38528,24053,46373,201667,28327,471023,51889,102667,21193,114909,84132,69317,96723,67969,16134,68145,15058,28765,32035,2524,101089,98664,25045,76571,14957,86040,118506,262428,154764,81573,39681,283900,73287,127825,544,80448,52347,38512,175971,15180,45467,33086,46552,48894,81107,43213,36672,54025,76703,8053,7608,13299,56619,20752,238099,54164,105133,1444,32942,953,37564,8e3,66316,119463,106817,404,13667,149108,128597,31267,10269,49836,106150,1484,52330,76965,160486,171648,38456,31263,22424,37738,66245,67467,143369,60471,75610,20895,115528,86070,60854,40796,49347,18989,15030,11371,37578,15779,79867,10187,86462,46402,155626,93200,40229,7090,57547,108053,99598,11088,47505,41218,206017,2173,20988,30219,22919,80563,57566,42369,93141,41675,2407,182519,120495,27154,16702,29456,14349,7958,16688,117177,140375,42467,261919,74916,153569,10836,34742,49526,7621,105997,12212,2270,392377,7755,17959,25086,232152,138791,33847,13860,35316,5811,1344,71259,50452,207539,92635,50359,5821,33674,30255,2086,2587,96264,17543,42,6029,9580,43007,139248,82831,12917,29607,25786,51467,42137,85161,100698,31561,88989,121990,278500,3602,109344,37982,15279,116442,28936,30880,87894,58079,128661,126731,67392,28051,146885,4861,16216,97344,42827,147561,153948,22684,21335,47685,1853,43349,15185,59642,10229,25520,187921,108972,5579,98037,24945,6697,19193,63734,137934,75056,89740,19767,224268,56138,63643,151661,39313,70618,84031,89723,84074,13703,85626,35460,8867,64845,3439,57906,99776,63968,49270,81130,34356,16210,23547,36446,34090,140028,72439,2221,22163,57058,363492,113754,18913,95451,48663,54464,54037,176097,68425,3023,34906,29482,117389,341780,80431,58330,16753,92616,60907,94846,147486,4498,48646,7773,46801,7778,18946,464978,47558,33223,177444,7328,15626,63337,94700,11743,9351,255024,39098,16447,42647,96230,39769,58840,10068,63439,35800,65843,58823,413844,9156,51258,7434,61791,85018,6872,3692,28096,7121,33024,6009,75532,31997,192535,9661,3304,9547,14753,31987,25314,55689,15896,20430,39472,31340,99744,25398,115569,54883,28719,205423,23071,57855,64638,149867,25671,82403,37616,20668,39989,77996,74948,140555,175248,64810,36515,46595,4958,248773,24045,28728,136673,168704,20804,114833,100325,27135,21205,96151,153134,45992,7093,13992,76047,1980,19432,145001,75159,87462,17710,1013,45556,34297,144882,20648,26061,11319,129567,108555,18872,464580,33386,22717,65948,167189,5603,135042,79542,8801,202632,18114,91882,5973,5239,67315,4431,60916,47819,71693,32597,32606,18183,45072,80329,76385,24749,51305,40314,156514,14693,130345,13168,66214,18029,12858,34801,27628,14544,10823,40522,40185,33739,148694,23548,9923,61012,28859,17933,19442,34364,99849,164107,141167,30629,21054,6744,36491,8096,42474,41706,155060,30650,10600,163442,1143,96655,61390,52359,7559,51568,64256,203854,4467,22453,14504,436398,7878,6980,8293,63610,293747,16167,35763,19627,147603,15419,18032,110744,51346,33681,54571,40472,48615,39073,21604,13754,173027,92560,11083,47299,63062,11813,52007,29883,9734,139722,15953,1550,20651,13616,49306,16113,90089,92326,7584,30712,72424,164858,6831,152871,55746,197721,34167,196442,6022,112107,55215,7538,123381,4920,43539,77165,8939,50392,34192,20225,79762,22505,58667,40770,29788,97180,82835,4568,8579,13273,363569,35898,49983,436,36598,3237,131691,62418,35591,8101,4073,379438,65218,76072,33887,2968,27573,212619,288680,68278,72851,150504,217896,6913,121339,22017,35340,51072,43616,75043,31437,10833,81487,4364,22968,41454,106687,85446,19863,109625,149241,524,141850,214404,54376,657,237023,9401,108137,53800,32474,49712,53334,126876,27337,45552,177696,8269,15036,12097,42240,2328,125374,119295,99715,2500,19624,39441,27220,102691,60957,94543,39101,18566,67362,13975,78230,25017,34017,239007,90027,39351,41681,35354,43822,1043,916,58587,141983,94818,38799,75459,41114,67432,16195,36606,59568,22272,126769,31424,68659,12287,134302,257977,5756,207285,95637,47248,117689,19583,77451,22373,12200,54993,117118,34244,29386,34562,53819,71267,64172,77665,49368,7716,59301,25749,45426,194789,17297,2650,1766,32501,45198,20403,20984,6600,14171,94604,19037,5402,29896,9938,59935,109708,88081,145182,44844,39167,352626,164173,35374,45982,6122,154,73419,220487,53834,53601,17992,8609,229321,5610,68098,66815,71012,95069,140968,27396,8957,134489,24656,86659,56598,134852,17316,123838,255436,6613,41610,138033,81452,32023,32396,123687,63398,8693,29712,30407,19296,121188,3551,36099,20032,111948,56624,16547,27453,35916,15378,52039,56849,13489,22214,73177,53097,277349,2157,14029,187886,10260,141743,246460,91880,50869,3788,49486,133566,54950,33120,129337,53768,18333,9525,26902,312251,10297,9020,70759,16647,112432,59260,84609,9818,82766,73569,468,46001,75780,55028,52106,11498,43645,108069,17150,17753,29417,16705,31799,9606,289,122254,115975,8620,6133,255357,56908,14456,133464,43554,79224,11247,29630,160,12756,25464,65960,350428,62521,321796,100359,67358,35169,46172,113128,48988,88868,31094,33266,6847,60887,98188,49659,69117,92977,220228,13947,80181,35103,62170,97351,13475,2440,199768,19498,36597,46971,25234,67806,62881,84717,73648,181966,10488,94149,21550,26655,63436,48375,14405,165650,9621,24439,28043,42735,4490,29963,56674,45373,1934,262446,50855,67098,26898,5261,52696,40644,33900,9440,180286,87162,22940,19704,26936,69769,10254,101759,27406,12243,48e3,73926,113215,54935,5726,192787,4312,106216,9366,11550,52949,23457,212271,277152,133895,108374,6191,96477,29980,218916,58024,54696,40853,91124,65894,91170,65908,252552,6793,29212,15389,44516,122515,52617,35058,9017,103536,39510,49136,19242,130652,662077,74699,47024,31422,8517,73351,24399,13867,128360,4810,4434,61779,111983,61036,17798,110240,59722,102960,39688,10001,23803,23039,176498,56659,44814,134295,17188,77577,74466,226175,102472,154333,63900,111747,18062,41171,79669,32773,408933,42562,28931,30907,107388,43487,2946,240310,23938,24354,319,184983,7927,6488,1422,10790,68809,68209,64775,4361,202,17123,59634,51200,44391,18188,17843,2619,74278,3230,9540,47187,21702,36274,56894,43907,16310,34790,16866,6150,5561,13587,107545,108873,126867,86986,28640,33427,19017,5762,80637,17430,46903,2047,131055,25958,13558,5444,47152,13900,44563,122857,45348,70863,39593,54332,38068,33637,318,40310,143467,18502,24520,11377,62013,28942,27246,28269,83545,17999,59015,90707,30065,15161,34720,1263,37008,2012,6060,98575,92933,5721,299,199555,24578,29223,2985,743,115825,109523,136657,47454,26378,53586,3733,174945,93340,244456,5693,37386,28782,89767,27545,23573,18798,136425,34320,84778,20041,48453,38215,7477,71958,40621,8773,5874,187927,105965,51100,43533,18083,8443,10180,43597,2003,183999,69689,12216,129696,146188,62389,34044,68410,12765,43273,26949,266807,3345,34477,79197,5688,47539,213110,21634,22257,50092,32222,42346,39530,63668,98,134978,74022,5152,59088,174145,37220,9934,9545,118937,5724,87240,19875,15784,40143,23263,87513,181654,285152,37881,263241,4966,43934,10433,186657,6470,74416,225854,25908,142677,246262,32280,6192,75890,45546,143264,135305,29742,47013,77787,11732,126658,8763,37950,21806,57557,113464,89465,108995,164574,23894,22996,23169,15369,23117,17642,130607,40503,36239,280990,44666,9981,40427,147487,26869,168452,32886,32991,46798,240839,15111,70502,65697,88548,44145,28701,48767,31139,206777,35659,181164,166262,14554,171445,31786,66523,76607,17956,6507,31279,90476,116611,167918,6560,1243,115324,80128,41867,55897,187323,37069,32596,189444,145931,13390,105530,65709,26805,6999,55714,41300,22915,68951,22138,21120,22264,10058,19945,33635,56123,99085,10032,5818,6016,46649,57476,35264,94413,112522,262288,93686,83038,14341,23204,28807,66084,77987,6101,126673,7133,38126,5923,122091,170240,97772,46874,215746,43948,41622,3272,55596,8332,146411,251315,13533,8561,81521,115449,48616,175175,2063,186556,3036,134537,75772,29728,82360,22973,186559,86348,89100,38388,82297,45610,2613,87082,9986,177812,57884,23591,47485,42543,33582,44713,74439,257444,252451,31825,35631,38540,33066,5147,13973,4343,51830,70378,22827,26448,95560,36896,241741,48067,203953,298860,61620,20450,3220,67272,6586,107662,100160,108684,6929,57226,4762,7457,1320,40404,77204,99309,62750,208653,59977,44e3,74315,34332,5819,172217,64904,114077,18147,84012,1791,98456,90930,21446,116669,103938,7422,85140,59713,5768,326211,16239,75411,13229,29398,10758,236107,1539,112472,95979,152154,151294,306,21196,38146,10700,6891,84282,109646,56492,40539,6589,119491,51354,30685,140209,136906,29622,73617,49553,70525,51671,166869,139616,74395,37439,49595,45678,11959,33211,86560,52434,9282,62690,112155,130810,5243,108261,99970,265613,72551,80049,6391,33365,90721,66737,69872,87011,1860,9032,112544,60905,37371,89015,140351,19076,850,373531,2802,36725,218795,72062,28990,16550,24614,7815,6187,26336,33373,32162,42791,73555,32062,23386,10244,56392,49442,27076,136262,12412,14883,1134,33675,97153,199281,15608,100152,74072,47942,254301,36451,16026,10687,65067,56708,254030,30290,50490,13864,57941,259331,35588,23485,43486,24869,21620,92971,22072,88645,1048,182050,13343,32452,14825,19509,3325,216938,45740,99716,189082,53740,78245,25609,24311,176777,47340,308354,40669,66085,14102,125339,9225,128709,97207,1271,200933,78439,113451,88975,18324,46521,11819,18570,141756,72512,170020,52754,63550,118515,103073,93330,32736,50499,14722,31600,68452,398867,29316,172786,18417,104924,2606,5670,84818,16288,67106,59580,82929,607401,291,85829,359,15897,35830,50696,65630,52672,22115,356968,29895,40837,231192,34024,38957,26722,406,23335,124952,72068,68804,13268,147101,164740,276569,162596,66943,11569,26654,66358,4777,23229,102127,5848,978,2921,59666,5371,28212,90108,42938,39320,2499,4271,108792,33510,125072,71653,65239,38250,66357,38577,13964,86251,35708,50755,36010,29448,12209,3844,38222,206337,100876,67827,137088,14167,252225,84163,195270,1306,5703,54198,779,46802,22028,51124,86759,70560,113164,35685,162145,45471,34561,422,2611,6464,47486,19223,38246,9191,18331,89942,243642,212364,15893,17518,22617,6409,30046,126182,59716,36560,104428,18846,26592,19458,50793,147333,30826,1388,27647,10922,14495,33545,19269,135828,39727,41601,46931,233379,49169,131130,182112,16276,82381,118209,142445,128310,19672,28740,82907,33436,3118,102206,28723,24819,41937,38854,5157,3881,111491,1142,9776,421673,152241,29309,14961,87854,6054,15424,3796,82656,54996,2108,55367,239450,154525,9643,118103,106041,64601,68549,48707,30266,25772,18740,9462,229669,91798,112152,191327,14493,72828,8175,66636,236474,25817,87351,129027,76653,20422,22983,71240,27846,44661,12399,46158,77704,53101,35032,11072,17300,109294,33638,24408,1895,11241,760,17584,82479,125877,63150,141075,34259,23274,81698,15732,43577,48340,91584,14688,16379,24481,150280,96420,262050,48635,43727,61819,56268,72003,88178,17281,79912,13218,122519,125295,166396,11811,2171,118930,67746,17636,178278,174656,95661,173039,83845,79689,17473,98555,127696,203415,54730,22925,232239,9309,12136,175026,20740,180188,10747,39816,314017,266131,10040,175732,112550,220651,31974,37393,888,23008,86799,4303,64905,148467,75337,251,3284,370102,50264,9835,5438,23655,4481,29851,329,12855,7162,64931,78141,12804,42372,296771,83547,18624,34874,86271,3360,48665,77735,88767,11463,63527,28889,22258,29140,194315,113924,25499,6406,31334,1845,4802,49184,43455,35469,127594,92970,61038,115005,38840,87761,106838,8811,20572,55637,11162,96721,132425,108925,2948,125457,36356,3502,75270,27622,127192,2561,123095,49394,61155,16897,110064,9699,89448,53356,19628,220310,21622,83036,9885,112214,6087,26713,17901,161912,91492,3440,68594,9266,92238,8087,6866,150194,72175,80701,13459,31836,43243,239700,95846,44749,50647,21945,230538,120612,132371,244604,5193,105637,34661,41341,68775,85393,1874,8771,33718,49672,77403,595452,99507,6490,58895,128742,7704,39239,73217,43816,62824,37804,199976,22361,80005,87514,94832,14089,4574,139975,59142,75523,100268,43906,53442,15152,2547,186002,17011,19513,204282,3343,60568,128318,119250,4298,51871,41336,71759,21921,45074,98169,145889,99427,11350,1237,5520,28799,7803,53702,21026,136352,38293,128690,12158,90132,44600,10184,26957,39459,126025,78904,82999,59373,39301,150198,120529,153042,20177,50089,14764,271571,30530,123161,38975,101562,22941,5648,124654,109243,69817,71675,49162,106884,21241,107795,30258,16572,188262,141456,7688,60718,8271,11044,32440,104608,103419,236109,93156,43293,128929,42107,67180,25201,115254,185488,130954,72813,167547,20537,39969,38432,22582,184022,1139,27199,5655,17767,97412,122606,209377,27070,35871,326617,188954,42680,73512,80911,22629,3011,95021,315242,157737,383,41821,41808,19335,27950,15674,25677,110950,35375,76835,59108,57370,35262,16569,160415,37706,78086,32041,49691,137143,9782,172080,50148,77917,6323,10110,69172,17711,21795,59511,76184,135114,31046,132319,59105,157578,20549,80778,57649,158421,65143,4575,72235,21899,10797,92745,34035,106079,80159,4508,78304,25350,75457,46458,32937,25623,47,8531,104751,84953,8138,36508,187199,66310,115274,13253,32461,38536,1916,42007,187160,35055,26325,84394,35963,94216,45590,97782];var A1=15,R1=class{log;peerRouting;routingTable;refreshInterval;refreshQueryTimeout;commonPrefixLengthRefreshedAt;refreshTimeoutId;constructor(e){let{peerRouting:t,routingTable:n,refreshInterval:s,refreshQueryTimeout:i,lan:o}=e;this.log=C(`libp2p:kad-dht:${o?"lan":"wan"}:routing-table:refresh`),this.peerRouting=t,this.routingTable=n,this.refreshInterval=s??3e5,this.refreshQueryTimeout=i??3e4,this.commonPrefixLengthRefreshedAt=[],this.refreshTable=this.refreshTable.bind(this)}async start(){this.log(`refreshing routing table every ${this.refreshInterval}ms`),this.refreshTable(!0)}async stop(){this.refreshTimeoutId!=null&&clearTimeout(this.refreshTimeoutId)}refreshTable(e=!1){this.log("refreshing routing table");let t=this._maxCommonPrefix(),n=this._getTrackedCommonPrefixLengthsForRefresh(t);this.log(`max common prefix length ${t}`),this.log(`tracked CPLs [ ${n.map(s=>s.toISOString()).join(", ")} ]`),Promise.all(n.map(async(s,i)=>{try{if(await this._refreshCommonPrefixLength(i,s,e),this._numPeersForCpl(t)===0){let o=Math.min(2*(i+1),n.length-1);for(let a=i+1;a<o+1;a++)try{await this._refreshCommonPrefixLength(a,s,e)}catch(c){this.log.error(c)}}}catch(o){this.log.error(o)}})).catch(s=>{this.log.error(s)}).then(()=>{this.refreshTimeoutId=setTimeout(this.refreshTable,this.refreshInterval),this.refreshTimeoutId.unref!=null&&this.refreshTimeoutId.unref()}).catch(s=>{this.log.error(s)})}async _refreshCommonPrefixLength(e,t,n){if(!n&&t.getTime()>Date.now()-this.refreshInterval){this.log("not running refresh for cpl %s as time since last refresh not above interval",e);return}let s=await this._generateRandomPeerId(e);this.log("starting refreshing cpl %s with key %p (routing table size was %s)",e,s,this.routingTable.size);let i=await E1(this.peerRouting.getClosestPeers(s.toBytes(),{signal:AbortSignal.timeout(this.refreshQueryTimeout)}));this.log(`found ${i} peers that were close to imaginary peer %p`,s),this.log("finished refreshing cpl %s with key %p (routing table size is now %s)",e,s,this.routingTable.size)}_getTrackedCommonPrefixLengthsForRefresh(e){e>A1&&(e=A1);let t=[];for(let n=0;n<=e;n++)t[n]=this.commonPrefixLengthRefreshedAt[n]??new Date;return t}async _generateRandomPeerId(e){if(this.routingTable.kb==null)throw new Error("Routing table not started");let t=Fn(2),n=(t[1]<<8)+t[0],s=await this._makePeerId(this.routingTable.kb.localNodeId,n,e);return _t(s)}async _makePeerId(e,t,n){if(n>A1)throw new Error(`Cannot generate peer ID for common prefix length greater than ${A1}`);let o=new DataView(e.buffer,e.byteOffset,e.byteLength).getUint16(0,!1)^32768>>n,a=65535<<16-(n+1),c=o&a|t&~a,l=jC[c],u=new ArrayBuffer(34),f=new DataView(u,0,u.byteLength);return f.setUint8(0,xu.code),f.setUint8(1,32),f.setUint32(2,l,!1),new Uint8Array(f.buffer,f.byteOffset,f.byteLength)}_maxCommonPrefix(){let e=0;for(let t of this._prefixLengths())t>e&&(e=t);return e}_numPeersForCpl(e){let t=0;for(let n of this._prefixLengths())n===e&&t++;return t}*_prefixLengths(){if(this.routingTable.kb!=null)for(let{id:e}of this.routingTable.kb.toIterable()){let t=Si(this.routingTable.kb.localNodeId,e),n=0;for(let s of t)if(s===0)n++;else break;yield n}}};var Eh=C("libp2p:kad-dht:rpc:handlers:add-provider"),I1=class{providers;constructor(e){let{providers:t}=e;this.providers=t}async handle(e,t){if(Eh("start"),t.key==null||t.key.length===0)throw new E("Missing key","ERR_MISSING_KEY");let n;try{n=Ve.decode(t.key)}catch{throw new E("Invalid CID","ERR_INVALID_CID")}(t.providerPeers==null||t.providerPeers.length===0)&&Eh.error("no providers found in message"),await Promise.all(t.providerPeers.map(async s=>{if(!s.id.equals(e)){Eh("invalid provider peer %p from %p",s.id,e);return}if(s.multiaddrs.length<1){Eh("no valid addresses for provider %p. Ignore",e);return}Eh("received provider %p for %s (addrs %s)",e,n,s.multiaddrs.map(i=>i.toString())),await this.providers.addProvider(n,s.id)}))}};var ZC=C("libp2p:kad-dht:rpc:handlers:find-node"),T1=class{peerRouting;lan;components;constructor(e,t){let{peerRouting:n,lan:s}=t;this.components=e,this.peerRouting=n,this.lan=!!s}async handle(e,t){ZC("incoming request from %p for peers closer to %b",e,t.key);let n=[];be(this.components.peerId.toBytes(),t.key)?n=[{id:this.components.peerId,multiaddrs:this.components.addressManager.getAddresses().map(i=>i.decapsulateCode(se("p2p").code)),protocols:[]}]:n=await this.peerRouting.getCloserPeersOffline(t.key,e),n=n.map(this.lan?Nl:kl).filter(({multiaddrs:i})=>i.length);let s=new At(t.type,new Uint8Array(0),t.clusterLevel);return n.length>0?s.closerPeers=n:ZC("could not find any peers closer to %b than %p",t.key,e),s}};var JC=C("libp2p:kad-dht:rpc:handlers:get-providers"),D1=class{components;peerRouting;providers;lan;constructor(e,t){let{peerRouting:n,providers:s,lan:i}=t;this.components=e,this.peerRouting=n,this.providers=s,this.lan=!!i}async handle(e,t){let n;try{n=Ve.decode(t.key)}catch{throw new E("Invalid CID","ERR_INVALID_CID")}JC("%p asking for providers for %s",e,n);let[s,i]=await Promise.all([this.providers.getProviders(n),this.peerRouting.getCloserPeersOffline(t.key,e)]),o=await this._getPeers(s),a=await this._getPeers(i.map(({id:l})=>l)),c=new At(t.type,t.key,t.clusterLevel);return o.length>0&&(c.providerPeers=o),a.length>0&&(c.closerPeers=a),JC("got %s providers %s closerPeers",o.length,a.length),c}async _getAddresses(e){return[]}async _getPeers(e){let t=[],n=this.lan?Nl:kl;for(let s of e)try{let i=await this.components.peerStore.get(s),o=n({id:s,multiaddrs:i.addresses.map(({multiaddr:a})=>a),protocols:i.protocols});o.multiaddrs.length>0&&t.push(o)}catch(i){if(i.code!=="ERR_NOT_FOUND")throw i}return t}};var Ll=C("libp2p:kad-dht:rpc:handlers:get-value"),C1=class{components;peerRouting;constructor(e,t){let{peerRouting:n}=t;this.components=e,this.peerRouting=n}async handle(e,t){let n=t.key;if(Ll("%p asked for key %b",e,n),n==null||n.length===0)throw new E("Invalid key","ERR_INVALID_KEY");let s=new At(Xt.GET_VALUE,n,t.clusterLevel);if(MC(n)){Ll("is public key");let a=UC(n),c;try{let l=await this.components.peerStore.get(a);if(l.id.publicKey==null)throw new E("No public key found in key book","ERR_NOT_FOUND");c=l.id.publicKey}catch(l){if(l.code!=="ERR_NOT_FOUND")throw l}if(c!=null)return Ll("returning found public key"),s.record=new Zt(n,c,new Date),s}let[i,o]=await Promise.all([this._checkLocalDatastore(n),this.peerRouting.getCloserPeersOffline(t.key,e)]);return i!=null&&(Ll("had record for %b in local datastore",n),s.record=i),o.length>0&&(Ll("had %s closer peers in routing table",o.length),s.closerPeers=o),s}async _checkLocalDatastore(e){Ll("checkLocalDatastore looking for %b",e);let t=Ai(e),n;try{n=await this.components.datastore.get(t)}catch(i){if(i.code==="ERR_NOT_FOUND")return;throw i}let s=Zt.deserialize(n);if(s==null)throw new E("Invalid record","ERR_INVALID_RECORD");if(s.timeReceived==null||Date.now()-s.timeReceived.getTime()>1296e5){await this.components.datastore.delete(t);return}return s}};var VZ=C("libp2p:kad-dht:rpc:handlers:ping"),P1=class{async handle(e,t){return VZ("ping from %p",e),t}};var k1=class{log;components;validators;constructor(e,t){let{validators:n}=t;this.components=e,this.log=C("libp2p:kad-dht:rpc:handlers:put-value"),this.validators=n}async handle(e,t){let n=t.key;this.log("%p asked us to store value for key %b",e,n);let s=t.record;if(s==null){let i=`Empty record from: ${e.toString()}`;throw this.log.error(i),new E(i,"ERR_EMPTY_RECORD")}try{await Pl(this.validators,s),s.timeReceived=new Date;let i=Ai(s.key);await this.components.datastore.put(i,s.serialize().subarray()),this.log("put record for %b into datastore under key %k",n,i)}catch(i){this.log("did not put record for key %b into datastore %o",n,i)}return t}};var N1=class{handlers;routingTable;log;constructor(e,t){let{providers:n,peerRouting:s,validators:i,lan:o}=t;this.log=C("libp2p:kad-dht:rpc"),this.routingTable=t.routingTable,this.handlers={[Xt.GET_VALUE]:new C1(e,{peerRouting:s}),[Xt.PUT_VALUE]:new k1(e,{validators:i}),[Xt.FIND_NODE]:new T1(e,{peerRouting:s,lan:o}),[Xt.ADD_PROVIDER]:new I1({providers:n}),[Xt.GET_PROVIDERS]:new D1(e,{peerRouting:s,providers:n,lan:o}),[Xt.PING]:new P1}}async handleMessage(e,t){try{await this.routingTable.add(e)}catch(s){this.log.error("Failed to update the kbucket store",s)}let n=this.handlers[t.type];if(n==null){this.log.error(`no handler found for message type: ${t.type}`);return}return n.handle(e,t)}onIncomingStream(e){Promise.resolve().then(async()=>{let{stream:t,connection:n}=e,s=n.remotePeer;try{await this.routingTable.add(s)}catch(o){this.log.error(o)}let i=this;await Re(t,o=>kt(o),async function*(o){for await(let a of o){let c=At.deserialize(a);i.log("incoming %s from %p",c.type,s);let l=await i.handleMessage(s,c);l!=null&&(yield l.serialize())}},o=>wt(o),t)}).catch(t=>{this.log.error(t)})}};var O1=class extends $e{log;components;protocol;running;registrarId;constructor(e,t){super();let{protocol:n,lan:s}=t;this.components=e,this.log=C(`libp2p:kad-dht:topology-listener:${s?"lan":"wan"}`),this.running=!1,this.protocol=n}isStarted(){return this.running}async start(){if(this.running)return;this.running=!0;let e=Fi({onConnect:t=>{this.log("observed peer %p with protocol %s",t,this.protocol),this.dispatchEvent(new tt("peer",{detail:t}))}});this.registrarId=await this.components.registrar.register(this.protocol,e)}async stop(){this.running=!1,this.registrarId!=null&&(this.components.registrar.unregister(this.registrarId),this.registrarId=void 0)}};var zZ=32,qZ=64,vh=class extends $e{protocol;routingTable;providers;network;peerRouting;components;log;running;kBucketSize;clientMode;lan;validators;selectors;queryManager;contentFetching;contentRouting;routingTableRefresh;rpc;topologyListener;querySelf;maxInboundStreams;maxOutboundStreams;constructor(e,t){super();let{kBucketSize:n,clientMode:s,validators:i,selectors:o,querySelfInterval:a,lan:c,protocolPrefix:l,pingTimeout:u,pingConcurrency:f,maxInboundStreams:h,maxOutboundStreams:p,providers:d}=t;this.running=!1,this.components=e,this.lan=!!c,this.log=C(`libp2p:kad-dht:${c===!0?"lan":"wan"}`),this.protocol=`${l??IC}${c===!0?RC:""}${TC}`,this.kBucketSize=n??20,this.clientMode=s??!0,this.maxInboundStreams=h??zZ,this.maxOutboundStreams=p??qZ,this.routingTable=new S1(e,{kBucketSize:n,lan:this.lan,pingTimeout:u,pingConcurrency:f,protocol:this.protocol}),this.providers=new b1(e,d??{}),this.validators={...AC,...i},this.selectors={...wC,...o},this.network=new m1(e,{protocol:this.protocol,lan:this.lan});let m=De();t.allowQueryWithZeroPeers===!0&&m.resolve(),this.queryManager=new x1(e,{disjointPaths:Math.ceil(this.kBucketSize/2),lan:c,initialQuerySelfHasRun:m,routingTable:this.routingTable}),this.peerRouting=new y1(e,{routingTable:this.routingTable,network:this.network,validators:this.validators,queryManager:this.queryManager,lan:this.lan}),this.contentFetching=new d1(e,{validators:this.validators,selectors:this.selectors,peerRouting:this.peerRouting,queryManager:this.queryManager,network:this.network,lan:this.lan}),this.contentRouting=new p1(e,{network:this.network,peerRouting:this.peerRouting,queryManager:this.queryManager,routingTable:this.routingTable,providers:this.providers,lan:this.lan}),this.routingTableRefresh=new R1({peerRouting:this.peerRouting,routingTable:this.routingTable,lan:this.lan}),this.rpc=new N1(e,{routingTable:this.routingTable,providers:this.providers,peerRouting:this.peerRouting,validators:this.validators,lan:this.lan}),this.topologyListener=new O1(e,{protocol:this.protocol,lan:this.lan}),this.querySelf=new _1(e,{peerRouting:this.peerRouting,interval:a,initialInterval:t.initialQuerySelfInterval,lan:this.lan,initialQuerySelfHasRun:m,routingTable:this.routingTable}),this.network.addEventListener("peer",g=>{let y=g.detail;this.onPeerConnect(y).catch(b=>{this.log.error("could not add %p to routing table",y.id,b)}),this.dispatchEvent(new tt("peer",{detail:y}))}),this.topologyListener.addEventListener("peer",g=>{let y=g.detail;Promise.resolve().then(async()=>{let b=await this.components.peerStore.get(y),w={id:y,multiaddrs:b.addresses.map(({multiaddr:v})=>v),protocols:b.protocols};await this.onPeerConnect(w)}).catch(b=>{this.log.error("could not add %p to routing table",y,b)})})}async onPeerConnect(e){if(this.log("peer %p connected with protocols",e.id,e.protocols),this.lan?e=Nl(e):e=kl(e),e.multiaddrs.length===0){this.log("ignoring %p as they do not have any %s addresses in %s",e.id,this.lan?"private":"public",e.multiaddrs.map(t=>t.toString()));return}try{await this.routingTable.add(e.id)}catch(t){this.log.error("could not add %p to routing table",e.id,t)}}isStarted(){return this.running}async getMode(){return this.clientMode?"client":"server"}async setMode(e){await this.components.registrar.unhandle(this.protocol),e==="client"?(this.log("enabling client mode"),this.clientMode=!0):(this.log("enabling server mode"),this.clientMode=!1,await this.components.registrar.handle(this.protocol,this.rpc.onIncomingStream.bind(this.rpc),{maxInboundStreams:this.maxInboundStreams,maxOutboundStreams:this.maxOutboundStreams}))}async start(){this.running=!0,await this.setMode(this.clientMode?"client":"server"),await Promise.all([this.providers.start(),this.queryManager.start(),this.network.start(),this.routingTable.start(),this.topologyListener.start()]),this.querySelf.start(),await this.routingTableRefresh.start()}async stop(){this.running=!1,this.querySelf.stop(),await Promise.all([this.providers.stop(),this.queryManager.stop(),this.network.stop(),this.routingTable.stop(),this.routingTableRefresh.stop(),this.topologyListener.stop()])}async*put(e,t,n={}){yield*this.contentFetching.put(e,t,n)}async*get(e,t={}){yield*this.contentFetching.get(e,t)}async*provide(e,t={}){yield*this.contentRouting.provide(e,this.components.addressManager.getAddresses(),t)}async*findProviders(e,t={}){yield*this.contentRouting.findProviders(e,t)}async*findPeer(e,t={}){yield*this.peerRouting.findPeer(e,t)}async*getClosestPeers(e,t={}){yield*this.peerRouting.getClosestPeers(e,t)}async refreshRoutingTable(){this.routingTableRefresh.refreshTable(!0)}};var Bl=C("libp2p:kad-dht"),ay=class{dht;constructor(e){this.dht=e}async provide(e,t={}){await $r(this.dht.provide(e,t))}async*findProviders(e,t={}){for await(let n of this.dht.findProviders(e,t))n.name==="PROVIDER"&&(yield*n.providers)}async put(e,t,n){await $r(this.dht.put(e,t,n))}async get(e,t){for await(let n of this.dht.get(e,t))if(n.name==="VALUE")return n.value;throw new E("Not found","ERR_NOT_FOUND")}},cy=class{dht;constructor(e){this.dht=e}async findPeer(e,t={}){for await(let n of this.dht.findPeer(e,t))if(n.name==="FINAL_PEER")return n.peer;throw new E("Not found","ERR_NOT_FOUND")}async*getClosestPeers(e,t={}){for await(let n of this.dht.getClosestPeers(e,t))n.name==="FINAL_PEER"&&(yield n.peer)}},KZ=290,$Z=54,HZ=55,GZ=56,WZ=4,YZ=41;function QZ(r){let e=r.stringTuples();for(let t of e)if(t[0]===KZ)return!1;if(e[0][0]===$Z||e[0][0]===HZ||e[0][0]===GZ)return Bl("%m is public %s",r,!0),!0;if(e[0][0]===WZ||e[0][0]===YZ){let t=Vn(`${e[0][1]}`),n=t==null||!t;return Bl("%m is public %s",r,n),n}return!1}var L1=class extends $e{wan;lan;components;contentRouting;peerRouting;constructor(e,t={}){super(),this.components=e,this.wan=new vh(e,{protocolPrefix:"/ipfs",...t,lan:!1}),this.lan=new vh(e,{protocolPrefix:"/ipfs",...t,clientMode:!1,lan:!0}),this.contentRouting=new ay(this),this.peerRouting=new cy(this),this.wan.addEventListener("peer",n=>{this.dispatchEvent(new tt("peer",{detail:n.detail}))}),this.lan.addEventListener("peer",n=>{this.dispatchEvent(new tt("peer",{detail:n.detail}))}),t.clientMode==null&&e.events.addEventListener("self:peer:update",n=>{Bl("received update of self-peer info");let s=n.detail.peer.addresses.some(({multiaddr:i})=>{let o=QZ(i);return Bl("%m is public %s",i,o),o});this.getMode().then(async i=>{s&&i==="client"?await this.setMode("server"):i==="server"&&!s&&await this.setMode("client")}).catch(i=>{Bl.error("error setting dht server mode",i)})})}[Symbol.toStringTag]="@libp2p/dual-kad-dht";get[Df](){return this.contentRouting}get[Cf](){return this.peerRouting}get[pa](){return this}isStarted(){return this.wan.isStarted()&&this.lan.isStarted()}async getMode(){return this.wan.getMode()}async setMode(e){await this.wan.setMode(e)}async start(){await Promise.all([this.lan.start(),this.wan.start()])}async stop(){await Promise.all([this.lan.stop(),this.wan.stop()])}async*put(e,t,n={}){for await(let s of nr(this.lan.put(e,t,n),this.wan.put(e,t,n)))yield s}async*get(e,t={}){let n=!1,s=!1;for await(let i of nr(this.lan.get(e,t),this.wan.get(e,t)))yield i,i.name==="DIAL_PEER"&&(n=!0),i.name==="VALUE"&&(n=!0,i.value!=null&&(s=!0)),i.name==="SEND_QUERY"&&(n=!0);if(!n)throw new E("No peers found in routing table!","ERR_NO_PEERS_IN_ROUTING_TABLE");s||(yield Vr({from:this.components.peerId,error:new E("Not found","ERR_NOT_FOUND")},t))}async*provide(e,t={}){let n=0,s=0,i=[],o=[this.lan];await this.wan.getMode()==="server"&&o.push(this.wan);for await(let a of nr(...o.map(c=>c.provide(e,t))))yield a,a.name==="SEND_QUERY"&&n++,a.name==="QUERY_ERROR"&&i.push(a.error),a.name==="PEER_RESPONSE"&&a.messageName==="ADD_PROVIDER"&&(Bl("sent provider record for %s to %p",e,a.from),s++);if(s===0)throw i.length>0?new E(`Failed to provide to ${i.length} of ${n} peers`,"ERR_PROVIDES_FAILED",{errors:i}):new E("Failed to provide - no peers found","ERR_PROVIDES_FAILED")}async*findProviders(e,t={}){yield*nr(this.lan.findProviders(e,t),this.wan.findProviders(e,t))}async*findPeer(e,t={}){let n=!1;for await(let s of nr(this.lan.findPeer(e,t),this.wan.findPeer(e,t)))yield s,(s.name==="SEND_QUERY"||s.name==="FINAL_PEER")&&(n=!0);if(!n)throw new E("Peer lookup failed","ERR_LOOKUP_FAILED")}async*getClosestPeers(e,t={}){yield*nr(this.lan.getClosestPeers(e,t),this.wan.getClosestPeers(e,t))}async refreshRoutingTable(){await Promise.all([this.lan.refreshRoutingTable(),this.wan.refreshRoutingTable()])}};var eP;(function(r){r[r.SEND_QUERY=0]="SEND_QUERY",r[r.PEER_RESPONSE=1]="PEER_RESPONSE",r[r.FINAL_PEER=2]="FINAL_PEER",r[r.QUERY_ERROR=3]="QUERY_ERROR",r[r.PROVIDER=4]="PROVIDER",r[r.VALUE=5]="VALUE",r[r.ADD_PEER=6]="ADD_PEER",r[r.DIAL_PEER=7]="DIAL_PEER"})(eP||(eP={}));var tP;(function(r){r[r.PUT_VALUE=0]="PUT_VALUE",r[r.GET_VALUE=1]="GET_VALUE",r[r.ADD_PROVIDER=2]="ADD_PROVIDER",r[r.GET_PROVIDERS=3]="GET_PROVIDERS",r[r.FIND_NODE=4]="FIND_NODE",r[r.PING=5]="PING"})(tP||(tP={}));function rP(r){return e=>new L1(e,r)}var hP=W(Yg(),1);var Oe;(function(r){r[r.NEW_STREAM=0]="NEW_STREAM",r[r.MESSAGE_RECEIVER=1]="MESSAGE_RECEIVER",r[r.MESSAGE_INITIATOR=2]="MESSAGE_INITIATOR",r[r.CLOSE_RECEIVER=3]="CLOSE_RECEIVER",r[r.CLOSE_INITIATOR=4]="CLOSE_INITIATOR",r[r.RESET_RECEIVER=5]="RESET_RECEIVER",r[r.RESET_INITIATOR=6]="RESET_INITIATOR"})(Oe||(Oe={}));var _h=Object.freeze({0:"NEW_STREAM",1:"MESSAGE_RECEIVER",2:"MESSAGE_INITIATOR",3:"CLOSE_RECEIVER",4:"CLOSE_INITIATOR",5:"RESET_RECEIVER",6:"RESET_INITIATOR"}),ly=Object.freeze({NEW_STREAM:Oe.NEW_STREAM,MESSAGE:Oe.MESSAGE_INITIATOR,CLOSE:Oe.CLOSE_INITIATOR,RESET:Oe.RESET_INITIATOR}),nP=Object.freeze({MESSAGE:Oe.MESSAGE_RECEIVER,CLOSE:Oe.CLOSE_RECEIVER,RESET:Oe.RESET_RECEIVER});var uy=1<<20,XZ=4<<20,B1=class{_buffer;_headerInfo;_maxMessageSize;_maxUnprocessedMessageQueueSize;constructor(e=uy,t=XZ){this._buffer=new ye,this._headerInfo=null,this._maxMessageSize=e,this._maxUnprocessedMessageQueueSize=t}write(e){if(e==null||e.length===0)return[];if(this._buffer.append(e),this._buffer.byteLength>this._maxUnprocessedMessageQueueSize)throw Object.assign(new Error("unprocessed message queue size too large!"),{code:"ERR_MSG_QUEUE_TOO_BIG"});let t=[];for(;this._buffer.length!==0;){if(this._headerInfo==null)try{this._headerInfo=this._decodeHeader(this._buffer)}catch(l){if(l.code==="ERR_MSG_TOO_BIG")throw l;break}let{id:n,type:s,length:i,offset:o}=this._headerInfo;if(this._buffer.length-o<i)break;let c={id:n,type:s};(s===Oe.NEW_STREAM||s===Oe.MESSAGE_INITIATOR||s===Oe.MESSAGE_RECEIVER)&&(c.data=this._buffer.sublist(o,o+i)),t.push(c),this._buffer.consume(o+i),this._headerInfo=null}return t}_decodeHeader(e){let{value:t,offset:n}=iP(e),{value:s,offset:i}=iP(e,n),o=t&7;if(_h[o]==null)throw new Error(`Invalid type received: ${o}`);if(s>this._maxMessageSize)throw Object.assign(new Error("message size too large!"),{code:"ERR_MSG_TOO_BIG"});return{id:t>>3,type:o,offset:n+i,length:s}}},jZ=128,sP=127;function iP(r,e=0){let t=0,n=0,s=e,i,o=r.length;do{if(s>=o||n>49)throw e=0,new RangeError("Could not decode varint");i=r.get(s++),t+=n<28?(i&sP)<<n:(i&sP)*Math.pow(2,n),n+=7}while(i>=jZ);return e=s-e,{value:t,offset:e}}function ZZ(r){return r[Symbol.asyncIterator]!=null}var M1=1024*1024,oP=(r,e)=>{e.append(r)};function JZ(r,e){return ZZ(r)?async function*(){let t=new ye,n=!1,s=De(),i=Number(e?.size??M1);if((isNaN(i)||i===0||i<0)&&(i=M1),i!==Math.round(i))throw new Error("Batch size must be an integer");let o=e?.yieldAfter??0,a=e?.serialize??oP;for(Promise.resolve().then(async()=>{try{let c;for await(let l of r){if(a(l,t),t.byteLength>=i){clearTimeout(c),s.resolve();continue}c=setTimeout(()=>{s.resolve()},o)}clearTimeout(c),s.resolve()}catch(c){s.reject(c)}finally{n=!0}});!n;)if(await s.promise,s=De(),t.byteLength>0){let c=t;t=new ye,yield c.subarray()}}():function*(){let t=new ye,n=Number(e?.size??M1);if((isNaN(n)||n===0||n<0)&&(n=M1),n!==Math.round(n))throw new Error("Batch size must be an integer");let s=e?.serialize??oP;for(let i of r)s(i,t),t.byteLength>=n&&(yield t.subarray(0,n),t.consume(n));t.byteLength>0&&(yield t.subarray())}()}var aP=JZ;var Ml=W(ac(),1);function fy(r){return new Uint8Array(r)}var hy=10*1024,dy=class{_pool;_poolOffset;constructor(){this._pool=fy(hy),this._poolOffset=0}write(e,t){let n=this._pool,s=this._poolOffset;Ml.default.encode(e.id<<3|e.type,n,s),s+=Ml.default.encode.bytes??0,(e.type===Oe.NEW_STREAM||e.type===Oe.MESSAGE_INITIATOR||e.type===Oe.MESSAGE_RECEIVER)&&e.data!=null?Ml.default.encode(e.data.length,n,s):Ml.default.encode(0,n,s),s+=Ml.default.encode.bytes??0;let i=n.subarray(this._poolOffset,s);hy-s<100?(this._pool=fy(hy),this._poolOffset=0):this._poolOffset=s,t.append(i),(e.type===Oe.NEW_STREAM||e.type===Oe.MESSAGE_INITIATOR||e.type===Oe.MESSAGE_RECEIVER)&&e.data!=null&&t.append(e.data)}},cP=new dy;async function*lP(r,e=0){if(e==null||e===0){for await(let t of r){let n=new ye;for(let s of t)cP.write(s,n);yield n.subarray()}return}yield*aP(r,{size:e,serialize:(t,n)=>{for(let s of t)cP.write(s,n)}})}var Rn=C("libp2p:stream"),py="ERR_STREAM_RESET",eJ="ERR_STREAM_ABORT",tJ="ERR_SINK_ENDED",rJ="ERR_DOUBLE_SINK";function Ma(r){return r!=null&&typeof r.then=="function"}var Ul=class{id;stat;metadata;source;abortController;resetController;closeController;sourceEnded;sinkEnded;sinkSunk;endErr;streamSource;onEnd;maxDataSize;constructor(e){this.abortController=new AbortController,this.resetController=new AbortController,this.closeController=new AbortController,this.sourceEnded=!1,this.sinkEnded=!1,this.sinkSunk=!1,this.id=e.id,this.metadata=e.metadata??{},this.stat={direction:e.direction,timeline:{open:Date.now()}},this.maxDataSize=e.maxDataSize,this.onEnd=e.onEnd,this.source=this.streamSource=yt({onEnd:()=>{if(this.stat.timeline.reset!==null){let t=this.sendCloseRead();Ma(t)&&t.catch(n=>{Rn.error("error while sending close read",n)})}this.onSourceEnd()}}),this.sink=this.sink.bind(this)}onSourceEnd(e){this.sourceEnded||(this.stat.timeline.closeRead=Date.now(),this.sourceEnded=!0,Rn.trace("%s stream %s source end - err: %o",this.stat.direction,this.id,e),e!=null&&this.endErr==null&&(this.endErr=e),this.sinkEnded&&(this.stat.timeline.close=Date.now(),this.onEnd!=null&&this.onEnd(this.endErr)))}onSinkEnd(e){this.sinkEnded||(this.stat.timeline.closeWrite=Date.now(),this.sinkEnded=!0,Rn.trace("%s stream %s sink end - err: %o",this.stat.direction,this.id,e),e!=null&&this.endErr==null&&(this.endErr=e),this.sourceEnded&&(this.stat.timeline.close=Date.now(),this.onEnd!=null&&this.onEnd(this.endErr)))}close(){Rn.trace("%s stream %s close",this.stat.direction,this.id),this.closeRead(),this.closeWrite()}closeRead(){Rn.trace("%s stream %s closeRead",this.stat.direction,this.id),!this.sourceEnded&&this.streamSource.end()}closeWrite(){if(Rn.trace("%s stream %s closeWrite",this.stat.direction,this.id),!this.sinkEnded){this.closeController.abort();try{let e=this.sendCloseWrite();Ma(e)&&e.catch(t=>{Rn.error("error while sending close write",t)})}catch(e){Rn.trace("%s stream %s error sending close",this.stat.direction,this.id,e)}this.onSinkEnd()}}abort(e){Rn.trace("%s stream %s abort",this.stat.direction,this.id,e),this.streamSource.end(e),this.abortController.abort(),this.onSinkEnd(e)}reset(){let e=new E("stream reset",py);this.resetController.abort(),this.streamSource.end(e),this.onSinkEnd(e)}async sink(e){if(this.sinkSunk)throw new E("sink already called on stream",rJ);if(this.sinkSunk=!0,this.sinkEnded)throw new E("stream closed for writing",tJ);let t=ot([this.abortController.signal,this.resetController.signal,this.closeController.signal]);try{if(e=bt(e,t),this.stat.direction==="outbound"){let n=this.sendNewStream();Ma(n)&&await n}for await(let n of e)for(;n.length>0;){if(n.length<=this.maxDataSize){let i=this.sendData(n instanceof Uint8Array?new ye(n):n);Ma(i)&&await i;break}n=n instanceof Uint8Array?new ye(n):n;let s=this.sendData(n.sublist(0,this.maxDataSize));Ma(s)&&await s,n.consume(this.maxDataSize)}}catch(n){if(n.type==="aborted"&&n.message==="The operation was aborted"){if(this.closeController.signal.aborted)return;this.resetController.signal.aborted&&(n.message="stream reset",n.code=py),this.abortController.signal.aborted&&(n.message="stream aborted",n.code=eJ)}if(n.code===py)Rn.trace("%s stream %s reset",this.stat.direction,this.id);else{Rn.trace("%s stream %s error",this.stat.direction,this.id,n);try{let s=this.sendReset();Ma(s)&&await s,this.stat.timeline.reset=Date.now()}catch(s){Rn.trace("%s stream %s error sending reset",this.stat.direction,this.id,s)}}throw this.streamSource.end(n),this.onSinkEnd(n),n}finally{t.clear()}try{let n=this.sendCloseWrite();Ma(n)&&await n}catch(n){Rn.trace("%s stream %s error sending close",this.stat.direction,this.id,n)}this.onSinkEnd()}sourcePush(e){this.streamSource.push(e)}sourceReadableLength(){return this.streamSource.readableLength}};var my=class extends Ul{name;streamId;send;types;constructor(e){super(e),this.types=e.direction==="outbound"?ly:nP,this.send=e.send,this.name=e.name,this.streamId=e.streamId}sendNewStream(){this.send({id:this.streamId,type:ly.NEW_STREAM,data:new ye($(this.name))})}sendData(e){this.send({id:this.streamId,type:this.types.MESSAGE,data:e})}sendReset(){this.send({id:this.streamId,type:this.types.RESET})}sendCloseWrite(){this.send({id:this.streamId,type:this.types.CLOSE})}sendCloseRead(){}};function uP(r){let{id:e,name:t,send:n,onEnd:s,type:i="initiator",maxMsgSize:o=uy}=r;return new my({id:i==="initiator"?`i${e}`:`r${e}`,streamId:e,name:`${t??e}`,direction:i==="initiator"?"outbound":"inbound",maxDataSize:o,onEnd:s,send:n})}var bs=C("libp2p:mplex"),nJ=1024,sJ=1024,iJ=1024*1024*4,oJ=5;function fP(r){let e={...r,type:`${_h[r.type]} (${r.type})`};return r.type===Oe.NEW_STREAM&&(e.data=M(r.data instanceof Uint8Array?r.data:r.data.subarray())),(r.type===Oe.MESSAGE_INITIATOR||r.type===Oe.MESSAGE_RECEIVER)&&(e.data=M(r.data instanceof Uint8Array?r.data:r.data.subarray(),"base16")),e}var U1=class{protocol="/mplex/6.7.0";sink;source;_streamId;_streams;_init;_source;closeController;rateLimiter;constructor(e){e=e??{},this._streamId=0,this._streams={initiators:new Map,receivers:new Map},this._init=e,this.sink=this._createSink();let t=this._createSource();this._source=t,this.source=t,this.closeController=new AbortController,this.rateLimiter=new hP.RateLimiterMemory({points:e.disconnectThreshold??oJ,duration:1})}get streams(){let e=[];for(let t of this._streams.initiators.values())e.push(t);for(let t of this._streams.receivers.values())e.push(t);return e}newStream(e){if(this.closeController.signal.aborted)throw new Error("Muxer already closed");let t=this._streamId++;e=e==null?t.toString():e.toString();let n=this._streams.initiators;return this._newStream({id:t,name:e,type:"initiator",registry:n})}close(e){this.closeController.signal.aborted||(e!=null?this.streams.forEach(t=>{t.abort(e)}):this.streams.forEach(t=>{t.close()}),this.closeController.abort())}_newReceiverStream(e){let{id:t,name:n}=e,s=this._streams.receivers;return this._newStream({id:t,name:n,type:"receiver",registry:s})}_newStream(e){let{id:t,name:n,type:s,registry:i}=e;if(bs("new %s stream %s",s,t),s==="initiator"&&this._streams.initiators.size===(this._init.maxOutboundStreams??sJ))throw new E("Too many outbound streams open","ERR_TOO_MANY_OUTBOUND_STREAMS");if(i.has(t))throw new Error(`${s} stream ${t} already exists!`);let c=uP({id:t,name:n,send:l=>{bs.enabled&&bs.trace("%s stream %s send",s,t,fP(l)),this._source.push(l)},type:s,onEnd:()=>{bs("%s stream with id %s and protocol %s ended",s,t,c.stat.protocol),i.delete(t),this._init.onStreamEnd!=null&&this._init.onStreamEnd(c)},maxMsgSize:this._init.maxMsgSize});return i.set(t,c),c}_createSink(){return async t=>{let n=ot([this.closeController.signal,this._init.signal]);try{t=bt(t,n);let s=new B1(this._init.maxMsgSize,this._init.maxUnprocessedMessageQueueSize);for await(let i of t)for(let o of s.write(i))await this._handleIncoming(o);this._source.end()}catch(s){bs("error in sink",s),this._source.end(s)}finally{n.clear()}}}_createSource(){let t=vb({objectMode:!0,onEnd:n=>{this.close(n)}});return Object.assign(lP(t,this._init.minSendBytes),{push:t.push,end:t.end,return:t.return})}async _handleIncoming(e){let{id:t,type:n}=e;if(bs.enabled&&bs.trace("incoming message",fP(e)),e.type===Oe.NEW_STREAM){if(this._streams.receivers.size===(this._init.maxInboundStreams??nJ)){bs("too many inbound streams open"),this._source.push({id:t,type:Oe.RESET_RECEIVER});try{await this.rateLimiter.consume("new-stream",1)}catch{bs("rate limit hit when opening too many new streams over the inbound stream limit - closing remote connection"),this._source.end(new Error("Too many open streams"));return}return}let a=this._newReceiverStream({id:t,name:M(e.data instanceof Uint8Array?e.data:e.data.subarray())});this._init.onIncomingStream!=null&&this._init.onIncomingStream(a);return}let i=((n&1)===1?this._streams.initiators:this._streams.receivers).get(t);if(i==null){bs("missing stream %s for message type %s",t,_h[n]);return}let o=this._init.maxStreamBufferSize??iJ;switch(n){case Oe.MESSAGE_INITIATOR:case Oe.MESSAGE_RECEIVER:if(i.sourceReadableLength()>o){this._source.push({id:e.id,type:n===Oe.MESSAGE_INITIATOR?Oe.RESET_RECEIVER:Oe.RESET_INITIATOR});let a=new E("Input buffer full - increase Mplex maxBufferSize to accommodate slow consumers","ERR_STREAM_INPUT_BUFFER_FULL");i.abort(a);return}i.sourcePush(e.data);break;case Oe.CLOSE_INITIATOR:case Oe.CLOSE_RECEIVER:i.closeRead();break;case Oe.RESET_INITIATOR:case Oe.RESET_RECEIVER:i.reset();break;default:bs("unknown message type %s",n)}}};var gy=class{protocol="/mplex/6.7.0";_init;constructor(e={}){this._init=e}createStreamMuxer(e={}){return new U1({...e,...this._init})}};function dP(r={}){return()=>new gy(r)}var In;(function(r){r.ERR_ALREADY_ABORTED="ERR_ALREADY_ABORTED",r.ERR_DATA_CHANNEL="ERR_DATA_CHANNEL",r.ERR_CONNECTION_CLOSED="ERR_CONNECTION_CLOSED",r.ERR_HASH_NOT_SUPPORTED="ERR_HASH_NOT_SUPPORTED",r.ERR_INVALID_MULTIADDR="ERR_INVALID_MULTIADDR",r.ERR_INVALID_FINGERPRINT="ERR_INVALID_FINGERPRINT",r.ERR_INVALID_PARAMETERS="ERR_INVALID_PARAMETERS",r.ERR_NOT_IMPLEMENTED="ERR_NOT_IMPLEMENTED",r.ERR_TOO_MANY_INBOUND_PROTOCOL_STREAMS="ERR_TOO_MANY_INBOUND_PROTOCOL_STREAMS",r.ERR_TOO_MANY_OUTBOUND_PROTOCOL_STREAMS="ERR_TOO_MANY_OUTBOUND_PROTOCOL_STREAMS"})(In||(In={}));var Co=class extends E{constructor(e,t){super(`WebRTC transport error: ${e}`,t??""),this.name="WebRTCTransportError"}};var yy=class extends Co{constructor(e,t){super(`[stream: ${e}] data channel error: ${t}`,In.ERR_DATA_CHANNEL),this.name="WebRTC/DataChannelError"}};function _y(r,e){return new yy(r,e)}var by=class extends Co{constructor(e){super(`There was a problem with the Multiaddr which was passed in: ${e}`,In.ERR_INVALID_MULTIADDR),this.name="WebRTC/InappropriateMultiaddrError"}};function F1(r){return new by(r)}var wy=class extends Co{constructor(e){super(`There was a problem with a provided argument: ${e}`,In.ERR_INVALID_PARAMETERS),this.name="WebRTC/InvalidArgumentError"}};function Sh(r){return new wy(r)}var xy=class extends Co{constructor(e,t){super(`Invalid fingerprint "${e}" within ${t}`,In.ERR_INVALID_FINGERPRINT),this.name="WebRTC/InvalidFingerprintError"}};function Sy(r,e){return new xy(r,e)}var Ey=class extends Co{constructor(e){super(`A method (${e}) was called though it has been intentionally left unimplemented.`,In.ERR_NOT_IMPLEMENTED),this.name="WebRTC/UnimplementedError"}};function pP(r){return new Ey(r)}var vy=class extends Co{constructor(e){super(`unsupported hash algorithm: ${e}`,In.ERR_HASH_NOT_SUPPORTED),this.name="WebRTC/UnsupportedHashAlgorithmError"}};function mP(r){return new vy(r)}var gP=function(r,e,t){if(t||arguments.length===2)for(var n=0,s=e.length,i;n<s;n++)(i||!(n in e))&&(i||(i=Array.prototype.slice.call(e,0,n)),i[n]=e[n]);return r.concat(i||Array.prototype.slice.call(e))},aJ=function(){function r(e,t,n){this.name=e,this.version=t,this.os=n,this.type="browser"}return r}();var cJ=function(){function r(e){this.version=e,this.type="node",this.name="node",this.os=process.platform}return r}();var lJ=function(){function r(e,t,n,s){this.name=e,this.version=t,this.os=n,this.bot=s,this.type="bot-device"}return r}();var uJ=function(){function r(){this.type="bot",this.bot=!0,this.name="bot",this.version=null,this.os=null}return r}();var fJ=function(){function r(){this.type="react-native",this.name="react-native",this.version=null,this.os=null}return r}();var hJ=/alexa|bot|crawl(er|ing)|facebookexternalhit|feedburner|google web preview|nagios|postrank|pingdom|slurp|spider|yahoo!|yandex/,dJ=/(nuhk|curl|Googlebot|Yammybot|Openbot|Slurp|MSNBot|Ask\ Jeeves\/Teoma|ia_archiver)/,yP=3,pJ=[["aol",/AOLShield\/([0-9\._]+)/],["edge",/Edge\/([0-9\._]+)/],["edge-ios",/EdgiOS\/([0-9\._]+)/],["yandexbrowser",/YaBrowser\/([0-9\._]+)/],["kakaotalk",/KAKAOTALK\s([0-9\.]+)/],["samsung",/SamsungBrowser\/([0-9\.]+)/],["silk",/\bSilk\/([0-9._-]+)\b/],["miui",/MiuiBrowser\/([0-9\.]+)$/],["beaker",/BeakerBrowser\/([0-9\.]+)/],["edge-chromium",/EdgA?\/([0-9\.]+)/],["chromium-webview",/(?!Chrom.*OPR)wv\).*Chrom(?:e|ium)\/([0-9\.]+)(:?\s|$)/],["chrome",/(?!Chrom.*OPR)Chrom(?:e|ium)\/([0-9\.]+)(:?\s|$)/],["phantomjs",/PhantomJS\/([0-9\.]+)(:?\s|$)/],["crios",/CriOS\/([0-9\.]+)(:?\s|$)/],["firefox",/Firefox\/([0-9\.]+)(?:\s|$)/],["fxios",/FxiOS\/([0-9\.]+)/],["opera-mini",/Opera Mini.*Version\/([0-9\.]+)/],["opera",/Opera\/([0-9\.]+)(?:\s|$)/],["opera",/OPR\/([0-9\.]+)(:?\s|$)/],["pie",/^Microsoft Pocket Internet Explorer\/(\d+\.\d+)$/],["pie",/^Mozilla\/\d\.\d+\s\(compatible;\s(?:MSP?IE|MSInternet Explorer) (\d+\.\d+);.*Windows CE.*\)$/],["netfront",/^Mozilla\/\d\.\d+.*NetFront\/(\d.\d)/],["ie",/Trident\/7\.0.*rv\:([0-9\.]+).*\).*Gecko$/],["ie",/MSIE\s([0-9\.]+);.*Trident\/[4-7].0/],["ie",/MSIE\s(7\.0)/],["bb10",/BB10;\sTouch.*Version\/([0-9\.]+)/],["android",/Android\s([0-9\.]+)/],["ios",/Version\/([0-9\._]+).*Mobile.*Safari.*/],["safari",/Version\/([0-9\._]+).*Safari/],["facebook",/FB[AS]V\/([0-9\.]+)/],["instagram",/Instagram\s([0-9\.]+)/],["ios-webview",/AppleWebKit\/([0-9\.]+).*Mobile/],["ios-webview",/AppleWebKit\/([0-9\.]+).*Gecko\)$/],["curl",/^curl\/([0-9\.]+)$/],["searchbot",hJ]],bP=[["iOS",/iP(hone|od|ad)/],["Android OS",/Android/],["BlackBerry OS",/BlackBerry|BB10/],["Windows Mobile",/IEMobile/],["Amazon OS",/Kindle/],["Windows 3.11",/Win16/],["Windows 95",/(Windows 95)|(Win95)|(Windows_95)/],["Windows 98",/(Windows 98)|(Win98)/],["Windows 2000",/(Windows NT 5.0)|(Windows 2000)/],["Windows XP",/(Windows NT 5.1)|(Windows XP)/],["Windows Server 2003",/(Windows NT 5.2)/],["Windows Vista",/(Windows NT 6.0)/],["Windows 7",/(Windows NT 6.1)/],["Windows 8",/(Windows NT 6.2)/],["Windows 8.1",/(Windows NT 6.3)/],["Windows 10",/(Windows NT 10.0)/],["Windows ME",/Windows ME/],["Windows CE",/Windows CE|WinCE|Microsoft Pocket Internet Explorer/],["Open BSD",/OpenBSD/],["Sun OS",/SunOS/],["Chrome OS",/CrOS/],["Linux",/(Linux)|(X11)/],["Mac OS",/(Mac_PowerPC)|(Macintosh)/],["QNX",/QNX/],["BeOS",/BeOS/],["OS/2",/OS\/2/]];function xP(r){return r?wP(r):typeof document>"u"&&typeof navigator<"u"&&navigator.product==="ReactNative"?new fJ:typeof navigator<"u"?wP(navigator.userAgent):yJ()}function mJ(r){return r!==""&&pJ.reduce(function(e,t){var n=t[0],s=t[1];if(e)return e;var i=s.exec(r);return!!i&&[n,i]},!1)}function wP(r){var e=mJ(r);if(!e)return null;var t=e[0],n=e[1];if(t==="searchbot")return new uJ;var s=n[1]&&n[1].split(".").join("_").split("_").slice(0,3);s?s.length<yP&&(s=gP(gP([],s,!0),bJ(yP-s.length),!0)):s=[];var i=s.join("."),o=gJ(r),a=dJ.exec(r);return a&&a[1]?new lJ(t,i,o,a[1]):new aJ(t,i,o)}function gJ(r){for(var e=0,t=bP.length;e<t;e++){var n=bP[e],s=n[0],i=n[1],o=i.exec(r);if(o)return s}return null}function yJ(){var r=typeof process<"u"&&process.version;return r?new cJ(process.version.slice(1)):null}function bJ(r){for(var e=[],t=0;t<r;t++)e.push("0");return e}var EP=xP(),Ah=EP!=null&&EP.name==="firefox",V1=async function*(){},z1=async r=>{};var vP=C("libp2p:webrtc:connection"),Ua=class{peerConnection;remoteAddr;timeline;metrics;source=V1();sink=z1;constructor(e){this.remoteAddr=e.remoteAddr,this.timeline=e.timeline,this.peerConnection=e.peerConnection,this.peerConnection.onconnectionstatechange=()=>{(this.peerConnection.connectionState==="closed"||this.peerConnection.connectionState==="disconnected"||this.peerConnection.connectionState==="failed")&&(this.timeline.close=Date.now())}}async close(e){e!==void 0&&vP.error("error closing connection",e),vP.trace("closing connection"),this.timeline.close=Date.now(),this.peerConnection.close(),this.metrics?.increment({close:!0})}};var Fl=class extends Error{constructor(e){super(e),this.name="TimeoutError"}},Ay=class extends Error{constructor(e){super(),this.name="AbortError",this.message=e}},_P=r=>globalThis.DOMException===void 0?new Ay(r):new DOMException(r),SP=r=>{let e=r.reason===void 0?_P("This operation was aborted."):r.reason;return e instanceof Error?e:_P(e)};function Ry(r,e){let{milliseconds:t,fallback:n,message:s,customTimers:i={setTimeout,clearTimeout}}=e,o,c=new Promise((l,u)=>{if(typeof t!="number"||Math.sign(t)!==1)throw new TypeError(`Expected \`milliseconds\` to be a positive number, got \`${t}\``);if(e.signal){let{signal:h}=e;h.aborted&&u(SP(h)),h.addEventListener("abort",()=>{u(SP(h))})}if(t===Number.POSITIVE_INFINITY){r.then(l,u);return}let f=new Fl;o=i.setTimeout.call(void 0,()=>{if(n){try{l(n())}catch(h){u(h)}return}typeof r.cancel=="function"&&r.cancel(),s===!1?l():s instanceof Error?u(s):(f.message=s??`Promise timed out after ${t} milliseconds`,u(f))},t),(async()=>{try{l(await r)}catch(h){u(h)}})()}).finally(()=>{c.clear()});return c.clear=()=>{i.clearTimeout.call(void 0,o),o=void 0},c}var wJ=r=>{let e=r.on||r.addListener||r.addEventListener,t=r.off||r.removeListener||r.removeEventListener;if(!e||!t)throw new TypeError("Emitter is not compatible");return{addListener:e.bind(r),removeListener:t.bind(r)}};function xJ(r,e,t){let n,s=new Promise((i,o)=>{if(t={rejectionEvents:["error"],multiArgs:!1,resolveImmediately:!1,...t},!(t.count>=0&&(t.count===Number.POSITIVE_INFINITY||Number.isInteger(t.count))))throw new TypeError("The `count` option should be at least 0 or more");t.signal?.throwIfAborted();let a=[e].flat(),c=[],{addListener:l,removeListener:u}=wJ(r),f=(...p)=>{let d=t.multiArgs?p:p[0];t.filter&&!t.filter(d)||(c.push(d),t.count===c.length&&(n(),i(c)))},h=p=>{n(),o(p)};n=()=>{for(let p of a)u(p,f);for(let p of t.rejectionEvents)u(p,h)};for(let p of a)l(p,f);for(let p of t.rejectionEvents)l(p,h);t.signal&&t.signal.addEventListener("abort",()=>{h(t.signal.reason)},{once:!0}),t.resolveImmediately&&i(c)});if(s.cancel=n,typeof t.timeout=="number"){let i=Ry(s,{milliseconds:t.timeout});return i.cancel=n,i}return s}function AP(r,e,t){typeof t=="function"&&(t={filter:t}),t={...t,count:1,resolveImmediately:!1};let n=xJ(r,e,t),s=n.then(i=>i[0]);return s.cancel=n.cancel,s}var Wn;(function(r){let e;(function(s){s.FIN="FIN",s.STOP_SENDING="STOP_SENDING",s.RESET="RESET"})(e=r.Flag||(r.Flag={}));let t;(function(s){s[s.FIN=0]="FIN",s[s.STOP_SENDING=1]="STOP_SENDING",s[s.RESET=2]="RESET"})(t||(t={})),function(s){s.codec=()=>Pt(t)}(e=r.Flag||(r.Flag={}));let n;r.codec=()=>(n==null&&(n=me((s,i,o={})=>{o.lengthDelimited!==!1&&i.fork(),s.flag!=null&&(i.uint32(8),r.Flag.codec().encode(s.flag,i)),s.message!=null&&(i.uint32(18),i.bytes(s.message)),o.lengthDelimited!==!1&&i.ldelim()},(s,i)=>{let o={},a=i==null?s.len:s.pos+i;for(;s.pos<a;){let c=s.uint32();switch(c>>>3){case 1:o.flag=r.Flag.codec().decode(s);break;case 2:o.message=s.bytes();break;default:s.skipType(c&7);break}}return o})),n),r.encode=s=>pe(s,r.codec()),r.decode=s=>de(s,r.codec())})(Wn||(Wn={}));var q1=C("libp2p:webrtc:stream"),RP=16*1024,EJ=16*1024*1024,vJ=30*1e3,_J=3,Iy=class extends Ul{channel;dataChannelOptions;incomingData;messageQueue;constructor(e){switch(super(e),this.channel=e.channel,this.channel.binaryType="arraybuffer",this.incomingData=yt(),this.messageQueue=new ye,this.dataChannelOptions={bufferedAmountLowEventTimeout:e.dataChannelOptions?.bufferedAmountLowEventTimeout??vJ,maxBufferedAmount:e.dataChannelOptions?.maxBufferedAmount??EJ,maxMessageSize:e.dataChannelOptions?.maxMessageSize??RP},this.channel.readyState){case"open":break;case"closed":case"closing":(this.stat.timeline.close===void 0||this.stat.timeline.close===0)&&(this.stat.timeline.close=Date.now());break;case"connecting":break;default:throw q1.error("unknown datachannel state %s",this.channel.readyState),new E("Unknown datachannel state","ERR_INVALID_STATE")}this.channel.onopen=n=>{this.stat.timeline.open=new Date().getTime(),this.messageQueue!=null&&(this._sendMessage(this.messageQueue).catch(s=>{this.abort(s)}),this.messageQueue=void 0)},this.channel.onclose=n=>{this.close()},this.channel.onerror=n=>{let s=n.error;this.abort(s)};let t=this;this.channel.onmessage=async n=>{let{data:s}=n;s===null||s.byteLength===0||this.incomingData.push(new Uint8Array(s,0,s.byteLength))},Promise.resolve().then(async()=>{for await(let n of kt(this.incomingData)){let s=t.processIncomingProtobuf(n.subarray());s!=null&&t.sourcePush(new ye(s))}}).catch(n=>{q1.error("error processing incoming data channel messages",n)})}sendNewStream(){}async _sendMessage(e,t=!0){if(t&&this.channel.bufferedAmount>this.dataChannelOptions.maxBufferedAmount)try{await AP(this.channel,"bufferedamountlow",{timeout:this.dataChannelOptions.bufferedAmountLowEventTimeout})}catch(n){throw n instanceof Fl?(this.abort(n),new Error("Timed out waiting for DataChannel buffer to clear")):n}if(this.channel.readyState==="closed"||this.channel.readyState==="closing")throw new E("Invalid datachannel state - closed or closing","ERR_INVALID_STATE");if(this.channel.readyState==="open")for(let n of e)this.channel.send(n);else if(this.channel.readyState==="connecting")this.messageQueue==null&&(this.messageQueue=new ye),this.messageQueue.append(e);else throw q1.error("unknown datachannel state %s",this.channel.readyState),new E("Unknown datachannel state","ERR_INVALID_STATE")}async sendData(e){let t=Wn.encode({message:e.subarray()}),n=wt.single(t);await this._sendMessage(n)}async sendReset(){await this._sendFlag(Wn.Flag.RESET)}async sendCloseWrite(){await this._sendFlag(Wn.Flag.FIN)}async sendCloseRead(){await this._sendFlag(Wn.Flag.STOP_SENDING)}processIncomingProtobuf(e){let t=Wn.decode(e);return t.flag!==void 0&&(t.flag===Wn.Flag.FIN&&(this.incomingData.end(),this.closeRead()),t.flag===Wn.Flag.RESET&&this.reset(),t.flag===Wn.Flag.STOP_SENDING&&this.closeWrite()),t.message}async _sendFlag(e){q1.trace("Sending flag: %s",e.toString());let t=Wn.encode({flag:e}),n=wt.single(t);await this._sendMessage(n,!1)}};function Vl(r){let{channel:e,direction:t,onEnd:n,dataChannelOptions:s}=r;return new Iy({id:t==="inbound"?`i${e.id}`:`r${e.id}`,direction:t,maxDataSize:(s?.maxMessageSize??RP)-_J,dataChannelOptions:s,onEnd:n,channel:e})}var IP="/webrtc",Fa=class{protocol;peerConnection;streamBuffer=[];metrics;dataChannelOptions;constructor(e){this.peerConnection=e.peerConnection,this.metrics=e.metrics,this.protocol=e.protocol??IP,this.dataChannelOptions=e.dataChannelOptions,this.peerConnection.ondatachannel=({channel:t})=>{let n=Vl({channel:t,direction:"inbound",dataChannelOptions:e.dataChannelOptions,onEnd:()=>{this.streamBuffer=this.streamBuffer.filter(s=>s.id!==n.id)}});this.streamBuffer.push(n)}}createStreamMuxer(e){return new Ty({...e,peerConnection:this.peerConnection,dataChannelOptions:this.dataChannelOptions,metrics:this.metrics,streams:this.streamBuffer,protocol:this.protocol})}},Ty=class{init;streams;protocol;peerConnection;dataChannelOptions;metrics;close=()=>{};source=V1();sink=z1;constructor(e){this.init=e,this.streams=e.streams,this.peerConnection=e.peerConnection,this.protocol=e.protocol??IP,this.metrics=e.metrics,this.peerConnection.ondatachannel=({channel:n})=>{let s=Vl({channel:n,direction:"inbound",dataChannelOptions:this.dataChannelOptions,onEnd:()=>{this.streams=this.streams.filter(i=>i.id!==s.id),this.metrics?.increment({stream_end:!0}),e?.onStreamEnd?.(s)}});this.streams.push(s),e?.onIncomingStream!=null&&(this.metrics?.increment({incoming_stream:!0}),e.onIncomingStream(s))};let t=e?.onIncomingStream;t!=null&&this.streams.forEach(n=>{t(n)})}newStream(){let e=this.peerConnection.createDataChannel(""),t=Vl({channel:e,direction:"outbound",dataChannelOptions:this.dataChannelOptions,onEnd:()=>{this.streams=this.streams.filter(n=>n.id!==t.id),this.metrics?.increment({stream_end:!0}),this.init?.onStreamEnd?.(t)}});return this.streams.push(t),this.metrics?.increment({outgoing_stream:!0}),t}};var Tn;(function(r){let e;(function(s){s.SDP_OFFER="SDP_OFFER",s.SDP_ANSWER="SDP_ANSWER",s.ICE_CANDIDATE="ICE_CANDIDATE"})(e=r.Type||(r.Type={}));let t;(function(s){s[s.SDP_OFFER=0]="SDP_OFFER",s[s.SDP_ANSWER=1]="SDP_ANSWER",s[s.ICE_CANDIDATE=2]="ICE_CANDIDATE"})(t||(t={})),function(s){s.codec=()=>Pt(t)}(e=r.Type||(r.Type={}));let n;r.codec=()=>(n==null&&(n=me((s,i,o={})=>{o.lengthDelimited!==!1&&i.fork(),s.type!=null&&(i.uint32(8),r.Type.codec().encode(s.type,i)),s.data!=null&&(i.uint32(18),i.string(s.data)),o.lengthDelimited!==!1&&i.ldelim()},(s,i)=>{let o={},a=i==null?s.len:s.pos+i;for(;s.pos<a;){let c=s.uint32();switch(c>>>3){case 1:o.type=r.Type.codec().decode(s);break;case 2:o.data=s.string();break;default:s.skipType(c&7);break}}return o})),n),r.encode=s=>pe(s,r.codec()),r.decode=s=>de(s,r.codec())})(Tn||(Tn={}));var K1=C("libp2p:webrtc:peer:util"),Dy=async(r,e,t)=>{for(;;){let n=await Promise.race([r.promise,t.read()]);if(n instanceof Object){let s=n;if(s.type!==Tn.Type.ICE_CANDIDATE)throw new Error("expected only ice candidates");if(s.data==null||s.data===""){K1.trace("end-of-candidates received");break}K1.trace("received new ICE candidate: %s",s.data);try{await e.addIceCandidate(new RTCIceCandidate(JSON.parse(s.data)))}catch(i){throw K1.error("bad candidate received: ",i),new Error("bad candidate received")}}else break}await r.promise};function Cy(r,e){r[Ah?"oniceconnectionstatechange":"onconnectionstatechange"]=t=>{switch(K1.trace("receiver peerConnectionState state: ",r.connectionState),Ah?r.iceConnectionState:r.connectionState){case"connected":e.resolve();break;case"failed":case"disconnected":case"closed":e.reject(new Error("RTCPeerConnection was closed"));break;default:break}}}var SJ=30*1e3,Va=C("libp2p:webrtc:peer");async function TP({rtcConfiguration:r,dataChannelOptions:e,stream:t}){let n=AbortSignal.timeout(SJ),s=jr(Er(t,n)).pb(Tn),i=new RTCPeerConnection(r),o=new Fa({peerConnection:i,dataChannelOptions:e}),a=De(),c=De();n.onabort=()=>{a.reject()},i.onicecandidate=({candidate:p})=>{c.promise.then(()=>{s.write({type:Tn.Type.ICE_CANDIDATE,data:p!=null?JSON.stringify(p.toJSON()):""})},d=>{Va.error("cannot set candidate since sending answer failed",d)})},Cy(i,a);let l=await s.read();if(l.type!==Tn.Type.SDP_OFFER)throw new Error(`expected message type SDP_OFFER, received: ${l.type??"undefined"} `);let u=new RTCSessionDescription({type:"offer",sdp:l.data});await i.setRemoteDescription(u).catch(p=>{throw Va.error("could not execute setRemoteDescription",p),new Error("Failed to set remoteDescription")});let f=await i.createAnswer().catch(p=>{throw Va.error("could not execute createAnswer",p),c.reject(p),new Error("Failed to create answer")});s.write({type:Tn.Type.SDP_ANSWER,data:f.sdp}),await i.setLocalDescription(f).catch(p=>{throw Va.error("could not execute setLocalDescription",p),c.reject(p),new Error("Failed to set localDescription")}),c.resolve(),await Dy(a,i,s);let h=CP(i.currentRemoteDescription?.sdp??"");return{pc:i,muxerFactory:o,remoteAddress:h}}async function DP({rtcConfiguration:r,dataChannelOptions:e,signal:t,stream:n}){let s=jr(Er(n,t)).pb(Tn),i=new RTCPeerConnection(r),o=new Fa({peerConnection:i,dataChannelOptions:e}),a=De();Cy(i,a),t.onabort=a.reject;let c=i.createDataChannel("init");i.onicecandidate=({candidate:p})=>{s.write({type:Tn.Type.ICE_CANDIDATE,data:p!=null?JSON.stringify(p.toJSON()):""})};let l=await i.createOffer();s.write({type:Tn.Type.SDP_OFFER,data:l.sdp}),await i.setLocalDescription(l).catch(p=>{throw Va.error("could not execute setLocalDescription",p),new Error("Failed to set localDescription")});let u=await s.read();if(u.type!==Tn.Type.SDP_ANSWER)throw new Error("remote should send an SDP answer");let f=new RTCSessionDescription({type:"answer",sdp:u.data});await i.setRemoteDescription(f).catch(p=>{throw Va.error("could not execute setRemoteDescription",p),new Error("Failed to set remoteDescription")}),await Dy(a,i,s),c.close();let h=CP(i.currentRemoteDescription?.sdp??"");return{pc:i,muxerFactory:o,remoteAddress:h}}function CP(r){let e=r.split(`\r
`).filter(n=>n.startsWith("a=candidate")).pop(),t=e?.split(" ");return e==null||t==null||t.length<5?(Va("could not parse remote address from",e),"/webrtc"):`/dnsaddr/${t[4]}/${t[2].toLowerCase()}/${t[3]}/webrtc`}var $1=class extends $e{peerId;transportManager;constructor(e){super(),this.peerId=e.peerId,this.transportManager=e.transportManager}async listen(){this.safeDispatchEvent("listening",{})}getAddrs(){return this.transportManager.getListeners().filter(e=>e!==this).map(e=>e.getAddrs().filter(t=>gs.matches(t)).map(t=>t.encapsulate(`/webrtc/p2p/${this.peerId}`))).flat()}async close(){this.safeDispatchEvent("close",{})}};var PP=C("libp2p:webrtc:peer"),AJ="/webrtc",RJ="/p2p-circuit",Py="/webrtc-signaling/0.0.1",IJ=se("webrtc").code,H1=class{components;init;_started=!1;constructor(e,t={}){this.components=e,this.init=t}isStarted(){return this._started}async start(){await this.components.registrar.handle(Py,e=>{this._onProtocol(e).catch(t=>{PP.error("failed to handle incoming connect from %p",e.connection.remotePeer,t)})}),this._started=!0}async stop(){await this.components.registrar.unhandle(Py),this._started=!1}createListener(e){return new $1(this.components)}[Symbol.toStringTag]="@libp2p/webrtc";[qs]=!0;filter(e){return e.filter(t=>t.protoCodes().includes(IJ))}async dial(e,t){PP.trace("dialing address: ",e);let{baseAddr:n,peerId:s}=TJ(e);if(t.signal==null){let a=new AbortController;t.signal=a.signal}let i=await this.components.transportManager.dial(n,t),o=await i.newStream([Py],t);try{let{pc:a,muxerFactory:c,remoteAddress:l}=await DP({stream:o,rtcConfiguration:this.init.rtcConfiguration,dataChannelOptions:this.init.dataChannel,signal:t.signal}),u=await t.upgrader.upgradeOutbound(new Ua({peerConnection:a,timeline:{open:Date.now()},remoteAddr:fe(l).encapsulate(`/p2p/${s.toString()}`)}),{skipProtection:!0,skipEncryption:!0,muxerFactory:c});return o.close(),u}catch(a){throw o.reset(),a}finally{await i.close()}}async _onProtocol({connection:e,stream:t}){try{let{pc:n,muxerFactory:s,remoteAddress:i}=await TP({rtcConfiguration:this.init.rtcConfiguration,connection:e,stream:t,dataChannelOptions:this.init.dataChannel});await this.components.upgrader.upgradeInbound(new Ua({peerConnection:n,timeline:{open:new Date().getTime()},remoteAddr:fe(i).encapsulate(`/p2p/${e.remotePeer.toString()}`)}),{skipEncryption:!0,skipProtection:!0,muxerFactory:s})}catch(n){throw t.reset(),n}finally{await e.close()}}};function TJ(r){let e=r.toString().split(AJ+"/");if(e.length!==2)throw new E("webrtc protocol was not present in multiaddr",In.ERR_INVALID_MULTIADDR);if(!e[0].includes(RJ))throw new E("p2p-circuit protocol was not present in multiaddr",In.ERR_INVALID_MULTIADDR);let t=fe(e[0]),s=fe("/"+e[1]).getPeerId();if(s==null)throw new E("destination peer id was missing",In.ERR_INVALID_MULTIADDR);let i=t.protos().pop();if(i===void 0)throw new E("invalid multiaddr",In.ERR_INVALID_MULTIADDR);return i.name!=="p2p"&&(t=t.encapsulate(`/p2p/${s}`)),{baseAddr:t,peerId:he(s)}}var RN=W(a6(),1);var h6={};Y(h6,{identity:()=>Fte});function Ote(r,e){if(r.length>=255)throw new TypeError("Alphabet too long");for(var t=new Uint8Array(256),n=0;n<t.length;n++)t[n]=255;for(var s=0;s<r.length;s++){var i=r.charAt(s),o=i.charCodeAt(0);if(t[o]!==255)throw new TypeError(i+" is ambiguous");t[o]=s}var a=r.length,c=r.charAt(0),l=Math.log(a)/Math.log(256),u=Math.log(256)/Math.log(a);function f(d){if(d instanceof Uint8Array||(ArrayBuffer.isView(d)?d=new Uint8Array(d.buffer,d.byteOffset,d.byteLength):Array.isArray(d)&&(d=Uint8Array.from(d))),!(d instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(d.length===0)return"";for(var m=0,g=0,y=0,b=d.length;y!==b&&d[y]===0;)y++,m++;for(var w=(b-y)*u+1>>>0,v=new Uint8Array(w);y!==b;){for(var x=d[y],_=0,S=w-1;(x!==0||_<g)&&S!==-1;S--,_++)x+=256*v[S]>>>0,v[S]=x%a>>>0,x=x/a>>>0;if(x!==0)throw new Error("Non-zero carry");g=_,y++}for(var A=w-g;A!==w&&v[A]===0;)A++;for(var D=c.repeat(m);A<w;++A)D+=r.charAt(v[A]);return D}function h(d){if(typeof d!="string")throw new TypeError("Expected String");if(d.length===0)return new Uint8Array;var m=0;if(d[m]!==" "){for(var g=0,y=0;d[m]===c;)g++,m++;for(var b=(d.length-m)*l+1>>>0,w=new Uint8Array(b);d[m];){var v=t[d.charCodeAt(m)];if(v===255)return;for(var x=0,_=b-1;(v!==0||x<y)&&_!==-1;_--,x++)v+=a*w[_]>>>0,w[_]=v%256>>>0,v=v/256>>>0;if(v!==0)throw new Error("Non-zero carry");y=x,m++}if(d[m]!==" "){for(var S=b-y;S!==b&&w[S]===0;)S++;for(var A=new Uint8Array(g+(b-S)),D=g;S!==b;)A[D++]=w[S++];return A}}}function p(d){var m=h(d);if(m)return m;throw new Error(`Non-${e} character`)}return{encode:f,decodeUnsafe:h,decode:p}}var Lte=Ote,Bte=Lte,eN=Bte;var tPe=new Uint8Array(0);var tN=(r,e)=>{if(r===e)return!0;if(r.byteLength!==e.byteLength)return!1;for(let t=0;t<r.byteLength;t++)if(r[t]!==e[t])return!1;return!0},Di=r=>{if(r instanceof Uint8Array&&r.constructor.name==="Uint8Array")return r;if(r instanceof ArrayBuffer)return new Uint8Array(r);if(ArrayBuffer.isView(r))return new Uint8Array(r.buffer,r.byteOffset,r.byteLength);throw new Error("Unknown type, must be binary type")};var rN=r=>new TextEncoder().encode(r),nN=r=>new TextDecoder().decode(r);var c6=class{constructor(e,t,n){this.name=e,this.prefix=t,this.baseEncode=n}encode(e){if(e instanceof Uint8Array)return`${this.prefix}${this.baseEncode(e)}`;throw Error("Unknown type, must be binary type")}},l6=class{constructor(e,t,n){if(this.name=e,this.prefix=t,t.codePointAt(0)===void 0)throw new Error("Invalid prefix character");this.prefixCodePoint=t.codePointAt(0),this.baseDecode=n}decode(e){if(typeof e=="string"){if(e.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(e)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(e.slice(this.prefix.length))}else throw Error("Can only multibase decode strings")}or(e){return iN(this,e)}},u6=class{constructor(e){this.decoders=e}or(e){return iN(this,e)}decode(e){let t=e[0],n=this.decoders[t];if(n)return n.decode(e);throw RangeError(`Unable to decode multibase string ${JSON.stringify(e)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}},iN=(r,e)=>new u6({...r.decoders||{[r.prefix]:r},...e.decoders||{[e.prefix]:e}}),f6=class{constructor(e,t,n,s){this.name=e,this.prefix=t,this.baseEncode=n,this.baseDecode=s,this.encoder=new c6(e,t,n),this.decoder=new l6(e,t,s)}encode(e){return this.encoder.encode(e)}decode(e){return this.decoder.decode(e)}},Xl=({name:r,prefix:e,encode:t,decode:n})=>new f6(r,e,t,n),No=({prefix:r,name:e,alphabet:t})=>{let{encode:n,decode:s}=eN(t,e);return Xl({prefix:r,name:e,encode:n,decode:i=>Di(s(i))})},Mte=(r,e,t,n)=>{let s={};for(let u=0;u<e.length;++u)s[e[u]]=u;let i=r.length;for(;r[i-1]==="=";)--i;let o=new Uint8Array(i*t/8|0),a=0,c=0,l=0;for(let u=0;u<i;++u){let f=s[r[u]];if(f===void 0)throw new SyntaxError(`Non-${n} character`);c=c<<t|f,a+=t,a>=8&&(a-=8,o[l++]=255&c>>a)}if(a>=t||255&c<<8-a)throw new SyntaxError("Unexpected end of data");return o},Ute=(r,e,t)=>{let n=e[e.length-1]==="=",s=(1<<t)-1,i="",o=0,a=0;for(let c=0;c<r.length;++c)for(a=a<<8|r[c],o+=8;o>t;)o-=t,i+=e[s&a>>o];if(o&&(i+=e[s&a<<t-o]),n)for(;i.length*t&7;)i+="=";return i},Ft=({name:r,prefix:e,bitsPerChar:t,alphabet:n})=>Xl({prefix:e,name:r,encode(s){return Ute(s,n,t)},decode(s){return Mte(s,n,t,r)}});var Fte=Xl({prefix:"\0",name:"identity",encode:r=>nN(r),decode:r=>rN(r)});var d6={};Y(d6,{base2:()=>Vte});var Vte=Ft({prefix:"0",name:"base2",alphabet:"01",bitsPerChar:1});var p6={};Y(p6,{base8:()=>zte});var zte=Ft({prefix:"7",name:"base8",alphabet:"01234567",bitsPerChar:3});var m6={};Y(m6,{base10:()=>qte});var qte=No({prefix:"9",name:"base10",alphabet:"0123456789"});var g6={};Y(g6,{base16:()=>Kte,base16upper:()=>$te});var Kte=Ft({prefix:"f",name:"base16",alphabet:"0123456789abcdef",bitsPerChar:4}),$te=Ft({prefix:"F",name:"base16upper",alphabet:"0123456789ABCDEF",bitsPerChar:4});var y6={};Y(y6,{base32:()=>jl,base32hex:()=>Yte,base32hexpad:()=>Xte,base32hexpadupper:()=>jte,base32hexupper:()=>Qte,base32pad:()=>Gte,base32padupper:()=>Wte,base32upper:()=>Hte,base32z:()=>Zte});var jl=Ft({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5}),Hte=Ft({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5}),Gte=Ft({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5}),Wte=Ft({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5}),Yte=Ft({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5}),Qte=Ft({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5}),Xte=Ft({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5}),jte=Ft({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5}),Zte=Ft({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5});var b6={};Y(b6,{base36:()=>Jte,base36upper:()=>ere});var Jte=No({prefix:"k",name:"base36",alphabet:"0123456789abcdefghijklmnopqrstuvwxyz"}),ere=No({prefix:"K",name:"base36upper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"});var w6={};Y(w6,{base58btc:()=>Qs,base58flickr:()=>tre});var Qs=No({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"}),tre=No({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"});var x6={};Y(x6,{base64:()=>rre,base64pad:()=>nre,base64url:()=>sre,base64urlpad:()=>ire});var rre=Ft({prefix:"m",name:"base64",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bitsPerChar:6}),nre=Ft({prefix:"M",name:"base64pad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",bitsPerChar:6}),sre=Ft({prefix:"u",name:"base64url",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",bitsPerChar:6}),ire=Ft({prefix:"U",name:"base64urlpad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=",bitsPerChar:6});var E6={};Y(E6,{base256emoji:()=>ure});var oN=Array.from("\u{1F680}\u{1FA90}\u2604\u{1F6F0}\u{1F30C}\u{1F311}\u{1F312}\u{1F313}\u{1F314}\u{1F315}\u{1F316}\u{1F317}\u{1F318}\u{1F30D}\u{1F30F}\u{1F30E}\u{1F409}\u2600\u{1F4BB}\u{1F5A5}\u{1F4BE}\u{1F4BF}\u{1F602}\u2764\u{1F60D}\u{1F923}\u{1F60A}\u{1F64F}\u{1F495}\u{1F62D}\u{1F618}\u{1F44D}\u{1F605}\u{1F44F}\u{1F601}\u{1F525}\u{1F970}\u{1F494}\u{1F496}\u{1F499}\u{1F622}\u{1F914}\u{1F606}\u{1F644}\u{1F4AA}\u{1F609}\u263A\u{1F44C}\u{1F917}\u{1F49C}\u{1F614}\u{1F60E}\u{1F607}\u{1F339}\u{1F926}\u{1F389}\u{1F49E}\u270C\u2728\u{1F937}\u{1F631}\u{1F60C}\u{1F338}\u{1F64C}\u{1F60B}\u{1F497}\u{1F49A}\u{1F60F}\u{1F49B}\u{1F642}\u{1F493}\u{1F929}\u{1F604}\u{1F600}\u{1F5A4}\u{1F603}\u{1F4AF}\u{1F648}\u{1F447}\u{1F3B6}\u{1F612}\u{1F92D}\u2763\u{1F61C}\u{1F48B}\u{1F440}\u{1F62A}\u{1F611}\u{1F4A5}\u{1F64B}\u{1F61E}\u{1F629}\u{1F621}\u{1F92A}\u{1F44A}\u{1F973}\u{1F625}\u{1F924}\u{1F449}\u{1F483}\u{1F633}\u270B\u{1F61A}\u{1F61D}\u{1F634}\u{1F31F}\u{1F62C}\u{1F643}\u{1F340}\u{1F337}\u{1F63B}\u{1F613}\u2B50\u2705\u{1F97A}\u{1F308}\u{1F608}\u{1F918}\u{1F4A6}\u2714\u{1F623}\u{1F3C3}\u{1F490}\u2639\u{1F38A}\u{1F498}\u{1F620}\u261D\u{1F615}\u{1F33A}\u{1F382}\u{1F33B}\u{1F610}\u{1F595}\u{1F49D}\u{1F64A}\u{1F639}\u{1F5E3}\u{1F4AB}\u{1F480}\u{1F451}\u{1F3B5}\u{1F91E}\u{1F61B}\u{1F534}\u{1F624}\u{1F33C}\u{1F62B}\u26BD\u{1F919}\u2615\u{1F3C6}\u{1F92B}\u{1F448}\u{1F62E}\u{1F646}\u{1F37B}\u{1F343}\u{1F436}\u{1F481}\u{1F632}\u{1F33F}\u{1F9E1}\u{1F381}\u26A1\u{1F31E}\u{1F388}\u274C\u270A\u{1F44B}\u{1F630}\u{1F928}\u{1F636}\u{1F91D}\u{1F6B6}\u{1F4B0}\u{1F353}\u{1F4A2}\u{1F91F}\u{1F641}\u{1F6A8}\u{1F4A8}\u{1F92C}\u2708\u{1F380}\u{1F37A}\u{1F913}\u{1F619}\u{1F49F}\u{1F331}\u{1F616}\u{1F476}\u{1F974}\u25B6\u27A1\u2753\u{1F48E}\u{1F4B8}\u2B07\u{1F628}\u{1F31A}\u{1F98B}\u{1F637}\u{1F57A}\u26A0\u{1F645}\u{1F61F}\u{1F635}\u{1F44E}\u{1F932}\u{1F920}\u{1F927}\u{1F4CC}\u{1F535}\u{1F485}\u{1F9D0}\u{1F43E}\u{1F352}\u{1F617}\u{1F911}\u{1F30A}\u{1F92F}\u{1F437}\u260E\u{1F4A7}\u{1F62F}\u{1F486}\u{1F446}\u{1F3A4}\u{1F647}\u{1F351}\u2744\u{1F334}\u{1F4A3}\u{1F438}\u{1F48C}\u{1F4CD}\u{1F940}\u{1F922}\u{1F445}\u{1F4A1}\u{1F4A9}\u{1F450}\u{1F4F8}\u{1F47B}\u{1F910}\u{1F92E}\u{1F3BC}\u{1F975}\u{1F6A9}\u{1F34E}\u{1F34A}\u{1F47C}\u{1F48D}\u{1F4E3}\u{1F942}"),ore=oN.reduce((r,e,t)=>(r[t]=e,r),[]),are=oN.reduce((r,e,t)=>(r[e.codePointAt(0)]=t,r),[]);function cre(r){return r.reduce((e,t)=>(e+=ore[t],e),"")}function lre(r){let e=[];for(let t of r){let n=are[t.codePointAt(0)];if(n===void 0)throw new Error(`Non-base256emoji character: ${t}`);e.push(n)}return new Uint8Array(e)}var ure=Xl({prefix:"\u{1F680}",name:"base256emoji",encode:cre,decode:lre});var A6={};Y(A6,{sha256:()=>Dre,sha512:()=>Cre});var fre=lN,aN=128,hre=127,dre=~hre,pre=Math.pow(2,31);function lN(r,e,t){e=e||[],t=t||0;for(var n=t;r>=pre;)e[t++]=r&255|aN,r/=128;for(;r&dre;)e[t++]=r&255|aN,r>>>=7;return e[t]=r|0,lN.bytes=t-n+1,e}var mre=v6,gre=128,cN=127;function v6(r,n){var t=0,n=n||0,s=0,i=n,o,a=r.length;do{if(i>=a)throw v6.bytes=0,new RangeError("Could not decode varint");o=r[i++],t+=s<28?(o&cN)<<s:(o&cN)*Math.pow(2,s),s+=7}while(o>=gre);return v6.bytes=i-n,t}var yre=Math.pow(2,7),bre=Math.pow(2,14),wre=Math.pow(2,21),xre=Math.pow(2,28),Ere=Math.pow(2,35),vre=Math.pow(2,42),_re=Math.pow(2,49),Sre=Math.pow(2,56),Are=Math.pow(2,63),Rre=function(r){return r<yre?1:r<bre?2:r<wre?3:r<xre?4:r<Ere?5:r<vre?6:r<_re?7:r<Sre?8:r<Are?9:10},Ire={encode:fre,decode:mre,encodingLength:Rre},Tre=Ire,Nh=Tre;var Oh=(r,e=0)=>[Nh.decode(r,e),Nh.decode.bytes],Zl=(r,e,t=0)=>(Nh.encode(r,e,t),e),Jl=r=>Nh.encodingLength(r);var Ka=(r,e)=>{let t=e.byteLength,n=Jl(r),s=n+Jl(t),i=new Uint8Array(s+t);return Zl(r,i,0),Zl(t,i,n),i.set(e,s),new eu(r,t,e,i)},uN=r=>{let e=Di(r),[t,n]=Oh(e),[s,i]=Oh(e.subarray(n)),o=e.subarray(n+i);if(o.byteLength!==s)throw new Error("Incorrect length");return new eu(t,s,o,e)},fN=(r,e)=>{if(r===e)return!0;{let t=e;return r.code===t.code&&r.size===t.size&&t.bytes instanceof Uint8Array&&tN(r.bytes,t.bytes)}},eu=class{constructor(e,t,n,s){this.code=e,this.size=t,this.digest=n,this.bytes=s}};var S6=({name:r,code:e,encode:t})=>new _6(r,e,t),_6=class{constructor(e,t,n){this.name=e,this.code=t,this.encode=n}digest(e){if(e instanceof Uint8Array){let t=this.encode(e);return t instanceof Uint8Array?Ka(this.code,t):t.then(n=>Ka(this.code,n))}else throw Error("Unknown type, must be binary type")}};var dN=r=>async e=>new Uint8Array(await crypto.subtle.digest(r,e)),Dre=S6({name:"sha2-256",code:18,encode:dN("SHA-256")}),Cre=S6({name:"sha2-512",code:19,encode:dN("SHA-512")});var R6={};Y(R6,{identity:()=>Nre});var pN=0,Pre="identity",mN=Di,kre=r=>Ka(pN,mN(r)),Nre={code:pN,name:Pre,encode:mN,digest:kre};var vPe=new TextEncoder,_Pe=new TextDecoder;var gN=(r,e)=>{let{bytes:t,version:n}=r;switch(n){case 0:return Mre(t,I6(r),e||Qs.encoder);default:return Ure(t,I6(r),e||jl.encoder)}};var yN=new WeakMap,I6=r=>{let e=yN.get(r);if(e==null){let t=new Map;return yN.set(r,t),t}return e},Jt=class{constructor(e,t,n,s){this.code=t,this.version=e,this.multihash=n,this.bytes=s,this["/"]=s}get asCID(){return this}get byteOffset(){return this.bytes.byteOffset}get byteLength(){return this.bytes.byteLength}toV0(){switch(this.version){case 0:return this;case 1:{let{code:e,multihash:t}=this;if(e!==Bh)throw new Error("Cannot convert a non dag-pb CID to CIDv0");if(t.code!==Fre)throw new Error("Cannot convert non sha2-256 multihash CID to CIDv0");return Jt.createV0(t)}default:throw Error(`Can not convert CID version ${this.version} to version 0. This is a bug please report`)}}toV1(){switch(this.version){case 0:{let{code:e,digest:t}=this.multihash,n=Ka(e,t);return Jt.createV1(this.code,n)}case 1:return this;default:throw Error(`Can not convert CID version ${this.version} to version 1. This is a bug please report`)}}equals(e){return Jt.equals(this,e)}static equals(e,t){let n=t;return n&&e.code===n.code&&e.version===n.version&&fN(e.multihash,n.multihash)}toString(e){return gN(this,e)}toJSON(){return{"/":gN(this)}}link(){return this}get[Symbol.toStringTag](){return"CID"}[Symbol.for("nodejs.util.inspect.custom")](){return`CID(${this.toString()})`}static asCID(e){if(e==null)return null;let t=e;if(t instanceof Jt)return t;if(t["/"]!=null&&t["/"]===t.bytes||t.asCID===t){let{version:n,code:s,multihash:i,bytes:o}=t;return new Jt(n,s,i,o||bN(n,s,i.bytes))}else if(t[Vre]===!0){let{version:n,multihash:s,code:i}=t,o=uN(s);return Jt.create(n,i,o)}else return null}static create(e,t,n){if(typeof t!="number")throw new Error("String codecs are no longer supported");if(!(n.bytes instanceof Uint8Array))throw new Error("Invalid digest");switch(e){case 0:{if(t!==Bh)throw new Error(`Version 0 CID must use dag-pb (code: ${Bh}) block encoding`);return new Jt(e,t,n,n.bytes)}case 1:{let s=bN(e,t,n.bytes);return new Jt(e,t,n,s)}default:throw new Error("Invalid version")}}static createV0(e){return Jt.create(0,Bh,e)}static createV1(e,t){return Jt.create(1,e,t)}static decode(e){let[t,n]=Jt.decodeFirst(e);if(n.length)throw new Error("Incorrect length");return t}static decodeFirst(e){let t=Jt.inspectBytes(e),n=t.size-t.multihashSize,s=Di(e.subarray(n,n+t.multihashSize));if(s.byteLength!==t.multihashSize)throw new Error("Incorrect length");let i=s.subarray(t.multihashSize-t.digestSize),o=new eu(t.multihashCode,t.digestSize,i,s);return[t.version===0?Jt.createV0(o):Jt.createV1(t.codec,o),e.subarray(t.size)]}static inspectBytes(e){let t=0,n=()=>{let[f,h]=Oh(e.subarray(t));return t+=h,f},s=n(),i=Bh;if(s===18?(s=0,t=0):i=n(),s!==0&&s!==1)throw new RangeError(`Invalid CID version ${s}`);let o=t,a=n(),c=n(),l=t+c,u=l-o;return{version:s,codec:i,multihashCode:a,digestSize:c,multihashSize:u,size:l}}static parse(e,t){let[n,s]=Bre(e,t),i=Jt.decode(s);if(i.version===0&&e[0]!=="Q")throw Error("Version 0 CID string must not include multibase prefix");return I6(i).set(n,e),i}},Bre=(r,e)=>{switch(r[0]){case"Q":{let t=e||Qs;return[Qs.prefix,t.decode(`${Qs.prefix}${r}`)]}case Qs.prefix:{let t=e||Qs;return[Qs.prefix,t.decode(r)]}case jl.prefix:{let t=e||jl;return[jl.prefix,t.decode(r)]}default:{if(e==null)throw Error("To parse non base32 or base58btc encoded CID multibase decoder must be provided");return[r[0],e.decode(r)]}}},Mre=(r,e,t)=>{let{prefix:n}=t;if(n!==Qs.prefix)throw Error(`Cannot string encode V0 in ${t.name} encoding`);let s=e.get(n);if(s==null){let i=t.encode(r).slice(1);return e.set(n,i),i}else return s},Ure=(r,e,t)=>{let{prefix:n}=t,s=e.get(n);if(s==null){let i=t.encode(r);return e.set(n,i),i}else return s},Bh=112,Fre=18,bN=(r,e,t)=>{let n=Jl(r),s=n+Jl(e),i=new Uint8Array(s+t.byteLength);return Zl(r,i,0),Zl(e,i,n),i.set(t,s),i},Vre=Symbol.for("@ipld/js-cid/CID");var wN={...h6,...d6,...p6,...m6,...g6,...y6,...b6,...w6,...x6,...E6},NPe={...A6,...R6};var xN=W(a6(),1);var T6=C("libp2p:webrtc:sdp"),D6=Object.values(wN).map(r=>r.decoder).reduce((r,e)=>r.or(e));function EN(r){let e=r.getConfiguration().certificates?.at(0);if(e==null||e.getFingerprints==null){T6.trace("fetching fingerprint from local SDP");let n=r.localDescription;return n==null?void 0:qre(n.sdp)}if(T6.trace("fetching fingerprint from local certificate"),e.getFingerprints().length===0)return;let t=e.getFingerprints()[0].value;if(t==null)throw Sy("","no fingerprint on local certificate");return t}var zre=/^a=fingerprint:(?:\w+-[0-9]+)\s(?<fingerprint>(:?[0-9a-fA-F]{2})+)$/m;function qre(r){return r.match(zre)?.groups?.fingerprint}function Kre(r){for(let e of r.protoNames())if(e.startsWith("ip"))return e.toUpperCase();return T6("Warning: multiaddr does not appear to contain IP4 or IP6, defaulting to IP6",r),"IP6"}function n2(r){let t=r.stringTuples().filter(n=>n[0]===k6).map(n=>n[1])[0];if(t===void 0||t==="")throw F1(`Couldn't find a certhash component of multiaddr: ${r.toString()}`);return t}function C6(r){let e=D6.decode(r);return xN.decode(e)}function $re(r){let e=C6(n2(r)),t=P6(e.name),n=e.digest.reduce((i,o)=>i+o.toString(16).padStart(2,"0"),""),s=n.match(/.{1,2}/g);if(s==null)throw Sy(n,r.toString());return[`${t.toUpperCase()} ${s.join(":").toUpperCase()}`,n]}function P6(r){switch(r){case"sha1":return"sha-1";case"sha2-256":return"sha-256";case"sha2-512":return"sha-512";default:throw mP(r)}}function Hre(r,e){let{host:t,port:n}=r.toOptions(),s=Kre(r),[i]=$re(r);return`v=0
o=- 0 0 IN ${s} ${t}
s=-
c=IN ${s} ${t}
t=0 0
a=ice-lite
m=application ${n} UDP/DTLS/SCTP webrtc-datachannel
a=mid:0
a=setup:passive
a=ice-ufrag:${e}
a=ice-pwd:${e}
a=fingerprint:${i}
a=sctp-port:5000
a=max-message-size:100000
a=candidate:1467250027 1 UDP 1467250027 ${t} ${n} typ host\r
`}function vN(r,e){return{type:"answer",sdp:Hre(r,e)}}function _N(r,e){if(r.sdp===void 0)throw Sh("Can't munge a missing SDP");return r.sdp=r.sdp.replace(/\na=ice-ufrag:[^\n]*\n/,`
a=ice-ufrag:`+e+`
`).replace(/\na=ice-pwd:[^\n]*\n/,`
a=ice-pwd:`+e+`
`),r}var SN=Array.from("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"),AN=r=>[...Array(r)].map(()=>SN.at(Math.floor(Math.random()*SN.length))).join("");var s2=C("libp2p:webrtc:transport"),Wre=1e4,Yre=se("webrtc-direct").code,k6=se("certhash").code,i2=class{metrics;components;init;constructor(e,t={}){this.components=e,this.init=t,e.metrics!=null&&(this.metrics={dialerEvents:e.metrics.registerCounterGroup("libp2p_webrtc_dialer_events_total",{label:"event",help:"Total count of WebRTC dial events by type"})})}async dial(e,t){let n=await this._connect(e,t);return s2(`dialing address - ${e.toString()}`),n}createListener(e){throw pP("WebRTCTransport.createListener")}filter(e){return e.filter(Qre)}[Symbol.toStringTag]="@libp2p/webrtc-direct";[qs]=!0;async _connect(e,t){let n=new AbortController,s=n.signal,i=e.getPeerId();if(i===null)throw F1("we need to have the remote's PeerId");let o=he(i),a=C6(n2(e)),c=await RTCPeerConnection.generateCertificate({name:"ECDSA",namedCurve:"P-256",hash:P6(a.name)}),l=new RTCPeerConnection({certificates:[c]}),u=new Promise((A,D)=>{let H=l.createDataChannel("",{negotiated:!0,id:0}),ee=setTimeout(()=>{let j=`Data channel was never opened: state: ${H.readyState}`;s2.error(j),this.metrics?.dialerEvents.increment({open_error:!0}),D(_y("data",j))},Wre);H.onopen=j=>{clearTimeout(ee),A(H)},H.onerror=j=>{clearTimeout(ee);let Ie=`Error opening a data channel for handshaking: ${j.target?.toString()??"not specified"}`;s2.error(Ie),this.metrics?.dialerEvents.increment({unknown_error:!0}),D(_y("data",Ie))}}),f="libp2p+webrtc+v1/"+AN(32),h=await l.createOffer(),p=_N(h,f);await l.setLocalDescription(p);let d=vN(e,f);await l.setRemoteDescription(d);let m=await u,g=this.components.peerId,y=this.generateNoisePrologue(l,a.code,e),b=Il({prologueBytes:y})(),w=Vl({channel:m,direction:"inbound",dataChannelOptions:this.init.dataChannel}),v={...w,sink:w.sink.bind(w),source:async function*(){for await(let A of w.source)for(let D of A)yield D}()},x=new Ua({peerConnection:l,remoteAddr:e,timeline:{open:Date.now()},metrics:this.metrics?.dialerEvents}),_=Ah?"iceconnectionstatechange":"connectionstatechange";l.addEventListener(_,()=>{switch(l.connectionState){case"failed":case"disconnected":case"closed":x.close().catch(A=>{s2.error("error closing connection",A)}).finally(()=>{n.abort()});break;default:break}},{signal:s}),this.metrics?.dialerEvents.increment({peer_connection:!0});let S=new Fa({peerConnection:l,metrics:this.metrics?.dialerEvents,dataChannelOptions:this.init.dataChannel});return await b.secureInbound(g,v,o),t.upgrader.upgradeOutbound(x,{skipProtection:!0,skipEncryption:!0,muxerFactory:S})}generateNoisePrologue(e,t,n){if(e.getConfiguration().certificates?.length===0)throw Sh("no local certificate");let s=EN(e);if(s==null)throw Sh("no local fingerprint found");let i=s.trim().toLowerCase().replaceAll(":",""),o=$(i,"hex"),a=RN.encode(o,t),c=D6.decode(n2(n)),l=$("libp2p-webrtc-noise:");return Ee([l,a,c])}};function Qre(r){let e=r.protoCodes();return e.includes(Yre)&&e.includes(k6)&&r.getPeerId()!=null&&!e.includes(se("p2p-circuit").code)}function IN(r){return e=>new i2(e,r)}function TN(r){return e=>new H1(e,r)}function DN(r){let e;try{e=se("sni").code}catch{return null}for(let[t,n]of r)if(t===e&&n!==void 0)return n;return null}function CN(r){return r.some(([e,t])=>e===se("tls").code)}function Dn(r,e,t){let n=PN[se(r).name];if(n===void 0)throw new Error(`Can't interpret protocol ${se(r).name}`);let s=n(e,t);return r===se("ip6").code?`[${s}]`:s}var PN={ip4:(r,e)=>r,ip6:(r,e)=>e.length===0?r:`[${r}]`,tcp:(r,e)=>{let t=e.pop();if(t===void 0)throw new Error("Unexpected end of multiaddr");return`tcp://${Dn(t[0],t[1]??"",e)}:${r}`},udp:(r,e)=>{let t=e.pop();if(t===void 0)throw new Error("Unexpected end of multiaddr");return`udp://${Dn(t[0],t[1]??"",e)}:${r}`},dnsaddr:(r,e)=>r,dns4:(r,e)=>r,dns6:(r,e)=>r,dns:(r,e)=>r,ipfs:(r,e)=>{let t=e.pop();if(t===void 0)throw new Error("Unexpected end of multiaddr");return`${Dn(t[0],t[1]??"",e)}/ipfs/${r}`},p2p:(r,e)=>{let t=e.pop();if(t===void 0)throw new Error("Unexpected end of multiaddr");return`${Dn(t[0],t[1]??"",e)}/p2p/${r}`},http:(r,e)=>{let t=CN(e),n=DN(e);if(t&&n!==null)return`https://${n}`;let s=t?"https://":"http://",i=e.pop();if(i===void 0)throw new Error("Unexpected end of multiaddr");let o=Dn(i[0],i[1]??"",e);return o=o.replace("tcp://",""),`${s}${o}`},tls:(r,e)=>{let t=e.pop();if(t===void 0)throw new Error("Unexpected end of multiaddr");return Dn(t[0],t[1]??"",e)},sni:(r,e)=>{let t=e.pop();if(t===void 0)throw new Error("Unexpected end of multiaddr");return Dn(t[0],t[1]??"",e)},https:(r,e)=>{let t=e.pop();if(t===void 0)throw new Error("Unexpected end of multiaddr");let n=Dn(t[0],t[1]??"",e);return n=n.replace("tcp://",""),`https://${n}`},ws:(r,e)=>{let t=CN(e),n=DN(e);if(t&&n!==null)return`wss://${n}`;let s=t?"wss://":"ws://",i=e.pop();if(i===void 0)throw new Error("Unexpected end of multiaddr");let o=Dn(i[0],i[1]??"",e);return o=o.replace("tcp://",""),`${s}${o}`},wss:(r,e)=>{let t=e.pop();if(t===void 0)throw new Error("Unexpected end of multiaddr");let n=Dn(t[0],t[1]??"",e);return n=n.replace("tcp://",""),`wss://${n}`},"p2p-websocket-star":(r,e)=>{let t=e.pop();if(t===void 0)throw new Error("Unexpected end of multiaddr");return`${Dn(t[0],t[1]??"",e)}/p2p-websocket-star`},"p2p-webrtc-star":(r,e)=>{let t=e.pop();if(t===void 0)throw new Error("Unexpected end of multiaddr");return`${Dn(t[0],t[1]??"",e)}/p2p-webrtc-star`},"p2p-webrtc-direct":(r,e)=>{let t=e.pop();if(t===void 0)throw new Error("Unexpected end of multiaddr");return`${Dn(t[0],t[1]??"",e)}/p2p-webrtc-direct`}};function kN(r,e){let n=fe(r).stringTuples(),s=n.pop();if(s===void 0)throw new Error("Unexpected end of multiaddr");let i=se(s[0]),o=PN[i.name];if(o==null)throw new Error(`No interpreter found for ${i.name}`);let a=o(s[1]??"",n);return e?.assumeHttp!==!1&&s[0]===se("tcp").code&&(a=a.replace("tcp://","http://"),(s[1]==="443"||s[1]==="80")&&(s[1]==="443"&&(a=a.replace("http://","https://")),a=a.substring(0,a.lastIndexOf(":")))),a}var NN=WebSocket;var MN=W(LN(),1);function BN(r){return r instanceof ArrayBuffer||r?.constructor?.name==="ArrayBuffer"&&typeof r?.byteLength=="number"}var UN=r=>{r.binaryType="arraybuffer";let e=async()=>{await new Promise((i,o)=>{if(n){i();return}if(s!=null){o(s);return}let a=u=>{r.removeEventListener("open",c),r.removeEventListener("error",l),u()},c=()=>{a(i)},l=u=>{a(()=>{o(u.error??new Error(`connect ECONNREFUSED ${r.url}`))})};r.addEventListener("open",c),r.addEventListener("error",l)})},t=async function*(){let i=new MN.EventIterator(({push:o,stop:a,fail:c})=>{let l=f=>{let h=null;typeof f.data=="string"&&(h=$(f.data)),BN(f.data)&&(h=new Uint8Array(f.data)),f.data instanceof Uint8Array&&(h=f.data),h!=null&&o(h)},u=f=>{c(f.error??new Error("Socket error"))};return r.addEventListener("message",l),r.addEventListener("error",u),r.addEventListener("close",a),()=>{r.removeEventListener("message",l),r.removeEventListener("error",u),r.removeEventListener("close",a)}},{highWaterMark:1/0});await e();for await(let o of i)yield BN(o)?new Uint8Array(o):o}(),n=r.readyState===1,s;return r.addEventListener("open",()=>{n=!0,s=null}),r.addEventListener("close",()=>{n=!1,s=null}),r.addEventListener("error",i=>{n||(s=i.error??new Error(`connect ECONNREFUSED ${r.url}`))}),Object.assign(t,{connected:e})};var FN=async r=>{if(r.readyState>=2)throw new Error("socket closed");r.readyState!==1&&await new Promise((e,t)=>{function n(){r.removeEventListener("open",s),r.removeEventListener("error",i)}function s(){n(),e()}function i(o){n(),t(o.error??new Error(`connect ECONNREFUSED ${r.url}`))}r.addEventListener("open",s),r.addEventListener("error",i)})};var VN=(r,e)=>(e=e??{},e.closeOnEnd=e.closeOnEnd!==!1,async n=>{for await(let s of n){try{await FN(r)}catch(i){if(i.message==="socket closed")break;throw i}r.send(s)}e.closeOnEnd!=null&&r.readyState<=1&&await new Promise((s,i)=>{r.addEventListener("close",o=>{if(o.wasClean||o.code===1006)s();else{let a=Object.assign(new Error("ws error"),{event:o});i(a)}}),setTimeout(()=>{r.close()})})});var zN=(r,e)=>{e=e??{};let t=UN(r),n=e.remoteAddress,s=e.remotePort;if(r.url!=null)try{let o=new URL(r.url);n=o.hostname,s=parseInt(o.port,10)}catch{}if(n==null||s==null)throw new Error("Remote connection did not have address and/or port");return{sink:VN(r,e),source:t,connected:async()=>{await t.connected()},close:async()=>{(r.readyState===r.CONNECTING||r.readyState===r.OPEN)&&await new Promise(o=>{r.addEventListener("close",()=>{o()}),r.close()})},destroy:()=>{r.terminate!=null?r.terminate():r.close()},remoteAddress:n,remotePort:s,socket:r}};var QN=W(YN(),1),one={http:"ws",https:"wss"},ane="ws",XN=(r,e)=>(0,QN.relative)(r,e,one,ane);function jN(r,e){let t=typeof window>"u"?"":window.location;e=e??{};let n=XN(r,t.toString()),s=new NN(n,e.websocket);return zN(s,e)}var eO=W(JN(),1),M6=typeof window=="object"&&typeof document=="object"&&document.nodeType===9,c2=(0,eO.default)(),l2=M6&&!c2,tO=c2&&!M6,rO=c2&&M6,nO=typeof globalThis.process<"u"&&typeof globalThis.process.release<"u"&&globalThis.process.release.name==="node"&&!c2,u2=typeof importScripts=="function"&&typeof self<"u"&&typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope,Ske=typeof globalThis.process<"u"&&typeof globalThis.process.env<"u"&&globalThis.process.env["NODE"+(()=>"_")()+"ENV"]==="test",sO=typeof navigator<"u"&&navigator.product==="ReactNative";function aO(r){return r.filter(e=>{if(e.protoCodes().includes(290))return!1;let t=e.decapsulateCode(421);return Cl.matches(t)||ka.matches(t)})}function cO(r){return r.filter(e=>{if(e.protoCodes().includes(290))return!1;let t=e.decapsulateCode(421);return ka.matches(t)})}function lO(){throw new Error("WebSocket Servers can not be created in the browser!")}var U6=class extends Error{constructor(e){super(e),this.name="TimeoutError"}},F6=class extends Error{constructor(e){super(),this.name="AbortError",this.message=e}},uO=r=>globalThis.DOMException===void 0?new F6(r):new DOMException(r),fO=r=>{let e=r.reason===void 0?uO("This operation was aborted."):r.reason;return e instanceof Error?e:uO(e)};function V6(r,e){let{milliseconds:t,fallback:n,message:s,customTimers:i={setTimeout,clearTimeout}}=e,o,c=new Promise((l,u)=>{if(typeof t!="number"||Math.sign(t)!==1)throw new TypeError(`Expected \`milliseconds\` to be a positive number, got \`${t}\``);if(e.signal){let{signal:h}=e;h.aborted&&u(fO(h)),h.addEventListener("abort",()=>{u(fO(h))})}if(t===Number.POSITIVE_INFINITY){r.then(l,u);return}let f=new U6;o=i.setTimeout.call(void 0,()=>{if(n){try{l(n())}catch(h){u(h)}return}typeof r.cancel=="function"&&r.cancel(),s===!1?l():s instanceof Error?u(s):(f.message=s??`Promise timed out after ${t} milliseconds`,u(f))},t),(async()=>{try{l(await r)}catch(h){u(h)}})()}).finally(()=>{c.clear()});return c.clear=()=>{i.clearTimeout.call(void 0,o),o=void 0},c}var hO=C("libp2p:websockets:socket");function dO(r,e,t){t=t??{};let n={async sink(s){t?.signal!=null&&(s=bt(s,t.signal));try{await r.sink(s)}catch(i){i.type!=="aborted"&&hO.error(i)}},source:t.signal!=null?bt(r.source,t.signal):r.source,remoteAddr:e,timeline:{open:Date.now()},async close(){let s=Date.now();try{await V6(r.close(),{milliseconds:2e3})}catch{let{host:o,port:a}=n.remoteAddr.toOptions();hO("timeout closing stream to %s:%s after %dms, destroying it manually",o,a,Date.now()-s),r.destroy()}finally{n.timeline.close=Date.now()}}};return r.socket.addEventListener("close",()=>{n.timeline.close==null&&(n.timeline.close=Date.now())},{once:!0}),n}var Oo=C("libp2p:websockets"),z6=class{init;constructor(e){this.init=e}[Symbol.toStringTag]="@libp2p/websockets";[qs]=!0;async dial(e,t){Oo("dialing %s",e),t=t??{};let n=await this._connect(e,t),s=dO(n,e);Oo("new outbound connection %s",s.remoteAddr);let i=await t.upgrader.upgradeOutbound(s);return Oo("outbound connection %s upgraded",s.remoteAddr),i}async _connect(e,t){if(t?.signal?.aborted===!0)throw new cn;let n=e.toOptions();Oo("dialing %s:%s",n.host,n.port);let s=De(),i=l=>{Oo.error("connection error:",l),s.reject(l)},o=jN(kN(e),this.init);if(o.socket.on!=null?o.socket.on("error",i):o.socket.onerror=i,t.signal==null)return await Promise.race([o.connected(),s.promise]),Oo("connected %s",e),o;let a,c=new Promise((l,u)=>{if(a=()=>{u(new cn),o.close().catch(f=>{Oo.error("error closing raw socket",f)})},t?.signal?.aborted===!0){a();return}t?.signal?.addEventListener("abort",a)});try{await Promise.race([c,s.promise,o.connected()])}finally{a!=null&&t?.signal?.removeEventListener("abort",a)}return Oo("connected %s",e),o}createListener(e){return lO({...this.init,...e})}filter(e){return e=Array.isArray(e)?e:[e],this.init?.filter!=null?this.init?.filter(e):l2||u2?cO(e):aO(e)}};function pO(r={}){return()=>new z6(r)}var G6={};Y(G6,{identity:()=>gne});function fne(r,e){if(r.length>=255)throw new TypeError("Alphabet too long");for(var t=new Uint8Array(256),n=0;n<t.length;n++)t[n]=255;for(var s=0;s<r.length;s++){var i=r.charAt(s),o=i.charCodeAt(0);if(t[o]!==255)throw new TypeError(i+" is ambiguous");t[o]=s}var a=r.length,c=r.charAt(0),l=Math.log(a)/Math.log(256),u=Math.log(256)/Math.log(a);function f(d){if(d instanceof Uint8Array||(ArrayBuffer.isView(d)?d=new Uint8Array(d.buffer,d.byteOffset,d.byteLength):Array.isArray(d)&&(d=Uint8Array.from(d))),!(d instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(d.length===0)return"";for(var m=0,g=0,y=0,b=d.length;y!==b&&d[y]===0;)y++,m++;for(var w=(b-y)*u+1>>>0,v=new Uint8Array(w);y!==b;){for(var x=d[y],_=0,S=w-1;(x!==0||_<g)&&S!==-1;S--,_++)x+=256*v[S]>>>0,v[S]=x%a>>>0,x=x/a>>>0;if(x!==0)throw new Error("Non-zero carry");g=_,y++}for(var A=w-g;A!==w&&v[A]===0;)A++;for(var D=c.repeat(m);A<w;++A)D+=r.charAt(v[A]);return D}function h(d){if(typeof d!="string")throw new TypeError("Expected String");if(d.length===0)return new Uint8Array;var m=0;if(d[m]!==" "){for(var g=0,y=0;d[m]===c;)g++,m++;for(var b=(d.length-m)*l+1>>>0,w=new Uint8Array(b);d[m];){var v=t[d.charCodeAt(m)];if(v===255)return;for(var x=0,_=b-1;(v!==0||x<y)&&_!==-1;_--,x++)v+=a*w[_]>>>0,w[_]=v%256>>>0,v=v/256>>>0;if(v!==0)throw new Error("Non-zero carry");y=x,m++}if(d[m]!==" "){for(var S=b-y;S!==b&&w[S]===0;)S++;for(var A=new Uint8Array(g+(b-S)),D=g;S!==b;)A[D++]=w[S++];return A}}}function p(d){var m=h(d);if(m)return m;throw new Error(`Non-${e} character`)}return{encode:f,decodeUnsafe:h,decode:p}}var hne=fne,dne=hne,mO=dne;var Qke=new Uint8Array(0);var gO=(r,e)=>{if(r===e)return!0;if(r.byteLength!==e.byteLength)return!1;for(let t=0;t<r.byteLength;t++)if(r[t]!==e[t])return!1;return!0},Ci=r=>{if(r instanceof Uint8Array&&r.constructor.name==="Uint8Array")return r;if(r instanceof ArrayBuffer)return new Uint8Array(r);if(ArrayBuffer.isView(r))return new Uint8Array(r.buffer,r.byteOffset,r.byteLength);throw new Error("Unknown type, must be binary type")};var yO=r=>new TextEncoder().encode(r),bO=r=>new TextDecoder().decode(r);var q6=class{constructor(e,t,n){this.name=e,this.prefix=t,this.baseEncode=n}encode(e){if(e instanceof Uint8Array)return`${this.prefix}${this.baseEncode(e)}`;throw Error("Unknown type, must be binary type")}},K6=class{constructor(e,t,n){if(this.name=e,this.prefix=t,t.codePointAt(0)===void 0)throw new Error("Invalid prefix character");this.prefixCodePoint=t.codePointAt(0),this.baseDecode=n}decode(e){if(typeof e=="string"){if(e.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(e)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(e.slice(this.prefix.length))}else throw Error("Can only multibase decode strings")}or(e){return xO(this,e)}},$6=class{constructor(e){this.decoders=e}or(e){return xO(this,e)}decode(e){let t=e[0],n=this.decoders[t];if(n)return n.decode(e);throw RangeError(`Unable to decode multibase string ${JSON.stringify(e)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}},xO=(r,e)=>new $6({...r.decoders||{[r.prefix]:r},...e.decoders||{[e.prefix]:e}}),H6=class{constructor(e,t,n,s){this.name=e,this.prefix=t,this.baseEncode=n,this.baseDecode=s,this.encoder=new q6(e,t,n),this.decoder=new K6(e,t,s)}encode(e){return this.encoder.encode(e)}decode(e){return this.decoder.decode(e)}},tu=({name:r,prefix:e,encode:t,decode:n})=>new H6(r,e,t,n),Lo=({prefix:r,name:e,alphabet:t})=>{let{encode:n,decode:s}=mO(t,e);return tu({prefix:r,name:e,encode:n,decode:i=>Ci(s(i))})},pne=(r,e,t,n)=>{let s={};for(let u=0;u<e.length;++u)s[e[u]]=u;let i=r.length;for(;r[i-1]==="=";)--i;let o=new Uint8Array(i*t/8|0),a=0,c=0,l=0;for(let u=0;u<i;++u){let f=s[r[u]];if(f===void 0)throw new SyntaxError(`Non-${n} character`);c=c<<t|f,a+=t,a>=8&&(a-=8,o[l++]=255&c>>a)}if(a>=t||255&c<<8-a)throw new SyntaxError("Unexpected end of data");return o},mne=(r,e,t)=>{let n=e[e.length-1]==="=",s=(1<<t)-1,i="",o=0,a=0;for(let c=0;c<r.length;++c)for(a=a<<8|r[c],o+=8;o>t;)o-=t,i+=e[s&a>>o];if(o&&(i+=e[s&a<<t-o]),n)for(;i.length*t&7;)i+="=";return i},Vt=({name:r,prefix:e,bitsPerChar:t,alphabet:n})=>tu({prefix:e,name:r,encode(s){return mne(s,n,t)},decode(s){return pne(s,n,t,r)}});var gne=tu({prefix:"\0",name:"identity",encode:r=>bO(r),decode:r=>yO(r)});var W6={};Y(W6,{base2:()=>yne});var yne=Vt({prefix:"0",name:"base2",alphabet:"01",bitsPerChar:1});var Y6={};Y(Y6,{base8:()=>bne});var bne=Vt({prefix:"7",name:"base8",alphabet:"01234567",bitsPerChar:3});var Q6={};Y(Q6,{base10:()=>wne});var wne=Lo({prefix:"9",name:"base10",alphabet:"0123456789"});var X6={};Y(X6,{base16:()=>xne,base16upper:()=>Ene});var xne=Vt({prefix:"f",name:"base16",alphabet:"0123456789abcdef",bitsPerChar:4}),Ene=Vt({prefix:"F",name:"base16upper",alphabet:"0123456789ABCDEF",bitsPerChar:4});var j6={};Y(j6,{base32:()=>ru,base32hex:()=>Ane,base32hexpad:()=>Ine,base32hexpadupper:()=>Tne,base32hexupper:()=>Rne,base32pad:()=>_ne,base32padupper:()=>Sne,base32upper:()=>vne,base32z:()=>Dne});var ru=Vt({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5}),vne=Vt({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5}),_ne=Vt({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5}),Sne=Vt({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5}),Ane=Vt({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5}),Rne=Vt({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5}),Ine=Vt({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5}),Tne=Vt({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5}),Dne=Vt({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5});var Z6={};Y(Z6,{base36:()=>Cne,base36upper:()=>Pne});var Cne=Lo({prefix:"k",name:"base36",alphabet:"0123456789abcdefghijklmnopqrstuvwxyz"}),Pne=Lo({prefix:"K",name:"base36upper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"});var J6={};Y(J6,{base58btc:()=>Xs,base58flickr:()=>kne});var Xs=Lo({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"}),kne=Lo({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"});var e7={};Y(e7,{base64:()=>Nne,base64pad:()=>One,base64url:()=>Lne,base64urlpad:()=>Bne});var Nne=Vt({prefix:"m",name:"base64",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bitsPerChar:6}),One=Vt({prefix:"M",name:"base64pad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",bitsPerChar:6}),Lne=Vt({prefix:"u",name:"base64url",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",bitsPerChar:6}),Bne=Vt({prefix:"U",name:"base64urlpad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=",bitsPerChar:6});var t7={};Y(t7,{base256emoji:()=>zne});var EO=Array.from("\u{1F680}\u{1FA90}\u2604\u{1F6F0}\u{1F30C}\u{1F311}\u{1F312}\u{1F313}\u{1F314}\u{1F315}\u{1F316}\u{1F317}\u{1F318}\u{1F30D}\u{1F30F}\u{1F30E}\u{1F409}\u2600\u{1F4BB}\u{1F5A5}\u{1F4BE}\u{1F4BF}\u{1F602}\u2764\u{1F60D}\u{1F923}\u{1F60A}\u{1F64F}\u{1F495}\u{1F62D}\u{1F618}\u{1F44D}\u{1F605}\u{1F44F}\u{1F601}\u{1F525}\u{1F970}\u{1F494}\u{1F496}\u{1F499}\u{1F622}\u{1F914}\u{1F606}\u{1F644}\u{1F4AA}\u{1F609}\u263A\u{1F44C}\u{1F917}\u{1F49C}\u{1F614}\u{1F60E}\u{1F607}\u{1F339}\u{1F926}\u{1F389}\u{1F49E}\u270C\u2728\u{1F937}\u{1F631}\u{1F60C}\u{1F338}\u{1F64C}\u{1F60B}\u{1F497}\u{1F49A}\u{1F60F}\u{1F49B}\u{1F642}\u{1F493}\u{1F929}\u{1F604}\u{1F600}\u{1F5A4}\u{1F603}\u{1F4AF}\u{1F648}\u{1F447}\u{1F3B6}\u{1F612}\u{1F92D}\u2763\u{1F61C}\u{1F48B}\u{1F440}\u{1F62A}\u{1F611}\u{1F4A5}\u{1F64B}\u{1F61E}\u{1F629}\u{1F621}\u{1F92A}\u{1F44A}\u{1F973}\u{1F625}\u{1F924}\u{1F449}\u{1F483}\u{1F633}\u270B\u{1F61A}\u{1F61D}\u{1F634}\u{1F31F}\u{1F62C}\u{1F643}\u{1F340}\u{1F337}\u{1F63B}\u{1F613}\u2B50\u2705\u{1F97A}\u{1F308}\u{1F608}\u{1F918}\u{1F4A6}\u2714\u{1F623}\u{1F3C3}\u{1F490}\u2639\u{1F38A}\u{1F498}\u{1F620}\u261D\u{1F615}\u{1F33A}\u{1F382}\u{1F33B}\u{1F610}\u{1F595}\u{1F49D}\u{1F64A}\u{1F639}\u{1F5E3}\u{1F4AB}\u{1F480}\u{1F451}\u{1F3B5}\u{1F91E}\u{1F61B}\u{1F534}\u{1F624}\u{1F33C}\u{1F62B}\u26BD\u{1F919}\u2615\u{1F3C6}\u{1F92B}\u{1F448}\u{1F62E}\u{1F646}\u{1F37B}\u{1F343}\u{1F436}\u{1F481}\u{1F632}\u{1F33F}\u{1F9E1}\u{1F381}\u26A1\u{1F31E}\u{1F388}\u274C\u270A\u{1F44B}\u{1F630}\u{1F928}\u{1F636}\u{1F91D}\u{1F6B6}\u{1F4B0}\u{1F353}\u{1F4A2}\u{1F91F}\u{1F641}\u{1F6A8}\u{1F4A8}\u{1F92C}\u2708\u{1F380}\u{1F37A}\u{1F913}\u{1F619}\u{1F49F}\u{1F331}\u{1F616}\u{1F476}\u{1F974}\u25B6\u27A1\u2753\u{1F48E}\u{1F4B8}\u2B07\u{1F628}\u{1F31A}\u{1F98B}\u{1F637}\u{1F57A}\u26A0\u{1F645}\u{1F61F}\u{1F635}\u{1F44E}\u{1F932}\u{1F920}\u{1F927}\u{1F4CC}\u{1F535}\u{1F485}\u{1F9D0}\u{1F43E}\u{1F352}\u{1F617}\u{1F911}\u{1F30A}\u{1F92F}\u{1F437}\u260E\u{1F4A7}\u{1F62F}\u{1F486}\u{1F446}\u{1F3A4}\u{1F647}\u{1F351}\u2744\u{1F334}\u{1F4A3}\u{1F438}\u{1F48C}\u{1F4CD}\u{1F940}\u{1F922}\u{1F445}\u{1F4A1}\u{1F4A9}\u{1F450}\u{1F4F8}\u{1F47B}\u{1F910}\u{1F92E}\u{1F3BC}\u{1F975}\u{1F6A9}\u{1F34E}\u{1F34A}\u{1F47C}\u{1F48D}\u{1F4E3}\u{1F942}"),Mne=EO.reduce((r,e,t)=>(r[t]=e,r),[]),Une=EO.reduce((r,e,t)=>(r[e.codePointAt(0)]=t,r),[]);function Fne(r){return r.reduce((e,t)=>(e+=Mne[t],e),"")}function Vne(r){let e=[];for(let t of r){let n=Une[t.codePointAt(0)];if(n===void 0)throw new Error(`Non-base256emoji character: ${t}`);e.push(n)}return new Uint8Array(e)}var zne=tu({prefix:"\u{1F680}",name:"base256emoji",encode:Fne,decode:Vne});var a7={};Y(a7,{sha256:()=>ose,sha512:()=>ase});var Mo={};Y(Mo,{Digest:()=>$a,create:()=>Bo,decode:()=>n7,equals:()=>s7});var qne=SO,vO=128,Kne=127,$ne=~Kne,Hne=Math.pow(2,31);function SO(r,e,t){e=e||[],t=t||0;for(var n=t;r>=Hne;)e[t++]=r&255|vO,r/=128;for(;r&$ne;)e[t++]=r&255|vO,r>>>=7;return e[t]=r|0,SO.bytes=t-n+1,e}var Gne=r7,Wne=128,_O=127;function r7(r,n){var t=0,n=n||0,s=0,i=n,o,a=r.length;do{if(i>=a)throw r7.bytes=0,new RangeError("Could not decode varint");o=r[i++],t+=s<28?(o&_O)<<s:(o&_O)*Math.pow(2,s),s+=7}while(o>=Wne);return r7.bytes=i-n,t}var Yne=Math.pow(2,7),Qne=Math.pow(2,14),Xne=Math.pow(2,21),jne=Math.pow(2,28),Zne=Math.pow(2,35),Jne=Math.pow(2,42),ese=Math.pow(2,49),tse=Math.pow(2,56),rse=Math.pow(2,63),nse=function(r){return r<Yne?1:r<Qne?2:r<Xne?3:r<jne?4:r<Zne?5:r<Jne?6:r<ese?7:r<tse?8:r<rse?9:10},sse={encode:qne,decode:Gne,encodingLength:nse},ise=sse,Fh=ise;var Vh=(r,e=0)=>[Fh.decode(r,e),Fh.decode.bytes],nu=(r,e,t=0)=>(Fh.encode(r,e,t),e),su=r=>Fh.encodingLength(r);var Bo=(r,e)=>{let t=e.byteLength,n=su(r),s=n+su(t),i=new Uint8Array(s+t);return nu(r,i,0),nu(t,i,n),i.set(e,s),new $a(r,t,e,i)},n7=r=>{let e=Ci(r),[t,n]=Vh(e),[s,i]=Vh(e.subarray(n)),o=e.subarray(n+i);if(o.byteLength!==s)throw new Error("Incorrect length");return new $a(t,s,o,e)},s7=(r,e)=>{if(r===e)return!0;{let t=e;return r.code===t.code&&r.size===t.size&&t.bytes instanceof Uint8Array&&gO(r.bytes,t.bytes)}},$a=class{constructor(e,t,n,s){this.code=e,this.size=t,this.digest=n,this.bytes=s}};var o7=({name:r,code:e,encode:t})=>new i7(r,e,t),i7=class{constructor(e,t,n){this.name=e,this.code=t,this.encode=n}digest(e){if(e instanceof Uint8Array){let t=this.encode(e);return t instanceof Uint8Array?Bo(this.code,t):t.then(n=>Bo(this.code,n))}else throw Error("Unknown type, must be binary type")}};var RO=r=>async e=>new Uint8Array(await crypto.subtle.digest(r,e)),ose=o7({name:"sha2-256",code:18,encode:RO("SHA-256")}),ase=o7({name:"sha2-512",code:19,encode:RO("SHA-512")});var c7={};Y(c7,{identity:()=>use});var IO=0,cse="identity",TO=Ci,lse=r=>Bo(IO,TO(r)),use={code:IO,name:cse,encode:TO,digest:lse};var gNe=new TextEncoder,yNe=new TextDecoder;var DO=(r,e)=>{let{bytes:t,version:n}=r;switch(n){case 0:return pse(t,l7(r),e||Xs.encoder);default:return mse(t,l7(r),e||ru.encoder)}};var CO=new WeakMap,l7=r=>{let e=CO.get(r);if(e==null){let t=new Map;return CO.set(r,t),t}return e},er=class{constructor(e,t,n,s){this.code=t,this.version=e,this.multihash=n,this.bytes=s,this["/"]=s}get asCID(){return this}get byteOffset(){return this.bytes.byteOffset}get byteLength(){return this.bytes.byteLength}toV0(){switch(this.version){case 0:return this;case 1:{let{code:e,multihash:t}=this;if(e!==zh)throw new Error("Cannot convert a non dag-pb CID to CIDv0");if(t.code!==gse)throw new Error("Cannot convert non sha2-256 multihash CID to CIDv0");return er.createV0(t)}default:throw Error(`Can not convert CID version ${this.version} to version 0. This is a bug please report`)}}toV1(){switch(this.version){case 0:{let{code:e,digest:t}=this.multihash,n=Bo(e,t);return er.createV1(this.code,n)}case 1:return this;default:throw Error(`Can not convert CID version ${this.version} to version 1. This is a bug please report`)}}equals(e){return er.equals(this,e)}static equals(e,t){let n=t;return n&&e.code===n.code&&e.version===n.version&&s7(e.multihash,n.multihash)}toString(e){return DO(this,e)}toJSON(){return{"/":DO(this)}}link(){return this}get[Symbol.toStringTag](){return"CID"}[Symbol.for("nodejs.util.inspect.custom")](){return`CID(${this.toString()})`}static asCID(e){if(e==null)return null;let t=e;if(t instanceof er)return t;if(t["/"]!=null&&t["/"]===t.bytes||t.asCID===t){let{version:n,code:s,multihash:i,bytes:o}=t;return new er(n,s,i,o||PO(n,s,i.bytes))}else if(t[yse]===!0){let{version:n,multihash:s,code:i}=t,o=n7(s);return er.create(n,i,o)}else return null}static create(e,t,n){if(typeof t!="number")throw new Error("String codecs are no longer supported");if(!(n.bytes instanceof Uint8Array))throw new Error("Invalid digest");switch(e){case 0:{if(t!==zh)throw new Error(`Version 0 CID must use dag-pb (code: ${zh}) block encoding`);return new er(e,t,n,n.bytes)}case 1:{let s=PO(e,t,n.bytes);return new er(e,t,n,s)}default:throw new Error("Invalid version")}}static createV0(e){return er.create(0,zh,e)}static createV1(e,t){return er.create(1,e,t)}static decode(e){let[t,n]=er.decodeFirst(e);if(n.length)throw new Error("Incorrect length");return t}static decodeFirst(e){let t=er.inspectBytes(e),n=t.size-t.multihashSize,s=Ci(e.subarray(n,n+t.multihashSize));if(s.byteLength!==t.multihashSize)throw new Error("Incorrect length");let i=s.subarray(t.multihashSize-t.digestSize),o=new $a(t.multihashCode,t.digestSize,i,s);return[t.version===0?er.createV0(o):er.createV1(t.codec,o),e.subarray(t.size)]}static inspectBytes(e){let t=0,n=()=>{let[f,h]=Vh(e.subarray(t));return t+=h,f},s=n(),i=zh;if(s===18?(s=0,t=0):i=n(),s!==0&&s!==1)throw new RangeError(`Invalid CID version ${s}`);let o=t,a=n(),c=n(),l=t+c,u=l-o;return{version:s,codec:i,multihashCode:a,digestSize:c,multihashSize:u,size:l}}static parse(e,t){let[n,s]=dse(e,t),i=er.decode(s);if(i.version===0&&e[0]!=="Q")throw Error("Version 0 CID string must not include multibase prefix");return l7(i).set(n,e),i}},dse=(r,e)=>{switch(r[0]){case"Q":{let t=e||Xs;return[Xs.prefix,t.decode(`${Xs.prefix}${r}`)]}case Xs.prefix:{let t=e||Xs;return[Xs.prefix,t.decode(r)]}case ru.prefix:{let t=e||ru;return[ru.prefix,t.decode(r)]}default:{if(e==null)throw Error("To parse non base32 or base58btc encoded CID multibase decoder must be provided");return[r[0],e.decode(r)]}}},pse=(r,e,t)=>{let{prefix:n}=t;if(n!==Xs.prefix)throw Error(`Cannot string encode V0 in ${t.name} encoding`);let s=e.get(n);if(s==null){let i=t.encode(r).slice(1);return e.set(n,i),i}else return s},mse=(r,e,t)=>{let{prefix:n}=t,s=e.get(n);if(s==null){let i=t.encode(r);return e.set(n,i),i}else return s},zh=112,gse=18,PO=(r,e,t)=>{let n=su(r),s=n+su(e),i=new Uint8Array(s+t.byteLength);return nu(r,i,0),nu(e,i,n),i.set(t,s),i},yse=Symbol.for("@ipld/js-cid/CID");var kO={...G6,...W6,...Y6,...Q6,...X6,...j6,...Z6,...J6,...e7,...t7},INe={...a7,...c7};var en=C("libp2p:webtransport"),bse=Object.values(kO).map(r=>r.decoder).reduce((r,e)=>r.or(e));function wse(r){return Mo.decode(bse.decode(r))}function NO(){return{source:{[Symbol.asyncIterator](){return{async next(){return new Promise(()=>{})}}}},sink:async r=>new Promise(()=>{})}}async function OO(r,e,t,n,s){let i=r.writable.getWriter(),o=r.readable.getReader();await i.ready;function a(){let h=n.findIndex(p=>p===f);h!==-1&&(n.splice(h,1),f.stat.timeline.close=Date.now(),s?.(f))}let c=!1,l=!1;(async function(){let h=await i.closed.catch(p=>p);if(h!=null){let p=h.message;p.includes("aborted by the remote server")||p.includes("STOP_SENDING")||en.error(`WebTransport writer closed unexpectedly: streamId=${e} err=${h.message}`)}c=!0,c&&l&&a()})().catch(()=>{en.error("WebTransport failed to cleanup closed stream")}),async function(){let h=await o.closed.catch(p=>p);h!=null&&en.error(`WebTransport reader closed unexpectedly: streamId=${e} err=${h.message}`),l=!0,c&&l&&a()}().catch(()=>{en.error("WebTransport failed to cleanup closed stream")});let u=!1,f={id:e,abort(h){c||(i.abort(),c=!0),f.closeRead(),l=!0,a()},close(){f.closeRead(),f.closeWrite(),a()},closeRead(){l||(o.cancel().catch(h=>{h.toString().includes("RESET_STREAM")===!0&&(c=!0)}),l=!0),c&&a()},closeWrite(){c||(c=!0,i.close().catch(h=>{h.toString().includes("RESET_STREAM")===!0&&(l=!0)})),l&&a()},reset(){f.close()},stat:{direction:t,timeline:{open:Date.now()}},metadata:{},source:async function*(){for(;;){let h=await o.read();if(h.done===!0){l=!0,c&&a();return}yield new ye(h.value)}}(),sink:async function(h){if(u)throw new Error("sink already called on stream");u=!0;try{for await(let p of h)if(p instanceof Uint8Array)await i.write(p);else for(let d of p)await i.write(d)}finally{f.closeWrite()}}};return f}function xse(r){let e=r.stringTuples(),{url:t,certhashes:n,remotePeer:s}=e.reduce((i,[o,a])=>{switch(o){case se("ip6").code:case se("dns6").code:a?.includes(":")===!0&&(a=`[${a}]`);case se("ip4").code:case se("dns4").code:if(i.seenHost||i.seenPort)throw new Error("Invalid multiaddr, saw host and already saw the host or port");return{...i,url:`${i.url}${a??""}`,seenHost:!0};case se("quic").code:case se("quic-v1").code:case se("webtransport").code:if(!i.seenHost||!i.seenPort)throw new Error("Invalid multiaddr, Didn't see host and port, but saw quic/webtransport");return i;case se("udp").code:if(i.seenPort)throw new Error("Invalid multiaddr, saw port but already saw the port");return{...i,url:`${i.url}:${a??""}`,seenPort:!0};case se("certhash").code:if(!i.seenHost||!i.seenPort)throw new Error("Invalid multiaddr, saw the certhash before seeing the host and port");return{...i,certhashes:i.certhashes.concat([wse(a??"")])};case se("p2p").code:return{...i,remotePeer:he(a??"")};default:throw new Error(`unexpected component in multiaddr: ${o} ${se(o).name} ${a??""} `)}},{url:"https://",seenHost:!1,seenPort:!1,certhashes:[]});return{url:t,certhashes:n,remotePeer:s}}function Ese(r,e){return e.filter(n=>!!r.find(s=>{if(n.length!==s.length)return!1;for(let i=0;i<n.length;i++)if(s[i]!==n[i])return!1;return!0})).length===e.length}var u7=class{components;config;constructor(e,t={}){this.components=e,this.config={maxInboundStreams:t.maxInboundStreams??1e3}}[Symbol.toStringTag]="@libp2p/webtransport";[qs]=!0;async dial(e,t){en("dialing %s",e);let n=this.components.peerId;if(n===void 0)throw new Error("Need a local peerid");t=t??{};let{url:s,certhashes:i,remotePeer:o}=xse(e);if(i.length===0)throw new Error("Expected multiaddr to contain certhashes");let a=new WebTransport(`${s}/.well-known/libp2p-webtransport?type=noise`,{serverCertificateHashes:i.map(l=>({algorithm:"sha-256",value:l.digest}))});if(a.closed.catch(l=>{en.error("WebTransport transport closed due to:",l)}),await a.ready,o==null)throw new Error("Need a target peerid");if(!await this.authenticateWebTransport(a,n,o,i))throw new Error("Failed to authenticate webtransport");let c={close:async l=>{l!=null&&en("Closing webtransport with err:",l),a.close()},remoteAddr:e,timeline:{open:Date.now()},...NO()};a.closed.catch(l=>{en.error("WebTransport connection closed:",l),c.timeline.close=Date.now()});try{t?.signal?.throwIfAborted()}catch(l){throw a.close(),l}return t.upgrader.upgradeOutbound(c,{skipEncryption:!0,muxerFactory:this.webtransportMuxer(a),skipProtection:!0})}async authenticateWebTransport(e,t,n,s){let i=await e.createBidirectionalStream(),o=i.writable.getWriter(),a=i.readable.getReader();await o.ready;let c={source:async function*(){for(;;){let f=await a.read();if(f.value!=null&&(yield f.value),f.done===!0)break}}(),sink:async function(f){for await(let h of f)await o.write(h)}},l=Il()(),{remoteExtensions:u}=await l.secureOutbound(t,c,n);if(o.close().catch(f=>{en.error(`Failed to close authentication stream writer: ${f.message}`)}),a.cancel().catch(f=>{en.error(`Failed to close authentication stream reader: ${f.message}`)}),!Ese(u?.webtransportCerthashes??[],s.map(f=>f.bytes)))throw new Error("Our certhashes are not a subset of the remote's reported certhashes");return!0}webtransportMuxer(e){let t=0,n=this.config;return{protocol:"webtransport",createStreamMuxer:s=>{typeof s=="function"&&(s={onIncomingStream:s});let i=[];(async function(){let a=e.incomingBidirectionalStreams.getReader();for(;;){let{done:c,value:l}=await a.read();if(c===!0)break;if(i.length>=n.maxInboundStreams)l.writable.close().catch(u=>{en.error(`Failed to close inbound stream that crossed our maxInboundStream limit: ${u.message}`)}),l.readable.cancel().catch(u=>{en.error(`Failed to close inbound stream that crossed our maxInboundStream limit: ${u.message}`)});else{let u=await OO(l,String(t++),"inbound",i,s?.onStreamEnd);i.push(u),s?.onIncomingStream?.(u)}}})().catch(()=>{en.error("WebTransport failed to receive incoming stream")});let o={protocol:"webtransport",streams:i,newStream:async a=>{let c=await e.createBidirectionalStream(),l=await OO(c,String(t++),s?.direction??"outbound",i,s?.onStreamEnd);return i.push(l),l},close:a=>{a!=null&&en("Closing webtransport muxer with err:",a),e.close()},...NO()};try{s?.signal?.throwIfAborted()}catch(a){throw e.close(),a}return o}}}createListener(e){throw new Error("Webtransport servers are not supported in Node or the browser")}filter(e){return e.filter(t=>t.protoNames().includes("webtransport"))}};function LO(r={}){return e=>new u7(e,r)}var js;(function(r){let e;(function(s){s.EOL="EOL"})(e=r.ValidityType||(r.ValidityType={}));let t;(function(s){s[s.EOL=0]="EOL"})(t||(t={})),function(s){s.codec=()=>Pt(t)}(e=r.ValidityType||(r.ValidityType={}));let n;r.codec=()=>(n==null&&(n=me((s,i,o={})=>{o.lengthDelimited!==!1&&i.fork(),s.value!=null&&(i.uint32(10),i.bytes(s.value)),s.signature!=null&&(i.uint32(18),i.bytes(s.signature)),s.validityType!=null&&(i.uint32(24),r.ValidityType.codec().encode(s.validityType,i)),s.validity!=null&&(i.uint32(34),i.bytes(s.validity)),s.sequence!=null&&(i.uint32(40),i.uint64(s.sequence)),s.ttl!=null&&(i.uint32(48),i.uint64(s.ttl)),s.pubKey!=null&&(i.uint32(58),i.bytes(s.pubKey)),s.signatureV2!=null&&(i.uint32(66),i.bytes(s.signatureV2)),s.data!=null&&(i.uint32(74),i.bytes(s.data)),o.lengthDelimited!==!1&&i.ldelim()},(s,i)=>{let o={},a=i==null?s.len:s.pos+i;for(;s.pos<a;){let c=s.uint32();switch(c>>>3){case 1:o.value=s.bytes();break;case 2:o.signature=s.bytes();break;case 3:o.validityType=r.ValidityType.codec().decode(s);break;case 4:o.validity=s.bytes();break;case 5:o.sequence=s.uint64();break;case 6:o.ttl=s.uint64();break;case 7:o.pubKey=s.bytes();break;case 8:o.signatureV2=s.bytes();break;case 9:o.data=s.bytes();break;default:s.skipType(c&7);break}}return o})),n),r.encode=s=>pe(s,r.codec()),r.decode=s=>de(s,r.codec())})(js||(js={}));var qh=W(Ko(),1);var BO="ERR_IPNS_EXPIRED_RECORD",h2="ERR_UNRECOGNIZED_VALIDITY";var Uo="ERR_SIGNATURE_VERIFICATION",MO="ERR_UNRECOGNIZED_FORMAT";var f7="ERR_UNDEFINED_PARAMETER",UO="ERR_INVALID_RECORD_DATA",FO="ERR_INVALID_EMBEDDED_KEY";var VO="ERR_RECORD_TOO_LARGE";var qO=C("ipns:utils"),vse=$("/ipns/");function Kh(r){let e=new RegExp("(\\d{4})-(\\d{2})-(\\d{2})T(\\d{2}):(\\d{2}):(\\d{2})\\.(\\d+)Z"),t=String(r).trim().match(e);if(t==null)throw new Error("Invalid format");let n=parseInt(t[1],10),s=parseInt(t[2],10)-1,i=parseInt(t[3],10),o=parseInt(t[4],10),a=parseInt(t[5],10),c=parseInt(t[6],10),l=parseInt(t[7].slice(0,-6),10);return new Date(Date.UTC(n,s,i,o,a,c,l))}var KO=async(r,e)=>{if(e==null||r==null){let n=new Error("one or more of the provided parameters are not defined");throw qO.error(n),(0,qh.default)(n,f7)}let t;if(e.pubKey!=null){try{t=Yr(e.pubKey)}catch(s){throw qO.error(s),s}if(!(await _r(e.pubKey)).equals(r))throw(0,qh.default)(new Error("Embedded public key did not match PeerID"),FO)}else r.publicKey!=null&&(t=Yr(r.publicKey));if(t!=null)return t;throw(0,qh.default)(new Error("no public key is available"),f7)};var $O=r=>{let e=$("ipns-signature:");return Ee([e,r])};var HO=r=>{let e=js.decode(r);return e.sequence!=null&&(e.sequence=BigInt(e.sequence)),e.ttl!=null&&(e.ttl=BigInt(e.ttl)),{value:e.value??new Uint8Array(0),signature:e.signature??new Uint8Array(0),validityType:e.validityType??js.ValidityType.EOL,validity:e.validity??new Uint8Array(0),sequence:e.sequence??0n,pubKey:e.pubKey,ttl:e.ttl??void 0,signatureV2:e.signatureV2,data:e.data}};var GO=r=>_t(r.slice(vse.length));var WO=r=>{let e=es(r);if(e.ValidityType===0)e.ValidityType=js.ValidityType.EOL;else throw(0,qh.default)(new Error("Unknown validity type"),h2);return Number.isInteger(e.Sequence)&&(e.Sequence=BigInt(e.Sequence)),Number.isInteger(e.TTL)&&(e.TTL=BigInt(e.TTL)),e};var YO=(r,e)=>{let t=e.map((n,s)=>({entry:js.decode(n),index:s}));return t.sort((n,s)=>{if(n.entry.signatureV2!=null&&s.entry.signatureV2==null)return-1;if(n.entry.signatureV2==null&&s.entry.signatureV2!=null)return 1;let i=n.entry.sequence??0n,o=s.entry.sequence??0n;if(i>o)return-1;if(i<o)return 1;let a=n.entry.validity??new Uint8Array(0),c=s.entry.validity??new Uint8Array(0),l=Kh(M(a)),u=Kh(M(c));return l.getTime()>u.getTime()?-1:l.getTime()<u.getTime()?1:0}),t[0].index};var Cn=W(Ko(),1);var $h=C("ipns:validator"),_se=1024*10,Sse=async(r,e)=>{let{value:t,validityType:n,validity:s}=e,i,o;if(e.signatureV2!=null&&e.data!=null)o=e.signatureV2,i=$O(e.data),Ase(e);else throw(0,Cn.default)(new Error("missing data or signatureV2"),Uo);let a;try{a=await r.verify(i,o)}catch{a=!1}if(!a)throw $h.error("record signature verification failed"),(0,Cn.default)(new Error("record signature verification failed"),Uo);if(s!=null&&n===js.ValidityType.EOL){let c;try{c=Kh(M(s))}catch{throw $h.error("unrecognized validity format (not an rfc3339 format)"),(0,Cn.default)(new Error("unrecognized validity format (not an rfc3339 format)"),MO)}if(c.getTime()<Date.now())throw $h.error("record has expired"),(0,Cn.default)(new Error("record has expired"),BO)}else if(n!=null)throw $h.error("unrecognized validity type"),(0,Cn.default)(new Error("unrecognized validity type"),h2);$h("ipns entry for %b is valid",t)},Ase=r=>{if(r.data==null)throw(0,Cn.default)(new Error("Record data is missing"),UO);let e=WO(r.data);if(!be(e.Value,r.value))throw(0,Cn.default)(new Error('Field "value" did not match between protobuf and CBOR'),Uo);if(!be(e.Validity,r.validity))throw(0,Cn.default)(new Error('Field "validity" did not match between protobuf and CBOR'),Uo);if(e.ValidityType!==r.validityType)throw(0,Cn.default)(new Error('Field "validityType" did not match between protobuf and CBOR'),Uo);if(e.Sequence!==r.sequence)throw(0,Cn.default)(new Error('Field "sequence" did not match between protobuf and CBOR'),Uo);if(e.TTL!==r.ttl)throw(0,Cn.default)(new Error('Field "ttl" did not match between protobuf and CBOR'),Uo)},QO=async(r,e)=>{if(e.byteLength>_se)throw(0,Cn.default)(new Error("record too large"),VO);let t=GO(r),n=HO(e),s=await KO(t,n);await Sse(s,n)};var d7=W(fn(),1);var XO="libp2p",jO="autonat",ZO="1.0.0";var Ae;(function(r){let e;(function(l){l.DIAL="DIAL",l.DIAL_RESPONSE="DIAL_RESPONSE"})(e=r.MessageType||(r.MessageType={}));let t;(function(l){l[l.DIAL=0]="DIAL",l[l.DIAL_RESPONSE=1]="DIAL_RESPONSE"})(t||(t={})),function(l){l.codec=()=>Pt(t)}(e=r.MessageType||(r.MessageType={}));let n;(function(l){l.OK="OK",l.E_DIAL_ERROR="E_DIAL_ERROR",l.E_DIAL_REFUSED="E_DIAL_REFUSED",l.E_BAD_REQUEST="E_BAD_REQUEST",l.E_INTERNAL_ERROR="E_INTERNAL_ERROR"})(n=r.ResponseStatus||(r.ResponseStatus={}));let s;(function(l){l[l.OK=0]="OK",l[l.E_DIAL_ERROR=100]="E_DIAL_ERROR",l[l.E_DIAL_REFUSED=101]="E_DIAL_REFUSED",l[l.E_BAD_REQUEST=200]="E_BAD_REQUEST",l[l.E_INTERNAL_ERROR=300]="E_INTERNAL_ERROR"})(s||(s={})),function(l){l.codec=()=>Pt(s)}(n=r.ResponseStatus||(r.ResponseStatus={}));let i;(function(l){let u;l.codec=()=>(u==null&&(u=me((f,h,p={})=>{if(p.lengthDelimited!==!1&&h.fork(),f.id!=null&&(h.uint32(10),h.bytes(f.id)),f.addrs!=null)for(let d of f.addrs)h.uint32(18),h.bytes(d);p.lengthDelimited!==!1&&h.ldelim()},(f,h)=>{let p={addrs:[]},d=h==null?f.len:f.pos+h;for(;f.pos<d;){let m=f.uint32();switch(m>>>3){case 1:p.id=f.bytes();break;case 2:p.addrs.push(f.bytes());break;default:f.skipType(m&7);break}}return p})),u),l.encode=f=>pe(f,l.codec()),l.decode=f=>de(f,l.codec())})(i=r.PeerInfo||(r.PeerInfo={}));let o;(function(l){let u;l.codec=()=>(u==null&&(u=me((f,h,p={})=>{p.lengthDelimited!==!1&&h.fork(),f.peer!=null&&(h.uint32(10),r.PeerInfo.codec().encode(f.peer,h)),p.lengthDelimited!==!1&&h.ldelim()},(f,h)=>{let p={},d=h==null?f.len:f.pos+h;for(;f.pos<d;){let m=f.uint32();switch(m>>>3){case 1:p.peer=r.PeerInfo.codec().decode(f,f.uint32());break;default:f.skipType(m&7);break}}return p})),u),l.encode=f=>pe(f,l.codec()),l.decode=f=>de(f,l.codec())})(o=r.Dial||(r.Dial={}));let a;(function(l){let u;l.codec=()=>(u==null&&(u=me((f,h,p={})=>{p.lengthDelimited!==!1&&h.fork(),f.status!=null&&(h.uint32(8),r.ResponseStatus.codec().encode(f.status,h)),f.statusText!=null&&(h.uint32(18),h.string(f.statusText)),f.addr!=null&&(h.uint32(26),h.bytes(f.addr)),p.lengthDelimited!==!1&&h.ldelim()},(f,h)=>{let p={},d=h==null?f.len:f.pos+h;for(;f.pos<d;){let m=f.uint32();switch(m>>>3){case 1:p.status=r.ResponseStatus.codec().decode(f);break;case 2:p.statusText=f.string();break;case 3:p.addr=f.bytes();break;default:f.skipType(m&7);break}}return p})),u),l.encode=f=>pe(f,l.codec()),l.decode=f=>de(f,l.codec())})(a=r.DialResponse||(r.DialResponse={}));let c;r.codec=()=>(c==null&&(c=me((l,u,f={})=>{f.lengthDelimited!==!1&&u.fork(),l.type!=null&&(u.uint32(8),r.MessageType.codec().encode(l.type,u)),l.dial!=null&&(u.uint32(18),r.Dial.codec().encode(l.dial,u)),l.dialResponse!=null&&(u.uint32(26),r.DialResponse.codec().encode(l.dialResponse,u)),f.lengthDelimited!==!1&&u.ldelim()},(l,u)=>{let f={},h=u==null?l.len:l.pos+u;for(;l.pos<h;){let p=l.uint32();switch(p>>>3){case 1:f.type=r.MessageType.codec().decode(l);break;case 2:f.dial=r.Dial.codec().decode(l,l.uint32());break;case 3:f.dialResponse=r.DialResponse.codec().decode(l,l.uint32());break;default:l.skipType(p&7);break}}return f})),c),r.encode=l=>pe(l,r.codec()),r.decode=l=>de(l,r.codec())})(Ae||(Ae={}));var Qe=C("libp2p:autonat"),h7=4,p7=class{components;startupDelay;refreshInterval;protocol;timeout;maxInboundStreams;maxOutboundStreams;verifyAddressTimeout;started;constructor(e,t){this.components=e,this.started=!1,this.protocol=`/${t.protocolPrefix??XO}/${jO}/${ZO}`,this.timeout=t.timeout??3e4,this.maxInboundStreams=t.maxInboundStreams??1,this.maxOutboundStreams=t.maxOutboundStreams??1,this.startupDelay=t.startupDelay??5e3,this.refreshInterval=t.refreshInterval??6e4,this._verifyExternalAddresses=this._verifyExternalAddresses.bind(this)}isStarted(){return this.started}async start(){this.started||(await this.components.registrar.handle(this.protocol,e=>{this.handleIncomingAutonatStream(e).catch(t=>{Qe.error("error handling incoming autonat stream",t)})},{maxInboundStreams:this.maxInboundStreams,maxOutboundStreams:this.maxOutboundStreams}),this.verifyAddressTimeout=setTimeout(this._verifyExternalAddresses,this.startupDelay),this.started=!0)}async stop(){await this.components.registrar.unhandle(this.protocol),clearTimeout(this.verifyAddressTimeout),this.started=!1}async handleIncomingAutonatStream(e){let t=ot([AbortSignal.timeout(this.timeout)]);try{(0,d7.setMaxListeners)?.(1/0,t)}catch{}let n=this.components.addressManager.getAddresses().map(s=>s.toOptions().host);try{let s=Er(e.stream,t),i=this;await Re(s,o=>kt(o),async function*(o){let a=await fs(o);if(a==null){Qe("no message received"),yield Ae.encode({type:Ae.MessageType.DIAL_RESPONSE,dialResponse:{status:Ae.ResponseStatus.E_BAD_REQUEST,statusText:"No message was sent"}});return}let c;try{c=Ae.decode(a)}catch(m){Qe.error("could not decode message",m),yield Ae.encode({type:Ae.MessageType.DIAL_RESPONSE,dialResponse:{status:Ae.ResponseStatus.E_BAD_REQUEST,statusText:"Could not decode message"}});return}let l=c.dial;if(l==null){Qe.error("dial was missing from message"),yield Ae.encode({type:Ae.MessageType.DIAL_RESPONSE,dialResponse:{status:Ae.ResponseStatus.E_BAD_REQUEST,statusText:"No Dial message found in message"}});return}let u,f=l.peer;if(f==null||f.id==null){Qe.error("PeerId missing from message"),yield Ae.encode({type:Ae.MessageType.DIAL_RESPONSE,dialResponse:{status:Ae.ResponseStatus.E_BAD_REQUEST,statusText:"missing peer info"}});return}try{u=_t(f.id)}catch(m){Qe.error("invalid PeerId",m),yield Ae.encode({type:Ae.MessageType.DIAL_RESPONSE,dialResponse:{status:Ae.ResponseStatus.E_BAD_REQUEST,statusText:"bad peer id"}});return}if(Qe("incoming request from %p",u),!e.connection.remotePeer.equals(u)){Qe("target peer %p did not equal sending peer %p",u,e.connection.remotePeer),yield Ae.encode({type:Ae.MessageType.DIAL_RESPONSE,dialResponse:{status:Ae.ResponseStatus.E_BAD_REQUEST,statusText:"peer id mismatch"}});return}let h=f.addrs.map(m=>fe(m)).filter(m=>{let g=m.toOptions().host===e.connection.remoteAddr.toOptions().host;return Qe.trace("request to dial %s was sent from %s is same host %s",m,e.connection.remoteAddr,g),g}).filter(m=>{let g=m.toOptions().host,y=!(Vn(g)??!1);return Qe.trace("host %s was public %s",g,y),y}).filter(m=>{let g=m.toOptions().host,y=!n.includes(g);return Qe.trace("host %s was not our host %s",g,y),y}).filter(m=>{let g=!!i.components.transportManager.transportForMultiaddr(m);return Qe.trace("transport for %s is supported %s",m,g),g}).map(m=>(m.getPeerId()==null&&(m=m.encapsulate(`/p2p/${u.toString()}`)),m));if(h.length===0){Qe("no valid multiaddrs for %p in message",u),yield Ae.encode({type:Ae.MessageType.DIAL_RESPONSE,dialResponse:{status:Ae.ResponseStatus.E_DIAL_REFUSED,statusText:"no dialable addresses"}});return}Qe("dial multiaddrs %s for peer %p",h.map(m=>m.toString()).join(", "),u);let p="",d=h[0];for await(let m of h){let g;d=m;try{if(g=await i.components.connectionManager.openConnection(m,{signal:t}),!g.remoteAddr.equals(m))throw Qe.error("tried to dial %s but dialed %s",m,g.remoteAddr),new Error("Unexpected remote address");Qe("Success %p",u),yield Ae.encode({type:Ae.MessageType.DIAL_RESPONSE,dialResponse:{status:Ae.ResponseStatus.OK,addr:g.remoteAddr.decapsulateCode(se("p2p").code).bytes}});return}catch(y){Qe("could not dial %p",u,y),p=y.message}finally{g!=null&&await g.close()}}yield Ae.encode({type:Ae.MessageType.DIAL_RESPONSE,dialResponse:{status:Ae.ResponseStatus.E_DIAL_ERROR,statusText:p,addr:d.bytes}})},o=>wt(o),e.stream)}catch(s){Qe.error("error handling incoming autonat stream",s)}finally{t.clear()}}_verifyExternalAddresses(){this.verifyExternalAddresses().catch(e=>{Qe.error("error verifying external address",e)})}async verifyExternalAddresses(){if(clearTimeout(this.verifyAddressTimeout),!this.isStarted())return;let e=this.components.addressManager,t=e.getObservedAddrs().filter(i=>{let o=i.toOptions();return!(Vn(o.host)??!1)});if(t.length===0){Qe("no public addresses found, not requesting verification"),this.verifyAddressTimeout=setTimeout(this._verifyExternalAddresses,this.refreshInterval);return}let n=AbortSignal.timeout(this.timeout);try{(0,d7.setMaxListeners)?.(1/0,n)}catch{}let s=this;try{Qe("verify multiaddrs %s",t.map(f=>f.toString()).join(", "));let i=Ae.encode({type:Ae.MessageType.DIAL,dial:{peer:{id:this.components.peerId.toBytes(),addrs:t.map(f=>f.bytes)}}}),a=(await Gd()).toBytes(),c={},l=[],u=async f=>{try{Qe("asking %p to verify multiaddr",f.id);let h=await s.components.connectionManager.openConnection(f.id,{signal:n}),p=await h.newStream(this.protocol,{signal:n}),d=Er(p,n),m=await Re([i],y=>wt(y),d,y=>kt(y),async y=>fs(y));if(m==null){Qe("no response received from %p",h.remotePeer);return}let g=Ae.decode(m);if(g.type!==Ae.MessageType.DIAL_RESPONSE||g.dialResponse==null){Qe("invalid autonat response from %p",h.remotePeer);return}if(g.dialResponse.status===Ae.ResponseStatus.OK){let y=h.remoteAddr.toOptions(),b;if(y.family===4)b=y.host.split(".")[0];else if(y.family===6)b=y.host.split(":")[0];else{Qe('remote address "%s" was not IP4 or IP6?',y.host);return}if(l.includes(b)){Qe("already have response from network segment %d - %s",b,y.host);return}l.push(b)}return g.dialResponse}catch(h){Qe.error("error asking remote to verify multiaddr",h)}};for await(let f of Oa(Qn(this.components.peerRouting.getClosestPeers(a,{signal:n}),h=>async()=>u(h)),{concurrency:h7}))try{if(f==null)continue;let h=f.addr==null?t[0]:fe(f.addr);if(Qe("autonat response for %a is %s",h,f.status),f.status===Ae.ResponseStatus.E_BAD_REQUEST||f.status===Ae.ResponseStatus.E_DIAL_REFUSED||f.addr==null&&t.length>1)continue;if(!t.some(d=>d.equals(h))){Qe("peer reported %a as %s but it was not in our observed address list",h,f.status);continue}let p=h.toString();if(c[p]==null&&(c[p]={success:0,failure:0}),f.status===Ae.ResponseStatus.OK?c[p].success++:f.status===Ae.ResponseStatus.E_DIAL_ERROR&&c[p].failure++,c[p].success===h7){Qe("%a is externally dialable",h),e.confirmObservedAddr(h);return}if(c[p].failure===h7){Qe("%a is not externally dialable",h),e.removeObservedAddr(h);return}}catch(h){Qe.error("could not verify external address",h)}}finally{this.verifyAddressTimeout=setTimeout(this._verifyExternalAddresses,this.refreshInterval)}}};function JO(r={}){return e=>new p7(e,r)}var uie=W(fn(),1);var m7="/libp2p/relay";var eL="circuit-relay-relay";var tL=BigInt(131072),Fo="/libp2p/circuit/relay/0.2.0/hop",d2="/libp2p/circuit/relay/0.2.0/stop",Pse=30*1e3,kse=30*1e3;var Pi;(function(r){let e;(function(s){s.RESERVE="RESERVE",s.CONNECT="CONNECT",s.STATUS="STATUS"})(e=r.Type||(r.Type={}));let t;(function(s){s[s.RESERVE=0]="RESERVE",s[s.CONNECT=1]="CONNECT",s[s.STATUS=2]="STATUS"})(t||(t={})),function(s){s.codec=()=>Pt(t)}(e=r.Type||(r.Type={}));let n;r.codec=()=>(n==null&&(n=me((s,i,o={})=>{o.lengthDelimited!==!1&&i.fork(),s.type!=null&&(i.uint32(8),r.Type.codec().encode(s.type,i)),s.peer!=null&&(i.uint32(18),iu.codec().encode(s.peer,i)),s.reservation!=null&&(i.uint32(26),p2.codec().encode(s.reservation,i)),s.limit!=null&&(i.uint32(34),ou.codec().encode(s.limit,i)),s.status!=null&&(i.uint32(40),mr.codec().encode(s.status,i)),o.lengthDelimited!==!1&&i.ldelim()},(s,i)=>{let o={},a=i==null?s.len:s.pos+i;for(;s.pos<a;){let c=s.uint32();switch(c>>>3){case 1:o.type=r.Type.codec().decode(s);break;case 2:o.peer=iu.codec().decode(s,s.uint32());break;case 3:o.reservation=p2.codec().decode(s,s.uint32());break;case 4:o.limit=ou.codec().decode(s,s.uint32());break;case 5:o.status=mr.codec().decode(s);break;default:s.skipType(c&7);break}}return o})),n),r.encode=s=>pe(s,r.codec()),r.decode=s=>de(s,r.codec())})(Pi||(Pi={}));var xs;(function(r){let e;(function(s){s.CONNECT="CONNECT",s.STATUS="STATUS"})(e=r.Type||(r.Type={}));let t;(function(s){s[s.CONNECT=0]="CONNECT",s[s.STATUS=1]="STATUS"})(t||(t={})),function(s){s.codec=()=>Pt(t)}(e=r.Type||(r.Type={}));let n;r.codec=()=>(n==null&&(n=me((s,i,o={})=>{o.lengthDelimited!==!1&&i.fork(),s.type!=null&&(i.uint32(8),r.Type.codec().encode(s.type,i)),s.peer!=null&&(i.uint32(18),iu.codec().encode(s.peer,i)),s.limit!=null&&(i.uint32(26),ou.codec().encode(s.limit,i)),s.status!=null&&(i.uint32(32),mr.codec().encode(s.status,i)),o.lengthDelimited!==!1&&i.ldelim()},(s,i)=>{let o={},a=i==null?s.len:s.pos+i;for(;s.pos<a;){let c=s.uint32();switch(c>>>3){case 1:o.type=r.Type.codec().decode(s);break;case 2:o.peer=iu.codec().decode(s,s.uint32());break;case 3:o.limit=ou.codec().decode(s,s.uint32());break;case 4:o.status=mr.codec().decode(s);break;default:s.skipType(c&7);break}}return o})),n),r.encode=s=>pe(s,r.codec()),r.decode=s=>de(s,r.codec())})(xs||(xs={}));var iu;(function(r){let e;r.codec=()=>(e==null&&(e=me((t,n,s={})=>{if(s.lengthDelimited!==!1&&n.fork(),t.id!=null&&t.id.byteLength>0&&(n.uint32(10),n.bytes(t.id)),t.addrs!=null)for(let i of t.addrs)n.uint32(18),n.bytes(i);s.lengthDelimited!==!1&&n.ldelim()},(t,n)=>{let s={id:new Uint8Array(0),addrs:[]},i=n==null?t.len:t.pos+n;for(;t.pos<i;){let o=t.uint32();switch(o>>>3){case 1:s.id=t.bytes();break;case 2:s.addrs.push(t.bytes());break;default:t.skipType(o&7);break}}return s})),e),r.encode=t=>pe(t,r.codec()),r.decode=t=>de(t,r.codec())})(iu||(iu={}));var p2;(function(r){let e;r.codec=()=>(e==null&&(e=me((t,n,s={})=>{if(s.lengthDelimited!==!1&&n.fork(),t.expire!=null&&t.expire!==0n&&(n.uint32(8),n.uint64(t.expire)),t.addrs!=null)for(let i of t.addrs)n.uint32(18),n.bytes(i);t.voucher!=null&&(n.uint32(26),n.bytes(t.voucher)),s.lengthDelimited!==!1&&n.ldelim()},(t,n)=>{let s={expire:0n,addrs:[]},i=n==null?t.len:t.pos+n;for(;t.pos<i;){let o=t.uint32();switch(o>>>3){case 1:s.expire=t.uint64();break;case 2:s.addrs.push(t.bytes());break;case 3:s.voucher=t.bytes();break;default:t.skipType(o&7);break}}return s})),e),r.encode=t=>pe(t,r.codec()),r.decode=t=>de(t,r.codec())})(p2||(p2={}));var ou;(function(r){let e;r.codec=()=>(e==null&&(e=me((t,n,s={})=>{s.lengthDelimited!==!1&&n.fork(),t.duration!=null&&(n.uint32(8),n.uint32(t.duration)),t.data!=null&&(n.uint32(16),n.uint64(t.data)),s.lengthDelimited!==!1&&n.ldelim()},(t,n)=>{let s={},i=n==null?t.len:t.pos+n;for(;t.pos<i;){let o=t.uint32();switch(o>>>3){case 1:s.duration=t.uint32();break;case 2:s.data=t.uint64();break;default:t.skipType(o&7);break}}return s})),e),r.encode=t=>pe(t,r.codec()),r.decode=t=>de(t,r.codec())})(ou||(ou={}));var mr;(function(r){r.UNUSED="UNUSED",r.OK="OK",r.RESERVATION_REFUSED="RESERVATION_REFUSED",r.RESOURCE_LIMIT_EXCEEDED="RESOURCE_LIMIT_EXCEEDED",r.PERMISSION_DENIED="PERMISSION_DENIED",r.CONNECTION_FAILED="CONNECTION_FAILED",r.NO_RESERVATION="NO_RESERVATION",r.MALFORMED_MESSAGE="MALFORMED_MESSAGE",r.UNEXPECTED_MESSAGE="UNEXPECTED_MESSAGE"})(mr||(mr={}));var g7;(function(r){r[r.UNUSED=0]="UNUSED",r[r.OK=100]="OK",r[r.RESERVATION_REFUSED=200]="RESERVATION_REFUSED",r[r.RESOURCE_LIMIT_EXCEEDED=201]="RESOURCE_LIMIT_EXCEEDED",r[r.PERMISSION_DENIED=202]="PERMISSION_DENIED",r[r.CONNECTION_FAILED=203]="CONNECTION_FAILED",r[r.NO_RESERVATION=204]="NO_RESERVATION",r[r.MALFORMED_MESSAGE=400]="MALFORMED_MESSAGE",r[r.UNEXPECTED_MESSAGE=401]="UNEXPECTED_MESSAGE"})(g7||(g7={}));(function(r){r.codec=()=>Pt(g7)})(mr||(mr={}));var y7;(function(r){let e;r.codec=()=>(e==null&&(e=me((t,n,s={})=>{s.lengthDelimited!==!1&&n.fork(),t.relay!=null&&t.relay.byteLength>0&&(n.uint32(10),n.bytes(t.relay)),t.peer!=null&&t.peer.byteLength>0&&(n.uint32(18),n.bytes(t.peer)),t.expiration!=null&&t.expiration!==0n&&(n.uint32(24),n.uint64(t.expiration)),s.lengthDelimited!==!1&&n.ldelim()},(t,n)=>{let s={relay:new Uint8Array(0),peer:new Uint8Array(0),expiration:0n},i=n==null?t.len:t.pos+n;for(;t.pos<i;){let o=t.uint32();switch(o>>>3){case 1:s.relay=t.bytes();break;case 2:s.peer=t.bytes();break;case 3:s.expiration=t.uint64();break;default:t.skipType(o&7);break}}return s})),e),r.encode=t=>pe(t,r.codec()),r.decode=t=>de(t,r.codec())})(y7||(y7={}));var Nse=sL,rL=128,Ose=127,Lse=~Ose,Bse=Math.pow(2,31);function sL(r,e,t){e=e||[],t=t||0;for(var n=t;r>=Bse;)e[t++]=r&255|rL,r/=128;for(;r&Lse;)e[t++]=r&255|rL,r>>>=7;return e[t]=r|0,sL.bytes=t-n+1,e}var Mse=b7,Use=128,nL=127;function b7(r,n){var t=0,n=n||0,s=0,i=n,o,a=r.length;do{if(i>=a)throw b7.bytes=0,new RangeError("Could not decode varint");o=r[i++],t+=s<28?(o&nL)<<s:(o&nL)*Math.pow(2,s),s+=7}while(o>=Use);return b7.bytes=i-n,t}var Fse=Math.pow(2,7),Vse=Math.pow(2,14),zse=Math.pow(2,21),qse=Math.pow(2,28),Kse=Math.pow(2,35),$se=Math.pow(2,42),Hse=Math.pow(2,49),Gse=Math.pow(2,56),Wse=Math.pow(2,63),Yse=function(r){return r<Fse?1:r<Vse?2:r<zse?3:r<qse?4:r<Kse?5:r<$se?6:r<Hse?7:r<Gse?8:r<Wse?9:10},Qse={encode:Nse,decode:Mse,encodingLength:Yse},Xse=Qse,Hh=Xse;var Gh=(r,e=0)=>[Hh.decode(r,e),Hh.decode.bytes],au=(r,e,t=0)=>(Hh.encode(r,e,t),e),cu=r=>Hh.encodingLength(r);var SOe=new Uint8Array(0);var oL=(r,e)=>{if(r===e)return!0;if(r.byteLength!==e.byteLength)return!1;for(let t=0;t<r.byteLength;t++)if(r[t]!==e[t])return!1;return!0},lu=r=>{if(r instanceof Uint8Array&&r.constructor.name==="Uint8Array")return r;if(r instanceof ArrayBuffer)return new Uint8Array(r);if(ArrayBuffer.isView(r))return new Uint8Array(r.buffer,r.byteOffset,r.byteLength);throw new Error("Unknown type, must be binary type")};var Wh=(r,e)=>{let t=e.byteLength,n=cu(r),s=n+cu(t),i=new Uint8Array(s+t);return au(r,i,0),au(t,i,n),i.set(e,s),new uu(r,t,e,i)},aL=r=>{let e=lu(r),[t,n]=Gh(e),[s,i]=Gh(e.subarray(n)),o=e.subarray(n+i);if(o.byteLength!==s)throw new Error("Incorrect length");return new uu(t,s,o,e)},cL=(r,e)=>{if(r===e)return!0;{let t=e;return r.code===t.code&&r.size===t.size&&t.bytes instanceof Uint8Array&&oL(r.bytes,t.bytes)}},uu=class{constructor(e,t,n,s){this.code=e,this.size=t,this.digest=n,this.bytes=s}};function jse(r,e){if(r.length>=255)throw new TypeError("Alphabet too long");for(var t=new Uint8Array(256),n=0;n<t.length;n++)t[n]=255;for(var s=0;s<r.length;s++){var i=r.charAt(s),o=i.charCodeAt(0);if(t[o]!==255)throw new TypeError(i+" is ambiguous");t[o]=s}var a=r.length,c=r.charAt(0),l=Math.log(a)/Math.log(256),u=Math.log(256)/Math.log(a);function f(d){if(d instanceof Uint8Array||(ArrayBuffer.isView(d)?d=new Uint8Array(d.buffer,d.byteOffset,d.byteLength):Array.isArray(d)&&(d=Uint8Array.from(d))),!(d instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(d.length===0)return"";for(var m=0,g=0,y=0,b=d.length;y!==b&&d[y]===0;)y++,m++;for(var w=(b-y)*u+1>>>0,v=new Uint8Array(w);y!==b;){for(var x=d[y],_=0,S=w-1;(x!==0||_<g)&&S!==-1;S--,_++)x+=256*v[S]>>>0,v[S]=x%a>>>0,x=x/a>>>0;if(x!==0)throw new Error("Non-zero carry");g=_,y++}for(var A=w-g;A!==w&&v[A]===0;)A++;for(var D=c.repeat(m);A<w;++A)D+=r.charAt(v[A]);return D}function h(d){if(typeof d!="string")throw new TypeError("Expected String");if(d.length===0)return new Uint8Array;var m=0;if(d[m]!==" "){for(var g=0,y=0;d[m]===c;)g++,m++;for(var b=(d.length-m)*l+1>>>0,w=new Uint8Array(b);d[m];){var v=t[d.charCodeAt(m)];if(v===255)return;for(var x=0,_=b-1;(v!==0||x<y)&&_!==-1;_--,x++)v+=a*w[_]>>>0,w[_]=v%256>>>0,v=v/256>>>0;if(v!==0)throw new Error("Non-zero carry");y=x,m++}if(d[m]!==" "){for(var S=b-y;S!==b&&w[S]===0;)S++;for(var A=new Uint8Array(g+(b-S)),D=g;S!==b;)A[D++]=w[S++];return A}}}function p(d){var m=h(d);if(m)return m;throw new Error(`Non-${e} character`)}return{encode:f,decodeUnsafe:h,decode:p}}var Zse=jse,Jse=Zse,uL=Jse;var w7=class{constructor(e,t,n){this.name=e,this.prefix=t,this.baseEncode=n}encode(e){if(e instanceof Uint8Array)return`${this.prefix}${this.baseEncode(e)}`;throw Error("Unknown type, must be binary type")}},x7=class{constructor(e,t,n){if(this.name=e,this.prefix=t,t.codePointAt(0)===void 0)throw new Error("Invalid prefix character");this.prefixCodePoint=t.codePointAt(0),this.baseDecode=n}decode(e){if(typeof e=="string"){if(e.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(e)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(e.slice(this.prefix.length))}else throw Error("Can only multibase decode strings")}or(e){return fL(this,e)}},E7=class{constructor(e){this.decoders=e}or(e){return fL(this,e)}decode(e){let t=e[0],n=this.decoders[t];if(n)return n.decode(e);throw RangeError(`Unable to decode multibase string ${JSON.stringify(e)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}},fL=(r,e)=>new E7({...r.decoders||{[r.prefix]:r},...e.decoders||{[e.prefix]:e}}),v7=class{constructor(e,t,n,s){this.name=e,this.prefix=t,this.baseEncode=n,this.baseDecode=s,this.encoder=new w7(e,t,n),this.decoder=new x7(e,t,s)}encode(e){return this.encoder.encode(e)}decode(e){return this.decoder.decode(e)}},hL=({name:r,prefix:e,encode:t,decode:n})=>new v7(r,e,t,n),_7=({prefix:r,name:e,alphabet:t})=>{let{encode:n,decode:s}=uL(t,e);return hL({prefix:r,name:e,encode:n,decode:i=>lu(s(i))})},eie=(r,e,t,n)=>{let s={};for(let u=0;u<e.length;++u)s[e[u]]=u;let i=r.length;for(;r[i-1]==="=";)--i;let o=new Uint8Array(i*t/8|0),a=0,c=0,l=0;for(let u=0;u<i;++u){let f=s[r[u]];if(f===void 0)throw new SyntaxError(`Non-${n} character`);c=c<<t|f,a+=t,a>=8&&(a-=8,o[l++]=255&c>>a)}if(a>=t||255&c<<8-a)throw new SyntaxError("Unexpected end of data");return o},tie=(r,e,t)=>{let n=e[e.length-1]==="=",s=(1<<t)-1,i="",o=0,a=0;for(let c=0;c<r.length;++c)for(a=a<<8|r[c],o+=8;o>t;)o-=t,i+=e[s&a>>o];if(o&&(i+=e[s&a<<t-o]),n)for(;i.length*t&7;)i+="=";return i},Zs=({name:r,prefix:e,bitsPerChar:t,alphabet:n})=>hL({prefix:e,name:r,encode(s){return tie(s,n,t)},decode(s){return eie(s,n,t,r)}});var ki=_7({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"}),kOe=_7({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"});var Yh=Zs({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5}),LOe=Zs({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5}),BOe=Zs({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5}),MOe=Zs({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5}),UOe=Zs({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5}),FOe=Zs({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5}),VOe=Zs({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5}),zOe=Zs({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5}),qOe=Zs({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5});var dL=(r,e)=>{let{bytes:t,version:n}=r;switch(n){case 0:return nie(t,S7(r),e||ki.encoder);default:return sie(t,S7(r),e||Yh.encoder)}};var pL=new WeakMap,S7=r=>{let e=pL.get(r);if(e==null){let t=new Map;return pL.set(r,t),t}return e},tr=class{constructor(e,t,n,s){this.code=t,this.version=e,this.multihash=n,this.bytes=s,this["/"]=s}get asCID(){return this}get byteOffset(){return this.bytes.byteOffset}get byteLength(){return this.bytes.byteLength}toV0(){switch(this.version){case 0:return this;case 1:{let{code:e,multihash:t}=this;if(e!==Qh)throw new Error("Cannot convert a non dag-pb CID to CIDv0");if(t.code!==iie)throw new Error("Cannot convert non sha2-256 multihash CID to CIDv0");return tr.createV0(t)}default:throw Error(`Can not convert CID version ${this.version} to version 0. This is a bug please report`)}}toV1(){switch(this.version){case 0:{let{code:e,digest:t}=this.multihash,n=Wh(e,t);return tr.createV1(this.code,n)}case 1:return this;default:throw Error(`Can not convert CID version ${this.version} to version 1. This is a bug please report`)}}equals(e){return tr.equals(this,e)}static equals(e,t){let n=t;return n&&e.code===n.code&&e.version===n.version&&cL(e.multihash,n.multihash)}toString(e){return dL(this,e)}toJSON(){return{"/":dL(this)}}link(){return this}get[Symbol.toStringTag](){return"CID"}[Symbol.for("nodejs.util.inspect.custom")](){return`CID(${this.toString()})`}static asCID(e){if(e==null)return null;let t=e;if(t instanceof tr)return t;if(t["/"]!=null&&t["/"]===t.bytes||t.asCID===t){let{version:n,code:s,multihash:i,bytes:o}=t;return new tr(n,s,i,o||mL(n,s,i.bytes))}else if(t[oie]===!0){let{version:n,multihash:s,code:i}=t,o=aL(s);return tr.create(n,i,o)}else return null}static create(e,t,n){if(typeof t!="number")throw new Error("String codecs are no longer supported");if(!(n.bytes instanceof Uint8Array))throw new Error("Invalid digest");switch(e){case 0:{if(t!==Qh)throw new Error(`Version 0 CID must use dag-pb (code: ${Qh}) block encoding`);return new tr(e,t,n,n.bytes)}case 1:{let s=mL(e,t,n.bytes);return new tr(e,t,n,s)}default:throw new Error("Invalid version")}}static createV0(e){return tr.create(0,Qh,e)}static createV1(e,t){return tr.create(1,e,t)}static decode(e){let[t,n]=tr.decodeFirst(e);if(n.length)throw new Error("Incorrect length");return t}static decodeFirst(e){let t=tr.inspectBytes(e),n=t.size-t.multihashSize,s=lu(e.subarray(n,n+t.multihashSize));if(s.byteLength!==t.multihashSize)throw new Error("Incorrect length");let i=s.subarray(t.multihashSize-t.digestSize),o=new uu(t.multihashCode,t.digestSize,i,s);return[t.version===0?tr.createV0(o):tr.createV1(t.codec,o),e.subarray(t.size)]}static inspectBytes(e){let t=0,n=()=>{let[f,h]=Gh(e.subarray(t));return t+=h,f},s=n(),i=Qh;if(s===18?(s=0,t=0):i=n(),s!==0&&s!==1)throw new RangeError(`Invalid CID version ${s}`);let o=t,a=n(),c=n(),l=t+c,u=l-o;return{version:s,codec:i,multihashCode:a,digestSize:c,multihashSize:u,size:l}}static parse(e,t){let[n,s]=rie(e,t),i=tr.decode(s);if(i.version===0&&e[0]!=="Q")throw Error("Version 0 CID string must not include multibase prefix");return S7(i).set(n,e),i}},rie=(r,e)=>{switch(r[0]){case"Q":{let t=e||ki;return[ki.prefix,t.decode(`${ki.prefix}${r}`)]}case ki.prefix:{let t=e||ki;return[ki.prefix,t.decode(r)]}case Yh.prefix:{let t=e||Yh;return[Yh.prefix,t.decode(r)]}default:{if(e==null)throw Error("To parse non base32 or base58btc encoded CID multibase decoder must be provided");return[r[0],e.decode(r)]}}},nie=(r,e,t)=>{let{prefix:n}=t;if(n!==ki.prefix)throw Error(`Cannot string encode V0 in ${t.name} encoding`);let s=e.get(n);if(s==null){let i=t.encode(r).slice(1);return e.set(n,i),i}else return s},sie=(r,e,t)=>{let{prefix:n}=t,s=e.get(n);if(s==null){let i=t.encode(r);return e.set(n,i),i}else return s},Qh=112,iie=18,mL=(r,e,t)=>{let n=cu(r),s=n+cu(e),i=new Uint8Array(s+t.byteLength);return au(r,i,0),au(e,i,n),i.set(t,s),i},oie=Symbol.for("@ipld/js-cid/CID");var R7=({name:r,code:e,encode:t})=>new A7(r,e,t),A7=class{constructor(e,t,n){this.name=e,this.code=t,this.encode=n}digest(e){if(e instanceof Uint8Array){let t=this.encode(e);return t instanceof Uint8Array?Wh(this.code,t):t.then(n=>Wh(this.code,n))}else throw Error("Unknown type, must be binary type")}};var gL=r=>async e=>new Uint8Array(await crypto.subtle.digest(r,e)),yL=R7({name:"sha2-256",code:18,encode:gL("SHA-256")}),jOe=R7({name:"sha2-512",code:19,encode:gL("SHA-512")});var iLe=C("libp2p:circuit-relay:utils");async function I7(r){let e=new TextEncoder().encode(r),t=await yL.digest(e);return tr.createV0(t)}function T7(r){let e=r*BigInt(1e3),t=new Date().getTime();return Number(e-BigInt(t))}var lie=W(vL(),1);var bLe=C("libp2p:circuit-relay:advert-service");var YLe=C("libp2p:circuit-relay:server");var fie=C("libp2p:stream:converter");function D7(r,e={}){let{stream:t,remoteAddr:n}=r,{sink:s,source:i}=t,o=async function*(){for await(let l of i)l instanceof Uint8Array?yield l:yield*l}(),a={async sink(l){e.signal!=null&&(l=bt(l,e.signal));try{await s(l),await c()}catch(u){u.type!=="aborted"&&fie(u)}},source:e.signal!=null?bt(o,e.signal):o,remoteAddr:n,timeline:{open:Date.now(),close:void 0},async close(){await s(async function*(){yield new Uint8Array(0)}()),await c()}};async function c(){a.timeline.close==null&&(a.timeline.close=Date.now()),await Promise.resolve()}return a}var Vo=C("libp2p:circuit-relay:discover-relays"),m2=class extends $e{peerId;peerStore;contentRouting;registrar;started;topologyId;constructor(e){super(),this.started=!1,this.peerId=e.peerId,this.peerStore=e.peerStore,this.contentRouting=e.contentRouting,this.registrar=e.registrar}isStarted(){return this.started}async start(){this.topologyId=await this.registrar.register(Fo,Fi({onConnect:e=>{this.safeDispatchEvent("relay:discover",{detail:e})}})),this.discover().catch(e=>{Vo.error("error listening on relays",e)}),this.started=!0}stop(){this.topologyId!=null&&this.registrar.unregister(this.topologyId),this.started=!1}async discover(){Vo("searching peer store for relays");let e=await this.peerStore.all({filters:[t=>t.protocols.includes(Fo)],orders:[()=>Math.random()<.5?1:-1]});for(let t of e)Vo("found relay peer %p in content peer store",t.id),this.safeDispatchEvent("relay:discover",{detail:t.id});Vo("found %d relay peers in peer store",e.length);try{Vo("searching content routing for relays");let t=await I7(m7),n=0;for await(let s of this.contentRouting.findProviders(t))if(s.multiaddrs.length>0&&!s.id.equals(this.peerId)){let i=s.id;n++,await this.peerStore.merge(i,{multiaddrs:s.multiaddrs}),Vo("found relay peer %p in content routing",i),this.safeDispatchEvent("relay:discover",{detail:i})}Vo("found %d relay peers in content routing",n)}catch(t){Vo.error("failed when finding relays on the network",t)}}};var SL=C("libp2p:circuit-relay:transport:listener"),C7=class extends $e{connectionManager;relayStore;listeningAddrs;constructor(e){super(),this.connectionManager=e.connectionManager,this.relayStore=e.relayStore,this.listeningAddrs=new Sr,this.relayStore.addEventListener("relay:removed",t=>{this.#e(t.detail)})}async listen(e){SL("listen on %s",e);let t=e.getPeerId(),n;if(t!=null){let i=he(t),o=this.connectionManager.getConnectionsMap().get(i)??[];o.length>0&&(n=o[0])}if(n==null){let i=e.toString().split("/p2p-circuit").find(a=>a!==""),o=fe(i);n=await this.connectionManager.openConnection(o)}if(!this.relayStore.hasReservation(n.remotePeer)){await this.relayStore.addRelay(n.remotePeer,"configured");return}let s=this.relayStore.getReservation(n.remotePeer);if(s==null)throw new E("Did not have reservation after making reservation","ERR_NO_RESERVATION");if(this.listeningAddrs.has(n.remotePeer)){SL("already listening on relay %p",n.remotePeer);return}this.listeningAddrs.set(n.remotePeer,s.addrs.map(i=>fe(i).encapsulate("/p2p-circuit"))),this.safeDispatchEvent("listening",{})}getAddrs(){return[...this.listeningAddrs.values()].flat()}async close(){}#e(e){let t=this.listeningAddrs.has(e);this.listeningAddrs.delete(e),t&&this.safeDispatchEvent("close",{})}};function AL(r){return new C7(r)}var zr=C("libp2p:circuit-relay:transport:reservation-store"),die=60*1e3*10,pie=60*1e3*5,mie=30*1e3,g2=class extends $e{peerId;connectionManager;transportManager;peerStore;events;reserveQueue;reservations;maxDiscoveredRelays;maxReservationQueueLength;started;constructor(e,t){super(),this.peerId=e.peerId,this.connectionManager=e.connectionManager,this.transportManager=e.transportManager,this.peerStore=e.peerStore,this.events=e.events,this.reservations=new Sr,this.maxDiscoveredRelays=t?.discoverRelays??0,this.maxReservationQueueLength=t?.maxReservationQueueLength??100,this.started=!1,this.reserveQueue=new fl({concurrency:t?.reservationConcurrency??1}),this.events.addEventListener("peer:disconnect",n=>{this.#t(n.detail)})}isStarted(){return this.started}async start(){this.started=!0}async stop(){this.reservations.forEach(({timeout:e})=>{clearTimeout(e)}),this.reservations.clear(),this.started=!0}async addRelay(e,t){if(this.peerId.equals(e)){zr("not trying to use self as relay");return}if(this.reserveQueue.size>this.maxReservationQueueLength){zr("not adding relay as the queue is full");return}if(this.reserveQueue.hasJob(e)){zr("relay peer is already in the reservation queue");return}zr("add relay %p",e),await this.reserveQueue.add(async()=>{try{let n=this.reservations.get(e);if(n!=null){if(T7(n.reservation.expire)>die){zr("already have reservation on relay peer %p and it expires in more than 10 minutes",e);return}clearTimeout(n.timeout),this.reservations.delete(e)}if(t==="discovered"&&[...this.reservations.values()].reduce((l,u)=>(u.type==="discovered"&&l++,l),0)>=this.maxDiscoveredRelays){zr("already have enough discovered relays");return}let s=await this.connectionManager.openConnection(e);if(s.remoteAddr.protoNames().includes("p2p-circuit")){zr("not creating reservation over relayed connection");return}let i=await this.#e(s);zr("created reservation on relay peer %p",e);let o=T7(i.expire),a=Math.min(Math.max(o-pie,mie),Math.pow(2,31)-1),c=setTimeout(()=>{this.addRelay(e,t).catch(l=>{zr.error("could not refresh reservation to relay %p",e,l)})},a);this.reservations.set(e,{timeout:c,reservation:i,type:t}),await this.peerStore.merge(e,{tags:{[eL]:{value:1,ttl:o}}}),await this.transportManager.listen([fe(`/p2p/${e.toString()}/p2p-circuit`)])}catch(n){zr.error("could not reserve slot on %p",e,n),this.reservations.delete(e)}},{peerId:e})}hasReservation(e){return this.reservations.has(e)}getReservation(e){return this.reservations.get(e)?.reservation}async#e(e){zr("requesting reservation from %s",e.remotePeer);let t=await e.newStream(Fo),s=jr(t).pb(Pi);s.write({type:Pi.Type.RESERVE});let i;try{i=await s.read()}catch(a){throw zr.error("error parsing reserve message response from %p because",e.remotePeer,a),a}finally{t.close()}if(i.status===mr.OK&&i.reservation!=null)return i.reservation;let o=`reservation failed with status ${i.status??"undefined"}`;throw zr.error(o),new Error(o)}#t(e){let t=this.reservations.get(e);t!=null&&(zr("connection to relay %p closed, removing reservation from local store",e),clearTimeout(t.timeout),this.reservations.delete(e),this.safeDispatchEvent("relay:removed",{detail:e}),this.reservations.size<this.maxDiscoveredRelays&&(zr("not enough relays %d/%d",this.reservations.size,this.maxDiscoveredRelays),this.safeDispatchEvent("relay:not-enough-relays",{})))}};var tn=C("libp2p:circuit-relay:transport"),gie=r=>{if(r.peer==null)return!1;try{r.peer.addrs.forEach(fe)}catch{return!1}return!0},RL={maxInboundStopStreams:300,maxOutboundStopStreams:300},P7=class{discovery;registrar;peerStore;connectionManager;peerId;upgrader;addressManager;connectionGater;reservationStore;maxInboundStopStreams;maxOutboundStopStreams;started;constructor(e,t){this.registrar=e.registrar,this.peerStore=e.peerStore,this.connectionManager=e.connectionManager,this.peerId=e.peerId,this.upgrader=e.upgrader,this.addressManager=e.addressManager,this.connectionGater=e.connectionGater,this.maxInboundStopStreams=t.maxInboundStopStreams??RL.maxInboundStopStreams,this.maxOutboundStopStreams=t.maxOutboundStopStreams??RL.maxOutboundStopStreams,t.discoverRelays!=null&&t.discoverRelays>0&&(this.discovery=new m2(e),this.discovery.addEventListener("relay:discover",n=>{this.reservationStore.addRelay(n.detail,"discovered").catch(s=>{tn.error("could not add discovered relay %p",n.detail,s)})})),this.reservationStore=new g2(e,t),this.reservationStore.addEventListener("relay:not-enough-relays",()=>{this.discovery?.discover().catch(n=>{tn.error("could not discover relays",n)})}),this.started=!1}isStarted(){return this.started}async start(){await this.reservationStore.start(),await this.discovery?.start(),await this.registrar.handle(d2,e=>{this.onStop(e).catch(t=>{tn.error(t)})},{maxInboundStreams:this.maxInboundStopStreams,maxOutboundStreams:this.maxOutboundStopStreams}),this.started=!0}async stop(){this.discovery?.stop(),await this.reservationStore.stop(),await this.registrar.unhandle(d2),this.started=!1}[qs]=!0;[Symbol.toStringTag]="libp2p/circuit-relay-v2";async dial(e,t={}){if(e.protoCodes().filter(d=>d===290).length!==1){let d="Invalid circuit relay address";throw tn.error(d,e),new E(d,z.ERR_RELAYED_DIAL)}let n=e.toString().split("/p2p-circuit"),s=fe(n[0]),i=fe(n[n.length-1]),o=s.getPeerId(),a=i.getPeerId();if(o==null||a==null){let d=`Circuit relay dial to ${e.toString()} failed as address did not have peer ids`;throw tn.error(d),new E(d,z.ERR_RELAYED_DIAL)}let c=he(o),l=he(a),u=!1,h=this.connectionManager.getConnections(c)[0];h==null&&(await this.peerStore.merge(c,{multiaddrs:[s]}),h=await this.connectionManager.openConnection(c,t),u=!0);let p;try{return p=await h.newStream([Fo]),await this.connectV2({stream:p,connection:h,destinationPeer:l,destinationAddr:i,relayAddr:s,ma:e,disconnectOnFailure:u})}catch(d){throw tn.error(`Circuit relay dial to destination ${l.toString()} via relay ${c.toString()} failed`,d),p?.abort(d),u&&await h.close(),d}}async connectV2({stream:e,connection:t,destinationPeer:n,destinationAddr:s,relayAddr:i,ma:o,disconnectOnFailure:a}){try{let c=jr(e),l=c.pb(Pi);l.write({type:Pi.Type.CONNECT,peer:{id:n.toBytes(),addrs:[fe(s).bytes]}});let u=await l.read();if(u.status!==mr.OK)throw new E(`failed to connect via relay with status ${u?.status?.toString()??"undefined"}`,z.ERR_HOP_REQUEST_FAILED);let f=D7({stream:c.unwrap(),remoteAddr:o,localAddr:i.encapsulate(`/p2p-circuit/p2p/${this.peerId.toString()}`)});return tn("new outbound connection %s",f.remoteAddr),await this.upgrader.upgradeOutbound(f)}catch(c){throw tn.error(`Circuit relay dial to destination ${n.toString()} via relay ${t.remotePeer.toString()} failed`,c),a&&await t.close(),c}}createListener(e){return AL({connectionManager:this.connectionManager,relayStore:this.reservationStore})}filter(e){return e=Array.isArray(e)?e:[e],e.filter(t=>gs.matches(t))}async onStop({connection:e,stream:t}){let n=jr(t),s=await n.readPB(xs);if(tn("received circuit v2 stop protocol request from %s",e.remotePeer),s?.type===void 0)return;let i=n.pb(xs);if(tn("new circuit relay v2 stop stream from %s",e.remotePeer),s.type!==xs.Type.CONNECT){tn.error("invalid stop connect request via peer %s",e.remotePeer),i.write({type:xs.Type.STATUS,status:mr.UNEXPECTED_MESSAGE});return}if(!gie(s)){tn.error("invalid stop connect request via peer %s",e.remotePeer),i.write({type:xs.Type.STATUS,status:mr.MALFORMED_MESSAGE});return}let o=_t(s.peer.id);if(await this.connectionGater.denyInboundRelayedConnection?.(e.remotePeer,o)===!0){i.write({type:xs.Type.STATUS,status:mr.PERMISSION_DENIED});return}i.write({type:xs.Type.STATUS,status:mr.OK});let a=e.remoteAddr.encapsulate(`/p2p-circuit/p2p/${o.toString()}`),c=this.addressManager.getAddresses()[0],l=D7({stream:n.unwrap(),remoteAddr:a,localAddr:c});tn("new inbound connection %s",l.remoteAddr),await this.upgrader.upgradeInbound(l),tn("%s connection %s upgraded","inbound",l.remoteAddr)}};function k7(r={}){return e=>new P7(e,r)}var IL="0.45.9";var N7=`js-libp2p/${IL}`;var TL="0.1.0",DL="id",CL="id/push",PL="1.0.0",kL="1.0.0";var y2=W(fn(),1);var zo;(function(r){let e;r.codec=()=>(e==null&&(e=me((t,n,s={})=>{if(s.lengthDelimited!==!1&&n.fork(),t.protocolVersion!=null&&(n.uint32(42),n.string(t.protocolVersion)),t.agentVersion!=null&&(n.uint32(50),n.string(t.agentVersion)),t.publicKey!=null&&(n.uint32(10),n.bytes(t.publicKey)),t.listenAddrs!=null)for(let i of t.listenAddrs)n.uint32(18),n.bytes(i);if(t.observedAddr!=null&&(n.uint32(34),n.bytes(t.observedAddr)),t.protocols!=null)for(let i of t.protocols)n.uint32(26),n.string(i);t.signedPeerRecord!=null&&(n.uint32(66),n.bytes(t.signedPeerRecord)),s.lengthDelimited!==!1&&n.ldelim()},(t,n)=>{let s={listenAddrs:[],protocols:[]},i=n==null?t.len:t.pos+n;for(;t.pos<i;){let o=t.uint32();switch(o>>>3){case 5:s.protocolVersion=t.string();break;case 6:s.agentVersion=t.string();break;case 1:s.publicKey=t.bytes();break;case 2:s.listenAddrs.push(t.bytes());break;case 4:s.observedAddr=t.bytes();break;case 3:s.protocols.push(t.string());break;case 8:s.signedPeerRecord=t.bytes();break;default:t.skipType(o&7);break}}return s})),e),r.encode=t=>pe(t,r.codec()),r.decode=t=>de(t,r.codec())})(zo||(zo={}));var qr=C("libp2p:identify"),NL=1024*8,Es={protocolPrefix:"ipfs",agentVersion:N7,timeout:6e4,maxInboundStreams:1,maxOutboundStreams:1,maxPushIncomingStreams:1,maxPushOutgoingStreams:1,maxObservedAddresses:10,maxIdentifyMessageSize:8192},b2=class{identifyProtocolStr;identifyPushProtocolStr;host;started;timeout;peerId;peerStore;registrar;connectionManager;addressManager;maxInboundStreams;maxOutboundStreams;maxPushIncomingStreams;maxPushOutgoingStreams;maxIdentifyMessageSize;maxObservedAddresses;events;constructor(e,t){this.started=!1,this.peerId=e.peerId,this.peerStore=e.peerStore,this.registrar=e.registrar,this.addressManager=e.addressManager,this.connectionManager=e.connectionManager,this.events=e.events,this.identifyProtocolStr=`/${t.protocolPrefix??Es.protocolPrefix}/${DL}/${PL}`,this.identifyPushProtocolStr=`/${t.protocolPrefix??Es.protocolPrefix}/${CL}/${kL}`,this.timeout=t.timeout??Es.timeout,this.maxInboundStreams=t.maxInboundStreams??Es.maxInboundStreams,this.maxOutboundStreams=t.maxOutboundStreams??Es.maxOutboundStreams,this.maxPushIncomingStreams=t.maxPushIncomingStreams??Es.maxPushIncomingStreams,this.maxPushOutgoingStreams=t.maxPushOutgoingStreams??Es.maxPushOutgoingStreams,this.maxIdentifyMessageSize=t.maxIdentifyMessageSize??Es.maxIdentifyMessageSize,this.maxObservedAddresses=t.maxObservedAddresses??Es.maxObservedAddresses,this.host={protocolVersion:`${t.protocolPrefix??Es.protocolPrefix}/${TL}`,agentVersion:t.agentVersion??Es.agentVersion},e.events.addEventListener("connection:open",n=>{let s=n.detail;this.identify(s).catch(i=>{qr.error("error during identify trigged by connection:open",i)})}),e.events.addEventListener("self:peer:update",n=>{this.push().catch(s=>{qr.error(s)})}),this.host.agentVersion===N7&&(nO||tO?this.host.agentVersion+=` UserAgent=${globalThis.process.version}`:(l2||u2||rO||sO)&&(this.host.agentVersion+=` UserAgent=${globalThis.navigator.userAgent}`))}isStarted(){return this.started}async start(){this.started||(await this.peerStore.merge(this.peerId,{metadata:{AgentVersion:$(this.host.agentVersion),ProtocolVersion:$(this.host.protocolVersion)}}),await this.registrar.handle(this.identifyProtocolStr,e=>{this._handleIdentify(e).catch(t=>{qr.error(t)})},{maxInboundStreams:this.maxInboundStreams,maxOutboundStreams:this.maxOutboundStreams}),await this.registrar.handle(this.identifyPushProtocolStr,e=>{this._handlePush(e).catch(t=>{qr.error(t)})},{maxInboundStreams:this.maxPushIncomingStreams,maxOutboundStreams:this.maxPushOutgoingStreams}),this.started=!0)}async stop(){await this.registrar.unhandle(this.identifyProtocolStr),await this.registrar.unhandle(this.identifyPushProtocolStr),this.started=!1}async pushToConnections(e){let t=this.addressManager.getAddresses().map(u=>u.decapsulateCode(se("p2p").code)),n=new Rr({peerId:this.peerId,multiaddrs:t}),s=await Lr.seal(n,this.peerId),i=this.registrar.getProtocols(),o=await this.peerStore.get(this.peerId),a=M(o.metadata.get("AgentVersion")??$(this.host.agentVersion)),c=M(o.metadata.get("ProtocolVersion")??$(this.host.protocolVersion)),l=e.map(async u=>{let f,h=AbortSignal.timeout(this.timeout);try{(0,y2.setMaxListeners)?.(1/0,h)}catch{}try{f=await u.newStream([this.identifyPushProtocolStr],{signal:h}),await Er(f,h).sink(Re([zo.encode({listenAddrs:t.map(d=>d.bytes),signedPeerRecord:s.marshal(),protocols:i,agentVersion:a,protocolVersion:c})],d=>wt(d)))}catch(p){qr.error("could not push identify update to peer",p)}finally{f?.close()}});await Promise.all(l)}async push(){if(!this.isStarted())return;let e=[];await Promise.all(this.connectionManager.getConnections().map(async t=>{try{if(!(await this.peerStore.get(t.remotePeer)).protocols.includes(this.identifyPushProtocolStr))return;e.push(t)}catch(n){if(n.code!==z.ERR_NOT_FOUND)throw n}})),await this.pushToConnections(e)}async _identify(e,t={}){let n,s=ot([AbortSignal.timeout(this.timeout),t?.signal]);try{(0,y2.setMaxListeners)?.(1/0,s)}catch{}try{n=await e.newStream([this.identifyProtocolStr],{signal:s});let i=Er(n,s),o=await Re([],i,a=>kt(a,{maxDataLength:this.maxIdentifyMessageSize??NL}),async a=>fs(a));if(o==null)throw new E("No data could be retrieved",z.ERR_CONNECTION_ENDED);try{return zo.decode(o)}catch(a){throw new E(String(a),z.ERR_INVALID_MESSAGE)}}finally{n?.close(),s.clear()}}async identify(e,t={}){let n=await this._identify(e,t),{publicKey:s,protocols:i,observedAddr:o}=n;if(s==null)throw new E("public key was missing from identify message",z.ERR_MISSING_PUBLIC_KEY);let a=await _r(s);if(!e.remotePeer.equals(a))throw new E("identified peer does not match the expected peer",z.ERR_INVALID_PEER);if(this.peerId.equals(a))throw new E("identified peer is our own peer id?",z.ERR_INVALID_PEER);let c=yie(o);qr("identify completed for peer %p and protocols %o",a,i),qr("our observed address is %s",c),c!=null&&this.addressManager.getObservedAddrs().length<(this.maxObservedAddresses??1/0)&&(qr("storing our observed address %s",c?.toString()),this.addressManager.addObservedAddr(c));let l=await this.#e(e.remotePeer,n),u={peerId:a,protocolVersion:n.protocolVersion,agentVersion:n.agentVersion,publicKey:n.publicKey,listenAddrs:n.listenAddrs.map(f=>fe(f)),observedAddr:n.observedAddr==null?void 0:fe(n.observedAddr),protocols:n.protocols,signedPeerRecord:l};this.events.safeDispatchEvent("peer:identify",{detail:u})}async _handleIdentify(e){let{connection:t,stream:n}=e,s=AbortSignal.timeout(this.timeout);try{(0,y2.setMaxListeners)?.(1/0,s)}catch{}try{let i=this.peerId.publicKey??new Uint8Array(0),o=await this.peerStore.get(this.peerId),a=this.addressManager.getAddresses().map(h=>h.decapsulateCode(se("p2p").code)),c=o.peerRecordEnvelope;if(a.length>0&&c==null){let h=new Rr({peerId:this.peerId,multiaddrs:a});c=(await Lr.seal(h,this.peerId)).marshal().subarray()}let l=zo.encode({protocolVersion:this.host.protocolVersion,agentVersion:this.host.agentVersion,publicKey:i,listenAddrs:a.map(h=>h.bytes),signedPeerRecord:c,observedAddr:t.remoteAddr.bytes,protocols:o.protocols}),u=Er(n,s),f=Re([l],h=>wt(h));await u.sink(f)}catch(i){qr.error("could not respond to identify request",i)}finally{n.close()}}async _handlePush(e){let{connection:t,stream:n}=e;try{if(this.peerId.equals(t.remotePeer))throw new Error("received push from ourselves?");let s=Er(n,AbortSignal.timeout(this.timeout)),o=await jr(s,{maxDataLength:this.maxIdentifyMessageSize??NL}).readPB(zo);await this.#e(t.remotePeer,o)}catch(s){qr.error("received invalid message",s);return}finally{n.close()}qr("handled push from %p",t.remotePeer)}async#e(e,t){if(qr("received identify from %p",e),t==null)throw new Error("Message was null or undefined");let n={addresses:t.listenAddrs.map(i=>({isCertified:!1,multiaddr:fe(i)})),protocols:t.protocols,metadata:new Map,peerRecordEnvelope:t.signedPeerRecord},s;if(t.signedPeerRecord!=null){qr("received signedPeerRecord in push from %p",e);let i=t.signedPeerRecord,o=await Lr.openAndCertify(i,Rr.DOMAIN),a=Rr.createFromProtobuf(o.payload);if(!a.peerId.equals(o.peerId))throw new Error("signing key does not match PeerId in the PeerRecord");if(!e.equals(a.peerId))throw new Error("signing key does not match remote PeerId");let c;try{c=await this.peerStore.get(a.peerId)}catch(l){if(l.code!=="ERR_NOT_FOUND")throw l}if(c!=null&&(n.metadata=c.metadata,c.peerRecordEnvelope!=null)){let l=await Lr.createFromProtobuf(c.peerRecordEnvelope),u=Rr.createFromProtobuf(l.payload);u.seqNumber>=a.seqNumber&&(qr("sequence number was lower or equal to existing sequence number - stored: %d received: %d",u.seqNumber,a.seqNumber),a=u,i=c.peerRecordEnvelope)}n.peerRecordEnvelope=i,n.addresses=a.multiaddrs.map(l=>({isCertified:!0,multiaddr:l})),s={seq:a.seqNumber,addresses:a.multiaddrs}}else qr("%p did not send a signed peer record",e);return t.agentVersion!=null&&n.metadata.set("AgentVersion",$(t.agentVersion)),t.protocolVersion!=null&&n.metadata.set("ProtocolVersion",$(t.protocolVersion)),await this.peerStore.patch(e,n),s}};function yie(r){if(r!=null&&r.length>0)try{return fe(r)}catch{}}function OL(r={}){return e=>new b2(e,r)}var LL={list:["/dnsaddr/bootstrap.libp2p.io/p2p/QmNnooDu7bfjPFoTZYxMNLWUQJyrVwtbZg5gBMjTezGAJN","/dnsaddr/bootstrap.libp2p.io/p2p/QmQCU2EcMqAqQPR2i9bChDtGNJchTbq5TbXJJ16u19uLTa","/dnsaddr/bootstrap.libp2p.io/p2p/QmbLHAnMoJPWSCR5Zhtx6BHJX9KiKNN6tpvbUcqanj75Nb","/dnsaddr/bootstrap.libp2p.io/p2p/QmcZf59bWwK5XFi76CZX8cbJ4BhTzzA3gU1ZjYZcYW3dwt","/ip4/104.131.131.82/tcp/4001/p2p/QmaCpDMGvV2BGHeYERUEnRQAwe3N8SzbUtfsmvsqQLuvuJ"]};function BL(){return{addresses:{listen:["/webrtc"]},transports:[TN(),IN(),LO(),pO(),k7({discoverRelays:1})],connectionEncryption:[Il()],streamMuxers:[ZD(),dP()],peerDiscovery:[uC(LL)],contentRouters:[yC("https://cid.contact")],services:{identify:OL(),autoNAT:JO(),pubsub:zT(),dht:rP({clientMode:!0,validators:{ipns:QO},selectors:{ipns:YO}})}}}async function ML(r,e){let t=BL();return e=e??{},RI({datastore:r,...t,...e,start:!1})}var O7="1.3.10",w2="helia";var bie=C("helia");async function wie(r={}){let e=r.datastore??new Wo,t=r.blockstore??new yu,n;xie(r.libp2p)?n=r.libp2p:n=await ML(e,r.libp2p);let s=new id({...r,datastore:e,blockstore:t,libp2p:n});return r.start!==!1&&await s.start(),s.libp2p.isStarted()?await UL(s):s.libp2p.addEventListener("start",()=>{UL(s).catch(i=>{bie.error("could not add Helia to agent version",i)})}),s}function xie(r){return r==null?!1:["dial","dialProtocol","hangUp","handle","unhandle","getMultiaddrs","getProtocols"].every(t=>typeof r[t]=="function")}async function UL(r){let t=(await r.libp2p.peerStore.get(r.libp2p.peerId)).metadata.get("AgentVersion");if(t==null)return;let n=new TextDecoder().decode(t);n.match(/js-libp2p\/\d+\.\d+\.\d+\sUserAgent=/)!=null&&(n.includes(w2)?n=`${w2}/${O7} ${n.split(" ").slice(1).join(" ")}`:n=`${w2}/${O7} ${n}`,await r.libp2p.peerStore.merge(r.libp2p.peerId,{metadata:{AgentVersion:new TextEncoder().encode(n)}}))}return Zh(Eie);})();
/*! Bundled license information:

@noble/ed25519/lib/esm/index.js:
  (*! noble-ed25519 - MIT License (c) 2019 Paul Miller (paulmillr.com) *)

@noble/secp256k1/lib/esm/index.js:
  (*! noble-secp256k1 - MIT License (c) 2019 Paul Miller (paulmillr.com) *)

@noble/ciphers/esm/utils.js:
  (*! noble-ciphers - MIT License (c) 2023 Paul Miller (paulmillr.com) *)

@noble/hashes/esm/utils.js:
  (*! noble-hashes - MIT License (c) 2022 Paul Miller (paulmillr.com) *)

@noble/curves/esm/abstract/utils.js:
  (*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) *)

@noble/curves/esm/abstract/modular.js:
  (*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) *)

@noble/curves/esm/abstract/curve.js:
  (*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) *)

@noble/curves/esm/abstract/edwards.js:
  (*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) *)

@noble/curves/esm/abstract/montgomery.js:
  (*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) *)

@noble/curves/esm/ed25519.js:
  (*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) *)

@libp2p/webtransport/dist/src/index.js:
  (*! TODO unclear how to add backpressure here? *)
*/
return Helia}));
