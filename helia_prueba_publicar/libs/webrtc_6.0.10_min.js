(function (root, factory) {(typeof module === 'object' && module.exports) ? module.exports = factory() : root.Libp2PWebrtc = factory()}(typeof self !== 'undefined' ? self : this, function () {
"use strict";var Libp2PWebrtc=(()=>{var iS=Object.create;var Qu=Object.defineProperty;var sS=Object.getOwnPropertyDescriptor;var aS=Object.getOwnPropertyNames;var cS=Object.getPrototypeOf,uS=Object.prototype.hasOwnProperty;var op=(r,e)=>()=>(e||r((e={exports:{}}).exports,e),e.exports),At=(r,e)=>{for(var t in e)Qu(r,t,{get:e[t],enumerable:!0})},Xg=(r,e,t,n)=>{if(e&&typeof e=="object"||typeof e=="function")for(let o of aS(e))!uS.call(r,o)&&o!==t&&Qu(r,o,{get:()=>e[o],enumerable:!(n=sS(e,o))||n.enumerable});return r};var Rr=(r,e,t)=>(t=r!=null?iS(cS(r)):{},Xg(e||!r||!r.__esModule?Qu(t,"default",{value:r,enumerable:!0}):t,r)),lS=r=>Xg(Qu({},"__esModule",{value:!0}),r);var rx=op(()=>{var tx;(function(r){(function(e){var t=typeof globalThis=="object"||typeof globalThis=="object"?globalThis:typeof self=="object"?self:typeof this=="object"?this:a(),n=o(r);typeof t.Reflect<"u"&&(n=o(t.Reflect,n)),e(n,t),typeof t.Reflect>"u"&&(t.Reflect=r);function o(c,f){return function(p,h){Object.defineProperty(c,p,{configurable:!0,writable:!0,value:h}),f&&f(p,h)}}function i(){try{return Function("return this;")()}catch{}}function s(){try{return(0,eval)("(function() { return this; })()")}catch{}}function a(){return i()||s()}})(function(e,t){var n=Object.prototype.hasOwnProperty,o=typeof Symbol=="function",i=o&&typeof Symbol.toPrimitive<"u"?Symbol.toPrimitive:"@@toPrimitive",s=o&&typeof Symbol.iterator<"u"?Symbol.iterator:"@@iterator",a=typeof Object.create=="function",c={__proto__:[]}instanceof Array,f=!a&&!c,p={create:a?function(){return np(Object.create(null))}:c?function(){return np({__proto__:null})}:function(){return np({})},has:f?function(w,E){return n.call(w,E)}:function(w,E){return E in w},get:f?function(w,E){return n.call(w,E)?w[E]:void 0}:function(w,E){return w[E]}},h=Object.getPrototypeOf(Function),y=typeof Map=="function"&&typeof Map.prototype.entries=="function"?Map:eS(),b=typeof Set=="function"&&typeof Set.prototype.entries=="function"?Set:tS(),g=typeof WeakMap=="function"?WeakMap:rS(),C=o?Symbol.for("@reflect-metadata:registry"):void 0,m=YA(),S=JA(m);function N(w,E,P,$){if(O(P)){if(!nn(w))throw new TypeError;if(!jn(E))throw new TypeError;return V(w,E)}else{if(!nn(w))throw new TypeError;if(!ee(E))throw new TypeError;if(!ee($)&&!O($)&&!pe($))throw new TypeError;return pe($)&&($=void 0),P=Ie(P),B(w,E,P,$)}}e("decorate",N);function I(w,E){function P($,se){if(!ee($))throw new TypeError;if(!O(se)&&!Ju(se))throw new TypeError;L(w,E,$,se)}return P}e("metadata",I);function K(w,E,P,$){if(!ee(P))throw new TypeError;return O($)||($=Ie($)),L(w,E,P,$)}e("defineMetadata",K);function Z(w,E,P){if(!ee(E))throw new TypeError;return O(P)||(P=Ie(P)),A(w,E,P)}e("hasMetadata",Z);function q(w,E,P){if(!ee(E))throw new TypeError;return O(P)||(P=Ie(P)),v(w,E,P)}e("hasOwnMetadata",q);function re(w,E,P){if(!ee(E))throw new TypeError;return O(P)||(P=Ie(P)),D(w,E,P)}e("getMetadata",re);function R(w,E,P){if(!ee(E))throw new TypeError;return O(P)||(P=Ie(P)),U(w,E,P)}e("getOwnMetadata",R);function k(w,E){if(!ee(w))throw new TypeError;return O(E)||(E=Ie(E)),T(w,E)}e("getMetadataKeys",k);function G(w,E){if(!ee(w))throw new TypeError;return O(E)||(E=Ie(E)),M(w,E)}e("getOwnMetadataKeys",G);function Y(w,E,P){if(!ee(E))throw new TypeError;if(O(P)||(P=Ie(P)),!ee(E))throw new TypeError;O(P)||(P=Ie(P));var $=Sa(E,P,!1);return O($)?!1:$.OrdinaryDeleteMetadata(w,E,P)}e("deleteMetadata",Y);function V(w,E){for(var P=w.length-1;P>=0;--P){var $=w[P],se=$(E);if(!O(se)&&!pe(se)){if(!jn(se))throw new TypeError;E=se}}return E}function B(w,E,P,$){for(var se=w.length-1;se>=0;--se){var Xe=w[se],tt=Xe(E,P,$);if(!O(tt)&&!pe(tt)){if(!ee(tt))throw new TypeError;$=tt}}return $}function A(w,E,P){var $=v(w,E,P);if($)return!0;var se=rp(E);return pe(se)?!1:A(w,se,P)}function v(w,E,P){var $=Sa(E,P,!1);return O($)?!1:Ke($.OrdinaryHasOwnMetadata(w,E,P))}function D(w,E,P){var $=v(w,E,P);if($)return U(w,E,P);var se=rp(E);if(!pe(se))return D(w,se,P)}function U(w,E,P){var $=Sa(E,P,!1);if(!O($))return $.OrdinaryGetOwnMetadata(w,E,P)}function L(w,E,P,$){var se=Sa(P,$,!0);se.OrdinaryDefineOwnMetadata(w,E,P,$)}function T(w,E){var P=M(w,E),$=rp(w);if($===null)return P;var se=T($,E);if(se.length<=0)return P;if(P.length<=0)return se;for(var Xe=new b,tt=[],we=0,z=P;we<z.length;we++){var J=z[we],te=Xe.has(J);te||(Xe.add(J),tt.push(J))}for(var ne=0,ve=se;ne<ve.length;ne++){var J=ve[ne],te=Xe.has(J);te||(Xe.add(J),tt.push(J))}return tt}function M(w,E){var P=Sa(w,E,!1);return P?P.OrdinaryOwnMetadataKeys(w,E):[]}function W(w){if(w===null)return 1;switch(typeof w){case"undefined":return 0;case"boolean":return 2;case"string":return 3;case"symbol":return 4;case"number":return 5;case"object":return w===null?1:6;default:return 6}}function O(w){return w===void 0}function pe(w){return w===null}function be(w){return typeof w=="symbol"}function ee(w){return typeof w=="object"?w!==null:typeof w=="function"}function Ae(w,E){switch(W(w)){case 0:return w;case 1:return w;case 2:return w;case 3:return w;case 4:return w;case 5:return w}var P=E===3?"string":E===5?"number":"default",$=Aa(w,i);if($!==void 0){var se=$.call(w,P);if(ee(se))throw new TypeError;return se}return Be(w,P==="default"?"number":P)}function Be(w,E){if(E==="string"){var P=w.toString;if(pr(P)){var $=P.call(w);if(!ee($))return $}var se=w.valueOf;if(pr(se)){var $=se.call(w);if(!ee($))return $}}else{var se=w.valueOf;if(pr(se)){var $=se.call(w);if(!ee($))return $}var Xe=w.toString;if(pr(Xe)){var $=Xe.call(w);if(!ee($))return $}}throw new TypeError}function Ke(w){return!!w}function Ee(w){return""+w}function Ie(w){var E=Ae(w,3);return be(E)?E:Ee(E)}function nn(w){return Array.isArray?Array.isArray(w):w instanceof Object?w instanceof Array:Object.prototype.toString.call(w)==="[object Array]"}function pr(w){return typeof w=="function"}function jn(w){return typeof w=="function"}function Ju(w){switch(W(w)){case 3:return!0;case 4:return!0;default:return!1}}function zi(w,E){return w===E||w!==w&&E!==E}function Aa(w,E){var P=w[E];if(P!=null){if(!pr(P))throw new TypeError;return P}}function Fg(w){var E=Aa(w,s);if(!pr(E))throw new TypeError;var P=E.call(w);if(!ee(P))throw new TypeError;return P}function Wg(w){return w.value}function qg(w){var E=w.next();return E.done?!1:E}function Gg(w){var E=w.return;E&&E.call(w)}function rp(w){var E=Object.getPrototypeOf(w);if(typeof w!="function"||w===h||E!==h)return E;var P=w.prototype,$=P&&Object.getPrototypeOf(P);if($==null||$===Object.prototype)return E;var se=$.constructor;return typeof se!="function"||se===w?E:se}function ZA(){var w;!O(C)&&typeof t.Reflect<"u"&&!(C in t.Reflect)&&typeof t.Reflect.defineMetadata=="function"&&(w=QA(t.Reflect));var E,P,$,se=new g,Xe={registerProvider:tt,getProvider:z,setProvider:te};return Xe;function tt(ne){if(!Object.isExtensible(Xe))throw new Error("Cannot add provider to a frozen registry.");switch(!0){case w===ne:break;case O(E):E=ne;break;case E===ne:break;case O(P):P=ne;break;case P===ne:break;default:$===void 0&&($=new b),$.add(ne);break}}function we(ne,ve){if(!O(E)){if(E.isProviderFor(ne,ve))return E;if(!O(P)){if(P.isProviderFor(ne,ve))return E;if(!O($))for(var Re=Fg($);;){var Ze=qg(Re);if(!Ze)return;var dr=Wg(Ze);if(dr.isProviderFor(ne,ve))return Gg(Re),dr}}}if(!O(w)&&w.isProviderFor(ne,ve))return w}function z(ne,ve){var Re=se.get(ne),Ze;return O(Re)||(Ze=Re.get(ve)),O(Ze)&&(Ze=we(ne,ve),O(Ze)||(O(Re)&&(Re=new y,se.set(ne,Re)),Re.set(ve,Ze))),Ze}function J(ne){if(O(ne))throw new TypeError;return E===ne||P===ne||!O($)&&$.has(ne)}function te(ne,ve,Re){if(!J(Re))throw new Error("Metadata provider not registered.");var Ze=z(ne,ve);if(Ze!==Re){if(!O(Ze))return!1;var dr=se.get(ne);O(dr)&&(dr=new y,se.set(ne,dr)),dr.set(ve,Re)}return!0}}function YA(){var w;return!O(C)&&ee(t.Reflect)&&Object.isExtensible(t.Reflect)&&(w=t.Reflect[C]),O(w)&&(w=ZA()),!O(C)&&ee(t.Reflect)&&Object.isExtensible(t.Reflect)&&Object.defineProperty(t.Reflect,C,{enumerable:!1,configurable:!1,writable:!1,value:w}),w}function JA(w){var E=new g,P={isProviderFor:function(J,te){var ne=E.get(J);return O(ne)?!1:ne.has(te)},OrdinaryDefineOwnMetadata:tt,OrdinaryHasOwnMetadata:se,OrdinaryGetOwnMetadata:Xe,OrdinaryOwnMetadataKeys:we,OrdinaryDeleteMetadata:z};return m.registerProvider(P),P;function $(J,te,ne){var ve=E.get(J),Re=!1;if(O(ve)){if(!ne)return;ve=new y,E.set(J,ve),Re=!0}var Ze=ve.get(te);if(O(Ze)){if(!ne)return;if(Ze=new y,ve.set(te,Ze),!w.setProvider(J,te,P))throw ve.delete(te),Re&&E.delete(J),new Error("Wrong provider for target.")}return Ze}function se(J,te,ne){var ve=$(te,ne,!1);return O(ve)?!1:Ke(ve.has(J))}function Xe(J,te,ne){var ve=$(te,ne,!1);if(!O(ve))return ve.get(J)}function tt(J,te,ne,ve){var Re=$(ne,ve,!0);Re.set(J,te)}function we(J,te){var ne=[],ve=$(J,te,!1);if(O(ve))return ne;for(var Re=ve.keys(),Ze=Fg(Re),dr=0;;){var zg=qg(Ze);if(!zg)return ne.length=dr,ne;var nS=Wg(zg);try{ne[dr]=nS}catch(oS){try{Gg(Ze)}finally{throw oS}}dr++}}function z(J,te,ne){var ve=$(te,ne,!1);if(O(ve)||!ve.delete(J))return!1;if(ve.size===0){var Re=E.get(te);O(Re)||(Re.delete(ne),Re.size===0&&E.delete(Re))}return!0}}function QA(w){var E=w.defineMetadata,P=w.hasOwnMetadata,$=w.getOwnMetadata,se=w.getOwnMetadataKeys,Xe=w.deleteMetadata,tt=new g,we={isProviderFor:function(z,J){var te=tt.get(z);return!O(te)&&te.has(J)?!0:se(z,J).length?(O(te)&&(te=new b,tt.set(z,te)),te.add(J),!0):!1},OrdinaryDefineOwnMetadata:E,OrdinaryHasOwnMetadata:P,OrdinaryGetOwnMetadata:$,OrdinaryOwnMetadataKeys:se,OrdinaryDeleteMetadata:Xe};return we}function Sa(w,E,P){var $=m.getProvider(w,E);if(!O($))return $;if(P){if(m.setProvider(w,E,S))return S;throw new Error("Illegal state.")}}function eS(){var w={},E=[],P=(function(){function we(z,J,te){this._index=0,this._keys=z,this._values=J,this._selector=te}return we.prototype["@@iterator"]=function(){return this},we.prototype[s]=function(){return this},we.prototype.next=function(){var z=this._index;if(z>=0&&z<this._keys.length){var J=this._selector(this._keys[z],this._values[z]);return z+1>=this._keys.length?(this._index=-1,this._keys=E,this._values=E):this._index++,{value:J,done:!1}}return{value:void 0,done:!0}},we.prototype.throw=function(z){throw this._index>=0&&(this._index=-1,this._keys=E,this._values=E),z},we.prototype.return=function(z){return this._index>=0&&(this._index=-1,this._keys=E,this._values=E),{value:z,done:!0}},we})(),$=(function(){function we(){this._keys=[],this._values=[],this._cacheKey=w,this._cacheIndex=-2}return Object.defineProperty(we.prototype,"size",{get:function(){return this._keys.length},enumerable:!0,configurable:!0}),we.prototype.has=function(z){return this._find(z,!1)>=0},we.prototype.get=function(z){var J=this._find(z,!1);return J>=0?this._values[J]:void 0},we.prototype.set=function(z,J){var te=this._find(z,!0);return this._values[te]=J,this},we.prototype.delete=function(z){var J=this._find(z,!1);if(J>=0){for(var te=this._keys.length,ne=J+1;ne<te;ne++)this._keys[ne-1]=this._keys[ne],this._values[ne-1]=this._values[ne];return this._keys.length--,this._values.length--,zi(z,this._cacheKey)&&(this._cacheKey=w,this._cacheIndex=-2),!0}return!1},we.prototype.clear=function(){this._keys.length=0,this._values.length=0,this._cacheKey=w,this._cacheIndex=-2},we.prototype.keys=function(){return new P(this._keys,this._values,se)},we.prototype.values=function(){return new P(this._keys,this._values,Xe)},we.prototype.entries=function(){return new P(this._keys,this._values,tt)},we.prototype["@@iterator"]=function(){return this.entries()},we.prototype[s]=function(){return this.entries()},we.prototype._find=function(z,J){if(!zi(this._cacheKey,z)){this._cacheIndex=-1;for(var te=0;te<this._keys.length;te++)if(zi(this._keys[te],z)){this._cacheIndex=te;break}}return this._cacheIndex<0&&J&&(this._cacheIndex=this._keys.length,this._keys.push(z),this._values.push(void 0)),this._cacheIndex},we})();return $;function se(we,z){return we}function Xe(we,z){return z}function tt(we,z){return[we,z]}}function tS(){var w=(function(){function E(){this._map=new y}return Object.defineProperty(E.prototype,"size",{get:function(){return this._map.size},enumerable:!0,configurable:!0}),E.prototype.has=function(P){return this._map.has(P)},E.prototype.add=function(P){return this._map.set(P,P),this},E.prototype.delete=function(P){return this._map.delete(P)},E.prototype.clear=function(){this._map.clear()},E.prototype.keys=function(){return this._map.keys()},E.prototype.values=function(){return this._map.keys()},E.prototype.entries=function(){return this._map.entries()},E.prototype["@@iterator"]=function(){return this.keys()},E.prototype[s]=function(){return this.keys()},E})();return w}function rS(){var w=16,E=p.create(),P=$();return(function(){function z(){this._key=$()}return z.prototype.has=function(J){var te=se(J,!1);return te!==void 0?p.has(te,this._key):!1},z.prototype.get=function(J){var te=se(J,!1);return te!==void 0?p.get(te,this._key):void 0},z.prototype.set=function(J,te){var ne=se(J,!0);return ne[this._key]=te,this},z.prototype.delete=function(J){var te=se(J,!1);return te!==void 0?delete te[this._key]:!1},z.prototype.clear=function(){this._key=$()},z})();function $(){var z;do z="@@WeakMap@@"+we();while(p.has(E,z));return E[z]=!0,z}function se(z,J){if(!n.call(z,P)){if(!J)return;Object.defineProperty(z,P,{value:p.create()})}return z[P]}function Xe(z,J){for(var te=0;te<J;++te)z[te]=Math.random()*255|0;return z}function tt(z){if(typeof Uint8Array=="function"){var J=new Uint8Array(z);return typeof crypto<"u"?crypto.getRandomValues(J):typeof msCrypto<"u"?msCrypto.getRandomValues(J):Xe(J,z),J}return Xe(new Array(z),z)}function we(){var z=tt(w);z[6]=z[6]&79|64,z[8]=z[8]&191|128;for(var J="",te=0;te<w;++te){var ne=z[te];(te===4||te===6||te===8)&&(J+="-"),ne<16&&(J+="0"),J+=ne.toString(16).toLowerCase()}return J}}function np(w){return w.__=void 0,delete w.__,w}})})(tx||(tx={}))});var gn=op(Is=>{"use strict";var J2="[object ArrayBuffer]",yn=class r{static isArrayBuffer(e){return Object.prototype.toString.call(e)===J2}static toArrayBuffer(e){return this.isArrayBuffer(e)?e:e.byteLength===e.buffer.byteLength||e.byteOffset===0&&e.byteLength===e.buffer.byteLength?e.buffer:this.toUint8Array(e.buffer).slice(e.byteOffset,e.byteOffset+e.byteLength).buffer}static toUint8Array(e){return this.toView(e,Uint8Array)}static toView(e,t){if(e.constructor===t)return e;if(this.isArrayBuffer(e))return new t(e);if(this.isArrayBufferView(e))return new t(e.buffer,e.byteOffset,e.byteLength);throw new TypeError("The provided value is not of type '(ArrayBuffer or ArrayBufferView)'")}static isBufferSource(e){return this.isArrayBufferView(e)||this.isArrayBuffer(e)}static isArrayBufferView(e){return ArrayBuffer.isView(e)||e&&this.isArrayBuffer(e.buffer)}static isEqual(e,t){let n=r.toUint8Array(e),o=r.toUint8Array(t);if(n.length!==o.byteLength)return!1;for(let i=0;i<n.length;i++)if(n[i]!==o[i])return!1;return!0}static concat(...e){let t;Array.isArray(e[0])&&!(e[1]instanceof Function)||Array.isArray(e[0])&&e[1]instanceof Function?t=e[0]:e[e.length-1]instanceof Function?t=e.slice(0,e.length-1):t=e;let n=0;for(let s of t)n+=s.byteLength;let o=new Uint8Array(n),i=0;for(let s of t){let a=this.toUint8Array(s);o.set(a,i),i+=a.length}return e[e.length-1]instanceof Function?this.toView(o,e[e.length-1]):o.buffer}},Cm="string",Q2=/^[0-9a-f\s]+$/i,eC=/^(?:[A-Za-z0-9+/]{4})*(?:[A-Za-z0-9+/]{2}==|[A-Za-z0-9+/]{3}=)?$/,tC=/^[a-zA-Z0-9-_]+$/,Ef=class{static fromString(e){let t=unescape(encodeURIComponent(e)),n=new Uint8Array(t.length);for(let o=0;o<t.length;o++)n[o]=t.charCodeAt(o);return n.buffer}static toString(e){let t=yn.toUint8Array(e),n="";for(let i=0;i<t.length;i++)n+=String.fromCharCode(t[i]);return decodeURIComponent(escape(n))}},or=class{static toString(e,t=!1){let n=yn.toArrayBuffer(e),o=new DataView(n),i="";for(let s=0;s<n.byteLength;s+=2){let a=o.getUint16(s,t);i+=String.fromCharCode(a)}return i}static fromString(e,t=!1){let n=new ArrayBuffer(e.length*2),o=new DataView(n);for(let i=0;i<e.length;i++)o.setUint16(i*2,e.charCodeAt(i),t);return n}},_f=class r{static isHex(e){return typeof e===Cm&&Q2.test(e)}static isBase64(e){return typeof e===Cm&&eC.test(e)}static isBase64Url(e){return typeof e===Cm&&tC.test(e)}static ToString(e,t="utf8"){let n=yn.toUint8Array(e);switch(t.toLowerCase()){case"utf8":return this.ToUtf8String(n);case"binary":return this.ToBinary(n);case"hex":return this.ToHex(n);case"base64":return this.ToBase64(n);case"base64url":return this.ToBase64Url(n);case"utf16le":return or.toString(n,!0);case"utf16":case"utf16be":return or.toString(n);default:throw new Error(`Unknown type of encoding '${t}'`)}}static FromString(e,t="utf8"){if(!e)return new ArrayBuffer(0);switch(t.toLowerCase()){case"utf8":return this.FromUtf8String(e);case"binary":return this.FromBinary(e);case"hex":return this.FromHex(e);case"base64":return this.FromBase64(e);case"base64url":return this.FromBase64Url(e);case"utf16le":return or.fromString(e,!0);case"utf16":case"utf16be":return or.fromString(e);default:throw new Error(`Unknown type of encoding '${t}'`)}}static ToBase64(e){let t=yn.toUint8Array(e);if(typeof btoa<"u"){let n=this.ToString(t,"binary");return btoa(n)}else return Buffer.from(t).toString("base64")}static FromBase64(e){let t=this.formatString(e);if(!t)return new ArrayBuffer(0);if(!r.isBase64(t))throw new TypeError("Argument 'base64Text' is not Base64 encoded");return typeof atob<"u"?this.FromBinary(atob(t)):new Uint8Array(Buffer.from(t,"base64")).buffer}static FromBase64Url(e){let t=this.formatString(e);if(!t)return new ArrayBuffer(0);if(!r.isBase64Url(t))throw new TypeError("Argument 'base64url' is not Base64Url encoded");return this.FromBase64(this.Base64Padding(t.replace(/\-/g,"+").replace(/\_/g,"/")))}static ToBase64Url(e){return this.ToBase64(e).replace(/\+/g,"-").replace(/\//g,"_").replace(/\=/g,"")}static FromUtf8String(e,t=r.DEFAULT_UTF8_ENCODING){switch(t){case"ascii":return this.FromBinary(e);case"utf8":return Ef.fromString(e);case"utf16":case"utf16be":return or.fromString(e);case"utf16le":case"usc2":return or.fromString(e,!0);default:throw new Error(`Unknown type of encoding '${t}'`)}}static ToUtf8String(e,t=r.DEFAULT_UTF8_ENCODING){switch(t){case"ascii":return this.ToBinary(e);case"utf8":return Ef.toString(e);case"utf16":case"utf16be":return or.toString(e);case"utf16le":case"usc2":return or.toString(e,!0);default:throw new Error(`Unknown type of encoding '${t}'`)}}static FromBinary(e){let t=e.length,n=new Uint8Array(t);for(let o=0;o<t;o++)n[o]=e.charCodeAt(o);return n.buffer}static ToBinary(e){let t=yn.toUint8Array(e),n="";for(let o=0;o<t.length;o++)n+=String.fromCharCode(t[o]);return n}static ToHex(e){let t=yn.toUint8Array(e),n="",o=t.length;for(let i=0;i<o;i++){let s=t[i];s<16&&(n+="0"),n+=s.toString(16)}return n}static FromHex(e){let t=this.formatString(e);if(!t)return new ArrayBuffer(0);if(!r.isHex(t))throw new TypeError("Argument 'hexString' is not HEX encoded");t.length%2&&(t=`0${t}`);let n=new Uint8Array(t.length/2);for(let o=0;o<t.length;o=o+2){let i=t.slice(o,o+2);n[o/2]=parseInt(i,16)}return n.buffer}static ToUtf16String(e,t=!1){return or.toString(e,t)}static FromUtf16String(e,t=!1){return or.fromString(e,t)}static Base64Padding(e){let t=4-e.length%4;if(t<4)for(let n=0;n<t;n++)e+="=";return e}static formatString(e){return e?.replace(/[\n\r\t ]/g,"")||""}};_f.DEFAULT_UTF8_ENCODING="utf8";function rC(r,...e){let t=arguments[0];for(let n=1;n<arguments.length;n++){let o=arguments[n];for(let i in o)t[i]=o[i]}return t}function nC(...r){let e=r.map(o=>o.byteLength).reduce((o,i)=>o+i),t=new Uint8Array(e),n=0;return r.map(o=>new Uint8Array(o)).forEach(o=>{for(let i of o)t[n++]=i}),t.buffer}function oC(r,e){if(!(r&&e)||r.byteLength!==e.byteLength)return!1;let t=new Uint8Array(r),n=new Uint8Array(e);for(let o=0;o<r.byteLength;o++)if(t[o]!==n[o])return!1;return!0}Is.BufferSourceConverter=yn;Is.Convert=_f;Is.assign=rC;Is.combine=nC;Is.isEqual=oC});var Zv=op((U7,wh)=>{var kv,Ov,Pv,Nv,Dv,Rv,Lv,Uv,Mv,bh,Dy,jv,Kv,na,Hv,Vv,$v,Fv,Wv,qv,Gv,zv,Xv;(function(r){var e=typeof globalThis=="object"?globalThis:typeof self=="object"?self:typeof this=="object"?this:{};typeof define=="function"&&define.amd?define("tslib",["exports"],function(n){r(t(e,t(n)))}):typeof wh=="object"&&typeof wh.exports=="object"?r(t(e,t(wh.exports))):r(t(e));function t(n,o){return n!==e&&(typeof Object.create=="function"?Object.defineProperty(n,"__esModule",{value:!0}):n.__esModule=!0),function(i,s){return n[i]=o?o(i,s):s}}})(function(r){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var o in n)n.hasOwnProperty(o)&&(t[o]=n[o])};kv=function(t,n){e(t,n);function o(){this.constructor=t}t.prototype=n===null?Object.create(n):(o.prototype=n.prototype,new o)},Ov=Object.assign||function(t){for(var n,o=1,i=arguments.length;o<i;o++){n=arguments[o];for(var s in n)Object.prototype.hasOwnProperty.call(n,s)&&(t[s]=n[s])}return t},Pv=function(t,n){var o={};for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&n.indexOf(i)<0&&(o[i]=t[i]);if(t!=null&&typeof Object.getOwnPropertySymbols=="function")for(var s=0,i=Object.getOwnPropertySymbols(t);s<i.length;s++)n.indexOf(i[s])<0&&Object.prototype.propertyIsEnumerable.call(t,i[s])&&(o[i[s]]=t[i[s]]);return o},Nv=function(t,n,o,i){var s=arguments.length,a=s<3?n:i===null?i=Object.getOwnPropertyDescriptor(n,o):i,c;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")a=Reflect.decorate(t,n,o,i);else for(var f=t.length-1;f>=0;f--)(c=t[f])&&(a=(s<3?c(a):s>3?c(n,o,a):c(n,o))||a);return s>3&&a&&Object.defineProperty(n,o,a),a},Dv=function(t,n){return function(o,i){n(o,i,t)}},Rv=function(t,n){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(t,n)},Lv=function(t,n,o,i){function s(a){return a instanceof o?a:new o(function(c){c(a)})}return new(o||(o=Promise))(function(a,c){function f(y){try{h(i.next(y))}catch(b){c(b)}}function p(y){try{h(i.throw(y))}catch(b){c(b)}}function h(y){y.done?a(y.value):s(y.value).then(f,p)}h((i=i.apply(t,n||[])).next())})},Uv=function(t,n){var o={label:0,sent:function(){if(a[0]&1)throw a[1];return a[1]},trys:[],ops:[]},i,s,a,c;return c={next:f(0),throw:f(1),return:f(2)},typeof Symbol=="function"&&(c[Symbol.iterator]=function(){return this}),c;function f(h){return function(y){return p([h,y])}}function p(h){if(i)throw new TypeError("Generator is already executing.");for(;o;)try{if(i=1,s&&(a=h[0]&2?s.return:h[0]?s.throw||((a=s.return)&&a.call(s),0):s.next)&&!(a=a.call(s,h[1])).done)return a;switch(s=0,a&&(h=[h[0]&2,a.value]),h[0]){case 0:case 1:a=h;break;case 4:return o.label++,{value:h[1],done:!1};case 5:o.label++,s=h[1],h=[0];continue;case 7:h=o.ops.pop(),o.trys.pop();continue;default:if(a=o.trys,!(a=a.length>0&&a[a.length-1])&&(h[0]===6||h[0]===2)){o=0;continue}if(h[0]===3&&(!a||h[1]>a[0]&&h[1]<a[3])){o.label=h[1];break}if(h[0]===6&&o.label<a[1]){o.label=a[1],a=h;break}if(a&&o.label<a[2]){o.label=a[2],o.ops.push(h);break}a[2]&&o.ops.pop(),o.trys.pop();continue}h=n.call(t,o)}catch(y){h=[6,y],s=0}finally{i=a=0}if(h[0]&5)throw h[1];return{value:h[0]?h[1]:void 0,done:!0}}},Xv=function(t,n,o,i){i===void 0&&(i=o),t[i]=n[o]},Mv=function(t,n){for(var o in t)o!=="default"&&!n.hasOwnProperty(o)&&(n[o]=t[o])},bh=function(t){var n=typeof Symbol=="function"&&Symbol.iterator,o=n&&t[n],i=0;if(o)return o.call(t);if(t&&typeof t.length=="number")return{next:function(){return t&&i>=t.length&&(t=void 0),{value:t&&t[i++],done:!t}}};throw new TypeError(n?"Object is not iterable.":"Symbol.iterator is not defined.")},Dy=function(t,n){var o=typeof Symbol=="function"&&t[Symbol.iterator];if(!o)return t;var i=o.call(t),s,a=[],c;try{for(;(n===void 0||n-- >0)&&!(s=i.next()).done;)a.push(s.value)}catch(f){c={error:f}}finally{try{s&&!s.done&&(o=i.return)&&o.call(i)}finally{if(c)throw c.error}}return a},jv=function(){for(var t=[],n=0;n<arguments.length;n++)t=t.concat(Dy(arguments[n]));return t},Kv=function(){for(var t=0,n=0,o=arguments.length;n<o;n++)t+=arguments[n].length;for(var i=Array(t),s=0,n=0;n<o;n++)for(var a=arguments[n],c=0,f=a.length;c<f;c++,s++)i[s]=a[c];return i},na=function(t){return this instanceof na?(this.v=t,this):new na(t)},Hv=function(t,n,o){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var i=o.apply(t,n||[]),s,a=[];return s={},c("next"),c("throw"),c("return"),s[Symbol.asyncIterator]=function(){return this},s;function c(g){i[g]&&(s[g]=function(C){return new Promise(function(m,S){a.push([g,C,m,S])>1||f(g,C)})})}function f(g,C){try{p(i[g](C))}catch(m){b(a[0][3],m)}}function p(g){g.value instanceof na?Promise.resolve(g.value.v).then(h,y):b(a[0][2],g)}function h(g){f("next",g)}function y(g){f("throw",g)}function b(g,C){g(C),a.shift(),a.length&&f(a[0][0],a[0][1])}},Vv=function(t){var n,o;return n={},i("next"),i("throw",function(s){throw s}),i("return"),n[Symbol.iterator]=function(){return this},n;function i(s,a){n[s]=t[s]?function(c){return(o=!o)?{value:na(t[s](c)),done:s==="return"}:a?a(c):c}:a}},$v=function(t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var n=t[Symbol.asyncIterator],o;return n?n.call(t):(t=typeof bh=="function"?bh(t):t[Symbol.iterator](),o={},i("next"),i("throw"),i("return"),o[Symbol.asyncIterator]=function(){return this},o);function i(a){o[a]=t[a]&&function(c){return new Promise(function(f,p){c=t[a](c),s(f,p,c.done,c.value)})}}function s(a,c,f,p){Promise.resolve(p).then(function(h){a({value:h,done:f})},c)}},Fv=function(t,n){return Object.defineProperty?Object.defineProperty(t,"raw",{value:n}):t.raw=n,t},Wv=function(t){if(t&&t.__esModule)return t;var n={};if(t!=null)for(var o in t)Object.hasOwnProperty.call(t,o)&&(n[o]=t[o]);return n.default=t,n},qv=function(t){return t&&t.__esModule?t:{default:t}},Gv=function(t,n){if(!n.has(t))throw new TypeError("attempted to get private field on non-instance");return n.get(t)},zv=function(t,n,o){if(!n.has(t))throw new TypeError("attempted to set private field on non-instance");return n.set(t,o),o},r("__extends",kv),r("__assign",Ov),r("__rest",Pv),r("__decorate",Nv),r("__param",Dv),r("__metadata",Rv),r("__awaiter",Lv),r("__generator",Uv),r("__exportStar",Mv),r("__createBinding",Xv),r("__values",bh),r("__read",Dy),r("__spread",jv),r("__spreadArrays",Kv),r("__await",na),r("__asyncGenerator",Hv),r("__asyncDelegator",Vv),r("__asyncValues",$v),r("__makeTemplateObject",Fv),r("__importStar",Wv),r("__importDefault",qv),r("__classPrivateFieldGet",Gv),r("__classPrivateFieldSet",zv)})});var dI={};At(dI,{webRTC:()=>pI,webRTCDirect:()=>hI});var el=class extends Error{static name="UnexpectedPeerError";constructor(e="Unexpected Peer"){super(e),this.name="UnexpectedPeerError"}},tl=class extends Error{static name="InvalidCryptoExchangeError";constructor(e="Invalid crypto exchange"){super(e),this.name="InvalidCryptoExchangeError"}},xe=class extends Error{static name="InvalidParametersError";constructor(e="Invalid parameters"){super(e),this.name="InvalidParametersError"}},Xi=class extends Error{static name="InvalidPublicKeyError";constructor(e="Invalid public key"){super(e),this.name="InvalidPublicKeyError"}},Ea=class extends Error{static name="InvalidPrivateKeyError";constructor(e="Invalid private key"){super(e),this.name="InvalidPrivateKeyError"}};var rl=class extends Error{static name="ConnectionFailedError";constructor(e="Connection failed"){super(e),this.name="ConnectionFailedError"}},nl=class extends Error{static name="MuxerClosedError";constructor(e="The muxer is closed"){super(e),this.name="MuxerClosedError"}},Zi=class extends Error{static name="StreamResetError";constructor(e="The stream has been reset"){super(e),this.name="StreamResetError"}};var Lr=class extends Error{static name="StreamStateError";constructor(e="The stream is in an invalid state"){super(e),this.name="StreamStateError"}},_a=class extends Error{static name="StreamBufferError";constructor(e="The stream buffer was full"){super(e),this.name="StreamBufferError"}},ko=class extends Error{static name="NotFoundError";constructor(e="Not found"){super(e),this.name="NotFoundError"}};var ol=class extends Error{static name="InvalidMultiaddrError";constructor(e="Invalid multiaddr"){super(e),this.name="InvalidMultiaddrError"}},il=class extends Error{static name="InvalidCIDError";constructor(e="Invalid CID"){super(e),this.name="InvalidCIDError"}},sl=class extends Error{static name="InvalidMultihashError";constructor(e="Invalid Multihash"){super(e),this.name="InvalidMultihashError"}};var al=class extends Error{static name="InvalidMessageError";constructor(e="Invalid message"){super(e),this.name="InvalidMessageError"}};var cl=class extends Error{static name="NotStartedError";constructor(e="Not started"){super(e),this.name="NotStartedError"}};var Kn=class extends Error{static name="UnsupportedKeyTypeError";constructor(e="Unsupported key type"){super(e),this.name="UnsupportedKeyTypeError"}};var ul=class extends Event{data;constructor(e,t){super("message",t),this.data=e}},Yi=class extends Event{error;local;constructor(e,t,n){super("close",n),this.error=t,this.local=e}},ll=class extends Yi{constructor(e,t){super(!0,e,t)}},fl=class extends Yi{constructor(e,t){super(!1,e,t)}};var ip=Symbol.for("@libp2p/peer-id");var hl=Symbol.for("@libp2p/transport");var Zg;(function(r){r[r.FATAL_ALL=0]="FATAL_ALL",r[r.NO_FATAL=1]="NO_FATAL"})(Zg||(Zg={}));var er=class extends EventTarget{#e=new Map;constructor(){super()}listenerCount(e){let t=this.#e.get(e);return t==null?0:t.length}addEventListener(e,t,n){super.addEventListener(e,t,n);let o=this.#e.get(e);o==null&&(o=[],this.#e.set(e,o)),o.push({callback:t,once:(n!==!0&&n!==!1&&n?.once)??!1})}removeEventListener(e,t,n){super.removeEventListener(e.toString(),t??null,n);let o=this.#e.get(e);o!=null&&(o=o.filter(({callback:i})=>i!==t),this.#e.set(e,o))}dispatchEvent(e){let t=super.dispatchEvent(e),n=this.#e.get(e.type);return n==null||(n=n.filter(({once:o})=>!o),this.#e.set(e.type,n)),t}safeDispatchEvent(e,t={}){return this.dispatchEvent(new CustomEvent(e,t))}};var Ji=Symbol.for("@libp2p/service-capabilities"),Yg=Symbol.for("@libp2p/service-dependencies");var lp={};At(lp,{base58btc:()=>Fe,base58flickr:()=>gS});var qI=new Uint8Array(0);function Jg(r,e){if(r===e)return!0;if(r.byteLength!==e.byteLength)return!1;for(let t=0;t<r.byteLength;t++)if(r[t]!==e[t])return!1;return!0}function on(r){if(r instanceof Uint8Array&&r.constructor.name==="Uint8Array")return r;if(r instanceof ArrayBuffer)return new Uint8Array(r);if(ArrayBuffer.isView(r))return new Uint8Array(r.buffer,r.byteOffset,r.byteLength);throw new Error("Unknown type, must be binary type")}function Qg(r){return new TextEncoder().encode(r)}function e0(r){return new TextDecoder().decode(r)}function fS(r,e){if(r.length>=255)throw new TypeError("Alphabet too long");for(var t=new Uint8Array(256),n=0;n<t.length;n++)t[n]=255;for(var o=0;o<r.length;o++){var i=r.charAt(o),s=i.charCodeAt(0);if(t[s]!==255)throw new TypeError(i+" is ambiguous");t[s]=o}var a=r.length,c=r.charAt(0),f=Math.log(a)/Math.log(256),p=Math.log(256)/Math.log(a);function h(g){if(g instanceof Uint8Array||(ArrayBuffer.isView(g)?g=new Uint8Array(g.buffer,g.byteOffset,g.byteLength):Array.isArray(g)&&(g=Uint8Array.from(g))),!(g instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(g.length===0)return"";for(var C=0,m=0,S=0,N=g.length;S!==N&&g[S]===0;)S++,C++;for(var I=(N-S)*p+1>>>0,K=new Uint8Array(I);S!==N;){for(var Z=g[S],q=0,re=I-1;(Z!==0||q<m)&&re!==-1;re--,q++)Z+=256*K[re]>>>0,K[re]=Z%a>>>0,Z=Z/a>>>0;if(Z!==0)throw new Error("Non-zero carry");m=q,S++}for(var R=I-m;R!==I&&K[R]===0;)R++;for(var k=c.repeat(C);R<I;++R)k+=r.charAt(K[R]);return k}function y(g){if(typeof g!="string")throw new TypeError("Expected String");if(g.length===0)return new Uint8Array;var C=0;if(g[C]!==" "){for(var m=0,S=0;g[C]===c;)m++,C++;for(var N=(g.length-C)*f+1>>>0,I=new Uint8Array(N);g[C];){var K=t[g.charCodeAt(C)];if(K===255)return;for(var Z=0,q=N-1;(K!==0||Z<S)&&q!==-1;q--,Z++)K+=a*I[q]>>>0,I[q]=K%256>>>0,K=K/256>>>0;if(K!==0)throw new Error("Non-zero carry");S=Z,C++}if(g[C]!==" "){for(var re=N-S;re!==N&&I[re]===0;)re++;for(var R=new Uint8Array(m+(N-re)),k=m;re!==N;)R[k++]=I[re++];return R}}}function b(g){var C=y(g);if(C)return C;throw new Error(`Non-${e} character`)}return{encode:h,decodeUnsafe:y,decode:b}}var hS=fS,pS=hS,r0=pS;var sp=class{name;prefix;baseEncode;constructor(e,t,n){this.name=e,this.prefix=t,this.baseEncode=n}encode(e){if(e instanceof Uint8Array)return`${this.prefix}${this.baseEncode(e)}`;throw Error("Unknown type, must be binary type")}},ap=class{name;prefix;baseDecode;prefixCodePoint;constructor(e,t,n){this.name=e,this.prefix=t;let o=t.codePointAt(0);if(o===void 0)throw new Error("Invalid prefix character");this.prefixCodePoint=o,this.baseDecode=n}decode(e){if(typeof e=="string"){if(e.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(e)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(e.slice(this.prefix.length))}else throw Error("Can only multibase decode strings")}or(e){return n0(this,e)}},cp=class{decoders;constructor(e){this.decoders=e}or(e){return n0(this,e)}decode(e){let t=e[0],n=this.decoders[t];if(n!=null)return n.decode(e);throw RangeError(`Unable to decode multibase string ${JSON.stringify(e)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}};function n0(r,e){return new cp({...r.decoders??{[r.prefix]:r},...e.decoders??{[e.prefix]:e}})}var up=class{name;prefix;baseEncode;baseDecode;encoder;decoder;constructor(e,t,n,o){this.name=e,this.prefix=t,this.baseEncode=n,this.baseDecode=o,this.encoder=new sp(e,t,n),this.decoder=new ap(e,t,o)}encode(e){return this.encoder.encode(e)}decode(e){return this.decoder.decode(e)}};function Qi({name:r,prefix:e,encode:t,decode:n}){return new up(r,e,t,n)}function Hn({name:r,prefix:e,alphabet:t}){let{encode:n,decode:o}=r0(t,r);return Qi({prefix:e,name:r,encode:n,decode:i=>on(o(i))})}function dS(r,e,t,n){let o=r.length;for(;r[o-1]==="=";)--o;let i=new Uint8Array(o*t/8|0),s=0,a=0,c=0;for(let f=0;f<o;++f){let p=e[r[f]];if(p===void 0)throw new SyntaxError(`Non-${n} character`);a=a<<t|p,s+=t,s>=8&&(s-=8,i[c++]=255&a>>s)}if(s>=t||(255&a<<8-s)!==0)throw new SyntaxError("Unexpected end of data");return i}function mS(r,e,t){let n=e[e.length-1]==="=",o=(1<<t)-1,i="",s=0,a=0;for(let c=0;c<r.length;++c)for(a=a<<8|r[c],s+=8;s>t;)s-=t,i+=e[o&a>>s];if(s!==0&&(i+=e[o&a<<t-s]),n)for(;(i.length*t&7)!==0;)i+="=";return i}function yS(r){let e={};for(let t=0;t<r.length;++t)e[r[t]]=t;return e}function $e({name:r,prefix:e,bitsPerChar:t,alphabet:n}){let o=yS(n);return Qi({prefix:e,name:r,encode(i){return mS(i,n,t)},decode(i){return dS(i,o,t,r)}})}var Fe=Hn({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"}),gS=Hn({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"});var fp={};At(fp,{base32:()=>Vn,base32hex:()=>vS,base32hexpad:()=>SS,base32hexpadupper:()=>ES,base32hexupper:()=>AS,base32pad:()=>wS,base32padupper:()=>xS,base32upper:()=>bS,base32z:()=>_S});var Vn=$e({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5}),bS=$e({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5}),wS=$e({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5}),xS=$e({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5}),vS=$e({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5}),AS=$e({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5}),SS=$e({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5}),ES=$e({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5}),_S=$e({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5});var hp={};At(hp,{base36:()=>Ca,base36upper:()=>CS});var Ca=Hn({prefix:"k",name:"base36",alphabet:"0123456789abcdefghijklmnopqrstuvwxyz"}),CS=Hn({prefix:"K",name:"base36upper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"});var mr={};At(mr,{Digest:()=>Oo,create:()=>It,decode:()=>rs,equals:()=>dp,hasCode:()=>WS});var BS=s0,o0=128,IS=127,TS=~IS,kS=Math.pow(2,31);function s0(r,e,t){e=e||[],t=t||0;for(var n=t;r>=kS;)e[t++]=r&255|o0,r/=128;for(;r&TS;)e[t++]=r&255|o0,r>>>=7;return e[t]=r|0,s0.bytes=t-n+1,e}var OS=pp,PS=128,i0=127;function pp(r,n){var t=0,n=n||0,o=0,i=n,s,a=r.length;do{if(i>=a)throw pp.bytes=0,new RangeError("Could not decode varint");s=r[i++],t+=o<28?(s&i0)<<o:(s&i0)*Math.pow(2,o),o+=7}while(s>=PS);return pp.bytes=i-n,t}var NS=Math.pow(2,7),DS=Math.pow(2,14),RS=Math.pow(2,21),LS=Math.pow(2,28),US=Math.pow(2,35),MS=Math.pow(2,42),jS=Math.pow(2,49),KS=Math.pow(2,56),HS=Math.pow(2,63),VS=function(r){return r<NS?1:r<DS?2:r<RS?3:r<LS?4:r<US?5:r<MS?6:r<jS?7:r<KS?8:r<HS?9:10},$S={encode:BS,decode:OS,encodingLength:VS},FS=$S,Ba=FS;function Ia(r,e=0){return[Ba.decode(r,e),Ba.decode.bytes]}function es(r,e,t=0){return Ba.encode(r,e,t),e}function ts(r){return Ba.encodingLength(r)}function It(r,e){let t=e.byteLength,n=ts(r),o=n+ts(t),i=new Uint8Array(o+t);return es(r,i,0),es(t,i,n),i.set(e,o),new Oo(r,t,e,i)}function rs(r){let e=on(r),[t,n]=Ia(e),[o,i]=Ia(e.subarray(n)),s=e.subarray(n+i);if(s.byteLength!==o)throw new Error("Incorrect length");return new Oo(t,o,s,e)}function dp(r,e){if(r===e)return!0;{let t=e;return r.code===t.code&&r.size===t.size&&t.bytes instanceof Uint8Array&&Jg(r.bytes,t.bytes)}}var Oo=class{code;size;digest;bytes;constructor(e,t,n,o){this.code=e,this.size=t,this.digest=n,this.bytes=o}};function WS(r,e){return r.code===e}function a0(r,e){let{bytes:t,version:n}=r;switch(n){case 0:return GS(t,mp(r),e??Fe.encoder);default:return zS(t,mp(r),e??Vn.encoder)}}var c0=new WeakMap;function mp(r){let e=c0.get(r);if(e==null){let t=new Map;return c0.set(r,t),t}return e}var rt=class r{code;version;multihash;bytes;"/";constructor(e,t,n,o){this.code=t,this.version=e,this.multihash=n,this.bytes=o,this["/"]=o}get asCID(){return this}get byteOffset(){return this.bytes.byteOffset}get byteLength(){return this.bytes.byteLength}toV0(){switch(this.version){case 0:return this;case 1:{let{code:e,multihash:t}=this;if(e!==Ta)throw new Error("Cannot convert a non dag-pb CID to CIDv0");if(t.code!==XS)throw new Error("Cannot convert non sha2-256 multihash CID to CIDv0");return r.createV0(t)}default:throw Error(`Can not convert CID version ${this.version} to version 0. This is a bug please report`)}}toV1(){switch(this.version){case 0:{let{code:e,digest:t}=this.multihash,n=It(e,t);return r.createV1(this.code,n)}case 1:return this;default:throw Error(`Can not convert CID version ${this.version} to version 1. This is a bug please report`)}}equals(e){return r.equals(this,e)}static equals(e,t){let n=t;return n!=null&&e.code===n.code&&e.version===n.version&&dp(e.multihash,n.multihash)}toString(e){return a0(this,e)}toJSON(){return{"/":a0(this)}}link(){return this}[Symbol.toStringTag]="CID";[Symbol.for("nodejs.util.inspect.custom")](){return`CID(${this.toString()})`}static asCID(e){if(e==null)return null;let t=e;if(t instanceof r)return t;if(t["/"]!=null&&t["/"]===t.bytes||t.asCID===t){let{version:n,code:o,multihash:i,bytes:s}=t;return new r(n,o,i,s??u0(n,o,i.bytes))}else if(t[ZS]===!0){let{version:n,multihash:o,code:i}=t,s=rs(o);return r.create(n,i,s)}else return null}static create(e,t,n){if(typeof t!="number")throw new Error("String codecs are no longer supported");if(!(n.bytes instanceof Uint8Array))throw new Error("Invalid digest");switch(e){case 0:{if(t!==Ta)throw new Error(`Version 0 CID must use dag-pb (code: ${Ta}) block encoding`);return new r(e,t,n,n.bytes)}case 1:{let o=u0(e,t,n.bytes);return new r(e,t,n,o)}default:throw new Error("Invalid version")}}static createV0(e){return r.create(0,Ta,e)}static createV1(e,t){return r.create(1,e,t)}static decode(e){let[t,n]=r.decodeFirst(e);if(n.length!==0)throw new Error("Incorrect length");return t}static decodeFirst(e){let t=r.inspectBytes(e),n=t.size-t.multihashSize,o=on(e.subarray(n,n+t.multihashSize));if(o.byteLength!==t.multihashSize)throw new Error("Incorrect length");let i=o.subarray(t.multihashSize-t.digestSize),s=new Oo(t.multihashCode,t.digestSize,i,o);return[t.version===0?r.createV0(s):r.createV1(t.codec,s),e.subarray(t.size)]}static inspectBytes(e){let t=0,n=()=>{let[h,y]=Ia(e.subarray(t));return t+=y,h},o=n(),i=Ta;if(o===18?(o=0,t=0):i=n(),o!==0&&o!==1)throw new RangeError(`Invalid CID version ${o}`);let s=t,a=n(),c=n(),f=t+c,p=f-s;return{version:o,codec:i,multihashCode:a,digestSize:c,multihashSize:p,size:f}}static parse(e,t){let[n,o]=qS(e,t),i=r.decode(o);if(i.version===0&&e[0]!=="Q")throw Error("Version 0 CID string must not include multibase prefix");return mp(i).set(n,e),i}};function qS(r,e){switch(r[0]){case"Q":{let t=e??Fe;return[Fe.prefix,t.decode(`${Fe.prefix}${r}`)]}case Fe.prefix:{let t=e??Fe;return[Fe.prefix,t.decode(r)]}case Vn.prefix:{let t=e??Vn;return[Vn.prefix,t.decode(r)]}case Ca.prefix:{let t=e??Ca;return[Ca.prefix,t.decode(r)]}default:{if(e==null)throw Error("To parse non base32, base36 or base58btc encoded CID multibase decoder must be provided");return[r[0],e.decode(r)]}}}function GS(r,e,t){let{prefix:n}=t;if(n!==Fe.prefix)throw Error(`Cannot string encode V0 in ${t.name} encoding`);let o=e.get(n);if(o==null){let i=t.encode(r).slice(1);return e.set(n,i),i}else return o}function zS(r,e,t){let{prefix:n}=t,o=e.get(n);if(o==null){let i=t.encode(r);return e.set(n,i),i}else return o}var Ta=112,XS=18;function u0(r,e,t){let n=ts(r),o=n+ts(e),i=new Uint8Array(o+t.byteLength);return es(r,i,0),es(e,i,n),i.set(t,o),i}var ZS=Symbol.for("@ipld/js-cid/CID");var yp={};At(yp,{identity:()=>yr});var l0=0,YS="identity",f0=on;function JS(r,e){if(e?.truncate!=null&&e.truncate!==r.byteLength){if(e.truncate<0||e.truncate>r.byteLength)throw new Error(`Invalid truncate option, must be less than or equal to ${r.byteLength}`);r=r.subarray(0,e.truncate)}return It(l0,f0(r))}var yr={code:l0,name:YS,encode:f0,digest:JS};function We(r,e){if(r===e)return!0;if(r.byteLength!==e.byteLength)return!1;for(let t=0;t<r.byteLength;t++)if(r[t]!==e[t])return!1;return!0}function nt(r=0){return new Uint8Array(r)}function ot(r=0){return new Uint8Array(r)}function Tt(r,e){e==null&&(e=r.reduce((o,i)=>o+i.length,0));let t=ot(e),n=0;for(let o of r)t.set(o,n),n+=o.length;return t}var p0=Symbol.for("@achingbrain/uint8arraylist");function h0(r,e){if(e==null||e<0)throw new RangeError("index is out of bounds");let t=0;for(let n of r){let o=t+n.byteLength;if(e<o)return{buf:n,index:e-t};t=o}throw new RangeError("index is out of bounds")}function dl(r){return!!r?.[p0]}var me=class r{bufs;length;[p0]=!0;constructor(...e){this.bufs=[],this.length=0,e.length>0&&this.appendAll(e)}*[Symbol.iterator](){yield*this.bufs}get byteLength(){return this.length}append(...e){this.appendAll(e)}appendAll(e){let t=0;for(let n of e)if(n instanceof Uint8Array)t+=n.byteLength,this.bufs.push(n);else if(dl(n))t+=n.byteLength,this.bufs.push(...n.bufs);else throw new Error("Could not append value, must be an Uint8Array or a Uint8ArrayList");this.length+=t}prepend(...e){this.prependAll(e)}prependAll(e){let t=0;for(let n of e.reverse())if(n instanceof Uint8Array)t+=n.byteLength,this.bufs.unshift(n);else if(dl(n))t+=n.byteLength,this.bufs.unshift(...n.bufs);else throw new Error("Could not prepend value, must be an Uint8Array or a Uint8ArrayList");this.length+=t}get(e){let t=h0(this.bufs,e);return t.buf[t.index]}set(e,t){let n=h0(this.bufs,e);n.buf[n.index]=t}write(e,t=0){if(e instanceof Uint8Array)for(let n=0;n<e.length;n++)this.set(t+n,e[n]);else if(dl(e))for(let n=0;n<e.length;n++)this.set(t+n,e.get(n));else throw new Error("Could not write value, must be an Uint8Array or a Uint8ArrayList")}consume(e){if(e=Math.trunc(e),!(Number.isNaN(e)||e<=0)){if(e===this.byteLength){this.bufs=[],this.length=0;return}for(;this.bufs.length>0;)if(e>=this.bufs[0].byteLength)e-=this.bufs[0].byteLength,this.length-=this.bufs[0].byteLength,this.bufs.shift();else{this.bufs[0]=this.bufs[0].subarray(e),this.length-=e;break}}}slice(e,t){let{bufs:n,length:o}=this._subList(e,t);return Tt(n,o)}subarray(e,t){let{bufs:n,length:o}=this._subList(e,t);return n.length===1?n[0]:Tt(n,o)}sublist(e,t){let{bufs:n,length:o}=this._subList(e,t),i=new r;return i.length=o,i.bufs=[...n],i}_subList(e,t){if(e=e??0,t=t??this.length,e<0&&(e=this.length+e),t<0&&(t=this.length+t),e<0||t>this.length)throw new RangeError("index is out of bounds");if(e===t)return{bufs:[],length:0};if(e===0&&t===this.length)return{bufs:this.bufs,length:this.length};let n=[],o=0;for(let i=0;i<this.bufs.length;i++){let s=this.bufs[i],a=o,c=a+s.byteLength;if(o=c,e>=c)continue;let f=e>=a&&e<c,p=t>a&&t<=c;if(f&&p){if(e===a&&t===c){n.push(s);break}let h=e-a;n.push(s.subarray(h,h+(t-e)));break}if(f){if(e===0){n.push(s);continue}n.push(s.subarray(e-a));continue}if(p){if(t===c){n.push(s);break}n.push(s.subarray(0,t-a));break}n.push(s)}return{bufs:n,length:t-e}}indexOf(e,t=0){if(!dl(e)&&!(e instanceof Uint8Array))throw new TypeError('The "value" argument must be a Uint8ArrayList or Uint8Array');let n=e instanceof Uint8Array?e:e.subarray();if(t=Number(t??0),isNaN(t)&&(t=0),t<0&&(t=this.length+t),t<0&&(t=0),e.length===0)return t>this.length?this.length:t;let o=n.byteLength;if(o===0)throw new TypeError("search must be at least 1 byte long");let i=256,s=new Int32Array(i);for(let h=0;h<i;h++)s[h]=-1;for(let h=0;h<o;h++)s[n[h]]=h;let a=s,c=this.byteLength-n.byteLength,f=n.byteLength-1,p;for(let h=t;h<=c;h+=p){p=0;for(let y=f;y>=0;y--){let b=this.get(h+y);if(n[y]!==b){p=Math.max(1,y-a[b]);break}}if(p===0)return h}return-1}getInt8(e){let t=this.subarray(e,e+1);return new DataView(t.buffer,t.byteOffset,t.byteLength).getInt8(0)}setInt8(e,t){let n=ot(1);new DataView(n.buffer,n.byteOffset,n.byteLength).setInt8(0,t),this.write(n,e)}getInt16(e,t){let n=this.subarray(e,e+2);return new DataView(n.buffer,n.byteOffset,n.byteLength).getInt16(0,t)}setInt16(e,t,n){let o=nt(2);new DataView(o.buffer,o.byteOffset,o.byteLength).setInt16(0,t,n),this.write(o,e)}getInt32(e,t){let n=this.subarray(e,e+4);return new DataView(n.buffer,n.byteOffset,n.byteLength).getInt32(0,t)}setInt32(e,t,n){let o=nt(4);new DataView(o.buffer,o.byteOffset,o.byteLength).setInt32(0,t,n),this.write(o,e)}getBigInt64(e,t){let n=this.subarray(e,e+8);return new DataView(n.buffer,n.byteOffset,n.byteLength).getBigInt64(0,t)}setBigInt64(e,t,n){let o=nt(8);new DataView(o.buffer,o.byteOffset,o.byteLength).setBigInt64(0,t,n),this.write(o,e)}getUint8(e){let t=this.subarray(e,e+1);return new DataView(t.buffer,t.byteOffset,t.byteLength).getUint8(0)}setUint8(e,t){let n=ot(1);new DataView(n.buffer,n.byteOffset,n.byteLength).setUint8(0,t),this.write(n,e)}getUint16(e,t){let n=this.subarray(e,e+2);return new DataView(n.buffer,n.byteOffset,n.byteLength).getUint16(0,t)}setUint16(e,t,n){let o=nt(2);new DataView(o.buffer,o.byteOffset,o.byteLength).setUint16(0,t,n),this.write(o,e)}getUint32(e,t){let n=this.subarray(e,e+4);return new DataView(n.buffer,n.byteOffset,n.byteLength).getUint32(0,t)}setUint32(e,t,n){let o=nt(4);new DataView(o.buffer,o.byteOffset,o.byteLength).setUint32(0,t,n),this.write(o,e)}getBigUint64(e,t){let n=this.subarray(e,e+8);return new DataView(n.buffer,n.byteOffset,n.byteLength).getBigUint64(0,t)}setBigUint64(e,t,n){let o=nt(8);new DataView(o.buffer,o.byteOffset,o.byteLength).setBigUint64(0,t,n),this.write(o,e)}getFloat32(e,t){let n=this.subarray(e,e+4);return new DataView(n.buffer,n.byteOffset,n.byteLength).getFloat32(0,t)}setFloat32(e,t,n){let o=nt(4);new DataView(o.buffer,o.byteOffset,o.byteLength).setFloat32(0,t,n),this.write(o,e)}getFloat64(e,t){let n=this.subarray(e,e+8);return new DataView(n.buffer,n.byteOffset,n.byteLength).getFloat64(0,t)}setFloat64(e,t,n){let o=nt(8);new DataView(o.buffer,o.byteOffset,o.byteLength).setFloat64(0,t,n),this.write(o,e)}equals(e){if(e==null||!(e instanceof r)||e.bufs.length!==this.bufs.length)return!1;for(let t=0;t<this.bufs.length;t++)if(!We(this.bufs[t],e.bufs[t]))return!1;return!0}static fromUint8Arrays(e,t){let n=new r;return n.bufs=e,t==null&&(t=e.reduce((o,i)=>o+i.byteLength,0)),n.length=t,n}};var gp={};At(gp,{base10:()=>eE});var eE=Hn({prefix:"9",name:"base10",alphabet:"0123456789"});var bp={};At(bp,{base16:()=>tE,base16upper:()=>rE});var tE=$e({prefix:"f",name:"base16",alphabet:"0123456789abcdef",bitsPerChar:4}),rE=$e({prefix:"F",name:"base16upper",alphabet:"0123456789ABCDEF",bitsPerChar:4});var wp={};At(wp,{base2:()=>nE});var nE=$e({prefix:"0",name:"base2",alphabet:"01",bitsPerChar:1});var xp={};At(xp,{base256emoji:()=>cE});var d0=Array.from("\u{1F680}\u{1FA90}\u2604\u{1F6F0}\u{1F30C}\u{1F311}\u{1F312}\u{1F313}\u{1F314}\u{1F315}\u{1F316}\u{1F317}\u{1F318}\u{1F30D}\u{1F30F}\u{1F30E}\u{1F409}\u2600\u{1F4BB}\u{1F5A5}\u{1F4BE}\u{1F4BF}\u{1F602}\u2764\u{1F60D}\u{1F923}\u{1F60A}\u{1F64F}\u{1F495}\u{1F62D}\u{1F618}\u{1F44D}\u{1F605}\u{1F44F}\u{1F601}\u{1F525}\u{1F970}\u{1F494}\u{1F496}\u{1F499}\u{1F622}\u{1F914}\u{1F606}\u{1F644}\u{1F4AA}\u{1F609}\u263A\u{1F44C}\u{1F917}\u{1F49C}\u{1F614}\u{1F60E}\u{1F607}\u{1F339}\u{1F926}\u{1F389}\u{1F49E}\u270C\u2728\u{1F937}\u{1F631}\u{1F60C}\u{1F338}\u{1F64C}\u{1F60B}\u{1F497}\u{1F49A}\u{1F60F}\u{1F49B}\u{1F642}\u{1F493}\u{1F929}\u{1F604}\u{1F600}\u{1F5A4}\u{1F603}\u{1F4AF}\u{1F648}\u{1F447}\u{1F3B6}\u{1F612}\u{1F92D}\u2763\u{1F61C}\u{1F48B}\u{1F440}\u{1F62A}\u{1F611}\u{1F4A5}\u{1F64B}\u{1F61E}\u{1F629}\u{1F621}\u{1F92A}\u{1F44A}\u{1F973}\u{1F625}\u{1F924}\u{1F449}\u{1F483}\u{1F633}\u270B\u{1F61A}\u{1F61D}\u{1F634}\u{1F31F}\u{1F62C}\u{1F643}\u{1F340}\u{1F337}\u{1F63B}\u{1F613}\u2B50\u2705\u{1F97A}\u{1F308}\u{1F608}\u{1F918}\u{1F4A6}\u2714\u{1F623}\u{1F3C3}\u{1F490}\u2639\u{1F38A}\u{1F498}\u{1F620}\u261D\u{1F615}\u{1F33A}\u{1F382}\u{1F33B}\u{1F610}\u{1F595}\u{1F49D}\u{1F64A}\u{1F639}\u{1F5E3}\u{1F4AB}\u{1F480}\u{1F451}\u{1F3B5}\u{1F91E}\u{1F61B}\u{1F534}\u{1F624}\u{1F33C}\u{1F62B}\u26BD\u{1F919}\u2615\u{1F3C6}\u{1F92B}\u{1F448}\u{1F62E}\u{1F646}\u{1F37B}\u{1F343}\u{1F436}\u{1F481}\u{1F632}\u{1F33F}\u{1F9E1}\u{1F381}\u26A1\u{1F31E}\u{1F388}\u274C\u270A\u{1F44B}\u{1F630}\u{1F928}\u{1F636}\u{1F91D}\u{1F6B6}\u{1F4B0}\u{1F353}\u{1F4A2}\u{1F91F}\u{1F641}\u{1F6A8}\u{1F4A8}\u{1F92C}\u2708\u{1F380}\u{1F37A}\u{1F913}\u{1F619}\u{1F49F}\u{1F331}\u{1F616}\u{1F476}\u{1F974}\u25B6\u27A1\u2753\u{1F48E}\u{1F4B8}\u2B07\u{1F628}\u{1F31A}\u{1F98B}\u{1F637}\u{1F57A}\u26A0\u{1F645}\u{1F61F}\u{1F635}\u{1F44E}\u{1F932}\u{1F920}\u{1F927}\u{1F4CC}\u{1F535}\u{1F485}\u{1F9D0}\u{1F43E}\u{1F352}\u{1F617}\u{1F911}\u{1F30A}\u{1F92F}\u{1F437}\u260E\u{1F4A7}\u{1F62F}\u{1F486}\u{1F446}\u{1F3A4}\u{1F647}\u{1F351}\u2744\u{1F334}\u{1F4A3}\u{1F438}\u{1F48C}\u{1F4CD}\u{1F940}\u{1F922}\u{1F445}\u{1F4A1}\u{1F4A9}\u{1F450}\u{1F4F8}\u{1F47B}\u{1F910}\u{1F92E}\u{1F3BC}\u{1F975}\u{1F6A9}\u{1F34E}\u{1F34A}\u{1F47C}\u{1F48D}\u{1F4E3}\u{1F942}"),oE=d0.reduce((r,e,t)=>(r[t]=e,r),[]),iE=d0.reduce((r,e,t)=>{let n=e.codePointAt(0);if(n==null)throw new Error(`Invalid character: ${e}`);return r[n]=t,r},[]);function sE(r){return r.reduce((e,t)=>(e+=oE[t],e),"")}function aE(r){let e=[];for(let t of r){let n=t.codePointAt(0);if(n==null)throw new Error(`Invalid character: ${t}`);let o=iE[n];if(o==null)throw new Error(`Non-base256emoji character: ${t}`);e.push(o)}return new Uint8Array(e)}var cE=Qi({prefix:"\u{1F680}",name:"base256emoji",encode:sE,decode:aE});var vp={};At(vp,{base64:()=>uE,base64pad:()=>lE,base64url:()=>Po,base64urlpad:()=>fE});var uE=$e({prefix:"m",name:"base64",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bitsPerChar:6}),lE=$e({prefix:"M",name:"base64pad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",bitsPerChar:6}),Po=$e({prefix:"u",name:"base64url",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",bitsPerChar:6}),fE=$e({prefix:"U",name:"base64urlpad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=",bitsPerChar:6});var Ap={};At(Ap,{base8:()=>hE});var hE=$e({prefix:"7",name:"base8",alphabet:"01234567",bitsPerChar:3});var Sp={};At(Sp,{identity:()=>pE});var pE=Qi({prefix:"\0",name:"identity",encode:r=>e0(r),decode:r=>Qg(r)});var IT=new TextEncoder,TT=new TextDecoder;var Cp={};At(Cp,{sha256:()=>tr,sha512:()=>gE});var yE=20;function _p({name:r,code:e,encode:t,minDigestLength:n,maxDigestLength:o}){return new Ep(r,e,t,n,o)}var Ep=class{name;code;encode;minDigestLength;maxDigestLength;constructor(e,t,n,o,i){this.name=e,this.code=t,this.encode=n,this.minDigestLength=o??yE,this.maxDigestLength=i}digest(e,t){if(t?.truncate!=null){if(t.truncate<this.minDigestLength)throw new Error(`Invalid truncate option, must be greater than or equal to ${this.minDigestLength}`);if(this.maxDigestLength!=null&&t.truncate>this.maxDigestLength)throw new Error(`Invalid truncate option, must be less than or equal to ${this.maxDigestLength}`)}if(e instanceof Uint8Array){let n=this.encode(e);return n instanceof Uint8Array?m0(n,this.code,t?.truncate):n.then(o=>m0(o,this.code,t?.truncate))}else throw Error("Unknown type, must be binary type")}};function m0(r,e,t){if(t!=null&&t!==r.byteLength){if(t>r.byteLength)throw new Error(`Invalid truncate option, must be less than or equal to ${r.byteLength}`);r=r.subarray(0,t)}return It(e,r)}function g0(r){return async e=>new Uint8Array(await crypto.subtle.digest(r,e))}var tr=_p({name:"sha2-256",code:18,encode:g0("SHA-256")}),gE=_p({name:"sha2-512",code:19,encode:g0("SHA-512")});var No={...Sp,...wp,...Ap,...gp,...bp,...fp,...hp,...lp,...vp,...xp},HT={...Cp,...yp};function w0(r,e,t,n){return{name:r,prefix:e,encoder:{name:r,prefix:e,encode:t},decoder:{decode:n}}}var b0=w0("utf8","u",r=>"u"+new TextDecoder("utf8").decode(r),r=>new TextEncoder().encode(r.substring(1))),Bp=w0("ascii","a",r=>{let e="a";for(let t=0;t<r.length;t++)e+=String.fromCharCode(r[t]);return e},r=>{r=r.substring(1);let e=ot(r.length);for(let t=0;t<r.length;t++)e[t]=r.charCodeAt(t);return e}),bE={utf8:b0,"utf-8":b0,hex:No.base16,latin1:Bp,ascii:Bp,binary:Bp,...No},ml=bE;function de(r,e="utf8"){let t=ml[e];if(t==null)throw new Error(`Unsupported encoding "${e}"`);return t.decoder.decode(`${t.prefix}${r}`)}function ue(r,e="utf8"){let t=ml[e];if(t==null)throw new Error(`Unsupported encoding "${e}"`);return t.encoder.encode(r).substring(1)}var wE=parseInt("11111",2),Ip=parseInt("10000000",2),xE=parseInt("01111111",2),x0={0:ka,1:ka,2:vE,3:EE,4:_E,5:SE,6:AE,16:ka,22:ka,48:ka};function sn(r,e={offset:0}){let t=r[e.offset]&wE;if(e.offset++,x0[t]!=null)return x0[t](r,e);throw new Error("No decoder for tag "+t)}function Oa(r,e){let t=0;if((r[e.offset]&Ip)===Ip){let n=r[e.offset]&xE,o="0x";e.offset++;for(let i=0;i<n;i++,e.offset++)o+=r[e.offset].toString(16).padStart(2,"0");t=parseInt(o,16)}else t=r[e.offset],e.offset++;return t}function ka(r,e){Oa(r,e);let t=[];for(;!(e.offset>=r.byteLength);){let n=sn(r,e);if(n===null)break;t.push(n)}return t}function vE(r,e){let t=Oa(r,e),n=e.offset,o=e.offset+t,i=[];for(let s=n;s<o;s++)s===n&&r[s]===0||i.push(r[s]);return e.offset+=t,Uint8Array.from(i)}function AE(r,e){let t=Oa(r,e),n=e.offset+t,o=r[e.offset];e.offset++;let i=0,s=0;o<40?(i=0,s=o):o<80?(i=1,s=o-40):(i=2,s=o-80);let a=`${i}.${s}`,c=[];for(;e.offset<n;){let f=r[e.offset];if(e.offset++,c.push(f&127),f<128){c.reverse();let p=0;for(let h=0;h<c.length;h++)p+=c[h]<<h*7;a+=`.${p}`,c=[]}}return a}function SE(r,e){return e.offset++,null}function EE(r,e){let t=Oa(r,e),n=r[e.offset];e.offset++;let o=r.subarray(e.offset,e.offset+t-1);if(e.offset+=t,n!==0)throw new Error("Unused bits in bit string is unimplemented");return o}function _E(r,e){let t=Oa(r,e),n=r.subarray(e.offset,e.offset+t);return e.offset+=t,n}function CE(r){let e=r.toString(16);e.length%2===1&&(e="0"+e);let t=new me;for(let n=0;n<e.length;n+=2)t.append(Uint8Array.from([parseInt(`${e[n]}${e[n+1]}`,16)]));return t}function yl(r){if(r.byteLength<128)return Uint8Array.from([r.byteLength]);let e=CE(r.byteLength);return new me(Uint8Array.from([e.byteLength|Ip]),e)}function kt(r){let e=new me,t=128;return(r.subarray()[0]&t)===t&&e.append(Uint8Array.from([0])),e.append(r),new me(Uint8Array.from([2]),yl(e),e)}function Pa(r){let e=Uint8Array.from([0]),t=new me(e,r);return new me(Uint8Array.from([3]),yl(t),t)}function v0(r){return new me(Uint8Array.from([4]),yl(r),r)}function gr(r,e=48){let t=new me;for(let n of r)t.append(n);return new me(Uint8Array.from([e]),yl(t),t)}async function A0(r="P-256"){let e=await crypto.subtle.generateKey({name:"ECDSA",namedCurve:r},!0,["sign","verify"]);return{publicKey:await crypto.subtle.exportKey("jwk",e.publicKey),privateKey:await crypto.subtle.exportKey("jwk",e.privateKey)}}async function S0(r,e,t){let n=await crypto.subtle.importKey("jwk",r,{name:"ECDSA",namedCurve:r.crv??"P-256"},!1,["sign"]);t?.signal?.throwIfAborted();let o=await crypto.subtle.sign({name:"ECDSA",hash:{name:"SHA-256"}},n,e.subarray());return t?.signal?.throwIfAborted(),new Uint8Array(o,0,o.byteLength)}async function E0(r,e,t,n){let o=await crypto.subtle.importKey("jwk",r,{name:"ECDSA",namedCurve:r.crv??"P-256"},!1,["verify"]);n?.signal?.throwIfAborted();let i=await crypto.subtle.verify({name:"ECDSA",hash:{name:"SHA-256"}},o,e,t.subarray());return n?.signal?.throwIfAborted(),i}var BE=Uint8Array.from([6,8,42,134,72,206,61,3,1,7]),IE=Uint8Array.from([6,5,43,129,4,0,34]),TE=Uint8Array.from([6,5,43,129,4,0,35]),kE={ext:!0,kty:"EC",crv:"P-256"},OE={ext:!0,kty:"EC",crv:"P-384"},PE={ext:!0,kty:"EC",crv:"P-521"},Tp=32,kp=48,Op=66;function Pp(r){let e=sn(r);return _0(e)}function _0(r){let e=r[1][1][0],t=1,n,o;if(e.byteLength===Tp*2+1)return n=ue(e.subarray(t,t+Tp),"base64url"),o=ue(e.subarray(t+Tp),"base64url"),new Do({...kE,key_ops:["verify"],x:n,y:o});if(e.byteLength===kp*2+1)return n=ue(e.subarray(t,t+kp),"base64url"),o=ue(e.subarray(t+kp),"base64url"),new Do({...OE,key_ops:["verify"],x:n,y:o});if(e.byteLength===Op*2+1)return n=ue(e.subarray(t,t+Op),"base64url"),o=ue(e.subarray(t+Op),"base64url"),new Do({...PE,key_ops:["verify"],x:n,y:o});throw new xe(`coordinates were wrong length, got ${e.byteLength}, expected 65, 97 or 133`)}function C0(r){return gr([kt(Uint8Array.from([1])),v0(de(r.d??"","base64url")),gr([I0(r.crv)],160),gr([Pa(new me(Uint8Array.from([4]),de(r.x??"","base64url"),de(r.y??"","base64url")))],161)]).subarray()}function B0(r){return gr([kt(Uint8Array.from([1])),gr([I0(r.crv)],160),gr([Pa(new me(Uint8Array.from([4]),de(r.x??"","base64url"),de(r.y??"","base64url")))],161)]).subarray()}function I0(r){if(r==="P-256")return BE;if(r==="P-384")return IE;if(r==="P-521")return TE;throw new xe(`Invalid curve ${r}`)}async function T0(r="P-256"){let e=await A0(r);return new gl(e.privateKey)}var Do=class{type="ECDSA";jwk;_raw;constructor(e){this.jwk=e}get raw(){return this._raw==null&&(this._raw=B0(this.jwk)),this._raw}toMultihash(){return yr.digest($n(this))}toCID(){return rt.createV1(114,this.toMultihash())}toString(){return Fe.encode(this.toMultihash().bytes).substring(1)}equals(e){return e==null||!(e.raw instanceof Uint8Array)?!1:We(this.raw,e.raw)}async verify(e,t,n){return E0(this.jwk,t,e,n)}},gl=class{type="ECDSA";jwk;publicKey;_raw;constructor(e){this.jwk=e,this.publicKey=new Do({crv:e.crv,ext:e.ext,key_ops:["verify"],kty:"EC",x:e.x,y:e.y})}get raw(){return this._raw==null&&(this._raw=C0(this.jwk)),this._raw}equals(e){return e==null||!(e.raw instanceof Uint8Array)?!1:We(this.raw,e.raw)}async sign(e,t){return S0(this.jwk,e,t)}};function Ro(r){return r instanceof Uint8Array||ArrayBuffer.isView(r)&&r.constructor.name==="Uint8Array"}function rr(r,e=""){if(!Number.isSafeInteger(r)||r<0){let t=e&&`"${e}" `;throw new Error(`${t}expected integer >= 0, got ${r}`)}}function fe(r,e,t=""){let n=Ro(r),o=r?.length,i=e!==void 0;if(!n||i&&o!==e){let s=t&&`"${t}" `,a=i?` of length ${e}`:"",c=n?`length=${o}`:`type=${typeof r}`;throw new Error(s+"expected Uint8Array"+a+", got "+c)}return r}function Lo(r){if(typeof r!="function"||typeof r.create!="function")throw new Error("Hash must wrapped by utils.createHasher");rr(r.outputLen),rr(r.blockLen)}function ns(r,e=!0){if(r.destroyed)throw new Error("Hash instance has been destroyed");if(e&&r.finished)throw new Error("Hash#digest() has already been called")}function O0(r,e){fe(r,void 0,"digestInto() output");let t=e.outputLen;if(r.length<t)throw new Error('"digestInto() output" expected to be of length >='+t)}function br(...r){for(let e=0;e<r.length;e++)r[e].fill(0)}function bl(r){return new DataView(r.buffer,r.byteOffset,r.byteLength)}function wr(r,e){return r<<32-e|r>>>e}var P0=typeof Uint8Array.from([]).toHex=="function"&&typeof Uint8Array.fromHex=="function",NE=Array.from({length:256},(r,e)=>e.toString(16).padStart(2,"0"));function cn(r){if(fe(r),P0)return r.toHex();let e="";for(let t=0;t<r.length;t++)e+=NE[r[t]];return e}var an={_0:48,_9:57,A:65,F:70,a:97,f:102};function k0(r){if(r>=an._0&&r<=an._9)return r-an._0;if(r>=an.A&&r<=an.F)return r-(an.A-10);if(r>=an.a&&r<=an.f)return r-(an.a-10)}function un(r){if(typeof r!="string")throw new Error("hex string expected, got "+typeof r);if(P0)return Uint8Array.fromHex(r);let e=r.length,t=e/2;if(e%2)throw new Error("hex string expected, got unpadded hex of length "+e);let n=new Uint8Array(t);for(let o=0,i=0;o<t;o++,i+=2){let s=k0(r.charCodeAt(i)),a=k0(r.charCodeAt(i+1));if(s===void 0||a===void 0){let c=r[i]+r[i+1];throw new Error('hex string expected, got non-hex character "'+c+'" at index '+i)}n[o]=s*16+a}return n}function Lt(...r){let e=0;for(let n=0;n<r.length;n++){let o=r[n];fe(o),e+=o.length}let t=new Uint8Array(e);for(let n=0,o=0;n<r.length;n++){let i=r[n];t.set(i,o),o+=i.length}return t}function Np(r,e={}){let t=(o,i)=>r(i).update(o).digest(),n=r(void 0);return t.outputLen=n.outputLen,t.blockLen=n.blockLen,t.create=o=>r(o),Object.assign(t,e),Object.freeze(t)}function Fn(r=32){let e=typeof globalThis=="object"?globalThis.crypto:null;if(typeof e?.getRandomValues!="function")throw new Error("crypto.getRandomValues must be defined");return e.getRandomValues(new Uint8Array(r))}var Dp=r=>({oid:Uint8Array.from([6,9,96,134,72,1,101,3,4,2,r])});function N0(r,e,t){return r&e^~r&t}function D0(r,e,t){return r&e^r&t^e&t}var Na=class{blockLen;outputLen;padOffset;isLE;buffer;view;finished=!1;length=0;pos=0;destroyed=!1;constructor(e,t,n,o){this.blockLen=e,this.outputLen=t,this.padOffset=n,this.isLE=o,this.buffer=new Uint8Array(e),this.view=bl(this.buffer)}update(e){ns(this),fe(e);let{view:t,buffer:n,blockLen:o}=this,i=e.length;for(let s=0;s<i;){let a=Math.min(o-this.pos,i-s);if(a===o){let c=bl(e);for(;o<=i-s;s+=o)this.process(c,s);continue}n.set(e.subarray(s,s+a),this.pos),this.pos+=a,s+=a,this.pos===o&&(this.process(t,0),this.pos=0)}return this.length+=e.length,this.roundClean(),this}digestInto(e){ns(this),O0(e,this),this.finished=!0;let{buffer:t,view:n,blockLen:o,isLE:i}=this,{pos:s}=this;t[s++]=128,br(this.buffer.subarray(s)),this.padOffset>o-s&&(this.process(n,0),s=0);for(let h=s;h<o;h++)t[h]=0;n.setBigUint64(o-8,BigInt(this.length*8),i),this.process(n,0);let a=bl(e),c=this.outputLen;if(c%4)throw new Error("_sha2: outputLen must be aligned to 32bit");let f=c/4,p=this.get();if(f>p.length)throw new Error("_sha2: outputLen bigger than state");for(let h=0;h<f;h++)a.setUint32(4*h,p[h],i)}digest(){let{buffer:e,outputLen:t}=this;this.digestInto(e);let n=e.slice(0,t);return this.destroy(),n}_cloneInto(e){e||=new this.constructor,e.set(...this.get());let{blockLen:t,buffer:n,length:o,finished:i,destroyed:s,pos:a}=this;return e.destroyed=s,e.finished=i,e.length=o,e.pos=a,o%t&&e.buffer.set(n),e}clone(){return this._cloneInto()}},ln=Uint32Array.from([1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225]);var ft=Uint32Array.from([1779033703,4089235720,3144134277,2227873595,1013904242,4271175723,2773480762,1595750129,1359893119,2917565137,2600822924,725511199,528734635,4215389547,1541459225,327033209]);var wl=BigInt(4294967295),R0=BigInt(32);function DE(r,e=!1){return e?{h:Number(r&wl),l:Number(r>>R0&wl)}:{h:Number(r>>R0&wl)|0,l:Number(r&wl)|0}}function L0(r,e=!1){let t=r.length,n=new Uint32Array(t),o=new Uint32Array(t);for(let i=0;i<t;i++){let{h:s,l:a}=DE(r[i],e);[n[i],o[i]]=[s,a]}return[n,o]}var Rp=(r,e,t)=>r>>>t,Lp=(r,e,t)=>r<<32-t|e>>>t,Uo=(r,e,t)=>r>>>t|e<<32-t,Mo=(r,e,t)=>r<<32-t|e>>>t,Da=(r,e,t)=>r<<64-t|e>>>t-32,Ra=(r,e,t)=>r>>>t-32|e<<64-t;function Ur(r,e,t,n){let o=(e>>>0)+(n>>>0);return{h:r+t+(o/2**32|0)|0,l:o|0}}var U0=(r,e,t)=>(r>>>0)+(e>>>0)+(t>>>0),M0=(r,e,t,n)=>e+t+n+(r/2**32|0)|0,j0=(r,e,t,n)=>(r>>>0)+(e>>>0)+(t>>>0)+(n>>>0),K0=(r,e,t,n,o)=>e+t+n+o+(r/2**32|0)|0,H0=(r,e,t,n,o)=>(r>>>0)+(e>>>0)+(t>>>0)+(n>>>0)+(o>>>0),V0=(r,e,t,n,o,i)=>e+t+n+o+i+(r/2**32|0)|0;var LE=Uint32Array.from([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]),Wn=new Uint32Array(64),Up=class extends Na{constructor(e){super(64,e,8,!1)}get(){let{A:e,B:t,C:n,D:o,E:i,F:s,G:a,H:c}=this;return[e,t,n,o,i,s,a,c]}set(e,t,n,o,i,s,a,c){this.A=e|0,this.B=t|0,this.C=n|0,this.D=o|0,this.E=i|0,this.F=s|0,this.G=a|0,this.H=c|0}process(e,t){for(let h=0;h<16;h++,t+=4)Wn[h]=e.getUint32(t,!1);for(let h=16;h<64;h++){let y=Wn[h-15],b=Wn[h-2],g=wr(y,7)^wr(y,18)^y>>>3,C=wr(b,17)^wr(b,19)^b>>>10;Wn[h]=C+Wn[h-7]+g+Wn[h-16]|0}let{A:n,B:o,C:i,D:s,E:a,F:c,G:f,H:p}=this;for(let h=0;h<64;h++){let y=wr(a,6)^wr(a,11)^wr(a,25),b=p+y+N0(a,c,f)+LE[h]+Wn[h]|0,C=(wr(n,2)^wr(n,13)^wr(n,22))+D0(n,o,i)|0;p=f,f=c,c=a,a=s+b|0,s=i,i=o,o=n,n=b+C|0}n=n+this.A|0,o=o+this.B|0,i=i+this.C|0,s=s+this.D|0,a=a+this.E|0,c=c+this.F|0,f=f+this.G|0,p=p+this.H|0,this.set(n,o,i,s,a,c,f,p)}roundClean(){br(Wn)}destroy(){this.set(0,0,0,0,0,0,0,0),br(this.buffer)}},Mp=class extends Up{A=ln[0]|0;B=ln[1]|0;C=ln[2]|0;D=ln[3]|0;E=ln[4]|0;F=ln[5]|0;G=ln[6]|0;H=ln[7]|0;constructor(){super(32)}};var $0=L0(["0x428a2f98d728ae22","0x7137449123ef65cd","0xb5c0fbcfec4d3b2f","0xe9b5dba58189dbbc","0x3956c25bf348b538","0x59f111f1b605d019","0x923f82a4af194f9b","0xab1c5ed5da6d8118","0xd807aa98a3030242","0x12835b0145706fbe","0x243185be4ee4b28c","0x550c7dc3d5ffb4e2","0x72be5d74f27b896f","0x80deb1fe3b1696b1","0x9bdc06a725c71235","0xc19bf174cf692694","0xe49b69c19ef14ad2","0xefbe4786384f25e3","0x0fc19dc68b8cd5b5","0x240ca1cc77ac9c65","0x2de92c6f592b0275","0x4a7484aa6ea6e483","0x5cb0a9dcbd41fbd4","0x76f988da831153b5","0x983e5152ee66dfab","0xa831c66d2db43210","0xb00327c898fb213f","0xbf597fc7beef0ee4","0xc6e00bf33da88fc2","0xd5a79147930aa725","0x06ca6351e003826f","0x142929670a0e6e70","0x27b70a8546d22ffc","0x2e1b21385c26c926","0x4d2c6dfc5ac42aed","0x53380d139d95b3df","0x650a73548baf63de","0x766a0abb3c77b2a8","0x81c2c92e47edaee6","0x92722c851482353b","0xa2bfe8a14cf10364","0xa81a664bbc423001","0xc24b8b70d0f89791","0xc76c51a30654be30","0xd192e819d6ef5218","0xd69906245565a910","0xf40e35855771202a","0x106aa07032bbd1b8","0x19a4c116b8d2d0c8","0x1e376c085141ab53","0x2748774cdf8eeb99","0x34b0bcb5e19b48a8","0x391c0cb3c5c95a63","0x4ed8aa4ae3418acb","0x5b9cca4f7763e373","0x682e6ff3d6b2b8a3","0x748f82ee5defb2fc","0x78a5636f43172f60","0x84c87814a1f0ab72","0x8cc702081a6439ec","0x90befffa23631e28","0xa4506cebde82bde9","0xbef9a3f7b2c67915","0xc67178f2e372532b","0xca273eceea26619c","0xd186b8c721c0c207","0xeada7dd6cde0eb1e","0xf57d4f7fee6ed178","0x06f067aa72176fba","0x0a637dc5a2c898a6","0x113f9804bef90dae","0x1b710b35131c471b","0x28db77f523047d84","0x32caab7b40c72493","0x3c9ebe0a15c9bebc","0x431d67c49c100d4c","0x4cc5d4becb3e42b6","0x597f299cfc657e2a","0x5fcb6fab3ad6faec","0x6c44198c4a475817"].map(r=>BigInt(r))),UE=$0[0],ME=$0[1],qn=new Uint32Array(80),Gn=new Uint32Array(80),jp=class extends Na{constructor(e){super(128,e,16,!1)}get(){let{Ah:e,Al:t,Bh:n,Bl:o,Ch:i,Cl:s,Dh:a,Dl:c,Eh:f,El:p,Fh:h,Fl:y,Gh:b,Gl:g,Hh:C,Hl:m}=this;return[e,t,n,o,i,s,a,c,f,p,h,y,b,g,C,m]}set(e,t,n,o,i,s,a,c,f,p,h,y,b,g,C,m){this.Ah=e|0,this.Al=t|0,this.Bh=n|0,this.Bl=o|0,this.Ch=i|0,this.Cl=s|0,this.Dh=a|0,this.Dl=c|0,this.Eh=f|0,this.El=p|0,this.Fh=h|0,this.Fl=y|0,this.Gh=b|0,this.Gl=g|0,this.Hh=C|0,this.Hl=m|0}process(e,t){for(let I=0;I<16;I++,t+=4)qn[I]=e.getUint32(t),Gn[I]=e.getUint32(t+=4);for(let I=16;I<80;I++){let K=qn[I-15]|0,Z=Gn[I-15]|0,q=Uo(K,Z,1)^Uo(K,Z,8)^Rp(K,Z,7),re=Mo(K,Z,1)^Mo(K,Z,8)^Lp(K,Z,7),R=qn[I-2]|0,k=Gn[I-2]|0,G=Uo(R,k,19)^Da(R,k,61)^Rp(R,k,6),Y=Mo(R,k,19)^Ra(R,k,61)^Lp(R,k,6),V=j0(re,Y,Gn[I-7],Gn[I-16]),B=K0(V,q,G,qn[I-7],qn[I-16]);qn[I]=B|0,Gn[I]=V|0}let{Ah:n,Al:o,Bh:i,Bl:s,Ch:a,Cl:c,Dh:f,Dl:p,Eh:h,El:y,Fh:b,Fl:g,Gh:C,Gl:m,Hh:S,Hl:N}=this;for(let I=0;I<80;I++){let K=Uo(h,y,14)^Uo(h,y,18)^Da(h,y,41),Z=Mo(h,y,14)^Mo(h,y,18)^Ra(h,y,41),q=h&b^~h&C,re=y&g^~y&m,R=H0(N,Z,re,ME[I],Gn[I]),k=V0(R,S,K,q,UE[I],qn[I]),G=R|0,Y=Uo(n,o,28)^Da(n,o,34)^Da(n,o,39),V=Mo(n,o,28)^Ra(n,o,34)^Ra(n,o,39),B=n&i^n&a^i&a,A=o&s^o&c^s&c;S=C|0,N=m|0,C=b|0,m=g|0,b=h|0,g=y|0,{h,l:y}=Ur(f|0,p|0,k|0,G|0),f=a|0,p=c|0,a=i|0,c=s|0,i=n|0,s=o|0;let v=U0(G,V,A);n=M0(v,k,Y,B),o=v|0}({h:n,l:o}=Ur(this.Ah|0,this.Al|0,n|0,o|0)),{h:i,l:s}=Ur(this.Bh|0,this.Bl|0,i|0,s|0),{h:a,l:c}=Ur(this.Ch|0,this.Cl|0,a|0,c|0),{h:f,l:p}=Ur(this.Dh|0,this.Dl|0,f|0,p|0),{h,l:y}=Ur(this.Eh|0,this.El|0,h|0,y|0),{h:b,l:g}=Ur(this.Fh|0,this.Fl|0,b|0,g|0),{h:C,l:m}=Ur(this.Gh|0,this.Gl|0,C|0,m|0),{h:S,l:N}=Ur(this.Hh|0,this.Hl|0,S|0,N|0),this.set(n,o,i,s,a,c,f,p,h,y,b,g,C,m,S,N)}roundClean(){br(qn,Gn)}destroy(){br(this.buffer),this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0)}},Kp=class extends jp{Ah=ft[0]|0;Al=ft[1]|0;Bh=ft[2]|0;Bl=ft[3]|0;Ch=ft[4]|0;Cl=ft[5]|0;Dh=ft[6]|0;Dl=ft[7]|0;Eh=ft[8]|0;El=ft[9]|0;Fh=ft[10]|0;Fl=ft[11]|0;Gh=ft[12]|0;Gl=ft[13]|0;Hh=ft[14]|0;Hl=ft[15]|0;constructor(){super(64)}};var Mr=Np(()=>new Mp,Dp(1));var F0=Np(()=>new Kp,Dp(3));var Vp=BigInt(0),Hp=BigInt(1);function fn(r,e=""){if(typeof r!="boolean"){let t=e&&`"${e}" `;throw new Error(t+"expected boolean, got type="+typeof r)}return r}function W0(r){if(typeof r=="bigint"){if(!xl(r))throw new Error("positive bigint expected, got "+r)}else rr(r);return r}function La(r){let e=W0(r).toString(16);return e.length&1?"0"+e:e}function q0(r){if(typeof r!="string")throw new Error("hex string expected, got "+typeof r);return r===""?Vp:BigInt("0x"+r)}function os(r){return q0(cn(r))}function jr(r){return q0(cn(jo(fe(r)).reverse()))}function vl(r,e){rr(e),r=W0(r);let t=un(r.toString(16).padStart(e*2,"0"));if(t.length!==e)throw new Error("number too large");return t}function Ua(r,e){return vl(r,e).reverse()}function jo(r){return Uint8Array.from(r)}var xl=r=>typeof r=="bigint"&&Vp<=r;function jE(r,e,t){return xl(r)&&xl(e)&&xl(t)&&e<=r&&r<t}function zn(r,e,t,n){if(!jE(e,t,n))throw new Error("expected valid "+r+": "+t+" <= n < "+n+", got "+e)}function $p(r){let e;for(e=0;r>Vp;r>>=Hp,e+=1);return e}var Ma=r=>(Hp<<BigInt(r))-Hp;function G0(r,e,t){if(rr(r,"hashLen"),rr(e,"qByteLen"),typeof t!="function")throw new Error("hmacFn must be a function");let n=m=>new Uint8Array(m),o=Uint8Array.of(),i=Uint8Array.of(0),s=Uint8Array.of(1),a=1e3,c=n(r),f=n(r),p=0,h=()=>{c.fill(1),f.fill(0),p=0},y=(...m)=>t(f,Lt(c,...m)),b=(m=o)=>{f=y(i,m),c=y(),m.length!==0&&(f=y(s,m),c=y())},g=()=>{if(p++>=a)throw new Error("drbg: tried max amount of iterations");let m=0,S=[];for(;m<e;){c=y();let N=c.slice();S.push(N),m+=c.length}return Lt(...S)};return(m,S)=>{h(),b(m);let N;for(;!(N=S(g()));)b();return h(),N}}function Kr(r,e={},t={}){if(!r||typeof r!="object")throw new Error("expected valid options object");function n(i,s,a){let c=r[i];if(a&&c===void 0)return;let f=typeof c;if(f!==s||c===null)throw new Error(`param "${i}" is invalid: expected ${s}, got ${f}`)}let o=(i,s)=>Object.entries(i).forEach(([a,c])=>n(a,c,s));o(e,!1),o(t,!0)}function is(r){let e=new WeakMap;return(t,...n)=>{let o=e.get(t);if(o!==void 0)return o;let i=r(t,...n);return e.set(t,i),i}}var Ot=BigInt(0),st=BigInt(1),Ko=BigInt(2),Z0=BigInt(3),Y0=BigInt(4),J0=BigInt(5),KE=BigInt(7),Q0=BigInt(8),HE=BigInt(9),eb=BigInt(16);function He(r,e){let t=r%e;return t>=Ot?t:e+t}function Le(r,e,t){let n=r;for(;e-- >Ot;)n*=n,n%=t;return n}function z0(r,e){if(r===Ot)throw new Error("invert: expected non-zero number");if(e<=Ot)throw new Error("invert: expected positive modulus, got "+e);let t=He(r,e),n=e,o=Ot,i=st,s=st,a=Ot;for(;t!==Ot;){let f=n/t,p=n%t,h=o-s*f,y=i-a*f;n=t,t=p,o=s,i=a,s=h,a=y}if(n!==st)throw new Error("invert: does not exist");return He(o,e)}function Wp(r,e,t){if(!r.eql(r.sqr(e),t))throw new Error("Cannot find square root")}function tb(r,e){let t=(r.ORDER+st)/Y0,n=r.pow(e,t);return Wp(r,n,e),n}function VE(r,e){let t=(r.ORDER-J0)/Q0,n=r.mul(e,Ko),o=r.pow(n,t),i=r.mul(e,o),s=r.mul(r.mul(i,Ko),o),a=r.mul(i,r.sub(s,r.ONE));return Wp(r,a,e),a}function $E(r){let e=ss(r),t=rb(r),n=t(e,e.neg(e.ONE)),o=t(e,n),i=t(e,e.neg(n)),s=(r+KE)/eb;return(a,c)=>{let f=a.pow(c,s),p=a.mul(f,n),h=a.mul(f,o),y=a.mul(f,i),b=a.eql(a.sqr(p),c),g=a.eql(a.sqr(h),c);f=a.cmov(f,p,b),p=a.cmov(y,h,g);let C=a.eql(a.sqr(p),c),m=a.cmov(f,p,C);return Wp(a,m,c),m}}function rb(r){if(r<Z0)throw new Error("sqrt is not defined for small field");let e=r-st,t=0;for(;e%Ko===Ot;)e/=Ko,t++;let n=Ko,o=ss(r);for(;X0(o,n)===1;)if(n++>1e3)throw new Error("Cannot find square root: probably non-prime P");if(t===1)return tb;let i=o.pow(n,e),s=(e+st)/Ko;return function(c,f){if(c.is0(f))return f;if(X0(c,f)!==1)throw new Error("Cannot find square root");let p=t,h=c.mul(c.ONE,i),y=c.pow(f,e),b=c.pow(f,s);for(;!c.eql(y,c.ONE);){if(c.is0(y))return c.ZERO;let g=1,C=c.sqr(y);for(;!c.eql(C,c.ONE);)if(g++,C=c.sqr(C),g===p)throw new Error("Cannot find square root");let m=st<<BigInt(p-g-1),S=c.pow(h,m);p=g,h=c.sqr(S),y=c.mul(y,h),b=c.mul(b,S)}return b}}function FE(r){return r%Y0===Z0?tb:r%Q0===J0?VE:r%eb===HE?$E(r):rb(r)}var nb=(r,e)=>(He(r,e)&st)===st,WE=["create","isValid","is0","neg","inv","sqrt","sqr","eql","add","sub","mul","pow","div","addN","subN","mulN","sqrN"];function qp(r){let e={ORDER:"bigint",BYTES:"number",BITS:"number"},t=WE.reduce((n,o)=>(n[o]="function",n),e);return Kr(r,t),r}function qE(r,e,t){if(t<Ot)throw new Error("invalid exponent, negatives unsupported");if(t===Ot)return r.ONE;if(t===st)return e;let n=r.ONE,o=e;for(;t>Ot;)t&st&&(n=r.mul(n,o)),o=r.sqr(o),t>>=st;return n}function ja(r,e,t=!1){let n=new Array(e.length).fill(t?r.ZERO:void 0),o=e.reduce((s,a,c)=>r.is0(a)?s:(n[c]=s,r.mul(s,a)),r.ONE),i=r.inv(o);return e.reduceRight((s,a,c)=>r.is0(a)?s:(n[c]=r.mul(s,n[c]),r.mul(s,a)),i),n}function X0(r,e){let t=(r.ORDER-st)/Ko,n=r.pow(e,t),o=r.eql(n,r.ONE),i=r.eql(n,r.ZERO),s=r.eql(n,r.neg(r.ONE));if(!o&&!i&&!s)throw new Error("invalid Legendre symbol result");return o?1:i?0:-1}function GE(r,e){e!==void 0&&rr(e);let t=e!==void 0?e:r.toString(2).length,n=Math.ceil(t/8);return{nBitLength:t,nByteLength:n}}var Fp=class{ORDER;BITS;BYTES;isLE;ZERO=Ot;ONE=st;_lengths;_sqrt;_mod;constructor(e,t={}){if(e<=Ot)throw new Error("invalid field: expected ORDER > 0, got "+e);let n;this.isLE=!1,t!=null&&typeof t=="object"&&(typeof t.BITS=="number"&&(n=t.BITS),typeof t.sqrt=="function"&&(this.sqrt=t.sqrt),typeof t.isLE=="boolean"&&(this.isLE=t.isLE),t.allowedLengths&&(this._lengths=t.allowedLengths?.slice()),typeof t.modFromBytes=="boolean"&&(this._mod=t.modFromBytes));let{nBitLength:o,nByteLength:i}=GE(e,n);if(i>2048)throw new Error("invalid field: expected ORDER of <= 2048 bytes");this.ORDER=e,this.BITS=o,this.BYTES=i,this._sqrt=void 0,Object.preventExtensions(this)}create(e){return He(e,this.ORDER)}isValid(e){if(typeof e!="bigint")throw new Error("invalid field element: expected bigint, got "+typeof e);return Ot<=e&&e<this.ORDER}is0(e){return e===Ot}isValidNot0(e){return!this.is0(e)&&this.isValid(e)}isOdd(e){return(e&st)===st}neg(e){return He(-e,this.ORDER)}eql(e,t){return e===t}sqr(e){return He(e*e,this.ORDER)}add(e,t){return He(e+t,this.ORDER)}sub(e,t){return He(e-t,this.ORDER)}mul(e,t){return He(e*t,this.ORDER)}pow(e,t){return qE(this,e,t)}div(e,t){return He(e*z0(t,this.ORDER),this.ORDER)}sqrN(e){return e*e}addN(e,t){return e+t}subN(e,t){return e-t}mulN(e,t){return e*t}inv(e){return z0(e,this.ORDER)}sqrt(e){return this._sqrt||(this._sqrt=FE(this.ORDER)),this._sqrt(this,e)}toBytes(e){return this.isLE?Ua(e,this.BYTES):vl(e,this.BYTES)}fromBytes(e,t=!1){fe(e);let{_lengths:n,BYTES:o,isLE:i,ORDER:s,_mod:a}=this;if(n){if(!n.includes(e.length)||e.length>o)throw new Error("Field.fromBytes: expected "+n+" bytes, got "+e.length);let f=new Uint8Array(o);f.set(e,i?0:f.length-e.length),e=f}if(e.length!==o)throw new Error("Field.fromBytes: expected "+o+" bytes, got "+e.length);let c=i?jr(e):os(e);if(a&&(c=He(c,s)),!t&&!this.isValid(c))throw new Error("invalid field element: outside of range 0..ORDER");return c}invertBatch(e){return ja(this,e)}cmov(e,t,n){return n?t:e}};function ss(r,e={}){return new Fp(r,e)}function ob(r){if(typeof r!="bigint")throw new Error("field order must be bigint");let e=r.toString(2).length;return Math.ceil(e/8)}function Gp(r){let e=ob(r);return e+Math.ceil(e/2)}function zp(r,e,t=!1){fe(r);let n=r.length,o=ob(e),i=Gp(e);if(n<16||n<i||n>1024)throw new Error("expected "+i+"-1024 bytes of input, got "+n);let s=t?jr(r):os(r),a=He(s,e-st)+st;return t?Ua(a,o):vl(a,o)}var as=BigInt(0),Ho=BigInt(1);function Ka(r,e){let t=e.negate();return r?t:e}function Vo(r,e){let t=ja(r.Fp,e.map(n=>n.Z));return e.map((n,o)=>r.fromAffine(n.toAffine(t[o])))}function cb(r,e){if(!Number.isSafeInteger(r)||r<=0||r>e)throw new Error("invalid window size, expected [1.."+e+"], got W="+r)}function Xp(r,e){cb(r,e);let t=Math.ceil(e/r)+1,n=2**(r-1),o=2**r,i=Ma(r),s=BigInt(r);return{windows:t,windowSize:n,mask:i,maxNumber:o,shiftBy:s}}function ib(r,e,t){let{windowSize:n,mask:o,maxNumber:i,shiftBy:s}=t,a=Number(r&o),c=r>>s;a>n&&(a-=i,c+=Ho);let f=e*n,p=f+Math.abs(a)-1,h=a===0,y=a<0,b=e%2!==0;return{nextN:c,offset:p,isZero:h,isNeg:y,isNegF:b,offsetF:f}}var Zp=new WeakMap,ub=new WeakMap;function Yp(r){return ub.get(r)||1}function sb(r){if(r!==as)throw new Error("invalid wNAF")}var cs=class{BASE;ZERO;Fn;bits;constructor(e,t){this.BASE=e.BASE,this.ZERO=e.ZERO,this.Fn=e.Fn,this.bits=t}_unsafeLadder(e,t,n=this.ZERO){let o=e;for(;t>as;)t&Ho&&(n=n.add(o)),o=o.double(),t>>=Ho;return n}precomputeWindow(e,t){let{windows:n,windowSize:o}=Xp(t,this.bits),i=[],s=e,a=s;for(let c=0;c<n;c++){a=s,i.push(a);for(let f=1;f<o;f++)a=a.add(s),i.push(a);s=a.double()}return i}wNAF(e,t,n){if(!this.Fn.isValid(n))throw new Error("invalid scalar");let o=this.ZERO,i=this.BASE,s=Xp(e,this.bits);for(let a=0;a<s.windows;a++){let{nextN:c,offset:f,isZero:p,isNeg:h,isNegF:y,offsetF:b}=ib(n,a,s);n=c,p?i=i.add(Ka(y,t[b])):o=o.add(Ka(h,t[f]))}return sb(n),{p:o,f:i}}wNAFUnsafe(e,t,n,o=this.ZERO){let i=Xp(e,this.bits);for(let s=0;s<i.windows&&n!==as;s++){let{nextN:a,offset:c,isZero:f,isNeg:p}=ib(n,s,i);if(n=a,!f){let h=t[c];o=o.add(p?h.negate():h)}}return sb(n),o}getPrecomputes(e,t,n){let o=Zp.get(t);return o||(o=this.precomputeWindow(t,e),e!==1&&(typeof n=="function"&&(o=n(o)),Zp.set(t,o))),o}cached(e,t,n){let o=Yp(e);return this.wNAF(o,this.getPrecomputes(o,e,n),t)}unsafe(e,t,n,o){let i=Yp(e);return i===1?this._unsafeLadder(e,t,o):this.wNAFUnsafe(i,this.getPrecomputes(i,e,n),t,o)}createCache(e,t){cb(t,this.bits),ub.set(e,t),Zp.delete(e)}hasCache(e){return Yp(e)!==1}};function lb(r,e,t,n){let o=e,i=r.ZERO,s=r.ZERO;for(;t>as||n>as;)t&Ho&&(i=i.add(o)),n&Ho&&(s=s.add(o)),o=o.double(),t>>=Ho,n>>=Ho;return{p1:i,p2:s}}function ab(r,e,t){if(e){if(e.ORDER!==r)throw new Error("Field.ORDER must match order: Fp == p, Fn == n");return qp(e),e}else return ss(r,{isLE:t})}function Al(r,e,t={},n){if(n===void 0&&(n=r==="edwards"),!e||typeof e!="object")throw new Error(`expected valid ${r} CURVE object`);for(let c of["p","n","h"]){let f=e[c];if(!(typeof f=="bigint"&&f>as))throw new Error(`CURVE.${c} must be positive bigint`)}let o=ab(e.p,t.Fp,n),i=ab(e.n,t.Fn,n),a=["Gx","Gy","a",r==="weierstrass"?"b":"d"];for(let c of a)if(!o.isValid(e[c]))throw new Error(`CURVE.${c} must be valid field element of CURVE.Fp`);return e=Object.freeze(Object.assign({},e)),{CURVE:e,Fp:o,Fn:i}}function us(r,e){return function(n){let o=r(n);return{secretKey:o,publicKey:e(o)}}}var Xn=BigInt(0),at=BigInt(1),Jp=BigInt(2),zE=BigInt(8);function XE(r,e,t,n){let o=r.sqr(t),i=r.sqr(n),s=r.add(r.mul(e.a,o),i),a=r.add(r.ONE,r.mul(e.d,r.mul(o,i)));return r.eql(s,a)}function fb(r,e={}){let t=Al("edwards",r,e,e.FpFnLE),{Fp:n,Fn:o}=t,i=t.CURVE,{h:s}=i;Kr(e,{},{uvRatio:"function"});let a=Jp<<BigInt(o.BYTES*8)-at,c=m=>n.create(m),f=e.uvRatio||((m,S)=>{try{return{isValid:!0,value:n.sqrt(n.div(m,S))}}catch{return{isValid:!1,value:Xn}}});if(!XE(n,i,i.Gx,i.Gy))throw new Error("bad curve params: generator point");function p(m,S,N=!1){let I=N?at:Xn;return zn("coordinate "+m,S,I,a),S}function h(m){if(!(m instanceof g))throw new Error("EdwardsPoint expected")}let y=is((m,S)=>{let{X:N,Y:I,Z:K}=m,Z=m.is0();S==null&&(S=Z?zE:n.inv(K));let q=c(N*S),re=c(I*S),R=n.mul(K,S);if(Z)return{x:Xn,y:at};if(R!==at)throw new Error("invZ was invalid");return{x:q,y:re}}),b=is(m=>{let{a:S,d:N}=i;if(m.is0())throw new Error("bad point: ZERO");let{X:I,Y:K,Z,T:q}=m,re=c(I*I),R=c(K*K),k=c(Z*Z),G=c(k*k),Y=c(re*S),V=c(k*c(Y+R)),B=c(G+c(N*c(re*R)));if(V!==B)throw new Error("bad point: equation left != right (1)");let A=c(I*K),v=c(Z*q);if(A!==v)throw new Error("bad point: equation left != right (2)");return!0});class g{static BASE=new g(i.Gx,i.Gy,at,c(i.Gx*i.Gy));static ZERO=new g(Xn,at,at,Xn);static Fp=n;static Fn=o;X;Y;Z;T;constructor(S,N,I,K){this.X=p("x",S),this.Y=p("y",N),this.Z=p("z",I,!0),this.T=p("t",K),Object.freeze(this)}static CURVE(){return i}static fromAffine(S){if(S instanceof g)throw new Error("extended point not allowed");let{x:N,y:I}=S||{};return p("x",N),p("y",I),new g(N,I,at,c(N*I))}static fromBytes(S,N=!1){let I=n.BYTES,{a:K,d:Z}=i;S=jo(fe(S,I,"point")),fn(N,"zip215");let q=jo(S),re=S[I-1];q[I-1]=re&-129;let R=jr(q),k=N?a:n.ORDER;zn("point.y",R,Xn,k);let G=c(R*R),Y=c(G-at),V=c(Z*G-K),{isValid:B,value:A}=f(Y,V);if(!B)throw new Error("bad point: invalid y coordinate");let v=(A&at)===at,D=(re&128)!==0;if(!N&&A===Xn&&D)throw new Error("bad point: x=0 and x_0=1");return D!==v&&(A=c(-A)),g.fromAffine({x:A,y:R})}static fromHex(S,N=!1){return g.fromBytes(un(S),N)}get x(){return this.toAffine().x}get y(){return this.toAffine().y}precompute(S=8,N=!0){return C.createCache(this,S),N||this.multiply(Jp),this}assertValidity(){b(this)}equals(S){h(S);let{X:N,Y:I,Z:K}=this,{X:Z,Y:q,Z:re}=S,R=c(N*re),k=c(Z*K),G=c(I*re),Y=c(q*K);return R===k&&G===Y}is0(){return this.equals(g.ZERO)}negate(){return new g(c(-this.X),this.Y,this.Z,c(-this.T))}double(){let{a:S}=i,{X:N,Y:I,Z:K}=this,Z=c(N*N),q=c(I*I),re=c(Jp*c(K*K)),R=c(S*Z),k=N+I,G=c(c(k*k)-Z-q),Y=R+q,V=Y-re,B=R-q,A=c(G*V),v=c(Y*B),D=c(G*B),U=c(V*Y);return new g(A,v,U,D)}add(S){h(S);let{a:N,d:I}=i,{X:K,Y:Z,Z:q,T:re}=this,{X:R,Y:k,Z:G,T:Y}=S,V=c(K*R),B=c(Z*k),A=c(re*I*Y),v=c(q*G),D=c((K+Z)*(R+k)-V-B),U=v-A,L=v+A,T=c(B-N*V),M=c(D*U),W=c(L*T),O=c(D*T),pe=c(U*L);return new g(M,W,pe,O)}subtract(S){return this.add(S.negate())}multiply(S){if(!o.isValidNot0(S))throw new Error("invalid scalar: expected 1 <= sc < curve.n");let{p:N,f:I}=C.cached(this,S,K=>Vo(g,K));return Vo(g,[N,I])[0]}multiplyUnsafe(S,N=g.ZERO){if(!o.isValid(S))throw new Error("invalid scalar: expected 0 <= sc < curve.n");return S===Xn?g.ZERO:this.is0()||S===at?this:C.unsafe(this,S,I=>Vo(g,I),N)}isSmallOrder(){return this.multiplyUnsafe(s).is0()}isTorsionFree(){return C.unsafe(this,i.n).is0()}toAffine(S){return y(this,S)}clearCofactor(){return s===at?this:this.multiplyUnsafe(s)}toBytes(){let{x:S,y:N}=this.toAffine(),I=n.toBytes(N);return I[I.length-1]|=S&at?128:0,I}toHex(){return cn(this.toBytes())}toString(){return`<Point ${this.is0()?"ZERO":this.toHex()}>`}}let C=new cs(g,o.BITS);return g.BASE.precompute(8),g}function hb(r,e,t={}){if(typeof e!="function")throw new Error('"hash" function param is required');Kr(t,{},{adjustScalarBytes:"function",randomBytes:"function",domain:"function",prehash:"function",mapToCurve:"function"});let{prehash:n}=t,{BASE:o,Fp:i,Fn:s}=r,a=t.randomBytes||Fn,c=t.adjustScalarBytes||(R=>R),f=t.domain||((R,k,G)=>{if(fn(G,"phflag"),k.length||G)throw new Error("Contexts/pre-hash are not supported");return R});function p(R){return s.create(jr(R))}function h(R){let k=I.secretKey;fe(R,I.secretKey,"secretKey");let G=fe(e(R),2*k,"hashedSecretKey"),Y=c(G.slice(0,k)),V=G.slice(k,2*k),B=p(Y);return{head:Y,prefix:V,scalar:B}}function y(R){let{head:k,prefix:G,scalar:Y}=h(R),V=o.multiply(Y),B=V.toBytes();return{head:k,prefix:G,scalar:Y,point:V,pointBytes:B}}function b(R){return y(R).pointBytes}function g(R=Uint8Array.of(),...k){let G=Lt(...k);return p(e(f(G,fe(R,void 0,"context"),!!n)))}function C(R,k,G={}){R=fe(R,void 0,"message"),n&&(R=n(R));let{prefix:Y,scalar:V,pointBytes:B}=y(k),A=g(G.context,Y,R),v=o.multiply(A).toBytes(),D=g(G.context,v,B,R),U=s.create(A+D*V);if(!s.isValid(U))throw new Error("sign failed: invalid s");let L=Lt(v,s.toBytes(U));return fe(L,I.signature,"result")}let m={zip215:!0};function S(R,k,G,Y=m){let{context:V,zip215:B}=Y,A=I.signature;R=fe(R,A,"signature"),k=fe(k,void 0,"message"),G=fe(G,I.publicKey,"publicKey"),B!==void 0&&fn(B,"zip215"),n&&(k=n(k));let v=A/2,D=R.subarray(0,v),U=jr(R.subarray(v,A)),L,T,M;try{L=r.fromBytes(G,B),T=r.fromBytes(D,B),M=o.multiplyUnsafe(U)}catch{return!1}if(!B&&L.isSmallOrder())return!1;let W=g(V,T.toBytes(),L.toBytes(),k);return T.add(L.multiplyUnsafe(W)).subtract(M).clearCofactor().is0()}let N=i.BYTES,I={secretKey:N,publicKey:N,signature:2*N,seed:N};function K(R=a(I.seed)){return fe(R,I.seed,"seed")}function Z(R){return Ro(R)&&R.length===s.BYTES}function q(R,k){try{return!!r.fromBytes(R,k)}catch{return!1}}let re={getExtendedPublicKey:y,randomSecretKey:K,isValidSecretKey:Z,isValidPublicKey:q,toMontgomery(R){let{y:k}=r.fromBytes(R),G=I.publicKey,Y=G===32;if(!Y&&G!==57)throw new Error("only defined for 25519 and 448");let V=Y?i.div(at+k,at-k):i.div(k-at,k+at);return i.toBytes(V)},toMontgomerySecret(R){let k=I.secretKey;fe(R,k);let G=e(R.subarray(0,k));return c(G).subarray(0,k)}};return Object.freeze({keygen:us(K,b),getPublicKey:b,sign:C,verify:S,utils:re,Point:r,lengths:I})}var Ha=BigInt(0),ls=BigInt(1),Sl=BigInt(2);function ZE(r){return Kr(r,{adjustScalarBytes:"function",powPminus2:"function"}),Object.freeze({...r})}function pb(r){let e=ZE(r),{P:t,type:n,adjustScalarBytes:o,powPminus2:i,randomBytes:s}=e,a=n==="x25519";if(!a&&n!=="x448")throw new Error("invalid type");let c=s||Fn,f=a?255:448,p=a?32:56,h=BigInt(a?9:5),y=BigInt(a?121665:39081),b=a?Sl**BigInt(254):Sl**BigInt(447),g=a?BigInt(8)*Sl**BigInt(251)-ls:BigInt(4)*Sl**BigInt(445)-ls,C=b+g+ls,m=A=>He(A,t),S=N(h);function N(A){return Ua(m(A),p)}function I(A){let v=jo(fe(A,p,"uCoordinate"));return a&&(v[31]&=127),m(jr(v))}function K(A){return jr(o(jo(fe(A,p,"scalar"))))}function Z(A,v){let D=G(I(v),K(A));if(D===Ha)throw new Error("invalid private or public key received");return N(D)}function q(A){return Z(A,S)}let re=q,R=Z;function k(A,v,D){let U=m(A*(v-D));return v=m(v-U),D=m(D+U),{x_2:v,x_3:D}}function G(A,v){zn("u",A,Ha,t),zn("scalar",v,b,C);let D=v,U=A,L=ls,T=Ha,M=A,W=ls,O=Ha;for(let be=BigInt(f-1);be>=Ha;be--){let ee=D>>be&ls;O^=ee,{x_2:L,x_3:M}=k(O,L,M),{x_2:T,x_3:W}=k(O,T,W),O=ee;let Ae=L+T,Be=m(Ae*Ae),Ke=L-T,Ee=m(Ke*Ke),Ie=Be-Ee,nn=M+W,pr=M-W,jn=m(pr*Ae),Ju=m(nn*Ke),zi=jn+Ju,Aa=jn-Ju;M=m(zi*zi),W=m(U*m(Aa*Aa)),L=m(Be*Ee),T=m(Ie*(Be+m(y*Ie)))}({x_2:L,x_3:M}=k(O,L,M)),{x_2:T,x_3:W}=k(O,T,W);let pe=i(T);return m(L*pe)}let Y={secretKey:p,publicKey:p,seed:p},V=(A=c(p))=>(fe(A,Y.seed,"seed"),A),B={randomSecretKey:V};return Object.freeze({keygen:us(V,re),getSharedSecret:R,getPublicKey:re,scalarMult:Z,scalarMultBase:q,utils:B,GuBytes:S.slice(),lengths:Y})}var YE=BigInt(1),db=BigInt(2),JE=BigInt(3),QE=BigInt(5),e_=BigInt(8),El=BigInt("0x7fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffed"),t_={p:El,n:BigInt("0x1000000000000000000000000000000014def9dea2f79cd65812631a5cf5d3ed"),h:e_,a:BigInt("0x7fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffec"),d:BigInt("0x52036cee2b6ffe738cc740797779e89800700a4d4141d8ab75eb4dca135978a3"),Gx:BigInt("0x216936d3cd6e53fec0a4e231fdd6dc5c692cc7609525a7b2c9562d608f25d51a"),Gy:BigInt("0x6666666666666666666666666666666666666666666666666666666666666658")};function yb(r){let e=BigInt(10),t=BigInt(20),n=BigInt(40),o=BigInt(80),i=El,a=r*r%i*r%i,c=Le(a,db,i)*a%i,f=Le(c,YE,i)*r%i,p=Le(f,QE,i)*f%i,h=Le(p,e,i)*p%i,y=Le(h,t,i)*h%i,b=Le(y,n,i)*y%i,g=Le(b,o,i)*b%i,C=Le(g,o,i)*b%i,m=Le(C,e,i)*p%i;return{pow_p_5_8:Le(m,db,i)*r%i,b2:a}}function gb(r){return r[0]&=248,r[31]&=127,r[31]|=64,r}var mb=BigInt("19681161376707505956807079304988542015446066515923890162744021073123829784752");function r_(r,e){let t=El,n=He(e*e*e,t),o=He(n*n*e,t),i=yb(r*o).pow_p_5_8,s=He(r*n*i,t),a=He(e*s*s,t),c=s,f=He(s*mb,t),p=a===r,h=a===He(-r,t),y=a===He(-r*mb,t);return p&&(s=c),(h||y)&&(s=f),nb(s,t)&&(s=He(-s,t)),{isValid:p||h,value:s}}var n_=fb(t_,{uvRatio:r_});function o_(r){return hb(n_,F0,Object.assign({adjustScalarBytes:gb},r))}var Va=o_({});var $a=(()=>{let r=El;return pb({P:r,type:"x25519",powPminus2:e=>{let{pow_p_5_8:t,b2:n}=yb(e);return He(Le(t,JE,r)*n,r)},adjustScalarBytes:gb})})();var Fa=class extends Error{constructor(e="An error occurred while signing a message"){super(e),this.name="SigningError"}},Wa=class extends Error{constructor(e="An error occurred while verifying a message"){super(e),this.name="VerificationError"}},_l=class extends Error{constructor(e="Missing Web Crypto API"){super(e),this.name="WebCryptoMissingError"}};var bb={get(r=globalThis){let e=r.crypto;if(e?.subtle==null)throw new _l("Missing Web Crypto API. The most likely cause of this error is that this page is being accessed from an insecure context (i.e. not HTTPS). For more information and possible resolutions see https://github.com/libp2p/js-libp2p/blob/main/packages/crypto/README.md#web-crypto-api");return e}};var Ut=bb;var Cl=32,qa=64,Qp=32;var fs,wb=(async()=>{try{return await Ut.get().subtle.generateKey({name:"Ed25519"},!0,["sign","verify"]),!0}catch{return!1}})();function xb(){let r=Va.utils.randomSecretKey(),e=Va.getPublicKey(r);return{privateKey:u_(r,e),publicKey:e}}async function i_(r,e){let t;r.length===qa?t=r.subarray(0,32):t=r;let n={crv:"Ed25519",kty:"OKP",x:ue(r.subarray(32),"base64url"),d:ue(t,"base64url"),ext:!0,key_ops:["sign"]},o=await Ut.get().subtle.importKey("jwk",n,{name:"Ed25519"},!0,["sign"]),i=await Ut.get().subtle.sign({name:"Ed25519"},o,e instanceof Uint8Array?e:e.subarray());return new Uint8Array(i,0,i.byteLength)}function s_(r,e){let t=r.subarray(0,Qp);return Va.sign(e instanceof Uint8Array?e:e.subarray(),t)}async function vb(r,e){return fs==null&&(fs=await wb),fs?i_(r,e):s_(r,e)}async function a_(r,e,t){if(r.buffer instanceof ArrayBuffer){let n=await Ut.get().subtle.importKey("raw",r.buffer,{name:"Ed25519"},!1,["verify"]);return await Ut.get().subtle.verify({name:"Ed25519"},n,e,t instanceof Uint8Array?t:t.subarray())}throw new TypeError("WebCrypto does not support SharedArrayBuffer for Ed25519 keys")}function c_(r,e,t){return Va.verify(e,t instanceof Uint8Array?t:t.subarray(),r)}async function Ab(r,e,t){return fs==null&&(fs=await wb),fs?a_(r,e,t):c_(r,e,t)}function u_(r,e){let t=new Uint8Array(qa);for(let n=0;n<Qp;n++)t[n]=r[n],t[Qp+n]=e[n];return t}function hs(r){return r==null?!1:typeof r.then=="function"&&typeof r.catch=="function"&&typeof r.finally=="function"}var Ga=class{type="Ed25519";raw;constructor(e){this.raw=Il(e,Cl)}toMultihash(){return yr.digest($n(this))}toCID(){return rt.createV1(114,this.toMultihash())}toString(){return Fe.encode(this.toMultihash().bytes).substring(1)}equals(e){return e==null||!(e.raw instanceof Uint8Array)?!1:We(this.raw,e.raw)}verify(e,t,n){n?.signal?.throwIfAborted();let o=Ab(this.raw,t,e);return hs(o)?o.then(i=>(n?.signal?.throwIfAborted(),i)):o}},Bl=class{type="Ed25519";raw;publicKey;constructor(e,t){this.raw=Il(e,qa),this.publicKey=new Ga(t)}equals(e){return e==null||!(e.raw instanceof Uint8Array)?!1:We(this.raw,e.raw)}sign(e,t){t?.signal?.throwIfAborted();let n=vb(this.raw,e);return hs(n)?n.then(o=>(t?.signal?.throwIfAborted(),o)):(t?.signal?.throwIfAborted(),n)}};function ed(r){return r=Il(r,Cl),new Ga(r)}async function Eb(){let{privateKey:r,publicKey:e}=xb();return new Bl(r,e)}function Il(r,e){if(r=Uint8Array.from(r??[]),r.length!==e)throw new xe(`Key must be a Uint8Array of length ${e}, got ${r.length}`);return r}var l_=Math.pow(2,7),f_=Math.pow(2,14),h_=Math.pow(2,21),td=Math.pow(2,28),rd=Math.pow(2,35),nd=Math.pow(2,42),od=Math.pow(2,49),Te=128,St=127;function Ue(r){if(r<l_)return 1;if(r<f_)return 2;if(r<h_)return 3;if(r<td)return 4;if(r<rd)return 5;if(r<nd)return 6;if(r<od)return 7;if(Number.MAX_SAFE_INTEGER!=null&&r>Number.MAX_SAFE_INTEGER)throw new RangeError("Could not encode varint");return 8}function ps(r,e,t=0){switch(Ue(r)){case 8:e[t++]=r&255|Te,r/=128;case 7:e[t++]=r&255|Te,r/=128;case 6:e[t++]=r&255|Te,r/=128;case 5:e[t++]=r&255|Te,r/=128;case 4:e[t++]=r&255|Te,r>>>=7;case 3:e[t++]=r&255|Te,r>>>=7;case 2:e[t++]=r&255|Te,r>>>=7;case 1:{e[t++]=r&255,r>>>=7;break}default:throw new Error("unreachable")}return e}function p_(r,e,t=0){switch(Ue(r)){case 8:e.set(t++,r&255|Te),r/=128;case 7:e.set(t++,r&255|Te),r/=128;case 6:e.set(t++,r&255|Te),r/=128;case 5:e.set(t++,r&255|Te),r/=128;case 4:e.set(t++,r&255|Te),r>>>=7;case 3:e.set(t++,r&255|Te),r>>>=7;case 2:e.set(t++,r&255|Te),r>>>=7;case 1:{e.set(t++,r&255),r>>>=7;break}default:throw new Error("unreachable")}return e}function id(r,e){let t=r[e],n=0;if(n+=t&St,t<Te||(t=r[e+1],n+=(t&St)<<7,t<Te)||(t=r[e+2],n+=(t&St)<<14,t<Te)||(t=r[e+3],n+=(t&St)<<21,t<Te)||(t=r[e+4],n+=(t&St)*td,t<Te)||(t=r[e+5],n+=(t&St)*rd,t<Te)||(t=r[e+6],n+=(t&St)*nd,t<Te)||(t=r[e+7],n+=(t&St)*od,t<Te))return n;throw new RangeError("Could not decode varint")}function d_(r,e){let t=r.get(e),n=0;if(n+=t&St,t<Te||(t=r.get(e+1),n+=(t&St)<<7,t<Te)||(t=r.get(e+2),n+=(t&St)<<14,t<Te)||(t=r.get(e+3),n+=(t&St)<<21,t<Te)||(t=r.get(e+4),n+=(t&St)*td,t<Te)||(t=r.get(e+5),n+=(t&St)*rd,t<Te)||(t=r.get(e+6),n+=(t&St)*nd,t<Te)||(t=r.get(e+7),n+=(t&St)*od,t<Te))return n;throw new RangeError("Could not decode varint")}function Tl(r,e,t=0){return e==null&&(e=ot(Ue(r))),e instanceof Uint8Array?ps(r,e,t):p_(r,e,t)}function hn(r,e=0){return r instanceof Uint8Array?id(r,e):d_(r,e)}var sd=new Float32Array([-0]),Zn=new Uint8Array(sd.buffer);function _b(r,e,t){sd[0]=r,e[t]=Zn[0],e[t+1]=Zn[1],e[t+2]=Zn[2],e[t+3]=Zn[3]}function Cb(r,e){return Zn[0]=r[e],Zn[1]=r[e+1],Zn[2]=r[e+2],Zn[3]=r[e+3],sd[0]}var ad=new Float64Array([-0]),Et=new Uint8Array(ad.buffer);function Bb(r,e,t){ad[0]=r,e[t]=Et[0],e[t+1]=Et[1],e[t+2]=Et[2],e[t+3]=Et[3],e[t+4]=Et[4],e[t+5]=Et[5],e[t+6]=Et[6],e[t+7]=Et[7]}function Ib(r,e){return Et[0]=r[e],Et[1]=r[e+1],Et[2]=r[e+2],Et[3]=r[e+3],Et[4]=r[e+4],Et[5]=r[e+5],Et[6]=r[e+6],Et[7]=r[e+7],ad[0]}var m_=BigInt(Number.MAX_SAFE_INTEGER),y_=BigInt(Number.MIN_SAFE_INTEGER),zt=class r{lo;hi;constructor(e,t){this.lo=e|0,this.hi=t|0}toNumber(e=!1){if(!e&&this.hi>>>31>0){let t=~this.lo+1>>>0,n=~this.hi>>>0;return t===0&&(n=n+1>>>0),-(t+n*4294967296)}return this.lo+this.hi*4294967296}toBigInt(e=!1){if(e)return BigInt(this.lo>>>0)+(BigInt(this.hi>>>0)<<32n);if(this.hi>>>31){let t=~this.lo+1>>>0,n=~this.hi>>>0;return t===0&&(n=n+1>>>0),-(BigInt(t)+(BigInt(n)<<32n))}return BigInt(this.lo>>>0)+(BigInt(this.hi>>>0)<<32n)}toString(e=!1){return this.toBigInt(e).toString()}zzEncode(){let e=this.hi>>31;return this.hi=((this.hi<<1|this.lo>>>31)^e)>>>0,this.lo=(this.lo<<1^e)>>>0,this}zzDecode(){let e=-(this.lo&1);return this.lo=((this.lo>>>1|this.hi<<31)^e)>>>0,this.hi=(this.hi>>>1^e)>>>0,this}length(){let e=this.lo,t=(this.lo>>>28|this.hi<<4)>>>0,n=this.hi>>>24;return n===0?t===0?e<16384?e<128?1:2:e<2097152?3:4:t<16384?t<128?5:6:t<2097152?7:8:n<128?9:10}static fromBigInt(e){if(e===0n)return $o;if(e<m_&&e>y_)return this.fromNumber(Number(e));let t=e<0n;t&&(e=-e);let n=e>>32n,o=e-(n<<32n);return t&&(n=~n|0n,o=~o|0n,++o>Tb&&(o=0n,++n>Tb&&(n=0n))),new r(Number(o),Number(n))}static fromNumber(e){if(e===0)return $o;let t=e<0;t&&(e=-e);let n=e>>>0,o=(e-n)/4294967296>>>0;return t&&(o=~o>>>0,n=~n>>>0,++n>4294967295&&(n=0,++o>4294967295&&(o=0))),new r(n,o)}static from(e){return typeof e=="number"?r.fromNumber(e):typeof e=="bigint"?r.fromBigInt(e):typeof e=="string"?r.fromBigInt(BigInt(e)):e.low!=null||e.high!=null?new r(e.low>>>0,e.high>>>0):$o}},$o=new zt(0,0);$o.toBigInt=function(){return 0n};$o.zzEncode=$o.zzDecode=function(){return this};$o.length=function(){return 1};var Tb=4294967296n;function kb(r){let e=0,t=0;for(let n=0;n<r.length;++n)t=r.charCodeAt(n),t<128?e+=1:t<2048?e+=2:(t&64512)===55296&&(r.charCodeAt(n+1)&64512)===56320?(++n,e+=4):e+=3;return e}function Ob(r,e,t){if(t-e<1)return"";let o,i=[],s=0,a;for(;e<t;)a=r[e++],a<128?i[s++]=a:a>191&&a<224?i[s++]=(a&31)<<6|r[e++]&63:a>239&&a<365?(a=((a&7)<<18|(r[e++]&63)<<12|(r[e++]&63)<<6|r[e++]&63)-65536,i[s++]=55296+(a>>10),i[s++]=56320+(a&1023)):i[s++]=(a&15)<<12|(r[e++]&63)<<6|r[e++]&63,s>8191&&((o??(o=[])).push(String.fromCharCode.apply(String,i)),s=0);return o!=null?(s>0&&o.push(String.fromCharCode.apply(String,i.slice(0,s))),o.join("")):String.fromCharCode.apply(String,i.slice(0,s))}function cd(r,e,t){let n=t,o,i;for(let s=0;s<r.length;++s)o=r.charCodeAt(s),o<128?e[t++]=o:o<2048?(e[t++]=o>>6|192,e[t++]=o&63|128):(o&64512)===55296&&((i=r.charCodeAt(s+1))&64512)===56320?(o=65536+((o&1023)<<10)+(i&1023),++s,e[t++]=o>>18|240,e[t++]=o>>12&63|128,e[t++]=o>>6&63|128,e[t++]=o&63|128):(e[t++]=o>>12|224,e[t++]=o>>6&63|128,e[t++]=o&63|128);return t-n}function xr(r,e){return RangeError(`index out of range: ${r.pos} + ${e??1} > ${r.len}`)}function kl(r,e){return(r[e-4]|r[e-3]<<8|r[e-2]<<16|r[e-1]<<24)>>>0}var ud=class{buf;pos;len;_slice=Uint8Array.prototype.subarray;constructor(e){this.buf=e,this.pos=0,this.len=e.length}uint32(){let e=4294967295;if(e=(this.buf[this.pos]&127)>>>0,this.buf[this.pos++]<128||(e=(e|(this.buf[this.pos]&127)<<7)>>>0,this.buf[this.pos++]<128)||(e=(e|(this.buf[this.pos]&127)<<14)>>>0,this.buf[this.pos++]<128)||(e=(e|(this.buf[this.pos]&127)<<21)>>>0,this.buf[this.pos++]<128)||(e=(e|(this.buf[this.pos]&15)<<28)>>>0,this.buf[this.pos++]<128))return e;if((this.pos+=5)>this.len)throw this.pos=this.len,xr(this,10);return e}int32(){return this.uint32()|0}sint32(){let e=this.uint32();return e>>>1^-(e&1)|0}bool(){return this.uint32()!==0}fixed32(){if(this.pos+4>this.len)throw xr(this,4);return kl(this.buf,this.pos+=4)}sfixed32(){if(this.pos+4>this.len)throw xr(this,4);return kl(this.buf,this.pos+=4)|0}float(){if(this.pos+4>this.len)throw xr(this,4);let e=Cb(this.buf,this.pos);return this.pos+=4,e}double(){if(this.pos+8>this.len)throw xr(this,4);let e=Ib(this.buf,this.pos);return this.pos+=8,e}bytes(){let e=this.uint32(),t=this.pos,n=this.pos+e;if(n>this.len)throw xr(this,e);return this.pos+=e,t===n?new Uint8Array(0):this.buf.subarray(t,n)}string(){let e=this.bytes();return Ob(e,0,e.length)}skip(e){if(typeof e=="number"){if(this.pos+e>this.len)throw xr(this,e);this.pos+=e}else do if(this.pos>=this.len)throw xr(this);while((this.buf[this.pos++]&128)!==0);return this}skipType(e){switch(e){case 0:this.skip();break;case 1:this.skip(8);break;case 2:this.skip(this.uint32());break;case 3:for(;(e=this.uint32()&7)!==4;)this.skipType(e);break;case 5:this.skip(4);break;default:throw Error(`invalid wire type ${e} at offset ${this.pos}`)}return this}readLongVarint(){let e=new zt(0,0),t=0;if(this.len-this.pos>4){for(;t<4;++t)if(e.lo=(e.lo|(this.buf[this.pos]&127)<<t*7)>>>0,this.buf[this.pos++]<128)return e;if(e.lo=(e.lo|(this.buf[this.pos]&127)<<28)>>>0,e.hi=(e.hi|(this.buf[this.pos]&127)>>4)>>>0,this.buf[this.pos++]<128)return e;t=0}else{for(;t<3;++t){if(this.pos>=this.len)throw xr(this);if(e.lo=(e.lo|(this.buf[this.pos]&127)<<t*7)>>>0,this.buf[this.pos++]<128)return e}return e.lo=(e.lo|(this.buf[this.pos++]&127)<<t*7)>>>0,e}if(this.len-this.pos>4){for(;t<5;++t)if(e.hi=(e.hi|(this.buf[this.pos]&127)<<t*7+3)>>>0,this.buf[this.pos++]<128)return e}else for(;t<5;++t){if(this.pos>=this.len)throw xr(this);if(e.hi=(e.hi|(this.buf[this.pos]&127)<<t*7+3)>>>0,this.buf[this.pos++]<128)return e}throw Error("invalid varint encoding")}readFixed64(){if(this.pos+8>this.len)throw xr(this,8);let e=kl(this.buf,this.pos+=4),t=kl(this.buf,this.pos+=4);return new zt(e,t)}int64(){return this.readLongVarint().toBigInt()}int64Number(){return this.readLongVarint().toNumber()}int64String(){return this.readLongVarint().toString()}uint64(){return this.readLongVarint().toBigInt(!0)}uint64Number(){let e=id(this.buf,this.pos);return this.pos+=Ue(e),e}uint64String(){return this.readLongVarint().toString(!0)}sint64(){return this.readLongVarint().zzDecode().toBigInt()}sint64Number(){return this.readLongVarint().zzDecode().toNumber()}sint64String(){return this.readLongVarint().zzDecode().toString()}fixed64(){return this.readFixed64().toBigInt()}fixed64Number(){return this.readFixed64().toNumber()}fixed64String(){return this.readFixed64().toString()}sfixed64(){return this.readFixed64().toBigInt()}sfixed64Number(){return this.readFixed64().toNumber()}sfixed64String(){return this.readFixed64().toString()}};function ld(r){return new ud(r instanceof Uint8Array?r:r.subarray())}function vr(r,e,t){let n=ld(r);return e.decode(n,void 0,t)}function fd(r){let e=r??8192,t=e>>>1,n,o=e;return function(s){if(s<1||s>t)return ot(s);o+s>e&&(n=ot(e),o=0);let a=n.subarray(o,o+=s);return(o&7)!==0&&(o=(o|7)+1),a}}var Fo=class{fn;len;next;val;constructor(e,t,n){this.fn=e,this.len=t,this.next=void 0,this.val=n}};function hd(){}var dd=class{head;tail;len;next;constructor(e){this.head=e.head,this.tail=e.tail,this.len=e.len,this.next=e.states}},g_=fd();function b_(r){return globalThis.Buffer!=null?ot(r):g_(r)}var Za=class{len;head;tail;states;constructor(){this.len=0,this.head=new Fo(hd,0,0),this.tail=this.head,this.states=null}_push(e,t,n){return this.tail=this.tail.next=new Fo(e,t,n),this.len+=t,this}uint32(e){return this.len+=(this.tail=this.tail.next=new md((e=e>>>0)<128?1:e<16384?2:e<2097152?3:e<268435456?4:5,e)).len,this}int32(e){return e<0?this._push(Ol,10,zt.fromNumber(e)):this.uint32(e)}sint32(e){return this.uint32((e<<1^e>>31)>>>0)}uint64(e){let t=zt.fromBigInt(e);return this._push(Ol,t.length(),t)}uint64Number(e){return this._push(ps,Ue(e),e)}uint64String(e){return this.uint64(BigInt(e))}int64(e){return this.uint64(e)}int64Number(e){return this.uint64Number(e)}int64String(e){return this.uint64String(e)}sint64(e){let t=zt.fromBigInt(e).zzEncode();return this._push(Ol,t.length(),t)}sint64Number(e){let t=zt.fromNumber(e).zzEncode();return this._push(Ol,t.length(),t)}sint64String(e){return this.sint64(BigInt(e))}bool(e){return this._push(pd,1,e?1:0)}fixed32(e){return this._push(Xa,4,e>>>0)}sfixed32(e){return this.fixed32(e)}fixed64(e){let t=zt.fromBigInt(e);return this._push(Xa,4,t.lo)._push(Xa,4,t.hi)}fixed64Number(e){let t=zt.fromNumber(e);return this._push(Xa,4,t.lo)._push(Xa,4,t.hi)}fixed64String(e){return this.fixed64(BigInt(e))}sfixed64(e){return this.fixed64(e)}sfixed64Number(e){return this.fixed64Number(e)}sfixed64String(e){return this.fixed64String(e)}float(e){return this._push(_b,4,e)}double(e){return this._push(Bb,8,e)}bytes(e){let t=e.length>>>0;return t===0?this._push(pd,1,0):this.uint32(t)._push(x_,t,e)}string(e){let t=kb(e);return t!==0?this.uint32(t)._push(cd,t,e):this._push(pd,1,0)}fork(){return this.states=new dd(this),this.head=this.tail=new Fo(hd,0,0),this.len=0,this}reset(){return this.states!=null?(this.head=this.states.head,this.tail=this.states.tail,this.len=this.states.len,this.states=this.states.next):(this.head=this.tail=new Fo(hd,0,0),this.len=0),this}ldelim(){let e=this.head,t=this.tail,n=this.len;return this.reset().uint32(n),n!==0&&(this.tail.next=e.next,this.tail=t,this.len+=n),this}finish(){let e=this.head.next,t=b_(this.len),n=0;for(;e!=null;)e.fn(e.val,t,n),n+=e.len,e=e.next;return t}};function pd(r,e,t){e[t]=r&255}function w_(r,e,t){for(;r>127;)e[t++]=r&127|128,r>>>=7;e[t]=r}var md=class extends Fo{next;constructor(e,t){super(w_,e,t),this.next=void 0}};function Ol(r,e,t){for(;r.hi!==0;)e[t++]=r.lo&127|128,r.lo=(r.lo>>>7|r.hi<<25)>>>0,r.hi>>>=7;for(;r.lo>127;)e[t++]=r.lo&127|128,r.lo=r.lo>>>7;e[t++]=r.lo}function Xa(r,e,t){e[t]=r&255,e[t+1]=r>>>8&255,e[t+2]=r>>>16&255,e[t+3]=r>>>24}function x_(r,e,t){e.set(r,t)}globalThis.Buffer!=null&&(Za.prototype.bytes=function(r){let e=r.length>>>0;return this.uint32(e),e>0&&this._push(v_,e,r),this},Za.prototype.string=function(r){let e=globalThis.Buffer.byteLength(r);return this.uint32(e),e>0&&this._push(A_,e,r),this});function v_(r,e,t){e.set(r,t)}function A_(r,e,t){r.length<40?cd(r,e,t):e.utf8Write!=null?e.utf8Write(r,t):e.set(de(r),t)}function yd(){return new Za}function Ar(r,e){let t=yd();return e.encode(r,t,{lengthDelimited:!1}),t.finish()}var ds;(function(r){r[r.VARINT=0]="VARINT",r[r.BIT64=1]="BIT64",r[r.LENGTH_DELIMITED=2]="LENGTH_DELIMITED",r[r.START_GROUP=3]="START_GROUP",r[r.END_GROUP=4]="END_GROUP",r[r.BIT32=5]="BIT32"})(ds||(ds={}));function Pl(r,e,t,n){return{name:r,type:e,encode:t,decode:n}}function Wo(r){function e(o){if(r[o.toString()]==null)throw new Error("Invalid enum value");return r[o]}let t=function(i,s){let a=e(i);s.int32(a)},n=function(i){let s=i.int32();return e(s)};return Pl("enum",ds.VARINT,t,n)}function Sr(r,e){return Pl("message",ds.LENGTH_DELIMITED,r,e)}var Ya=class extends Error{code="ERR_MAX_LENGTH";name="MaxLengthError"};var Ye;(function(r){r.RSA="RSA",r.Ed25519="Ed25519",r.secp256k1="secp256k1",r.ECDSA="ECDSA"})(Ye||(Ye={}));var gd;(function(r){r[r.RSA=0]="RSA",r[r.Ed25519=1]="Ed25519",r[r.secp256k1=2]="secp256k1",r[r.ECDSA=3]="ECDSA"})(gd||(gd={}));(function(r){r.codec=()=>Wo(gd)})(Ye||(Ye={}));var Hr;(function(r){let e;r.codec=()=>(e==null&&(e=Sr((t,n,o={})=>{o.lengthDelimited!==!1&&n.fork(),t.Type!=null&&(n.uint32(8),Ye.codec().encode(t.Type,n)),t.Data!=null&&(n.uint32(18),n.bytes(t.Data)),o.lengthDelimited!==!1&&n.ldelim()},(t,n,o={})=>{let i={},s=n==null?t.len:t.pos+n;for(;t.pos<s;){let a=t.uint32();switch(a>>>3){case 1:{i.Type=Ye.codec().decode(t);break}case 2:{i.Data=t.bytes();break}default:{t.skipType(a&7);break}}}return i})),e),r.encode=t=>Ar(t,r.codec()),r.decode=(t,n)=>vr(t,r.codec(),n)})(Hr||(Hr={}));var bd;(function(r){let e;r.codec=()=>(e==null&&(e=Sr((t,n,o={})=>{o.lengthDelimited!==!1&&n.fork(),t.Type!=null&&(n.uint32(8),Ye.codec().encode(t.Type,n)),t.Data!=null&&(n.uint32(18),n.bytes(t.Data)),o.lengthDelimited!==!1&&n.ldelim()},(t,n,o={})=>{let i={},s=n==null?t.len:t.pos+n;for(;t.pos<s;){let a=t.uint32();switch(a>>>3){case 1:{i.Type=Ye.codec().decode(t);break}case 2:{i.Data=t.bytes();break}default:{t.skipType(a&7);break}}}return i})),e),r.encode=t=>Ar(t,r.codec()),r.decode=(t,n)=>vr(t,r.codec(),n)})(bd||(bd={}));var Qa={};At(Qa,{MAX_RSA_KEY_SIZE:()=>wd,generateRSAKeyPair:()=>Id,jwkToJWKKeyPair:()=>Ub,jwkToPkcs1:()=>C_,jwkToPkix:()=>Sd,jwkToRSAPrivateKey:()=>Bd,pkcs1MessageToJwk:()=>vd,pkcs1MessageToRSAPrivateKey:()=>Ed,pkcs1ToJwk:()=>__,pkcs1ToRSAPrivateKey:()=>Lb,pkixMessageToJwk:()=>Ad,pkixMessageToRSAPublicKey:()=>Cd,pkixToJwk:()=>B_,pkixToRSAPublicKey:()=>_d});var ms=class{type="RSA";jwk;_raw;_multihash;constructor(e,t){this.jwk=e,this._multihash=t}get raw(){return this._raw==null&&(this._raw=Qa.jwkToPkix(this.jwk)),this._raw}toMultihash(){return this._multihash}toCID(){return rt.createV1(114,this._multihash)}toString(){return Fe.encode(this.toMultihash().bytes).substring(1)}equals(e){return e==null||!(e.raw instanceof Uint8Array)?!1:We(this.raw,e.raw)}verify(e,t,n){return Rb(this.jwk,t,e,n)}},Ja=class{type="RSA";jwk;_raw;publicKey;constructor(e,t){this.jwk=e,this.publicKey=t}get raw(){return this._raw==null&&(this._raw=Qa.jwkToPkcs1(this.jwk)),this._raw}equals(e){return e==null||!(e.raw instanceof Uint8Array)?!1:We(this.raw,e.raw)}sign(e,t){return Db(this.jwk,e,t)}};var wd=8192,xd=18,S_=1062,E_=Uint8Array.from([48,13,6,9,42,134,72,134,247,13,1,1,1,5,0]);function __(r){let e=sn(r);return vd(e)}function vd(r){return{n:ue(r[1],"base64url"),e:ue(r[2],"base64url"),d:ue(r[3],"base64url"),p:ue(r[4],"base64url"),q:ue(r[5],"base64url"),dp:ue(r[6],"base64url"),dq:ue(r[7],"base64url"),qi:ue(r[8],"base64url"),kty:"RSA"}}function C_(r){if(r.n==null||r.e==null||r.d==null||r.p==null||r.q==null||r.dp==null||r.dq==null||r.qi==null)throw new xe("JWK was missing components");return gr([kt(Uint8Array.from([0])),kt(de(r.n,"base64url")),kt(de(r.e,"base64url")),kt(de(r.d,"base64url")),kt(de(r.p,"base64url")),kt(de(r.q,"base64url")),kt(de(r.dp,"base64url")),kt(de(r.dq,"base64url")),kt(de(r.qi,"base64url"))]).subarray()}function B_(r){let e=sn(r,{offset:0});return Ad(e)}function Ad(r){let e=sn(r[1],{offset:0});return{kty:"RSA",n:ue(e[0],"base64url"),e:ue(e[1],"base64url")}}function Sd(r){if(r.n==null||r.e==null)throw new xe("JWK was missing components");return gr([E_,Pa(gr([kt(de(r.n,"base64url")),kt(de(r.e,"base64url"))]))]).subarray()}function Lb(r){let e=sn(r);return Ed(e)}function Ed(r){let e=vd(r);return Bd(e)}function _d(r,e){if(r.byteLength>=S_)throw new Xi("Key size is too large");let t=sn(r,{offset:0});return Cd(t,r,e)}function Cd(r,e,t){let n=Ad(r);if(t==null){let o=Mr(Hr.encode({Type:Ye.RSA,Data:e}));t=It(xd,o)}return new ms(n,t)}function Bd(r){if(jb(r)>wd)throw new xe("Key size is too large");let e=Ub(r),t=Mr(Hr.encode({Type:Ye.RSA,Data:Sd(e.publicKey)})),n=It(xd,t);return new Ja(e.privateKey,new ms(e.publicKey,n))}async function Id(r){if(r>wd)throw new xe("Key size is too large");let e=await Mb(r),t=Mr(Hr.encode({Type:Ye.RSA,Data:Sd(e.publicKey)})),n=It(xd,t);return new Ja(e.privateKey,new ms(e.publicKey,n))}function Ub(r){if(r==null)throw new xe("Missing key parameter");return{privateKey:r,publicKey:{kty:r.kty,n:r.n,e:r.e}}}async function Mb(r,e){let t=await Ut.get().subtle.generateKey({name:"RSASSA-PKCS1-v1_5",modulusLength:r,publicExponent:new Uint8Array([1,0,1]),hash:{name:"SHA-256"}},!0,["sign","verify"]);e?.signal?.throwIfAborted();let n=await I_(t,e);return{privateKey:n[0],publicKey:n[1]}}async function Db(r,e,t){let n=await Ut.get().subtle.importKey("jwk",r,{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}},!1,["sign"]);t?.signal?.throwIfAborted();let o=await Ut.get().subtle.sign({name:"RSASSA-PKCS1-v1_5"},n,e instanceof Uint8Array?e:e.subarray());return t?.signal?.throwIfAborted(),new Uint8Array(o,0,o.byteLength)}async function Rb(r,e,t,n){let o=await Ut.get().subtle.importKey("jwk",r,{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}},!1,["verify"]);n?.signal?.throwIfAborted();let i=await Ut.get().subtle.verify({name:"RSASSA-PKCS1-v1_5"},o,e,t instanceof Uint8Array?t:t.subarray());return n?.signal?.throwIfAborted(),i}async function I_(r,e){if(r.privateKey==null||r.publicKey==null)throw new xe("Private and public key are required");let t=await Promise.all([Ut.get().subtle.exportKey("jwk",r.privateKey),Ut.get().subtle.exportKey("jwk",r.publicKey)]);return e?.signal?.throwIfAborted(),t}function jb(r){if(r.kty!=="RSA")throw new xe("invalid key type");if(r.n==null)throw new xe("invalid key modulus");return de(r.n,"base64url").length*8}var Nl=class{oHash;iHash;blockLen;outputLen;finished=!1;destroyed=!1;constructor(e,t){if(Lo(e),fe(t,void 0,"key"),this.iHash=e.create(),typeof this.iHash.update!="function")throw new Error("Expected instance of class which extends utils.Hash");this.blockLen=this.iHash.blockLen,this.outputLen=this.iHash.outputLen;let n=this.blockLen,o=new Uint8Array(n);o.set(t.length>n?e.create().update(t).digest():t);for(let i=0;i<o.length;i++)o[i]^=54;this.iHash.update(o),this.oHash=e.create();for(let i=0;i<o.length;i++)o[i]^=106;this.oHash.update(o),br(o)}update(e){return ns(this),this.iHash.update(e),this}digestInto(e){ns(this),fe(e,this.outputLen,"output"),this.finished=!0,this.iHash.digestInto(e),this.oHash.update(e),this.oHash.digestInto(e),this.destroy()}digest(){let e=new Uint8Array(this.oHash.outputLen);return this.digestInto(e),e}_cloneInto(e){e||=Object.create(Object.getPrototypeOf(this),{});let{oHash:t,iHash:n,finished:o,destroyed:i,blockLen:s,outputLen:a}=this;return e=e,e.finished=o,e.destroyed=i,e.blockLen=s,e.outputLen=a,e.oHash=t._cloneInto(e.oHash),e.iHash=n._cloneInto(e.iHash),e}clone(){return this._cloneInto()}destroy(){this.destroyed=!0,this.oHash.destroy(),this.iHash.destroy()}},ys=(r,e,t)=>new Nl(r,e).update(t).digest();ys.create=(r,e)=>new Nl(r,e);var Kb=(r,e)=>(r+(r>=0?e:-e)/Hb)/e;function T_(r,e,t){let[[n,o],[i,s]]=e,a=Kb(s*r,t),c=Kb(-o*r,t),f=r-a*n-c*i,p=-a*o-c*s,h=f<pn,y=p<pn;h&&(f=-f),y&&(p=-p);let b=Ma(Math.ceil($p(t)/2))+gs;if(f<pn||f>=b||p<pn||p>=b)throw new Error("splitScalar (endomorphism): failed, k="+r);return{k1neg:h,k1:f,k2neg:y,k2:p}}function kd(r){if(!["compact","recovered","der"].includes(r))throw new Error('Signature format must be "compact", "recovered", or "der"');return r}function Td(r,e){let t={};for(let n of Object.keys(e))t[n]=r[n]===void 0?e[n]:r[n];return fn(t.lowS,"lowS"),fn(t.prehash,"prehash"),t.format!==void 0&&kd(t.format),t}var Od=class extends Error{constructor(e=""){super(e)}},Yn={Err:Od,_tlv:{encode:(r,e)=>{let{Err:t}=Yn;if(r<0||r>256)throw new t("tlv.encode: wrong tag");if(e.length&1)throw new t("tlv.encode: unpadded data");let n=e.length/2,o=La(n);if(o.length/2&128)throw new t("tlv.encode: long form length too big");let i=n>127?La(o.length/2|128):"";return La(r)+i+o+e},decode(r,e){let{Err:t}=Yn,n=0;if(r<0||r>256)throw new t("tlv.encode: wrong tag");if(e.length<2||e[n++]!==r)throw new t("tlv.decode: wrong tlv");let o=e[n++],i=!!(o&128),s=0;if(!i)s=o;else{let c=o&127;if(!c)throw new t("tlv.decode(long): indefinite length not supported");if(c>4)throw new t("tlv.decode(long): byte length is too big");let f=e.subarray(n,n+c);if(f.length!==c)throw new t("tlv.decode: length bytes not complete");if(f[0]===0)throw new t("tlv.decode(long): zero leftmost byte");for(let p of f)s=s<<8|p;if(n+=c,s<128)throw new t("tlv.decode(long): not minimal encoding")}let a=e.subarray(n,n+s);if(a.length!==s)throw new t("tlv.decode: wrong value length");return{v:a,l:e.subarray(n+s)}}},_int:{encode(r){let{Err:e}=Yn;if(r<pn)throw new e("integer: negative integers are not allowed");let t=La(r);if(Number.parseInt(t[0],16)&8&&(t="00"+t),t.length&1)throw new e("unexpected DER parsing assertion: unpadded hex");return t},decode(r){let{Err:e}=Yn;if(r[0]&128)throw new e("invalid signature integer: negative");if(r[0]===0&&!(r[1]&128))throw new e("invalid signature integer: unnecessary leading zero");return os(r)}},toSig(r){let{Err:e,_int:t,_tlv:n}=Yn,o=fe(r,void 0,"signature"),{v:i,l:s}=n.decode(48,o);if(s.length)throw new e("invalid signature: left bytes after parsing");let{v:a,l:c}=n.decode(2,i),{v:f,l:p}=n.decode(2,c);if(p.length)throw new e("invalid signature: left bytes after parsing");return{r:t.decode(a),s:t.decode(f)}},hexFromSig(r){let{_tlv:e,_int:t}=Yn,n=e.encode(2,t.encode(r.r)),o=e.encode(2,t.encode(r.s)),i=n+o;return e.encode(48,i)}},pn=BigInt(0),gs=BigInt(1),Hb=BigInt(2),Dl=BigInt(3),k_=BigInt(4);function Vb(r,e={}){let t=Al("weierstrass",r,e),{Fp:n,Fn:o}=t,i=t.CURVE,{h:s,n:a}=i;Kr(e,{},{allowInfinityPoint:"boolean",clearCofactor:"function",isTorsionFree:"function",fromBytes:"function",toBytes:"function",endo:"object"});let{endo:c}=e;if(c&&(!n.is0(i.a)||typeof c.beta!="bigint"||!Array.isArray(c.basises)))throw new Error('invalid endo: expected "beta": bigint and "basises": array');let f=Fb(n,o);function p(){if(!n.isOdd)throw new Error("compression is not supported: Field does not have .isOdd()")}function h(V,B,A){let{x:v,y:D}=B.toAffine(),U=n.toBytes(v);if(fn(A,"isCompressed"),A){p();let L=!n.isOdd(D);return Lt($b(L),U)}else return Lt(Uint8Array.of(4),U,n.toBytes(D))}function y(V){fe(V,void 0,"Point");let{publicKey:B,publicKeyUncompressed:A}=f,v=V.length,D=V[0],U=V.subarray(1);if(v===B&&(D===2||D===3)){let L=n.fromBytes(U);if(!n.isValid(L))throw new Error("bad point: is not on curve, wrong x");let T=C(L),M;try{M=n.sqrt(T)}catch(pe){let be=pe instanceof Error?": "+pe.message:"";throw new Error("bad point: is not on curve, sqrt error"+be)}p();let W=n.isOdd(M);return(D&1)===1!==W&&(M=n.neg(M)),{x:L,y:M}}else if(v===A&&D===4){let L=n.BYTES,T=n.fromBytes(U.subarray(0,L)),M=n.fromBytes(U.subarray(L,L*2));if(!m(T,M))throw new Error("bad point: is not on curve");return{x:T,y:M}}else throw new Error(`bad point: got length ${v}, expected compressed=${B} or uncompressed=${A}`)}let b=e.toBytes||h,g=e.fromBytes||y;function C(V){let B=n.sqr(V),A=n.mul(B,V);return n.add(n.add(A,n.mul(V,i.a)),i.b)}function m(V,B){let A=n.sqr(B),v=C(V);return n.eql(A,v)}if(!m(i.Gx,i.Gy))throw new Error("bad curve params: generator point");let S=n.mul(n.pow(i.a,Dl),k_),N=n.mul(n.sqr(i.b),BigInt(27));if(n.is0(n.add(S,N)))throw new Error("bad curve params: a or b");function I(V,B,A=!1){if(!n.isValid(B)||A&&n.is0(B))throw new Error(`bad point coordinate ${V}`);return B}function K(V){if(!(V instanceof k))throw new Error("Weierstrass Point expected")}function Z(V){if(!c||!c.basises)throw new Error("no endo");return T_(V,c.basises,o.ORDER)}let q=is((V,B)=>{let{X:A,Y:v,Z:D}=V;if(n.eql(D,n.ONE))return{x:A,y:v};let U=V.is0();B==null&&(B=U?n.ONE:n.inv(D));let L=n.mul(A,B),T=n.mul(v,B),M=n.mul(D,B);if(U)return{x:n.ZERO,y:n.ZERO};if(!n.eql(M,n.ONE))throw new Error("invZ was invalid");return{x:L,y:T}}),re=is(V=>{if(V.is0()){if(e.allowInfinityPoint&&!n.is0(V.Y))return;throw new Error("bad point: ZERO")}let{x:B,y:A}=V.toAffine();if(!n.isValid(B)||!n.isValid(A))throw new Error("bad point: x or y not field elements");if(!m(B,A))throw new Error("bad point: equation left != right");if(!V.isTorsionFree())throw new Error("bad point: not in prime-order subgroup");return!0});function R(V,B,A,v,D){return A=new k(n.mul(A.X,V),A.Y,A.Z),B=Ka(v,B),A=Ka(D,A),B.add(A)}class k{static BASE=new k(i.Gx,i.Gy,n.ONE);static ZERO=new k(n.ZERO,n.ONE,n.ZERO);static Fp=n;static Fn=o;X;Y;Z;constructor(B,A,v){this.X=I("x",B),this.Y=I("y",A,!0),this.Z=I("z",v),Object.freeze(this)}static CURVE(){return i}static fromAffine(B){let{x:A,y:v}=B||{};if(!B||!n.isValid(A)||!n.isValid(v))throw new Error("invalid affine point");if(B instanceof k)throw new Error("projective point not allowed");return n.is0(A)&&n.is0(v)?k.ZERO:new k(A,v,n.ONE)}static fromBytes(B){let A=k.fromAffine(g(fe(B,void 0,"point")));return A.assertValidity(),A}static fromHex(B){return k.fromBytes(un(B))}get x(){return this.toAffine().x}get y(){return this.toAffine().y}precompute(B=8,A=!0){return Y.createCache(this,B),A||this.multiply(Dl),this}assertValidity(){re(this)}hasEvenY(){let{y:B}=this.toAffine();if(!n.isOdd)throw new Error("Field doesn't support isOdd");return!n.isOdd(B)}equals(B){K(B);let{X:A,Y:v,Z:D}=this,{X:U,Y:L,Z:T}=B,M=n.eql(n.mul(A,T),n.mul(U,D)),W=n.eql(n.mul(v,T),n.mul(L,D));return M&&W}negate(){return new k(this.X,n.neg(this.Y),this.Z)}double(){let{a:B,b:A}=i,v=n.mul(A,Dl),{X:D,Y:U,Z:L}=this,T=n.ZERO,M=n.ZERO,W=n.ZERO,O=n.mul(D,D),pe=n.mul(U,U),be=n.mul(L,L),ee=n.mul(D,U);return ee=n.add(ee,ee),W=n.mul(D,L),W=n.add(W,W),T=n.mul(B,W),M=n.mul(v,be),M=n.add(T,M),T=n.sub(pe,M),M=n.add(pe,M),M=n.mul(T,M),T=n.mul(ee,T),W=n.mul(v,W),be=n.mul(B,be),ee=n.sub(O,be),ee=n.mul(B,ee),ee=n.add(ee,W),W=n.add(O,O),O=n.add(W,O),O=n.add(O,be),O=n.mul(O,ee),M=n.add(M,O),be=n.mul(U,L),be=n.add(be,be),O=n.mul(be,ee),T=n.sub(T,O),W=n.mul(be,pe),W=n.add(W,W),W=n.add(W,W),new k(T,M,W)}add(B){K(B);let{X:A,Y:v,Z:D}=this,{X:U,Y:L,Z:T}=B,M=n.ZERO,W=n.ZERO,O=n.ZERO,pe=i.a,be=n.mul(i.b,Dl),ee=n.mul(A,U),Ae=n.mul(v,L),Be=n.mul(D,T),Ke=n.add(A,v),Ee=n.add(U,L);Ke=n.mul(Ke,Ee),Ee=n.add(ee,Ae),Ke=n.sub(Ke,Ee),Ee=n.add(A,D);let Ie=n.add(U,T);return Ee=n.mul(Ee,Ie),Ie=n.add(ee,Be),Ee=n.sub(Ee,Ie),Ie=n.add(v,D),M=n.add(L,T),Ie=n.mul(Ie,M),M=n.add(Ae,Be),Ie=n.sub(Ie,M),O=n.mul(pe,Ee),M=n.mul(be,Be),O=n.add(M,O),M=n.sub(Ae,O),O=n.add(Ae,O),W=n.mul(M,O),Ae=n.add(ee,ee),Ae=n.add(Ae,ee),Be=n.mul(pe,Be),Ee=n.mul(be,Ee),Ae=n.add(Ae,Be),Be=n.sub(ee,Be),Be=n.mul(pe,Be),Ee=n.add(Ee,Be),ee=n.mul(Ae,Ee),W=n.add(W,ee),ee=n.mul(Ie,Ee),M=n.mul(Ke,M),M=n.sub(M,ee),ee=n.mul(Ke,Ae),O=n.mul(Ie,O),O=n.add(O,ee),new k(M,W,O)}subtract(B){return this.add(B.negate())}is0(){return this.equals(k.ZERO)}multiply(B){let{endo:A}=e;if(!o.isValidNot0(B))throw new Error("invalid scalar: out of range");let v,D,U=L=>Y.cached(this,L,T=>Vo(k,T));if(A){let{k1neg:L,k1:T,k2neg:M,k2:W}=Z(B),{p:O,f:pe}=U(T),{p:be,f:ee}=U(W);D=pe.add(ee),v=R(A.beta,O,be,L,M)}else{let{p:L,f:T}=U(B);v=L,D=T}return Vo(k,[v,D])[0]}multiplyUnsafe(B){let{endo:A}=e,v=this;if(!o.isValid(B))throw new Error("invalid scalar: out of range");if(B===pn||v.is0())return k.ZERO;if(B===gs)return v;if(Y.hasCache(this))return this.multiply(B);if(A){let{k1neg:D,k1:U,k2neg:L,k2:T}=Z(B),{p1:M,p2:W}=lb(k,v,U,T);return R(A.beta,M,W,D,L)}else return Y.unsafe(v,B)}toAffine(B){return q(this,B)}isTorsionFree(){let{isTorsionFree:B}=e;return s===gs?!0:B?B(k,this):Y.unsafe(this,a).is0()}clearCofactor(){let{clearCofactor:B}=e;return s===gs?this:B?B(k,this):this.multiplyUnsafe(s)}isSmallOrder(){return this.multiplyUnsafe(s).is0()}toBytes(B=!0){return fn(B,"isCompressed"),this.assertValidity(),b(k,this,B)}toHex(B=!0){return cn(this.toBytes(B))}toString(){return`<Point ${this.is0()?"ZERO":this.toHex()}>`}}let G=o.BITS,Y=new cs(k,e.endo?Math.ceil(G/2):G);return k.BASE.precompute(8),k}function $b(r){return Uint8Array.of(r?2:3)}function Fb(r,e){return{secretKey:e.BYTES,publicKey:1+r.BYTES,publicKeyUncompressed:1+2*r.BYTES,publicKeyHasPrefix:!0,signature:2*e.BYTES}}function O_(r,e={}){let{Fn:t}=r,n=e.randomBytes||Fn,o=Object.assign(Fb(r.Fp,t),{seed:Gp(t.ORDER)});function i(b){try{let g=t.fromBytes(b);return t.isValidNot0(g)}catch{return!1}}function s(b,g){let{publicKey:C,publicKeyUncompressed:m}=o;try{let S=b.length;return g===!0&&S!==C||g===!1&&S!==m?!1:!!r.fromBytes(b)}catch{return!1}}function a(b=n(o.seed)){return zp(fe(b,o.seed,"seed"),t.ORDER)}function c(b,g=!0){return r.BASE.multiply(t.fromBytes(b)).toBytes(g)}function f(b){let{secretKey:g,publicKey:C,publicKeyUncompressed:m}=o;if(!Ro(b)||"_lengths"in t&&t._lengths||g===C)return;let S=fe(b,void 0,"key").length;return S===C||S===m}function p(b,g,C=!0){if(f(b)===!0)throw new Error("first arg must be private key");if(f(g)===!1)throw new Error("second arg must be public key");let m=t.fromBytes(b);return r.fromBytes(g).multiply(m).toBytes(C)}let h={isValidSecretKey:i,isValidPublicKey:s,randomSecretKey:a},y=us(a,c);return Object.freeze({getPublicKey:c,getSharedSecret:p,keygen:y,Point:r,utils:h,lengths:o})}function Wb(r,e,t={}){Lo(e),Kr(t,{},{hmac:"function",lowS:"boolean",randomBytes:"function",bits2int:"function",bits2int_modN:"function"}),t=Object.assign({},t);let n=t.randomBytes||Fn,o=t.hmac||((A,v)=>ys(e,A,v)),{Fp:i,Fn:s}=r,{ORDER:a,BITS:c}=s,{keygen:f,getPublicKey:p,getSharedSecret:h,utils:y,lengths:b}=O_(r,t),g={prehash:!0,lowS:typeof t.lowS=="boolean"?t.lowS:!0,format:"compact",extraEntropy:!1},C=a*Hb<i.ORDER;function m(A){let v=a>>gs;return A>v}function S(A,v){if(!s.isValidNot0(v))throw new Error(`invalid signature ${A}: out of range 1..Point.Fn.ORDER`);return v}function N(){if(C)throw new Error('"recovered" sig type is not supported for cofactor >2 curves')}function I(A,v){kd(v);let D=b.signature,U=v==="compact"?D:v==="recovered"?D+1:void 0;return fe(A,U)}class K{r;s;recovery;constructor(v,D,U){if(this.r=S("r",v),this.s=S("s",D),U!=null){if(N(),![0,1,2,3].includes(U))throw new Error("invalid recovery id");this.recovery=U}Object.freeze(this)}static fromBytes(v,D=g.format){I(v,D);let U;if(D==="der"){let{r:W,s:O}=Yn.toSig(fe(v));return new K(W,O)}D==="recovered"&&(U=v[0],D="compact",v=v.subarray(1));let L=b.signature/2,T=v.subarray(0,L),M=v.subarray(L,L*2);return new K(s.fromBytes(T),s.fromBytes(M),U)}static fromHex(v,D){return this.fromBytes(un(v),D)}assertRecovery(){let{recovery:v}=this;if(v==null)throw new Error("invalid recovery id: must be present");return v}addRecoveryBit(v){return new K(this.r,this.s,v)}recoverPublicKey(v){let{r:D,s:U}=this,L=this.assertRecovery(),T=L===2||L===3?D+a:D;if(!i.isValid(T))throw new Error("invalid recovery id: sig.r+curve.n != R.x");let M=i.toBytes(T),W=r.fromBytes(Lt($b((L&1)===0),M)),O=s.inv(T),pe=q(fe(v,void 0,"msgHash")),be=s.create(-pe*O),ee=s.create(U*O),Ae=r.BASE.multiplyUnsafe(be).add(W.multiplyUnsafe(ee));if(Ae.is0())throw new Error("invalid recovery: point at infinify");return Ae.assertValidity(),Ae}hasHighS(){return m(this.s)}toBytes(v=g.format){if(kd(v),v==="der")return un(Yn.hexFromSig(this));let{r:D,s:U}=this,L=s.toBytes(D),T=s.toBytes(U);return v==="recovered"?(N(),Lt(Uint8Array.of(this.assertRecovery()),L,T)):Lt(L,T)}toHex(v){return cn(this.toBytes(v))}}let Z=t.bits2int||function(v){if(v.length>8192)throw new Error("input is too large");let D=os(v),U=v.length*8-c;return U>0?D>>BigInt(U):D},q=t.bits2int_modN||function(v){return s.create(Z(v))},re=Ma(c);function R(A){return zn("num < 2^"+c,A,pn,re),s.toBytes(A)}function k(A,v){return fe(A,void 0,"message"),v?fe(e(A),void 0,"prehashed message"):A}function G(A,v,D){let{lowS:U,prehash:L,extraEntropy:T}=Td(D,g);A=k(A,L);let M=q(A),W=s.fromBytes(v);if(!s.isValidNot0(W))throw new Error("invalid private key");let O=[R(W),R(M)];if(T!=null&&T!==!1){let Ae=T===!0?n(b.secretKey):T;O.push(fe(Ae,void 0,"extraEntropy"))}let pe=Lt(...O),be=M;function ee(Ae){let Be=Z(Ae);if(!s.isValidNot0(Be))return;let Ke=s.inv(Be),Ee=r.BASE.multiply(Be).toAffine(),Ie=s.create(Ee.x);if(Ie===pn)return;let nn=s.create(Ke*s.create(be+Ie*W));if(nn===pn)return;let pr=(Ee.x===Ie?0:2)|Number(Ee.y&gs),jn=nn;return U&&m(nn)&&(jn=s.neg(nn),pr^=1),new K(Ie,jn,C?void 0:pr)}return{seed:pe,k2sig:ee}}function Y(A,v,D={}){let{seed:U,k2sig:L}=G(A,v,D);return G0(e.outputLen,s.BYTES,o)(U,L).toBytes(D.format)}function V(A,v,D,U={}){let{lowS:L,prehash:T,format:M}=Td(U,g);if(D=fe(D,void 0,"publicKey"),v=k(v,T),!Ro(A)){let W=A instanceof K?", use sig.toBytes()":"";throw new Error("verify expects Uint8Array signature"+W)}I(A,M);try{let W=K.fromBytes(A,M),O=r.fromBytes(D);if(L&&W.hasHighS())return!1;let{r:pe,s:be}=W,ee=q(v),Ae=s.inv(be),Be=s.create(ee*Ae),Ke=s.create(pe*Ae),Ee=r.BASE.multiplyUnsafe(Be).add(O.multiplyUnsafe(Ke));return Ee.is0()?!1:s.create(Ee.x)===pe}catch{return!1}}function B(A,v,D={}){let{prehash:U}=Td(D,g);return v=k(v,U),K.fromBytes(A,"recovered").recoverPublicKey(v).toBytes()}return Object.freeze({keygen:f,getPublicKey:p,getSharedSecret:h,utils:y,lengths:b,Point:r,sign:Y,verify:V,recoverPublicKey:B,Signature:K,hash:e})}var Nd={p:BigInt("0xfffffffffffffffffffffffffffffffffffffffffffffffffffffffefffffc2f"),n:BigInt("0xfffffffffffffffffffffffffffffffebaaedce6af48a03bbfd25e8cd0364141"),h:BigInt(1),a:BigInt(0),b:BigInt(7),Gx:BigInt("0x79be667ef9dcbbac55a06295ce870b07029bfcdb2dce28d959f2815b16f81798"),Gy:BigInt("0x483ada7726a3c4655da4fbfc0e1108a8fd17b448a68554199c47d08ffb10d4b8")},P_={beta:BigInt("0x7ae96a2b657c07106e64479eac3434e99cf0497512f58995c1396c28719501ee"),basises:[[BigInt("0x3086d221a7d46bcde86c90e49284eb15"),-BigInt("0xe4437ed6010e88286f547fa90abfe4c3")],[BigInt("0x114ca50f7a8e2f3f657c1108d9d44cfd8"),BigInt("0x3086d221a7d46bcde86c90e49284eb15")]]};var qb=BigInt(2);function N_(r){let e=Nd.p,t=BigInt(3),n=BigInt(6),o=BigInt(11),i=BigInt(22),s=BigInt(23),a=BigInt(44),c=BigInt(88),f=r*r*r%e,p=f*f*r%e,h=Le(p,t,e)*p%e,y=Le(h,t,e)*p%e,b=Le(y,qb,e)*f%e,g=Le(b,o,e)*b%e,C=Le(g,i,e)*g%e,m=Le(C,a,e)*C%e,S=Le(m,c,e)*m%e,N=Le(S,a,e)*C%e,I=Le(N,t,e)*p%e,K=Le(I,s,e)*g%e,Z=Le(K,n,e)*f%e,q=Le(Z,qb,e);if(!Pd.eql(Pd.sqr(q),r))throw new Error("Cannot find square root");return q}var Pd=ss(Nd.p,{sqrt:N_}),D_=Vb(Nd,{Fp:Pd,endo:P_}),Er=Wb(D_,Mr);function Gb(r,e,t){let n=tr.digest(e instanceof Uint8Array?e:e.subarray());if(hs(n))return n.then(({digest:o})=>(t?.signal?.throwIfAborted(),Er.sign(o,r,{prehash:!1,format:"der"}))).catch(o=>{throw o.name==="AbortError"?o:new Fa(String(o))});try{return Er.sign(n.digest,r,{prehash:!1,format:"der"})}catch(o){throw new Fa(String(o))}}function zb(r,e,t,n){let o=tr.digest(t instanceof Uint8Array?t:t.subarray());if(hs(o))return o.then(({digest:i})=>(n?.signal?.throwIfAborted(),Er.verify(e,i,r,{prehash:!1,format:"der"}))).catch(i=>{throw i.name==="AbortError"?i:new Wa(String(i))});try{return n?.signal?.throwIfAborted(),Er.verify(e,o.digest,r,{prehash:!1,format:"der"})}catch(i){throw new Wa(String(i))}}var ec=class{type="secp256k1";raw;_key;constructor(e){this._key=Yb(e),this.raw=Xb(this._key)}toMultihash(){return yr.digest($n(this))}toCID(){return rt.createV1(114,this.toMultihash())}toString(){return Fe.encode(this.toMultihash().bytes).substring(1)}equals(e){return e==null||!(e.raw instanceof Uint8Array)?!1:We(this.raw,e.raw)}verify(e,t,n){return zb(this._key,t,e,n)}},Rl=class{type="secp256k1";raw;publicKey;constructor(e,t){this.raw=Zb(e),this.publicKey=new ec(t??Jb(e))}equals(e){return e==null||!(e.raw instanceof Uint8Array)?!1:We(this.raw,e.raw)}sign(e,t){return Gb(this.raw,e,t)}};function Dd(r){return new ec(r)}async function Qb(){let r=R_();return new Rl(r)}function Xb(r){return Er.Point.fromBytes(r).toBytes()}function Zb(r){try{return Er.getPublicKey(r,!0),r}catch(e){throw new Ea(String(e))}}function Yb(r){try{return Er.Point.fromBytes(r),r}catch(e){throw new Xi(String(e))}}function Jb(r){try{return Er.getPublicKey(r,!0)}catch(e){throw new Ea(String(e))}}function R_(){return Er.utils.randomSecretKey()}async function ew(r,e){if(r==="Ed25519")return Eb();if(r==="secp256k1")return Qb();if(r==="RSA")return Id(L_(e));if(r==="ECDSA")return T0(U_(e));throw new Kn}function tc(r,e){let{Type:t,Data:n}=Hr.decode(r),o=n??new Uint8Array;switch(t){case Ye.RSA:return _d(o,e);case Ye.Ed25519:return ed(o);case Ye.secp256k1:return Dd(o);case Ye.ECDSA:return Pp(o);default:throw new Kn}}function tw(r){let{Type:e,Data:t}=Hr.decode(r.digest),n=t??new Uint8Array;switch(e){case Ye.Ed25519:return ed(n);case Ye.secp256k1:return Dd(n);case Ye.ECDSA:return Pp(n);default:throw new Kn}}function $n(r){return Hr.encode({Type:Ye[r.type],Data:r.raw})}function L_(r){return r==null?2048:parseInt(r,10)}function U_(r){if(r==="P-256"||r==null)return"P-256";if(r==="P-384")return"P-384";if(r==="P-521")return"P-521";throw new xe("Unsupported curve, should be P-256, P-384 or P-521")}async function Ll(r){if(r.type==="RSA")return{privateKey:await crypto.subtle.importKey("jwk",r.jwk,{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}},!0,["sign"]),publicKey:await crypto.subtle.importKey("jwk",r.publicKey.jwk,{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}},!0,["verify"])};if(r.type==="ECDSA")return{privateKey:await crypto.subtle.importKey("jwk",r.jwk,{name:"ECDSA",namedCurve:r.jwk.crv??"P-256"},!0,["sign"]),publicKey:await crypto.subtle.importKey("jwk",r.publicKey.jwk,{name:"ECDSA",namedCurve:r.publicKey.jwk.crv??"P-256"},!0,["verify"])};throw new xe("Only RSA and ECDSA keys are supported")}var rw=Symbol.for("nodejs.util.inspect.custom"),M_=114,rc=class{type;multihash;publicKey;string;constructor(e){this.type=e.type,this.multihash=e.multihash,Object.defineProperty(this,"string",{enumerable:!1,writable:!0})}get[Symbol.toStringTag](){return`PeerId(${this.toString()})`}[ip]=!0;toString(){return this.string==null&&(this.string=Fe.encode(this.multihash.bytes).slice(1)),this.string}toMultihash(){return this.multihash}toCID(){return rt.createV1(M_,this.multihash)}toJSON(){return this.toString()}equals(e){if(e==null)return!1;if(e instanceof Uint8Array)return We(this.multihash.bytes,e);if(typeof e=="string")return this.toString()===e;if(e?.toMultihash()?.bytes!=null)return We(this.multihash.bytes,e.toMultihash().bytes);throw new Error("not valid Id")}[rw](){return`PeerId(${this.toString()})`}},nc=class extends rc{type="RSA";publicKey;constructor(e){super({...e,type:"RSA"}),this.publicKey=e.publicKey}},oc=class extends rc{type="Ed25519";publicKey;constructor(e){super({...e,type:"Ed25519"}),this.publicKey=e.publicKey}},ic=class extends rc{type="secp256k1";publicKey;constructor(e){super({...e,type:"secp256k1"}),this.publicKey=e.publicKey}},j_=2336,sc=class{type="url";multihash;publicKey;url;constructor(e){this.url=e.toString(),this.multihash=yr.digest(de(this.url))}[rw](){return`PeerId(${this.url})`}[ip]=!0;toString(){return this.toCID().toString()}toMultihash(){return this.multihash}toCID(){return rt.createV1(j_,this.toMultihash())}toJSON(){return this.toString()}equals(e){return e==null?!1:(e instanceof Uint8Array&&(e=ue(e)),e.toString()===this.toString())}};var K_=114,nw=2336;function bs(r,e){let t;if(r.charAt(0)==="1"||r.charAt(0)==="Q")t=rs(Fe.decode(`z${r}`));else{if(r.startsWith("k51qzi5uqu5")||r.startsWith("kzwfwjn5ji4")||r.startsWith("k2k4r8")||r.startsWith("bafz"))return H_(rt.parse(r));if(e==null)throw new xe('Please pass a multibase decoder for strings that do not start with "1" or "Q"');t=rs(e.decode(r))}return ow(t)}function Rd(r){if(r.type==="Ed25519")return new oc({multihash:r.toCID().multihash,publicKey:r});if(r.type==="secp256k1")return new ic({multihash:r.toCID().multihash,publicKey:r});if(r.type==="RSA")return new nc({multihash:r.toCID().multihash,publicKey:r});throw new Kn}function ow(r){if($_(r))return new nc({multihash:r});if(V_(r))try{let e=tw(r);if(e.type==="Ed25519")return new oc({multihash:r,publicKey:e});if(e.type==="secp256k1")return new ic({multihash:r,publicKey:e})}catch{let t=ue(r.digest);return new sc(new URL(t))}throw new sl("Supplied PeerID Multihash is invalid")}function H_(r){if(r?.multihash==null||r.version==null||r.version===1&&r.code!==K_&&r.code!==nw)throw new il("Supplied PeerID CID is invalid");if(r.code===nw){let e=ue(r.multihash.digest);return new sc(new URL(e))}return ow(r.multihash)}function V_(r){return r.code===yr.code}function $_(r){return r.code===tr.code}var ht=class extends Error{static name="InvalidMultiaddrError";name="InvalidMultiaddrError"},dn=class extends Error{static name="ValidationError";name="ValidationError"},Ul=class extends Error{static name="InvalidParametersError";name="InvalidParametersError"},Ml=class extends Error{static name="UnknownProtocolError";name="UnknownProtocolError"};var jl=class{index=0;input="";new(e){return this.index=0,this.input=e,this}readAtomically(e){let t=this.index,n=e();return n===void 0&&(this.index=t),n}parseWith(e){let t=e();if(this.index===this.input.length)return t}peekChar(){if(!(this.index>=this.input.length))return this.input[this.index]}readChar(){if(!(this.index>=this.input.length))return this.input[this.index++]}readGivenChar(e){return this.readAtomically(()=>{let t=this.readChar();if(t===e)return t})}readSeparator(e,t,n){return this.readAtomically(()=>{if(!(t>0&&this.readGivenChar(e)===void 0))return n()})}readNumber(e,t,n,o){return this.readAtomically(()=>{let i=0,s=0,a=this.peekChar();if(a===void 0)return;let c=a==="0",f=2**(8*o)-1;for(;;){let p=this.readAtomically(()=>{let h=this.readChar();if(h===void 0)return;let y=Number.parseInt(h,e);if(!Number.isNaN(y))return y});if(p===void 0)break;if(i*=e,i+=p,i>f||(s+=1,t!==void 0&&s>t))return}if(s!==0)return!n&&c&&s>1?void 0:i})}readIPv4Addr(){return this.readAtomically(()=>{let e=new Uint8Array(4);for(let t=0;t<e.length;t++){let n=this.readSeparator(".",t,()=>this.readNumber(10,3,!1,1));if(n===void 0)return;e[t]=n}return e})}readIPv6Addr(){let e=t=>{for(let n=0;n<t.length/2;n++){let o=n*2;if(n<t.length-3){let s=this.readSeparator(":",n,()=>this.readIPv4Addr());if(s!==void 0)return t[o]=s[0],t[o+1]=s[1],t[o+2]=s[2],t[o+3]=s[3],[o+4,!0]}let i=this.readSeparator(":",n,()=>this.readNumber(16,4,!0,2));if(i===void 0)return[o,!1];t[o]=i>>8,t[o+1]=i&255}return[t.length,!1]};return this.readAtomically(()=>{let t=new Uint8Array(16),[n,o]=e(t);if(n===16)return t;if(o||this.readGivenChar(":")===void 0||this.readGivenChar(":")===void 0)return;let i=new Uint8Array(14),s=16-(n+2),[a]=e(i.subarray(0,s));return t.set(i.subarray(0,a),16-a),t})}readIPAddr(){return this.readIPv4Addr()??this.readIPv6Addr()}};var F_=45,W_=15,Kl=new jl;function iw(r){if(!(r.length>W_))return Kl.new(r).parseWith(()=>Kl.readIPv4Addr())}function sw(r){if(r.includes("%")&&(r=r.split("%")[0]),!(r.length>F_))return Kl.new(r).parseWith(()=>Kl.readIPv6Addr())}function Hl(r){return!!iw(r)}function aw(r){return!!sw(r)}function Ud(r){return e=>ue(e,r)}function Md(r){return e=>de(e,r)}function ws(r){return new DataView(r.buffer).getUint16(r.byteOffset).toString()}function qo(r){let e=new ArrayBuffer(2);return new DataView(e).setUint16(0,typeof r=="string"?parseInt(r):r),new Uint8Array(e)}function cw(r){let e=r.split(":");if(e.length!==2)throw new Error(`failed to parse onion addr: ["'${e.join('", "')}'"]' does not contain a port number`);if(e[0].length!==16)throw new Error(`failed to parse onion addr: ${e[0]} not a Tor onion address.`);let t=de(e[0],"base32"),n=parseInt(e[1],10);if(n<1||n>65536)throw new Error("Port number is not in range(1, 65536)");let o=qo(n);return Tt([t,o],t.length+o.length)}function uw(r){let e=r.split(":");if(e.length!==2)throw new Error(`failed to parse onion addr: ["'${e.join('", "')}'"]' does not contain a port number`);if(e[0].length!==56)throw new Error(`failed to parse onion addr: ${e[0]} not a Tor onion3 address.`);let t=Vn.decode(`b${e[0]}`),n=parseInt(e[1],10);if(n<1||n>65536)throw new Error("Port number is not in range(1, 65536)");let o=qo(n);return Tt([t,o],t.length+o.length)}function jd(r){let e=r.subarray(0,r.length-2),t=r.subarray(r.length-2),n=ue(e,"base32"),o=ws(t);return`${n}:${o}`}var Kd=function(r){r=r.toString().trim();let e=new Uint8Array(4);return r.split(/\./g).forEach((t,n)=>{let o=parseInt(t,10);if(isNaN(o)||o<0||o>255)throw new ht("Invalid byte value in IP address");e[n]=o}),e},lw=function(r){let e=0;r=r.toString().trim();let t=r.split(":",8),n;for(n=0;n<t.length;n++){let i=Hl(t[n]),s;i&&(s=Kd(t[n]),t[n]=ue(s.subarray(0,2),"base16")),s!=null&&++n<8&&t.splice(n,0,ue(s.subarray(2,4),"base16"))}if(t[0]==="")for(;t.length<8;)t.unshift("0");else if(t[t.length-1]==="")for(;t.length<8;)t.push("0");else if(t.length<8){for(n=0;n<t.length&&t[n]!=="";n++);let i=[n,1];for(n=9-t.length;n>0;n--)i.push("0");t.splice.apply(t,i)}let o=new Uint8Array(e+16);for(n=0;n<t.length;n++){t[n]===""&&(t[n]="0");let i=parseInt(t[n],16);if(isNaN(i)||i<0||i>65535)throw new ht("Invalid byte value in IP address");o[e++]=i>>8&255,o[e++]=i&255}return o},fw=function(r){if(r.byteLength!==4)throw new ht("IPv4 address was incorrect length");let e=[];for(let t=0;t<r.byteLength;t++)e.push(r[t]);return e.join(".")},hw=function(r){if(r.byteLength!==16)throw new ht("IPv6 address was incorrect length");let e=[];for(let n=0;n<r.byteLength;n+=2){let o=r[n],i=r[n+1],s=`${o.toString(16).padStart(2,"0")}${i.toString(16).padStart(2,"0")}`;e.push(s)}let t=e.join(":");try{let n=new URL(`http://[${t}]`);return n.hostname.substring(1,n.hostname.length-1)}catch{throw new ht(`Invalid IPv6 address "${t}"`)}};function pw(r){try{let e=new URL(`http://[${r}]`);return e.hostname.substring(1,e.hostname.length-1)}catch{throw new ht(`Invalid IPv6 address "${r}"`)}}var Ld=Object.values(No).map(r=>r.decoder),q_=(function(){let r=Ld[0].or(Ld[1]);return Ld.slice(2).forEach(e=>r=r.or(e)),r})();function dw(r){return q_.decode(r)}function mw(r){return e=>r.encoder.encode(e)}function G_(r){if(parseInt(r).toString()!==r)throw new dn("Value must be an integer")}function z_(r){if(r<0)throw new dn("Value must be a positive integer, or zero")}function X_(r){return e=>{if(e>r)throw new dn(`Value must be smaller than or equal to ${r}`)}}function Z_(...r){return e=>{for(let t of r)t(e)}}var ac=Z_(G_,z_,X_(65535));var ct=-1,Hd=class{protocolsByCode=new Map;protocolsByName=new Map;getProtocol(e){let t;if(typeof e=="string"?t=this.protocolsByName.get(e):t=this.protocolsByCode.get(e),t==null)throw new Ml(`Protocol ${e} was unknown`);return t}addProtocol(e){this.protocolsByCode.set(e.code,e),this.protocolsByName.set(e.name,e),e.aliases?.forEach(t=>{this.protocolsByName.set(t,e)})}removeProtocol(e){let t=this.protocolsByCode.get(e);t!=null&&(this.protocolsByCode.delete(t.code),this.protocolsByName.delete(t.name),t.aliases?.forEach(n=>{this.protocolsByName.delete(n)}))}},mn=new Hd,f2=[{code:4,name:"ip4",size:32,valueToBytes:Kd,bytesToValue:fw,validate:r=>{if(!Hl(r))throw new dn(`Invalid IPv4 address "${r}"`)}},{code:6,name:"tcp",size:16,valueToBytes:qo,bytesToValue:ws,validate:ac},{code:273,name:"udp",size:16,valueToBytes:qo,bytesToValue:ws,validate:ac},{code:33,name:"dccp",size:16,valueToBytes:qo,bytesToValue:ws,validate:ac},{code:41,name:"ip6",size:128,valueToBytes:lw,bytesToValue:hw,stringToValue:pw,validate:r=>{if(!aw(r))throw new dn(`Invalid IPv6 address "${r}"`)}},{code:42,name:"ip6zone",size:ct},{code:43,name:"ipcidr",size:8,bytesToValue:Ud("base10"),valueToBytes:Md("base10")},{code:53,name:"dns",size:ct},{code:54,name:"dns4",size:ct},{code:55,name:"dns6",size:ct},{code:56,name:"dnsaddr",size:ct},{code:132,name:"sctp",size:16,valueToBytes:qo,bytesToValue:ws,validate:ac},{code:301,name:"udt"},{code:302,name:"utp"},{code:400,name:"unix",size:ct,stringToValue:r=>decodeURIComponent(r),valueToString:r=>encodeURIComponent(r)},{code:421,name:"p2p",aliases:["ipfs"],size:ct,bytesToValue:Ud("base58btc"),valueToBytes:r=>r.startsWith("Q")||r.startsWith("1")?Md("base58btc")(r):rt.parse(r).multihash.bytes},{code:444,name:"onion",size:96,bytesToValue:jd,valueToBytes:cw},{code:445,name:"onion3",size:296,bytesToValue:jd,valueToBytes:uw},{code:446,name:"garlic64",size:ct},{code:447,name:"garlic32",size:ct},{code:448,name:"tls"},{code:449,name:"sni",size:ct},{code:454,name:"noise"},{code:460,name:"quic"},{code:461,name:"quic-v1"},{code:465,name:"webtransport"},{code:466,name:"certhash",size:ct,bytesToValue:mw(Po),valueToBytes:dw},{code:480,name:"http"},{code:481,name:"http-path",size:ct,stringToValue:r=>`/${decodeURIComponent(r)}`,valueToString:r=>encodeURIComponent(r.substring(1))},{code:443,name:"https"},{code:477,name:"ws"},{code:478,name:"wss"},{code:479,name:"p2p-websocket-star"},{code:277,name:"p2p-stardust"},{code:275,name:"p2p-webrtc-star"},{code:276,name:"p2p-webrtc-direct"},{code:280,name:"webrtc-direct"},{code:281,name:"webrtc"},{code:290,name:"p2p-circuit"},{code:777,name:"memory",size:ct}];f2.forEach(r=>{mn.addProtocol(r)});function yw(r){let e=[],t=0;for(;t<r.length;){let n=hn(r,t),o=mn.getProtocol(n),i=Ue(n),s=h2(o,r,t+i),a=0;s>0&&o.size===ct&&(a=Ue(s));let c=i+a+s,f={code:n,name:o.name,bytes:r.subarray(t,t+c)};if(s>0){let p=t+i+a,h=r.subarray(p,p+s);f.value=o.bytesToValue?.(h)??ue(h)}e.push(f),t+=c}return e}function gw(r){let e=0,t=[];for(let n of r){if(n.bytes==null){let o=mn.getProtocol(n.code),i=Ue(n.code),s,a=0,c=0;n.value!=null&&(s=o.valueToBytes?.(n.value)??de(n.value),a=s.byteLength,o.size===ct&&(c=Ue(a)));let f=new Uint8Array(i+c+a),p=0;ps(n.code,f,p),p+=i,s!=null&&(o.size===ct&&(ps(a,f,p),p+=c),f.set(s,p)),n.bytes=f}t.push(n.bytes),e+=n.bytes.byteLength}return Tt(t,e)}function bw(r){if(r.charAt(0)!=="/")throw new ht('String multiaddr must start with "/"');let e=[],t="protocol",n="",o="";for(let i=1;i<r.length;i++){let s=r.charAt(i);s!=="/"&&(t==="protocol"?o+=r.charAt(i):n+=r.charAt(i));let a=i===r.length-1;if(s==="/"||a){let c=mn.getProtocol(o);if(t==="protocol"){if(c.size==null||c.size===0){e.push({code:c.code,name:c.name}),n="",o="",t="protocol";continue}else if(a)throw new ht(`Component ${o} was missing value`);t="value"}else if(t==="value"){let f={code:c.code,name:c.name};if(c.size!=null&&c.size!==0){if(n==="")throw new ht(`Component ${o} was missing value`);f.value=c.stringToValue?.(n)??n}e.push(f),n="",o="",t="protocol"}}}if(o!==""&&n!=="")throw new ht("Incomplete multiaddr");return e}function ww(r){return`/${r.flatMap(e=>{if(e.value==null)return e.name;let t=mn.getProtocol(e.code);if(t==null)throw new ht(`Unknown protocol code ${e.code}`);return[e.name,t.valueToString?.(e.value)??e.value]}).join("/")}`}function h2(r,e,t){return r.size==null||r.size===0?0:r.size>0?r.size/8:hn(e,t)}var p2=Symbol.for("nodejs.util.inspect.custom"),om=Symbol.for("@multiformats/multiaddr");function d2(r){if(r==null&&(r="/"),xw(r))return r.getComponents();if(r instanceof Uint8Array)return yw(r);if(typeof r=="string")return r=r.replace(/\/(\/)+/,"/").replace(/(\/)+$/,""),r===""&&(r="/"),bw(r);if(Array.isArray(r))return r;throw new ht("Must be a string, Uint8Array, Component[], or another Multiaddr")}var Wl=class r{[om]=!0;#e;#t;#r;constructor(e="/",t={}){this.#e=d2(e),t.validate!==!1&&m2(this)}get bytes(){return this.#r==null&&(this.#r=gw(this.#e)),this.#r}toString(){return this.#t==null&&(this.#t=ww(this.#e)),this.#t}toJSON(){return this.toString()}getComponents(){return[...this.#e.map(e=>({...e}))]}encapsulate(e){let t=new r(e);return new r([...this.#e,...t.getComponents()],{validate:!1})}decapsulate(e){let t=e.toString(),n=this.toString(),o=n.lastIndexOf(t);if(o<0)throw new Ul(`Address ${this.toString()} does not contain subaddress: ${t}`);return new r(n.slice(0,o),{validate:!1})}decapsulateCode(e){let t;for(let n=this.#e.length-1;n>-1;n--)if(this.#e[n].code===e){t=n;break}return new r(this.#e.slice(0,t),{validate:!1})}equals(e){return We(this.bytes,e.bytes)}[p2](){return`Multiaddr(${this.toString()})`}};function m2(r){r.getComponents().forEach(e=>{let t=mn.getProtocol(e.code);e.value!=null&&t.validate?.(e.value)})}function xw(r){return!!r?.[om]}function Ss(r){return new Wl(r)}var Pe=r=>({match:e=>{let t=e[0];return t==null||t.code!==r||t.value!=null?!1:e.slice(1)}}),ce=(r,e)=>({match:t=>{let n=t[0];return n?.code!==r||n.value==null||e!=null&&n.value!==e?!1:t.slice(1)}}),vw=r=>({match:e=>r.match(e)===!1?e:!1}),Se=r=>({match:e=>{let t=r.match(e);return t===!1?e:t}}),_t=(...r)=>({match:e=>{let t;for(let n of r){let o=n.match(e);o!==!1&&(t==null||o.length<t.length)&&(t=o)}return t??!1}}),ke=(...r)=>({match:e=>{for(let t of r){let n=t.match(e);if(n===!1)return!1;e=n}return e}});function Ne(...r){function e(o){if(o==null)return!1;let i=o.getComponents();for(let s of r){let a=s.match(i);if(a===!1)return!1;i=a}return i}function t(o){return e(o)!==!1}function n(o){let i=e(o);return i===!1?!1:i.length===0}return{matchers:r,matches:t,exactMatch:n}}var y2=ce(421),sO=Ne(y2),Gl=ce(54),zl=ce(55),Xl=ce(56),sm=ce(53),aO=Ne(Gl,Se(ce(421))),cO=Ne(zl,Se(ce(421))),uO=Ne(Xl,Se(ce(421))),lO=Ne(_t(sm,Xl,Gl,zl),Se(ce(421))),Aw=ke(ce(4),Se(ce(43))),Sw=ke(Se(ce(42)),ce(41),Se(ce(43))),am=_t(Aw,Sw),Xo=_t(am,sm,Gl,zl,Xl),fO=Ne(_t(am,ke(_t(sm,Xl,Gl,zl),Se(ce(421))))),hO=Ne(Aw),pO=Ne(Sw),dO=Ne(am),cm=ke(Xo,ce(6)),cc=ke(Xo,ce(273)),mO=Ne(ke(cm,Se(ce(421)))),yO=Ne(cc),um=ke(cc,Pe(460),Se(ce(421))),Zl=ke(cc,Pe(461),Se(ce(421))),g2=_t(um,Zl),gO=Ne(um),bO=Ne(Zl),im=_t(Xo,cm,cc,um,Zl),Ew=_t(ke(im,Pe(477),Se(ce(421)))),wO=Ne(Ew),_w=_t(ke(im,Pe(478),Se(ce(421))),ke(im,Pe(448),Se(ce(449)),Pe(477),Se(ce(421)))),xO=Ne(_w),Cw=ke(cc,Pe(280),Se(ce(466)),Se(ce(466)),Se(ce(421))),Bw=Ne(Cw),Iw=ke(Zl,Pe(465),Se(ce(466)),Se(ce(466)),Se(ce(421))),vO=Ne(Iw),ql=_t(Ew,_w,ke(cm,Se(ce(421))),ke(g2,Se(ce(421))),ke(Xo,Se(ce(421))),Cw,Iw,ce(421)),Tw=Ne(ql),b2=ke(Se(ql),Pe(290),vw(Pe(281)),Se(ce(421))),AO=Ne(b2),w2=_t(ke(ql,Pe(290),Pe(281),Se(ce(421))),ke(ql,Pe(281),Se(ce(421))),ke(Pe(281),Se(ce(421)))),kw=Ne(w2),x2=_t(ke(Xo,ce(6),Pe(480),Se(ce(421))),ke(Xo,Pe(480),Se(ce(421)))),SO=Ne(x2),v2=ke(Xo,_t(ke(ce(6,"443"),Pe(480)),ke(ce(6),Pe(443)),ke(ce(6),Pe(448),Pe(480)),ke(Pe(448),Pe(480)),Pe(448),Pe(443)),Se(ce(421))),EO=Ne(v2),A2=_t(ke(ce(777),Se(ce(421)))),_O=Ne(A2),S2=_t(ke(ce(400),Se(ce(421)))),CO=Ne(S2);var Ct;(function(r){let e;(function(o){o.FIN="FIN",o.STOP_SENDING="STOP_SENDING",o.RESET="RESET",o.FIN_ACK="FIN_ACK"})(e=r.Flag||(r.Flag={}));let t;(function(o){o[o.FIN=0]="FIN",o[o.STOP_SENDING=1]="STOP_SENDING",o[o.RESET=2]="RESET",o[o.FIN_ACK=3]="FIN_ACK"})(t||(t={})),(function(o){o.codec=()=>Wo(t)})(e=r.Flag||(r.Flag={}));let n;r.codec=()=>(n==null&&(n=Sr((o,i,s={})=>{s.lengthDelimited!==!1&&i.fork(),o.flag!=null&&(i.uint32(8),r.Flag.codec().encode(o.flag,i)),o.message!=null&&(i.uint32(18),i.bytes(o.message)),s.lengthDelimited!==!1&&i.ldelim()},(o,i,s={})=>{let a={},c=i==null?o.len:o.pos+i;for(;o.pos<c;){let f=o.uint32();switch(f>>>3){case 1:{a.flag=r.Flag.codec().decode(o);break}case 2:{a.message=o.bytes();break}default:{o.skipType(f&7);break}}}return a})),n),r.encode=o=>Ar(o,r.codec()),r.decode=(o,i)=>vr(o,r.codec(),i)})(Ct||(Ct={}));var Ow=["stun:stun.l.google.com:19302","stun:global.stun.twilio.com:3478","stun:stun.cloudflare.com:3478","stun:stun.services.mozilla.com:3478"],lm=Array.from("abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ1234567890"),Pw="libp2p+webrtc+v1/",Nw=2*1024*1024,Es=16*1024;function E2(r=Es){let e=Ue(r-Ue(r)),t=1+Ue(Object.keys(Ct.Flag).length-1),n=1,o=r-e-t-n,i=Ue(o);return e+t+n+i}var Dw=E2();var Rw=1e4,fm="/webrtc",uc="/webrtc-signaling/0.0.1",Lw="/libp2p/webrtc-direct/certificate",Uw="webrtc-direct-certificate-private-key";var Mw=12096e5,hm=864e5;function pm(r){let e=r.getComponents(),t={},n=0;if(e[n]?.name==="ip6zone"&&(t.zone=`${e[n].value}`,n++),e[n].name==="ip4"||e[n].name==="ip6"||e[n].name==="dns"||e[n].name==="dns4"||e[n].name==="dns6"?(t.type=e[n].name,t.host=e[n].value,n++):e[n].name==="dnsaddr"&&(t.type=e[n].name,t.host=`_dnsaddr.${e[n].value}`,n++),(e[n]?.name==="tcp"||e[n]?.name==="udp")&&(t.protocol=e[n].name==="tcp"?"tcp":"udp",t.port=parseInt(`${e[n].value}`),n++),e[n]?.name==="ipcidr"&&(t.type==="ip4"?t.cidr=parseInt(`${e[n].value}`):t.type==="ip6"&&(t.cidr=`${e[n].value}`),n++),t.type==null||t.host==null)throw new xe(`Multiaddr ${r} was not an IPv4, IPv6, DNS, DNS4, DNS6 or DNSADDR address`);return e[n]?.name==="tls"&&e[n+1]?.name==="sni"&&(t.sni=e[n+1].value,n+=2),t}function Yl(){let r={};return r.promise=new Promise((e,t)=>{r.resolve=e,r.reject=t}),r}var Jl=class{buffer;mask;top;btm;next;constructor(e){if(!(e>0)||(e-1&e)!==0)throw new Error("Max size for a FixedFIFO should be a power of two");this.buffer=new Array(e),this.mask=e-1,this.top=0,this.btm=0,this.next=null}push(e){return this.buffer[this.top]!==void 0?!1:(this.buffer[this.top]=e,this.top=this.top+1&this.mask,!0)}shift(){let e=this.buffer[this.btm];if(e!==void 0)return this.buffer[this.btm]=void 0,this.btm=this.btm+1&this.mask,e}isEmpty(){return this.buffer[this.btm]===void 0}},_s=class{size;hwm;head;tail;constructor(e={}){this.hwm=e.splitLimit??16,this.head=new Jl(this.hwm),this.tail=this.head,this.size=0}calculateSize(e){return e?.byteLength!=null?e.byteLength:1}push(e){if(e?.value!=null&&(this.size+=this.calculateSize(e.value)),!this.head.push(e)){let t=this.head;this.head=t.next=new Jl(2*this.head.buffer.length),this.head.push(e)}}shift(){let e=this.tail.shift();if(e===void 0&&this.tail.next!=null){let t=this.tail.next;this.tail.next=null,this.tail=t,e=this.tail.shift()}return e?.value!=null&&(this.size-=this.calculateSize(e.value)),e}isEmpty(){return this.head.isEmpty()}};var dm=class extends Error{type;code;constructor(e,t){super(e??"The operation was aborted"),this.type="aborted",this.code=t??"ABORT_ERR"}};function Cs(r={}){return _2(t=>{let n=t.shift();if(n==null)return{done:!0};if(n.error!=null)throw n.error;return{done:n.done===!0,value:n.value}},r)}function _2(r,e){e=e??{};let t=e.onEnd,n=new _s,o,i,s,a=Yl(),c=async()=>{try{return n.isEmpty()?s?{done:!0}:await new Promise((m,S)=>{i=N=>{i=null,n.push(N);try{m(r(n))}catch(I){S(I)}return o}}):r(n)}finally{n.isEmpty()&&queueMicrotask(()=>{a.resolve(),a=Yl()})}},f=m=>i!=null?i(m):(n.push(m),o),p=m=>(n=new _s,i!=null?i({error:m}):(n.push({error:m}),o)),h=m=>{if(s)return o;if(e?.objectMode!==!0&&m?.byteLength==null)throw new Error("objectMode was not true but tried to push non-Uint8Array value");return f({done:!1,value:m})},y=m=>s?o:(s=!0,m!=null?p(m):f({done:!0})),b=()=>(n=new _s,y(),{done:!0}),g=m=>(y(m),{done:!0});if(o={[Symbol.asyncIterator](){return this},next:c,return:b,throw:g,push:h,end:y,get readableLength(){return n.size},onEmpty:async m=>{let S=m?.signal;if(S?.throwIfAborted(),n.isEmpty())return;let N,I;S!=null&&(N=new Promise((K,Z)=>{I=()=>{Z(new dm)},S.addEventListener("abort",I)}));try{await Promise.race([a.promise,N])}finally{I!=null&&S!=null&&S?.removeEventListener("abort",I)}}},t==null)return o;let C=o;return o={[Symbol.asyncIterator](){return this},next(){return C.next()},throw(m){return C.throw(m),t!=null&&(t(m),t=void 0),{done:!0}},return(){return C.return(),t!=null&&(t(),t=void 0),{done:!0}},push:h,end(m){return C.end(m),t!=null&&(t(m),t=void 0),o},get readableLength(){return C.readableLength},onEmpty:m=>C.onEmpty(m)},o}var mm=class extends Error{constructor(e){super(e),this.name="TimeoutError"}},ym=class extends Error{constructor(e){super(),this.name="AbortError",this.message=e}},jw=r=>globalThis.DOMException===void 0?new ym(r):new DOMException(r),Kw=r=>{let e=r.reason===void 0?jw("This operation was aborted."):r.reason;return e instanceof Error?e:jw(e)};function gm(r,e){let{milliseconds:t,fallback:n,message:o,customTimers:i={setTimeout,clearTimeout}}=e,s,a,f=new Promise((p,h)=>{if(typeof t!="number"||Math.sign(t)!==1)throw new TypeError(`Expected \`milliseconds\` to be a positive number, got \`${t}\``);if(e.signal){let{signal:b}=e;b.aborted&&h(Kw(b)),a=()=>{h(Kw(b))},b.addEventListener("abort",a,{once:!0})}if(t===Number.POSITIVE_INFINITY){r.then(p,h);return}let y=new mm;s=i.setTimeout.call(void 0,()=>{if(n){try{p(n())}catch(b){h(b)}return}typeof r.cancel=="function"&&r.cancel(),o===!1?p():o instanceof Error?h(o):(y.message=o??`Promise timed out after ${t} milliseconds`,h(y))},t),(async()=>{try{p(await r)}catch(b){h(b)}})()}).finally(()=>{f.clear(),a&&e.signal&&e.signal.removeEventListener("abort",a)});return f.clear=()=>{i.clearTimeout.call(void 0,s),s=void 0},f}var C2=r=>{let e=r.addEventListener||r.on||r.addListener,t=r.removeEventListener||r.off||r.removeListener;if(!e||!t)throw new TypeError("Emitter is not compatible");return{addListener:e.bind(r),removeListener:t.bind(r)}};function B2(r,e,t){let n,o=new Promise((i,s)=>{if(t={rejectionEvents:["error"],multiArgs:!1,rejectionMultiArgs:!1,resolveImmediately:!1,...t},!(t.count>=0&&(t.count===Number.POSITIVE_INFINITY||Number.isInteger(t.count))))throw new TypeError("The `count` option should be at least 0 or more");t.signal?.throwIfAborted();let a=[e].flat(),c=[],{addListener:f,removeListener:p}=C2(r),h=async(...b)=>{let g=t.multiArgs?b:b[0];if(t.filter)try{if(!await t.filter(g))return}catch(C){n(),s(C);return}c.push(g),t.count===c.length&&(n(),i(c))},y=(...b)=>{n(),s(t.rejectionMultiArgs?b:b[0])};n=()=>{for(let b of a)p(b,h);for(let b of t.rejectionEvents)a.includes(b)||p(b,y)};for(let b of a)f(b,h);for(let b of t.rejectionEvents)a.includes(b)||f(b,y);t.signal&&t.signal.addEventListener("abort",()=>{y(t.signal.reason)},{once:!0}),t.resolveImmediately&&i(c)});if(o.cancel=n,typeof t.timeout=="number"){let i=gm(o,{milliseconds:t.timeout});return i.cancel=()=>{n(),i.clear()},i}return o}function pt(r,e,t){typeof t=="function"&&(t={filter:t}),t={...t,count:1,resolveImmediately:!1};let n=B2(r,e,t),o=n.then(i=>i[0]);return o.cancel=n.cancel,o}var Zo=class extends Error{static name="UnexpectedEOFError";name="UnexpectedEOFError"},Ql=class extends Error{static name="MaxEarlyStreamsError";name="MaxEarlyStreamsError"},ef=class extends Error{static name="StreamClosedError";name="StreamClosedError"};function I2(r){return r.reason}async function Qn(r,e,t){if(e==null)return r;let n=t?.translateError??I2;if(e.aborted)return r.catch(()=>{}),Promise.reject(n(e));let o;try{return await Promise.race([r,new Promise((i,s)=>{o=()=>{s(n(e))},e.addEventListener("abort",o)})])}finally{o!=null&&e.removeEventListener("abort",o)}}var T2=Math.pow(2,20)*4,eo=class extends er{status;timeline;inactivityTimeout;maxReadBufferLength;maxWriteBufferLength;log;direction;maxMessageSize;readStatus;writeStatus;remoteReadStatus;remoteWriteStatus;writableNeedsDrain;readBuffer;writeBuffer;sendingData;onDrainPromise;constructor(e){super(),this.status="open",this.log=e.log,this.direction=e.direction??"outbound",this.inactivityTimeout=e.inactivityTimeout??12e4,this.maxReadBufferLength=e.maxReadBufferLength??T2,this.maxWriteBufferLength=e.maxWriteBufferLength,this.maxMessageSize=e.maxMessageSize,this.readBuffer=new me,this.writeBuffer=new me,this.readStatus="readable",this.remoteReadStatus="readable",this.writeStatus="writable",this.remoteWriteStatus="writable",this.sendingData=!1,this.writableNeedsDrain=!1,this.timeline={open:Date.now()},this.processSendQueue=this.processSendQueue.bind(this);let t=()=>{this.writableNeedsDrain&&(this.log.trace("drain event received, continue sending data"),this.writableNeedsDrain=!1,this.processSendQueue()),this.onDrainPromise?.resolve()};this.addEventListener("drain",t);let n=o=>{this.onDrainPromise?.reject(o.error??new ef)};this.addEventListener("close",n)}get readBufferLength(){return this.readBuffer.byteLength}get writeBufferLength(){return this.writeBuffer.byteLength}async onDrain(e){return this.writableNeedsDrain!==!0?Promise.resolve():(this.onDrainPromise==null&&(this.onDrainPromise=Promise.withResolvers()),Qn(this.onDrainPromise.promise,e?.signal))}async*[Symbol.asyncIterator](){if(this.readStatus!=="readable"&&this.readStatus!=="paused")return;let e=Cs(),t=i=>{e.push(i.data)};this.addEventListener("message",t);let n=i=>{e.end(i.error)};this.addEventListener("close",n);let o=()=>{e.end()};this.addEventListener("remoteCloseWrite",o);try{yield*e}finally{this.removeEventListener("message",t),this.removeEventListener("close",n),this.removeEventListener("remoteCloseWrite",o)}}isReadable(){return this.status==="open"}send(e){if(this.writeStatus==="closed"||this.writeStatus==="closing")throw new Lr(`Cannot write to a stream that is ${this.writeStatus}`);return this.log.trace("append %d bytes to write buffer",e.byteLength),this.writeBuffer.append(e),this.processSendQueue()}abort(e){if(!(this.status==="aborted"||this.status==="reset"||this.status==="closed")){this.log.error("abort with error - %e",e),this.status="aborted",this.readBuffer.byteLength>0&&this.readBuffer.consume(this.readBuffer.byteLength),this.writeBuffer.byteLength>0&&(this.writeBuffer.consume(this.writeBuffer.byteLength),this.safeDispatchEvent("idle")),this.writeStatus="closed",this.remoteWriteStatus="closed",this.readStatus="closed",this.remoteReadStatus="closed",this.timeline.close=Date.now();try{this.sendReset(e)}catch(t){this.log("failed to send reset to remote - %e",t)}this.dispatchEvent(new ll(e))}}pause(){if(this.readStatus==="closed"||this.readStatus==="closing")throw new Lr("Cannot pause a stream that is closing/closed");this.readStatus!=="paused"&&(this.readStatus="paused",this.sendPause())}resume(){if(this.readStatus==="closed"||this.readStatus==="closing")throw new Lr("Cannot resume a stream that is closing/closed");this.readStatus!=="readable"&&(this.readStatus="readable",this.dispatchReadBuffer(),this.sendResume())}push(e){if(this.readStatus==="closed"||this.readStatus==="closing")throw new Lr(`Cannot push data onto a stream that is ${this.readStatus}`);if(e.byteLength!==0){if(this.readBuffer.append(e),this.readStatus==="paused"||this.listenerCount("message")===0){this.checkReadBufferLength();return}setTimeout(()=>{this.dispatchReadBuffer()},0)}}unshift(e){if(this.readStatus==="closed"||this.readStatus==="closing")throw new Lr(`Cannot push data onto a stream that is ${this.readStatus}`);if(e.byteLength!==0){if(this.readBuffer.prepend(e),this.readStatus==="paused"||this.listenerCount("message")===0){this.checkReadBufferLength();return}setTimeout(()=>{this.dispatchReadBuffer()},0)}}onData(e){if(e.byteLength!==0){if(this.readStatus==="closing"||this.readStatus==="closed"){this.log("ignoring data - read status %s",this.readStatus);return}this.readBuffer.append(e),this.dispatchReadBuffer()}}addEventListener(...e){super.addEventListener.apply(this,e),e[0]==="message"&&this.readBuffer.byteLength>0&&queueMicrotask(()=>{this.dispatchReadBuffer()})}onRemoteReset(){this.log("remote reset"),this.status="reset",this.writeStatus="closed",this.remoteWriteStatus="closed",this.remoteReadStatus="closed",this.timeline.close=Date.now(),this.readBuffer.byteLength===0&&(this.readStatus="closed");let e=new Zi;this.dispatchEvent(new fl(e))}onTransportClosed(e){this.log("transport closed"),this.readStatus==="readable"&&this.readBuffer.byteLength===0&&(this.log("close readable end after transport closed and read buffer is empty"),this.readStatus="closed"),this.remoteReadStatus!=="closed"&&(this.remoteReadStatus="closed"),this.remoteWriteStatus!=="closed"&&(this.remoteWriteStatus="closed"),this.writeStatus!=="closed"&&(this.writeStatus="closed"),e!=null?this.abort(e):(this.status==="open"||this.status==="closing")&&(this.timeline.close=Date.now(),this.status="closed",this.writeStatus="closed",this.remoteWriteStatus="closed",this.remoteReadStatus="closed",this.dispatchEvent(new Yi))}onRemoteCloseWrite(){this.remoteWriteStatus!=="closed"&&(this.log.trace("on remote close write"),this.remoteWriteStatus="closed",this.safeDispatchEvent("remoteCloseWrite"),this.writeStatus==="closed"&&this.onTransportClosed())}onRemoteCloseRead(){this.log.trace("on remote close read"),this.remoteReadStatus="closed",this.writeBuffer.byteLength>0&&(this.writeBuffer.consume(this.writeBuffer.byteLength),this.safeDispatchEvent("idle"))}processSendQueue(){if(this.writableNeedsDrain)return this.log.trace("not processing send queue as drain is required"),this.checkWriteBufferLength(),!1;if(this.writeBuffer.byteLength===0)return this.log.trace("not processing send queue as no bytes to send"),!0;if(this.sendingData)return this.log.trace("not processing send queue as already sending data"),!0;this.sendingData=!0,this.log.trace("processing send queue with %d queued bytes",this.writeBuffer.byteLength);try{let e=!0,t=this.writeBuffer.byteLength,n=0;for(;this.writeBuffer.byteLength>0;){let o=Math.min(this.maxMessageSize??this.writeBuffer.byteLength,this.writeBuffer.byteLength);if(o===0){e=!1;break}let i=this.writeBuffer.sublist(0,o),s=new me(i);this.writeBuffer.consume(i.byteLength);let a=this.sendData(i);if(e=a.canSendMore,n+=a.sentBytes,a.sentBytes!==s.byteLength&&(s.consume(a.sentBytes),this.writeBuffer.prepend(s)),!e)break}return e||(this.log.trace("sent %d/%d bytes, pausing sending because underlying stream is full, %d bytes left in the write buffer",n,t,this.writeBuffer.byteLength),this.writableNeedsDrain=!0,this.checkWriteBufferLength()),this.writeBuffer.byteLength===0&&this.safeDispatchEvent("idle"),e}finally{this.sendingData=!1}}dispatchReadBuffer(){try{if(this.listenerCount("message")===0){this.log.trace("not dispatching pause buffer as there are no listeners for the message event");return}if(this.readBuffer.byteLength===0){this.log.trace("not dispatching pause buffer as there is no data to dispatch");return}if(this.readStatus==="paused"){this.log.trace("not dispatching pause buffer we are paused");return}if(this.readStatus==="closing"||this.readStatus==="closed"){this.log("dropping %d bytes because the readable end is %s",this.readBuffer.byteLength,this.readStatus),this.readBuffer.consume(this.readBuffer.byteLength);return}let e=this.readBuffer.sublist();this.readBuffer.consume(e.byteLength),this.dispatchEvent(new ul(e))}finally{this.readBuffer.byteLength===0&&this.remoteWriteStatus==="closed"&&(this.log("close readable end after dispatching read buffer and remote writable end is closed"),this.readStatus="closed"),this.checkReadBufferLength()}}checkReadBufferLength(){this.readBuffer.byteLength>this.maxReadBufferLength&&this.abort(new _a(`Read buffer length of ${this.readBuffer.byteLength} exceeded limit of ${this.maxReadBufferLength}, read status is ${this.readStatus}`))}checkWriteBufferLength(){this.maxWriteBufferLength!=null&&this.writeBuffer.byteLength>this.maxWriteBufferLength&&this.abort(new _a(`Write buffer length of ${this.writeBuffer.byteLength} exceeded limit of ${this.maxWriteBufferLength}, write status is ${this.writeStatus}`))}onMuxerNeedsDrain(){this.writableNeedsDrain=!0}onMuxerDrain(){this.safeDispatchEvent("drain")}};var tf=class extends eo{remoteAddr;metricPrefix;metrics;constructor(e){super(e),this.metricPrefix=e.metricPrefix??"",this.metrics=e.metrics,this.remoteAddr=e.remoteAddr,this.addEventListener("close",t=>{this.metrics?.increment({[`${this.metricPrefix}end`]:!0}),t.error!=null?t.local?this.metrics?.increment({[`${this.metricPrefix}abort`]:!0}):this.metrics?.increment({[`${this.metricPrefix}reset`]:!0}):t.local?this.metrics?.increment({[`${this.metricPrefix}_local_close`]:!0}):this.metrics?.increment({[`${this.metricPrefix}_remote_close`]:!0})})}async close(e){this.status==="open"&&(this.status="closing",this.writeStatus="closing",this.remoteWriteStatus="closing",this.remoteReadStatus="closing",(this.sendingData||this.writeBuffer.byteLength>0)&&(this.log("waiting for write queue to become idle before closing writable end of stream, %d unsent bytes",this.writeBuffer.byteLength),await pt(this,"idle",{...e,rejectionEvents:["close"]})),this.writableNeedsDrain&&(this.log("waiting for write queue to drain before closing writable end of stream, %d unsent bytes",this.writeBuffer.byteLength),await pt(this,"drain",{...e,rejectionEvents:["close"]})),await this.sendClose(e),this.onTransportClosed())}};function Hw(r){return r==null?!1:typeof r.then=="function"&&typeof r.catch=="function"&&typeof r.finally=="function"}var rf=class extends er{streams;protocol;status;log;maConn;streamOptions;earlyStreams;maxEarlyStreams;metrics;constructor(e,t){super(),this.maConn=e,this.protocol=t.protocol,this.streams=[],this.earlyStreams=[],this.status="open",this.log=e.log.newScope(t.name),this.streamOptions=t.streamOptions,this.maxEarlyStreams=t.maxEarlyStreams??10,this.metrics=t.metrics;let n=s=>{try{this.onData(s.data)}catch(a){this.abort(a),this.maConn.abort(a)}};this.maConn.addEventListener("message",n);let o=()=>{this.log("underlying stream drained, signal %d streams to continue writing",this.streams.length),this.streams.forEach(s=>{s.onMuxerDrain()})};this.maConn.addEventListener("drain",o);let i=()=>{this.log("underlying stream closed with status %s and %d streams",this.status,this.streams.length),this.onTransportClosed()};this.maConn.addEventListener("close",i)}send(e){let t=this.maConn.send(e);return t===!1&&(this.log("underlying stream saturated, signal %d streams to pause writing",this.streams.length),this.streams.forEach(n=>{n.onMuxerNeedsDrain()})),t}async close(e){this.status==="closed"||this.status==="closing"||(this.status="closing",await Qn(Promise.all([...this.streams].map(async t=>{await t.close(e)})),e?.signal),this.status="closed")}abort(e){this.status!=="closed"&&(this.status="closing",[...this.streams].forEach(t=>{t.abort(e)}),this.status="closed")}onTransportClosed(e){this.status="closing";try{[...this.streams].forEach(t=>{t.onTransportClosed(e)})}catch(t){this.abort(t)}this.status="closed"}async createStream(e){if(this.status!=="open")throw new nl;let t=this.onCreateStream({...this.streamOptions,...e});return Hw(t)&&(t=await t),this.streams.push(t),this.cleanUpStream(t),t}onRemoteStream(e){if(this.streams.push(e),this.cleanUpStream(e),this.listenerCount("stream")===0){this.earlyStreams.push(e),this.earlyStreams.length>this.maxEarlyStreams&&this.abort(new Ql(`Too many early streams were opened - ${this.earlyStreams.length}/${this.maxEarlyStreams}`));return}this.safeDispatchEvent("stream",{detail:e})}cleanUpStream(e){let t=n=>{let o=this.streams.findIndex(i=>i===e);o!==-1&&this.streams.splice(o,1),n.error!=null?n.local?this.metrics?.increment({[`${e.direction}_stream_reset`]:!0}):this.metrics?.increment({[`${e.direction}_stream_abort`]:!0}):this.metrics?.increment({[`${e.direction}_stream_end`]:!0})};e.addEventListener("close",t),this.metrics?.increment({[`${e.direction}_stream`]:!0})}addEventListener(...e){super.addEventListener.apply(this,e),e[0]==="stream"&&this.earlyStreams.length>0&&queueMicrotask(()=>{this.earlyStreams.forEach(t=>{this.safeDispatchEvent("stream",{detail:t})}),this.earlyStreams=[]})}};var nf=class extends eo{id;protocol;constructor(e){super(e),this.id=e.id,this.protocol=e.protocol??""}async close(e){this.writeStatus==="closing"||this.writeStatus==="closed"||(this.writeStatus="closing",(this.sendingData||this.writeBuffer.byteLength>0)&&(this.log("waiting for write queue to become idle before closing writable end of stream, %d unsent bytes",this.writeBuffer.byteLength),await pt(this,"idle",{...e,rejectionEvents:["close"]})),this.writableNeedsDrain&&(this.log("waiting for write queue to drain before closing writable end of stream, %d unsent bytes, sending %s",this.writeBuffer.byteLength,this.sendingData),await pt(this,"drain",{...e,rejectionEvents:["close"]}),this.log("write queue drained, closing writable end of stream, %d unsent bytes, sending %s",this.writeBuffer.byteLength,this.sendingData)),await this.sendCloseWrite(e),this.writeStatus="closed",this.log("closed writable end gracefully"),this.remoteWriteStatus==="closed"&&this.onTransportClosed())}async closeRead(e){this.readStatus==="closing"||this.readStatus==="closed"||(this.readBuffer.byteLength>0&&this.readBuffer.consume(this.readBuffer.byteLength),this.readStatus="closing",await this.sendCloseRead(e),this.readStatus="closed",this.log("closed readable end gracefully"))}};var k2=4194304,of=class extends Error{static name="UnwrappedError";name="UnwrappedError"},lc=class extends Error{name="InvalidMessageLengthError";code="ERR_INVALID_MSG_LENGTH"},wm=class extends Error{name="InvalidDataLengthError";code="ERR_MSG_DATA_TOO_LONG"},xm=class extends Error{name="InvalidDataLengthLengthError";code="ERR_MSG_LENGTH_TOO_LONG"};function O2(r){return typeof r?.closeRead=="function"}function P2(r){return typeof r?.close=="function"}function bm(r){return O2(r)?r.remoteWriteStatus!=="writable"&&r.readBufferLength===0:P2(r)?r.status!=="open":!1}function N2(r){return r?.addEventListener!=null&&r?.removeEventListener!=null&&r?.send!=null&&r?.push!=null&&r?.log!=null}function D2(r,e){let t=e?.maxBufferSize??k2,n=new me,o,i=!1;if(!N2(r))throw new xe("Argument should be a Stream or a Multiaddr");let s=p=>{if(n.append(p.data),n.byteLength>t){let h=n.byteLength;n.consume(n.byteLength),o?.reject(new Error(`Read buffer overflow - ${h} > ${t}`))}o?.resolve()};r.addEventListener("message",s);let a=p=>{p.error!=null?o?.reject(p.error):o?.resolve()};r.addEventListener("close",a);let c=()=>{o?.resolve()};r.addEventListener("remoteCloseWrite",c);let f={readBuffer:n,async read(p){if(i===!0)throw new of("Stream was unwrapped");if(bm(r)){if(p?.bytes==null)return null;if(n.byteLength<p.bytes)throw r.log.error("closed after reading %d/%d bytes",n.byteLength,p.bytes),new Zo(`Unexpected EOF - stream closed after reading ${n.byteLength}/${p.bytes} bytes`)}let h=p?.bytes??1;for(o=Promise.withResolvers();;){if(n.byteLength>=h){o.resolve();break}if(await Qn(o.promise,p?.signal),bm(r)){if(n.byteLength===0&&p?.bytes==null)return null;break}o=Promise.withResolvers()}let y=p?.bytes??n.byteLength;if(n.byteLength<y){if(bm(r))throw r.log.error("closed while reading %d/%d bytes",n.byteLength,y),new Zo(`Unexpected EOF - stream closed while reading ${n.byteLength}/${y} bytes`);return f.read(p)}let b=n.sublist(0,y);return n.consume(y),b},async write(p,h){if(i===!0)throw new of("Stream was unwrapped");r.send(p)||await pt(r,"drain",{signal:h?.signal,rejectionEvents:["close"]})},unwrap(){return i||(i=!0,r.removeEventListener("message",s),r.removeEventListener("close",a),r.removeEventListener("remoteCloseWrite",c),n.byteLength>0&&(r.log("stream unwrapped with %d unread bytes",n.byteLength),r.push(n))),r}};return f}function sf(r,e={}){let t=D2(r,e);e.maxDataLength!=null&&e.maxLengthLength==null&&(e.maxLengthLength=Ue(e.maxDataLength));let n=e?.lengthDecoder??hn,o=e?.lengthEncoder??Tl;return{async read(s){let a=-1,c=new me;for(;;){let p=await t.read({...s,bytes:1});if(p==null)break;c.append(p);try{a=n(c)}catch(h){if(h instanceof RangeError)continue;throw h}if(a<0)throw new lc("Invalid message length");if(e?.maxLengthLength!=null&&c.byteLength>e.maxLengthLength)throw new xm(`Message length length too long - ${c.byteLength} > ${e.maxLengthLength}`);if(a>-1)break}if(e?.maxDataLength!=null&&a>e.maxDataLength)throw new wm(`Message length too long - ${a} > ${e.maxDataLength}`);let f=await t.read({...s,bytes:a});if(f==null)throw r.log.error("tried to read %d bytes but the stream closed",a),new Zo(`Unexpected EOF - tried to read ${a} bytes but the stream closed`);if(f.byteLength!==a)throw r.log.error("read %d/%d bytes before the stream closed",f.byteLength,a),new Zo(`Unexpected EOF - read ${f.byteLength}/${a} bytes before the stream closed`);return f},async write(s,a){await t.write(new me(o(s.byteLength),s),a)},async writeV(s,a){let c=new me(...s.flatMap(f=>[o(f.byteLength),f]));await t.write(c,a)},unwrap(){return t.unwrap()}}}function af(r,e){let t=sf(r,e),n={read:async(o,i)=>{let s=await t.read(i);return o.decode(s)},write:async(o,i,s)=>{await t.write(i.encode(o),s)},writeV:async(o,i,s)=>{await t.writeV(o.map(a=>i.encode(a)),s)},pb:o=>({read:async i=>n.read(o,i),write:async(i,s)=>n.write(i,o,s),writeV:async(i,s)=>n.writeV(i,o,s),unwrap:()=>n}),unwrap:()=>t.unwrap()};return n}var R2=1024*1024*4,L2=1024*1024*4,cf=class{buffer;maxBufferSize;lengthDecoder;maxDataLength;encodingLength;constructor(e={}){this.buffer=new me,this.maxBufferSize=e.maxBufferSize??R2,this.maxDataLength=e.maxDataLength??L2,this.lengthDecoder=e.lengthDecoder??hn,this.encodingLength=e.encodingLength??Ue}*decode(e){if(this.buffer.append(e),this.buffer.byteLength>this.maxBufferSize)throw new xe(`Buffer length limit exceeded - ${this.buffer.byteLength}/${this.maxBufferSize}`);for(;;){let t;try{t=this.lengthDecoder(this.buffer)}catch(i){if(i instanceof RangeError)break;throw i}if(t<0||t>this.maxDataLength)throw new lc("Invalid message length");let n=this.encodingLength(t),o=n+t;if(this.buffer.byteLength>=o){let i=this.buffer.sublist(n,o);this.buffer.consume(o),i.byteLength>0&&(yield i)}else break}}};var uf=class extends Error{name="InvalidMessageLengthError";code="ERR_INVALID_MSG_LENGTH"},Bs=class extends Error{name="InvalidDataLengthError";code="ERR_MSG_DATA_TOO_LONG"},lf=class extends Error{name="InvalidDataLengthLengthError";code="ERR_MSG_LENGTH_TOO_LONG"},fc=class extends Error{name="UnexpectedEOFError";code="ERR_UNEXPECTED_EOF"};function ff(r){return r[Symbol.asyncIterator]!=null}function Vw(r,e){if(r.byteLength>e)throw new Bs("Message length too long")}var pf=r=>{let e=Ue(r),t=ot(e);return Tl(r,t),pf.bytes=e,t};pf.bytes=0;function hc(r,e){e=e??{};let t=e.lengthEncoder??pf,n=e?.maxDataLength??4194304;function*o(i){Vw(i,n);let s=t(i.byteLength);s instanceof Uint8Array?yield s:yield*s,i instanceof Uint8Array?yield i:yield*i}return ff(r)?(async function*(){for await(let i of r)yield*o(i)})():(function*(){for(let i of r)yield*o(i)})()}hc.single=(r,e)=>{e=e??{};let t=e.lengthEncoder??pf,n=e?.maxDataLength??4194304;return Vw(r,n),new me(t(r.byteLength),r)};var Yo;(function(r){r[r.LENGTH=0]="LENGTH",r[r.DATA=1]="DATA"})(Yo||(Yo={}));var vm=r=>{let e=hn(r);return vm.bytes=Ue(e),e};vm.bytes=0;function pc(r,e){let t=new me,n=Yo.LENGTH,o=-1,i=e?.lengthDecoder??vm,s=e?.maxLengthLength??8,a=e?.maxDataLength??4194304;function*c(){for(;t.byteLength>0;){if(n===Yo.LENGTH)try{if(o=i(t),o<0)throw new uf("Invalid message length");if(o>a)throw new Bs("Message length too long");let f=i.bytes;t.consume(f),e?.onLength!=null&&e.onLength(o),n=Yo.DATA}catch(f){if(f instanceof RangeError){if(t.byteLength>s)throw new lf("Message length length too long");break}throw f}if(n===Yo.DATA){if(t.byteLength<o)break;let f=t.sublist(0,o);t.consume(o),e?.onData!=null&&e.onData(f),yield f,n=Yo.LENGTH}}}return ff(r)?(async function*(){for await(let f of r)t.append(f),yield*c();if(t.byteLength>0)throw new fc("Unexpected end of input")})():(function*(){for(let f of r)t.append(f),yield*c();if(t.byteLength>0)throw new fc("Unexpected end of input")})()}pc.fromReader=(r,e)=>{let t=1,n=(async function*(){for(;;)try{let{done:i,value:s}=await r.next(t);if(i===!0)return;s!=null&&(yield s)}catch(i){if(i.code==="ERR_UNDER_READ")return{done:!0,value:null};throw i}finally{t=1}})();return pc(n,{...e??{},onLength:i=>{t=i}})};var $w=function(r,e,t){if(t||arguments.length===2)for(var n=0,o=e.length,i;n<o;n++)(i||!(n in e))&&(i||(i=Array.prototype.slice.call(e,0,n)),i[n]=e[n]);return r.concat(i||Array.prototype.slice.call(e))},j2=(function(){function r(e,t,n){this.name=e,this.version=t,this.os=n,this.type="browser"}return r})();var K2=(function(){function r(e){this.version=e,this.type="node",this.name="node",this.os=process.platform}return r})();var H2=(function(){function r(e,t,n,o){this.name=e,this.version=t,this.os=n,this.bot=o,this.type="bot-device"}return r})();var V2=(function(){function r(){this.type="bot",this.bot=!0,this.name="bot",this.version=null,this.os=null}return r})();var $2=(function(){function r(){this.type="react-native",this.name="react-native",this.version=null,this.os=null}return r})();var F2=/alexa|bot|crawl(er|ing)|facebookexternalhit|feedburner|google web preview|nagios|postrank|pingdom|slurp|spider|yahoo!|yandex/,W2=/(nuhk|curl|Googlebot|Yammybot|Openbot|Slurp|MSNBot|Ask\ Jeeves\/Teoma|ia_archiver)/,Fw=3,q2=[["aol",/AOLShield\/([0-9\._]+)/],["edge",/Edge\/([0-9\._]+)/],["edge-ios",/EdgiOS\/([0-9\._]+)/],["yandexbrowser",/YaBrowser\/([0-9\._]+)/],["kakaotalk",/KAKAOTALK\s([0-9\.]+)/],["samsung",/SamsungBrowser\/([0-9\.]+)/],["silk",/\bSilk\/([0-9._-]+)\b/],["miui",/MiuiBrowser\/([0-9\.]+)$/],["beaker",/BeakerBrowser\/([0-9\.]+)/],["edge-chromium",/EdgA?\/([0-9\.]+)/],["chromium-webview",/(?!Chrom.*OPR)wv\).*Chrom(?:e|ium)\/([0-9\.]+)(:?\s|$)/],["chrome",/(?!Chrom.*OPR)Chrom(?:e|ium)\/([0-9\.]+)(:?\s|$)/],["phantomjs",/PhantomJS\/([0-9\.]+)(:?\s|$)/],["crios",/CriOS\/([0-9\.]+)(:?\s|$)/],["firefox",/Firefox\/([0-9\.]+)(?:\s|$)/],["fxios",/FxiOS\/([0-9\.]+)/],["opera-mini",/Opera Mini.*Version\/([0-9\.]+)/],["opera",/Opera\/([0-9\.]+)(?:\s|$)/],["opera",/OPR\/([0-9\.]+)(:?\s|$)/],["pie",/^Microsoft Pocket Internet Explorer\/(\d+\.\d+)$/],["pie",/^Mozilla\/\d\.\d+\s\(compatible;\s(?:MSP?IE|MSInternet Explorer) (\d+\.\d+);.*Windows CE.*\)$/],["netfront",/^Mozilla\/\d\.\d+.*NetFront\/(\d.\d)/],["ie",/Trident\/7\.0.*rv\:([0-9\.]+).*\).*Gecko$/],["ie",/MSIE\s([0-9\.]+);.*Trident\/[4-7].0/],["ie",/MSIE\s(7\.0)/],["bb10",/BB10;\sTouch.*Version\/([0-9\.]+)/],["android",/Android\s([0-9\.]+)/],["ios",/Version\/([0-9\._]+).*Mobile.*Safari.*/],["safari",/Version\/([0-9\._]+).*Safari/],["facebook",/FB[AS]V\/([0-9\.]+)/],["instagram",/Instagram\s([0-9\.]+)/],["ios-webview",/AppleWebKit\/([0-9\.]+).*Mobile/],["ios-webview",/AppleWebKit\/([0-9\.]+).*Gecko\)$/],["curl",/^curl\/([0-9\.]+)$/],["searchbot",F2]],Ww=[["iOS",/iP(hone|od|ad)/],["Android OS",/Android/],["BlackBerry OS",/BlackBerry|BB10/],["Windows Mobile",/IEMobile/],["Amazon OS",/Kindle/],["Windows 3.11",/Win16/],["Windows 95",/(Windows 95)|(Win95)|(Windows_95)/],["Windows 98",/(Windows 98)|(Win98)/],["Windows 2000",/(Windows NT 5.0)|(Windows 2000)/],["Windows XP",/(Windows NT 5.1)|(Windows XP)/],["Windows Server 2003",/(Windows NT 5.2)/],["Windows Vista",/(Windows NT 6.0)/],["Windows 7",/(Windows NT 6.1)/],["Windows 8",/(Windows NT 6.2)/],["Windows 8.1",/(Windows NT 6.3)/],["Windows 10",/(Windows NT 10.0)/],["Windows ME",/Windows ME/],["Windows CE",/Windows CE|WinCE|Microsoft Pocket Internet Explorer/],["Open BSD",/OpenBSD/],["Sun OS",/SunOS/],["Chrome OS",/CrOS/],["Linux",/(Linux)|(X11)/],["Mac OS",/(Mac_PowerPC)|(Macintosh)/],["QNX",/QNX/],["BeOS",/BeOS/],["OS/2",/OS\/2/]];function Gw(r){return r?qw(r):typeof document>"u"&&typeof navigator<"u"&&navigator.product==="ReactNative"?new $2:typeof navigator<"u"?qw(navigator.userAgent):X2()}function G2(r){return r!==""&&q2.reduce(function(e,t){var n=t[0],o=t[1];if(e)return e;var i=o.exec(r);return!!i&&[n,i]},!1)}function qw(r){var e=G2(r);if(!e)return null;var t=e[0],n=e[1];if(t==="searchbot")return new V2;var o=n[1]&&n[1].split(".").join("_").split("_").slice(0,3);o?o.length<Fw&&(o=$w($w([],o,!0),Z2(Fw-o.length),!0)):o=[];var i=o.join("."),s=z2(r),a=W2.exec(r);return a&&a[1]?new H2(t,i,s,a[1]):new j2(t,i,s)}function z2(r){for(var e=0,t=Ww.length;e<t;e++){var n=Ww[e],o=n[0],i=n[1],s=i.exec(r);if(s)return o}return null}function X2(){var r=typeof process<"u"&&process.version;return r?new K2(process.version.slice(1)):null}function Z2(r){for(var e=[],t=0;t<r;t++)e.push("0");return e}var zw=Gw(),df=zw!=null&&zw.name==="firefox";async function Am(r){return r=r??{},typeof r=="function"&&(r=await r()),r.iceServers=r.iceServers??Ow.map(e=>({urls:[e]})),r}var Xw=(r=32)=>Pw+[...Array(r)].map(()=>lm.at(Math.floor(Math.random()*lm.length))).join("");var Sm=class extends nf{channel;incomingData;maxBufferedAmount;receivedFinAck;finAckTimeout;constructor(e){super({...e,maxMessageSize:(e.maxMessageSize??Es)-Dw}),this.channel=e.channel,this.channel.binaryType="arraybuffer",this.incomingData=Cs(),this.maxBufferedAmount=e.maxBufferedAmount??Nw,this.finAckTimeout=e.finAckTimeout??Rw,this.channel.onclose=()=>{this.log.trace("received datachannel close event"),this.onRemoteCloseWrite(),this.onTransportClosed()},this.channel.onerror=n=>{let o=n.error;this.log.trace("received datachannel error event - %e",o),this.abort(o)},this.channel.onmessage=async n=>{this.log("incoming message %d bytes",n.data.byteLength);let{data:o}=n;o===null||o.byteLength===0||this.incomingData.push(new Uint8Array(o,0,o.byteLength))},this.channel.bufferedAmountLowThreshold=0,this.channel.onbufferedamountlow=()=>{this.writableNeedsDrain&&this.safeDispatchEvent("drain")},Promise.resolve().then(async()=>{for await(let n of pc(this.incomingData))this.processIncomingProtobuf(n)}).catch(n=>{this.log.error("error processing incoming data channel messages - %e",n)});let t=()=>{this.channel.readyState==="open"&&(this.log.trace("stream closed, closing underlying datachannel"),this.channel.close())};this.addEventListener("close",t),this.channel.readyState!=="open"&&(this.log('channel ready state is "%s" and not "open", waiting for "open" event before sending data',this.channel.readyState),pt(this.channel,"open",{rejectionEvents:["close","error"]}).then(()=>{this.log('channel ready state is now "%s", dispatching drain',this.channel.readyState),this.safeDispatchEvent("drain")}).catch(n=>{this.abort(n.error??n)}))}sendNewStream(){}_sendMessage(e){if(this.channel.readyState!=="open")throw new Lr(`Invalid datachannel state - ${this.channel.readyState}`);if(this.log.trace('sending message, channel state "%s"',this.channel.readyState),df){this.channel.send(e.subarray());return}for(let t of e)this.channel.send(t)}sendData(e){return this.channel.readyState!=="open"?{sentBytes:0,canSendMore:!1}:(this._sendMessage(hc.single(Ct.encode({message:e.subarray()}))),{sentBytes:e.byteLength,canSendMore:this.channel.bufferedAmount<this.maxBufferedAmount})}sendReset(e){try{this.log.error("sending reset - %e",e),this._sendFlag(Ct.Flag.RESET),this.receivedFinAck?.reject(e)}catch(t){this.log.error("failed to send reset - %e",t)}}async sendCloseWrite(e){this._sendFlag(Ct.Flag.FIN),e?.signal?.throwIfAborted(),this.receivedFinAck=Promise.withResolvers();let t=e?.signal??AbortSignal.timeout(this.finAckTimeout),n=[pt(this.channel,"close",{signal:t}),pt(this.channel,"error",{signal:t})];await Promise.any([Qn(this.receivedFinAck.promise,t),...n]).finally(()=>{n.forEach(o=>o.cancel())})}async sendCloseRead(e){this._sendFlag(Ct.Flag.STOP_SENDING),e?.signal?.throwIfAborted()}processIncomingProtobuf(e){let t=Ct.decode(e);t.message!=null&&(this.readStatus==="readable"||this.readStatus==="paused")&&this.onData(new me(t.message)),t.flag!==void 0&&(this.log.trace('incoming flag %s, write status "%s", read status "%s"',t.flag,this.writeStatus,this.readStatus),t.flag===Ct.Flag.FIN&&(this._sendFlag(Ct.Flag.FIN_ACK),this.onRemoteCloseWrite()),t.flag===Ct.Flag.RESET&&(this.receivedFinAck?.reject(new Zi("The stream was reset")),this.onRemoteReset()),t.flag===Ct.Flag.STOP_SENDING&&this.onRemoteCloseRead(),t.flag===Ct.Flag.FIN_ACK&&this.receivedFinAck?.resolve())}_sendFlag(e){if(this.channel.readyState!=="open")return this.log.trace('not sending flag %s because channel is "%s" and not "open"',e.toString(),this.channel.readyState),!1;this.log.trace("sending flag %s",e.toString());let t=Ct.encode({flag:e}),n=hc.single(t);try{return this._sendMessage(n),!0}catch(o){this.log.error("could not send flag %s - %e",e.toString(),o)}return!1}sendPause(){}sendResume(){}};function dc(r){let{channel:e,direction:t,isHandshake:n}=r;return new Sm({...r,id:`${e.id}`,log:r.log.newScope(`${n===!0?"handshake":t}:${e.id}`),protocol:""})}var to=class{protocol;peerConnection;metrics;dataChannelOptions;earlyDataChannels;constructor(e){this.onEarlyDataChannel=this.onEarlyDataChannel.bind(this),this.peerConnection=e.peerConnection,this.metrics=e.metrics,this.protocol=e.protocol??fm,this.dataChannelOptions=e.dataChannelOptions??{},this.peerConnection.addEventListener("datachannel",this.onEarlyDataChannel),this.earlyDataChannels=[]}onEarlyDataChannel(e){this.earlyDataChannels.push(e.channel)}createStreamMuxer(e){return this.peerConnection.removeEventListener("datachannel",this.onEarlyDataChannel),new Em(e,{peerConnection:this.peerConnection,dataChannelOptions:this.dataChannelOptions,metrics:this.metrics,protocol:this.protocol,earlyDataChannels:this.earlyDataChannels})}},Em=class extends rf{peerConnection;dataChannelOptions;constructor(e,t){super(e,{...t,name:"muxer"}),this.peerConnection=t.peerConnection,this.protocol=t.protocol??fm,this.dataChannelOptions=t.dataChannelOptions??{},this.peerConnection.ondatachannel=({channel:n})=>{this.onDataChannel(n)},queueMicrotask(()=>{if(this.status!=="open"){t.earlyDataChannels.forEach(n=>{n.close()});return}t.earlyDataChannels.forEach(n=>{this.onDataChannel(n)})})}onDataChannel(e){if(this.log("incoming datachannel with channel id %d, protocol %s and status %s",e.id,e.protocol,e.readyState),e.label==="init"){this.log.trace("closing init channel %d",e.id),e.close();return}let t=dc({...this.streamOptions,...this.dataChannelOptions,channel:e,direction:"inbound",log:this.log});this.onRemoteStream(t)}async onCreateStream(e){let t=this.peerConnection.createDataChannel("",{});return this.log("open channel %d for protocol %s",t.id,e?.protocol),dc({...e,...this.dataChannelOptions,channel:t,direction:"outbound",log:this.log})}onData(){}};var _m=class extends tf{peerConnection;constructor(e){super(e),this.peerConnection=e.peerConnection;let t=e.peerConnection.connectionState;this.peerConnection.onconnectionstatechange=()=>{this.log.trace("peer connection state change %s initial state %s",this.peerConnection.connectionState,t),(this.peerConnection.connectionState==="disconnected"||this.peerConnection.connectionState==="failed"||this.peerConnection.connectionState==="closed")&&(this.onTransportClosed(),this.peerConnection.close())}}sendData(e){return{sentBytes:e.byteLength,canSendMore:!0}}async sendClose(e){this.peerConnection.close(),e?.signal?.throwIfAborted()}sendReset(){this.peerConnection.close()}sendPause(){}sendResume(){}},mc=r=>new _m(r);var mf=globalThis.RTCPeerConnection,yf=globalThis.RTCSessionDescription,Zw=globalThis.RTCIceCandidate;var Xt=class extends Event{type;detail;constructor(e,t){super(e),this.type=e,this.detail=t}};var ro=class extends Error{constructor(e){super(`WebRTC transport error: ${e}`),this.name="WebRTCTransportError"}},nr=class extends ro{constructor(e="SDP handshake failed"){super(e),this.name="SDPHandshakeFailedError"}};var gf=class extends ro{constructor(e,t){super(`Invalid fingerprint "${e}" within ${t}`),this.name="WebRTC/InvalidFingerprintError"}};var bf=class extends ro{constructor(e){super(`A method (${e}) was called though it has been intentionally left unimplemented.`),this.name="WebRTC/UnimplementedError"}},wf=class extends ro{constructor(e){super(`unsupported hash algorithm code: ${e} please see the codes at https://github.com/multiformats/multicodec/blob/master/table.csv `),this.name="WebRTC/UnsupportedHashAlgorithmError"}};var Mt;(function(r){let e;(function(o){o.SDP_OFFER="SDP_OFFER",o.SDP_ANSWER="SDP_ANSWER",o.ICE_CANDIDATE="ICE_CANDIDATE"})(e=r.Type||(r.Type={}));let t;(function(o){o[o.SDP_OFFER=0]="SDP_OFFER",o[o.SDP_ANSWER=1]="SDP_ANSWER",o[o.ICE_CANDIDATE=2]="ICE_CANDIDATE"})(t||(t={})),(function(o){o.codec=()=>Wo(t)})(e=r.Type||(r.Type={}));let n;r.codec=()=>(n==null&&(n=Sr((o,i,s={})=>{s.lengthDelimited!==!1&&i.fork(),o.type!=null&&(i.uint32(8),r.Type.codec().encode(o.type,i)),o.data!=null&&(i.uint32(18),i.string(o.data)),s.lengthDelimited!==!1&&i.ldelim()},(o,i,s={})=>{let a={},c=i==null?o.len:o.pos+i;for(;o.pos<c;){let f=o.uint32();switch(f>>>3){case 1:{a.type=r.Type.codec().decode(o);break}case 2:{a.data=o.string();break}default:{o.skipType(f&7);break}}}return a})),n),r.encode=o=>Ar(o,r.codec()),r.decode=(o,i)=>vr(o,r.codec(),i)})(Mt||(Mt={}));var xf=async(r,e,t)=>{try{let n=Promise.withResolvers();for(Y2(r,n);;){let o=await Promise.race([n.promise,e.read({signal:t.signal})]);if(o==null){t.signal?.throwIfAborted();break}if(o.type!==Mt.Type.ICE_CANDIDATE)throw new al("ICE candidate message expected");let i=JSON.parse(o.data??"null");if(i===""||i===null){t.onProgress?.(new Xt("webrtc:end-of-ice-candidates")),t.log.trace("end-of-candidates received");continue}let s=new Zw(i);t.log.trace("%s received new ICE candidate %o",t.direction,i);try{t.onProgress?.(new Xt("webrtc:add-ice-candidate",s.candidate)),await r.addIceCandidate(s)}catch(a){t.log.error("%s bad candidate received %o - %e",t.direction,i,a)}}}catch(n){if(t.log.error("%s error parsing ICE candidate - %e",t.direction,n),t.signal?.aborted===!0&&r.connectionState!=="connected")throw n}};function Y2(r,e){if(r.connectionState==="connected"){e.resolve();return}r.onconnectionstatechange=t=>{switch(r.connectionState){case"connected":e.resolve();break;case"failed":case"disconnected":case"closed":e.reject(new rl(`RTCPeerConnection connection state became "${r.connectionState}"`));break;default:break}}}function vf(r){let e;for(let t of r.getComponents())t.name==="p2p"&&(e=bs(t.value??""));if(e==null)throw new ol("Remote peerId must be present in multiaddr");return e}async function Yw({rtcConfiguration:r,dataChannel:e,signal:t,metrics:n,multiaddr:o,connectionManager:i,transportManager:s,log:a,logger:c,onProgress:f}){let{circuitAddress:p,targetPeer:h}=Jw(o);n?.dialerEvents.increment({open:!0}),a.trace("dialing circuit address: %a",p);let y=i.getConnections(h),b;y.length===0?(f?.(new Xt("webrtc:dial-relay")),b=await s.dial(p,{signal:t,onProgress:f})):(f?.(new Xt("webrtc:reuse-relay-connection")),b=y[0]),f?.(new Xt("webrtc:open-signaling-stream"));let g=await b.newStream(uc,{signal:t,runOnLimitedConnection:!0}),C=af(g).pb(Mt),m=new mf(r);m.addEventListener("connectionstatechange",()=>{switch(m.connectionState){case"closed":m.close();break;default:break}});let S=new to({peerConnection:m,dataChannelOptions:e});try{let N=m.createDataChannel("init");m.onicecandidate=({candidate:q})=>{if(m.connectionState==="connected"){a.trace("ignore new ice candidate as peer connection is already connected");return}if(q==null||q?.candidate===""){a.trace("initiator detected end of ICE candidates");return}let re=JSON.stringify(q?.toJSON()??null);a.trace("initiator sending ICE candidate %o",q),C.write({type:Mt.Type.ICE_CANDIDATE,data:re},{signal:t}).catch(R=>{a.error("error sending ICE candidate - %e",R)})},m.onicecandidateerror=q=>{a.error("initiator ICE candidate error",q)};let I=await m.createOffer().catch(q=>{throw a.error("could not execute createOffer - %e",q),new nr("Failed to set createOffer")});a.trace("initiator send SDP offer %s",I.sdp),f?.(new Xt("webrtc:send-sdp-offer")),await C.write({type:Mt.Type.SDP_OFFER,data:I.sdp},{signal:t}),await m.setLocalDescription(I).catch(q=>{throw a.error("could not execute setLocalDescription - %e",q),new nr("Failed to set localDescription")}),f?.(new Xt("webrtc:read-sdp-answer")),a.trace("initiator read SDP answer");let K=await C.read({signal:t});if(K.type!==Mt.Type.SDP_ANSWER)throw new nr("Remote should send an SDP answer");a.trace("initiator received SDP answer %s",K.data);let Z=new yf({type:"answer",sdp:K.data});return await m.setRemoteDescription(Z).catch(q=>{throw a.error("could not execute setRemoteDescription - %e",q),new nr("Failed to set remoteDescription")}),a.trace("initiator read candidates until connected"),f?.(new Xt("webrtc:read-ice-candidates")),await xf(m,C,{direction:"initiator",signal:t,log:a,onProgress:f}),a.trace("initiator connected"),N.readyState!=="open"&&(a.trace("wait for init channel to open"),await pt(N,"open",{signal:t})),a.trace("closing init channel"),N.close(),a.trace("waiting for init channel to close"),await pt(N,"close",{signal:t}),f?.(new Xt("webrtc:close-signaling-stream")),a.trace("closing signaling channel"),await g.close({signal:t}),a.trace("initiator connected to remote address %s",o),{remoteAddress:o,peerConnection:m,muxerFactory:S}}catch(N){throw a.error("outgoing signaling error - %e",N),m.close(),g.abort(N),N}finally{m.onicecandidate=null,m.onicecandidateerror=null}}var Qw=Ne(Tw.matchers[0],Pe(290)),Af=class r extends er{transportManager;shutdownController;events;constructor(e,t){super(),this.transportManager=e.transportManager,this.events=e.events,this.shutdownController=t.shutdownController,this.onTransportListening=this.onTransportListening.bind(this)}async listen(){this.events.addEventListener("transport:listening",this.onTransportListening)}onTransportListening(e){e.detail.getAddrs().filter(n=>Qw.exactMatch(n)).map(n=>n.encapsulate("/webrtc")).length>0&&this.safeDispatchEvent("listening")}getAddrs(){return this.transportManager.getListeners().filter(e=>!(e instanceof r)).map(e=>e.getAddrs().filter(t=>Qw.exactMatch(t)).map(t=>t.encapsulate("/webrtc"))).flat()}updateAnnounceAddrs(){}async close(){this.events.removeEventListener("transport:listening",this.onTransportListening),this.shutdownController.abort(),queueMicrotask(()=>{this.safeDispatchEvent("close")})}};async function ex(r,e,{peerConnection:t,signal:n,log:o}){o.trace("new inbound signaling stream");let i=af(r).pb(Mt);try{t.onicecandidate=({candidate:h})=>{if(t.connectionState==="connected"){o.trace("ignore new ice candidate as peer connection is already connected");return}if(h==null||h?.candidate===""){o.trace("recipient detected end of ICE candidates");return}let y=JSON.stringify(h?.toJSON()??null);o.trace("recipient sending ICE candidate %s",y),i.write({type:Mt.Type.ICE_CANDIDATE,data:y},{signal:n}).catch(b=>{o.error("error sending ICE candidate - %e",b)})},o.trace("recipient read SDP offer");let c=await i.read({signal:n});if(c.type!==Mt.Type.SDP_OFFER)throw new nr(`expected message type SDP_OFFER, received: ${c.type??"undefined"} `);o.trace("recipient received SDP offer %s",c.data);let f=new yf({type:"offer",sdp:c.data});await t.setRemoteDescription(f).catch(h=>{throw o.error("could not execute setRemoteDescription - %e",h),new nr("Failed to set remoteDescription")});let p=await t.createAnswer().catch(h=>{throw o.error("could not execute createAnswer - %e",h),new nr("Failed to create answer")});o.trace("recipient send SDP answer %s",p.sdp),await i.write({type:Mt.Type.SDP_ANSWER,data:p.sdp},{signal:n}),await t.setLocalDescription(p).catch(h=>{throw o.error("could not execute setLocalDescription - %e",h),new nr("Failed to set localDescription")}),o.trace("recipient read candidates until connected"),await xf(t,i,{direction:"recipient",signal:n,log:o})}catch(c){if(t.connectionState!=="connected")throw o.error("error while handling signaling stream from peer %a - %e",e.remoteAddr,c),t.close(),c;o("error while handling signaling stream from peer %a, ignoring as the RTCPeerConnection is already connected",e.remoteAddr,c)}let s=vf(e.remoteAddr),a=Ss(`/webrtc/p2p/${s}`);return o.trace("recipient connected to remote address %s",a),{remoteAddress:a,remotePeer:s}}var Sf=class{components;init;log;_started=!1;metrics;shutdownController;constructor(e,t={}){this.components=e,this.init=t,this.log=e.logger.forComponent("libp2p:webrtc"),this.shutdownController=new AbortController,this.shutdownController.signal,e.metrics!=null&&(this.metrics={dialerEvents:e.metrics.registerCounterGroup("libp2p_webrtc_dialer_events_total",{label:"event",help:"Total count of WebRTC dialer events by type"}),listenerEvents:e.metrics.registerCounterGroup("libp2p_webrtc_listener_events_total",{label:"event",help:"Total count of WebRTC listener events by type"})})}[hl]=!0;[Symbol.toStringTag]="@libp2p/webrtc";[Ji]=["@libp2p/transport"];[Yg]=["@libp2p/identify","@libp2p/circuit-relay-v2-transport"];isStarted(){return this._started}async start(){await this.components.registrar.handle(uc,(e,t)=>{let n=this.components.upgrader.createInboundAbortSignal(this.shutdownController.signal);this._onProtocol(e,t,n).catch(o=>{this.log.error("failed to handle incoming connect from %p - %e",t.remotePeer,o)}).finally(()=>{n.clear()})},{runOnLimitedConnection:!0}),this._started=!0}async stop(){await this.components.registrar.unhandle(uc),this._started=!1}createListener(e){return new Af(this.components,{shutdownController:this.shutdownController})}listenFilter(e){return e.filter(kw.exactMatch)}dialFilter(e){return this.listenFilter(e)}async dial(e,t){this.log.trace("dialing address: %a",e);let{remoteAddress:n,peerConnection:o,muxerFactory:i}=await Yw({rtcConfiguration:await Am(this.init.rtcConfiguration),dataChannel:this.init.dataChannel,multiaddr:e,dataChannelOptions:this.init.dataChannel,signal:t.signal,connectionManager:this.components.connectionManager,transportManager:this.components.transportManager,log:this.log,logger:this.components.logger,onProgress:t.onProgress}),s=mc({peerConnection:o,remoteAddr:n,metrics:this.metrics?.dialerEvents,direction:"outbound",log:this.components.logger.forComponent("libp2p:webrtc:connection")}),a=await t.upgrader.upgradeOutbound(s,{skipProtection:!0,skipEncryption:!0,remotePeer:vf(e),muxerFactory:i,onProgress:t.onProgress,signal:t.signal});return this._closeOnShutdown(o,s),a}async _onProtocol(e,t,n){let o=new mf(await Am(this.init.rtcConfiguration));o.addEventListener("connectionstatechange",()=>{switch(o.connectionState){case"closed":o.close();break;default:break}});let i=new to({peerConnection:o,dataChannelOptions:this.init.dataChannel});try{let{remoteAddress:s,remotePeer:a}=await ex(e,t,{peerConnection:o,signal:n,log:this.log});await e.close({signal:n});let c=mc({peerConnection:o,remoteAddr:s,metrics:this.metrics?.listenerEvents,direction:"inbound",log:this.components.logger.forComponent("libp2p:webrtc:connection")});await this.components.upgrader.upgradeInbound(c,{skipEncryption:!0,skipProtection:!0,remotePeer:a,muxerFactory:i,signal:n}),this._closeOnShutdown(o,c)}catch(s){throw this.log.error("incoming signaling error - %e",s),o.close(),e.abort(s),s}}_closeOnShutdown(e,t){let n=()=>{t.close().catch(o=>{this.log.error("could not close WebRTCMultiaddrConnection - %e",o)})};this.shutdownController.signal.addEventListener("abort",n),e.addEventListener("close",()=>{this.shutdownController.signal.removeEventListener("abort",n)})}};function Jw(r){let e=r.getComponents().filter(({name:n})=>n==="p2p").map(({value:n})=>n).pop();if(e==null)throw new xe("Destination peer id was missing");return{circuitAddress:Ss(r.getComponents().filter(({name:n})=>n!=="webrtc")),targetPeer:bs(e)}}var oz=Rr(rx());var Wr={};At(Wr,{Any:()=>$r,BaseBlock:()=>Je,BaseStringBlock:()=>wc,BitString:()=>Br,BmpString:()=>ri,Boolean:()=>Qo,CharacterString:()=>fi,Choice:()=>ks,Constructed:()=>Qe,DATE:()=>_c,DateTime:()=>Bc,Duration:()=>Ic,EndOfContent:()=>xc,Enumerated:()=>ei,GeneralString:()=>li,GeneralizedTime:()=>hi,GraphicString:()=>ui,HexBlock:()=>Fr,IA5String:()=>ci,Integer:()=>vn,Null:()=>_r,NumericString:()=>oi,ObjectIdentifier:()=>ti,OctetString:()=>Cr,Primitive:()=>xn,PrintableString:()=>ii,RawData:()=>Tm,RelativeObjectIdentifier:()=>Ec,Repeated:()=>pi,Sequence:()=>Bt,Set:()=>Pt,TIME:()=>Tc,TeletexString:()=>si,TimeOfDay:()=>Cc,UTCTime:()=>io,UniversalString:()=>ni,Utf8String:()=>ir,ValueBlock:()=>dt,VideotexString:()=>ai,ViewWriter:()=>Ts,VisibleString:()=>oo,compareSchema:()=>bn,fromBER:()=>Sn,verifySchema:()=>bC});var ye=Rr(gn());function Jo(r,e){let t=0;if(r.length===1)return r[0];for(let n=r.length-1;n>=0;n--)t+=r[r.length-1-n]*Math.pow(2,e*n);return t}function no(r,e,t=-1){let n=t,o=r,i=0,s=Math.pow(2,e);for(let a=1;a<8;a++){if(r<s){let c;if(n<0)c=new ArrayBuffer(a),i=a;else{if(n<a)return new ArrayBuffer(0);c=new ArrayBuffer(n),i=n}let f=new Uint8Array(c);for(let p=a-1;p>=0;p--){let h=Math.pow(2,p*e);f[i-p-1]=Math.floor(o/h),o-=f[i-p-1]*h}return c}s*=Math.pow(2,e)}return new ArrayBuffer(0)}function Cf(...r){let e=0,t=0;for(let i of r)e+=i.length;let n=new ArrayBuffer(e),o=new Uint8Array(n);for(let i of r)o.set(i,t),t+=i.length;return o}function Bm(){let r=new Uint8Array(this.valueHex);if(this.valueHex.byteLength>=2){let a=r[0]===255&&r[1]&128,c=r[0]===0&&(r[1]&128)===0;(a||c)&&this.warnings.push("Needlessly long format")}let e=new ArrayBuffer(this.valueHex.byteLength),t=new Uint8Array(e);for(let a=0;a<this.valueHex.byteLength;a++)t[a]=0;t[0]=r[0]&128;let n=Jo(t,8),o=new ArrayBuffer(this.valueHex.byteLength),i=new Uint8Array(o);for(let a=0;a<this.valueHex.byteLength;a++)i[a]=r[a];return i[0]&=127,Jo(i,8)-n}function nx(r){let e=r<0?r*-1:r,t=128;for(let n=1;n<8;n++){if(e<=t){if(r<0){let s=t-e,a=no(s,8,n),c=new Uint8Array(a);return c[0]|=128,a}let o=no(e,8,n),i=new Uint8Array(o);if(i[0]&128){let s=o.slice(0),a=new Uint8Array(s);o=new ArrayBuffer(o.byteLength+1),i=new Uint8Array(o);for(let c=0;c<s.byteLength;c++)i[c+1]=a[c];i[0]=0}return o}t*=Math.pow(2,8)}return new ArrayBuffer(0)}function ox(r,e){if(r.byteLength!==e.byteLength)return!1;let t=new Uint8Array(r),n=new Uint8Array(e);for(let o=0;o<t.length;o++)if(t[o]!==n[o])return!1;return!0}function jt(r,e){let t=r.toString(10);if(e<t.length)return"";let n=e-t.length,o=new Array(n);for(let s=0;s<n;s++)o[s]="0";return o.join("").concat(t)}var yN=Math.log(2);function Bf(){if(typeof BigInt>"u")throw new Error("BigInt is not defined. Your environment doesn't implement BigInt.")}function km(r){let e=0,t=0;for(let o=0;o<r.length;o++){let i=r[o];e+=i.byteLength}let n=new Uint8Array(e);for(let o=0;o<r.length;o++){let i=r[o];n.set(new Uint8Array(i),t),t+=i.byteLength}return n.buffer}function An(r,e,t,n){return e instanceof Uint8Array?e.byteLength?t<0?(r.error="Wrong parameter: inputOffset less than zero",!1):n<0?(r.error="Wrong parameter: inputLength less than zero",!1):e.byteLength-t-n<0?(r.error="End of input reached before message was fully decoded (inconsistent offset and length values)",!1):!0:(r.error="Wrong parameter: inputBuffer has zero length",!1):(r.error="Wrong parameter: inputBuffer must be 'Uint8Array'",!1)}var Ts=class{constructor(){this.items=[]}write(e){this.items.push(e)}final(){return km(this.items)}},yc=[new Uint8Array([1])],ix="0123456789",Im="name",sx="valueHexView",sC="isHexOnly",aC="idBlock",cC="tagClass",uC="tagNumber",lC="isConstructed",fC="fromBER",hC="toBER",pC="local",Kt="",Ir=new ArrayBuffer(0),Vf=new Uint8Array(0),bc="EndOfContent",cx="OCTET STRING",ux="BIT STRING";function Fr(r){var e;return e=class extends r{get valueHex(){return this.valueHexView.slice().buffer}set valueHex(n){this.valueHexView=new Uint8Array(n)}constructor(...n){var o;super(...n);let i=n[0]||{};this.isHexOnly=(o=i.isHexOnly)!==null&&o!==void 0?o:!1,this.valueHexView=i.valueHex?ye.BufferSourceConverter.toUint8Array(i.valueHex):Vf}fromBER(n,o,i){let s=n instanceof ArrayBuffer?new Uint8Array(n):n;if(!An(this,s,o,i))return-1;let a=o+i;return this.valueHexView=s.subarray(o,a),this.valueHexView.length?(this.blockLength=i,a):(this.warnings.push("Zero buffer length"),o)}toBER(n=!1){return this.isHexOnly?n?new ArrayBuffer(this.valueHexView.byteLength):this.valueHexView.byteLength===this.valueHexView.buffer.byteLength?this.valueHexView.buffer:this.valueHexView.slice().buffer:(this.error="Flag 'isHexOnly' is not set, abort",Ir)}toJSON(){return{...super.toJSON(),isHexOnly:this.isHexOnly,valueHex:ye.Convert.ToHex(this.valueHexView)}}},e.NAME="hexBlock",e}var wn=class{static blockName(){return this.NAME}get valueBeforeDecode(){return this.valueBeforeDecodeView.slice().buffer}set valueBeforeDecode(e){this.valueBeforeDecodeView=new Uint8Array(e)}constructor({blockLength:e=0,error:t=Kt,warnings:n=[],valueBeforeDecode:o=Vf}={}){this.blockLength=e,this.error=t,this.warnings=n,this.valueBeforeDecodeView=ye.BufferSourceConverter.toUint8Array(o)}toJSON(){return{blockName:this.constructor.NAME,blockLength:this.blockLength,error:this.error,warnings:this.warnings,valueBeforeDecode:ye.Convert.ToHex(this.valueBeforeDecodeView)}}};wn.NAME="baseBlock";var dt=class extends wn{fromBER(e,t,n){throw TypeError("User need to make a specific function in a class which extends 'ValueBlock'")}toBER(e,t){throw TypeError("User need to make a specific function in a class which extends 'ValueBlock'")}};dt.NAME="valueBlock";var If=class extends Fr(wn){constructor({idBlock:e={}}={}){var t,n,o,i;super(),e?(this.isHexOnly=(t=e.isHexOnly)!==null&&t!==void 0?t:!1,this.valueHexView=e.valueHex?ye.BufferSourceConverter.toUint8Array(e.valueHex):Vf,this.tagClass=(n=e.tagClass)!==null&&n!==void 0?n:-1,this.tagNumber=(o=e.tagNumber)!==null&&o!==void 0?o:-1,this.isConstructed=(i=e.isConstructed)!==null&&i!==void 0?i:!1):(this.tagClass=-1,this.tagNumber=-1,this.isConstructed=!1)}toBER(e=!1){let t=0;switch(this.tagClass){case 1:t|=0;break;case 2:t|=64;break;case 3:t|=128;break;case 4:t|=192;break;default:return this.error="Unknown tag class",Ir}if(this.isConstructed&&(t|=32),this.tagNumber<31&&!this.isHexOnly){let o=new Uint8Array(1);if(!e){let i=this.tagNumber;i&=31,t|=i,o[0]=t}return o.buffer}if(!this.isHexOnly){let o=no(this.tagNumber,7),i=new Uint8Array(o),s=o.byteLength,a=new Uint8Array(s+1);if(a[0]=t|31,!e){for(let c=0;c<s-1;c++)a[c+1]=i[c]|128;a[s]=i[s-1]}return a.buffer}let n=new Uint8Array(this.valueHexView.byteLength+1);if(n[0]=t|31,!e){let o=this.valueHexView;for(let i=0;i<o.length-1;i++)n[i+1]=o[i]|128;n[this.valueHexView.byteLength]=o[o.length-1]}return n.buffer}fromBER(e,t,n){let o=ye.BufferSourceConverter.toUint8Array(e);if(!An(this,o,t,n))return-1;let i=o.subarray(t,t+n);if(i.length===0)return this.error="Zero buffer length",-1;switch(i[0]&192){case 0:this.tagClass=1;break;case 64:this.tagClass=2;break;case 128:this.tagClass=3;break;case 192:this.tagClass=4;break;default:return this.error="Unknown tag class",-1}this.isConstructed=(i[0]&32)===32,this.isHexOnly=!1;let a=i[0]&31;if(a!==31)this.tagNumber=a,this.blockLength=1;else{let c=1,f=this.valueHexView=new Uint8Array(255),p=255;for(;i[c]&128;){if(f[c-1]=i[c]&127,c++,c>=i.length)return this.error="End of input reached before message was fully decoded",-1;if(c===p){p+=255;let y=new Uint8Array(p);for(let b=0;b<f.length;b++)y[b]=f[b];f=this.valueHexView=new Uint8Array(p)}}this.blockLength=c+1,f[c-1]=i[c]&127;let h=new Uint8Array(c);for(let y=0;y<c;y++)h[y]=f[y];f=this.valueHexView=new Uint8Array(c),f.set(h),this.blockLength<=9?this.tagNumber=Jo(f,7):(this.isHexOnly=!0,this.warnings.push("Tag too long, represented as hex-coded"))}if(this.tagClass===1&&this.isConstructed)switch(this.tagNumber){case 1:case 2:case 5:case 6:case 9:case 13:case 14:case 23:case 24:case 31:case 32:case 33:case 34:return this.error="Constructed encoding used for primitive type",-1}return t+this.blockLength}toJSON(){return{...super.toJSON(),tagClass:this.tagClass,tagNumber:this.tagNumber,isConstructed:this.isConstructed}}};If.NAME="identificationBlock";var Tf=class extends wn{constructor({lenBlock:e={}}={}){var t,n,o;super(),this.isIndefiniteForm=(t=e.isIndefiniteForm)!==null&&t!==void 0?t:!1,this.longFormUsed=(n=e.longFormUsed)!==null&&n!==void 0?n:!1,this.length=(o=e.length)!==null&&o!==void 0?o:0}fromBER(e,t,n){let o=ye.BufferSourceConverter.toUint8Array(e);if(!An(this,o,t,n))return-1;let i=o.subarray(t,t+n);if(i.length===0)return this.error="Zero buffer length",-1;if(i[0]===255)return this.error="Length block 0xFF is reserved by standard",-1;if(this.isIndefiniteForm=i[0]===128,this.isIndefiniteForm)return this.blockLength=1,t+this.blockLength;if(this.longFormUsed=!!(i[0]&128),this.longFormUsed===!1)return this.length=i[0],this.blockLength=1,t+this.blockLength;let s=i[0]&127;if(s>8)return this.error="Too big integer",-1;if(s+1>i.length)return this.error="End of input reached before message was fully decoded",-1;let a=t+1,c=o.subarray(a,a+s);return c[s-1]===0&&this.warnings.push("Needlessly long encoded length"),this.length=Jo(c,8),this.longFormUsed&&this.length<=127&&this.warnings.push("Unnecessary usage of long length form"),this.blockLength=s+1,t+this.blockLength}toBER(e=!1){let t,n;if(this.length>127&&(this.longFormUsed=!0),this.isIndefiniteForm)return t=new ArrayBuffer(1),e===!1&&(n=new Uint8Array(t),n[0]=128),t;if(this.longFormUsed){let o=no(this.length,8);if(o.byteLength>127)return this.error="Too big length",Ir;if(t=new ArrayBuffer(o.byteLength+1),e)return t;let i=new Uint8Array(o);n=new Uint8Array(t),n[0]=o.byteLength|128;for(let s=0;s<o.byteLength;s++)n[s+1]=i[s];return t}return t=new ArrayBuffer(1),e===!1&&(n=new Uint8Array(t),n[0]=this.length),t}toJSON(){return{...super.toJSON(),isIndefiniteForm:this.isIndefiniteForm,longFormUsed:this.longFormUsed,length:this.length}}};Tf.NAME="lengthBlock";var X={},Je=class extends wn{constructor({name:e=Kt,optional:t=!1,primitiveSchema:n,...o}={},i){super(o),this.name=e,this.optional=t,n&&(this.primitiveSchema=n),this.idBlock=new If(o),this.lenBlock=new Tf(o),this.valueBlock=i?new i(o):new dt(o)}fromBER(e,t,n){let o=this.valueBlock.fromBER(e,t,this.lenBlock.isIndefiniteForm?n:this.lenBlock.length);return o===-1?(this.error=this.valueBlock.error,o):(this.idBlock.error.length||(this.blockLength+=this.idBlock.blockLength),this.lenBlock.error.length||(this.blockLength+=this.lenBlock.blockLength),this.valueBlock.error.length||(this.blockLength+=this.valueBlock.blockLength),o)}toBER(e,t){let n=t||new Ts;t||lx(this);let o=this.idBlock.toBER(e);if(n.write(o),this.lenBlock.isIndefiniteForm)n.write(new Uint8Array([128]).buffer),this.valueBlock.toBER(e,n),n.write(new ArrayBuffer(2));else{let i=this.valueBlock.toBER(e);this.lenBlock.length=i.byteLength;let s=this.lenBlock.toBER(e);n.write(s),n.write(i)}return t?Ir:n.final()}toJSON(){let e={...super.toJSON(),idBlock:this.idBlock.toJSON(),lenBlock:this.lenBlock.toJSON(),valueBlock:this.valueBlock.toJSON(),name:this.name,optional:this.optional};return this.primitiveSchema&&(e.primitiveSchema=this.primitiveSchema.toJSON()),e}toString(e="ascii"){return e==="ascii"?this.onAsciiEncoding():ye.Convert.ToHex(this.toBER())}onAsciiEncoding(){let e=this.constructor.NAME,t=ye.Convert.ToHex(this.valueBlock.valueBeforeDecodeView);return`${e} : ${t}`}isEqual(e){if(this===e)return!0;if(!(e instanceof this.constructor))return!1;let t=this.toBER(),n=e.toBER();return ox(t,n)}};Je.NAME="BaseBlock";function lx(r){var e;if(r instanceof X.Constructed)for(let t of r.valueBlock.value)lx(t)&&(r.lenBlock.isIndefiniteForm=!0);return!!(!((e=r.lenBlock)===null||e===void 0)&&e.isIndefiniteForm)}var wc=class extends Je{getValue(){return this.valueBlock.value}setValue(e){this.valueBlock.value=e}constructor({value:e=Kt,...t}={},n){super(t,n),e&&this.fromString(e)}fromBER(e,t,n){let o=this.valueBlock.fromBER(e,t,this.lenBlock.isIndefiniteForm?n:this.lenBlock.length);return o===-1?(this.error=this.valueBlock.error,o):(this.fromBuffer(this.valueBlock.valueHexView),this.idBlock.error.length||(this.blockLength+=this.idBlock.blockLength),this.lenBlock.error.length||(this.blockLength+=this.lenBlock.blockLength),this.valueBlock.error.length||(this.blockLength+=this.valueBlock.blockLength),o)}onAsciiEncoding(){return`${this.constructor.NAME} : '${this.valueBlock.value}'`}};wc.NAME="BaseStringBlock";var kf=class extends Fr(dt){constructor({isHexOnly:e=!0,...t}={}){super(t),this.isHexOnly=e}};kf.NAME="PrimitiveValueBlock";var fx,xn=class extends Je{constructor(e={}){super(e,kf),this.idBlock.isConstructed=!1}};fx=xn;X.Primitive=fx;xn.NAME="PRIMITIVE";function dC(r,e){if(r instanceof e)return r;let t=new e;return t.idBlock=r.idBlock,t.lenBlock=r.lenBlock,t.warnings=r.warnings,t.valueBeforeDecodeView=r.valueBeforeDecodeView,t}function Os(r,e=0,t=r.length){let n=e,o=new Je({},dt),i=new wn;if(!An(i,r,e,t))return o.error=i.error,{offset:-1,result:o};if(!r.subarray(e,e+t).length)return o.error="Zero buffer length",{offset:-1,result:o};let a=o.idBlock.fromBER(r,e,t);if(o.idBlock.warnings.length&&o.warnings.concat(o.idBlock.warnings),a===-1)return o.error=o.idBlock.error,{offset:-1,result:o};if(e=a,t-=o.idBlock.blockLength,a=o.lenBlock.fromBER(r,e,t),o.lenBlock.warnings.length&&o.warnings.concat(o.lenBlock.warnings),a===-1)return o.error=o.lenBlock.error,{offset:-1,result:o};if(e=a,t-=o.lenBlock.blockLength,!o.idBlock.isConstructed&&o.lenBlock.isIndefiniteForm)return o.error="Indefinite length form used for primitive encoding form",{offset:-1,result:o};let c=Je;switch(o.idBlock.tagClass){case 1:if(o.idBlock.tagNumber>=37&&o.idBlock.isHexOnly===!1)return o.error="UNIVERSAL 37 and upper tags are reserved by ASN.1 standard",{offset:-1,result:o};switch(o.idBlock.tagNumber){case 0:if(o.idBlock.isConstructed&&o.lenBlock.length>0)return o.error="Type [UNIVERSAL 0] is reserved",{offset:-1,result:o};c=X.EndOfContent;break;case 1:c=X.Boolean;break;case 2:c=X.Integer;break;case 3:c=X.BitString;break;case 4:c=X.OctetString;break;case 5:c=X.Null;break;case 6:c=X.ObjectIdentifier;break;case 10:c=X.Enumerated;break;case 12:c=X.Utf8String;break;case 13:c=X.RelativeObjectIdentifier;break;case 14:c=X.TIME;break;case 15:return o.error="[UNIVERSAL 15] is reserved by ASN.1 standard",{offset:-1,result:o};case 16:c=X.Sequence;break;case 17:c=X.Set;break;case 18:c=X.NumericString;break;case 19:c=X.PrintableString;break;case 20:c=X.TeletexString;break;case 21:c=X.VideotexString;break;case 22:c=X.IA5String;break;case 23:c=X.UTCTime;break;case 24:c=X.GeneralizedTime;break;case 25:c=X.GraphicString;break;case 26:c=X.VisibleString;break;case 27:c=X.GeneralString;break;case 28:c=X.UniversalString;break;case 29:c=X.CharacterString;break;case 30:c=X.BmpString;break;case 31:c=X.DATE;break;case 32:c=X.TimeOfDay;break;case 33:c=X.DateTime;break;case 34:c=X.Duration;break;default:{let f=o.idBlock.isConstructed?new X.Constructed:new X.Primitive;f.idBlock=o.idBlock,f.lenBlock=o.lenBlock,f.warnings=o.warnings,o=f}}break;case 2:case 3:case 4:default:c=o.idBlock.isConstructed?X.Constructed:X.Primitive}return o=dC(o,c),a=o.fromBER(r,e,o.lenBlock.isIndefiniteForm?t:o.lenBlock.length),o.valueBeforeDecodeView=r.subarray(n,n+o.blockLength),{offset:a,result:o}}function Sn(r){if(!r.byteLength){let e=new Je({},dt);return e.error="Input buffer has zero length",{offset:-1,result:e}}return Os(ye.BufferSourceConverter.toUint8Array(r).slice(),0,r.byteLength)}function mC(r,e){return r?1:e}var Vr=class extends dt{constructor({value:e=[],isIndefiniteForm:t=!1,...n}={}){super(n),this.value=e,this.isIndefiniteForm=t}fromBER(e,t,n){let o=ye.BufferSourceConverter.toUint8Array(e);if(!An(this,o,t,n))return-1;if(this.valueBeforeDecodeView=o.subarray(t,t+n),this.valueBeforeDecodeView.length===0)return this.warnings.push("Zero buffer length"),t;let i=t;for(;mC(this.isIndefiniteForm,n)>0;){let s=Os(o,i,n);if(s.offset===-1)return this.error=s.result.error,this.warnings.concat(s.result.warnings),-1;if(i=s.offset,this.blockLength+=s.result.blockLength,n-=s.result.blockLength,this.value.push(s.result),this.isIndefiniteForm&&s.result.constructor.NAME===bc)break}return this.isIndefiniteForm&&(this.value[this.value.length-1].constructor.NAME===bc?this.value.pop():this.warnings.push("No EndOfContent block encoded")),i}toBER(e,t){let n=t||new Ts;for(let o=0;o<this.value.length;o++)this.value[o].toBER(e,n);return t?Ir:n.final()}toJSON(){let e={...super.toJSON(),isIndefiniteForm:this.isIndefiniteForm,value:[]};for(let t of this.value)e.value.push(t.toJSON());return e}};Vr.NAME="ConstructedValueBlock";var hx,Qe=class extends Je{constructor(e={}){super(e,Vr),this.idBlock.isConstructed=!0}fromBER(e,t,n){this.valueBlock.isIndefiniteForm=this.lenBlock.isIndefiniteForm;let o=this.valueBlock.fromBER(e,t,this.lenBlock.isIndefiniteForm?n:this.lenBlock.length);return o===-1?(this.error=this.valueBlock.error,o):(this.idBlock.error.length||(this.blockLength+=this.idBlock.blockLength),this.lenBlock.error.length||(this.blockLength+=this.lenBlock.blockLength),this.valueBlock.error.length||(this.blockLength+=this.valueBlock.blockLength),o)}onAsciiEncoding(){let e=[];for(let n of this.valueBlock.value)e.push(n.toString("ascii").split(`
`).map(o=>`  ${o}`).join(`
`));let t=this.idBlock.tagClass===3?`[${this.idBlock.tagNumber}]`:this.constructor.NAME;return e.length?`${t} :
${e.join(`
`)}`:`${t} :`}};hx=Qe;X.Constructed=hx;Qe.NAME="CONSTRUCTED";var Of=class extends dt{fromBER(e,t,n){return t}toBER(e){return Ir}};Of.override="EndOfContentValueBlock";var px,xc=class extends Je{constructor(e={}){super(e,Of),this.idBlock.tagClass=1,this.idBlock.tagNumber=0}};px=xc;X.EndOfContent=px;xc.NAME=bc;var dx,_r=class extends Je{constructor(e={}){super(e,dt),this.idBlock.tagClass=1,this.idBlock.tagNumber=5}fromBER(e,t,n){return this.lenBlock.length>0&&this.warnings.push("Non-zero length of value block for Null type"),this.idBlock.error.length||(this.blockLength+=this.idBlock.blockLength),this.lenBlock.error.length||(this.blockLength+=this.lenBlock.blockLength),this.blockLength+=n,t+n>e.byteLength?(this.error="End of input reached before message was fully decoded (inconsistent offset and length values)",-1):t+n}toBER(e,t){let n=new ArrayBuffer(2);if(!e){let o=new Uint8Array(n);o[0]=5,o[1]=0}return t&&t.write(n),n}onAsciiEncoding(){return`${this.constructor.NAME}`}};dx=_r;X.Null=dx;_r.NAME="NULL";var Pf=class extends Fr(dt){get value(){for(let e of this.valueHexView)if(e>0)return!0;return!1}set value(e){this.valueHexView[0]=e?255:0}constructor({value:e,...t}={}){super(t),t.valueHex?this.valueHexView=ye.BufferSourceConverter.toUint8Array(t.valueHex):this.valueHexView=new Uint8Array(1),e&&(this.value=e)}fromBER(e,t,n){let o=ye.BufferSourceConverter.toUint8Array(e);return An(this,o,t,n)?(this.valueHexView=o.subarray(t,t+n),n>1&&this.warnings.push("Boolean value encoded in more then 1 octet"),this.isHexOnly=!0,Bm.call(this),this.blockLength=n,t+n):-1}toBER(){return this.valueHexView.slice()}toJSON(){return{...super.toJSON(),value:this.value}}};Pf.NAME="BooleanValueBlock";var mx,Qo=class extends Je{getValue(){return this.valueBlock.value}setValue(e){this.valueBlock.value=e}constructor(e={}){super(e,Pf),this.idBlock.tagClass=1,this.idBlock.tagNumber=1}onAsciiEncoding(){return`${this.constructor.NAME} : ${this.getValue}`}};mx=Qo;X.Boolean=mx;Qo.NAME="BOOLEAN";var Nf=class extends Fr(Vr){constructor({isConstructed:e=!1,...t}={}){super(t),this.isConstructed=e}fromBER(e,t,n){let o=0;if(this.isConstructed){if(this.isHexOnly=!1,o=Vr.prototype.fromBER.call(this,e,t,n),o===-1)return o;for(let i=0;i<this.value.length;i++){let s=this.value[i].constructor.NAME;if(s===bc){if(this.isIndefiniteForm)break;return this.error="EndOfContent is unexpected, OCTET STRING may consists of OCTET STRINGs only",-1}if(s!==cx)return this.error="OCTET STRING may consists of OCTET STRINGs only",-1}}else this.isHexOnly=!0,o=super.fromBER(e,t,n),this.blockLength=n;return o}toBER(e,t){return this.isConstructed?Vr.prototype.toBER.call(this,e,t):e?new ArrayBuffer(this.valueHexView.byteLength):this.valueHexView.slice().buffer}toJSON(){return{...super.toJSON(),isConstructed:this.isConstructed}}};Nf.NAME="OctetStringValueBlock";var Om,Cr=class extends Je{constructor({idBlock:e={},lenBlock:t={},...n}={}){var o,i;(o=n.isConstructed)!==null&&o!==void 0||(n.isConstructed=!!(!((i=n.value)===null||i===void 0)&&i.length)),super({idBlock:{isConstructed:n.isConstructed,...e},lenBlock:{...t,isIndefiniteForm:!!n.isIndefiniteForm},...n},Nf),this.idBlock.tagClass=1,this.idBlock.tagNumber=4}fromBER(e,t,n){if(this.valueBlock.isConstructed=this.idBlock.isConstructed,this.valueBlock.isIndefiniteForm=this.lenBlock.isIndefiniteForm,n===0)return this.idBlock.error.length===0&&(this.blockLength+=this.idBlock.blockLength),this.lenBlock.error.length===0&&(this.blockLength+=this.lenBlock.blockLength),t;if(!this.valueBlock.isConstructed){let i=(e instanceof ArrayBuffer?new Uint8Array(e):e).subarray(t,t+n);try{if(i.byteLength){let s=Os(i,0,i.byteLength);s.offset!==-1&&s.offset===n&&(this.valueBlock.value=[s.result])}}catch{}}return super.fromBER(e,t,n)}onAsciiEncoding(){if(this.valueBlock.isConstructed||this.valueBlock.value&&this.valueBlock.value.length)return Qe.prototype.onAsciiEncoding.call(this);let e=this.constructor.NAME,t=ye.Convert.ToHex(this.valueBlock.valueHexView);return`${e} : ${t}`}getValue(){if(!this.idBlock.isConstructed)return this.valueBlock.valueHexView.slice().buffer;let e=[];for(let t of this.valueBlock.value)t instanceof Om&&e.push(t.valueBlock.valueHexView);return ye.BufferSourceConverter.concat(e)}};Om=Cr;X.OctetString=Om;Cr.NAME=cx;var Df=class extends Fr(Vr){constructor({unusedBits:e=0,isConstructed:t=!1,...n}={}){super(n),this.unusedBits=e,this.isConstructed=t,this.blockLength=this.valueHexView.byteLength}fromBER(e,t,n){if(!n)return t;let o=-1;if(this.isConstructed){if(o=Vr.prototype.fromBER.call(this,e,t,n),o===-1)return o;for(let a of this.value){let c=a.constructor.NAME;if(c===bc){if(this.isIndefiniteForm)break;return this.error="EndOfContent is unexpected, BIT STRING may consists of BIT STRINGs only",-1}if(c!==ux)return this.error="BIT STRING may consists of BIT STRINGs only",-1;let f=a.valueBlock;if(this.unusedBits>0&&f.unusedBits>0)return this.error='Using of "unused bits" inside constructive BIT STRING allowed for least one only',-1;this.unusedBits=f.unusedBits}return o}let i=ye.BufferSourceConverter.toUint8Array(e);if(!An(this,i,t,n))return-1;let s=i.subarray(t,t+n);if(this.unusedBits=s[0],this.unusedBits>7)return this.error="Unused bits for BitString must be in range 0-7",-1;if(!this.unusedBits){let a=s.subarray(1);try{if(a.byteLength){let c=Os(a,0,a.byteLength);c.offset!==-1&&c.offset===n-1&&(this.value=[c.result])}}catch{}}return this.valueHexView=s.subarray(1),this.blockLength=s.length,t+n}toBER(e,t){if(this.isConstructed)return Vr.prototype.toBER.call(this,e,t);if(e)return new ArrayBuffer(this.valueHexView.byteLength+1);if(!this.valueHexView.byteLength)return Ir;let n=new Uint8Array(this.valueHexView.length+1);return n[0]=this.unusedBits,n.set(this.valueHexView,1),n.buffer}toJSON(){return{...super.toJSON(),unusedBits:this.unusedBits,isConstructed:this.isConstructed}}};Df.NAME="BitStringValueBlock";var yx,Br=class extends Je{constructor({idBlock:e={},lenBlock:t={},...n}={}){var o,i;(o=n.isConstructed)!==null&&o!==void 0||(n.isConstructed=!!(!((i=n.value)===null||i===void 0)&&i.length)),super({idBlock:{isConstructed:n.isConstructed,...e},lenBlock:{...t,isIndefiniteForm:!!n.isIndefiniteForm},...n},Df),this.idBlock.tagClass=1,this.idBlock.tagNumber=3}fromBER(e,t,n){return this.valueBlock.isConstructed=this.idBlock.isConstructed,this.valueBlock.isIndefiniteForm=this.lenBlock.isIndefiniteForm,super.fromBER(e,t,n)}onAsciiEncoding(){if(this.valueBlock.isConstructed||this.valueBlock.value&&this.valueBlock.value.length)return Qe.prototype.onAsciiEncoding.call(this);{let e=[],t=this.valueBlock.valueHexView;for(let s of t)e.push(s.toString(2).padStart(8,"0"));let n=e.join(""),o=this.constructor.NAME,i=n.substring(0,n.length-this.valueBlock.unusedBits);return`${o} : ${i}`}}};yx=Br;X.BitString=yx;Br.NAME=ux;var gx;function yC(r,e){let t=new Uint8Array([0]),n=new Uint8Array(r),o=new Uint8Array(e),i=n.slice(0),s=i.length-1,a=o.slice(0),c=a.length-1,f=0,p=c<s?s:c,h=0;for(let y=p;y>=0;y--,h++){switch(!0){case h<a.length:f=i[s-h]+a[c-h]+t[0];break;default:f=i[s-h]+t[0]}switch(t[0]=f/10,!0){case h>=i.length:i=Cf(new Uint8Array([f%10]),i);break;default:i[s-h]=f%10}}return t[0]>0&&(i=Cf(t,i)),i}function ax(r){if(r>=yc.length)for(let e=yc.length;e<=r;e++){let t=new Uint8Array([0]),n=yc[e-1].slice(0);for(let o=n.length-1;o>=0;o--){let i=new Uint8Array([(n[o]<<1)+t[0]]);t[0]=i[0]/10,n[o]=i[0]%10}t[0]>0&&(n=Cf(t,n)),yc.push(n)}return yc[r]}function gC(r,e){let t=0,n=new Uint8Array(r),o=new Uint8Array(e),i=n.slice(0),s=i.length-1,a=o.slice(0),c=a.length-1,f,p=0;for(let h=c;h>=0;h--,p++)switch(f=i[s-p]-a[c-p]-t,!0){case f<0:t=1,i[s-p]=f+10;break;default:t=0,i[s-p]=f}if(t>0)for(let h=s-c+1;h>=0;h--,p++)if(f=i[s-p]-t,f<0)t=1,i[s-p]=f+10;else{t=0,i[s-p]=f;break}return i.slice()}var vc=class extends Fr(dt){setValueHex(){this.valueHexView.length>=4?(this.warnings.push("Too big Integer for decoding, hex only"),this.isHexOnly=!0,this._valueDec=0):(this.isHexOnly=!1,this.valueHexView.length>0&&(this._valueDec=Bm.call(this)))}constructor({value:e,...t}={}){super(t),this._valueDec=0,t.valueHex&&this.setValueHex(),e!==void 0&&(this.valueDec=e)}set valueDec(e){this._valueDec=e,this.isHexOnly=!1,this.valueHexView=new Uint8Array(nx(e))}get valueDec(){return this._valueDec}fromDER(e,t,n,o=0){let i=this.fromBER(e,t,n);if(i===-1)return i;let s=this.valueHexView;return s[0]===0&&(s[1]&128)!==0?this.valueHexView=s.subarray(1):o!==0&&s.length<o&&(o-s.length>1&&(o=s.length+1),this.valueHexView=s.subarray(o-s.length)),i}toDER(e=!1){let t=this.valueHexView;switch(!0){case(t[0]&128)!==0:{let n=new Uint8Array(this.valueHexView.length+1);n[0]=0,n.set(t,1),this.valueHexView=n}break;case(t[0]===0&&(t[1]&128)===0):this.valueHexView=this.valueHexView.subarray(1);break}return this.toBER(e)}fromBER(e,t,n){let o=super.fromBER(e,t,n);return o===-1||this.setValueHex(),o}toBER(e){return e?new ArrayBuffer(this.valueHexView.length):this.valueHexView.slice().buffer}toJSON(){return{...super.toJSON(),valueDec:this.valueDec}}toString(){let e=this.valueHexView.length*8-1,t=new Uint8Array(this.valueHexView.length*8/3),n=0,o,i=this.valueHexView,s="",a=!1;for(let c=i.byteLength-1;c>=0;c--){o=i[c];for(let f=0;f<8;f++){if((o&1)===1)switch(n){case e:t=gC(ax(n),t),s="-";break;default:t=yC(t,ax(n))}n++,o>>=1}}for(let c=0;c<t.length;c++)t[c]&&(a=!0),a&&(s+=ix.charAt(t[c]));return a===!1&&(s+=ix.charAt(0)),s}};gx=vc;vc.NAME="IntegerValueBlock";Object.defineProperty(gx.prototype,"valueHex",{set:function(r){this.valueHexView=new Uint8Array(r),this.setValueHex()},get:function(){return this.valueHexView.slice().buffer}});var gc,vn=class extends Je{constructor(e={}){super(e,vc),this.idBlock.tagClass=1,this.idBlock.tagNumber=2}toBigInt(){return Bf(),BigInt(this.valueBlock.toString())}static fromBigInt(e){Bf();let t=BigInt(e),n=new Ts,o=t.toString(16).replace(/^-/,""),i=new Uint8Array(ye.Convert.FromHex(o));if(t<0){let a=new Uint8Array(i.length+(i[0]&128?1:0));a[0]|=128;let f=BigInt(`0x${ye.Convert.ToHex(a)}`)+t,p=ye.BufferSourceConverter.toUint8Array(ye.Convert.FromHex(f.toString(16)));p[0]|=128,n.write(p)}else i[0]&128&&n.write(new Uint8Array([0])),n.write(i);return new gc({valueHex:n.final()})}convertToDER(){let e=new gc({valueHex:this.valueBlock.valueHexView});return e.valueBlock.toDER(),e}convertFromDER(){return new gc({valueHex:this.valueBlock.valueHexView[0]===0?this.valueBlock.valueHexView.subarray(1):this.valueBlock.valueHexView})}onAsciiEncoding(){return`${this.constructor.NAME} : ${this.valueBlock.toString()}`}};gc=vn;X.Integer=gc;vn.NAME="INTEGER";var bx,ei=class extends vn{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=10}};bx=ei;X.Enumerated=bx;ei.NAME="ENUMERATED";var Ac=class extends Fr(dt){constructor({valueDec:e=-1,isFirstSid:t=!1,...n}={}){super(n),this.valueDec=e,this.isFirstSid=t}fromBER(e,t,n){if(!n)return t;let o=ye.BufferSourceConverter.toUint8Array(e);if(!An(this,o,t,n))return-1;let i=o.subarray(t,t+n);this.valueHexView=new Uint8Array(n);for(let a=0;a<n&&(this.valueHexView[a]=i[a]&127,this.blockLength++,(i[a]&128)!==0);a++);let s=new Uint8Array(this.blockLength);for(let a=0;a<this.blockLength;a++)s[a]=this.valueHexView[a];return this.valueHexView=s,(i[this.blockLength-1]&128)!==0?(this.error="End of input reached before message was fully decoded",-1):(this.valueHexView[0]===0&&this.warnings.push("Needlessly long format of SID encoding"),this.blockLength<=8?this.valueDec=Jo(this.valueHexView,7):(this.isHexOnly=!0,this.warnings.push("Too big SID for decoding, hex only")),t+this.blockLength)}set valueBigInt(e){Bf();let t=BigInt(e).toString(2);for(;t.length%7;)t="0"+t;let n=new Uint8Array(t.length/7);for(let o=0;o<n.length;o++)n[o]=parseInt(t.slice(o*7,o*7+7),2)+(o+1<n.length?128:0);this.fromBER(n.buffer,0,n.length)}toBER(e){if(this.isHexOnly){if(e)return new ArrayBuffer(this.valueHexView.byteLength);let o=this.valueHexView,i=new Uint8Array(this.blockLength);for(let s=0;s<this.blockLength-1;s++)i[s]=o[s]|128;return i[this.blockLength-1]=o[this.blockLength-1],i.buffer}let t=no(this.valueDec,7);if(t.byteLength===0)return this.error="Error during encoding SID value",Ir;let n=new Uint8Array(t.byteLength);if(!e){let o=new Uint8Array(t),i=t.byteLength-1;for(let s=0;s<i;s++)n[s]=o[s]|128;n[i]=o[i]}return n}toString(){let e="";if(this.isHexOnly)e=ye.Convert.ToHex(this.valueHexView);else if(this.isFirstSid){let t=this.valueDec;this.valueDec<=39?e="0.":this.valueDec<=79?(e="1.",t-=40):(e="2.",t-=80),e+=t.toString()}else e=this.valueDec.toString();return e}toJSON(){return{...super.toJSON(),valueDec:this.valueDec,isFirstSid:this.isFirstSid}}};Ac.NAME="sidBlock";var Rf=class extends dt{constructor({value:e=Kt,...t}={}){super(t),this.value=[],e&&this.fromString(e)}fromBER(e,t,n){let o=t;for(;n>0;){let i=new Ac;if(o=i.fromBER(e,o,n),o===-1)return this.blockLength=0,this.error=i.error,o;this.value.length===0&&(i.isFirstSid=!0),this.blockLength+=i.blockLength,n-=i.blockLength,this.value.push(i)}return o}toBER(e){let t=[];for(let n=0;n<this.value.length;n++){let o=this.value[n].toBER(e);if(o.byteLength===0)return this.error=this.value[n].error,Ir;t.push(o)}return km(t)}fromString(e){this.value=[];let t=0,n=0,o="",i=!1;do if(n=e.indexOf(".",t),n===-1?o=e.substring(t):o=e.substring(t,n),t=n+1,i){let s=this.value[0],a=0;switch(s.valueDec){case 0:break;case 1:a=40;break;case 2:a=80;break;default:this.value=[];return}let c=parseInt(o,10);if(isNaN(c))return;s.valueDec=c+a,i=!1}else{let s=new Ac;if(o>Number.MAX_SAFE_INTEGER){Bf();let a=BigInt(o);s.valueBigInt=a}else if(s.valueDec=parseInt(o,10),isNaN(s.valueDec))return;this.value.length||(s.isFirstSid=!0,i=!0),this.value.push(s)}while(n!==-1)}toString(){let e="",t=!1;for(let n=0;n<this.value.length;n++){t=this.value[n].isHexOnly;let o=this.value[n].toString();n!==0&&(e=`${e}.`),t?(o=`{${o}}`,this.value[n].isFirstSid?e=`2.{${o} - 80}`:e+=o):e+=o}return e}toJSON(){let e={...super.toJSON(),value:this.toString(),sidArray:[]};for(let t=0;t<this.value.length;t++)e.sidArray.push(this.value[t].toJSON());return e}};Rf.NAME="ObjectIdentifierValueBlock";var wx,ti=class extends Je{getValue(){return this.valueBlock.toString()}setValue(e){this.valueBlock.fromString(e)}constructor(e={}){super(e,Rf),this.idBlock.tagClass=1,this.idBlock.tagNumber=6}onAsciiEncoding(){return`${this.constructor.NAME} : ${this.valueBlock.toString()||"empty"}`}toJSON(){return{...super.toJSON(),value:this.getValue()}}};wx=ti;X.ObjectIdentifier=wx;ti.NAME="OBJECT IDENTIFIER";var Sc=class extends Fr(wn){constructor({valueDec:e=0,...t}={}){super(t),this.valueDec=e}fromBER(e,t,n){if(n===0)return t;let o=ye.BufferSourceConverter.toUint8Array(e);if(!An(this,o,t,n))return-1;let i=o.subarray(t,t+n);this.valueHexView=new Uint8Array(n);for(let a=0;a<n&&(this.valueHexView[a]=i[a]&127,this.blockLength++,(i[a]&128)!==0);a++);let s=new Uint8Array(this.blockLength);for(let a=0;a<this.blockLength;a++)s[a]=this.valueHexView[a];return this.valueHexView=s,(i[this.blockLength-1]&128)!==0?(this.error="End of input reached before message was fully decoded",-1):(this.valueHexView[0]===0&&this.warnings.push("Needlessly long format of SID encoding"),this.blockLength<=8?this.valueDec=Jo(this.valueHexView,7):(this.isHexOnly=!0,this.warnings.push("Too big SID for decoding, hex only")),t+this.blockLength)}toBER(e){if(this.isHexOnly){if(e)return new ArrayBuffer(this.valueHexView.byteLength);let o=this.valueHexView,i=new Uint8Array(this.blockLength);for(let s=0;s<this.blockLength-1;s++)i[s]=o[s]|128;return i[this.blockLength-1]=o[this.blockLength-1],i.buffer}let t=no(this.valueDec,7);if(t.byteLength===0)return this.error="Error during encoding SID value",Ir;let n=new Uint8Array(t.byteLength);if(!e){let o=new Uint8Array(t),i=t.byteLength-1;for(let s=0;s<i;s++)n[s]=o[s]|128;n[i]=o[i]}return n.buffer}toString(){let e="";return this.isHexOnly?e=ye.Convert.ToHex(this.valueHexView):e=this.valueDec.toString(),e}toJSON(){return{...super.toJSON(),valueDec:this.valueDec}}};Sc.NAME="relativeSidBlock";var Lf=class extends dt{constructor({value:e=Kt,...t}={}){super(t),this.value=[],e&&this.fromString(e)}fromBER(e,t,n){let o=t;for(;n>0;){let i=new Sc;if(o=i.fromBER(e,o,n),o===-1)return this.blockLength=0,this.error=i.error,o;this.blockLength+=i.blockLength,n-=i.blockLength,this.value.push(i)}return o}toBER(e,t){let n=[];for(let o=0;o<this.value.length;o++){let i=this.value[o].toBER(e);if(i.byteLength===0)return this.error=this.value[o].error,Ir;n.push(i)}return km(n)}fromString(e){this.value=[];let t=0,n=0,o="";do{n=e.indexOf(".",t),n===-1?o=e.substring(t):o=e.substring(t,n),t=n+1;let i=new Sc;if(i.valueDec=parseInt(o,10),isNaN(i.valueDec))return!0;this.value.push(i)}while(n!==-1);return!0}toString(){let e="",t=!1;for(let n=0;n<this.value.length;n++){t=this.value[n].isHexOnly;let o=this.value[n].toString();n!==0&&(e=`${e}.`),t&&(o=`{${o}}`),e+=o}return e}toJSON(){let e={...super.toJSON(),value:this.toString(),sidArray:[]};for(let t=0;t<this.value.length;t++)e.sidArray.push(this.value[t].toJSON());return e}};Lf.NAME="RelativeObjectIdentifierValueBlock";var xx,Ec=class extends Je{getValue(){return this.valueBlock.toString()}setValue(e){this.valueBlock.fromString(e)}constructor(e={}){super(e,Lf),this.idBlock.tagClass=1,this.idBlock.tagNumber=13}onAsciiEncoding(){return`${this.constructor.NAME} : ${this.valueBlock.toString()||"empty"}`}toJSON(){return{...super.toJSON(),value:this.getValue()}}};xx=Ec;X.RelativeObjectIdentifier=xx;Ec.NAME="RelativeObjectIdentifier";var vx,Bt=class extends Qe{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=16}};vx=Bt;X.Sequence=vx;Bt.NAME="SEQUENCE";var Ax,Pt=class extends Qe{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=17}};Ax=Pt;X.Set=Ax;Pt.NAME="SET";var Uf=class extends Fr(dt){constructor({...e}={}){super(e),this.isHexOnly=!0,this.value=Kt}toJSON(){return{...super.toJSON(),value:this.value}}};Uf.NAME="StringValueBlock";var Mf=class extends Uf{};Mf.NAME="SimpleStringValueBlock";var Nt=class extends wc{constructor({...e}={}){super(e,Mf)}fromBuffer(e){this.valueBlock.value=String.fromCharCode.apply(null,ye.BufferSourceConverter.toUint8Array(e))}fromString(e){let t=e.length,n=this.valueBlock.valueHexView=new Uint8Array(t);for(let o=0;o<t;o++)n[o]=e.charCodeAt(o);this.valueBlock.value=e}};Nt.NAME="SIMPLE STRING";var jf=class extends Nt{fromBuffer(e){this.valueBlock.valueHexView=ye.BufferSourceConverter.toUint8Array(e);try{this.valueBlock.value=ye.Convert.ToUtf8String(e)}catch(t){this.warnings.push(`Error during "decodeURIComponent": ${t}, using raw string`),this.valueBlock.value=ye.Convert.ToBinary(e)}}fromString(e){this.valueBlock.valueHexView=new Uint8Array(ye.Convert.FromUtf8String(e)),this.valueBlock.value=e}};jf.NAME="Utf8StringValueBlock";var Sx,ir=class extends jf{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=12}};Sx=ir;X.Utf8String=Sx;ir.NAME="UTF8String";var Kf=class extends Nt{fromBuffer(e){this.valueBlock.value=ye.Convert.ToUtf16String(e),this.valueBlock.valueHexView=ye.BufferSourceConverter.toUint8Array(e)}fromString(e){this.valueBlock.value=e,this.valueBlock.valueHexView=new Uint8Array(ye.Convert.FromUtf16String(e))}};Kf.NAME="BmpStringValueBlock";var Ex,ri=class extends Kf{constructor({...e}={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=30}};Ex=ri;X.BmpString=Ex;ri.NAME="BMPString";var Hf=class extends Nt{fromBuffer(e){let t=ArrayBuffer.isView(e)?e.slice().buffer:e.slice(0),n=new Uint8Array(t);for(let o=0;o<n.length;o+=4)n[o]=n[o+3],n[o+1]=n[o+2],n[o+2]=0,n[o+3]=0;this.valueBlock.value=String.fromCharCode.apply(null,new Uint32Array(t))}fromString(e){let t=e.length,n=this.valueBlock.valueHexView=new Uint8Array(t*4);for(let o=0;o<t;o++){let i=no(e.charCodeAt(o),8),s=new Uint8Array(i);if(s.length>4)continue;let a=4-s.length;for(let c=s.length-1;c>=0;c--)n[o*4+c+a]=s[c]}this.valueBlock.value=e}};Hf.NAME="UniversalStringValueBlock";var _x,ni=class extends Hf{constructor({...e}={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=28}};_x=ni;X.UniversalString=_x;ni.NAME="UniversalString";var Cx,oi=class extends Nt{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=18}};Cx=oi;X.NumericString=Cx;oi.NAME="NumericString";var Bx,ii=class extends Nt{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=19}};Bx=ii;X.PrintableString=Bx;ii.NAME="PrintableString";var Ix,si=class extends Nt{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=20}};Ix=si;X.TeletexString=Ix;si.NAME="TeletexString";var Tx,ai=class extends Nt{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=21}};Tx=ai;X.VideotexString=Tx;ai.NAME="VideotexString";var kx,ci=class extends Nt{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=22}};kx=ci;X.IA5String=kx;ci.NAME="IA5String";var Ox,ui=class extends Nt{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=25}};Ox=ui;X.GraphicString=Ox;ui.NAME="GraphicString";var Px,oo=class extends Nt{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=26}};Px=oo;X.VisibleString=Px;oo.NAME="VisibleString";var Nx,li=class extends Nt{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=27}};Nx=li;X.GeneralString=Nx;li.NAME="GeneralString";var Dx,fi=class extends Nt{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=29}};Dx=fi;X.CharacterString=Dx;fi.NAME="CharacterString";var Rx,io=class extends oo{constructor({value:e,valueDate:t,...n}={}){if(super(n),this.year=0,this.month=0,this.day=0,this.hour=0,this.minute=0,this.second=0,e){this.fromString(e),this.valueBlock.valueHexView=new Uint8Array(e.length);for(let o=0;o<e.length;o++)this.valueBlock.valueHexView[o]=e.charCodeAt(o)}t&&(this.fromDate(t),this.valueBlock.valueHexView=new Uint8Array(this.toBuffer())),this.idBlock.tagClass=1,this.idBlock.tagNumber=23}fromBuffer(e){this.fromString(String.fromCharCode.apply(null,ye.BufferSourceConverter.toUint8Array(e)))}toBuffer(){let e=this.toString(),t=new ArrayBuffer(e.length),n=new Uint8Array(t);for(let o=0;o<e.length;o++)n[o]=e.charCodeAt(o);return t}fromDate(e){this.year=e.getUTCFullYear(),this.month=e.getUTCMonth()+1,this.day=e.getUTCDate(),this.hour=e.getUTCHours(),this.minute=e.getUTCMinutes(),this.second=e.getUTCSeconds()}toDate(){return new Date(Date.UTC(this.year,this.month-1,this.day,this.hour,this.minute,this.second))}fromString(e){let n=/(\d{2})(\d{2})(\d{2})(\d{2})(\d{2})(\d{2})Z/ig.exec(e);if(n===null){this.error="Wrong input string for conversion";return}let o=parseInt(n[1],10);o>=50?this.year=1900+o:this.year=2e3+o,this.month=parseInt(n[2],10),this.day=parseInt(n[3],10),this.hour=parseInt(n[4],10),this.minute=parseInt(n[5],10),this.second=parseInt(n[6],10)}toString(e="iso"){if(e==="iso"){let t=new Array(7);return t[0]=jt(this.year<2e3?this.year-1900:this.year-2e3,2),t[1]=jt(this.month,2),t[2]=jt(this.day,2),t[3]=jt(this.hour,2),t[4]=jt(this.minute,2),t[5]=jt(this.second,2),t[6]="Z",t.join("")}return super.toString(e)}onAsciiEncoding(){return`${this.constructor.NAME} : ${this.toDate().toISOString()}`}toJSON(){return{...super.toJSON(),year:this.year,month:this.month,day:this.day,hour:this.hour,minute:this.minute,second:this.second}}};Rx=io;X.UTCTime=Rx;io.NAME="UTCTime";var Lx,hi=class extends io{constructor(e={}){var t;super(e),(t=this.millisecond)!==null&&t!==void 0||(this.millisecond=0),this.idBlock.tagClass=1,this.idBlock.tagNumber=24}fromDate(e){super.fromDate(e),this.millisecond=e.getUTCMilliseconds()}toDate(){let e=Date.UTC(this.year,this.month-1,this.day,this.hour,this.minute,this.second,this.millisecond);return new Date(e)}fromString(e){let t=!1,n="",o="",i=0,s,a=0,c=0;if(e[e.length-1]==="Z")n=e.substring(0,e.length-1),t=!0;else{let h=new Number(e[e.length-1]);if(isNaN(h.valueOf()))throw new Error("Wrong input string for conversion");n=e}if(t){if(n.indexOf("+")!==-1)throw new Error("Wrong input string for conversion");if(n.indexOf("-")!==-1)throw new Error("Wrong input string for conversion")}else{let h=1,y=n.indexOf("+"),b="";if(y===-1&&(y=n.indexOf("-"),h=-1),y!==-1){if(b=n.substring(y+1),n=n.substring(0,y),b.length!==2&&b.length!==4)throw new Error("Wrong input string for conversion");let g=parseInt(b.substring(0,2),10);if(isNaN(g.valueOf()))throw new Error("Wrong input string for conversion");if(a=h*g,b.length===4){if(g=parseInt(b.substring(2,4),10),isNaN(g.valueOf()))throw new Error("Wrong input string for conversion");c=h*g}}}let f=n.indexOf(".");if(f===-1&&(f=n.indexOf(",")),f!==-1){let h=new Number(`0${n.substring(f)}`);if(isNaN(h.valueOf()))throw new Error("Wrong input string for conversion");i=h.valueOf(),o=n.substring(0,f)}else o=n;switch(!0){case o.length===8:if(s=/(\d{4})(\d{2})(\d{2})/ig,f!==-1)throw new Error("Wrong input string for conversion");break;case o.length===10:if(s=/(\d{4})(\d{2})(\d{2})(\d{2})/ig,f!==-1){let h=60*i;this.minute=Math.floor(h),h=60*(h-this.minute),this.second=Math.floor(h),h=1e3*(h-this.second),this.millisecond=Math.floor(h)}break;case o.length===12:if(s=/(\d{4})(\d{2})(\d{2})(\d{2})(\d{2})/ig,f!==-1){let h=60*i;this.second=Math.floor(h),h=1e3*(h-this.second),this.millisecond=Math.floor(h)}break;case o.length===14:if(s=/(\d{4})(\d{2})(\d{2})(\d{2})(\d{2})(\d{2})/ig,f!==-1){let h=1e3*i;this.millisecond=Math.floor(h)}break;default:throw new Error("Wrong input string for conversion")}let p=s.exec(o);if(p===null)throw new Error("Wrong input string for conversion");for(let h=1;h<p.length;h++)switch(h){case 1:this.year=parseInt(p[h],10);break;case 2:this.month=parseInt(p[h],10);break;case 3:this.day=parseInt(p[h],10);break;case 4:this.hour=parseInt(p[h],10)+a;break;case 5:this.minute=parseInt(p[h],10)+c;break;case 6:this.second=parseInt(p[h],10);break;default:throw new Error("Wrong input string for conversion")}if(t===!1){let h=new Date(this.year,this.month,this.day,this.hour,this.minute,this.second,this.millisecond);this.year=h.getUTCFullYear(),this.month=h.getUTCMonth(),this.day=h.getUTCDay(),this.hour=h.getUTCHours(),this.minute=h.getUTCMinutes(),this.second=h.getUTCSeconds(),this.millisecond=h.getUTCMilliseconds()}}toString(e="iso"){if(e==="iso"){let t=[];return t.push(jt(this.year,4)),t.push(jt(this.month,2)),t.push(jt(this.day,2)),t.push(jt(this.hour,2)),t.push(jt(this.minute,2)),t.push(jt(this.second,2)),this.millisecond!==0&&(t.push("."),t.push(jt(this.millisecond,3))),t.push("Z"),t.join("")}return super.toString(e)}toJSON(){return{...super.toJSON(),millisecond:this.millisecond}}};Lx=hi;X.GeneralizedTime=Lx;hi.NAME="GeneralizedTime";var Ux,_c=class extends ir{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=31}};Ux=_c;X.DATE=Ux;_c.NAME="DATE";var Mx,Cc=class extends ir{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=32}};Mx=Cc;X.TimeOfDay=Mx;Cc.NAME="TimeOfDay";var jx,Bc=class extends ir{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=33}};jx=Bc;X.DateTime=jx;Bc.NAME="DateTime";var Kx,Ic=class extends ir{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=34}};Kx=Ic;X.Duration=Kx;Ic.NAME="Duration";var Hx,Tc=class extends ir{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=14}};Hx=Tc;X.TIME=Hx;Tc.NAME="TIME";var $r=class{constructor({name:e=Kt,optional:t=!1}={}){this.name=e,this.optional=t}},ks=class extends $r{constructor({value:e=[],...t}={}){super(t),this.value=e}},pi=class extends $r{constructor({value:e=new $r,local:t=!1,...n}={}){super(n),this.value=e,this.local=t}},Tm=class{get data(){return this.dataView.slice().buffer}set data(e){this.dataView=ye.BufferSourceConverter.toUint8Array(e)}constructor({data:e=Vf}={}){this.dataView=ye.BufferSourceConverter.toUint8Array(e)}fromBER(e,t,n){let o=t+n;return this.dataView=ye.BufferSourceConverter.toUint8Array(e).subarray(t,o),o}toBER(e){return this.dataView.slice().buffer}};function bn(r,e,t){if(t instanceof ks){for(let i of t.value)if(bn(r,e,i).verified)return{verified:!0,result:r};{let i={verified:!1,result:{error:"Wrong values for Choice type"}};return t.hasOwnProperty(Im)&&(i.name=t.name),i}}if(t instanceof $r)return t.hasOwnProperty(Im)&&(r[t.name]=e),{verified:!0,result:r};if(!(r instanceof Object))return{verified:!1,result:{error:"Wrong root object"}};if(!(e instanceof Object))return{verified:!1,result:{error:"Wrong ASN.1 data"}};if(!(t instanceof Object))return{verified:!1,result:{error:"Wrong ASN.1 schema"}};if(!(aC in t))return{verified:!1,result:{error:"Wrong ASN.1 schema"}};if(!(fC in t.idBlock))return{verified:!1,result:{error:"Wrong ASN.1 schema"}};if(!(hC in t.idBlock))return{verified:!1,result:{error:"Wrong ASN.1 schema"}};let n=t.idBlock.toBER(!1);if(n.byteLength===0)return{verified:!1,result:{error:"Error encoding idBlock for ASN.1 schema"}};if(t.idBlock.fromBER(n,0,n.byteLength)===-1)return{verified:!1,result:{error:"Error decoding idBlock for ASN.1 schema"}};if(t.idBlock.hasOwnProperty(cC)===!1)return{verified:!1,result:{error:"Wrong ASN.1 schema"}};if(t.idBlock.tagClass!==e.idBlock.tagClass)return{verified:!1,result:r};if(t.idBlock.hasOwnProperty(uC)===!1)return{verified:!1,result:{error:"Wrong ASN.1 schema"}};if(t.idBlock.tagNumber!==e.idBlock.tagNumber)return{verified:!1,result:r};if(t.idBlock.hasOwnProperty(lC)===!1)return{verified:!1,result:{error:"Wrong ASN.1 schema"}};if(t.idBlock.isConstructed!==e.idBlock.isConstructed)return{verified:!1,result:r};if(!(sC in t.idBlock))return{verified:!1,result:{error:"Wrong ASN.1 schema"}};if(t.idBlock.isHexOnly!==e.idBlock.isHexOnly)return{verified:!1,result:r};if(t.idBlock.isHexOnly){if(!(sx in t.idBlock))return{verified:!1,result:{error:"Wrong ASN.1 schema"}};let i=t.idBlock.valueHexView,s=e.idBlock.valueHexView;if(i.length!==s.length)return{verified:!1,result:r};for(let a=0;a<i.length;a++)if(i[a]!==s[1])return{verified:!1,result:r}}if(t.name&&(t.name=t.name.replace(/^\s+|\s+$/g,Kt),t.name&&(r[t.name]=e)),t instanceof X.Constructed){let i=0,s={verified:!1,result:{error:"Unknown error"}},a=t.valueBlock.value.length;if(a>0&&t.valueBlock.value[0]instanceof pi&&(a=e.valueBlock.value.length),a===0)return{verified:!0,result:r};if(e.valueBlock.value.length===0&&t.valueBlock.value.length!==0){let c=!0;for(let f=0;f<t.valueBlock.value.length;f++)c=c&&(t.valueBlock.value[f].optional||!1);return c?{verified:!0,result:r}:(t.name&&(t.name=t.name.replace(/^\s+|\s+$/g,Kt),t.name&&delete r[t.name]),r.error="Inconsistent object length",{verified:!1,result:r})}for(let c=0;c<a;c++)if(c-i>=e.valueBlock.value.length){if(t.valueBlock.value[c].optional===!1){let f={verified:!1,result:r};return r.error="Inconsistent length between ASN.1 data and schema",t.name&&(t.name=t.name.replace(/^\s+|\s+$/g,Kt),t.name&&(delete r[t.name],f.name=t.name)),f}}else if(t.valueBlock.value[0]instanceof pi){if(s=bn(r,e.valueBlock.value[c],t.valueBlock.value[0].value),s.verified===!1)if(t.valueBlock.value[0].optional)i++;else return t.name&&(t.name=t.name.replace(/^\s+|\s+$/g,Kt),t.name&&delete r[t.name]),s;if(Im in t.valueBlock.value[0]&&t.valueBlock.value[0].name.length>0){let f={};pC in t.valueBlock.value[0]&&t.valueBlock.value[0].local?f=e:f=r,typeof f[t.valueBlock.value[0].name]>"u"&&(f[t.valueBlock.value[0].name]=[]),f[t.valueBlock.value[0].name].push(e.valueBlock.value[c])}}else if(s=bn(r,e.valueBlock.value[c-i],t.valueBlock.value[c]),s.verified===!1)if(t.valueBlock.value[c].optional)i++;else return t.name&&(t.name=t.name.replace(/^\s+|\s+$/g,Kt),t.name&&delete r[t.name]),s;if(s.verified===!1){let c={verified:!1,result:r};return t.name&&(t.name=t.name.replace(/^\s+|\s+$/g,Kt),t.name&&(delete r[t.name],c.name=t.name)),c}return{verified:!0,result:r}}if(t.primitiveSchema&&sx in e.valueBlock){let i=Os(e.valueBlock.valueHexView);if(i.offset===-1){let s={verified:!1,result:i.result};return t.name&&(t.name=t.name.replace(/^\s+|\s+$/g,Kt),t.name&&(delete r[t.name],s.name=t.name)),s}return bn(r,i.result,t.primitiveSchema)}return{verified:!0,result:r}}function bC(r,e){if(!(e instanceof Object))return{verified:!1,result:{error:"Wrong ASN.1 schema type"}};let t=Os(ye.BufferSourceConverter.toUint8Array(r));return t.offset===-1?{verified:!1,result:t.result}:bn(t.result,t.result,e)}var x;(function(r){r[r.Sequence=0]="Sequence",r[r.Set=1]="Set",r[r.Choice=2]="Choice"})(x||(x={}));var d;(function(r){r[r.Any=1]="Any",r[r.Boolean=2]="Boolean",r[r.OctetString=3]="OctetString",r[r.BitString=4]="BitString",r[r.Integer=5]="Integer",r[r.Enumerated=6]="Enumerated",r[r.ObjectIdentifier=7]="ObjectIdentifier",r[r.Utf8String=8]="Utf8String",r[r.BmpString=9]="BmpString",r[r.UniversalString=10]="UniversalString",r[r.NumericString=11]="NumericString",r[r.PrintableString=12]="PrintableString",r[r.TeletexString=13]="TeletexString",r[r.VideotexString=14]="VideotexString",r[r.IA5String=15]="IA5String",r[r.GraphicString=16]="GraphicString",r[r.VisibleString=17]="VisibleString",r[r.GeneralString=18]="GeneralString",r[r.CharacterString=19]="CharacterString",r[r.UTCTime=20]="UTCTime",r[r.GeneralizedTime=21]="GeneralizedTime",r[r.DATE=22]="DATE",r[r.TimeOfDay=23]="TimeOfDay",r[r.DateTime=24]="DateTime",r[r.Duration=25]="Duration",r[r.TIME=26]="TIME",r[r.Null=27]="Null"})(d||(d={}));var Pm=Rr(gn()),qr=class{constructor(e,t=0){if(this.unusedBits=0,this.value=new ArrayBuffer(0),e)if(typeof e=="number")this.fromNumber(e);else if(Pm.BufferSourceConverter.isBufferSource(e))this.unusedBits=t,this.value=Pm.BufferSourceConverter.toArrayBuffer(e);else throw TypeError("Unsupported type of 'params' argument for BitString")}fromASN(e){if(!(e instanceof Br))throw new TypeError("Argument 'asn' is not instance of ASN.1 BitString");return this.unusedBits=e.valueBlock.unusedBits,this.value=e.valueBlock.valueHex,this}toASN(){return new Br({unusedBits:this.unusedBits,valueHex:this.value})}toSchema(e){return new Br({name:e})}toNumber(){let e="",t=new Uint8Array(this.value);for(let n of t)e+=n.toString(2).padStart(8,"0");return e=e.split("").reverse().join(""),this.unusedBits&&(e=e.slice(this.unusedBits).padStart(this.unusedBits,"0")),parseInt(e,2)}fromNumber(e){let t=e.toString(2),n=t.length+7>>3;this.unusedBits=(n<<3)-t.length;let o=new Uint8Array(n);t=t.padStart(n<<3,"0").split("").reverse().join("");let i=0;for(;i<n;)o[i]=parseInt(t.slice(i<<3,(i<<3)+8),2),i++;this.value=o.buffer}};var Nm=Rr(gn()),ie=class{get byteLength(){return this.buffer.byteLength}get byteOffset(){return 0}constructor(e){typeof e=="number"?this.buffer=new ArrayBuffer(e):Nm.BufferSourceConverter.isBufferSource(e)?this.buffer=Nm.BufferSourceConverter.toArrayBuffer(e):Array.isArray(e)?this.buffer=new Uint8Array(e):this.buffer=new ArrayBuffer(0)}fromASN(e){if(!(e instanceof Cr))throw new TypeError("Argument 'asn' is not instance of ASN.1 OctetString");return this.buffer=e.valueBlock.valueHex,this}toASN(){return new Cr({valueHex:this.buffer})}toSchema(e){return new Cr({name:e})}};var wC={fromASN:r=>r instanceof _r?null:r.valueBeforeDecodeView,toASN:r=>{if(r===null)return new _r;let e=Sn(r);if(e.result.error)throw new Error(e.result.error);return e.result}},xC={fromASN:r=>r.valueBlock.valueHexView.byteLength>=4?r.valueBlock.toString():r.valueBlock.valueDec,toASN:r=>new vn({value:+r})},vC={fromASN:r=>r.valueBlock.valueDec,toASN:r=>new ei({value:r})},ge={fromASN:r=>r.valueBlock.valueHexView,toASN:r=>new vn({valueHex:r})};var AC={fromASN:r=>r.valueBlock.valueHexView,toASN:r=>new Br({valueHex:r})},SC={fromASN:r=>r.valueBlock.toString(),toASN:r=>new ti({value:r})},EC={fromASN:r=>r.valueBlock.value,toASN:r=>new Qo({value:r})},Ps={fromASN:r=>r.valueBlock.valueHexView,toASN:r=>new Cr({valueHex:r})},Vx={fromASN:r=>new ie(r.getValue()),toASN:r=>r.toASN()};function sr(r){return{fromASN:e=>e.valueBlock.value,toASN:e=>new r({value:e})}}var Dm=sr(ir),_C=sr(ri),CC=sr(ni),BC=sr(oi),IC=sr(ii),TC=sr(si),kC=sr(ai),OC=sr(ci),PC=sr(ui),NC=sr(oo),DC=sr(li),RC=sr(fi),LC={fromASN:r=>r.toDate(),toASN:r=>new io({valueDate:r})},UC={fromASN:r=>r.toDate(),toASN:r=>new hi({valueDate:r})},MC={fromASN:()=>null,toASN:()=>new _r};function so(r){switch(r){case d.Any:return wC;case d.BitString:return AC;case d.BmpString:return _C;case d.Boolean:return EC;case d.CharacterString:return RC;case d.Enumerated:return vC;case d.GeneralString:return DC;case d.GeneralizedTime:return UC;case d.GraphicString:return PC;case d.IA5String:return OC;case d.Integer:return xC;case d.Null:return MC;case d.NumericString:return BC;case d.ObjectIdentifier:return SC;case d.OctetString:return Ps;case d.PrintableString:return IC;case d.TeletexString:return TC;case d.UTCTime:return LC;case d.UniversalString:return CC;case d.Utf8String:return Dm;case d.VideotexString:return kC;case d.VisibleString:return NC;default:return null}}function ar(r){return typeof r=="function"&&r.prototype?r.prototype.toASN&&r.prototype.fromASN?!0:ar(r.prototype):!!(r&&typeof r=="object"&&"toASN"in r&&"fromASN"in r)}function Lm(r){var e;if(r){let t=Object.getPrototypeOf(r);return((e=t?.prototype)===null||e===void 0?void 0:e.constructor)===Array?!0:Lm(t)}return!1}function $x(r,e){if(!(r&&e)||r.byteLength!==e.byteLength)return!1;let t=new Uint8Array(r),n=new Uint8Array(e);for(let o=0;o<r.byteLength;o++)if(t[o]!==n[o])return!1;return!0}var $f=class{constructor(){this.items=new WeakMap}has(e){return this.items.has(e)}get(e,t=!1){let n=this.items.get(e);if(!n)throw new Error(`Cannot get schema for '${e.prototype.constructor.name}' target`);if(t&&!n.schema)throw new Error(`Schema '${e.prototype.constructor.name}' doesn't contain ASN.1 schema. Call 'AsnSchemaStorage.cache'.`);return n}cache(e){let t=this.get(e);t.schema||(t.schema=this.create(e,!0))}createDefault(e){let t={type:x.Sequence,items:{}},n=this.findParentSchema(e);return n&&(Object.assign(t,n),t.items=Object.assign({},t.items,n.items)),t}create(e,t){let n=this.items.get(e)||this.createDefault(e),o=[];for(let i in n.items){let s=n.items[i],a=t?i:"",c;if(typeof s.type=="number"){let p=d[s.type],h=Wr[p];if(!h)throw new Error(`Cannot get ASN1 class by name '${p}'`);c=new h({name:a})}else ar(s.type)?c=new s.type().toSchema(a):s.optional?this.get(s.type).type===x.Choice?c=new $r({name:a}):(c=this.create(s.type,!1),c.name=a):c=new $r({name:a});let f=!!s.optional||s.defaultValue!==void 0;if(s.repeated){c.name="";let p=s.repeated==="set"?Pt:Bt;c=new p({name:"",value:[new pi({name:a,value:c})]})}if(s.context!==null&&s.context!==void 0)if(s.implicit)if(typeof s.type=="number"||ar(s.type)){let p=s.repeated?Qe:xn;o.push(new p({name:a,optional:f,idBlock:{tagClass:3,tagNumber:s.context}}))}else{this.cache(s.type);let p=!!s.repeated,h=p?c:this.get(s.type,!0).schema;h="valueBlock"in h?h.valueBlock.value:h.value,o.push(new Qe({name:p?"":a,optional:f,idBlock:{tagClass:3,tagNumber:s.context},value:h}))}else o.push(new Qe({optional:f,idBlock:{tagClass:3,tagNumber:s.context},value:[c]}));else c.optional=f,o.push(c)}switch(n.type){case x.Sequence:return new Bt({value:o,name:""});case x.Set:return new Pt({value:o,name:""});case x.Choice:return new ks({value:o,name:""});default:throw new Error("Unsupported ASN1 type in use")}}set(e,t){return this.items.set(e,t),this}findParentSchema(e){let t=Object.getPrototypeOf(e);return t?this.items.get(t)||this.findParentSchema(t):null}};var qe=new $f;var _=r=>e=>{let t;qe.has(e)?t=qe.get(e):(t=qe.createDefault(e),qe.set(e,t)),Object.assign(t,r)};var l=r=>(e,t)=>{let n;qe.has(e.constructor)?n=qe.get(e.constructor):(n=qe.createDefault(e.constructor),qe.set(e.constructor,n));let o=Object.assign({},r);if(typeof o.type=="number"&&!o.converter){let i=so(r.type);if(!i)throw new Error(`Cannot get default converter for property '${t}' of ${e.constructor.name}`);o.converter=i}o.raw=r.raw,n.items[t]=o};var ao=class extends Error{constructor(){super(...arguments),this.schemas=[]}};var kc=class{static parse(e,t){let n=Sn(e);if(n.result.error)throw new Error(n.result.error);return this.fromASN(n.result,t)}static fromASN(e,t){try{if(ar(t))return new t().fromASN(e);let n=qe.get(t);qe.cache(t);let o=n.schema,i=this.handleChoiceTypes(e,n,t,o);if(i?.result)return i.result;i?.targetSchema&&(o=i.targetSchema);let s=this.handleSequenceTypes(e,n,t,o);if(s&&"isManualMapping"in s)return s.result;let a=s,c=new t;return Lm(t)?this.handleArrayTypes(e,n,t):(this.processSchemaItems(n,a,c),c)}catch(n){throw n instanceof ao&&n.schemas.push(t.name),n}}static handleChoiceTypes(e,t,n,o){if(e.constructor===Qe&&t.type===x.Choice&&e.idBlock.tagClass===3)for(let i in t.items){let s=t.items[i];if(s.context===e.idBlock.tagNumber&&s.implicit&&typeof s.type=="function"&&qe.has(s.type)){let a=qe.get(s.type);if(a&&a.type===x.Sequence){let c=new Bt;if("value"in e.valueBlock&&Array.isArray(e.valueBlock.value)&&"value"in c.valueBlock){c.valueBlock.value=e.valueBlock.value;let f=this.fromASN(c,s.type),p=new n;return p[i]=f,{result:p}}}}}else if(e.constructor===Qe&&t.type!==x.Choice){let i=new Qe({idBlock:{tagClass:3,tagNumber:e.idBlock.tagNumber},value:t.schema.valueBlock.value});for(let s in t.items)delete e[s];return{targetSchema:i}}return null}static handleSequenceTypes(e,t,n,o){if(t.type===x.Sequence){if(Object.keys(t.items).filter(a=>{let c=t.items[a];return c.optional&&typeof c.type=="function"&&qe.has(c.type)&&qe.get(c.type).type===x.Choice}).length>0&&"value"in e.valueBlock&&Array.isArray(e.valueBlock.value)&&n.name==="CertReqMsg")return this.handleManualMapping(e,t,n);let s=bn({},e,o);if(!s.verified)throw new ao(`Data does not match to ${n.name} ASN1 schema.${s.result.error?` ${s.result.error}`:""}`);return s}else{let i=bn({},e,o);if(!i.verified)throw new ao(`Data does not match to ${n.name} ASN1 schema.${i.result.error?` ${i.result.error}`:""}`);return i}}static handleManualMapping(e,t,n){let o=new n,i=e.valueBlock.value,s=Object.keys(t.items),a=0;for(let c=0;c<s.length;c++){let f=s[c],p=t.items[f];if(a>=i.length)break;if(p.repeated){o[f]=this.processRepeatedField(i,a,p);break}else if(typeof p.type=="number")o[f]=this.processPrimitiveField(i[a],p),a++;else if(this.isOptionalChoiceField(p)){let h=this.processOptionalChoiceField(i[a],p);h.processed&&(o[f]=h.value,a++)}else o[f]=this.fromASN(i[a],p.type),a++}return{result:o,verified:!0,isManualMapping:!0}}static processRepeatedField(e,t,n){let o=e.slice(t);if(o.length===1&&o[0].constructor.name==="Sequence"){let i=o[0];i.valueBlock&&i.valueBlock.value&&Array.isArray(i.valueBlock.value)&&(o=i.valueBlock.value)}if(typeof n.type=="number"){let i=so(n.type);if(!i)throw new Error(`No converter for ASN.1 type ${n.type}`);return o.filter(s=>s&&s.valueBlock).map(s=>{try{return i.fromASN(s)}catch{return}}).filter(s=>s!==void 0)}else return o.filter(i=>i&&i.valueBlock).map(i=>{try{return this.fromASN(i,n.type)}catch{return}}).filter(i=>i!==void 0)}static processPrimitiveField(e,t){let n=so(t.type);if(!n)throw new Error(`No converter for ASN.1 type ${t.type}`);return n.fromASN(e)}static isOptionalChoiceField(e){return e.optional&&typeof e.type=="function"&&qe.has(e.type)&&qe.get(e.type).type===x.Choice}static processOptionalChoiceField(e,t){try{return{processed:!0,value:this.fromASN(e,t.type)}}catch(n){if(n instanceof ao&&/Wrong values for Choice type/.test(n.message))return{processed:!1};throw n}}static handleArrayTypes(e,t,n){if(!("value"in e.valueBlock&&Array.isArray(e.valueBlock.value)))throw new Error("Cannot get items from the ASN.1 parsed value. ASN.1 object is not constructed.");let o=t.itemType;if(typeof o=="number"){let i=so(o);if(!i)throw new Error(`Cannot get default converter for array item of ${n.name} ASN1 schema`);return n.from(e.valueBlock.value,s=>i.fromASN(s))}else return n.from(e.valueBlock.value,i=>this.fromASN(i,o))}static processSchemaItems(e,t,n){for(let o in e.items){let i=t.result[o];if(!i)continue;let s=e.items[o],a=s.type,c;typeof a=="number"||ar(a)?c=this.processPrimitiveSchemaItem(i,s,a):c=this.processComplexSchemaItem(i,s,a),c&&typeof c=="object"&&"value"in c&&"raw"in c?(n[o]=c.value,n[`${o}Raw`]=c.raw):n[o]=c}}static processPrimitiveSchemaItem(e,t,n){var o;let i=(o=t.converter)!==null&&o!==void 0?o:ar(n)?new n:null;if(!i)throw new Error("Converter is empty");return t.repeated?this.processRepeatedPrimitiveItem(e,t,i):this.processSinglePrimitiveItem(e,t,n,i)}static processRepeatedPrimitiveItem(e,t,n){if(t.implicit){let o=t.repeated==="sequence"?Bt:Pt,i=new o;i.valueBlock=e.valueBlock;let s=Sn(i.toBER(!1));if(s.offset===-1)throw new Error(`Cannot parse the child item. ${s.result.error}`);if(!("value"in s.result.valueBlock&&Array.isArray(s.result.valueBlock.value)))throw new Error("Cannot get items from the ASN.1 parsed value. ASN.1 object is not constructed.");let a=s.result.valueBlock.value;return Array.from(a,c=>n.fromASN(c))}else return Array.from(e,o=>n.fromASN(o))}static processSinglePrimitiveItem(e,t,n,o){let i=e;if(t.implicit){let s;if(ar(n))s=new n().toSchema("");else{let a=d[n],c=Wr[a];if(!c)throw new Error(`Cannot get '${a}' class from asn1js module`);s=new c}s.valueBlock=i.valueBlock,i=Sn(s.toBER(!1)).result}return o.fromASN(i)}static processComplexSchemaItem(e,t,n){if(t.repeated){if(!Array.isArray(e))throw new Error("Cannot get list of items from the ASN.1 parsed value. ASN.1 value should be iterable.");return Array.from(e,o=>this.fromASN(o,n))}else{let o=this.handleImplicitTagging(e,t,n);if(this.isOptionalChoiceField(t))try{return this.fromASN(o,n)}catch(i){if(i instanceof ao&&/Wrong values for Choice type/.test(i.message))return;throw i}else{let i=this.fromASN(o,n);return t.raw?{value:i,raw:e.valueBeforeDecodeView}:i}}}static handleImplicitTagging(e,t,n){if(t.implicit&&typeof t.context=="number"){let o=qe.get(n);if(o.type===x.Sequence){let i=new Bt;if("value"in e.valueBlock&&Array.isArray(e.valueBlock.value)&&"value"in i.valueBlock)return i.valueBlock.value=e.valueBlock.value,i}else if(o.type===x.Set){let i=new Pt;if("value"in e.valueBlock&&Array.isArray(e.valueBlock.value)&&"value"in i.valueBlock)return i.valueBlock.value=e.valueBlock.value,i}}return e}};var Oc=class r{static serialize(e){return e instanceof Je?e.toBER(!1):this.toASN(e).toBER(!1)}static toASN(e){if(e&&typeof e=="object"&&ar(e))return e.toASN();if(!(e&&typeof e=="object"))throw new TypeError("Parameter 1 should be type of Object.");let t=e.constructor,n=qe.get(t);qe.cache(t);let o=[];if(n.itemType){if(!Array.isArray(e))throw new TypeError("Parameter 1 should be type of Array.");if(typeof n.itemType=="number"){let s=so(n.itemType);if(!s)throw new Error(`Cannot get default converter for array item of ${t.name} ASN1 schema`);o=e.map(a=>s.toASN(a))}else o=e.map(s=>this.toAsnItem({type:n.itemType},"[]",t,s))}else for(let s in n.items){let a=n.items[s],c=e[s];if(c===void 0||a.defaultValue===c||typeof a.defaultValue=="object"&&typeof c=="object"&&$x(this.serialize(a.defaultValue),this.serialize(c)))continue;let f=r.toAsnItem(a,s,t,c);if(typeof a.context=="number")if(a.implicit)if(!a.repeated&&(typeof a.type=="number"||ar(a.type))){let p={};p.valueHex=f instanceof _r?f.valueBeforeDecodeView:f.valueBlock.toBER(),o.push(new xn({optional:a.optional,idBlock:{tagClass:3,tagNumber:a.context},...p}))}else o.push(new Qe({optional:a.optional,idBlock:{tagClass:3,tagNumber:a.context},value:f.valueBlock.value}));else o.push(new Qe({optional:a.optional,idBlock:{tagClass:3,tagNumber:a.context},value:[f]}));else a.repeated?o=o.concat(f):o.push(f)}let i;switch(n.type){case x.Sequence:i=new Bt({value:o});break;case x.Set:i=new Pt({value:o});break;case x.Choice:if(!o[0])throw new Error(`Schema '${t.name}' has wrong data. Choice cannot be empty.`);i=o[0];break}return i}static toAsnItem(e,t,n,o){let i;if(typeof e.type=="number"){let s=e.converter;if(!s)throw new Error(`Property '${t}' doesn't have converter for type ${d[e.type]} in schema '${n.name}'`);if(e.repeated){if(!Array.isArray(o))throw new TypeError("Parameter 'objProp' should be type of Array.");let a=Array.from(o,f=>s.toASN(f)),c=e.repeated==="sequence"?Bt:Pt;i=new c({value:a})}else i=s.toASN(o)}else if(e.repeated){if(!Array.isArray(o))throw new TypeError("Parameter 'objProp' should be type of Array.");let s=Array.from(o,c=>this.toASN(c)),a=e.repeated==="sequence"?Bt:Pt;i=new a({value:s})}else i=this.toASN(o);return i}};var oe=class extends Array{constructor(e=[]){if(typeof e=="number")super(e);else{super();for(let t of e)this.push(t)}}};var Um=Rr(gn());var F=class r{static serialize(e){return Oc.serialize(e)}static parse(e,t){return kc.parse(e,t)}static toString(e){let t=Um.BufferSourceConverter.isBufferSource(e)?Um.BufferSourceConverter.toArrayBuffer(e):r.serialize(e),n=Sn(t);if(n.offset===-1)throw new Error(`Cannot decode ASN.1 data. ${n.result.error}`);return n.result.toString()}};function u(r,e,t,n){var o=arguments.length,i=o<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")i=Reflect.decorate(r,e,t,n);else for(var a=r.length-1;a>=0;a--)(s=r[a])&&(i=(o<3?s(i):o>3?s(e,t,i):s(e,t))||i);return o>3&&i&&Object.defineProperty(e,t,i),i}function he(r,e,t,n){if(t==="a"&&!n)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?r!==e||!n:!e.has(r))throw new TypeError("Cannot read private member from an object whose class did not declare it");return t==="m"?n:t==="a"?n.call(r):n?n.value:e.get(r)}function Me(r,e,t,n,o){if(n==="m")throw new TypeError("Private method is not writable");if(n==="a"&&!o)throw new TypeError("Private accessor was defined without a setter");if(typeof e=="function"?r!==e||!o:!e.has(r))throw new TypeError("Cannot write private member to an object whose class did not declare it");return n==="a"?o.call(r,t):o?o.value=t:e.set(r,t),t}var Fx=Rr(gn()),Pc=class{static isIPv4(e){return/^(\d{1,3}\.){3}\d{1,3}$/.test(e)}static parseIPv4(e){let t=e.split(".");if(t.length!==4)throw new Error("Invalid IPv4 address");return t.map(n=>{let o=parseInt(n,10);if(isNaN(o)||o<0||o>255)throw new Error("Invalid IPv4 address part");return o})}static parseIPv6(e){let n=this.expandIPv6(e).split(":");if(n.length!==8)throw new Error("Invalid IPv6 address");return n.reduce((o,i)=>{let s=parseInt(i,16);if(isNaN(s)||s<0||s>65535)throw new Error("Invalid IPv6 address part");return o.push(s>>8&255),o.push(s&255),o},[])}static expandIPv6(e){if(!e.includes("::"))return e;let t=e.split("::");if(t.length>2)throw new Error("Invalid IPv6 address");let n=t[0]?t[0].split(":"):[],o=t[1]?t[1].split(":"):[],i=8-(n.length+o.length);if(i<0)throw new Error("Invalid IPv6 address");return[...n,...Array(i).fill("0"),...o].join(":")}static formatIPv6(e){let t=[];for(let n=0;n<16;n+=2)t.push((e[n]<<8|e[n+1]).toString(16));return this.compressIPv6(t.join(":"))}static compressIPv6(e){let t=e.split(":"),n=-1,o=0,i=-1,s=0;for(let a=0;a<t.length;a++)t[a]==="0"?(i===-1&&(i=a),s++):(s>o&&(n=i,o=s),i=-1,s=0);if(s>o&&(n=i,o=s),o>1){let a=t.slice(0,n).join(":"),c=t.slice(n+o).join(":");return`${a}::${c}`}return e}static parseCIDR(e){let[t,n]=e.split("/"),o=parseInt(n,10);if(this.isIPv4(t)){if(o<0||o>32)throw new Error("Invalid IPv4 prefix length");return[this.parseIPv4(t),o]}else{if(o<0||o>128)throw new Error("Invalid IPv6 prefix length");return[this.parseIPv6(t),o]}}static decodeIP(e){if(e.length===64&&parseInt(e,16)===0)return"::/0";if(e.length!==16)return e;let t=parseInt(e.slice(8),16).toString(2).split("").reduce((o,i)=>o+ +i,0),n=e.slice(0,8).replace(/(.{2})/g,o=>`${parseInt(o,16)}.`);return n=n.slice(0,-1),`${n}/${t}`}static toString(e){let t=new Uint8Array(e);if(t.length===4)return Array.from(t).join(".");if(t.length===16)return this.formatIPv6(t);if(t.length===8||t.length===32){let n=t.length/2,o=t.slice(0,n),i=t.slice(n);if(t.every(c=>c===0))return t.length===8?"0.0.0.0/0":"::/0";let a=i.reduce((c,f)=>c+(f.toString(2).match(/1/g)||[]).length,0);return t.length===8?`${Array.from(o).join(".")}/${a}`:`${this.formatIPv6(o)}/${a}`}return this.decodeIP(Fx.Convert.ToHex(e))}static fromString(e){if(e.includes("/")){let[n,o]=this.parseCIDR(e),i=new Uint8Array(n.length),s=o;for(let c=0;c<i.length;c++)s>=8?(i[c]=255,s-=8):s>0&&(i[c]=255<<8-s,s=0);let a=new Uint8Array(n.length*2);return a.set(n,0),a.set(i,n.length),a.buffer}let t=this.isIPv4(e)?this.parseIPv4(e):this.parseIPv6(e);return new Uint8Array(t).buffer}};var Wx=Rr(gn()),Mm,jm,Km,et=class{constructor(e={}){Object.assign(this,e)}toString(){return this.bmpString||this.printableString||this.teletexString||this.universalString||this.utf8String||""}};u([l({type:d.TeletexString})],et.prototype,"teletexString",void 0);u([l({type:d.PrintableString})],et.prototype,"printableString",void 0);u([l({type:d.UniversalString})],et.prototype,"universalString",void 0);u([l({type:d.Utf8String})],et.prototype,"utf8String",void 0);u([l({type:d.BmpString})],et.prototype,"bmpString",void 0);et=u([_({type:x.Choice})],et);var Ns=class extends et{constructor(e={}){super(e),Object.assign(this,e)}toString(){return this.ia5String||(this.anyValue?Wx.Convert.ToHex(this.anyValue):super.toString())}};u([l({type:d.IA5String})],Ns.prototype,"ia5String",void 0);u([l({type:d.Any})],Ns.prototype,"anyValue",void 0);Ns=u([_({type:x.Choice})],Ns);var di=class{constructor(e={}){this.type="",this.value=new Ns,Object.assign(this,e)}};u([l({type:d.ObjectIdentifier})],di.prototype,"type",void 0);u([l({type:Ns})],di.prototype,"value",void 0);var co=Mm=class extends oe{constructor(e){super(e),Object.setPrototypeOf(this,Mm.prototype)}};co=Mm=u([_({type:x.Set,itemType:di})],co);var Hm=jm=class extends oe{constructor(e){super(e),Object.setPrototypeOf(this,jm.prototype)}};Hm=jm=u([_({type:x.Sequence,itemType:co})],Hm);var Oe=Km=class extends Hm{constructor(e){super(e),Object.setPrototypeOf(this,Km.prototype)}};Oe=Km=u([_({type:x.Sequence})],Oe);var jC={fromASN:r=>Pc.toString(Ps.fromASN(r)),toASN:r=>Ps.toASN(Pc.fromString(r))},uo=class{constructor(e={}){this.typeId="",this.value=new ArrayBuffer(0),Object.assign(this,e)}};u([l({type:d.ObjectIdentifier})],uo.prototype,"typeId",void 0);u([l({type:d.Any,context:0})],uo.prototype,"value",void 0);var Nc=class{constructor(e={}){this.partyName=new et,Object.assign(this,e)}};u([l({type:et,optional:!0,context:0,implicit:!0})],Nc.prototype,"nameAssigner",void 0);u([l({type:et,context:1,implicit:!0})],Nc.prototype,"partyName",void 0);var ae=class{constructor(e={}){Object.assign(this,e)}};u([l({type:uo,context:0,implicit:!0})],ae.prototype,"otherName",void 0);u([l({type:d.IA5String,context:1,implicit:!0})],ae.prototype,"rfc822Name",void 0);u([l({type:d.IA5String,context:2,implicit:!0})],ae.prototype,"dNSName",void 0);u([l({type:d.Any,context:3,implicit:!0})],ae.prototype,"x400Address",void 0);u([l({type:Oe,context:4,implicit:!1})],ae.prototype,"directoryName",void 0);u([l({type:Nc,context:5})],ae.prototype,"ediPartyName",void 0);u([l({type:d.IA5String,context:6,implicit:!0})],ae.prototype,"uniformResourceIdentifier",void 0);u([l({type:d.OctetString,context:7,implicit:!0,converter:jC})],ae.prototype,"iPAddress",void 0);u([l({type:d.ObjectIdentifier,context:8,implicit:!0})],ae.prototype,"registeredID",void 0);ae=u([_({type:x.Choice})],ae);var lo="1.3.6.1.5.5.7",fo=`${lo}.1`,qx=`${lo}.2`,mi=`${lo}.3`,Ff=`${lo}.48`,C3=`${qx}.1`,B3=`${qx}.2`,Vm=`${Ff}.1`,$m=`${Ff}.2`,Fm=`${Ff}.3`,Wm=`${Ff}.5`,le="2.5.29";var qm,Wf=`${fo}.1`,En=class{constructor(e={}){this.accessMethod="",this.accessLocation=new ae,Object.assign(this,e)}};u([l({type:d.ObjectIdentifier})],En.prototype,"accessMethod",void 0);u([l({type:ae})],En.prototype,"accessLocation",void 0);var yi=qm=class extends oe{constructor(e){super(e),Object.setPrototypeOf(this,qm.prototype)}};yi=qm=u([_({type:x.Sequence,itemType:En})],yi);var qf=`${le}.35`,gi=class extends ie{},Gr=class{constructor(e={}){e&&Object.assign(this,e)}};u([l({type:gi,context:0,optional:!0,implicit:!0})],Gr.prototype,"keyIdentifier",void 0);u([l({type:ae,context:1,optional:!0,implicit:!0,repeated:"sequence"})],Gr.prototype,"authorityCertIssuer",void 0);u([l({type:d.Integer,context:2,optional:!0,implicit:!0,converter:ge})],Gr.prototype,"authorityCertSerialNumber",void 0);var Gf=`${le}.19`,bi=class{constructor(e={}){this.cA=!1,Object.assign(this,e)}};u([l({type:d.Boolean,defaultValue:!1})],bi.prototype,"cA",void 0);u([l({type:d.Integer,optional:!0})],bi.prototype,"pathLenConstraint",void 0);var Gm,je=Gm=class extends oe{constructor(e){super(e),Object.setPrototypeOf(this,Gm.prototype)}};je=Gm=u([_({type:x.Sequence,itemType:ae})],je);var zm,KC=`${le}.29`,Gx=zm=class extends je{constructor(e){super(e),Object.setPrototypeOf(this,zm.prototype)}};Gx=zm=u([_({type:x.Sequence})],Gx);var Xm,Xf=`${le}.32`,iD=`${Xf}.0`,_n=class{constructor(e={}){Object.assign(this,e)}toString(){return this.ia5String||this.visibleString||this.bmpString||this.utf8String||""}};u([l({type:d.IA5String})],_n.prototype,"ia5String",void 0);u([l({type:d.VisibleString})],_n.prototype,"visibleString",void 0);u([l({type:d.BmpString})],_n.prototype,"bmpString",void 0);u([l({type:d.Utf8String})],_n.prototype,"utf8String",void 0);_n=u([_({type:x.Choice})],_n);var Dc=class{constructor(e={}){this.organization=new _n,this.noticeNumbers=[],Object.assign(this,e)}};u([l({type:_n})],Dc.prototype,"organization",void 0);u([l({type:d.Integer,repeated:"sequence"})],Dc.prototype,"noticeNumbers",void 0);var Rc=class{constructor(e={}){Object.assign(this,e)}};u([l({type:Dc,optional:!0})],Rc.prototype,"noticeRef",void 0);u([l({type:_n,optional:!0})],Rc.prototype,"explicitText",void 0);var zf=class{constructor(e={}){Object.assign(this,e)}};u([l({type:d.IA5String})],zf.prototype,"cPSuri",void 0);u([l({type:Rc})],zf.prototype,"userNotice",void 0);zf=u([_({type:x.Choice})],zf);var Lc=class{constructor(e={}){this.policyQualifierId="",this.qualifier=new ArrayBuffer(0),Object.assign(this,e)}};u([l({type:d.ObjectIdentifier})],Lc.prototype,"policyQualifierId",void 0);u([l({type:d.Any})],Lc.prototype,"qualifier",void 0);var wi=class{constructor(e={}){this.policyIdentifier="",Object.assign(this,e)}};u([l({type:d.ObjectIdentifier})],wi.prototype,"policyIdentifier",void 0);u([l({type:Lc,repeated:"sequence",optional:!0})],wi.prototype,"policyQualifiers",void 0);var Uc=Xm=class extends oe{constructor(e){super(e),Object.setPrototypeOf(this,Xm.prototype)}};Uc=Xm=u([_({type:x.Sequence,itemType:wi})],Uc);var pD=`${le}.20`,Mc=class{constructor(e=0){this.value=e}};u([l({type:d.Integer})],Mc.prototype,"value",void 0);Mc=u([_({type:x.Choice})],Mc);var xD=`${le}.27`,zx=class extends Mc{};zx=u([_({type:x.Choice})],zx);var Zm,Zf=`${le}.31`,Tr;(function(r){r[r.unused=1]="unused",r[r.keyCompromise=2]="keyCompromise",r[r.cACompromise=4]="cACompromise",r[r.affiliationChanged=8]="affiliationChanged",r[r.superseded=16]="superseded",r[r.cessationOfOperation=32]="cessationOfOperation",r[r.certificateHold=64]="certificateHold",r[r.privilegeWithdrawn=128]="privilegeWithdrawn",r[r.aACompromise=256]="aACompromise"})(Tr||(Tr={}));var jc=class extends qr{toJSON(){let e=[],t=this.toNumber();return t&Tr.aACompromise&&e.push("aACompromise"),t&Tr.affiliationChanged&&e.push("affiliationChanged"),t&Tr.cACompromise&&e.push("cACompromise"),t&Tr.certificateHold&&e.push("certificateHold"),t&Tr.cessationOfOperation&&e.push("cessationOfOperation"),t&Tr.keyCompromise&&e.push("keyCompromise"),t&Tr.privilegeWithdrawn&&e.push("privilegeWithdrawn"),t&Tr.superseded&&e.push("superseded"),t&Tr.unused&&e.push("unused"),e}toString(){return`[${this.toJSON().join(", ")}]`}},Cn=class{constructor(e={}){Object.assign(this,e)}};u([l({type:ae,context:0,repeated:"sequence",implicit:!0})],Cn.prototype,"fullName",void 0);u([l({type:co,context:1,implicit:!0})],Cn.prototype,"nameRelativeToCRLIssuer",void 0);Cn=u([_({type:x.Choice})],Cn);var zr=class{constructor(e={}){Object.assign(this,e)}};u([l({type:Cn,context:0,optional:!0})],zr.prototype,"distributionPoint",void 0);u([l({type:jc,context:1,optional:!0,implicit:!0})],zr.prototype,"reasons",void 0);u([l({type:ae,context:2,optional:!0,repeated:"sequence",implicit:!0})],zr.prototype,"cRLIssuer",void 0);var ho=Zm=class extends oe{constructor(e){super(e),Object.setPrototypeOf(this,Zm.prototype)}};ho=Zm=u([_({type:x.Sequence,itemType:zr})],ho);var Ym,RD=`${le}.46`,Xx=Ym=class extends ho{constructor(e){super(e),Object.setPrototypeOf(this,Ym.prototype)}};Xx=Ym=u([_({type:x.Sequence,itemType:zr})],Xx);var $D=`${le}.28`,Zt=class r{constructor(e={}){this.onlyContainsUserCerts=r.ONLY,this.onlyContainsCACerts=r.ONLY,this.indirectCRL=r.ONLY,this.onlyContainsAttributeCerts=r.ONLY,Object.assign(this,e)}};Zt.ONLY=!1;u([l({type:Cn,context:0,optional:!0})],Zt.prototype,"distributionPoint",void 0);u([l({type:d.Boolean,context:1,defaultValue:Zt.ONLY,implicit:!0})],Zt.prototype,"onlyContainsUserCerts",void 0);u([l({type:d.Boolean,context:2,defaultValue:Zt.ONLY,implicit:!0})],Zt.prototype,"onlyContainsCACerts",void 0);u([l({type:jc,context:3,optional:!0,implicit:!0})],Zt.prototype,"onlySomeReasons",void 0);u([l({type:d.Boolean,context:4,defaultValue:Zt.ONLY,implicit:!0})],Zt.prototype,"indirectCRL",void 0);u([l({type:d.Boolean,context:5,defaultValue:Zt.ONLY,implicit:!0})],Zt.prototype,"onlyContainsAttributeCerts",void 0);var Zx=`${le}.21`,Kc;(function(r){r[r.unspecified=0]="unspecified",r[r.keyCompromise=1]="keyCompromise",r[r.cACompromise=2]="cACompromise",r[r.affiliationChanged=3]="affiliationChanged",r[r.superseded=4]="superseded",r[r.cessationOfOperation=5]="cessationOfOperation",r[r.certificateHold=6]="certificateHold",r[r.removeFromCRL=8]="removeFromCRL",r[r.privilegeWithdrawn=9]="privilegeWithdrawn",r[r.aACompromise=10]="aACompromise"})(Kc||(Kc={}));var Hc=class{constructor(e=Kc.unspecified){this.reason=Kc.unspecified,this.reason=e}toJSON(){return Kc[this.reason]}toString(){return this.toJSON()}};u([l({type:d.Enumerated})],Hc.prototype,"reason",void 0);Hc=u([_({type:x.Choice})],Hc);var Jm,Yf=`${le}.37`,Vc=Jm=class extends oe{constructor(e){super(e),Object.setPrototypeOf(this,Jm.prototype)}};Vc=Jm=u([_({type:x.Sequence,itemType:d.ObjectIdentifier})],Vc);var eR=`${Yf}.0`,Yx=`${mi}.1`,Jx=`${mi}.2`,Qx=`${mi}.3`,ev=`${mi}.4`,tv=`${mi}.8`,rv=`${mi}.9`;var iR=`${le}.54`,Qm=class{constructor(e=new ArrayBuffer(0)){this.value=e}};u([l({type:d.Integer,converter:ge})],Qm.prototype,"value",void 0);Qm=u([_({type:x.Choice})],Qm);var nv=`${le}.24`,$c=class{constructor(e){this.value=new Date,e&&(this.value=e)}};u([l({type:d.GeneralizedTime})],$c.prototype,"value",void 0);$c=u([_({type:x.Choice})],$c);var ey,ty=`${le}.18`,ov=ey=class extends je{constructor(e){super(e),Object.setPrototypeOf(this,ey.prototype)}};ov=ey=u([_({type:x.Sequence})],ov);var Jf=`${le}.15`,kr;(function(r){r[r.digitalSignature=1]="digitalSignature",r[r.nonRepudiation=2]="nonRepudiation",r[r.keyEncipherment=4]="keyEncipherment",r[r.dataEncipherment=8]="dataEncipherment",r[r.keyAgreement=16]="keyAgreement",r[r.keyCertSign=32]="keyCertSign",r[r.cRLSign=64]="cRLSign",r[r.encipherOnly=128]="encipherOnly",r[r.decipherOnly=256]="decipherOnly"})(kr||(kr={}));var Ds=class extends qr{toJSON(){let e=this.toNumber(),t=[];return e&kr.cRLSign&&t.push("crlSign"),e&kr.dataEncipherment&&t.push("dataEncipherment"),e&kr.decipherOnly&&t.push("decipherOnly"),e&kr.digitalSignature&&t.push("digitalSignature"),e&kr.encipherOnly&&t.push("encipherOnly"),e&kr.keyAgreement&&t.push("keyAgreement"),e&kr.keyCertSign&&t.push("keyCertSign"),e&kr.keyEncipherment&&t.push("keyEncipherment"),e&kr.nonRepudiation&&t.push("nonRepudiation"),t}toString(){return`[${this.toJSON().join(", ")}]`}};var ry,CR=`${le}.30`,Rs=class{constructor(e={}){this.base=new ae,this.minimum=0,Object.assign(this,e)}};u([l({type:ae})],Rs.prototype,"base",void 0);u([l({type:d.Integer,context:0,defaultValue:0,implicit:!0})],Rs.prototype,"minimum",void 0);u([l({type:d.Integer,context:1,optional:!0,implicit:!0})],Rs.prototype,"maximum",void 0);var Qf=ry=class extends oe{constructor(e){super(e),Object.setPrototypeOf(this,ry.prototype)}};Qf=ry=u([_({type:x.Sequence,itemType:Rs})],Qf);var eh=class{constructor(e={}){Object.assign(this,e)}};u([l({type:Qf,context:0,optional:!0,implicit:!0})],eh.prototype,"permittedSubtrees",void 0);u([l({type:Qf,context:1,optional:!0,implicit:!0})],eh.prototype,"excludedSubtrees",void 0);var PR=`${le}.36`,th=class{constructor(e={}){Object.assign(this,e)}};u([l({type:d.Integer,context:0,implicit:!0,optional:!0,converter:ge})],th.prototype,"requireExplicitPolicy",void 0);u([l({type:d.Integer,context:1,implicit:!0,optional:!0,converter:ge})],th.prototype,"inhibitPolicyMapping",void 0);var ny,UR=`${le}.33`,Fc=class{constructor(e={}){this.issuerDomainPolicy="",this.subjectDomainPolicy="",Object.assign(this,e)}};u([l({type:d.ObjectIdentifier})],Fc.prototype,"issuerDomainPolicy",void 0);u([l({type:d.ObjectIdentifier})],Fc.prototype,"subjectDomainPolicy",void 0);var iv=ny=class extends oe{constructor(e){super(e),Object.setPrototypeOf(this,ny.prototype)}};iv=ny=u([_({type:x.Sequence,itemType:Fc})],iv);var oy,iy=`${le}.17`,rh=oy=class extends je{constructor(e){super(e),Object.setPrototypeOf(this,oy.prototype)}};rh=oy=u([_({type:x.Sequence})],rh);var mt=class{constructor(e={}){this.type="",this.values=[],Object.assign(this,e)}};u([l({type:d.ObjectIdentifier})],mt.prototype,"type",void 0);u([l({type:d.Any,repeated:"set"})],mt.prototype,"values",void 0);var sy,QR=`${le}.9`,sv=sy=class extends oe{constructor(e){super(e),Object.setPrototypeOf(this,sy.prototype)}};sv=sy=u([_({type:x.Sequence,itemType:mt})],sv);var ay=`${le}.14`,Ht=class extends gi{};var cL=`${le}.16`,nh=class{constructor(e={}){Object.assign(this,e)}};u([l({type:d.GeneralizedTime,context:0,implicit:!0,optional:!0})],nh.prototype,"notBefore",void 0);u([l({type:d.GeneralizedTime,context:1,implicit:!0,optional:!0})],nh.prototype,"notAfter",void 0);var Wc;(function(r){r[r.keyUpdateAllowed=1]="keyUpdateAllowed",r[r.newExtensions=2]="newExtensions",r[r.pKIXCertificate=4]="pKIXCertificate"})(Wc||(Wc={}));var oh=class extends qr{toJSON(){let e=[],t=this.toNumber();return t&Wc.pKIXCertificate&&e.push("pKIXCertificate"),t&Wc.newExtensions&&e.push("newExtensions"),t&Wc.keyUpdateAllowed&&e.push("keyUpdateAllowed"),e}toString(){return`[${this.toJSON().join(", ")}]`}},ih=class{constructor(e={}){this.entrustVers="",this.entrustInfoFlags=new oh,Object.assign(this,e)}};u([l({type:d.GeneralString})],ih.prototype,"entrustVers",void 0);u([l({type:oh})],ih.prototype,"entrustInfoFlags",void 0);var cy,gL=`${fo}.11`,av=cy=class extends oe{constructor(e){super(e),Object.setPrototypeOf(this,cy.prototype)}};av=cy=u([_({type:x.Sequence,itemType:En})],av);var cv=Rr(gn()),j=class r{constructor(e={}){this.algorithm="",Object.assign(this,e)}isEqual(e){return e instanceof r&&e.algorithm==this.algorithm&&(e.parameters&&this.parameters&&cv.isEqual(e.parameters,this.parameters)||e.parameters===this.parameters)}};u([l({type:d.ObjectIdentifier})],j.prototype,"algorithm",void 0);u([l({type:d.Any,optional:!0})],j.prototype,"parameters",void 0);var yt=class{constructor(e={}){this.algorithm=new j,this.subjectPublicKey=new ArrayBuffer(0),Object.assign(this,e)}};u([l({type:j})],yt.prototype,"algorithm",void 0);u([l({type:d.BitString})],yt.prototype,"subjectPublicKey",void 0);var Ge=class{constructor(e){if(e)if(typeof e=="string"||typeof e=="number"||e instanceof Date){let t=new Date(e);t.getUTCFullYear()>2049?this.generalTime=t:this.utcTime=t}else Object.assign(this,e)}getTime(){let e=this.utcTime||this.generalTime;if(!e)throw new Error("Cannot get time from CHOICE object");return e}};u([l({type:d.UTCTime})],Ge.prototype,"utcTime",void 0);u([l({type:d.GeneralizedTime})],Ge.prototype,"generalTime",void 0);Ge=u([_({type:x.Choice})],Ge);var Bn=class{constructor(e){this.notBefore=new Ge(new Date),this.notAfter=new Ge(new Date),e&&(this.notBefore=new Ge(e.notBefore),this.notAfter=new Ge(e.notAfter))}};u([l({type:Ge})],Bn.prototype,"notBefore",void 0);u([l({type:Ge})],Bn.prototype,"notAfter",void 0);var uy,gt=class r{constructor(e={}){this.extnID="",this.critical=r.CRITICAL,this.extnValue=new ie,Object.assign(this,e)}};gt.CRITICAL=!1;u([l({type:d.ObjectIdentifier})],gt.prototype,"extnID",void 0);u([l({type:d.Boolean,defaultValue:gt.CRITICAL})],gt.prototype,"critical",void 0);u([l({type:ie})],gt.prototype,"extnValue",void 0);var Yt=uy=class extends oe{constructor(e){super(e),Object.setPrototypeOf(this,uy.prototype)}};Yt=uy=u([_({type:x.Sequence,itemType:gt})],Yt);var Xr;(function(r){r[r.v1=0]="v1",r[r.v2=1]="v2",r[r.v3=2]="v3"})(Xr||(Xr={}));var bt=class{constructor(e={}){this.version=Xr.v1,this.serialNumber=new ArrayBuffer(0),this.signature=new j,this.issuer=new Oe,this.validity=new Bn,this.subject=new Oe,this.subjectPublicKeyInfo=new yt,Object.assign(this,e)}};u([l({type:d.Integer,context:0,defaultValue:Xr.v1})],bt.prototype,"version",void 0);u([l({type:d.Integer,converter:ge})],bt.prototype,"serialNumber",void 0);u([l({type:j})],bt.prototype,"signature",void 0);u([l({type:Oe})],bt.prototype,"issuer",void 0);u([l({type:Bn})],bt.prototype,"validity",void 0);u([l({type:Oe})],bt.prototype,"subject",void 0);u([l({type:yt})],bt.prototype,"subjectPublicKeyInfo",void 0);u([l({type:d.BitString,context:1,implicit:!0,optional:!0})],bt.prototype,"issuerUniqueID",void 0);u([l({type:d.BitString,context:2,implicit:!0,optional:!0})],bt.prototype,"subjectUniqueID",void 0);u([l({type:Yt,context:3,optional:!0})],bt.prototype,"extensions",void 0);var cr=class{constructor(e={}){this.tbsCertificate=new bt,this.signatureAlgorithm=new j,this.signatureValue=new ArrayBuffer(0),Object.assign(this,e)}};u([l({type:bt,raw:!0})],cr.prototype,"tbsCertificate",void 0);u([l({type:j})],cr.prototype,"signatureAlgorithm",void 0);u([l({type:d.BitString})],cr.prototype,"signatureValue",void 0);var xi=class{constructor(e={}){this.userCertificate=new ArrayBuffer(0),this.revocationDate=new Ge,Object.assign(this,e)}};u([l({type:d.Integer,converter:ge})],xi.prototype,"userCertificate",void 0);u([l({type:Ge})],xi.prototype,"revocationDate",void 0);u([l({type:gt,optional:!0,repeated:"sequence"})],xi.prototype,"crlEntryExtensions",void 0);var Jt=class{constructor(e={}){this.signature=new j,this.issuer=new Oe,this.thisUpdate=new Ge,Object.assign(this,e)}};u([l({type:d.Integer,optional:!0})],Jt.prototype,"version",void 0);u([l({type:j})],Jt.prototype,"signature",void 0);u([l({type:Oe})],Jt.prototype,"issuer",void 0);u([l({type:Ge})],Jt.prototype,"thisUpdate",void 0);u([l({type:Ge,optional:!0})],Jt.prototype,"nextUpdate",void 0);u([l({type:xi,repeated:"sequence",optional:!0})],Jt.prototype,"revokedCertificates",void 0);u([l({type:gt,optional:!0,context:0,repeated:"sequence"})],Jt.prototype,"crlExtensions",void 0);var vi=class{constructor(e={}){this.tbsCertList=new Jt,this.signatureAlgorithm=new j,this.signature=new ArrayBuffer(0),Object.assign(this,e)}};u([l({type:Jt,raw:!0})],vi.prototype,"tbsCertList",void 0);u([l({type:j})],vi.prototype,"signatureAlgorithm",void 0);u([l({type:d.BitString})],vi.prototype,"signature",void 0);var H=Rr(gn());var Or=class{constructor(e={}){this.issuer=new Oe,this.serialNumber=new ArrayBuffer(0),Object.assign(this,e)}};u([l({type:Oe})],Or.prototype,"issuer",void 0);u([l({type:d.Integer,converter:ge})],Or.prototype,"serialNumber",void 0);var Ai=class{constructor(e={}){Object.assign(this,e)}};u([l({type:Ht,context:0,implicit:!0})],Ai.prototype,"subjectKeyIdentifier",void 0);u([l({type:Or})],Ai.prototype,"issuerAndSerialNumber",void 0);Ai=u([_({type:x.Choice})],Ai);var wt;(function(r){r[r.v0=0]="v0",r[r.v1=1]="v1",r[r.v2=2]="v2",r[r.v3=3]="v3",r[r.v4=4]="v4",r[r.v5=5]="v5"})(wt||(wt={}));var Si=class extends j{};Si=u([_({type:x.Sequence})],Si);var qc=class extends j{};qc=u([_({type:x.Sequence})],qc);var Vt=class extends j{};Vt=u([_({type:x.Sequence})],Vt);var Gc=class extends j{};Gc=u([_({type:x.Sequence})],Gc);var lv=class extends j{};lv=u([_({type:x.Sequence})],lv);var sh=class extends j{};sh=u([_({type:x.Sequence})],sh);var Pr=class{constructor(e={}){this.attrType="",this.attrValues=[],Object.assign(this,e)}};u([l({type:d.ObjectIdentifier})],Pr.prototype,"attrType",void 0);u([l({type:d.Any,repeated:"set"})],Pr.prototype,"attrValues",void 0);var ly,$t=class{constructor(e={}){this.version=wt.v0,this.sid=new Ai,this.digestAlgorithm=new Si,this.signatureAlgorithm=new qc,this.signature=new ie,Object.assign(this,e)}};u([l({type:d.Integer})],$t.prototype,"version",void 0);u([l({type:Ai})],$t.prototype,"sid",void 0);u([l({type:Si})],$t.prototype,"digestAlgorithm",void 0);u([l({type:Pr,repeated:"set",context:0,implicit:!0,optional:!0,raw:!0})],$t.prototype,"signedAttrs",void 0);u([l({type:qc})],$t.prototype,"signatureAlgorithm",void 0);u([l({type:ie})],$t.prototype,"signature",void 0);u([l({type:Pr,repeated:"set",context:1,implicit:!0,optional:!0})],$t.prototype,"unsignedAttrs",void 0);var zc=ly=class extends oe{constructor(e){super(e),Object.setPrototypeOf(this,ly.prototype)}};zc=ly=u([_({type:x.Set,itemType:$t})],zc);var fv=class extends Ge{};fv=u([_({type:x.Choice})],fv);var hv=class extends $t{};hv=u([_({type:x.Sequence})],hv);var Xc=class{constructor(e={}){this.acIssuer=new ae,this.acSerial=0,this.attrs=[],Object.assign(this,e)}};u([l({type:ae})],Xc.prototype,"acIssuer",void 0);u([l({type:d.Integer})],Xc.prototype,"acSerial",void 0);u([l({type:mt,repeated:"sequence"})],Xc.prototype,"attrs",void 0);var fy,Zc=fy=class extends oe{constructor(e){super(e),Object.setPrototypeOf(this,fy.prototype)}};Zc=fy=u([_({type:x.Sequence,itemType:d.ObjectIdentifier})],Zc);var Ls=class{constructor(e={}){this.permitUnSpecified=!0,Object.assign(this,e)}};u([l({type:d.Integer,optional:!0})],Ls.prototype,"pathLenConstraint",void 0);u([l({type:Zc,implicit:!0,context:0,optional:!0})],Ls.prototype,"permittedAttrs",void 0);u([l({type:Zc,implicit:!0,context:1,optional:!0})],Ls.prototype,"excludedAttrs",void 0);u([l({type:d.Boolean,defaultValue:!0})],Ls.prototype,"permitUnSpecified",void 0);var ur=class{constructor(e={}){this.issuer=new je,this.serial=new ArrayBuffer(0),this.issuerUID=new ArrayBuffer(0),Object.assign(this,e)}};u([l({type:je})],ur.prototype,"issuer",void 0);u([l({type:d.Integer,converter:ge})],ur.prototype,"serial",void 0);u([l({type:d.BitString,optional:!0})],ur.prototype,"issuerUID",void 0);var hy;(function(r){r[r.publicKey=0]="publicKey",r[r.publicKeyCert=1]="publicKeyCert",r[r.otherObjectTypes=2]="otherObjectTypes"})(hy||(hy={}));var lr=class{constructor(e={}){this.digestedObjectType=hy.publicKey,this.digestAlgorithm=new j,this.objectDigest=new ArrayBuffer(0),Object.assign(this,e)}};u([l({type:d.Enumerated})],lr.prototype,"digestedObjectType",void 0);u([l({type:d.ObjectIdentifier,optional:!0})],lr.prototype,"otherObjectTypeID",void 0);u([l({type:j})],lr.prototype,"digestAlgorithm",void 0);u([l({type:d.BitString})],lr.prototype,"objectDigest",void 0);var Ei=class{constructor(e={}){Object.assign(this,e)}};u([l({type:je,optional:!0})],Ei.prototype,"issuerName",void 0);u([l({type:ur,context:0,implicit:!0,optional:!0})],Ei.prototype,"baseCertificateID",void 0);u([l({type:lr,context:1,implicit:!0,optional:!0})],Ei.prototype,"objectDigestInfo",void 0);var _i=class{constructor(e={}){Object.assign(this,e)}};u([l({type:ae,repeated:"sequence"})],_i.prototype,"v1Form",void 0);u([l({type:Ei,context:0,implicit:!0})],_i.prototype,"v2Form",void 0);_i=u([_({type:x.Choice})],_i);var Ci=class{constructor(e={}){this.notBeforeTime=new Date,this.notAfterTime=new Date,Object.assign(this,e)}};u([l({type:d.GeneralizedTime})],Ci.prototype,"notBeforeTime",void 0);u([l({type:d.GeneralizedTime})],Ci.prototype,"notAfterTime",void 0);var po=class{constructor(e={}){Object.assign(this,e)}};u([l({type:ur,implicit:!0,context:0,optional:!0})],po.prototype,"baseCertificateID",void 0);u([l({type:je,implicit:!0,context:1,optional:!0})],po.prototype,"entityName",void 0);u([l({type:lr,implicit:!0,context:2,optional:!0})],po.prototype,"objectDigestInfo",void 0);var py;(function(r){r[r.v2=1]="v2"})(py||(py={}));var Ft=class{constructor(e={}){this.version=py.v2,this.holder=new po,this.issuer=new _i,this.signature=new j,this.serialNumber=new ArrayBuffer(0),this.attrCertValidityPeriod=new Ci,this.attributes=[],Object.assign(this,e)}};u([l({type:d.Integer})],Ft.prototype,"version",void 0);u([l({type:po})],Ft.prototype,"holder",void 0);u([l({type:_i})],Ft.prototype,"issuer",void 0);u([l({type:j})],Ft.prototype,"signature",void 0);u([l({type:d.Integer,converter:ge})],Ft.prototype,"serialNumber",void 0);u([l({type:Ci})],Ft.prototype,"attrCertValidityPeriod",void 0);u([l({type:mt,repeated:"sequence"})],Ft.prototype,"attributes",void 0);u([l({type:d.BitString,optional:!0})],Ft.prototype,"issuerUniqueID",void 0);u([l({type:Yt,optional:!0})],Ft.prototype,"extensions",void 0);var Bi=class{constructor(e={}){this.acinfo=new Ft,this.signatureAlgorithm=new j,this.signatureValue=new ArrayBuffer(0),Object.assign(this,e)}};u([l({type:Ft})],Bi.prototype,"acinfo",void 0);u([l({type:j})],Bi.prototype,"signatureAlgorithm",void 0);u([l({type:d.BitString})],Bi.prototype,"signatureValue",void 0);var Yc;(function(r){r[r.unmarked=1]="unmarked",r[r.unclassified=2]="unclassified",r[r.restricted=4]="restricted",r[r.confidential=8]="confidential",r[r.secret=16]="secret",r[r.topSecret=32]="topSecret"})(Yc||(Yc={}));var Us=class extends qr{};var Ms=class{constructor(e={}){this.type="",this.value=new ArrayBuffer(0),Object.assign(this,e)}};u([l({type:d.ObjectIdentifier,implicit:!0,context:0})],Ms.prototype,"type",void 0);u([l({type:d.Any,implicit:!0,context:1})],Ms.prototype,"value",void 0);var Jc=class{constructor(e={}){this.policyId="",this.classList=new Us(Yc.unclassified),Object.assign(this,e)}};u([l({type:d.ObjectIdentifier})],Jc.prototype,"policyId",void 0);u([l({type:Us,defaultValue:new Us(Yc.unclassified)})],Jc.prototype,"classList",void 0);u([l({type:Ms,repeated:"set"})],Jc.prototype,"securityCategories",void 0);var js=class{constructor(e={}){Object.assign(this,e)}};u([l({type:ie})],js.prototype,"cotets",void 0);u([l({type:d.ObjectIdentifier})],js.prototype,"oid",void 0);u([l({type:d.Utf8String})],js.prototype,"string",void 0);var ah=class{constructor(e={}){this.values=[],Object.assign(this,e)}};u([l({type:je,implicit:!0,context:0,optional:!0})],ah.prototype,"policyAuthority",void 0);u([l({type:js,repeated:"sequence"})],ah.prototype,"values",void 0);var Yj=`${fo}.4`,Jj=`${fo}.6`,Qj=`${fo}.10`,e9=`${le}.55`,Qc=`${lo}.10`,t9=`${Qc}.1`,r9=`${Qc}.2`,n9=`${Qc}.3`,o9=`${Qc}.4`,i9=`${Qc}.6`,dy="2.5.4",s9=`${dy}.72`;var my,Ks=class{constructor(e={}){this.targetCertificate=new ur,Object.assign(this,e)}};u([l({type:ur})],Ks.prototype,"targetCertificate",void 0);u([l({type:ae,optional:!0})],Ks.prototype,"targetName",void 0);u([l({type:lr,optional:!0})],Ks.prototype,"certDigestInfo",void 0);var Hs=class{constructor(e={}){Object.assign(this,e)}};u([l({type:ae,context:0,implicit:!0})],Hs.prototype,"targetName",void 0);u([l({type:ae,context:1,implicit:!0})],Hs.prototype,"targetGroup",void 0);u([l({type:Ks,context:2,implicit:!0})],Hs.prototype,"targetCert",void 0);Hs=u([_({type:x.Choice})],Hs);var ch=my=class extends oe{constructor(e){super(e),Object.setPrototypeOf(this,my.prototype)}};ch=my=u([_({type:x.Sequence,itemType:Hs})],ch);var yy,pv=yy=class extends oe{constructor(e){super(e),Object.setPrototypeOf(this,yy.prototype)}};pv=yy=u([_({type:x.Sequence,itemType:ch})],pv);var uh=class{constructor(e={}){Object.assign(this,e)}};u([l({type:je,implicit:!0,context:0,optional:!0})],uh.prototype,"roleAuthority",void 0);u([l({type:ae,implicit:!0,context:1})],uh.prototype,"roleName",void 0);var eu=class{constructor(e={}){this.service=new ae,this.ident=new ae,Object.assign(this,e)}};u([l({type:ae})],eu.prototype,"service",void 0);u([l({type:ae})],eu.prototype,"ident",void 0);u([l({type:ie,optional:!0})],eu.prototype,"authInfo",void 0);var gy,tu=class{constructor(e={}){this.otherCertFormat="",this.otherCert=new ArrayBuffer(0),Object.assign(this,e)}};u([l({type:d.ObjectIdentifier})],tu.prototype,"otherCertFormat",void 0);u([l({type:d.Any})],tu.prototype,"otherCert",void 0);var Ii=class{constructor(e={}){Object.assign(this,e)}};u([l({type:cr})],Ii.prototype,"certificate",void 0);u([l({type:Bi,context:2,implicit:!0})],Ii.prototype,"v2AttrCert",void 0);u([l({type:tu,context:3,implicit:!0})],Ii.prototype,"other",void 0);Ii=u([_({type:x.Choice})],Ii);var Ti=gy=class extends oe{constructor(e){super(e),Object.setPrototypeOf(this,gy.prototype)}};Ti=gy=u([_({type:x.Set,itemType:Ii})],Ti);var fr=class{constructor(e={}){this.contentType="",this.content=new ArrayBuffer(0),Object.assign(this,e)}};u([l({type:d.ObjectIdentifier})],fr.prototype,"contentType",void 0);u([l({type:d.Any,context:0})],fr.prototype,"content",void 0);var Vs=class{constructor(e={}){Object.assign(this,e)}};u([l({type:ie})],Vs.prototype,"single",void 0);u([l({type:d.Any})],Vs.prototype,"any",void 0);Vs=u([_({type:x.Choice})],Vs);var ki=class{constructor(e={}){this.eContentType="",Object.assign(this,e)}};u([l({type:d.ObjectIdentifier})],ki.prototype,"eContentType",void 0);u([l({type:Vs,context:0,optional:!0})],ki.prototype,"eContent",void 0);var ru=class{constructor(e={}){Object.assign(this,e)}};u([l({type:ie,context:0,implicit:!0,optional:!0})],ru.prototype,"value",void 0);u([l({type:ie,converter:Vx,context:0,implicit:!0,optional:!0,repeated:"sequence"})],ru.prototype,"constructedValue",void 0);ru=u([_({type:x.Choice})],ru);var mo=class{constructor(e={}){this.contentType="",this.contentEncryptionAlgorithm=new Gc,Object.assign(this,e)}};u([l({type:d.ObjectIdentifier})],mo.prototype,"contentType",void 0);u([l({type:Gc})],mo.prototype,"contentEncryptionAlgorithm",void 0);u([l({type:ru,optional:!0})],mo.prototype,"encryptedContent",void 0);var yo=class{constructor(e={}){this.keyAttrId="",Object.assign(this,e)}};u([l({type:d.ObjectIdentifier})],yo.prototype,"keyAttrId",void 0);u([l({type:d.Any,optional:!0})],yo.prototype,"keyAttr",void 0);var by,$s=class{constructor(e={}){this.subjectKeyIdentifier=new Ht,Object.assign(this,e)}};u([l({type:Ht})],$s.prototype,"subjectKeyIdentifier",void 0);u([l({type:d.GeneralizedTime,optional:!0})],$s.prototype,"date",void 0);u([l({type:yo,optional:!0})],$s.prototype,"other",void 0);var Fs=class{constructor(e={}){Object.assign(this,e)}};u([l({type:$s,context:0,implicit:!0,optional:!0})],Fs.prototype,"rKeyId",void 0);u([l({type:Or,optional:!0})],Fs.prototype,"issuerAndSerialNumber",void 0);Fs=u([_({type:x.Choice})],Fs);var nu=class{constructor(e={}){this.rid=new Fs,this.encryptedKey=new ie,Object.assign(this,e)}};u([l({type:Fs})],nu.prototype,"rid",void 0);u([l({type:ie})],nu.prototype,"encryptedKey",void 0);var lh=by=class extends oe{constructor(e){super(e),Object.setPrototypeOf(this,by.prototype)}};lh=by=u([_({type:x.Sequence,itemType:nu})],lh);var ou=class{constructor(e={}){this.algorithm=new j,this.publicKey=new ArrayBuffer(0),Object.assign(this,e)}};u([l({type:j})],ou.prototype,"algorithm",void 0);u([l({type:d.BitString})],ou.prototype,"publicKey",void 0);var Oi=class{constructor(e={}){Object.assign(this,e)}};u([l({type:Ht,context:0,implicit:!0,optional:!0})],Oi.prototype,"subjectKeyIdentifier",void 0);u([l({type:ou,context:1,implicit:!0,optional:!0})],Oi.prototype,"originatorKey",void 0);u([l({type:Or,optional:!0})],Oi.prototype,"issuerAndSerialNumber",void 0);Oi=u([_({type:x.Choice})],Oi);var In=class{constructor(e={}){this.version=wt.v3,this.originator=new Oi,this.keyEncryptionAlgorithm=new Vt,this.recipientEncryptedKeys=new lh,Object.assign(this,e)}};u([l({type:d.Integer})],In.prototype,"version",void 0);u([l({type:Oi,context:0})],In.prototype,"originator",void 0);u([l({type:ie,context:1,optional:!0})],In.prototype,"ukm",void 0);u([l({type:Vt})],In.prototype,"keyEncryptionAlgorithm",void 0);u([l({type:lh})],In.prototype,"recipientEncryptedKeys",void 0);var Ws=class{constructor(e={}){Object.assign(this,e)}};u([l({type:Ht,context:0,implicit:!0})],Ws.prototype,"subjectKeyIdentifier",void 0);u([l({type:Or})],Ws.prototype,"issuerAndSerialNumber",void 0);Ws=u([_({type:x.Choice})],Ws);var go=class{constructor(e={}){this.version=wt.v0,this.rid=new Ws,this.keyEncryptionAlgorithm=new Vt,this.encryptedKey=new ie,Object.assign(this,e)}};u([l({type:d.Integer})],go.prototype,"version",void 0);u([l({type:Ws})],go.prototype,"rid",void 0);u([l({type:Vt})],go.prototype,"keyEncryptionAlgorithm",void 0);u([l({type:ie})],go.prototype,"encryptedKey",void 0);var Pi=class{constructor(e={}){this.keyIdentifier=new ie,Object.assign(this,e)}};u([l({type:ie})],Pi.prototype,"keyIdentifier",void 0);u([l({type:d.GeneralizedTime,optional:!0})],Pi.prototype,"date",void 0);u([l({type:yo,optional:!0})],Pi.prototype,"other",void 0);var bo=class{constructor(e={}){this.version=wt.v4,this.kekid=new Pi,this.keyEncryptionAlgorithm=new Vt,this.encryptedKey=new ie,Object.assign(this,e)}};u([l({type:d.Integer})],bo.prototype,"version",void 0);u([l({type:Pi})],bo.prototype,"kekid",void 0);u([l({type:Vt})],bo.prototype,"keyEncryptionAlgorithm",void 0);u([l({type:ie})],bo.prototype,"encryptedKey",void 0);var wo=class{constructor(e={}){this.version=wt.v0,this.keyEncryptionAlgorithm=new Vt,this.encryptedKey=new ie,Object.assign(this,e)}};u([l({type:d.Integer})],wo.prototype,"version",void 0);u([l({type:sh,context:0,optional:!0})],wo.prototype,"keyDerivationAlgorithm",void 0);u([l({type:Vt})],wo.prototype,"keyEncryptionAlgorithm",void 0);u([l({type:ie})],wo.prototype,"encryptedKey",void 0);var iu=class{constructor(e={}){this.oriType="",this.oriValue=new ArrayBuffer(0),Object.assign(this,e)}};u([l({type:d.ObjectIdentifier})],iu.prototype,"oriType",void 0);u([l({type:d.Any})],iu.prototype,"oriValue",void 0);var Tn=class{constructor(e={}){Object.assign(this,e)}};u([l({type:go,optional:!0})],Tn.prototype,"ktri",void 0);u([l({type:In,context:1,implicit:!0,optional:!0})],Tn.prototype,"kari",void 0);u([l({type:bo,context:2,implicit:!0,optional:!0})],Tn.prototype,"kekri",void 0);u([l({type:wo,context:3,implicit:!0,optional:!0})],Tn.prototype,"pwri",void 0);u([l({type:iu,context:4,implicit:!0,optional:!0})],Tn.prototype,"ori",void 0);Tn=u([_({type:x.Choice})],Tn);var wy,su=wy=class extends oe{constructor(e){super(e),Object.setPrototypeOf(this,wy.prototype)}};su=wy=u([_({type:x.Set,itemType:Tn})],su);var xy,dv=`${lo}.16`,iH=`${dv}.2`,sH=`${dv}.4`,qs=class{constructor(e={}){this.otherRevInfoFormat="",this.otherRevInfo=new ArrayBuffer(0),Object.assign(this,e)}};u([l({type:d.ObjectIdentifier})],qs.prototype,"otherRevInfoFormat",void 0);u([l({type:d.Any})],qs.prototype,"otherRevInfo",void 0);var fh=class{constructor(e={}){this.other=new qs,Object.assign(this,e)}};u([l({type:qs,context:1,implicit:!0})],fh.prototype,"other",void 0);fh=u([_({type:x.Choice})],fh);var Gs=xy=class extends oe{constructor(e){super(e),Object.setPrototypeOf(this,xy.prototype)}};Gs=xy=u([_({type:x.Set,itemType:fh})],Gs);var zs=class{constructor(e={}){Object.assign(this,e)}};u([l({type:Ti,context:0,implicit:!0,optional:!0})],zs.prototype,"certs",void 0);u([l({type:Gs,context:1,implicit:!0,optional:!0})],zs.prototype,"crls",void 0);var vy,Ay=vy=class extends oe{constructor(e){super(e),Object.setPrototypeOf(this,vy.prototype)}};Ay=vy=u([_({type:x.Set,itemType:Pr})],Ay);var Ni=class{constructor(e={}){this.version=wt.v0,this.recipientInfos=new su,this.encryptedContentInfo=new mo,Object.assign(this,e)}};u([l({type:d.Integer})],Ni.prototype,"version",void 0);u([l({type:zs,context:0,implicit:!0,optional:!0})],Ni.prototype,"originatorInfo",void 0);u([l({type:su})],Ni.prototype,"recipientInfos",void 0);u([l({type:mo})],Ni.prototype,"encryptedContentInfo",void 0);u([l({type:Ay,context:1,implicit:!0,optional:!0})],Ni.prototype,"unprotectedAttrs",void 0);var mv="1.2.840.113549.1.7.2";var Sy,hh=Sy=class extends oe{constructor(e){super(e),Object.setPrototypeOf(this,Sy.prototype)}};hh=Sy=u([_({type:x.Set,itemType:Si})],hh);var kn=class{constructor(e={}){this.version=wt.v0,this.digestAlgorithms=new hh,this.encapContentInfo=new ki,this.signerInfos=new zc,Object.assign(this,e)}};u([l({type:d.Integer})],kn.prototype,"version",void 0);u([l({type:hh})],kn.prototype,"digestAlgorithms",void 0);u([l({type:ki})],kn.prototype,"encapContentInfo",void 0);u([l({type:Ti,context:0,implicit:!0,optional:!0})],kn.prototype,"certificates",void 0);u([l({type:Gs,context:1,implicit:!0,optional:!0})],kn.prototype,"crls",void 0);u([l({type:zc})],kn.prototype,"signerInfos",void 0);var Di="1.2.840.10045.2.1";var au="1.2.840.10045.4.1",ph="1.2.840.10045.4.3.1",cu="1.2.840.10045.4.3.2",uu="1.2.840.10045.4.3.3",lu="1.2.840.10045.4.3.4";var Ey="1.2.840.10045.3.1.7";var _y="1.3.132.0.34";var Cy="1.3.132.0.35";function fu(r){return new j({algorithm:r})}var gv=fu(au),rV=fu(ph),bv=fu(cu),wv=fu(uu),xv=fu(lu);var hu=class{constructor(e={}){Object.assign(this,e)}};u([l({type:d.ObjectIdentifier})],hu.prototype,"fieldType",void 0);u([l({type:d.Any})],hu.prototype,"parameters",void 0);hu=u([_({type:x.Sequence})],hu);var By=class extends ie{};var Xs=class{constructor(e={}){Object.assign(this,e)}};u([l({type:d.OctetString})],Xs.prototype,"a",void 0);u([l({type:d.OctetString})],Xs.prototype,"b",void 0);u([l({type:d.BitString,optional:!0})],Xs.prototype,"seed",void 0);Xs=u([_({type:x.Sequence})],Xs);var Iy;(function(r){r[r.ecpVer1=1]="ecpVer1"})(Iy||(Iy={}));var Zr=class{constructor(e={}){this.version=Iy.ecpVer1,Object.assign(this,e)}};u([l({type:d.Integer})],Zr.prototype,"version",void 0);u([l({type:hu})],Zr.prototype,"fieldID",void 0);u([l({type:Xs})],Zr.prototype,"curve",void 0);u([l({type:By})],Zr.prototype,"base",void 0);u([l({type:d.Integer,converter:ge})],Zr.prototype,"order",void 0);u([l({type:d.Integer,optional:!0})],Zr.prototype,"cofactor",void 0);Zr=u([_({type:x.Sequence})],Zr);var Yr=class{constructor(e={}){Object.assign(this,e)}};u([l({type:d.ObjectIdentifier})],Yr.prototype,"namedCurve",void 0);u([l({type:d.Null})],Yr.prototype,"implicitCurve",void 0);u([l({type:Zr})],Yr.prototype,"specifiedCurve",void 0);Yr=u([_({type:x.Choice})],Yr);var Zs=class{constructor(e={}){this.version=1,this.privateKey=new ie,Object.assign(this,e)}};u([l({type:d.Integer})],Zs.prototype,"version",void 0);u([l({type:ie})],Zs.prototype,"privateKey",void 0);u([l({type:Yr,context:0,optional:!0})],Zs.prototype,"parameters",void 0);u([l({type:d.BitString,context:1,optional:!0})],Zs.prototype,"publicKey",void 0);var Ri=class{constructor(e={}){this.r=new ArrayBuffer(0),this.s=new ArrayBuffer(0),Object.assign(this,e)}};u([l({type:d.Integer,converter:ge})],Ri.prototype,"r",void 0);u([l({type:d.Integer,converter:ge})],Ri.prototype,"s",void 0);var Wt="1.2.840.113549.1.1",Jr=`${Wt}.1`,vv=`${Wt}.7`,Av=`${Wt}.9`,xo=`${Wt}.10`,Sv=`${Wt}.2`,Ev=`${Wt}.4`,Ys=`${Wt}.5`,_v=`${Wt}.14`;var dh=`${Wt}.11`,Js=`${Wt}.12`,Qs=`${Wt}.13`,Ty=`${Wt}.15`,ky=`${Wt}.16`,Li="1.3.14.3.2.26",mh="2.16.840.1.101.3.4.2.4",Ui="2.16.840.1.101.3.4.2.1",Mi="2.16.840.1.101.3.4.2.2",ji="2.16.840.1.101.3.4.2.3",Cv="2.16.840.1.101.3.4.2.5",Bv="2.16.840.1.101.3.4.2.6",Iv="1.2.840.113549.2.2",Tv="1.2.840.113549.2.5",vo=`${Wt}.8`;function it(r){return new j({algorithm:r,parameters:null})}var kV=it(Iv),OV=it(Tv),On=it(Li),PV=it(mh),NV=it(Ui),DV=it(Mi),RV=it(ji),LV=it(Cv),UV=it(Bv),yh=new j({algorithm:vo,parameters:F.serialize(On)}),Oy=new j({algorithm:Av,parameters:F.serialize(Ps.toASN(new Uint8Array([218,57,163,238,94,107,75,13,50,85,191,239,149,96,24,144,175,216,7,9]).buffer))}),MV=it(Jr),jV=it(Sv),KV=it(Ev),HV=it(Ys),VV=it(Ty),$V=it(ky),FV=it(Js),WV=it(Qs),qV=it(Ty),GV=it(ky);var ea=class{constructor(e={}){this.hashAlgorithm=new j(On),this.maskGenAlgorithm=new j({algorithm:vo,parameters:F.serialize(On)}),this.pSourceAlgorithm=new j(Oy),Object.assign(this,e)}};u([l({type:j,context:0,defaultValue:On})],ea.prototype,"hashAlgorithm",void 0);u([l({type:j,context:1,defaultValue:yh})],ea.prototype,"maskGenAlgorithm",void 0);u([l({type:j,context:2,defaultValue:Oy})],ea.prototype,"pSourceAlgorithm",void 0);var e7=new j({algorithm:vv,parameters:F.serialize(new ea)});var Qr=class{constructor(e={}){this.hashAlgorithm=new j(On),this.maskGenAlgorithm=new j({algorithm:vo,parameters:F.serialize(On)}),this.saltLength=20,this.trailerField=1,Object.assign(this,e)}};u([l({type:j,context:0,defaultValue:On})],Qr.prototype,"hashAlgorithm",void 0);u([l({type:j,context:1,defaultValue:yh})],Qr.prototype,"maskGenAlgorithm",void 0);u([l({type:d.Integer,context:2,defaultValue:20})],Qr.prototype,"saltLength",void 0);u([l({type:d.Integer,context:3,defaultValue:1})],Qr.prototype,"trailerField",void 0);var a7=new j({algorithm:xo,parameters:F.serialize(new Qr)});var Ki=class{constructor(e={}){this.digestAlgorithm=new j,this.digest=new ie,Object.assign(this,e)}};u([l({type:j})],Ki.prototype,"digestAlgorithm",void 0);u([l({type:ie})],Ki.prototype,"digest",void 0);var Py,ta=class{constructor(e={}){this.prime=new ArrayBuffer(0),this.exponent=new ArrayBuffer(0),this.coefficient=new ArrayBuffer(0),Object.assign(this,e)}};u([l({type:d.Integer,converter:ge})],ta.prototype,"prime",void 0);u([l({type:d.Integer,converter:ge})],ta.prototype,"exponent",void 0);u([l({type:d.Integer,converter:ge})],ta.prototype,"coefficient",void 0);var gh=Py=class extends oe{constructor(e){super(e),Object.setPrototypeOf(this,Py.prototype)}};gh=Py=u([_({type:x.Sequence,itemType:ta})],gh);var hr=class{constructor(e={}){this.version=0,this.modulus=new ArrayBuffer(0),this.publicExponent=new ArrayBuffer(0),this.privateExponent=new ArrayBuffer(0),this.prime1=new ArrayBuffer(0),this.prime2=new ArrayBuffer(0),this.exponent1=new ArrayBuffer(0),this.exponent2=new ArrayBuffer(0),this.coefficient=new ArrayBuffer(0),Object.assign(this,e)}};u([l({type:d.Integer})],hr.prototype,"version",void 0);u([l({type:d.Integer,converter:ge})],hr.prototype,"modulus",void 0);u([l({type:d.Integer,converter:ge})],hr.prototype,"publicExponent",void 0);u([l({type:d.Integer,converter:ge})],hr.prototype,"privateExponent",void 0);u([l({type:d.Integer,converter:ge})],hr.prototype,"prime1",void 0);u([l({type:d.Integer,converter:ge})],hr.prototype,"prime2",void 0);u([l({type:d.Integer,converter:ge})],hr.prototype,"exponent1",void 0);u([l({type:d.Integer,converter:ge})],hr.prototype,"exponent2",void 0);u([l({type:d.Integer,converter:ge})],hr.prototype,"coefficient",void 0);u([l({type:gh,optional:!0})],hr.prototype,"otherPrimeInfos",void 0);var ra=class{constructor(e={}){this.modulus=new ArrayBuffer(0),this.publicExponent=new ArrayBuffer(0),Object.assign(this,e)}};u([l({type:d.Integer,converter:ge})],ra.prototype,"modulus",void 0);u([l({type:d.Integer,converter:ge})],ra.prototype,"publicExponent",void 0);var Ny;(function(r){r[r.Transient=0]="Transient",r[r.Singleton=1]="Singleton",r[r.ResolutionScoped=2]="ResolutionScoped",r[r.ContainerScoped=3]="ContainerScoped"})(Ny||(Ny={}));var xt=Ny;var Yv=Rr(Zv(),1),{__extends:oa,__assign:M7,__rest:qC,__decorate:j7,__param:K7,__metadata:H7,__awaiter:Jv,__generator:Qv,__exportStar:V7,__createBinding:$7,__values:pu,__read:du,__spread:Nr,__spreadArrays:F7,__await:W7,__asyncGenerator:q7,__asyncDelegator:G7,__asyncValues:z7,__makeTemplateObject:X7,__importStar:Z7,__importDefault:Y7,__classPrivateFieldGet:J7,__classPrivateFieldSet:Q7}=Yv.default;var GC="injectionTokens";function Ry(r){var e=Reflect.getMetadata("design:paramtypes",r)||[],t=Reflect.getOwnMetadata(GC,r)||{};return Object.keys(t).forEach(function(n){e[+n]=t[n]}),e}function mu(r){return!!r.useClass}function ia(r){return!!r.useFactory}var xh=(function(){function r(e){this.wrap=e,this.reflectMethods=["get","getPrototypeOf","setPrototypeOf","getOwnPropertyDescriptor","defineProperty","has","set","deleteProperty","apply","construct","ownKeys"]}return r.prototype.createProxy=function(e){var t=this,n={},o=!1,i,s=function(){return o||(i=e(t.wrap()),o=!0),i};return new Proxy(n,this.createHandler(s))},r.prototype.createHandler=function(e){var t={},n=function(o){t[o]=function(){for(var i=[],s=0;s<arguments.length;s++)i[s]=arguments[s];i[0]=e();var a=Reflect[o];return a.apply(void 0,Nr(i))}};return this.reflectMethods.forEach(n),t},r})();function Ao(r){return typeof r=="string"||typeof r=="symbol"}function Ly(r){return typeof r=="object"&&"token"in r&&"multiple"in r}function vh(r){return typeof r=="object"&&"token"in r&&"transform"in r}function e1(r){return typeof r=="function"||r instanceof xh}function Hi(r){return!!r.useToken}function Vi(r){return r.useValue!=null}function t1(r){return mu(r)||Vi(r)||Hi(r)||ia(r)}var zC=(function(){function r(){this._registryMap=new Map}return r.prototype.entries=function(){return this._registryMap.entries()},r.prototype.getAll=function(e){return this.ensure(e),this._registryMap.get(e)},r.prototype.get=function(e){this.ensure(e);var t=this._registryMap.get(e);return t[t.length-1]||null},r.prototype.set=function(e,t){this.ensure(e),this._registryMap.get(e).push(t)},r.prototype.setAll=function(e,t){this._registryMap.set(e,t)},r.prototype.has=function(e){return this.ensure(e),this._registryMap.get(e).length>0},r.prototype.clear=function(){this._registryMap.clear()},r.prototype.ensure=function(e){this._registryMap.has(e)||this._registryMap.set(e,[])},r})(),yu=zC;var XC=(function(r){oa(e,r);function e(){return r!==null&&r.apply(this,arguments)||this}return e})(yu),r1=XC;var ZC=(function(){function r(){this.scopedResolutions=new Map}return r})(),gu=ZC;function YC(r,e){if(r===null)return"at position #"+e;var t=r.split(",")[e].trim();return'"'+t+'" at position #'+e}function JC(r,e,t){return t===void 0&&(t="    "),Nr([r],e.message.split(`
`).map(function(n){return t+n})).join(`
`)}function Uy(r,e,t){var n=du(r.toString().match(/constructor\(([\w, ]+)\)/)||[],2),o=n[1],i=o===void 0?null:o,s=YC(i,e);return JC("Cannot inject the dependency "+s+' of "'+r.name+'" constructor. Reason:',t)}function n1(r){if(typeof r.dispose!="function")return!1;var e=r.dispose;return!(e.length>0)}var QC=(function(r){oa(e,r);function e(){return r!==null&&r.apply(this,arguments)||this}return e})(yu);var eB=(function(r){oa(e,r);function e(){return r!==null&&r.apply(this,arguments)||this}return e})(yu);var tB=(function(){function r(){this.preResolution=new QC,this.postResolution=new eB}return r})(),o1=tB;var My=new Map,rB=(function(){function r(e){this.parent=e,this._registry=new r1,this.interceptors=new o1,this.disposed=!1,this.disposables=new Set}return r.prototype.register=function(e,t,n){n===void 0&&(n={lifecycle:xt.Transient}),this.ensureNotDisposed();var o;if(t1(t)?o=t:o={useClass:t},Hi(o))for(var i=[e],s=o;s!=null;){var a=s.useToken;if(i.includes(a))throw new Error("Token registration cycle detected! "+Nr(i,[a]).join(" -> "));i.push(a);var c=this._registry.get(a);c&&Hi(c.provider)?s=c.provider:s=null}if((n.lifecycle===xt.Singleton||n.lifecycle==xt.ContainerScoped||n.lifecycle==xt.ResolutionScoped)&&(Vi(o)||ia(o)))throw new Error('Cannot use lifecycle "'+xt[n.lifecycle]+'" with ValueProviders or FactoryProviders');return this._registry.set(e,{provider:o,options:n}),this},r.prototype.registerType=function(e,t){return this.ensureNotDisposed(),Ao(t)?this.register(e,{useToken:t}):this.register(e,{useClass:t})},r.prototype.registerInstance=function(e,t){return this.ensureNotDisposed(),this.register(e,{useValue:t})},r.prototype.registerSingleton=function(e,t){if(this.ensureNotDisposed(),Ao(e)){if(Ao(t))return this.register(e,{useToken:t},{lifecycle:xt.Singleton});if(t)return this.register(e,{useClass:t},{lifecycle:xt.Singleton});throw new Error('Cannot register a type name as a singleton without a "to" token')}var n=e;return t&&!Ao(t)&&(n=t),this.register(e,{useClass:n},{lifecycle:xt.Singleton})},r.prototype.resolve=function(e,t,n){t===void 0&&(t=new gu),n===void 0&&(n=!1),this.ensureNotDisposed();var o=this.getRegistration(e);if(!o&&Ao(e)){if(n)return;throw new Error('Attempted to resolve unregistered dependency token: "'+e.toString()+'"')}if(this.executePreResolutionInterceptor(e,"Single"),o){var i=this.resolveRegistration(o,t);return this.executePostResolutionInterceptor(e,i,"Single"),i}if(e1(e)){var i=this.construct(e,t);return this.executePostResolutionInterceptor(e,i,"Single"),i}throw new Error("Attempted to construct an undefined constructor. Could mean a circular dependency problem. Try using `delay` function.")},r.prototype.executePreResolutionInterceptor=function(e,t){var n,o;if(this.interceptors.preResolution.has(e)){var i=[];try{for(var s=pu(this.interceptors.preResolution.getAll(e)),a=s.next();!a.done;a=s.next()){var c=a.value;c.options.frequency!="Once"&&i.push(c),c.callback(e,t)}}catch(f){n={error:f}}finally{try{a&&!a.done&&(o=s.return)&&o.call(s)}finally{if(n)throw n.error}}this.interceptors.preResolution.setAll(e,i)}},r.prototype.executePostResolutionInterceptor=function(e,t,n){var o,i;if(this.interceptors.postResolution.has(e)){var s=[];try{for(var a=pu(this.interceptors.postResolution.getAll(e)),c=a.next();!c.done;c=a.next()){var f=c.value;f.options.frequency!="Once"&&s.push(f),f.callback(e,t,n)}}catch(p){o={error:p}}finally{try{c&&!c.done&&(i=a.return)&&i.call(a)}finally{if(o)throw o.error}}this.interceptors.postResolution.setAll(e,s)}},r.prototype.resolveRegistration=function(e,t){if(this.ensureNotDisposed(),e.options.lifecycle===xt.ResolutionScoped&&t.scopedResolutions.has(e))return t.scopedResolutions.get(e);var n=e.options.lifecycle===xt.Singleton,o=e.options.lifecycle===xt.ContainerScoped,i=n||o,s;return Vi(e.provider)?s=e.provider.useValue:Hi(e.provider)?s=i?e.instance||(e.instance=this.resolve(e.provider.useToken,t)):this.resolve(e.provider.useToken,t):mu(e.provider)?s=i?e.instance||(e.instance=this.construct(e.provider.useClass,t)):this.construct(e.provider.useClass,t):ia(e.provider)?s=e.provider.useFactory(this):s=this.construct(e.provider,t),e.options.lifecycle===xt.ResolutionScoped&&t.scopedResolutions.set(e,s),s},r.prototype.resolveAll=function(e,t,n){var o=this;t===void 0&&(t=new gu),n===void 0&&(n=!1),this.ensureNotDisposed();var i=this.getAllRegistrations(e);if(!i&&Ao(e)){if(n)return[];throw new Error('Attempted to resolve unregistered dependency token: "'+e.toString()+'"')}if(this.executePreResolutionInterceptor(e,"All"),i){var s=i.map(function(c){return o.resolveRegistration(c,t)});return this.executePostResolutionInterceptor(e,s,"All"),s}var a=[this.construct(e,t)];return this.executePostResolutionInterceptor(e,a,"All"),a},r.prototype.isRegistered=function(e,t){return t===void 0&&(t=!1),this.ensureNotDisposed(),this._registry.has(e)||t&&(this.parent||!1)&&this.parent.isRegistered(e,!0)},r.prototype.reset=function(){this.ensureNotDisposed(),this._registry.clear(),this.interceptors.preResolution.clear(),this.interceptors.postResolution.clear()},r.prototype.clearInstances=function(){var e,t;this.ensureNotDisposed();try{for(var n=pu(this._registry.entries()),o=n.next();!o.done;o=n.next()){var i=du(o.value,2),s=i[0],a=i[1];this._registry.setAll(s,a.filter(function(c){return!Vi(c.provider)}).map(function(c){return c.instance=void 0,c}))}}catch(c){e={error:c}}finally{try{o&&!o.done&&(t=n.return)&&t.call(n)}finally{if(e)throw e.error}}},r.prototype.createChildContainer=function(){var e,t;this.ensureNotDisposed();var n=new r(this);try{for(var o=pu(this._registry.entries()),i=o.next();!i.done;i=o.next()){var s=du(i.value,2),a=s[0],c=s[1];c.some(function(f){var p=f.options;return p.lifecycle===xt.ContainerScoped})&&n._registry.setAll(a,c.map(function(f){return f.options.lifecycle===xt.ContainerScoped?{provider:f.provider,options:f.options}:f}))}}catch(f){e={error:f}}finally{try{i&&!i.done&&(t=o.return)&&t.call(o)}finally{if(e)throw e.error}}return n},r.prototype.beforeResolution=function(e,t,n){n===void 0&&(n={frequency:"Always"}),this.interceptors.preResolution.set(e,{callback:t,options:n})},r.prototype.afterResolution=function(e,t,n){n===void 0&&(n={frequency:"Always"}),this.interceptors.postResolution.set(e,{callback:t,options:n})},r.prototype.dispose=function(){return Jv(this,void 0,void 0,function(){var e;return Qv(this,function(t){switch(t.label){case 0:return this.disposed=!0,e=[],this.disposables.forEach(function(n){var o=n.dispose();o&&e.push(o)}),[4,Promise.all(e)];case 1:return t.sent(),[2]}})})},r.prototype.getRegistration=function(e){return this.isRegistered(e)?this._registry.get(e):this.parent?this.parent.getRegistration(e):null},r.prototype.getAllRegistrations=function(e){return this.isRegistered(e)?this._registry.getAll(e):this.parent?this.parent.getAllRegistrations(e):null},r.prototype.construct=function(e,t){var n=this;if(e instanceof xh)return e.createProxy(function(i){return n.resolve(i,t)});var o=(function(){var i=My.get(e);if(!i||i.length===0){if(e.length===0)return new e;throw new Error('TypeInfo not known for "'+e.name+'"')}var s=i.map(n.resolveParams(t,e));return new(e.bind.apply(e,Nr([void 0],s)))})();return n1(o)&&this.disposables.add(o),o},r.prototype.resolveParams=function(e,t){var n=this;return function(o,i){var s,a,c;try{return Ly(o)?vh(o)?o.multiple?(s=n.resolve(o.transform)).transform.apply(s,Nr([n.resolveAll(o.token,new gu,o.isOptional)],o.transformArgs)):(a=n.resolve(o.transform)).transform.apply(a,Nr([n.resolve(o.token,e,o.isOptional)],o.transformArgs)):o.multiple?n.resolveAll(o.token,new gu,o.isOptional):n.resolve(o.token,e,o.isOptional):vh(o)?(c=n.resolve(o.transform,e)).transform.apply(c,Nr([n.resolve(o.token,e)],o.transformArgs)):n.resolve(o,e)}catch(f){throw new Error(Uy(t,i,f))}}},r.prototype.ensureNotDisposed=function(){if(this.disposed)throw new Error("This container has been disposed, you cannot interact with a disposed container")},r})(),De=new rB;function nB(r){return function(e){My.set(e,Ry(e)),r&&r.token&&(Array.isArray(r.token)?r.token.forEach(function(t){De.register(t,e)}):De.register(r.token,e))}}var So=nB;if(typeof Reflect>"u"||!Reflect.getMetadata)throw new Error(`tsyringe requires a reflect polyfill. Please add 'import "reflect-metadata"' to the top of your entry point.`);var Ky,$i=class{constructor(e={}){this.attrId="",this.attrValues=[],Object.assign(e)}};u([l({type:d.ObjectIdentifier})],$i.prototype,"attrId",void 0);u([l({type:d.Any,repeated:"set"})],$i.prototype,"attrValues",void 0);var i1=Ky=class extends oe{constructor(e){super(e),Object.setPrototypeOf(this,Ky.prototype)}};i1=Ky=u([_({type:x.Sequence,itemType:$i})],i1);var Hy,s1=Hy=class extends oe{constructor(e){super(e),Object.setPrototypeOf(this,Hy.prototype)}};s1=Hy=u([_({type:x.Sequence,itemType:fr})],s1);var oB="1.2.840.113549",iB=`${oB}.1`,a1=`${iB}.12`,sa=`${a1}.1`,lW=`${sa}.1`,fW=`${sa}.2`,hW=`${sa}.3`,pW=`${sa}.4`,dW=`${sa}.5`,mW=`${sa}.6`,Fi=`${a1}.10.1`;var bW=`${Fi}.1`,wW=`${Fi}.2`,xW=`${Fi}.3`,vW=`${Fi}.4`,AW=`${Fi}.5`,SW=`${Fi}.6`,Ah="1.2.840.113549.1.9";var Sh=class{constructor(e={}){this.certId="",this.certValue=new ArrayBuffer(0),Object.assign(this,e)}};u([l({type:d.ObjectIdentifier})],Sh.prototype,"certId",void 0);u([l({type:d.Any,context:0})],Sh.prototype,"certValue",void 0);var c1=`${Ah}.22`,IW=`${c1}.1`,TW=`${c1}.2`;var Eh=class{constructor(e={}){this.crlId="",this.crltValue=new ArrayBuffer(0),Object.assign(this,e)}};u([l({type:d.ObjectIdentifier})],Eh.prototype,"crlId",void 0);u([l({type:d.Any,context:0})],Eh.prototype,"crltValue",void 0);var sB=`${Ah}.23`,DW=`${sB}.1`;var _h=class extends ie{},Eo=class{constructor(e={}){this.encryptionAlgorithm=new j,this.encryptedData=new _h,Object.assign(this,e)}};u([l({type:j})],Eo.prototype,"encryptionAlgorithm",void 0);u([l({type:_h})],Eo.prototype,"encryptedData",void 0);var Vy,$y;(function(r){r[r.v1=0]="v1"})($y||($y={}));var Ch=class extends ie{},Fy=Vy=class extends oe{constructor(e){super(e),Object.setPrototypeOf(this,Vy.prototype)}};Fy=Vy=u([_({type:x.Sequence,itemType:mt})],Fy);var _o=class{constructor(e={}){this.version=$y.v1,this.privateKeyAlgorithm=new j,this.privateKey=new Ch,Object.assign(this,e)}};u([l({type:d.Integer})],_o.prototype,"version",void 0);u([l({type:j})],_o.prototype,"privateKeyAlgorithm",void 0);u([l({type:Ch})],_o.prototype,"privateKey",void 0);u([l({type:Fy,implicit:!0,context:0,optional:!0})],_o.prototype,"attributes",void 0);var u1=class extends _o{};u1=u([_({type:x.Sequence})],u1);var l1=class extends Eo{};l1=u([_({type:x.Sequence})],l1);var Bh=class{constructor(e={}){this.secretTypeId="",this.secretValue=new ArrayBuffer(0),Object.assign(this,e)}};u([l({type:d.ObjectIdentifier})],Bh.prototype,"secretTypeId",void 0);u([l({type:d.Any,context:0})],Bh.prototype,"secretValue",void 0);var Co=class{constructor(e={}){this.mac=new Ki,this.macSalt=new ie,this.iterations=1,Object.assign(this,e)}};u([l({type:Ki})],Co.prototype,"mac",void 0);u([l({type:ie})],Co.prototype,"macSalt",void 0);u([l({type:d.Integer,defaultValue:1})],Co.prototype,"iterations",void 0);var Wi=class{constructor(e={}){this.version=3,this.authSafe=new fr,this.macData=new Co,Object.assign(this,e)}};u([l({type:d.Integer})],Wi.prototype,"version",void 0);u([l({type:fr})],Wi.prototype,"authSafe",void 0);u([l({type:Co,optional:!0})],Wi.prototype,"macData",void 0);var Wy,aa=class{constructor(e={}){this.bagId="",this.bagValue=new ArrayBuffer(0),Object.assign(this,e)}};u([l({type:d.ObjectIdentifier})],aa.prototype,"bagId",void 0);u([l({type:d.Any,context:0})],aa.prototype,"bagValue",void 0);u([l({type:$i,repeated:"set",optional:!0})],aa.prototype,"bagAttributes",void 0);var f1=Wy=class extends oe{constructor(e){super(e),Object.setPrototypeOf(this,Wy.prototype)}};f1=Wy=u([_({type:x.Sequence,itemType:aa})],f1);var qy,Gy,zy,ze="1.2.840.113549.1.9",Lq=`${ze}.0`,_1=`${ze}.24`,wu=`${ze}.25`,C1=`${ze}.26`,B1=`${ze}.27`,Uq=`${_1}.1`,Mq=`${_1}.2`,jq=`${ze}.1`,Kq=`${ze}.2`,Hq=`${ze}.3`,Vq=`${ze}.4`,$q=`${ze}.5`,Fq=`${ze}.6`,rg=`${ze}.7`,Wq=`${ze}.8`,qq=`${ze}.9`,Gq=`${ze}.13`,xu=`${ze}.14`,zq=`${ze}.15`,Xq=`${ze}.20`,Zq=`${ze}.21`;var Yq=`${wu}.1`,Jq=`${wu}.2`,Qq=`${wu}.3`,eG=`${wu}.4`,tG=`${wu}.5`,vu="1.3.6.1.5.5.7.9",rG=`${vu}.1`,nG=`${vu}.2`,oG=`${vu}.3`,iG=`${vu}.4`,sG=`${vu}.5`,aG=`${C1}.1`,cG=`${C1}.2`,uG=`${B1}.1`,lG=`${B1}.2`,fG=`${ze}.16`,hG=`${ze}.22`,pG=`${ze}.23`,dG=`${dy}.65`,Ih=class extends et{constructor(e={}){super(e)}toString(){return{}.toString(),this.ia5String||super.toString()}};u([l({type:d.IA5String})],Ih.prototype,"ia5String",void 0);Ih=u([_({type:x.Choice})],Ih);var h1=class extends fr{};h1=u([_({type:x.Sequence})],h1);var p1=class extends Wi{};p1=u([_({type:x.Sequence})],p1);var d1=class extends Eo{};d1=u([_({type:x.Sequence})],d1);var Xy=class{constructor(e=""){this.value=e}toString(){return this.value}};u([l({type:d.IA5String})],Xy.prototype,"value",void 0);Xy=u([_({type:x.Choice})],Xy);var m1=class extends Ih{};m1=u([_({type:x.Choice})],m1);var y1=class extends et{};y1=u([_({type:x.Choice})],y1);var Zy=class{constructor(e=new Date){this.value=e}};u([l({type:d.GeneralizedTime})],Zy.prototype,"value",void 0);Zy=u([_({type:x.Choice})],Zy);var g1=class extends et{};g1=u([_({type:x.Choice})],g1);var Yy=class{constructor(e="M"){this.value=e}toString(){return this.value}};u([l({type:d.PrintableString})],Yy.prototype,"value",void 0);Yy=u([_({type:x.Choice})],Yy);var Th=class{constructor(e=""){this.value=e}toString(){return this.value}};u([l({type:d.PrintableString})],Th.prototype,"value",void 0);Th=u([_({type:x.Choice})],Th);var b1=class extends Th{};b1=u([_({type:x.Choice})],b1);var w1=class extends et{};w1=u([_({type:x.Choice})],w1);var Jy=class{constructor(e=""){this.value=e}toString(){return this.value}};u([l({type:d.ObjectIdentifier})],Jy.prototype,"value",void 0);Jy=u([_({type:x.Choice})],Jy);var x1=class extends Ge{};x1=u([_({type:x.Choice})],x1);var Qy=class{constructor(e=0){this.value=e}toString(){return this.value.toString()}};u([l({type:d.Integer})],Qy.prototype,"value",void 0);Qy=u([_({type:x.Choice})],Qy);var v1=class extends $t{};v1=u([_({type:x.Sequence})],v1);var bu=class extends et{};bu=u([_({type:x.Choice})],bu);var A1=qy=class extends Yt{constructor(e){super(e),Object.setPrototypeOf(this,qy.prototype)}};A1=qy=u([_({type:x.Sequence})],A1);var S1=Gy=class extends oe{constructor(e){super(e),Object.setPrototypeOf(this,Gy.prototype)}};S1=Gy=u([_({type:x.Set,itemType:Pr})],S1);var eg=class{constructor(e=""){this.value=e}toString(){return this.value}};u([l({type:d.BmpString})],eg.prototype,"value",void 0);eg=u([_({type:x.Choice})],eg);var tg=class extends j{};tg=u([_({type:x.Sequence})],tg);var E1=zy=class extends oe{constructor(e){super(e),Object.setPrototypeOf(this,zy.prototype)}};E1=zy=u([_({type:x.Sequence,itemType:tg})],E1);var ng,Au=ng=class extends oe{constructor(e){super(e),Object.setPrototypeOf(this,ng.prototype)}};Au=ng=u([_({type:x.Sequence,itemType:mt})],Au);var en=class{constructor(e={}){this.version=0,this.subject=new Oe,this.subjectPKInfo=new yt,this.attributes=new Au,Object.assign(this,e)}};u([l({type:d.Integer})],en.prototype,"version",void 0);u([l({type:Oe})],en.prototype,"subject",void 0);u([l({type:yt})],en.prototype,"subjectPKInfo",void 0);u([l({type:Au,implicit:!0,context:0})],en.prototype,"attributes",void 0);var Bo=class{constructor(e={}){this.certificationRequestInfo=new en,this.signatureAlgorithm=new j,this.signature=new ArrayBuffer(0),Object.assign(this,e)}};u([l({type:en,raw:!0})],Bo.prototype,"certificationRequestInfo",void 0);u([l({type:j})],Bo.prototype,"signatureAlgorithm",void 0);u([l({type:d.BitString})],Bo.prototype,"signature",void 0);var qu="crypto.algorithm",pg=class{getAlgorithms(){return De.resolveAll(qu)}toAsnAlgorithm(e){({...e});for(let t of this.getAlgorithms()){let n=t.toAsnAlgorithm(e);if(n)return n}if(/^[0-9.]+$/.test(e.name)){let t=new j({algorithm:e.name});if("parameters"in e){let n=e;t.parameters=n.parameters}return t}throw new Error("Cannot convert WebCrypto algorithm to ASN.1 algorithm")}toWebAlgorithm(e){for(let n of this.getAlgorithms()){let o=n.toWebAlgorithm(e);if(o)return o}return{name:e.algorithm,parameters:e.parameters}}},qi="crypto.algorithmProvider";De.registerSingleton(qi,pg);var Nh,Gt="1.3.36.3.3.2.8.1.1",I1=`${Gt}.1`,T1=`${Gt}.2`,k1=`${Gt}.3`,O1=`${Gt}.4`,P1=`${Gt}.5`,N1=`${Gt}.6`,D1=`${Gt}.7`,R1=`${Gt}.8`,L1=`${Gt}.9`,U1=`${Gt}.10`,M1=`${Gt}.11`,j1=`${Gt}.12`,K1=`${Gt}.13`,H1=`${Gt}.14`,V1="brainpoolP160r1",$1="brainpoolP160t1",F1="brainpoolP192r1",W1="brainpoolP192t1",q1="brainpoolP224r1",G1="brainpoolP224t1",z1="brainpoolP256r1",X1="brainpoolP256t1",Z1="brainpoolP320r1",Y1="brainpoolP320t1",J1="brainpoolP384r1",Q1="brainpoolP384t1",eA="brainpoolP512r1",tA="brainpoolP512t1",Ve="ECDSA",Vu=Nh=class{toAsnAlgorithm(e){switch(e.name.toLowerCase()){case Ve.toLowerCase():if("hash"in e)switch((typeof e.hash=="string"?e.hash:e.hash.name).toLowerCase()){case"sha-1":return gv;case"sha-256":return bv;case"sha-384":return wv;case"sha-512":return xv}else if("namedCurve"in e){let t="";switch(e.namedCurve){case"P-256":t=Ey;break;case"K-256":t=Nh.SECP256K1;break;case"P-384":t=_y;break;case"P-521":t=Cy;break;case V1:t=I1;break;case $1:t=T1;break;case F1:t=k1;break;case W1:t=O1;break;case q1:t=P1;break;case G1:t=N1;break;case z1:t=D1;break;case X1:t=R1;break;case Z1:t=L1;break;case Y1:t=U1;break;case J1:t=M1;break;case Q1:t=j1;break;case eA:t=K1;break;case tA:t=H1;break}if(t)return new j({algorithm:Di,parameters:F.serialize(new Yr({namedCurve:t}))})}}return null}toWebAlgorithm(e){switch(e.algorithm){case au:return{name:Ve,hash:{name:"SHA-1"}};case cu:return{name:Ve,hash:{name:"SHA-256"}};case uu:return{name:Ve,hash:{name:"SHA-384"}};case lu:return{name:Ve,hash:{name:"SHA-512"}};case Di:{if(!e.parameters)throw new TypeError("Cannot get required parameters from EC algorithm");switch(F.parse(e.parameters,Yr).namedCurve){case Ey:return{name:Ve,namedCurve:"P-256"};case Nh.SECP256K1:return{name:Ve,namedCurve:"K-256"};case _y:return{name:Ve,namedCurve:"P-384"};case Cy:return{name:Ve,namedCurve:"P-521"};case I1:return{name:Ve,namedCurve:V1};case T1:return{name:Ve,namedCurve:$1};case k1:return{name:Ve,namedCurve:F1};case O1:return{name:Ve,namedCurve:W1};case P1:return{name:Ve,namedCurve:q1};case N1:return{name:Ve,namedCurve:G1};case D1:return{name:Ve,namedCurve:z1};case R1:return{name:Ve,namedCurve:X1};case L1:return{name:Ve,namedCurve:Z1};case U1:return{name:Ve,namedCurve:Y1};case M1:return{name:Ve,namedCurve:J1};case j1:return{name:Ve,namedCurve:Q1};case K1:return{name:Ve,namedCurve:eA};case H1:return{name:Ve,namedCurve:tA}}}}return null}};Vu.SECP256K1="1.3.132.0.10";Vu=Nh=u([So()],Vu);De.registerSingleton(qu,Vu);var hA=Symbol("name"),pA=Symbol("value"),_e=class{constructor(e,t={},n=""){this[hA]=e,this[pA]=n;for(let o in t)this[o]=t[o]}};_e.NAME=hA;_e.VALUE=pA;var dg=class{static toTextObject(e){let t=new _e("Algorithm Identifier",{},rn.toString(e.algorithm));if(e.parameters)switch(e.algorithm){case Di:{let n=new Vu().toWebAlgorithm(e);n&&"namedCurve"in n?t["Named Curve"]=n.namedCurve:t.Parameters=e.parameters;break}default:t.Parameters=e.parameters}return t}},rn=class{static toString(e){let t=this.items[e];return t||e}};rn.items={[Li]:"sha1",[mh]:"sha224",[Ui]:"sha256",[Mi]:"sha384",[ji]:"sha512",[Jr]:"rsaEncryption",[Ys]:"sha1WithRSAEncryption",[_v]:"sha224WithRSAEncryption",[dh]:"sha256WithRSAEncryption",[Js]:"sha384WithRSAEncryption",[Qs]:"sha512WithRSAEncryption",[Di]:"ecPublicKey",[au]:"ecdsaWithSHA1",[ph]:"ecdsaWithSHA224",[cu]:"ecdsaWithSHA256",[uu]:"ecdsaWithSHA384",[lu]:"ecdsaWithSHA512",[Yx]:"TLS WWW server authentication",[Jx]:"TLS WWW client authentication",[Qx]:"Code Signing",[ev]:"E-mail Protection",[tv]:"Time Stamping",[rv]:"OCSP Signing",[mv]:"Signed Data"};var Nn=class{static serialize(e){return this.serializeObj(e).join(`
`)}static pad(e=0){return"".padStart(2*e," ")}static serializeObj(e,t=0){let n=[],o=this.pad(t++),i="",s=e[_e.VALUE];s&&(i=` ${s}`),n.push(`${o}${e[_e.NAME]}:${i}`),o=this.pad(t);for(let a in e){if(typeof a=="symbol")continue;let c=e[a],f=a?`${a}: `:"";if(typeof c=="string"||typeof c=="number"||typeof c=="boolean")n.push(`${o}${f}${c}`);else if(c instanceof Date)n.push(`${o}${f}${c.toUTCString()}`);else if(Array.isArray(c))for(let p of c)p[_e.NAME]=a,n.push(...this.serializeObj(p,t));else if(c instanceof _e)c[_e.NAME]=a,n.push(...this.serializeObj(c,t));else if(H.BufferSourceConverter.isBufferSource(c))a?(n.push(`${o}${f}`),n.push(...this.serializeBufferSource(c,t+1))):n.push(...this.serializeBufferSource(c,t));else if("toTextObject"in c){let p=c.toTextObject();p[_e.NAME]=a,n.push(...this.serializeObj(p,t))}else throw new TypeError("Cannot serialize data in text format. Unsupported type.")}return n}static serializeBufferSource(e,t=0){let n=this.pad(t),o=H.BufferSourceConverter.toUint8Array(e),i=[];for(let s=0;s<o.length;){let a=[];for(let c=0;c<16&&s<o.length;c++){c===8&&a.push("");let f=o[s++].toString(16).padStart(2,"0");a.push(f)}i.push(`${n}${a.join(" ")}`)}return i}static serializeAlgorithm(e){return this.algorithmSerializer.toTextObject(e)}};Nn.oidSerializer=rn;Nn.algorithmSerializer=dg;var ca,Io=class r{get rawData(){return he(this,ca,"f")||Me(this,ca,F.serialize(this.asn),"f"),he(this,ca,"f")}constructor(...e){ca.set(this,void 0),H.BufferSourceConverter.isBufferSource(e[0])?(this.asn=F.parse(e[0],e[1]),Me(this,ca,H.BufferSourceConverter.toArrayBuffer(e[0]),"f"),this.onInit(this.asn)):(this.asn=e[0],this.onInit(this.asn))}equal(e){return e instanceof r?(0,H.isEqual)(e.rawData,this.rawData):!1}toString(e="text"){switch(e){case"asn":return F.toString(this.rawData);case"text":return Nn.serialize(this.toTextObject());case"hex":return H.Convert.ToHex(this.rawData);case"base64":return H.Convert.ToBase64(this.rawData);case"base64url":return H.Convert.ToBase64Url(this.rawData);default:throw TypeError("Argument 'format' is unsupported value")}}getTextName(){return this.constructor.NAME}toTextObject(){let e=this.toTextObjectEmpty();return e[""]=this.rawData,e}toTextObjectEmpty(e){return new _e(this.getTextName(),{},e)}};ca=new WeakMap;Io.NAME="ASN";var Qt=class r extends Io{constructor(...e){let t;H.BufferSourceConverter.isBufferSource(e[0])?t=H.BufferSourceConverter.toArrayBuffer(e[0]):t=F.serialize(new gt({extnID:e[0],critical:e[1],extnValue:new ie(H.BufferSourceConverter.toArrayBuffer(e[2]))})),super(t,gt)}onInit(e){this.type=e.extnID,this.critical=e.critical,this.value=e.extnValue.buffer}toTextObject(){let e=this.toTextObjectWithoutValue();return e[""]=this.value,e}toTextObjectWithoutValue(){let e=this.toTextObjectEmpty(this.critical?"critical":void 0);return e[_e.NAME]===r.NAME&&(e[_e.NAME]=rn.toString(this.type)),e}},dA,$u=class r{static isCryptoKeyPair(e){return e&&e.privateKey&&e.publicKey}static isCryptoKey(e){return e&&e.usages&&e.type&&e.algorithm&&e.extractable!==void 0}constructor(){this.items=new Map,this[dA]="CryptoProvider",typeof self<"u"&&typeof crypto<"u"?this.set(r.DEFAULT,crypto):typeof globalThis<"u"&&globalThis.crypto&&globalThis.crypto.subtle&&this.set(r.DEFAULT,globalThis.crypto)}clear(){this.items.clear()}delete(e){return this.items.delete(e)}forEach(e,t){return this.items.forEach(e,t)}has(e){return this.items.has(e)}get size(){return this.items.size}entries(){return this.items.entries()}keys(){return this.items.keys()}values(){return this.items.values()}[Symbol.iterator](){return this.items[Symbol.iterator]()}get(e=r.DEFAULT){let t=this.items.get(e.toLowerCase());if(!t)throw new Error(`Cannot get Crypto by name '${e}'`);return t}set(e,t){if(typeof e=="string"){if(!t)throw new TypeError("Argument 'value' is required");this.items.set(e.toLowerCase(),t)}else this.items.set(r.DEFAULT,e);return this}};dA=Symbol.toStringTag;$u.DEFAULT="default";var ut=new $u,lB=/^[0-2](?:\.[1-9][0-9]*)+$/;function fB(r){return new RegExp(lB).test(r)}var Rh=class{constructor(e={}){this.items={};for(let t in e)this.register(t,e[t])}get(e){return this.items[e]||null}findId(e){return fB(e)?e:this.get(e)}register(e,t){this.items[e]=t,this.items[t]=e}},qt=new Rh;qt.register("CN","2.5.4.3");qt.register("L","2.5.4.7");qt.register("ST","2.5.4.8");qt.register("O","2.5.4.10");qt.register("OU","2.5.4.11");qt.register("C","2.5.4.6");qt.register("DC","0.9.2342.19200300.100.1.25");qt.register("E","1.2.840.113549.1.9.1");qt.register("G","2.5.4.42");qt.register("I","2.5.4.43");qt.register("SN","2.5.4.4");qt.register("T","2.5.4.12");function hB(r,e){return`\\${H.Convert.ToHex(H.Convert.FromUtf8String(e)).toUpperCase()}`}function pB(r){return r.replace(/([,+"\\<>;])/g,"\\$1").replace(/^([ #])/,"\\$1").replace(/([ ]$)/,"\\$1").replace(/([\r\n\t])/,hB)}var Dr=class r{static isASCII(e){for(let t=0;t<e.length;t++)if(e.charCodeAt(t)>255)return!1;return!0}static isPrintableString(e){return/^[A-Za-z0-9 '()+,-./:=?]*$/g.test(e)}constructor(e,t={}){this.extraNames=new Rh,this.asn=new Oe;for(let n in t)if(Object.prototype.hasOwnProperty.call(t,n)){let o=t[n];this.extraNames.register(n,o)}typeof e=="string"?this.asn=this.fromString(e):e instanceof Oe?this.asn=e:H.BufferSourceConverter.isBufferSource(e)?this.asn=F.parse(e,Oe):this.asn=this.fromJSON(e)}getField(e){let t=this.extraNames.findId(e)||qt.findId(e),n=[];for(let o of this.asn)for(let i of o)i.type===t&&n.push(i.value.toString());return n}getName(e){return this.extraNames.get(e)||qt.get(e)}toString(){return this.asn.map(e=>e.map(t=>{let n=this.getName(t.type)||t.type,o=t.value.anyValue?`#${H.Convert.ToHex(t.value.anyValue)}`:pB(t.value.toString());return`${n}=${o}`}).join("+")).join(", ")}toJSON(){var e;let t=[];for(let n of this.asn){let o={};for(let i of n){let s=this.getName(i.type)||i.type;(e=o[s])!==null&&e!==void 0||(o[s]=[]),o[s].push(i.value.anyValue?`#${H.Convert.ToHex(i.value.anyValue)}`:i.value.toString())}t.push(o)}return t}fromString(e){let t=new Oe,n=/(\d\.[\d.]*\d|[A-Za-z]+)=((?:"")|(?:".*?[^\\]")|(?:[^,+"\\](?=[,+]|$))|(?:[^,+].*?(?:[^\\][,+]))|(?:))([,+])?/g,o=null,i=",";for(;o=n.exec(`${e},`);){let[,s,a]=o,c=a[a.length-1];(c===","||c==="+")&&(a=a.slice(0,a.length-1),o[3]=c);let f=o[3];s=this.getTypeOid(s);let p=this.createAttribute(s,a);i==="+"?t[t.length-1].push(p):t.push(new co([p])),i=f}return t}fromJSON(e){let t=new Oe;for(let n of e){let o=new co;for(let i in n){let s=this.getTypeOid(i),a=n[i];for(let c of a){let f=this.createAttribute(s,c);o.push(f)}}t.push(o)}return t}getTypeOid(e){if(/[\d.]+/.test(e)||(e=this.getName(e)||""),!e)throw new Error(`Cannot get OID for name type '${e}'`);return e}createAttribute(e,t){let n=new di({type:e});if(typeof t=="object")for(let o in t)switch(o){case"ia5String":n.value.ia5String=t[o];break;case"utf8String":n.value.utf8String=t[o];break;case"universalString":n.value.universalString=t[o];break;case"bmpString":n.value.bmpString=t[o];break;case"printableString":n.value.printableString=t[o];break}else if(t[0]==="#")n.value.anyValue=H.Convert.FromHex(t.slice(1));else{let o=this.processStringValue(t);e===this.getName("E")||e===this.getName("DC")?n.value.ia5String=o:r.isPrintableString(o)?n.value.printableString=o:n.value.utf8String=o}return n}processStringValue(e){let t=/"(.*?[^\\])?"/.exec(e);return t&&(e=t[1]),e.replace(/\\0a/ig,`
`).replace(/\\0d/ig,"\r").replace(/\\0g/ig,"	").replace(/\\(.)/g,"$1")}toArrayBuffer(){return F.serialize(this.asn)}async getThumbprint(...e){var t;let n,o="SHA-1";return e.length>=1&&!(!((t=e[0])===null||t===void 0)&&t.subtle)?(o=e[0]||o,n=e[1]||ut.get()):n=e[0]||ut.get(),await n.subtle.digest(o,this.toArrayBuffer())}},mA="Cannot initialize GeneralName from ASN.1 data.",rA=`${mA} Unsupported string format in use.`,dB=`${mA} Value doesn't match to GUID regular expression.`,nA=/^([0-9a-f]{8})-?([0-9a-f]{4})-?([0-9a-f]{4})-?([0-9a-f]{4})-?([0-9a-f]{12})$/i,oA="1.3.6.1.4.1.311.25.1",iA="1.3.6.1.4.1.311.20.2.3",og="dns",ig="dn",sg="email",ag="ip",cg="url",ug="guid",lg="upn",kh="id",tn=class extends Io{constructor(...e){let t;if(e.length===2)switch(e[0]){case ig:{let n=new Dr(e[1]).toArrayBuffer(),o=F.parse(n,Oe);t=new ae({directoryName:o});break}case og:t=new ae({dNSName:e[1]});break;case sg:t=new ae({rfc822Name:e[1]});break;case ug:{let n=new RegExp(nA,"i").exec(e[1]);if(!n)throw new Error("Cannot parse GUID value. Value doesn't match to regular expression");let o=n.slice(1).map((i,s)=>s<3?H.Convert.ToHex(new Uint8Array(H.Convert.FromHex(i)).reverse()):i).join("");t=new ae({otherName:new uo({typeId:oA,value:F.serialize(new ie(H.Convert.FromHex(o)))})});break}case ag:t=new ae({iPAddress:e[1]});break;case kh:t=new ae({registeredID:e[1]});break;case lg:{t=new ae({otherName:new uo({typeId:iA,value:F.serialize(Dm.toASN(e[1]))})});break}case cg:t=new ae({uniformResourceIdentifier:e[1]});break;default:throw new Error("Cannot create GeneralName. Unsupported type of the name")}else H.BufferSourceConverter.isBufferSource(e[0])?t=F.parse(e[0],ae):t=e[0];super(t)}onInit(e){if(e.dNSName!=null)this.type=og,this.value=e.dNSName;else if(e.rfc822Name!=null)this.type=sg,this.value=e.rfc822Name;else if(e.iPAddress!=null)this.type=ag,this.value=e.iPAddress;else if(e.uniformResourceIdentifier!=null)this.type=cg,this.value=e.uniformResourceIdentifier;else if(e.registeredID!=null)this.type=kh,this.value=e.registeredID;else if(e.directoryName!=null)this.type=ig,this.value=new Dr(e.directoryName).toString();else if(e.otherName!=null)if(e.otherName.typeId===oA){this.type=ug;let t=F.parse(e.otherName.value,ie),n=new RegExp(nA,"i").exec(H.Convert.ToHex(t));if(!n)throw new Error(dB);this.value=n.slice(1).map((o,i)=>i<3?H.Convert.ToHex(new Uint8Array(H.Convert.FromHex(o)).reverse()):o).join("-")}else if(e.otherName.typeId===iA)this.type=lg,this.value=F.parse(e.otherName.value,et).toString();else throw new Error(rA);else throw new Error(rA)}toJSON(){return{type:this.type,value:this.value}}toTextObject(){let e;switch(this.type){case ig:case og:case ug:case ag:case kh:case lg:case cg:e=this.type.toUpperCase();break;case sg:e="Email";break;default:throw new Error("Unsupported GeneralName type")}let t=this.value;return this.type===kh&&(t=rn.toString(t)),new _e(e,void 0,t)}},Dn=class extends Io{constructor(e){let t;if(e instanceof je)t=e;else if(Array.isArray(e)){let n=[];for(let o of e)if(o instanceof ae)n.push(o);else{let i=F.parse(new tn(o.type,o.value).rawData,ae);n.push(i)}t=new je(n)}else if(H.BufferSourceConverter.isBufferSource(e))t=F.parse(e,je);else throw new Error("Cannot initialize GeneralNames. Incorrect incoming arguments");super(t)}onInit(e){let t=[];for(let n of e){let o=null;try{o=new tn(n)}catch{continue}t.push(o)}this.items=t}toJSON(){return this.items.map(e=>e.toJSON())}toTextObject(){let e=super.toTextObjectEmpty();for(let t of this.items){let n=t.toTextObject(),o=e[n[_e.NAME]];Array.isArray(o)||(o=[],e[n[_e.NAME]]=o),o.push(n)}return e}};Dn.NAME="GeneralNames";var Hu="-{5}",Fu="\\n",mB=`[^${Fu}]+`,yB=`${Hu}BEGIN (${mB}(?=${Hu}))${Hu}`,gB=`${Hu}END \\1${Hu}`,fa="\\n",bB=`[^:${Fu}]+`,wB=`(?:[^${Fu}]+${fa}(?: +[^${Fu}]+${fa})*)`,xB="[a-zA-Z0-9=+/]+",vB=`(?:${xB}${fa})+`,sA=`${yB}${fa}(?:((?:${bB}: ${wB})+))?${fa}?(${vB})${gB}`,Dt=class{static isPem(e){return typeof e=="string"&&new RegExp(sA,"g").test(e.replace(/\r/g,""))}static decodeWithHeaders(e){e=e.replace(/\r/g,"");let t=new RegExp(sA,"g"),n=[],o=null;for(;o=t.exec(e);){let i=o[3].replace(new RegExp(`[${Fu}]+`,"g"),""),s={type:o[1],headers:[],rawData:H.Convert.FromBase64(i)},a=o[2];if(a){let c=a.split(new RegExp(fa,"g")),f=null;for(let p of c){let[h,y]=p.split(/:(.*)/);if(y===void 0){if(!f)throw new Error("Cannot parse PEM string. Incorrect header value");f.value+=h.trim()}else f&&s.headers.push(f),f={key:h,value:y.trim()}}f&&s.headers.push(f)}n.push(s)}return n}static decode(e){return this.decodeWithHeaders(e).map(n=>n.rawData)}static decodeFirst(e){let t=this.decode(e);if(!t.length)throw new RangeError("PEM string doesn't contain any objects");return t[0]}static encode(e,t){if(Array.isArray(e)){let n=new Array;return t?e.forEach(o=>{if(!H.BufferSourceConverter.isBufferSource(o))throw new TypeError("Cannot encode array of BufferSource in PEM format. Not all items of the array are BufferSource");n.push(this.encodeStruct({type:t,rawData:H.BufferSourceConverter.toArrayBuffer(o)}))}):e.forEach(o=>{if(!("type"in o))throw new TypeError("Cannot encode array of PemStruct in PEM format. Not all items of the array are PemStrut");n.push(this.encodeStruct(o))}),n.join(`
`)}else{if(!t)throw new Error("Required argument 'tag' is missed");return this.encodeStruct({type:t,rawData:H.BufferSourceConverter.toArrayBuffer(e)})}}static encodeStruct(e){var t;let n=e.type.toLocaleUpperCase(),o=[];if(o.push(`-----BEGIN ${n}-----`),!((t=e.headers)===null||t===void 0)&&t.length){for(let f of e.headers)o.push(`${f.key}: ${f.value}`);o.push("")}let i=H.Convert.ToBase64(e.rawData),s,a=0,c=Array();for(;a<i.length&&(i.length-a<64?s=i.substring(a):(s=i.substring(a,a+64),a+=64),s.length!==0);)if(c.push(s),s.length<64)break;return o.push(...c),o.push(`-----END ${n}-----`),o.join(`
`)}};Dt.CertificateTag="CERTIFICATE";Dt.CrlTag="CRL";Dt.CertificateRequestTag="CERTIFICATE REQUEST";Dt.PublicKeyTag="PUBLIC KEY";Dt.PrivateKeyTag="PRIVATE KEY";var To=class r extends Io{static isAsnEncoded(e){return H.BufferSourceConverter.isBufferSource(e)||typeof e=="string"}static toArrayBuffer(e){if(typeof e=="string"){if(Dt.isPem(e))return Dt.decode(e)[0];if(H.Convert.isHex(e))return H.Convert.FromHex(e);if(H.Convert.isBase64(e))return H.Convert.FromBase64(e);if(H.Convert.isBase64Url(e))return H.Convert.FromBase64Url(e);throw new TypeError("Unsupported format of 'raw' argument. Must be one of DER, PEM, HEX, Base64, or Base4Url")}else{let t=H.BufferSourceConverter.toUint8Array(e);if(t.length>0&&t[0]===48)return H.BufferSourceConverter.toArrayBuffer(e);let n=H.Convert.ToBinary(e);if(Dt.isPem(n))return Dt.decode(n)[0];if(H.Convert.isHex(n))return H.Convert.FromHex(n);if(H.Convert.isBase64(n))return H.Convert.FromBase64(n);if(H.Convert.isBase64Url(n))return H.Convert.FromBase64Url(n);throw new TypeError("Unsupported format of 'raw' argument. Must be one of DER, PEM, HEX, Base64, or Base4Url")}}constructor(...e){r.isAsnEncoded(e[0])?super(r.toArrayBuffer(e[0]),e[1]):super(e[0])}toString(e="pem"){switch(e){case"pem":return Dt.encode(this.rawData,this.tag);default:return super.toString(e)}}},Pn=class r extends To{static async create(e,t=ut.get()){if(e instanceof r)return e;if($u.isCryptoKey(e)){if(e.type!=="public")throw new TypeError("Public key is required");let n=await t.subtle.exportKey("spki",e);return new r(n)}else{if(e.publicKey)return e.publicKey;if(H.BufferSourceConverter.isBufferSource(e))return new r(e);throw new TypeError("Unsupported PublicKeyType")}}constructor(e){To.isAsnEncoded(e)?super(e,yt):super(e),this.tag=Dt.PublicKeyTag}async export(...e){let t,n=["verify"],o={hash:"SHA-256",...this.algorithm};e.length>1?(o=e[0]||o,n=e[1]||n,t=e[2]||ut.get()):t=e[0]||ut.get();let i=this.rawData,s=F.parse(this.rawData,yt);return s.algorithm.algorithm===xo&&(i=AB(s,i)),t.subtle.importKey("spki",i,o,!0,n)}onInit(e){let t=De.resolve(qi),n=this.algorithm=t.toWebAlgorithm(e.algorithm);switch(e.algorithm.algorithm){case Jr:{let o=F.parse(e.subjectPublicKey,ra),i=H.BufferSourceConverter.toUint8Array(o.modulus);n.publicExponent=H.BufferSourceConverter.toUint8Array(o.publicExponent),n.modulusLength=(i[0]?i:i.slice(1)).byteLength<<3;break}}}async getThumbprint(...e){var t;let n,o="SHA-1";return e.length>=1&&!(!((t=e[0])===null||t===void 0)&&t.subtle)?(o=e[0]||o,n=e[1]||ut.get()):n=e[0]||ut.get(),await n.subtle.digest(o,this.rawData)}async getKeyIdentifier(...e){let t,n="SHA-1";e.length===1?typeof e[0]=="string"?(n=e[0],t=ut.get()):t=e[0]:e.length===2?(n=e[0],t=e[1]):t=ut.get();let o=F.parse(this.rawData,yt);return await t.subtle.digest(n,o.subjectPublicKey)}toTextObject(){let e=this.toTextObjectEmpty(),t=F.parse(this.rawData,yt);switch(e.Algorithm=Nn.serializeAlgorithm(t.algorithm),t.algorithm.algorithm){case Di:e["EC Point"]=t.subjectPublicKey;break;case Jr:default:e["Raw Data"]=t.subjectPublicKey}return e}};function AB(r,e){return r.algorithm=new j({algorithm:Jr,parameters:null}),e=F.serialize(r),e}var Lh=class r extends Qt{static async create(e,t=!1,n=ut.get()){if("name"in e&&"serialNumber"in e)return new r(e,t);let i=await(await Pn.create(e,n)).getKeyIdentifier(n);return new r(H.Convert.ToHex(i),t)}constructor(...e){if(H.BufferSourceConverter.isBufferSource(e[0]))super(e[0]);else if(typeof e[0]=="string"){let t=new Gr({keyIdentifier:new gi(H.Convert.FromHex(e[0]))});super(qf,e[1],F.serialize(t))}else{let t=e[0],n=t.name instanceof Dn?F.parse(t.name.rawData,je):t.name,o=new Gr({authorityCertIssuer:n,authorityCertSerialNumber:H.Convert.FromHex(t.serialNumber)});super(qf,e[1],F.serialize(o))}}onInit(e){super.onInit(e);let t=F.parse(e.extnValue,Gr);t.keyIdentifier&&(this.keyId=H.Convert.ToHex(t.keyIdentifier)),(t.authorityCertIssuer||t.authorityCertSerialNumber)&&(this.certId={name:t.authorityCertIssuer||[],serialNumber:t.authorityCertSerialNumber?H.Convert.ToHex(t.authorityCertSerialNumber):""})}toTextObject(){let e=this.toTextObjectWithoutValue(),t=F.parse(this.value,Gr);return t.authorityCertIssuer&&(e["Authority Issuer"]=new Dn(t.authorityCertIssuer).toTextObject()),t.authorityCertSerialNumber&&(e["Authority Serial Number"]=t.authorityCertSerialNumber),t.keyIdentifier&&(e[""]=t.keyIdentifier),e}};Lh.NAME="Authority Key Identifier";var ha=class extends Qt{constructor(...e){if(H.BufferSourceConverter.isBufferSource(e[0])){super(e[0]);let t=F.parse(this.value,bi);this.ca=t.cA,this.pathLength=t.pathLenConstraint}else{let t=new bi({cA:e[0],pathLenConstraint:e[1]});super(Gf,e[2],F.serialize(t)),this.ca=e[0],this.pathLength=e[1]}}toTextObject(){let e=this.toTextObjectWithoutValue();return this.ca&&(e.CA=this.ca),this.pathLength!==void 0&&(e["Path Length"]=this.pathLength),e}};ha.NAME="Basic Constraints";var aA;(function(r){r.serverAuth="1.3.6.1.5.5.7.3.1",r.clientAuth="1.3.6.1.5.5.7.3.2",r.codeSigning="1.3.6.1.5.5.7.3.3",r.emailProtection="1.3.6.1.5.5.7.3.4",r.timeStamping="1.3.6.1.5.5.7.3.8",r.ocspSigning="1.3.6.1.5.5.7.3.9"})(aA||(aA={}));var Uh=class extends Qt{constructor(...e){if(H.BufferSourceConverter.isBufferSource(e[0])){super(e[0]);let t=F.parse(this.value,Vc);this.usages=t.map(n=>n)}else{let t=new Vc(e[0]);super(Yf,e[1],F.serialize(t)),this.usages=e[0]}}toTextObject(){let e=this.toTextObjectWithoutValue();return e[""]=this.usages.map(t=>rn.toString(t)).join(", "),e}};Uh.NAME="Extended Key Usages";var cA;(function(r){r[r.digitalSignature=1]="digitalSignature",r[r.nonRepudiation=2]="nonRepudiation",r[r.keyEncipherment=4]="keyEncipherment",r[r.dataEncipherment=8]="dataEncipherment",r[r.keyAgreement=16]="keyAgreement",r[r.keyCertSign=32]="keyCertSign",r[r.cRLSign=64]="cRLSign",r[r.encipherOnly=128]="encipherOnly",r[r.decipherOnly=256]="decipherOnly"})(cA||(cA={}));var Mh=class extends Qt{constructor(...e){if(H.BufferSourceConverter.isBufferSource(e[0])){super(e[0]);let t=F.parse(this.value,Ds);this.usages=t.toNumber()}else{let t=new Ds(e[0]);super(Jf,e[1],F.serialize(t)),this.usages=e[0]}}toTextObject(){let e=this.toTextObjectWithoutValue(),t=F.parse(this.value,Ds);return e[""]=t.toJSON().join(", "),e}};Mh.NAME="Key Usages";var jh=class r extends Qt{static async create(e,t=!1,n=ut.get()){let i=await(await Pn.create(e,n)).getKeyIdentifier(n);return new r(H.Convert.ToHex(i),t)}constructor(...e){if(H.BufferSourceConverter.isBufferSource(e[0])){super(e[0]);let t=F.parse(this.value,Ht);this.keyId=H.Convert.ToHex(t)}else{let t=typeof e[0]=="string"?H.Convert.FromHex(e[0]):e[0],n=new Ht(t);super(ay,e[1],F.serialize(n)),this.keyId=H.Convert.ToHex(t)}}toTextObject(){let e=this.toTextObjectWithoutValue(),t=F.parse(this.value,Ht);return e[""]=t,e}};jh.NAME="Subject Key Identifier";var Kh=class extends Qt{constructor(...e){H.BufferSourceConverter.isBufferSource(e[0])?super(e[0]):super(iy,e[1],new Dn(e[0]||[]).rawData)}onInit(e){super.onInit(e);let t=F.parse(e.extnValue,rh);this.names=new Dn(t)}toTextObject(){let e=this.toTextObjectWithoutValue(),t=this.names.toTextObject();for(let n in t)e[n]=t[n];return e}};Kh.NAME="Subject Alternative Name";var Rt=class{static register(e,t){this.items.set(e,t)}static create(e){let t=new Qt(e),n=this.items.get(t.type);return n?new n(e):t}};Rt.items=new Map;var Hh=class extends Qt{constructor(...e){var t;if(H.BufferSourceConverter.isBufferSource(e[0])){super(e[0]);let n=F.parse(this.value,Uc);this.policies=n.map(o=>o.policyIdentifier)}else{let n=e[0],o=(t=e[1])!==null&&t!==void 0?t:!1,i=new Uc(n.map(s=>new wi({policyIdentifier:s})));super(Xf,o,F.serialize(i)),this.policies=n}}toTextObject(){let e=this.toTextObjectWithoutValue();return e.Policy=this.policies.map(t=>new _e("",{},rn.toString(t))),e}};Hh.NAME="Certificate Policies";Rt.register(Xf,Hh);var Vh=class extends Qt{constructor(...e){var t;if(H.BufferSourceConverter.isBufferSource(e[0]))super(e[0]);else if(Array.isArray(e[0])&&typeof e[0][0]=="string"){let o=e[0].map(s=>new zr({distributionPoint:new Cn({fullName:[new ae({uniformResourceIdentifier:s})]})})),i=new ho(o);super(Zf,e[1],F.serialize(i))}else{let n=new ho(e[0]);super(Zf,e[1],F.serialize(n))}(t=this.distributionPoints)!==null&&t!==void 0||(this.distributionPoints=[])}onInit(e){super.onInit(e);let t=F.parse(e.extnValue,ho);this.distributionPoints=t}toTextObject(){let e=this.toTextObjectWithoutValue();return e["Distribution Point"]=this.distributionPoints.map(t=>{var n;let o={};return t.distributionPoint&&(o[""]=(n=t.distributionPoint.fullName)===null||n===void 0?void 0:n.map(i=>new tn(i).toString()).join(", ")),t.reasons&&(o.Reasons=t.reasons.toString()),t.cRLIssuer&&(o["CRL Issuer"]=t.cRLIssuer.map(i=>i.toString()).join(", ")),o}),e}};Vh.NAME="CRL Distribution Points";var $h=class extends Qt{constructor(...e){var t,n,o,i;if(H.BufferSourceConverter.isBufferSource(e[0]))super(e[0]);else if(e[0]instanceof yi){let s=new yi(e[0]);super(Wf,e[1],F.serialize(s))}else{let s=e[0],a=new yi;Ph(a,s,Vm,"ocsp"),Ph(a,s,$m,"caIssuers"),Ph(a,s,Fm,"timeStamping"),Ph(a,s,Wm,"caRepository"),super(Wf,e[1],F.serialize(a))}(t=this.ocsp)!==null&&t!==void 0||(this.ocsp=[]),(n=this.caIssuers)!==null&&n!==void 0||(this.caIssuers=[]),(o=this.timeStamping)!==null&&o!==void 0||(this.timeStamping=[]),(i=this.caRepository)!==null&&i!==void 0||(this.caRepository=[])}onInit(e){super.onInit(e),this.ocsp=[],this.caIssuers=[],this.timeStamping=[],this.caRepository=[],F.parse(e.extnValue,yi).forEach(n=>{switch(n.accessMethod){case Vm:this.ocsp.push(new tn(n.accessLocation));break;case $m:this.caIssuers.push(new tn(n.accessLocation));break;case Fm:this.timeStamping.push(new tn(n.accessLocation));break;case Wm:this.caRepository.push(new tn(n.accessLocation));break}})}toTextObject(){let e=this.toTextObjectWithoutValue();return this.ocsp.length&&Oh(e,"OCSP",this.ocsp),this.caIssuers.length&&Oh(e,"CA Issuers",this.caIssuers),this.timeStamping.length&&Oh(e,"Time Stamping",this.timeStamping),this.caRepository.length&&Oh(e,"CA Repository",this.caRepository),e}};$h.NAME="Authority Info Access";function Oh(r,e,t){if(t.length===1)r[e]=t[0].toTextObject();else{let n=new _e("");t.forEach((o,i)=>{let s=o.toTextObject(),a=`${s[_e.NAME]} ${i+1}`,c=n[a];Array.isArray(c)||(c=[],n[a]=c),c.push(s)}),r[e]=n}}function Ph(r,e,t,n){let o=e[n];o&&(Array.isArray(o)?o:[o]).forEach(s=>{typeof s=="string"&&(s=new tn("url",s)),r.push(new En({accessMethod:t,accessLocation:F.parse(s.rawData,ae)}))})}var Fh=class extends Qt{constructor(...e){H.BufferSourceConverter.isBufferSource(e[0])?super(e[0]):super(ty,e[1],new Dn(e[0]||[]).rawData)}onInit(e){super.onInit(e);let t=F.parse(e.extnValue,je);this.names=new Dn(t)}toTextObject(){let e=this.toTextObjectWithoutValue(),t=this.names.toTextObject();for(let n in t)e[n]=t[n];return e}};Fh.NAME="Issuer Alternative Name";var pa=class r extends Io{constructor(...e){let t;if(H.BufferSourceConverter.isBufferSource(e[0]))t=H.BufferSourceConverter.toArrayBuffer(e[0]);else{let n=e[0],o=Array.isArray(e[1])?e[1].map(i=>H.BufferSourceConverter.toArrayBuffer(i)):[];t=F.serialize(new mt({type:n,values:o}))}super(t,mt)}onInit(e){this.type=e.type,this.values=e.values}toTextObject(){let e=this.toTextObjectWithoutValue();return e.Value=this.values.map(t=>new _e("",{"":t})),e}toTextObjectWithoutValue(){let e=this.toTextObjectEmpty();return e[_e.NAME]===r.NAME&&(e[_e.NAME]=rn.toString(this.type)),e}};pa.NAME="Attribute";var Wh=class extends pa{constructor(...e){var t;if(H.BufferSourceConverter.isBufferSource(e[0]))super(e[0]);else{let n=new bu({printableString:e[0]});super(rg,[F.serialize(n)])}(t=this.password)!==null&&t!==void 0||(this.password="")}onInit(e){if(super.onInit(e),this.values[0]){let t=F.parse(this.values[0],bu);this.password=t.toString()}}toTextObject(){let e=this.toTextObjectWithoutValue();return e[_e.VALUE]=this.password,e}};Wh.NAME="Challenge Password";var Wu=class extends pa{constructor(...e){var t;if(H.BufferSourceConverter.isBufferSource(e[0]))super(e[0]);else{let n=e[0],o=new Yt;for(let i of n)o.push(F.parse(i.rawData,gt));super(xu,[F.serialize(o)])}(t=this.items)!==null&&t!==void 0||(this.items=[])}onInit(e){if(super.onInit(e),this.values[0]){let t=F.parse(this.values[0],Yt);this.items=t.map(n=>Rt.create(F.serialize(n)))}}toTextObject(){let e=this.toTextObjectWithoutValue(),t=this.items.map(n=>n.toTextObject());for(let n of t)e[n[_e.NAME]]=n;return e}};Wu.NAME="Extensions";var da=class{static register(e,t){this.items.set(e,t)}static create(e){let t=new pa(e),n=this.items.get(t.type);return n?new n(e):t}};da.items=new Map;var Gu="crypto.signatureFormatter",mg=class{toAsnSignature(e,t){return H.BufferSourceConverter.toArrayBuffer(t)}toWebSignature(e,t){return H.BufferSourceConverter.toArrayBuffer(t)}},Dh,yg=Dh=class{static createPssParams(e,t){let n=Dh.getHashAlgorithm(e);return n?new Qr({hashAlgorithm:n,maskGenAlgorithm:new j({algorithm:vo,parameters:F.serialize(n)}),saltLength:t}):null}static getHashAlgorithm(e){let t=De.resolve(qi);return typeof e=="string"?t.toAsnAlgorithm({name:e}):typeof e=="object"&&e&&"name"in e?t.toAsnAlgorithm(e):null}toAsnAlgorithm(e){switch(e.name.toLowerCase()){case"rsassa-pkcs1-v1_5":if("hash"in e){let t;if(typeof e.hash=="string")t=e.hash;else if(e.hash&&typeof e.hash=="object"&&"name"in e.hash&&typeof e.hash.name=="string")t=e.hash.name.toUpperCase();else throw new Error("Cannot get hash algorithm name");switch(t.toLowerCase()){case"sha-1":return new j({algorithm:Ys,parameters:null});case"sha-256":return new j({algorithm:dh,parameters:null});case"sha-384":return new j({algorithm:Js,parameters:null});case"sha-512":return new j({algorithm:Qs,parameters:null})}}else return new j({algorithm:Jr,parameters:null});break;case"rsa-pss":if("hash"in e){if(!("saltLength"in e&&typeof e.saltLength=="number"))throw new Error("Cannot get 'saltLength' from 'alg' argument");let t=Dh.createPssParams(e.hash,e.saltLength);if(!t)throw new Error("Cannot create PSS parameters");return new j({algorithm:xo,parameters:F.serialize(t)})}else return new j({algorithm:xo,parameters:null})}return null}toWebAlgorithm(e){switch(e.algorithm){case Jr:return{name:"RSASSA-PKCS1-v1_5"};case Ys:return{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-1"}};case dh:return{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}};case Js:return{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-384"}};case Qs:return{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-512"}};case xo:if(e.parameters){let t=F.parse(e.parameters,Qr);return{name:"RSA-PSS",hash:De.resolve(qi).toWebAlgorithm(t.hashAlgorithm),saltLength:t.saltLength}}else return{name:"RSA-PSS"}}return null}};yg=Dh=u([So()],yg);De.registerSingleton(qu,yg);var gg=class{toAsnAlgorithm(e){switch(e.name.toLowerCase()){case"sha-1":return new j({algorithm:Li});case"sha-256":return new j({algorithm:Ui});case"sha-384":return new j({algorithm:Mi});case"sha-512":return new j({algorithm:ji})}return null}toWebAlgorithm(e){switch(e.algorithm){case Li:return{name:"SHA-1"};case Ui:return{name:"SHA-256"};case Mi:return{name:"SHA-384"};case ji:return{name:"SHA-512"}}return null}};gg=u([So()],gg);De.registerSingleton(qu,gg);var Rn=class r{addPadding(e,t){let n=H.BufferSourceConverter.toUint8Array(t),o=new Uint8Array(e);return o.set(n,e-n.length),o.buffer}removePadding(e,t=!1){let n=H.BufferSourceConverter.toUint8Array(e);for(let o=0;o<n.length;o++)if(n[o]){n=n.slice(o);break}if(t&&n[0]>127){let o=new Uint8Array(n.length+1);return o.set(n,1),o.buffer}return n.buffer}toAsnSignature(e,t){if(e.name==="ECDSA"){let n=e.namedCurve,o=r.namedCurveSize.get(n)||r.defaultNamedCurveSize,i=new Ri,s=H.BufferSourceConverter.toUint8Array(t);return i.r=this.removePadding(s.slice(0,o),!0),i.s=this.removePadding(s.slice(o,o+o),!0),F.serialize(i)}return null}toWebSignature(e,t){if(e.name==="ECDSA"){let n=F.parse(t,Ri),o=e.namedCurve,i=r.namedCurveSize.get(o)||r.defaultNamedCurveSize,s=this.addPadding(i,this.removePadding(n.r)),a=this.addPadding(i,this.removePadding(n.s));return(0,H.combine)(s,a)}return null}};Rn.namedCurveSize=new Map;Rn.defaultNamedCurveSize=32;var fg="1.3.101.110",uA="1.3.101.111",hg="1.3.101.112",lA="1.3.101.113",bg=class{toAsnAlgorithm(e){let t=null;switch(e.name.toLowerCase()){case"ed25519":t=hg;break;case"x25519":t=fg;break;case"eddsa":switch(e.namedCurve.toLowerCase()){case"ed25519":t=hg;break;case"ed448":t=lA;break}break;case"ecdh-es":switch(e.namedCurve.toLowerCase()){case"x25519":t=fg;break;case"x448":t=uA;break}}return t?new j({algorithm:t}):null}toWebAlgorithm(e){switch(e.algorithm){case hg:return{name:"Ed25519"};case lA:return{name:"EdDSA",namedCurve:"Ed448"};case fg:return{name:"X25519"};case uA:return{name:"ECDH-ES",namedCurve:"X448"}}return null}};bg=u([So()],bg);De.registerSingleton(qu,bg);var Su,Eu,_u,Cu,Bu,Iu,Tu,ua,wg=class extends To{get subjectName(){return he(this,Eu,"f")||Me(this,Eu,new Dr(this.asn.certificationRequestInfo.subject),"f"),he(this,Eu,"f")}get subject(){return he(this,_u,"f")||Me(this,_u,this.subjectName.toString(),"f"),he(this,_u,"f")}get signatureAlgorithm(){if(!he(this,Cu,"f")){let e=De.resolve(qi);Me(this,Cu,e.toWebAlgorithm(this.asn.signatureAlgorithm),"f")}return he(this,Cu,"f")}get signature(){return he(this,Bu,"f")||Me(this,Bu,this.asn.signature,"f"),he(this,Bu,"f")}get publicKey(){return he(this,Iu,"f")||Me(this,Iu,new Pn(this.asn.certificationRequestInfo.subjectPKInfo),"f"),he(this,Iu,"f")}get attributes(){return he(this,Tu,"f")||Me(this,Tu,this.asn.certificationRequestInfo.attributes.map(e=>da.create(F.serialize(e))),"f"),he(this,Tu,"f")}get extensions(){if(!he(this,ua,"f")){Me(this,ua,[],"f");let e=this.getAttribute(xu);e instanceof Wu&&Me(this,ua,e.items,"f")}return he(this,ua,"f")}get tbs(){return he(this,Su,"f")||Me(this,Su,this.asn.certificationRequestInfoRaw||F.serialize(this.asn.certificationRequestInfo),"f"),he(this,Su,"f")}constructor(e){let t=To.isAsnEncoded(e)?[e,Bo]:[e];super(t[0],t[1]),Su.set(this,void 0),Eu.set(this,void 0),_u.set(this,void 0),Cu.set(this,void 0),Bu.set(this,void 0),Iu.set(this,void 0),Tu.set(this,void 0),ua.set(this,void 0),this.tag=Dt.CertificateRequestTag}onInit(e){}getAttribute(e){for(let t of this.attributes)if(t.type===e)return t;return null}getAttributes(e){return this.attributes.filter(t=>t.type===e)}getExtension(e){for(let t of this.extensions)if(t.type===e)return t;return null}getExtensions(e){return this.extensions.filter(t=>t.type===e)}async verify(e=ut.get()){let t={...this.publicKey.algorithm,...this.signatureAlgorithm},n=await this.publicKey.export(t,["verify"],e),o=De.resolveAll(Gu).reverse(),i=null;for(let a of o)if(i=a.toWebSignature(t,this.signature),i)break;if(!i)throw Error("Cannot convert WebCrypto signature value to ASN.1 format");return await e.subtle.verify(this.signatureAlgorithm,n,i,this.tbs)}toTextObject(){let e=this.toTextObjectEmpty(),t=F.parse(this.rawData,Bo),n=t.certificationRequestInfo,o=new _e("",{Version:`${Xr[n.version]} (${n.version})`,Subject:this.subject,"Subject Public Key Info":this.publicKey});if(this.attributes.length){let i=new _e("");for(let s of this.attributes){let a=s.toTextObject();i[a[_e.NAME]]=a}o.Attributes=i}return e.Data=o,e.Signature=new _e("",{Algorithm:Nn.serializeAlgorithm(t.signatureAlgorithm),"":t.signature}),e}};Su=new WeakMap,Eu=new WeakMap,_u=new WeakMap,Cu=new WeakMap,Bu=new WeakMap,Iu=new WeakMap,Tu=new WeakMap,ua=new WeakMap;wg.NAME="PKCS#10 Certificate Request";var ku,Ou,Pu,Nu,Du,Ru,Lu,Uu,Mu,ju,la,Ku,ma=class extends To{get publicKey(){return he(this,Ku,"f")||Me(this,Ku,new Pn(this.asn.tbsCertificate.subjectPublicKeyInfo),"f"),he(this,Ku,"f")}get serialNumber(){if(!he(this,Ou,"f")){let e=this.asn.tbsCertificate,t=new Uint8Array(e.serialNumber);t.length>1&&t[0]===0&&t[1]>127&&(t=t.slice(1)),Me(this,Ou,H.Convert.ToHex(t),"f")}return he(this,Ou,"f")}get subjectName(){return he(this,Pu,"f")||Me(this,Pu,new Dr(this.asn.tbsCertificate.subject),"f"),he(this,Pu,"f")}get subject(){return he(this,Nu,"f")||Me(this,Nu,this.subjectName.toString(),"f"),he(this,Nu,"f")}get issuerName(){return he(this,Du,"f")||Me(this,Du,new Dr(this.asn.tbsCertificate.issuer),"f"),he(this,Du,"f")}get issuer(){return he(this,Ru,"f")||Me(this,Ru,this.issuerName.toString(),"f"),he(this,Ru,"f")}get notBefore(){if(!he(this,Lu,"f")){let e=this.asn.tbsCertificate.validity.notBefore.utcTime||this.asn.tbsCertificate.validity.notBefore.generalTime;if(!e)throw new Error("Cannot get 'notBefore' value");Me(this,Lu,e,"f")}return he(this,Lu,"f")}get notAfter(){if(!he(this,Uu,"f")){let e=this.asn.tbsCertificate.validity.notAfter.utcTime||this.asn.tbsCertificate.validity.notAfter.generalTime;if(!e)throw new Error("Cannot get 'notAfter' value");Me(this,Uu,e,"f")}return he(this,Uu,"f")}get signatureAlgorithm(){if(!he(this,Mu,"f")){let e=De.resolve(qi);Me(this,Mu,e.toWebAlgorithm(this.asn.signatureAlgorithm),"f")}return he(this,Mu,"f")}get signature(){return he(this,ju,"f")||Me(this,ju,this.asn.signatureValue,"f"),he(this,ju,"f")}get extensions(){return he(this,la,"f")||(Me(this,la,[],"f"),this.asn.tbsCertificate.extensions&&Me(this,la,this.asn.tbsCertificate.extensions.map(e=>Rt.create(F.serialize(e))),"f")),he(this,la,"f")}get tbs(){return he(this,ku,"f")||Me(this,ku,this.asn.tbsCertificateRaw||F.serialize(this.asn.tbsCertificate),"f"),he(this,ku,"f")}constructor(e){let t=To.isAsnEncoded(e)?[e,cr]:[e];super(t[0],t[1]),ku.set(this,void 0),Ou.set(this,void 0),Pu.set(this,void 0),Nu.set(this,void 0),Du.set(this,void 0),Ru.set(this,void 0),Lu.set(this,void 0),Uu.set(this,void 0),Mu.set(this,void 0),ju.set(this,void 0),la.set(this,void 0),Ku.set(this,void 0),this.tag=Dt.CertificateTag}onInit(e){}getExtension(e){for(let t of this.extensions)if(typeof e=="string"){if(t.type===e)return t}else if(t instanceof e)return t;return null}getExtensions(e){return this.extensions.filter(t=>typeof e=="string"?t.type===e:t instanceof e)}async verify(e={},t=ut.get()){let n,o,i=e.publicKey;try{if(!i)n={...this.publicKey.algorithm,...this.signatureAlgorithm},o=await this.publicKey.export(n,["verify"],t);else if("publicKey"in i)n={...i.publicKey.algorithm,...this.signatureAlgorithm},o=await i.publicKey.export(n,["verify"],t);else if(i instanceof Pn)n={...i.algorithm,...this.signatureAlgorithm},o=await i.export(n,["verify"],t);else if(H.BufferSourceConverter.isBufferSource(i)){let f=new Pn(i);n={...f.algorithm,...this.signatureAlgorithm},o=await f.export(n,["verify"],t)}else n={...i.algorithm,...this.signatureAlgorithm},o=i}catch{return!1}let s=De.resolveAll(Gu).reverse(),a=null;for(let f of s)if(a=f.toWebSignature(n,this.signature),a)break;if(!a)throw Error("Cannot convert ASN.1 signature value to WebCrypto format");let c=await t.subtle.verify(this.signatureAlgorithm,o,a,this.tbs);if(e.signatureOnly)return c;{let p=(e.date||new Date).getTime();return c&&this.notBefore.getTime()<p&&p<this.notAfter.getTime()}}async getThumbprint(...e){let t,n="SHA-1";return e[0]&&(e[0].subtle?t=e[0]:(n=e[0]||n,t=e[1])),t??(t=ut.get()),await t.subtle.digest(n,this.rawData)}async isSelfSigned(e=ut.get()){return this.subject===this.issuer&&await this.verify({signatureOnly:!0},e)}toTextObject(){let e=this.toTextObjectEmpty(),t=F.parse(this.rawData,cr),n=t.tbsCertificate,o=new _e("",{Version:`${Xr[n.version]} (${n.version})`,"Serial Number":n.serialNumber,"Signature Algorithm":Nn.serializeAlgorithm(n.signature),Issuer:this.issuer,Validity:new _e("",{"Not Before":n.validity.notBefore.getTime(),"Not After":n.validity.notAfter.getTime()}),Subject:this.subject,"Subject Public Key Info":this.publicKey});if(n.issuerUniqueID&&(o["Issuer Unique ID"]=n.issuerUniqueID),n.subjectUniqueID&&(o["Subject Unique ID"]=n.subjectUniqueID),this.extensions.length){let i=new _e("");for(let s of this.extensions){let a=s.toTextObject();i[a[_e.NAME]]=a}o.Extensions=i}return e.Data=o,e.Signature=new _e("",{Algorithm:Nn.serializeAlgorithm(t.signatureAlgorithm),"":t.signatureValue}),e}};ku=new WeakMap,Ou=new WeakMap,Pu=new WeakMap,Nu=new WeakMap,Du=new WeakMap,Ru=new WeakMap,Lu=new WeakMap,Uu=new WeakMap,Mu=new WeakMap,ju=new WeakMap,la=new WeakMap,Ku=new WeakMap;ma.NAME="Certificate";function SB(r,e=ut.get()){let t=H.BufferSourceConverter.toUint8Array(H.Convert.FromHex(r||"")),n=t&&t.length&&t.some(i=>i>0)?new Uint8Array(t):void 0;n||(n=e.getRandomValues(new Uint8Array(16)));let o=0;for(;o<n.length-1&&n[o]===0;)o++;if(n=n.slice(o),n[0]>127){let i=new Uint8Array(n.length+1);i[0]=0,i.set(n,1),n=i}return n.buffer}var qh=class{static async createSelfSigned(e,t=ut.get()){if(!e.keys.privateKey)throw new Error("Bad field 'keys' in 'params' argument. 'privateKey' is empty");if(!e.keys.publicKey)throw new Error("Bad field 'keys' in 'params' argument. 'publicKey' is empty");return this.create({serialNumber:e.serialNumber,subject:e.name,issuer:e.name,notBefore:e.notBefore,notAfter:e.notAfter,publicKey:e.keys.publicKey,signingKey:e.keys.privateKey,signingAlgorithm:e.signingAlgorithm,extensions:e.extensions},t)}static async create(e,t=ut.get()){var n;let o;e.publicKey instanceof Pn?o=e.publicKey.rawData:"publicKey"in e.publicKey?o=e.publicKey.publicKey.rawData:H.BufferSourceConverter.isBufferSource(e.publicKey)?o=e.publicKey:o=await t.subtle.exportKey("spki",e.publicKey);let i=SB(e.serialNumber),s=e.notBefore||new Date,a=e.notAfter||new Date(s.getTime()+31536e6),c=new cr({tbsCertificate:new bt({version:Xr.v3,serialNumber:i,validity:new Bn({notBefore:s,notAfter:a}),extensions:new Yt(((n=e.extensions)===null||n===void 0?void 0:n.map(m=>F.parse(m.rawData,gt)))||[]),subjectPublicKeyInfo:F.parse(o,yt)})});if(e.subject){let m=e.subject instanceof Dr?e.subject:new Dr(e.subject);c.tbsCertificate.subject=F.parse(m.toArrayBuffer(),Oe)}if(e.issuer){let m=e.issuer instanceof Dr?e.issuer:new Dr(e.issuer);c.tbsCertificate.issuer=F.parse(m.toArrayBuffer(),Oe)}let f={hash:"SHA-256"},p="signingKey"in e?{...f,...e.signingAlgorithm,...e.signingKey.algorithm}:{...f,...e.signingAlgorithm},h=De.resolve(qi);c.tbsCertificate.signature=c.signatureAlgorithm=h.toAsnAlgorithm(p);let y=F.serialize(c.tbsCertificate),b="signingKey"in e?await t.subtle.sign(p,e.signingKey,y):e.signature,g=De.resolveAll(Gu).reverse(),C=null;for(let m of g)if(C=m.toAsnSignature(p,b),C)break;if(!C)throw Error("Cannot convert ASN.1 signature value to WebCrypto format");return c.signatureValue=C,new ma(F.serialize(c))}},EB,_B,CB,BB,IB,fA;(function(r){r[r.unspecified=0]="unspecified",r[r.keyCompromise=1]="keyCompromise",r[r.cACompromise=2]="cACompromise",r[r.affiliationChanged=3]="affiliationChanged",r[r.superseded=4]="superseded",r[r.cessationOfOperation=5]="cessationOfOperation",r[r.certificateHold=6]="certificateHold",r[r.removeFromCRL=8]="removeFromCRL",r[r.privilegeWithdrawn=9]="privilegeWithdrawn",r[r.aACompromise=10]="aACompromise"})(fA||(fA={}));EB=new WeakMap,_B=new WeakMap,CB=new WeakMap,BB=new WeakMap,IB=new WeakMap;var TB,kB,OB,PB,NB,DB,RB;TB=new WeakMap,kB=new WeakMap,OB=new WeakMap,PB=new WeakMap,NB=new WeakMap,DB=new WeakMap,RB=new WeakMap;Rt.register(Gf,ha);Rt.register(Yf,Uh);Rt.register(Jf,Mh);Rt.register(ay,jh);Rt.register(qf,Lh);Rt.register(iy,Kh);Rt.register(Zf,Vh);Rt.register(Wf,$h);Rt.register(ty,Fh);da.register(rg,Wh);da.register(xu,Wu);De.registerSingleton(Gu,mg);De.registerSingleton(Gu,Rn);Rn.namedCurveSize.set("P-256",32);Rn.namedCurveSize.set("K-256",32);Rn.namedCurveSize.set("P-384",48);Rn.namedCurveSize.set("P-521",66);var Ln="/",yA=new TextEncoder().encode(Ln),Gh=yA[0],zu=class r{_buf;constructor(e,t){if(typeof e=="string")this._buf=de(e);else if(e instanceof Uint8Array)this._buf=e;else throw new Error("Invalid key, should be String of Uint8Array");if(t==null&&(t=!0),t&&this.clean(),this._buf.byteLength===0||this._buf[0]!==Gh)throw new Error("Invalid key")}toString(e="utf8"){return ue(this._buf,e)}uint8Array(){return this._buf}get[Symbol.toStringTag](){return`Key(${this.toString()})`}static withNamespaces(e){return new r(e.join(Ln))}static random(){return new r(Math.random().toString().substring(2))}static asKey(e){return e instanceof Uint8Array||typeof e=="string"?new r(e):typeof e.uint8Array=="function"?new r(e.uint8Array()):null}clean(){if((this._buf==null||this._buf.byteLength===0)&&(this._buf=yA),this._buf[0]!==Gh){let e=new Uint8Array(this._buf.byteLength+1);e.fill(Gh,0,1),e.set(this._buf,1),this._buf=e}for(;this._buf.byteLength>1&&this._buf[this._buf.byteLength-1]===Gh;)this._buf=this._buf.subarray(0,-1)}less(e){let t=this.list(),n=e.list();for(let o=0;o<t.length;o++){if(n.length<o+1)return!1;let i=t[o],s=n[o];if(i<s)return!0;if(i>s)return!1}return t.length<n.length}reverse(){return r.withNamespaces(this.list().slice().reverse())}namespaces(){return this.list()}baseNamespace(){let e=this.namespaces();return e[e.length-1]}list(){return this.toString().split(Ln).slice(1)}type(){return LB(this.baseNamespace())}name(){return UB(this.baseNamespace())}instance(e){return new r(this.toString()+":"+e)}path(){let e=this.parent().toString();return e.endsWith(Ln)||(e+=Ln),e+=this.type(),new r(e)}parent(){let e=this.list();return e.length===1?new r(Ln):new r(e.slice(0,-1).join(Ln))}child(e){return this.toString()===Ln?e:e.toString()===Ln?this:new r(this.toString()+e.toString(),!1)}isAncestorOf(e){return e.toString()===this.toString()?!1:e.toString().startsWith(this.toString())}isDecendantOf(e){return e.toString()===this.toString()?!1:this.toString().startsWith(e.toString())}isTopLevel(){return this.list().length===1}concat(...e){return r.withNamespaces([...this.namespaces(),...MB(e.map(t=>t.namespaces()))])}};function LB(r){let e=r.split(":");return e.length<2?"":e.slice(0,-1).join(":")}function UB(r){let e=r.split(":");return e[e.length-1]}function MB(r){return[].concat(...r)}var zh=class extends er{async listen(){throw new bf("WebRTCTransport.createListener")}getAddrs(){return[]}updateAnnounceAddrs(){}async close(){}};var ya=!!globalThis.process?.env?.DUMP_SESSION_KEYS,xg=16;function jB(r){return r instanceof Uint8Array||ArrayBuffer.isView(r)&&r.constructor.name==="Uint8Array"}function Xh(r){if(typeof r!="boolean")throw new Error(`boolean expected, not ${r}`)}function Zh(r){if(!Number.isSafeInteger(r)||r<0)throw new Error("positive integer expected, got "+r)}function lt(r,e,t=""){let n=jB(r),o=r?.length,i=e!==void 0;if(!n||i&&o!==e){let s=t&&`"${t}" `,a=i?` of length ${e}`:"",c=n?`length=${o}`:`type=${typeof r}`;throw new Error(s+"expected Uint8Array"+a+", got "+c)}return r}function vg(r,e=!0){if(r.destroyed)throw new Error("Hash instance has been destroyed");if(e&&r.finished)throw new Error("Hash#digest() has already been called")}function gA(r,e){lt(r,void 0,"output");let t=e.outputLen;if(r.length<t)throw new Error("digestInto() expects output buffer of length at least "+t)}function Un(r){return new Uint32Array(r.buffer,r.byteOffset,Math.floor(r.byteLength/4))}function Mn(...r){for(let e=0;e<r.length;e++)r[e].fill(0)}function KB(r){return new DataView(r.buffer,r.byteOffset,r.byteLength)}var HB=new Uint8Array(new Uint32Array([287454020]).buffer)[0]===68;function bA(r,e){if(e==null||typeof e!="object")throw new Error("options must be defined");return Object.assign(r,e)}function wA(r,e){if(r.length!==e.length)return!1;let t=0;for(let n=0;n<r.length;n++)t|=r[n]^e[n];return t===0}var Ag=(r,e)=>{function t(n,...o){if(lt(n,void 0,"key"),!HB)throw new Error("Non little-endian hardware is not yet supported");if(r.nonceLength!==void 0){let p=o[0];lt(p,r.varSizeNonce?void 0:r.nonceLength,"nonce")}let i=r.tagLength;i&&o[1]!==void 0&&lt(o[1],void 0,"AAD");let s=e(n,...o),a=(p,h)=>{if(h!==void 0){if(p!==2)throw new Error("cipher output not supported");lt(h,void 0,"output")}},c=!1;return{encrypt(p,h){if(c)throw new Error("cannot encrypt() twice with same key + nonce");return c=!0,lt(p),a(s.encrypt.length,h),s.encrypt(p,h)},decrypt(p,h){if(lt(p),i&&p.length<i)throw new Error('"ciphertext" expected length bigger than tagLength='+i);return a(s.decrypt.length,h),s.decrypt(p,h)}}}return Object.assign(t,r),t};function Sg(r,e,t=!0){if(e===void 0)return new Uint8Array(r);if(e.length!==r)throw new Error('"output" expected Uint8Array of length '+r+", got: "+e.length);if(t&&!VB(e))throw new Error("invalid output, must be aligned");return e}function xA(r,e,t){Xh(t);let n=new Uint8Array(16),o=KB(n);return o.setBigUint64(0,BigInt(e),t),o.setBigUint64(8,BigInt(r),t),n}function VB(r){return r.byteOffset%4===0}function ga(r){return Uint8Array.from(r)}var AA=r=>Uint8Array.from(r.split(""),e=>e.charCodeAt(0)),$B=AA("expand 16-byte k"),FB=AA("expand 32-byte k"),WB=Un($B),qB=Un(FB);function Q(r,e){return r<<e|r>>>32-e}function Eg(r){return r.byteOffset%4===0}var Yh=64,GB=16,SA=2**32-1,vA=Uint32Array.of();function zB(r,e,t,n,o,i,s,a){let c=o.length,f=new Uint8Array(Yh),p=Un(f),h=Eg(o)&&Eg(i),y=h?Un(o):vA,b=h?Un(i):vA;for(let g=0;g<c;s++){if(r(e,t,n,p,s,a),s>=SA)throw new Error("arx: counter overflow");let C=Math.min(Yh,c-g);if(h&&C===Yh){let m=g/4;if(g%4!==0)throw new Error("arx: invalid block position");for(let S=0,N;S<GB;S++)N=m+S,b[N]=y[N]^p[S];g+=Yh;continue}for(let m=0,S;m<C;m++)S=g+m,i[S]=o[S]^f[m];g+=C}}function _g(r,e){let{allowShortKeys:t,extendNonceFn:n,counterLength:o,counterRight:i,rounds:s}=bA({allowShortKeys:!1,counterLength:8,counterRight:!1,rounds:20},e);if(typeof r!="function")throw new Error("core must be a function");return Zh(o),Zh(s),Xh(i),Xh(t),(a,c,f,p,h=0)=>{lt(a,void 0,"key"),lt(c,void 0,"nonce"),lt(f,void 0,"data");let y=f.length;if(p===void 0&&(p=new Uint8Array(y)),lt(p,void 0,"output"),Zh(h),h<0||h>=SA)throw new Error("arx: counter overflow");if(p.length<y)throw new Error(`arx: output (${p.length}) is shorter than data (${y})`);let b=[],g=a.length,C,m;if(g===32)b.push(C=ga(a)),m=qB;else if(g===16&&t)C=new Uint8Array(32),C.set(a),C.set(a,16),m=WB,b.push(C);else throw lt(a,32,"arx key"),new Error("invalid key size");Eg(c)||b.push(c=ga(c));let S=Un(C);if(n){if(c.length!==24)throw new Error("arx: extended nonce must be 24 bytes");n(m,S,Un(c.subarray(0,16)),S),c=c.subarray(16)}let N=16-o;if(N!==c.length)throw new Error(`arx: nonce must be ${N} or 16 bytes`);if(N!==12){let K=new Uint8Array(12);K.set(c,i?0:12-c.length),c=K,b.push(c)}let I=Un(c);return zB(r,m,S,I,f,p,h,s),Mn(...b),p}}function vt(r,e){return r[e++]&255|(r[e++]&255)<<8}var Cg=class{blockLen=16;outputLen=16;buffer=new Uint8Array(16);r=new Uint16Array(10);h=new Uint16Array(10);pad=new Uint16Array(8);pos=0;finished=!1;constructor(e){e=ga(lt(e,32,"key"));let t=vt(e,0),n=vt(e,2),o=vt(e,4),i=vt(e,6),s=vt(e,8),a=vt(e,10),c=vt(e,12),f=vt(e,14);this.r[0]=t&8191,this.r[1]=(t>>>13|n<<3)&8191,this.r[2]=(n>>>10|o<<6)&7939,this.r[3]=(o>>>7|i<<9)&8191,this.r[4]=(i>>>4|s<<12)&255,this.r[5]=s>>>1&8190,this.r[6]=(s>>>14|a<<2)&8191,this.r[7]=(a>>>11|c<<5)&8065,this.r[8]=(c>>>8|f<<8)&8191,this.r[9]=f>>>5&127;for(let p=0;p<8;p++)this.pad[p]=vt(e,16+2*p)}process(e,t,n=!1){let o=n?0:2048,{h:i,r:s}=this,a=s[0],c=s[1],f=s[2],p=s[3],h=s[4],y=s[5],b=s[6],g=s[7],C=s[8],m=s[9],S=vt(e,t+0),N=vt(e,t+2),I=vt(e,t+4),K=vt(e,t+6),Z=vt(e,t+8),q=vt(e,t+10),re=vt(e,t+12),R=vt(e,t+14),k=i[0]+(S&8191),G=i[1]+((S>>>13|N<<3)&8191),Y=i[2]+((N>>>10|I<<6)&8191),V=i[3]+((I>>>7|K<<9)&8191),B=i[4]+((K>>>4|Z<<12)&8191),A=i[5]+(Z>>>1&8191),v=i[6]+((Z>>>14|q<<2)&8191),D=i[7]+((q>>>11|re<<5)&8191),U=i[8]+((re>>>8|R<<8)&8191),L=i[9]+(R>>>5|o),T=0,M=T+k*a+G*(5*m)+Y*(5*C)+V*(5*g)+B*(5*b);T=M>>>13,M&=8191,M+=A*(5*y)+v*(5*h)+D*(5*p)+U*(5*f)+L*(5*c),T+=M>>>13,M&=8191;let W=T+k*c+G*a+Y*(5*m)+V*(5*C)+B*(5*g);T=W>>>13,W&=8191,W+=A*(5*b)+v*(5*y)+D*(5*h)+U*(5*p)+L*(5*f),T+=W>>>13,W&=8191;let O=T+k*f+G*c+Y*a+V*(5*m)+B*(5*C);T=O>>>13,O&=8191,O+=A*(5*g)+v*(5*b)+D*(5*y)+U*(5*h)+L*(5*p),T+=O>>>13,O&=8191;let pe=T+k*p+G*f+Y*c+V*a+B*(5*m);T=pe>>>13,pe&=8191,pe+=A*(5*C)+v*(5*g)+D*(5*b)+U*(5*y)+L*(5*h),T+=pe>>>13,pe&=8191;let be=T+k*h+G*p+Y*f+V*c+B*a;T=be>>>13,be&=8191,be+=A*(5*m)+v*(5*C)+D*(5*g)+U*(5*b)+L*(5*y),T+=be>>>13,be&=8191;let ee=T+k*y+G*h+Y*p+V*f+B*c;T=ee>>>13,ee&=8191,ee+=A*a+v*(5*m)+D*(5*C)+U*(5*g)+L*(5*b),T+=ee>>>13,ee&=8191;let Ae=T+k*b+G*y+Y*h+V*p+B*f;T=Ae>>>13,Ae&=8191,Ae+=A*c+v*a+D*(5*m)+U*(5*C)+L*(5*g),T+=Ae>>>13,Ae&=8191;let Be=T+k*g+G*b+Y*y+V*h+B*p;T=Be>>>13,Be&=8191,Be+=A*f+v*c+D*a+U*(5*m)+L*(5*C),T+=Be>>>13,Be&=8191;let Ke=T+k*C+G*g+Y*b+V*y+B*h;T=Ke>>>13,Ke&=8191,Ke+=A*p+v*f+D*c+U*a+L*(5*m),T+=Ke>>>13,Ke&=8191;let Ee=T+k*m+G*C+Y*g+V*b+B*y;T=Ee>>>13,Ee&=8191,Ee+=A*h+v*p+D*f+U*c+L*a,T+=Ee>>>13,Ee&=8191,T=(T<<2)+T|0,T=T+M|0,M=T&8191,T=T>>>13,W+=T,i[0]=M,i[1]=W,i[2]=O,i[3]=pe,i[4]=be,i[5]=ee,i[6]=Ae,i[7]=Be,i[8]=Ke,i[9]=Ee}finalize(){let{h:e,pad:t}=this,n=new Uint16Array(10),o=e[1]>>>13;e[1]&=8191;for(let a=2;a<10;a++)e[a]+=o,o=e[a]>>>13,e[a]&=8191;e[0]+=o*5,o=e[0]>>>13,e[0]&=8191,e[1]+=o,o=e[1]>>>13,e[1]&=8191,e[2]+=o,n[0]=e[0]+5,o=n[0]>>>13,n[0]&=8191;for(let a=1;a<10;a++)n[a]=e[a]+o,o=n[a]>>>13,n[a]&=8191;n[9]-=8192;let i=(o^1)-1;for(let a=0;a<10;a++)n[a]&=i;i=~i;for(let a=0;a<10;a++)e[a]=e[a]&i|n[a];e[0]=(e[0]|e[1]<<13)&65535,e[1]=(e[1]>>>3|e[2]<<10)&65535,e[2]=(e[2]>>>6|e[3]<<7)&65535,e[3]=(e[3]>>>9|e[4]<<4)&65535,e[4]=(e[4]>>>12|e[5]<<1|e[6]<<14)&65535,e[5]=(e[6]>>>2|e[7]<<11)&65535,e[6]=(e[7]>>>5|e[8]<<8)&65535,e[7]=(e[8]>>>8|e[9]<<5)&65535;let s=e[0]+t[0];e[0]=s&65535;for(let a=1;a<8;a++)s=(e[a]+t[a]|0)+(s>>>16)|0,e[a]=s&65535;Mn(n)}update(e){vg(this),lt(e),e=ga(e);let{buffer:t,blockLen:n}=this,o=e.length;for(let i=0;i<o;){let s=Math.min(n-this.pos,o-i);if(s===n){for(;n<=o-i;i+=n)this.process(e,i);continue}t.set(e.subarray(i,i+s),this.pos),this.pos+=s,i+=s,this.pos===n&&(this.process(t,0,!1),this.pos=0)}return this}destroy(){Mn(this.h,this.r,this.buffer,this.pad)}digestInto(e){vg(this),gA(e,this),this.finished=!0;let{buffer:t,h:n}=this,{pos:o}=this;if(o){for(t[o++]=1;o<16;o++)t[o]=0;this.process(t,0,!0)}this.finalize();let i=0;for(let s=0;s<8;s++)e[i++]=n[s]>>>0,e[i++]=n[s]>>>8;return e}digest(){let{buffer:e,outputLen:t}=this;this.digestInto(e);let n=e.slice(0,t);return this.destroy(),n}};function XB(r){let e=(n,o)=>r(o).update(n).digest(),t=r(new Uint8Array(32));return e.outputLen=t.outputLen,e.blockLen=t.blockLen,e.create=n=>r(n),e}var EA=XB(r=>new Cg(r));function BA(r,e,t,n,o,i=20){let s=r[0],a=r[1],c=r[2],f=r[3],p=e[0],h=e[1],y=e[2],b=e[3],g=e[4],C=e[5],m=e[6],S=e[7],N=o,I=t[0],K=t[1],Z=t[2],q=s,re=a,R=c,k=f,G=p,Y=h,V=y,B=b,A=g,v=C,D=m,U=S,L=N,T=I,M=K,W=Z;for(let pe=0;pe<i;pe+=2)q=q+G|0,L=Q(L^q,16),A=A+L|0,G=Q(G^A,12),q=q+G|0,L=Q(L^q,8),A=A+L|0,G=Q(G^A,7),re=re+Y|0,T=Q(T^re,16),v=v+T|0,Y=Q(Y^v,12),re=re+Y|0,T=Q(T^re,8),v=v+T|0,Y=Q(Y^v,7),R=R+V|0,M=Q(M^R,16),D=D+M|0,V=Q(V^D,12),R=R+V|0,M=Q(M^R,8),D=D+M|0,V=Q(V^D,7),k=k+B|0,W=Q(W^k,16),U=U+W|0,B=Q(B^U,12),k=k+B|0,W=Q(W^k,8),U=U+W|0,B=Q(B^U,7),q=q+Y|0,W=Q(W^q,16),D=D+W|0,Y=Q(Y^D,12),q=q+Y|0,W=Q(W^q,8),D=D+W|0,Y=Q(Y^D,7),re=re+V|0,L=Q(L^re,16),U=U+L|0,V=Q(V^U,12),re=re+V|0,L=Q(L^re,8),U=U+L|0,V=Q(V^U,7),R=R+B|0,T=Q(T^R,16),A=A+T|0,B=Q(B^A,12),R=R+B|0,T=Q(T^R,8),A=A+T|0,B=Q(B^A,7),k=k+G|0,M=Q(M^k,16),v=v+M|0,G=Q(G^v,12),k=k+G|0,M=Q(M^k,8),v=v+M|0,G=Q(G^v,7);let O=0;n[O++]=s+q|0,n[O++]=a+re|0,n[O++]=c+R|0,n[O++]=f+k|0,n[O++]=p+G|0,n[O++]=h+Y|0,n[O++]=y+V|0,n[O++]=b+B|0,n[O++]=g+A|0,n[O++]=C+v|0,n[O++]=m+D|0,n[O++]=S+U|0,n[O++]=N+L|0,n[O++]=I+T|0,n[O++]=K+M|0,n[O++]=Z+W|0}function ZB(r,e,t,n){let o=r[0],i=r[1],s=r[2],a=r[3],c=e[0],f=e[1],p=e[2],h=e[3],y=e[4],b=e[5],g=e[6],C=e[7],m=t[0],S=t[1],N=t[2],I=t[3];for(let Z=0;Z<20;Z+=2)o=o+c|0,m=Q(m^o,16),y=y+m|0,c=Q(c^y,12),o=o+c|0,m=Q(m^o,8),y=y+m|0,c=Q(c^y,7),i=i+f|0,S=Q(S^i,16),b=b+S|0,f=Q(f^b,12),i=i+f|0,S=Q(S^i,8),b=b+S|0,f=Q(f^b,7),s=s+p|0,N=Q(N^s,16),g=g+N|0,p=Q(p^g,12),s=s+p|0,N=Q(N^s,8),g=g+N|0,p=Q(p^g,7),a=a+h|0,I=Q(I^a,16),C=C+I|0,h=Q(h^C,12),a=a+h|0,I=Q(I^a,8),C=C+I|0,h=Q(h^C,7),o=o+f|0,I=Q(I^o,16),g=g+I|0,f=Q(f^g,12),o=o+f|0,I=Q(I^o,8),g=g+I|0,f=Q(f^g,7),i=i+p|0,m=Q(m^i,16),C=C+m|0,p=Q(p^C,12),i=i+p|0,m=Q(m^i,8),C=C+m|0,p=Q(p^C,7),s=s+h|0,S=Q(S^s,16),y=y+S|0,h=Q(h^y,12),s=s+h|0,S=Q(S^s,8),y=y+S|0,h=Q(h^y,7),a=a+c|0,N=Q(N^a,16),b=b+N|0,c=Q(c^b,12),a=a+c|0,N=Q(N^a,8),b=b+N|0,c=Q(c^b,7);let K=0;n[K++]=o,n[K++]=i,n[K++]=s,n[K++]=a,n[K++]=m,n[K++]=S,n[K++]=N,n[K++]=I}var YB=_g(BA,{counterRight:!1,counterLength:4,allowShortKeys:!1}),JB=_g(BA,{counterRight:!1,counterLength:8,extendNonceFn:ZB,allowShortKeys:!1});var QB=new Uint8Array(16),_A=(r,e)=>{r.update(e);let t=e.length%16;t&&r.update(QB.subarray(t))},eI=new Uint8Array(32);function CA(r,e,t,n,o){o!==void 0&&lt(o,void 0,"AAD");let i=r(e,t,eI),s=xA(n.length,o?o.length:0,!0),a=EA.create(i);o&&_A(a,o),_A(a,n),a.update(s);let c=a.digest();return Mn(i,s),c}var IA=r=>(e,t,n)=>({encrypt(i,s){let a=i.length;s=Sg(a+16,s,!1),s.set(i);let c=s.subarray(0,-16);r(e,t,c,c,1);let f=CA(r,e,t,c,n);return s.set(f,a),Mn(f),s},decrypt(i,s){s=Sg(i.length-16,s,!1);let a=i.subarray(0,-16),c=i.subarray(-16),f=CA(r,e,t,a,n);if(!wA(c,f))throw new Error("invalid tag");return s.set(i.subarray(0,-16)),r(e,t,s,s,1),Mn(f),s}}),Bg=Ag({blockSize:64,nonceLength:12,tagLength:16},IA(YB)),Hz=Ag({blockSize:64,nonceLength:24,tagLength:16},IA(JB));function kA(r,e,t){return Lo(r),t===void 0&&(t=new Uint8Array(r.outputLen)),ys(r,t,e)}var Ig=Uint8Array.of(0),TA=Uint8Array.of();function OA(r,e,t,n=32){Lo(r),rr(n,"length");let o=r.outputLen;if(n>255*o)throw new Error("Length must be <= 255*HashLen");let i=Math.ceil(n/o);t===void 0?t=TA:fe(t,void 0,"info");let s=new Uint8Array(i*o),a=ys.create(r,e),c=a._cloneInto(),f=new Uint8Array(a.outputLen);for(let p=0;p<i;p++)Ig[0]=p+1,c.update(p===0?TA:f).update(t).update(Ig).digestInto(f),s.set(f,o*p),a._cloneInto(c);return a.destroy(),c.destroy(),br(f,Ig),s.slice(0,n)}var Tg={hashSHA256(r){return Mr(r.subarray())},getHKDF(r,e){let t=kA(Mr,e,r),o=OA(Mr,t,void 0,96),i=o.subarray(0,32),s=o.subarray(32,64),a=o.subarray(64,96);return[i,s,a]},generateX25519KeyPair(){let r=$a.utils.randomSecretKey();return{publicKey:$a.getPublicKey(r),privateKey:r}},generateX25519KeyPairFromSeed(r){return{publicKey:$a.getPublicKey(r),privateKey:r}},generateX25519SharedKey(r,e){return $a.getSharedSecret(r.subarray(),e.subarray())},chaCha20Poly1305Encrypt(r,e,t,n){return Bg(n,e,t).encrypt(r.subarray())},chaCha20Poly1305Decrypt(r,e,t,n,o){return Bg(n,e,t).decrypt(r.subarray(),o)}};var PA=Tg;function NA(r){return{generateKeypair:r.generateX25519KeyPair,dh:(e,t)=>r.generateX25519SharedKey(e.privateKey,t).subarray(0,32),encrypt:r.chaCha20Poly1305Encrypt,decrypt:r.chaCha20Poly1305Decrypt,hash:r.hashSHA256,hkdf:r.getHKDF}}var ba=r=>{let e=ot(2);return e[0]=r>>8,e[1]=r,e};ba.bytes=2;var wa=r=>{if(r.length<2)throw RangeError("Could not decode int16BE");if(r instanceof Uint8Array){let e=0;return e+=r[0]<<8,e+=r[1],e}return r.getUint16(0)};wa.bytes=2;function DA(r){return{xxHandshakeSuccesses:r.registerCounter("libp2p_noise_xxhandshake_successes_total",{help:"Total count of noise xxHandshakes successes_"}),xxHandshakeErrors:r.registerCounter("libp2p_noise_xxhandshake_error_total",{help:"Total count of noise xxHandshakes errors"}),encryptedPackets:r.registerCounter("libp2p_noise_encrypted_packets_total",{help:"Total count of noise encrypted packets successfully"}),decryptedPackets:r.registerCounter("libp2p_noise_decrypted_packets_total",{help:"Total count of noise decrypted packets"}),decryptErrors:r.registerCounter("libp2p_noise_decrypt_errors_total",{help:"Total count of noise decrypt errors"})}}function kg(r,e){!e.enabled||!ya||(r?(e(`LOCAL_STATIC_PUBLIC_KEY ${ue(r.publicKey,"hex")}`),e(`LOCAL_STATIC_PRIVATE_KEY ${ue(r.privateKey,"hex")}`)):e("Missing local static keys."))}function Og(r,e){!e.enabled||!ya||(r?(e(`LOCAL_PUBLIC_EPHEMERAL_KEY ${ue(r.publicKey,"hex")}`),e(`LOCAL_PRIVATE_EPHEMERAL_KEY ${ue(r.privateKey,"hex")}`)):e("Missing local ephemeral keys."))}function RA(r,e){!e.enabled||!ya||e(r?`REMOTE_STATIC_PUBLIC_KEY ${ue(r.subarray(),"hex")}`:"Missing remote static public key.")}function Pg(r,e){!e.enabled||!ya||e(r?`REMOTE_EPHEMERAL_PUBLIC_KEY ${ue(r.subarray(),"hex")}`:"Missing remote ephemeral keys.")}function Ng(r,e,t){!t.enabled||!ya||(t(`CIPHER_STATE_1 ${r.n.getUint64()} ${r.k&&ue(r.k,"hex")}`),t(`CIPHER_STATE_2 ${e.n.getUint64()} ${e.k&&ue(e.k,"hex")}`))}var xa=class r extends Error{code;constructor(e="Invalid crypto exchange"){super(e),this.code=r.code}static code="ERR_INVALID_CRYPTO_EXCHANGE"};var tI=0,rI=4294967295,nI="Cipherstate has reached maximum n, a new handshake must be performed",Jh=class{n;bytes;view;constructor(e=tI){this.n=e,this.bytes=nt(12),this.view=new DataView(this.bytes.buffer,this.bytes.byteOffset,this.bytes.byteLength),this.view.setUint32(4,e,!0)}increment(){this.n++,this.view.setUint32(4,this.n,!0)}getBytes(){return this.bytes}getUint64(){return this.n}assertValue(){if(this.n>rI)throw new Error(nI)}};var Gi=nt(0),va=class{k;n;crypto;constructor(e,t=void 0,n=0){this.crypto=e,this.k=t,this.n=new Jh(n)}hasKey(){return!!this.k}encryptWithAd(e,t){if(!this.hasKey())return t;this.n.assertValue();let n=this.crypto.encrypt(t,this.n.getBytes(),e,this.k);return this.n.increment(),n}decryptWithAd(e,t,n){if(!this.hasKey())return t;this.n.assertValue();let o=this.crypto.decrypt(t,this.n.getBytes(),e,this.k,n);return this.n.increment(),o}},Dg=class{cs;ck;h;crypto;constructor(e,t){this.crypto=e;let n=de(t,"utf-8");this.h=oI(e,n),this.ck=this.h,this.cs=new va(e)}mixKey(e){let[t,n]=this.crypto.hkdf(this.ck,e);this.ck=t,this.cs=new va(this.crypto,n)}mixHash(e){this.h=this.crypto.hash(new me(this.h,e))}encryptAndHash(e){let t=this.cs.encryptWithAd(this.h,e);return this.mixHash(t),t}decryptAndHash(e){let t=this.cs.decryptWithAd(this.h,e);return this.mixHash(e),t}split(){let[e,t]=this.crypto.hkdf(this.ck,Gi);return[new va(this.crypto,e),new va(this.crypto,t)]}},Rg=class{ss;s;e;rs;re;initiator;crypto;constructor(e){let{crypto:t,protocolName:n,prologue:o,initiator:i,s,e:a,rs:c,re:f}=e;this.crypto=t,this.ss=new Dg(t,n),this.ss.mixHash(o),this.initiator=i,this.s=s,this.e=a,this.rs=c,this.re=f}writeE(){if(this.e)throw new Error("ephemeral keypair is already set");let e=this.crypto.generateKeypair();return this.ss.mixHash(e.publicKey),this.e=e,e.publicKey}writeS(){if(!this.s)throw new Error("static keypair is not set");return this.ss.encryptAndHash(this.s.publicKey)}writeEE(){if(!this.e)throw new Error("ephemeral keypair is not set");if(!this.re)throw new Error("remote ephemeral public key is not set");this.ss.mixKey(this.crypto.dh(this.e,this.re))}writeES(){if(this.initiator){if(!this.e)throw new Error("ephemeral keypair is not set");if(!this.rs)throw new Error("remote static public key is not set");this.ss.mixKey(this.crypto.dh(this.e,this.rs))}else{if(!this.s)throw new Error("static keypair is not set");if(!this.re)throw new Error("remote ephemeral public key is not set");this.ss.mixKey(this.crypto.dh(this.s,this.re))}}writeSE(){if(this.initiator){if(!this.s)throw new Error("static keypair is not set");if(!this.re)throw new Error("remote ephemeral public key is not set");this.ss.mixKey(this.crypto.dh(this.s,this.re))}else{if(!this.e)throw new Error("ephemeral keypair is not set");if(!this.rs)throw new Error("remote static public key is not set");this.ss.mixKey(this.crypto.dh(this.e,this.rs))}}readE(e,t=0){if(this.re)throw new Error("remote ephemeral public key is already set");if(e.byteLength<t+32)throw new Error("message is not long enough");this.re=e.sublist(t,t+32),this.ss.mixHash(this.re)}readS(e,t=0){if(this.rs)throw new Error("remote static public key is already set");let n=32+(this.ss.cs.hasKey()?16:0);if(e.byteLength<t+n)throw new Error("message is not long enough");let o=e.sublist(t,t+n);return this.rs=this.ss.decryptAndHash(o),n}readEE(){this.writeEE()}readES(){this.writeES()}readSE(){this.writeSE()}},Xu=class extends Rg{writeMessageA(e){return new me(this.writeE(),this.ss.encryptAndHash(e))}writeMessageB(e){let t=this.writeE();this.writeEE();let n=this.writeS();return this.writeES(),new me(t,n,this.ss.encryptAndHash(e))}writeMessageC(e){let t=this.writeS();return this.writeSE(),new me(t,this.ss.encryptAndHash(e))}readMessageA(e){try{return this.readE(e),this.ss.decryptAndHash(e.sublist(32))}catch(t){throw new xa(`handshake stage 0 validation fail: ${t.message}`)}}readMessageB(e){try{this.readE(e),this.readEE();let t=this.readS(e,32);return this.readES(),this.ss.decryptAndHash(e.sublist(32+t))}catch(t){throw new xa(`handshake stage 1 validation fail: ${t.message}`)}}readMessageC(e){try{let t=this.readS(e);return this.readSE(),this.ss.decryptAndHash(e.sublist(t))}catch(t){throw new xa(`handshake stage 2 validation fail: ${t.message}`)}}};function oI(r,e){if(e.length<=32){let t=nt(32);return t.set(e),t}else return r.hash(e)}var Qh;(function(r){let e;r.codec=()=>(e==null&&(e=Sr((t,n,o={})=>{if(o.lengthDelimited!==!1&&n.fork(),t.webtransportCerthashes!=null)for(let i of t.webtransportCerthashes)n.uint32(10),n.bytes(i);if(t.streamMuxers!=null)for(let i of t.streamMuxers)n.uint32(18),n.string(i);o.lengthDelimited!==!1&&n.ldelim()},(t,n,o={})=>{let i={webtransportCerthashes:[],streamMuxers:[]},s=n==null?t.len:t.pos+n;for(;t.pos<s;){let a=t.uint32();switch(a>>>3){case 1:{if(o.limits?.webtransportCerthashes!=null&&i.webtransportCerthashes.length===o.limits.webtransportCerthashes)throw new Ya('Decode error - map field "webtransportCerthashes" had too many elements');i.webtransportCerthashes.push(t.bytes());break}case 2:{if(o.limits?.streamMuxers!=null&&i.streamMuxers.length===o.limits.streamMuxers)throw new Ya('Decode error - map field "streamMuxers" had too many elements');i.streamMuxers.push(t.string());break}default:{t.skipType(a&7);break}}}return i})),e),r.encode=t=>Ar(t,r.codec()),r.decode=(t,n)=>vr(t,r.codec(),n)})(Qh||(Qh={}));var Zu;(function(r){let e;r.codec=()=>(e==null&&(e=Sr((t,n,o={})=>{o.lengthDelimited!==!1&&n.fork(),t.identityKey!=null&&t.identityKey.byteLength>0&&(n.uint32(10),n.bytes(t.identityKey)),t.identitySig!=null&&t.identitySig.byteLength>0&&(n.uint32(18),n.bytes(t.identitySig)),t.extensions!=null&&(n.uint32(34),Qh.codec().encode(t.extensions,n)),o.lengthDelimited!==!1&&n.ldelim()},(t,n,o={})=>{let i={identityKey:nt(0),identitySig:nt(0)},s=n==null?t.len:t.pos+n;for(;t.pos<s;){let a=t.uint32();switch(a>>>3){case 1:{i.identityKey=t.bytes();break}case 2:{i.identitySig=t.bytes();break}case 4:{i.extensions=Qh.codec().decode(t,t.uint32(),{limits:o.limits?.extensions});break}default:{t.skipType(a&7);break}}}return i})),e),r.encode=t=>Ar(t,r.codec()),r.decode=(t,n)=>vr(t,r.codec(),n)})(Zu||(Zu={}));async function Ug(r,e,t){let n=await r.sign(UA(e));return Zu.encode({identityKey:$n(r.publicKey),identitySig:n,extensions:t})}async function Mg(r,e,t){try{let n=Zu.decode(r),o=tc(n.identityKey);if(t?.equals(o)===!1)throw new Error(`Payload identity key ${o} does not match expected remote identity key ${t}`);if(!e)throw new Error("Remote static does not exist");let i=UA(e);if(!await o.verify(i,n.identitySig))throw new Error("Invalid payload signature");return n}catch(n){throw new el(n.message)}}function UA(r){let e=de("noise-libp2p-static-key:");return r instanceof Uint8Array?Tt([e,r],e.length+r.length):(r.prepend(e),r)}var Lg=class extends eo{stream;handshake;metrics;decoder;constructor(e,t,n){super({log:e.log,inactivityTimeout:e.inactivityTimeout,maxReadBufferLength:e.maxReadBufferLength,direction:e.direction}),this.stream=e,this.handshake=t,this.metrics=n,this.decoder=new cf({lengthDecoder:wa,maxBufferSize:16*1024*1024,encodingLength:()=>2});let o=c=>{try{for(let f of this.decoder.decode(c.data))this.onData(this.decrypt(f))}catch(f){this.abort(f)}};this.stream.addEventListener("message",o);let i=c=>{c.error!=null?c.local===!0?this.abort(c.error):this.onRemoteReset():this.onTransportClosed()};this.stream.addEventListener("close",i);let s=()=>{this.safeDispatchEvent("drain")};this.stream.addEventListener("drain",s);let a=()=>{this.onRemoteCloseWrite()};this.stream.addEventListener("remoteCloseWrite",a)}encrypt(e){let t=new me;for(let n=0;n<e.byteLength;n+=65519){let o=n+65519;o>e.byteLength&&(o=e.byteLength);let i;e instanceof Uint8Array?i=this.handshake.encrypt(e.subarray(n,o)):i=this.handshake.encrypt(e.sublist(n,o)),this.metrics?.encryptedPackets.increment(),t.append(ba(i.byteLength)),t.append(i)}return t}decrypt(e){let t=new me;for(let n=0;n<e.byteLength;n+=65535){let o=n+65535;if(o>e.byteLength&&(o=e.byteLength),o-xg<n)throw new Error("Invalid chunk");let i;e instanceof Uint8Array?i=e.subarray(n,o):i=e.sublist(n,o);let s=e.subarray(n,o-xg);try{let a=this.handshake.decrypt(i,s);this.metrics?.decryptedPackets.increment(),t.append(a)}catch(a){throw this.metrics?.decryptErrors.increment(),a}}return t}close(e){return this.stream.close(e)}sendPause(){this.stream.pause()}sendResume(){this.stream.resume()}sendReset(e){this.stream.abort(e)}sendData(e){return{sentBytes:e.byteLength,canSendMore:this.stream.send(this.encrypt(e))}}};function jg(r,e,t){return new Lg(r,e,t)}async function MA(r,e){let{log:t,connection:n,crypto:o,privateKey:i,prologue:s,s:a,remoteIdentityKey:c,extensions:f}=r,p=await Ug(i,a.publicKey,f),h=new Xu({crypto:o,protocolName:"Noise_XX_25519_ChaChaPoly_SHA256",initiator:!0,prologue:s,s:a});kg(h.s,t),t.trace("Stage 0 - Initiator starting to send first message."),await n.write(h.writeMessageA(Gi),e),t.trace("Stage 0 - Initiator finished sending first message."),Og(h.e,t),t.trace("Stage 1 - Initiator waiting to receive first message from responder...");let y=h.readMessageB(await n.read(e));t.trace("Stage 1 - Initiator received the message."),Pg(h.re,t),RA(h.rs,t),t.trace("Initiator going to check remote's signature...");let b=await Mg(y,h.rs,c);t.trace("All good with the signature!"),t.trace("Stage 2 - Initiator sending third handshake message."),await n.write(h.writeMessageC(p),e),t.trace("Stage 2 - Initiator sent message with signed payload.");let[g,C]=h.ss.split();return Ng(g,C,t),{payload:b,encrypt:m=>g.encryptWithAd(Gi,m),decrypt:(m,S)=>C.decryptWithAd(Gi,m,S)}}async function jA(r,e){let{log:t,connection:n,crypto:o,privateKey:i,prologue:s,s:a,remoteIdentityKey:c,extensions:f}=r,p=await Ug(i,a.publicKey,f),h=new Xu({crypto:o,protocolName:"Noise_XX_25519_ChaChaPoly_SHA256",initiator:!1,prologue:s,s:a});kg(h.s,t),t.trace("Stage 0 - Responder waiting to receive first message."),h.readMessageA(await n.read(e)),t.trace("Stage 0 - Responder received first message."),Pg(h.re,t),t.trace("Stage 1 - Responder sending out first message with signed payload and static key."),await n.write(h.writeMessageB(p),e),t.trace("Stage 1 - Responder sent the second handshake message with signed payload."),Og(h.e,t),t.trace("Stage 2 - Responder waiting for third handshake message...");let y=h.readMessageC(await n.read(e));t.trace("Stage 2 - Responder received the message, finished handshake.");let b=await Mg(y,h.rs,c),[g,C]=h.ss.split();return Ng(g,C,t),{payload:b,encrypt:m=>C.encryptWithAd(Gi,m),decrypt:(m,S)=>g.decryptWithAd(Gi,m,S)}}var ep=class{protocol="/noise";crypto;prologue;staticKey;extensions;metrics;components;log;constructor(e,t={}){let{staticNoiseKey:n,extensions:o,crypto:i,prologueBytes:s}=t,{metrics:a}=e;this.components=e,this.log=e.logger.forComponent("libp2p:noise");let c=i??PA;this.crypto=NA(c),this.extensions={webtransportCerthashes:[],...o},this.metrics=a?DA(a):void 0,n?this.staticKey=c.generateX25519KeyPairFromSeed(n):this.staticKey=c.generateX25519KeyPair(),this.prologue=s??nt(0)}[Symbol.toStringTag]="@chainsafe/libp2p-noise";[Ji]=["@libp2p/connection-encryption","@chainsafe/libp2p-noise"];async secureOutbound(e,t){let n=e.log?.newScope("noise")??this.log,o=sf(e,{lengthEncoder:ba,lengthDecoder:wa,maxDataLength:65535}),i=await this.performHandshakeInitiator(o,this.components.privateKey,n,t?.remotePeer?.publicKey,t),s=tc(i.payload.identityKey);return{connection:jg(o.unwrap(),i,this.metrics),remoteExtensions:i.payload.extensions,remotePeer:Rd(s),streamMuxer:t?.skipStreamMuxerNegotiation===!0?void 0:this.getStreamMuxer(i.payload.extensions?.streamMuxers)}}getStreamMuxer(e){if(e==null||e.length===0)return;let t=this.components.upgrader.getStreamMuxers();if(t!=null)for(let n of e){let o=t.get(n);if(o!=null)return o}if(e.length)throw new tl("Early muxer negotiation was requested but the initiator and responder had no common muxers")}async secureInbound(e,t){let n=e.log?.newScope("noise")??this.log,o=sf(e,{lengthEncoder:ba,lengthDecoder:wa,maxDataLength:65535}),i=await this.performHandshakeResponder(o,this.components.privateKey,n,t?.remotePeer?.publicKey,t),s=tc(i.payload.identityKey);return{connection:jg(o.unwrap(),i,this.metrics),remoteExtensions:i.payload.extensions,remotePeer:Rd(s),streamMuxer:t?.skipStreamMuxerNegotiation===!0?void 0:this.getStreamMuxer(i.payload.extensions?.streamMuxers)}}async performHandshakeInitiator(e,t,n,o,i){let s,a=i?.skipStreamMuxerNegotiation===!0?[]:[...this.components.upgrader.getStreamMuxers().keys()];try{s=await MA({connection:e,privateKey:t,remoteIdentityKey:o,log:n.newScope("xxhandshake"),crypto:this.crypto,prologue:this.prologue,s:this.staticKey,extensions:{streamMuxers:a,webtransportCerthashes:[],...this.extensions}},i),this.metrics?.xxHandshakeSuccesses.increment()}catch(c){throw this.metrics?.xxHandshakeErrors.increment(),c}return s}async performHandshakeResponder(e,t,n,o,i){let s,a=i?.skipStreamMuxerNegotiation===!0?[]:[...this.components.upgrader.getStreamMuxers().keys()];try{s=await jA({connection:e,privateKey:t,remoteIdentityKey:o,log:n.newScope("xxhandshake"),crypto:this.crypto,prologue:this.prologue,s:this.staticKey,extensions:{streamMuxers:a,webtransportCerthashes:[],...this.extensions}},i),this.metrics?.xxHandshakeSuccesses.increment()}catch(c){throw this.metrics?.xxHandshakeErrors.increment(),c}return s}};function KA(r={}){return e=>new ep(e,r)}var Kg=Object.values(No).map(r=>r.decoder).reduce((r,e)=>r.or(e)),iI=/^a=fingerprint:(?:\w+-[0-9]+)\s(?<fingerprint>(:?[0-9a-fA-F]{2})+)$/m;function HA(r){return r?.match(iI)?.groups?.fingerprint}function Hg(r){let t=r.getComponents().find(n=>n.code===466)?.value;if(t===void 0||t==="")throw new xe(`Couldn't find a certhash component of multiaddr: ${r.toString()}`);return t}function sI(r){return mr.decode(Kg.decode(r))}function aI(r){let e=sI(Hg(r)),t=cI(e.code),n=e.digest.reduce((i,s)=>i+s.toString(16).padStart(2,"0"),""),o=n.match(/.{1,2}/g);if(o==null)throw new gf(n,r.toString());return`${t} ${o.join(":").toUpperCase()}`}function VA(r){let e=r.split(":").map(o=>parseInt(o,16)),t=Uint8Array.from(e),n=It(tr.code,t);return Ss(`/certhash/${Po.encode(n.bytes)}`)}function cI(r){switch(r){case 17:return"sha-1";case 18:return"sha-256";case 19:return"sha-512";default:throw new wf(r)}}function $A(r,e){let{host:t,port:n,type:o}=pm(r);if(o!=="ip4"&&o!=="ip6")throw new xe(`Multiaddr ${r} was not an IPv4 or IPv6 address`);let i=aI(r);return{type:"answer",sdp:`v=0
o=- 0 0 IN IP${o==="ip4"?4:6} ${t}
s=-
t=0 0
a=ice-lite
m=application ${n} UDP/DTLS/SCTP webrtc-datachannel
c=IN IP${o==="ip4"?4:6} ${t}
a=mid:0
a=ice-options:ice2
a=ice-ufrag:${e}
a=ice-pwd:${e}
a=fingerprint:${i}
a=setup:passive
a=sctp-port:5000
a=max-message-size:${Es}
a=candidate:1467250027 1 UDP 1467250027 ${t} ${n} typ host
a=end-of-candidates
`}}function FA(r,e){let{host:t,port:n,type:o}=pm(r);if(o!=="ip4"&&o!=="ip6")throw new xe(`Multiaddr ${r} was not an IPv4 or IPv6 address`);return{type:"offer",sdp:`v=0
o=- 0 0 IN IP${o==="ip4"?4:6} ${t}
s=-
c=IN IP${o==="ip4"?4:6} ${t}
t=0 0
a=ice-options:ice2,trickle
m=application ${n} UDP/DTLS/SCTP webrtc-datachannel
a=mid:0
a=setup:active
a=ice-ufrag:${e}
a=ice-pwd:${e}
a=fingerprint:sha-256 00:00:00:00:00:00:00:00:00:00:00:00:00:00:00:00:00:00:00:00:00:00:00:00:00:00:00:00:00:00:00:00
a=sctp-port:5000
a=max-message-size:${Es}
a=candidate:1467250027 1 UDP 1467250027 ${t} ${n} typ host
a=end-of-candidates
`}}function Vg(r,e){if(r.sdp===void 0)throw new xe("Can't munge a missing SDP");let t=r.sdp.includes(`\r
`)?`\r
`:`
`;try{r.sdp=r.sdp.replace(/\na=ice-ufrag:[^\n]*\n/,`
a=ice-ufrag:`+e+t).replace(/\na=ice-pwd:[^\n]*\n/,`
a=ice-pwd:`+e+t)}catch{}return r}var $g=de("libp2p-webrtc-noise:");function qA(r,e,t){let n=r.trim().toLowerCase().replaceAll(":",""),o=de(n,"hex"),i=It(tr.code,o),s=Kg.decode(Hg(e)),a=$g.byteLength+i.bytes.byteLength+s.byteLength;return t==="server"?Tt([$g,s,i.bytes],a):Tt([$g,i.bytes,s],a)}var uI=df?"iceconnectionstatechange":"connectionstatechange";function lI(r,e){return r.role==="server"}async function GA(r,e,t,n){let o=r.createDataChannel("",{negotiated:!0,id:0});try{if(n.role==="client"){n.log.trace("client creating local offer");let h=await r.createOffer();n.log.trace("client created local offer %s",h.sdp);let y=Vg(h,t);n.log.trace("client setting local offer %s",y.sdp),await r.setLocalDescription(y);let b=$A(n.remoteAddr,t);n.log.trace("client setting server description %s",b.sdp),await r.setRemoteDescription(b)}else{let h=FA(n.remoteAddr,t);n.log.trace("server setting client %s %s",h.type,h.sdp),await r.setRemoteDescription(h),n.log.trace("server creating local answer");let y=await r.createAnswer();n.log.trace("server created local answer");let b=Vg(y,t);n.log.trace("server setting local description %s",y.sdp),await r.setLocalDescription(b)}if(o.readyState!=="open"&&(n.log.trace("%s wait for handshake channel to open, starting status %s",n.role,o.readyState),await pt(o,"open",n)),n.log.trace("%s handshake channel opened",n.role),lI(n,r)){let h=r.remoteFingerprint()?.value??"";n.remoteAddr=n.remoteAddr.encapsulate(VA(h))}let i=HA(r.localDescription?.sdp);if(i==null)throw new ro("Could not get fingerprint from local description sdp");n.log.trace("%s performing noise handshake",n.role);let s=qA(i,n.remoteAddr,n.role),a=KA({prologueBytes:s})(n),c=dc({channel:o,direction:"outbound",isHandshake:!0,log:n.log,...n.dataChannel??{}}),f=mc({peerConnection:r,remoteAddr:n.remoteAddr,metrics:n.events,direction:n.role==="client"?"outbound":"inbound",log:n.logger.forComponent("libp2p:webrtc-direct:connection")});if(r.addEventListener(uI,()=>{switch(r.connectionState){case"failed":case"disconnected":case"closed":f.close().catch(h=>{n.log.error("error closing connection - %e",h),f.abort(h)});break;default:break}}),n.events?.increment({peer_connection:!0}),n.role==="client"){n.log.trace("%s secure inbound",n.role);let h=await a.secureInbound(c,{remotePeer:n.remotePeer,signal:n.signal,skipStreamMuxerNegotiation:!0});return n.log.trace("%s upgrade outbound",n.role),await n.upgrader.upgradeOutbound(f,{skipProtection:!0,skipEncryption:!0,remotePeer:h.remotePeer,muxerFactory:e,signal:n.signal})}n.log.trace("%s secure outbound",n.role);let p=await a.secureOutbound(c,{remotePeer:n.remotePeer,signal:n.signal,skipStreamMuxerNegotiation:!0});f.remoteAddr=f.remoteAddr.encapsulate(`/p2p/${p.remotePeer}`),n.log.trace("%s upgrade inbound",n.role),await n.upgrader.upgradeInbound(f,{skipProtection:!0,skipEncryption:!0,remotePeer:p.remotePeer,muxerFactory:e,signal:n.signal})}catch(i){throw o.close(),r.close(),i}}async function zA(r,e,t={}){let n=t.certificate;n==null&&(n=await RTCPeerConnection.generateCertificate({name:"ECDSA",namedCurve:"P-256"}));let o=typeof t.rtcConfiguration=="function"?await t.rtcConfiguration():t.rtcConfiguration,i=new RTCPeerConnection({...o??{},certificates:[n]}),s=new to({peerConnection:i,metrics:t.events,dataChannelOptions:t.dataChannel});return{peerConnection:i,muxerFactory:s}}async function XA(r){let e=await Ll(r),t=await crypto.subtle.exportKey("pkcs8",e.privateKey);return["-----BEGIN PRIVATE KEY-----",...ue(new Uint8Array(t),"base64pad").split(/(.{64})/).filter(Boolean),"-----END PRIVATE KEY-----"].join(`
`)}var tp=class{log;metrics;components;init;certificate;privateKey;emitter;renewCertificateTask;constructor(e,t={}){if(this.log=e.logger.forComponent("libp2p:webrtc-direct"),this.components=e,this.init=t,this.emitter=new er,t.certificateLifespan!=null&&t.certificateRenewalThreshold!=null&&t.certificateRenewalThreshold>=t.certificateLifespan)throw new xe("Certificate renewal threshold must be less than certificate lifespan");e.metrics!=null&&(this.metrics={dialerEvents:e.metrics.registerCounterGroup("libp2p_webrtc-direct_dialer_events_total",{label:"event",help:"Total count of WebRTC-direct dial events by type"})})}[hl]=!0;[Symbol.toStringTag]="@libp2p/webrtc-direct";[Ji]=["@libp2p/transport"];async start(){this.certificate=await this.getCertificate()}async stop(){this.renewCertificateTask!=null&&clearTimeout(this.renewCertificateTask),this.certificate=void 0}async dial(e,t){this.log("dial %a",e),t.signal.throwIfAborted();let n,o=e.getComponents().findLast(c=>c.code===421)?.value;o!=null&&(n=bs(o));let i=Xw(),{peerConnection:s,muxerFactory:a}=await zA("client",i,{rtcConfiguration:typeof this.init.rtcConfiguration=="function"?await this.init.rtcConfiguration():this.init.rtcConfiguration??{},dataChannel:this.init.dataChannel});try{return await GA(s,a,i,{role:"client",log:this.log,logger:this.components.logger,events:this.metrics?.dialerEvents,signal:t.signal,remoteAddr:e,dataChannel:this.init.dataChannel,upgrader:t.upgrader,peerId:this.components.peerId,remotePeer:n,privateKey:this.components.privateKey})}catch(c){throw s.close(),c}}createListener(e){if(this.certificate==null)throw new cl;return new zh(this.components,{...this.init,...e,certificate:this.certificate,emitter:this.emitter})}listenFilter(e){return e.filter(Bw.exactMatch)}dialFilter(e){return this.listenFilter(e)}async getCertificate(e){if(fI(this.init.certificate))return this.log("using provided TLS certificate"),this.init.certificate;let t=await this.loadOrCreatePrivateKey(),{pem:n,certhash:o}=await this.loadOrCreateCertificate(t,e);return{privateKey:await XA(t),pem:n,certhash:o}}async loadOrCreatePrivateKey(){if(this.privateKey!=null)return this.privateKey;let e=this.init.certificateKeychainName??Uw,t=this.getKeychain();try{if(t==null)throw this.log("no keychain configured - not checking for stored private key"),new ko;this.log.trace("checking for stored private key"),this.privateKey=await t.exportKey(e)}catch(n){if(n.name!=="NotFoundError")throw n;this.log.trace("generating private key"),this.privateKey=await ew("ECDSA","P-256"),t!=null?(this.log.trace("storing private key"),await t.importKey(e,this.privateKey)):this.log("no keychain configured - not storing private key")}return this.privateKey}async loadOrCreateCertificate(e,t){if(this.certificate!=null&&t!==!0)return this.certificate;let n,o=new zu(this.init.certificateDatastoreKey??Lw),i=await Ll(e);try{if(t===!0)throw this.log.trace("forcing renewal of TLS certificate"),new ko;this.log.trace("checking for stored TLS certificate"),n=await this.loadCertificate(o,i)}catch(a){if(a.name!=="NotFoundError")throw a;this.log.trace("generating new TLS certificate"),n=await this.createCertificate(o,i)}let s=n.notAfter.getTime()-(this.init.certificateRenewalThreshold??hm)-Date.now();return s<0&&(s=100),this.log("will renew TLS certificate after %d ms",s),this.renewCertificateTask=setTimeout(()=>{this.log("renewing TLS certificate"),this.getCertificate(!0).then(a=>{this.certificate=a,this.emitter.safeDispatchEvent("certificate:renew",{detail:a})}).catch(a=>{this.log.error("could not renew certificate - %e",a)})},s),{pem:n.toString("pem"),certhash:Po.encode((await tr.digest(new Uint8Array(n.rawData))).bytes)}}async loadCertificate(e,t){let n=await this.components.datastore.get(e),o=new ma(n),i=o.notAfter.getTime()-(this.init.certificateRenewalThreshold??hm);if(Date.now()>i)throw this.log("stored TLS certificate has expired"),new ko;this.log("loaded certificate, expires in %d ms",i);let s=await o.publicKey.export(crypto),a=await crypto.subtle.exportKey("raw",s),c=await crypto.subtle.exportKey("raw",t.publicKey);if(!We(new Uint8Array(a,0,a.byteLength),new Uint8Array(c,0,c.byteLength)))throw this.log("stored TLS certificate public key did not match public key from private key"),new ko;return this.log("loaded certificate, expiry time is %o",i),o}async createCertificate(e,t){let n=new Date,o=new Date(Date.now()+(this.init.certificateLifespan??Mw));n.setMilliseconds(0),o.setMilliseconds(0);let i=await qh.createSelfSigned({serialNumber:(BigInt(Math.random().toString().replace(".",""))*100000n).toString(16),name:"CN=example.com, C=US, L=CA, O=example, ST=CA",notBefore:n,notAfter:o,keys:t,extensions:[new ha(!1,void 0,!0)]},crypto);return this.getKeychain()!=null?(this.log.trace("storing TLS certificate"),await this.components.datastore.put(e,de(i.toString("pem")))):this.log("no keychain is configured so not storing TLS certificate since the private key will not be reused"),i}getKeychain(){try{return this.components.keychain}catch{}}};function fI(r){return r==null?!1:typeof r.privateKey=="string"&&typeof r.pem=="string"&&typeof r.certhash=="string"}function hI(r){return e=>new tp(e,r)}function pI(r){return e=>new Sf(e,r)}return lS(dI);})();
/*! Bundled license information:

reflect-metadata/Reflect.js:
  (*! *****************************************************************************
  Copyright (C) Microsoft. All rights reserved.
  Licensed under the Apache License, Version 2.0 (the "License"); you may not use
  this file except in compliance with the License. You may obtain a copy of the
  License at http://www.apache.org/licenses/LICENSE-2.0
  
  THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
  KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
  WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
  MERCHANTABLITY OR NON-INFRINGEMENT.
  
  See the Apache Version 2.0 License for specific language governing permissions
  and limitations under the License.
  ***************************************************************************** *)

pvtsutils/build/index.js:
  (*!
   * MIT License
   * 
   * Copyright (c) 2017-2024 Peculiar Ventures, LLC
   * 
   * Permission is hereby granted, free of charge, to any person obtaining a copy
   * of this software and associated documentation files (the "Software"), to deal
   * in the Software without restriction, including without limitation the rights
   * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
   * copies of the Software, and to permit persons to whom the Software is
   * furnished to do so, subject to the following conditions:
   * 
   * The above copyright notice and this permission notice shall be included in all
   * copies or substantial portions of the Software.
   * 
   * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
   * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
   * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
   * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
   * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
   * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
   * SOFTWARE.
   * 
   *)

tslib/tslib.js:
  (*! *****************************************************************************
  Copyright (c) Microsoft Corporation.
  
  Permission to use, copy, modify, and/or distribute this software for any
  purpose with or without fee is hereby granted.
  
  THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
  REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
  AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
  INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
  LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
  OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
  PERFORMANCE OF THIS SOFTWARE.
  ***************************************************************************** *)

@noble/hashes/utils.js:
  (*! noble-hashes - MIT License (c) 2022 Paul Miller (paulmillr.com) *)

@noble/curves/utils.js:
@noble/curves/abstract/modular.js:
@noble/curves/abstract/curve.js:
@noble/curves/abstract/edwards.js:
@noble/curves/abstract/montgomery.js:
@noble/curves/ed25519.js:
@noble/curves/abstract/weierstrass.js:
@noble/curves/secp256k1.js:
  (*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) *)

pvutils/build/utils.es.js:
  (*!
   Copyright (c) Peculiar Ventures, LLC
  *)

asn1js/build/index.es.js:
  (*!
   * Copyright (c) 2014, GMO GlobalSign
   * Copyright (c) 2015-2022, Peculiar Ventures
   * All rights reserved.
   * 
   * Author 2014-2019, Yury Strozhevsky
   * 
   * Redistribution and use in source and binary forms, with or without modification,
   * are permitted provided that the following conditions are met:
   * 
   * * Redistributions of source code must retain the above copyright notice, this
   *   list of conditions and the following disclaimer.
   * 
   * * Redistributions in binary form must reproduce the above copyright notice, this
   *   list of conditions and the following disclaimer in the documentation and/or
   *   other materials provided with the distribution.
   * 
   * * Neither the name of the copyright holder nor the names of its
   *   contributors may be used to endorse or promote products derived from
   *   this software without specific prior written permission.
   * 
   * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS" AND
   * ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED
   * WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
   * DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT HOLDER OR CONTRIBUTORS BE LIABLE FOR
   * ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES
   * (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;
   * LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON
   * ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
   * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
   * SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
   * 
   *)

@peculiar/x509/build/x509.es.js:
  (*!
   * MIT License
   * 
   * Copyright (c) Peculiar Ventures. All rights reserved.
   * 
   * Permission is hereby granted, free of charge, to any person obtaining a copy
   * of this software and associated documentation files (the "Software"), to deal
   * in the Software without restriction, including without limitation the rights
   * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
   * copies of the Software, and to permit persons to whom the Software is
   * furnished to do so, subject to the following conditions:
   * 
   * The above copyright notice and this permission notice shall be included in all
   * copies or substantial portions of the Software.
   * 
   * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
   * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
   * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
   * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
   * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
   * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
   * SOFTWARE.
   * 
   *)

@noble/ciphers/utils.js:
  (*! noble-ciphers - MIT License (c) 2023 Paul Miller (paulmillr.com) *)
*/
return Libp2PWebrtc}));
//# sourceMappingURL=index.min.js.map
